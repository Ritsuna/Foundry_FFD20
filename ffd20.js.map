{"version":3,"file":"ffd20.js","sources":["../module/config.mjs","../module/applications/settings/health.mjs","../module/applications/settings/experience.mjs","../module/applications/settings/accessibility.mjs","../module/applications/settings/tooltip_world.mjs","../module/applications/settings/tooltip.mjs","../module/applications/tooltip.mjs","../module/documents/settings.mjs","../module/utils/handlebars/templates.mjs","../module/utils/semver.mjs","../module/dice/roll.mjs","../module/utils/lib.mjs","../module/utils/handlebars/helpers.mjs","../module/mce/mce.mjs","../module/utils/canvas.mjs","../module/canvas/measure.mjs","../module/applications/vision-permission.mjs","../module/documents/actor/actor-base.mjs","../module/utils/lib.mjs","../module/documents/chat-message.mjs","../module/utils/hooks.mjs","../module/dice/d20roll.mjs","../module/dice/dice.mjs","../module/documents/item/item-base.mjs","../node_modules/simple-swizzle/index.js","../node_modules/simple-swizzle/node_modules/is-arrayish/index.js","../node_modules/color-string/index.js","../node_modules/color-name/index.js","../node_modules/color/node_modules/color-convert/conversions.js","../node_modules/color/node_modules/color-name/index.js","../node_modules/color/node_modules/color-convert/route.js","../node_modules/color/node_modules/color-convert/index.js","../node_modules/color/index.js","../module/utils/chat.mjs","../module/documents/actor/utils/apply-changes.mjs","../module/components/change.mjs","../module/components/action.mjs","../module/action-use/chat-attack.mjs","../module/utils/chat.mjs","../module/action-use/action-use.mjs","../module/documents/item/item-ffd20.mjs","../module/utils/links.mjs","../module/documents/actor/utils/spellbook.mjs","../module/documents/actor/actor-ffd20.mjs","../module/documents/actor/actor-character.mjs","../module/documents/actor/actor-npc.mjs","../module/documents/actor/actor-basic.mjs","../module/applications/trait-selector.mjs","../module/applications/actor/actor-rest.mjs","../module/applications/point-buy-calculator.mjs","../module/applications/item-picker.mjs","../module/utils/dialog.mjs","../module/applications/level-up.mjs","../module/applications/currency-transfer.mjs","../module/applications/actor/actor-sheet.mjs","../module/applications/actor/character-sheet.mjs","../module/applications/actor/npc-sheet.mjs","../module/applications/actor/npc-lite-sheet.mjs","../module/applications/actor/npc-loot-sheet.mjs","../module/applications/actor/basic-sheet.mjs","../module/applications/actor/actor-flags.mjs","../module/applications/senses-selector.mjs","../module/applications/skill-editor.mjs","../module/documents/combat.mjs","../module/canvas/token.mjs","../module/documents/token.mjs","../module/applications/entry-selector.mjs","../module/applications/script-editor.mjs","../module/applications/compendium-browser.mjs","../module/applications/sidebar.mjs","../module/applications/xp-distributor.mjs","../module/applications/damage-type-selector.mjs","../module/documents/active-effect.mjs","../module/documents/item/item-attack.mjs","../module/documents/item/item-buff.mjs","../module/documents/item/item-class.mjs","../module/documents/item/item-consumable.mjs","../module/documents/item/item-container.mjs","../module/documents/item/item-equipment.mjs","../module/documents/item/item-feat.mjs","../module/documents/item/item-loot.mjs","../module/documents/item/item-race.mjs","../module/documents/item/item-spell.mjs","../module/documents/item/item-weapon.mjs","../module/documents/item/item-ffd20.mjs","../module/applications/categorized-item-picker.mjs","../module/applications/item/item-sheet.mjs","../module/applications/item/container-sheet.mjs","../module/compendium-directory.mjs","../module/canvas/low-light-vision.mjs","../module/patch-core.mjs","../module/canvas/ability-template.mjs","../module/action-use/action-use.mjs","../module/applications/attack-dialog.mjs","../module/canvas/attack-reach.mjs","../module/canvas/token-quick-actions.mjs","../module/socket.mjs","../node_modules/markdown-it/lib/common/entities.js","../node_modules/uc.micro/categories/P/regex.js","../node_modules/mdurl/encode.js","../node_modules/mdurl/decode.js","../node_modules/mdurl/parse.js","../node_modules/mdurl/index.js","../node_modules/mdurl/format.js","../node_modules/uc.micro/properties/Any/regex.js","../node_modules/uc.micro/categories/Cc/regex.js","../node_modules/uc.micro/categories/Z/regex.js","../node_modules/uc.micro/index.js","../node_modules/uc.micro/categories/Cf/regex.js","../node_modules/markdown-it/lib/common/utils.js","../node_modules/markdown-it/lib/helpers/parse_link_destination.js","../node_modules/markdown-it/lib/helpers/parse_link_title.js","../node_modules/markdown-it/lib/helpers/index.js","../node_modules/markdown-it/lib/helpers/parse_link_label.js","../node_modules/markdown-it/lib/renderer.js","../node_modules/markdown-it/lib/ruler.js","../node_modules/markdown-it/lib/rules_core/normalize.js","../node_modules/markdown-it/lib/rules_core/linkify.js","../node_modules/markdown-it/lib/rules_core/replacements.js","../node_modules/markdown-it/lib/rules_core/smartquotes.js","../node_modules/markdown-it/lib/token.js","../node_modules/markdown-it/lib/rules_core/state_core.js","../node_modules/markdown-it/lib/parser_core.js","../node_modules/markdown-it/lib/rules_core/block.js","../node_modules/markdown-it/lib/rules_core/inline.js","../node_modules/markdown-it/lib/rules_core/text_join.js","../node_modules/markdown-it/lib/rules_block/table.js","../node_modules/markdown-it/lib/rules_block/blockquote.js","../node_modules/markdown-it/lib/rules_block/hr.js","../node_modules/markdown-it/lib/rules_block/list.js","../node_modules/markdown-it/lib/rules_block/reference.js","../node_modules/markdown-it/lib/common/html_re.js","../node_modules/markdown-it/lib/rules_block/html_block.js","../node_modules/markdown-it/lib/common/html_blocks.js","../node_modules/markdown-it/lib/rules_block/heading.js","../node_modules/markdown-it/lib/rules_block/state_block.js","../node_modules/markdown-it/lib/parser_block.js","../node_modules/markdown-it/lib/rules_block/code.js","../node_modules/markdown-it/lib/rules_block/fence.js","../node_modules/markdown-it/lib/rules_block/lheading.js","../node_modules/markdown-it/lib/rules_block/paragraph.js","../node_modules/markdown-it/lib/rules_inline/text.js","../node_modules/markdown-it/lib/rules_inline/escape.js","../node_modules/markdown-it/lib/rules_inline/linkify.js","../node_modules/markdown-it/lib/rules_inline/newline.js","../node_modules/markdown-it/lib/rules_inline/strikethrough.js","../node_modules/markdown-it/lib/rules_inline/emphasis.js","../node_modules/markdown-it/lib/rules_inline/link.js","../node_modules/markdown-it/lib/rules_inline/image.js","../node_modules/markdown-it/lib/rules_inline/autolink.js","../node_modules/markdown-it/lib/rules_inline/html_inline.js","../node_modules/markdown-it/lib/rules_inline/entity.js","../node_modules/markdown-it/lib/rules_inline/balance_pairs.js","../node_modules/markdown-it/lib/rules_inline/state_inline.js","../node_modules/markdown-it/lib/parser_inline.js","../node_modules/markdown-it/lib/rules_inline/backticks.js","../node_modules/markdown-it/lib/rules_inline/fragments_join.js","../node_modules/linkify-it/index.js","../node_modules/linkify-it/lib/re.js","../node_modules/punycode/punycode.es6.js","../node_modules/markdown-it/lib/index.js","../node_modules/markdown-it/lib/presets/default.js","../node_modules/markdown-it/lib/presets/zero.js","../node_modules/markdown-it/lib/presets/commonmark.js","../node_modules/markdown-it/index.js","../module/applications/change-log.mjs","../node_modules/markdown-it-anchor/dist/markdownItAnchor.mjs","../module/applications/help-browser.mjs","../module/migration.mjs","../module/documents/macros.mjs","../module/documents/controls.mjs","../module/components/script-call.mjs","../module/applications/component/action-sheet.mjs","../module/components/conditionals.mjs","../module/applications/action-chooser.mjs","../module/registry/base-registry.mjs","../module/registry/damage-types.mjs","../module/registry/script-call.mjs","../module/applications/link-options.mjs","../module/canvas/detection-modes.mjs","../module/utils/roll-preprocess.mjs","../ffd20.mjs","../module/modules.mjs"],"sourcesContent":["/**\n * FFD20 Configuration Values\n *\n * A dictionary of dictionaries providing configuration data like formulae,\n * translation keys, and other configuration values. Translations keys are\n * assumed to get replaced by their proper translation when the system is loaded.\n *\n * The FFD20 object may be adjusted to influence the system's behaviour during runtime.\n */\nexport const FFD20 = {\n  re: {\n    traitSeparator: /\\s*[;]\\s*/g,\n  },\n\n  /**\n   * The set of Ability Scores used within the system\n   */\n  abilities: {\n    str: \"FFD20.AbilityStr\",\n    dex: \"FFD20.AbilityDex\",\n    con: \"FFD20.AbilityCon\",\n    int: \"FFD20.AbilityInt\",\n    wis: \"FFD20.AbilityWis\",\n    cha: \"FFD20.AbilityCha\",\n  },\n\n  /**\n   * The set of Ability Scores used within the system in short form\n   */\n  abilitiesShort: {\n    str: \"FFD20.AbilityShortStr\",\n    dex: \"FFD20.AbilityShortDex\",\n    con: \"FFD20.AbilityShortCon\",\n    int: \"FFD20.AbilityShortInt\",\n    wis: \"FFD20.AbilityShortWis\",\n    cha: \"FFD20.AbilityShortCha\",\n  },\n\n  /**\n   * The point cost to increase an ability score using Point Buy\n   */\n  abilityCost: {\n    7: -4,\n    8: -2,\n    9: -1,\n    10: 0,\n    11: 1,\n    12: 2,\n    13: 3,\n    14: 5,\n    15: 7,\n    16: 10,\n    17: 13,\n    18: 17,\n  },\n\n  /**\n   * At which levels you receive how many new ability points.\n   */\n  levelAbilityScores: {\n    4: 1,\n    8: 1,\n    12: 1,\n    16: 1,\n    20: 1,\n  },\n\n  /**\n   * Data for the feature associated with ability scores gained from leveling.\n   */\n  levelAbilityScoreFeature: {\n    img: \"systems/ffd20/icons/skills/affliction_10.jpg\",\n    name: \"FFD20.LevelUp.AbilityScore.Item.Name\",\n    data: {\n      description: {\n        value: \"FFD20.LevelUp.AbilityScore.Item.Desc\",\n      },\n      featType: \"misc\",\n    },\n    type: \"feat\",\n  },\n\n  /**\n   * The set of Saving Throws\n   */\n  savingThrows: {\n    fort: \"FFD20.SavingThrowFort\",\n    ref: \"FFD20.SavingThrowRef\",\n    will: \"FFD20.SavingThrowWill\",\n  },\n\n  /**\n   * The types of classes\n   */\n  classTypes: {\n    base: \"FFD20.ClassTypeBase\",\n    prestige: \"FFD20.ClassTypePrestige\",\n    npc: \"FFD20.ClassTypeNPC\",\n    racial: \"FFD20.ClassTypeRacial\",\n    mythic: \"FFD20.ClassTypeMythic\",\n  },\n\n  /**\n   * Valid options for a class's BAB progression\n   */\n  classBAB: {\n    low: \"FFD20.Low\",\n    med: \"FFD20.Medium\",\n    high: \"FFD20.High\",\n    custom: \"FFD20.Custom\",\n  },\n\n  /**\n   * Valid options for a class's saving throw bonus progression\n   */\n  classSavingThrows: {\n    low: \"FFD20.Poor\",\n    high: \"FFD20.Good\",\n    custom: \"FFD20.Custom\",\n  },\n\n  /**\n   * The formulae for BAB progressions\n   */\n  classBABFormulas: {\n    low: \"floor(@hitDice * 0.5)\",\n    med: \"floor(@hitDice * 0.75)\",\n    high: \"@hitDice\",\n    custom: \"0\",\n  },\n\n  classFractionalBABFormulas: {\n    low: \"@hitDice * 0.5\", // 1/2\n    med: \"@hitDice * 0.75\", // 3/4\n    high: \"@hitDice\", // 1/1\n    custom: \"0\",\n  },\n\n  /**\n   * The formulae for saving throw progressions by class type\n   */\n  classSavingThrowFormulas: {\n    base: {\n      low: \"floor(@hitDice / 3)\",\n      high: \"2 + floor(@hitDice / 2)\",\n    },\n    prestige: {\n      low: \"floor((1 + @hitDice) / 3)\",\n      high: \"floor((1 + @hitDice) / 2)\",\n    },\n    npc: {\n      low: \"floor(@hitDice / 3)\",\n      high: \"2 + floor(@hitDice / 2)\",\n    },\n    racial: {\n      low: \"floor(@hitDice / 3)\",\n      high: \"2 + floor(@hitDice / 2)\",\n    },\n    mythic: {\n      low: \"0\",\n      high: \"0\",\n    },\n    custom: {\n      low: \"0\",\n      high: \"0\",\n    },\n  },\n  classFractionalSavingThrowFormulas: {\n    goodSaveBonus: \"2\",\n    base: {\n      low: \"@hitDice / 3\",\n      high: \"@hitDice / 2\",\n      goodSave: true,\n    },\n    prestige: {\n      low: \"(1 + @hitDice) / 3\",\n      high: \"(1 + @hitDice) / 2\",\n    },\n    npc: {\n      low: \"@hitDice / 3\",\n      high: \"@hitDice / 2\",\n      goodSave: true,\n    },\n    racial: {\n      low: \"@hitDice / 3\",\n      high: \"@hitDice / 2\",\n      goodSave: true,\n    },\n    mythic: {\n      low: \"0\",\n      high: \"0\",\n    },\n    custom: {\n      low: \"0\",\n      high: \"0\",\n    },\n  },\n\n  /**\n   * The choices available for favored class bonuses\n   */\n  favouredClassBonuses: {\n    hp: \"FFD20.FavouredClassHP\",\n    skill: \"FFD20.FavouredClassSkill\",\n    alt: \"FFD20.FavouredClassAlt\",\n  },\n\n  /**\n   * Icons used for favored class bonus choices\n   */\n  favouredClassBonusIcons: {\n    hp: \"fa-heartbeat\",\n    skill: \"fa-wrench\",\n    alt: \"fa-tag\",\n  },\n\n  /**\n   * The set of Armor Classes\n   */\n  ac: {\n    normal: \"FFD20.ACNormal\",\n    touch: \"FFD20.ACTouch\",\n    flatFooted: \"FFD20.ACFlatFooted\",\n  },\n\n  /**\n   * The set of Armor Class modifier types\n   */\n  acValueLabels: {\n    normal: \"FFD20.ACTypeNormal\",\n    touch: \"FFD20.ACTypeTouch\",\n    flatFooted: \"FFD20.ACTypeFlatFooted\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * Character alignment options\n   */\n  alignments: {\n    lg: \"FFD20.AlignmentLG\",\n    ng: \"FFD20.AlignmentNG\",\n    cg: \"FFD20.AlignmentCG\",\n    ln: \"FFD20.AlignmentLN\",\n    tn: \"FFD20.AlignmentTN\",\n    cn: \"FFD20.AlignmentCN\",\n    le: \"FFD20.AlignmentLE\",\n    ne: \"FFD20.AlignmentNE\",\n    ce: \"FFD20.AlignmentCE\",\n  },\n\n  /**\n   * Character alignment options in their short form\n   */\n  alignmentsShort: {\n    lg: \"FFD20.AlignmentShortLG\",\n    ng: \"FFD20.AlignmentShortNG\",\n    cg: \"FFD20.AlignmentShortCG\",\n    ln: \"FFD20.AlignmentShortLN\",\n    tn: \"FFD20.AlignmentShortTN\",\n    cn: \"FFD20.AlignmentShortCN\",\n    le: \"FFD20.AlignmentShortLE\",\n    ne: \"FFD20.AlignmentShortNE\",\n    ce: \"FFD20.AlignmentShortCE\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * The set of Armor Proficiencies which a character may have\n   */\n  armorProficiencies: {\n    lgt: \"FFD20.ArmorProfLight\",\n    med: \"FFD20.ArmorProfMedium\",\n    hvy: \"FFD20.ArmorProfHeavy\",\n    shl: \"FFD20.ArmorProfShield\",\n    twr: \"FFD20.ArmorProfTowerShield\",\n  },\n\n  /**\n   * The set of broad Weapon Proficiencies a character may have\n   */\n  weaponProficiencies: {\n    sim: \"FFD20.WeaponProfSimple\",\n    mar: \"FFD20.WeaponProfMartial\",\n    exo: \"FFD20.WeaponProfExotic\",\n    che: \"FFD20.WeaponProfChef\",\n    pow: \"FFD20.WeaponProfPower\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * This describes the ways that an ability can be activated.\n   */\n  abilityActivationTypes: {\n    passive: \"FFD20.ActivationTypePassive\",\n    free: \"FFD20.ActivationTypeFree\",\n    nonaction: \"FFD20.ActivationTypeNonaction\",\n    swift: \"FFD20.ActivationTypeSwift\",\n    immediate: \"FFD20.ActivationTypeImmediate\",\n    move: \"FFD20.ActivationTypeMove\",\n    standard: \"FFD20.ActivationTypeStandard\",\n    full: \"FFD20.ActivationTypeFullround\",\n    attack: \"FFD20.ActivationTypeAttack\",\n    aoo: \"FFD20.ActivationTypeAoO\",\n    round: \"FFD20.ActivationTypeRound\",\n    minute: \"FFD20.ActivationTypeMinute\",\n    hour: \"FFD20.ActivationTypeHour\",\n    special: \"FFD20.ActivationTypeSpecial\",\n  },\n\n  /**\n   * This describes plurals for activation types.\n   */\n  abilityActivationTypesPlurals: {\n    free: \"FFD20.ActivationTypeFreePlural\",\n    swift: \"FFD20.ActivationTypeSwiftPlural\",\n    immediate: \"FFD20.ActivationTypeImmediatePlural\",\n    move: \"FFD20.ActivationTypeMovePlural\",\n    standard: \"FFD20.ActivationTypeStandardPlural\",\n    full: \"FFD20.ActivationTypeFullroundPlural\",\n    attack: \"FFD20.ActivationTypeAttackPlural\",\n    round: \"FFD20.ActivationTypeRoundPlural\",\n    minute: \"FFD20.ActivationTypeMinutePlural\",\n    hour: \"FFD20.ActivationTypeHourPlural\",\n  },\n\n  /**\n   * This describes the ways that an ability can be activated when using\n   * Unchained rules.\n   */\n  abilityActivationTypes_unchained: {\n    passive: \"FFD20.ActivationTypePassive\",\n    free: \"FFD20.ActivationTypeFree\",\n    nonaction: \"FFD20.ActivationTypeNonaction\",\n    reaction: \"FFD20.ActivationTypeReaction\",\n    action: \"FFD20.ActivationTypeAction\",\n    attack: \"FFD20.ActivationTypeAttack\",\n    aoo: \"FFD20.ActivationTypeAoO\",\n    minute: \"FFD20.ActivationTypeMinute\",\n    hour: \"FFD20.ActivationTypeHour\",\n    special: \"FFD20.ActivationTypeSpecial\",\n  },\n\n  /**\n   * This describes plurals for the ways that an ability can be activated when\n   * using Unchained rules.\n   */\n  abilityActivationTypesPlurals_unchained: {\n    passive: \"FFD20.ActivationTypePassive\",\n    free: \"FFD20.ActivationTypeFreePlural\",\n    reaction: \"FFD20.ActivationTypeReactionPlural\",\n    action: \"FFD20.ActivationTypeActionPlural\",\n    minute: \"FFD20.ActivationTypeMinutePlural\",\n    hour: \"FFD20.ActivationTypeHourPlural\",\n    special: \"FFD20.ActivationTypeSpecial\",\n  },\n\n  /**\n   * The possible conditions when using Wound Threshold rules\n   */\n  woundThresholdConditions: {\n    0: \"FFD20.WoundLevelHealthy\",\n    1: \"FFD20.WoundLevelGrazed\",\n    2: \"FFD20.WoundLevelWounded\",\n    3: \"FFD20.WoundLevelCritical\",\n  },\n\n  /**\n   * Change targets affected by Wound Thresholds.\n   */\n  woundThresholdChangeTargets: [\"~attackCore\", \"cmd\", \"allSavingThrows\", \"ac\", \"~skillMods\", \"allChecks\"],\n\n  divineFocus: {\n    0: \"\",\n    1: \"FFD20.SpellComponentDivineFocusAlone\",\n    2: \"FFD20.SpellComponentDivineFocusMaterial\",\n    3: \"FFD20.SpellComponentDivineFocusFocus\",\n  },\n\n  /**\n   * The measure template types available e.g. for spells\n   */\n  measureTemplateTypes: {\n    cone: \"FFD20.MeasureTemplateCone\",\n    circle: \"FFD20.MeasureTemplateCircle\",\n    ray: \"FFD20.MeasureTemplateRay\",\n    rect: \"FFD20.MeasureTemplateRectangle\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * The possible creature sizes\n   */\n  actorSizes: {\n    fine: \"FFD20.ActorSizeFine\",\n    dim: \"FFD20.ActorSizeDiminutive\",\n    tiny: \"FFD20.ActorSizeTiny\",\n    sm: \"FFD20.ActorSizeSmall\",\n    med: \"FFD20.ActorSizeMedium\",\n    lg: \"FFD20.ActorSizeLarge\",\n    huge: \"FFD20.ActorSizeHuge\",\n    grg: \"FFD20.ActorSizeGargantuan\",\n    col: \"FFD20.ActorSizeColossal\",\n  },\n\n  /**\n   * The possible creature sizes in their one-letter form\n   */\n  sizeChart: {\n    fine: \"F\",\n    dim: \"D\",\n    tiny: \"T\",\n    sm: \"S\",\n    med: \"M\",\n    lg: \"L\",\n    huge: \"H\",\n    grg: \"G\",\n    col: \"C\",\n  },\n\n  /**\n   * The size values for Tokens according to the creature's size\n   */\n  tokenSizes: {\n    fine: { w: 1, h: 1, scale: 0.45 },\n    dim: { w: 1, h: 1, scale: 0.6 },\n    tiny: { w: 1, h: 1, scale: 0.75 },\n    sm: { w: 1, h: 1, scale: 0.9 },\n    med: { w: 1, h: 1, scale: 1 },\n    lg: { w: 2, h: 2, scale: 1 },\n    huge: { w: 3, h: 3, scale: 1 },\n    grg: { w: 4, h: 4, scale: 1 },\n    col: { w: 6, h: 6, scale: 1 },\n  },\n\n  /**\n   * The size modifier applied to creatures not of medium size\n   */\n  sizeMods: {\n    fine: 8,\n    dim: 4,\n    tiny: 2,\n    sm: 1,\n    med: 0,\n    lg: -1,\n    huge: -2,\n    grg: -4,\n    col: -8,\n  },\n\n  /**\n   * The size modifier applied to creatures not of medium size\n   */\n  sizeSpecialMods: {\n    fine: -8,\n    dim: -4,\n    tiny: -2,\n    sm: -1,\n    med: 0,\n    lg: 1,\n    huge: 2,\n    grg: 4,\n    col: 8,\n  },\n\n  /**\n   * The size modifier applied to fly checks of creatures not of medium size\n   */\n  sizeFlyMods: {\n    fine: 8,\n    dim: 6,\n    tiny: 4,\n    sm: 2,\n    med: 0,\n    lg: -2,\n    huge: -4,\n    grg: -6,\n    col: -8,\n  },\n\n  /**\n   * The size modifier applied to stealth checks of creatures not of medium size\n   */\n  sizeStealthMods: {\n    fine: 16,\n    dim: 12,\n    tiny: 8,\n    sm: 4,\n    med: 0,\n    lg: -4,\n    huge: -8,\n    grg: -12,\n    col: -16,\n  },\n\n  /**\n   * The possible options for a creature's maneuverability\n   */\n  flyManeuverabilities: {\n    clumsy: \"FFD20.FlyManeuverabilityClumsy\",\n    poor: \"FFD20.FlyManeuverabilityPoor\",\n    average: \"FFD20.FlyManeuverabilityAverage\",\n    good: \"FFD20.FlyManeuverabilityGood\",\n    perfect: \"FFD20.FlyManeuverabilityPerfect\",\n  },\n\n  /**\n   * The bonus values for a creature's maneuverability\n   */\n  flyManeuverabilityValues: {\n    clumsy: -8,\n    poor: -4,\n    average: 0,\n    good: 4,\n    perfect: 8,\n  },\n\n  /**\n   * The resulting speed values when a base speed is reduced\n   */\n  speedReduction: {\n    5: 5,\n    15: 10,\n    20: 15,\n    30: 20,\n    35: 25,\n    45: 30,\n    50: 35,\n    60: 40,\n    65: 45,\n    75: 50,\n    80: 55,\n    90: 60,\n    95: 65,\n    105: 70,\n    110: 75,\n    120: 80,\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * An array of maximum carry capacities, where the index is the ability/strength score.\n   */\n  // prettier-ignore\n  encumbranceLoads: [\n    0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 115, 130, 150, 175, 200, 230, 260, 300, 350, 400, 460, 520, 600, 700, 800, 920, 1040, 1200, 1400, 1600, 1840, 2080, 2400, 2800, 3200, 3680, 4160, 4800, 5600, 6400, 7360, 8320, 9600, 11200, 12800, 14720, 16640, 19200, 22400, 25600,\n  ],\n\n  /**\n   * Encumbrance multipliers applied due to a creature's size for bi- and\n   * quadrupedal creatures.\n   */\n  encumbranceMultipliers: {\n    normal: {\n      fine: 0.125,\n      dim: 0.25,\n      tiny: 0.5,\n      sm: 0.75,\n      med: 1,\n      lg: 2,\n      huge: 4,\n      grg: 8,\n      col: 16,\n    },\n    quadruped: {\n      fine: 0.25,\n      dim: 0.5,\n      tiny: 0.75,\n      sm: 1,\n      med: 1.5,\n      lg: 3,\n      huge: 6,\n      grg: 12,\n      col: 24,\n    },\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * The types for Items\n   */\n  itemTypes: {\n    equipment: \"FFD20.ItemTypeEquipment\",\n    weapon: \"FFD20.ItemTypeWeapon\",\n    loot: \"FFD20.ItemTypeLoot\",\n    consumable: \"FFD20.ItemTypeConsumable\",\n    class: \"FFD20.ItemTypeClass\",\n    buff: \"FFD20.ItemTypeBuff\",\n    spell: \"FFD20.ItemTypeSpell\",\n    feat: \"FFD20.ItemTypeFeat\",\n    attack: \"FFD20.ItemTypeAttack\",\n  },\n\n  /**\n   * Classification types for item action types\n   */\n  itemActionTypes: {\n    mwak: \"FFD20.ActionMWAK\",\n    rwak: \"FFD20.ActionRWAK\",\n    msak: \"FFD20.ActionMSAK\",\n    rsak: \"FFD20.ActionRSAK\",\n    mcman: \"FFD20.ActionMCMan\",\n    rcman: \"FFD20.ActionRCMan\",\n    spellsave: \"FFD20.ActionSpellSave\",\n    save: \"FFD20.ActionSave\",\n    heal: \"FFD20.ActionHeal\",\n    other: \"FFD20.ActionOther\",\n  },\n\n  /* -------------------------------------------- */\n\n  itemCapacityTypes: {\n    items: \"FFD20.ItemContainerCapacityItems\",\n    weight: \"FFD20.ItemContainerCapacityWeight\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * Enumerate the lengths of time over which an item can have limited use ability\n   */\n  limitedUsePeriods: {\n    single: \"FFD20.LimitedUseSingle\",\n    unlimited: \"FFD20.Unlimited\",\n    day: \"FFD20.LimitedUseDay\",\n    week: \"FFD20.LimitedUseWeek\",\n    charges: \"FFD20.LimitedUseCharges\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * The various equipment types and their subtypes\n   */\n  equipmentTypes: {\n    armor: {\n      _label: \"FFD20.EquipTypeArmor\",\n      lightArmor: \"FFD20.EquipTypeLight\",\n      mediumArmor: \"FFD20.EquipTypeMedium\",\n      heavyArmor: \"FFD20.EquipTypeHeavy\",\n    },\n    shield: {\n      _label: \"FFD20.EquipTypeShield\",\n      lightShield: \"FFD20.EquipTypeLightShield\",\n      heavyShield: \"FFD20.EquipTypeHeavyShield\",\n      towerShield: \"FFD20.EquipTypeTowerShield\",\n      other: \"FFD20.EquipTypeOtherShield\",\n    },\n    misc: {\n      _label: \"FFD20.Misc\",\n      wondrous: \"FFD20.EquipTypeWondrousItem\",\n      clothing: \"FFD20.EquipTypeClothing\",\n      other: \"FFD20.Other\",\n    },\n    materia: {\n      _label: \"FFD20.Materia\",\n      ability: \"FFD20.MateriaTypeAbility\",\n      independent: \"FFD20.MateriaTypeIndependent\",\n      spell: \"FFD20.MateriaTypeSpell\",\n      summon: \"FFD20.MateriaTypeSummon\",\n      support: \"FFD20.MateriaTypeSupport\",\n    },\n  },\n\n  /**\n   * The slots equipment can occupy, sorted by category\n   */\n  equipmentSlots: {\n    armor: {\n      armor: \"FFD20.EquipSlotArmor\",\n    },\n    shield: {\n      shield: \"FFD20.EquipSlotShield\",\n    },\n    misc: {\n      slotless: \"FFD20.EquipSlotSlotless\",\n      head: \"FFD20.EquipSlotHead\",\n      headband: \"FFD20.EquipSlotHeadband\",\n      eyes: \"FFD20.EquipSlotEyes\",\n      shoulders: \"FFD20.EquipSlotShoulders\",\n      neck: \"FFD20.EquipSlotNeck\",\n      chest: \"FFD20.EquipSlotChest\",\n      body: \"FFD20.EquipSlotBody\",\n      belt: \"FFD20.EquipSlotBelt\",\n      wrists: \"FFD20.EquipSlotWrists\",\n      hands: \"FFD20.EquipSlotHands\",\n      ring: \"FFD20.EquipSlotRing\",\n      feet: \"FFD20.EquipSlotFeet\",\n    },\n    materia: {\n      any: \"FFD20.MateriaSlotAny\",\n      weapon: \"FFD20.MateriaSlotWeapon\",\n      shield: \"FFD20.MateriaSlotShield\",\n      armor: \"FFD20.MateriaSlotArmor\",\n      weaponarmor: \"FFD20.MateriaSlotWeaponArmor\",\n      armorShield: \"FFD20.MateriaSlotArmorShield\",\n      other: \"FFD20.MateriaSlotOther\",\n    },\n  },\n\n  /**\n   * The subtypes for loot items\n   */\n  lootTypes: {\n    gear: \"FFD20.LootTypeGear\",\n    ammo: \"FFD20.LootTypeAmmo\",\n    tradeGoods: \"FFD20.LootTypeTradeGoods\",\n    misc: \"FFD20.Misc\",\n  },\n\n  /**\n   * The subtypes for ammo type loot items\n   */\n  ammoTypes: {\n    arrow: \"FFD20.AmmoTypeArrow\",\n    bolt: \"FFD20.AmmoTypeBolt\",\n    repeatingBolt: \"FFD20.AmmoTypeRepeatingBolt\",\n    slingBullet: \"FFD20.AmmoTypeBulletSling\",\n    gunBullet: \"FFD20.AmmoTypeBulletGun\",\n    dragoonBullet: \"FFD20.AmmoTypeBulletDragoon\",\n    dart: \"FFD20.AmmoTypeDart\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * Enumerate the valid consumable types which are recognized by the system\n   */\n  consumableTypes: {\n    potion: \"FFD20.ConsumableTypePotion\",\n    oil: \"FFD20.ConsumableTypeOil\",\n    poison: \"FFD20.ConsumableTypePoison\",\n    drug: \"FFD20.ConsumableTypeDrug\",\n    alchContact: \"FFD20.ConsumableTypeAlchContact\",\n    alchIngested: \"FFD20.ConsumableTypeAlchIngested\",\n    alchInhaled: \"FFD20.ConsumableTypeAlchInhaled\",\n    scroll: \"FFD20.ConsumableTypeScroll\",\n    wand: \"FFD20.ConsumableTypeWand\",\n    staff: \"FFD20.ConsumableTypeStaff\",\n    misc: \"FFD20.Misc\",\n  },\n\n  attackTypes: {\n    weapon: \"FFD20.AttackTypeWeapon\",\n    natural: \"FFD20.AttackTypeNatural\",\n    ability: \"FFD20.AttackTypeAbility\",\n    racialAbility: \"FFD20.AttackTypeRacial\",\n    item: \"FFD20.Item\",\n    misc: \"FFD20.Misc\",\n  },\n\n  featTypes: {\n    feat: \"FFD20.FeatTypeFeat\",\n    classFeat: \"FFD20.FeatTypeClassFeat\",\n    trait: \"FFD20.FeatTypeTraits\",\n    racial: \"FFD20.FeatTypeRacial\",\n    misc: \"FFD20.Misc\",\n    template: \"FFD20.FeatTypeTemplate\",\n  },\n\n  featTypesPlurals: {\n    feat: \"FFD20.FeatPlural\",\n    classFeat: \"FFD20.ClassFeaturePlural\",\n    trait: \"FFD20.TraitPlural\",\n    racial: \"FFD20.RacialTraitPlural\",\n    template: \"FFD20.TemplatePlural\",\n  },\n\n  /**\n   * Ability types, each with their short and their long form\n   */\n  abilityTypes: {\n    ex: {\n      short: \"FFD20.AbilityTypeShortExtraordinary\",\n      long: \"FFD20.AbilityTypeExtraordinary\",\n    },\n    su: {\n      short: \"FFD20.AbilityTypeShortSupernatural\",\n      long: \"FFD20.AbilityTypeSupernatural\",\n    },\n    sp: {\n      short: \"FFD20.AbilityTypeShortSpell-Like\",\n      long: \"FFD20.AbilityTypeSpell-Like\",\n    },\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * The valid currency denominations supported by the game system\n   */\n  currencies: {\n    pgil: \"FFD20.CurrencyPGil\",\n    gil: \"FFD20.CurrencyGil\",\n    sgil: \"FFD20.CurrencySGil\",\n    cgil: \"FFD20.CurrencyCGil\",\n  },\n\n  acTypes: {\n    armor: \"Armor\",\n    shield: \"Shield\",\n    natural: \"Natural Armor\",\n  },\n\n  /**\n   * The types of bonus modifiers\n   */\n  bonusModifiers: {\n    untyped: \"FFD20.BonusModifierUntyped\",\n    untypedPerm: \"FFD20.BonusModifierUntypedPerm\",\n    base: \"FFD20.BonusModifierBase\",\n    enh: \"FFD20.BonusModifierEnhancement\",\n    dodge: \"FFD20.BonusModifierDodge\",\n    inherent: \"FFD20.BonusModifierInherent\",\n    deflection: \"FFD20.BonusModifierDeflection\",\n    morale: \"FFD20.BonusModifierMorale\",\n    luck: \"FFD20.BonusModifierLuck\",\n    sacred: \"FFD20.BonusModifierSacred\",\n    insight: \"FFD20.BonusModifierInsight\",\n    resist: \"FFD20.BonusModifierResistance\",\n    profane: \"FFD20.BonusModifierProfane\",\n    trait: \"FFD20.BonusModifierTrait\",\n    racial: \"FFD20.BonusModifierRacial\",\n    size: \"FFD20.BonusModifierSize\",\n    competence: \"FFD20.BonusModifierCompetence\",\n    circumstance: \"FFD20.BonusModifierCircumstance\",\n    alchemical: \"FFD20.BonusModifierAlchemical\",\n    penalty: \"FFD20.BonusModifierPenalty\",\n  },\n\n  /**\n   * An array of stacking bonus modifiers by their keys for {@link bonusModifiers}\n   */\n  stackingBonusModifiers: [\"untyped\", \"untypedPerm\", \"dodge\", \"racial\", \"penalty\"],\n\n  /* -------------------------------------------- */\n\n  /**\n   * The damage types\n   */\n  get damageTypes() {\n    return ffd20.registry.damageTypes.reduce((cur, o) => {\n      cur[o.id] = game.i18n.localize(o.name);\n      return cur;\n    }, {});\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * Valid options for the range of abilities and spells\n   */\n  distanceUnits: {\n    none: \"FFD20.None\",\n    personal: \"FFD20.DistPersonal\",\n    touch: \"FFD20.DistTouch\",\n    melee: \"FFD20.DistMelee\",\n    reach: \"FFD20.DistReach\",\n    close: \"FFD20.DistClose\",\n    medium: \"FFD20.DistMedium\",\n    long: \"FFD20.DistLong\",\n    ft: \"FFD20.DistFt\",\n    mi: \"FFD20.DistMi\",\n    spec: \"FFD20.Special\",\n    seeText: \"FFD20.SeeText\",\n    unlimited: \"FFD20.Unlimited\",\n  },\n\n  measureUnits: {\n    ft: \"FFD20.DistFt\",\n    mi: \"FFD20.DistMi\",\n    m: \"FFD20.DistM\",\n    km: \"FFD20.DistKM\",\n  },\n\n  measureUnitsShort: {\n    ft: \"FFD20.DistFtShort\",\n    mi: \"FFD20.DistMiShort\",\n    m: \"FFD20.DistMShort\",\n    km: \"FFD20.DistKMShort\",\n  },\n\n  actorStatures: {\n    tall: \"FFD20.StatureTall\",\n    long: \"FFD20.StatureLong\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * This Object defines the types of single or area targets which can be applied in the game system.\n   */\n  targetTypes: {\n    none: \"FFD20.None\",\n    self: \"FFD20.TargetSelf\",\n    creature: \"FFD20.TargetCreature\",\n    ally: \"FFD20.TargetAlly\",\n    enemy: \"FFD20.TargetEnemy\",\n    object: \"FFD20.TargetObject\",\n    space: \"FFD20.TargetSpace\",\n    radius: \"FFD20.TargetRadius\",\n    sphere: \"FFD20.TargetSphere\",\n    cylinder: \"FFD20.TargetCylinder\",\n    cone: \"FFD20.TargetCone\",\n    square: \"FFD20.TargetSquare\",\n    cube: \"FFD20.TargetCube\",\n    line: \"FFD20.TargetLine\",\n    wall: \"FFD20.TargetWall\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * This Object defines the various lengths of time which can occur in FFD20\n   */\n  timePeriods: {\n    inst: \"FFD20.TimeInst\",\n    turn: \"FFD20.TimeTurn\",\n    round: \"FFD20.TimeRound\",\n    minute: \"FFD20.TimeMinute\",\n    hour: \"FFD20.TimeHour\",\n    day: \"FFD20.TimeDay\",\n    month: \"FFD20.TimeMonth\",\n    year: \"FFD20.TimeYear\",\n    perm: \"FFD20.TimePerm\",\n    seeText: \"FFD20.SeeText\",\n    spec: \"FFD20.Special\",\n  },\n\n  timePeriodsShort: {\n    turn: \"FFD20.TimeTurnShort\",\n    round: \"FFD20.TimeRoundShort\",\n    minute: \"FFD20.TimeMinuteShort\",\n    hour: \"FFD20.TimeHourShort\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * This Object determines spells gained and cast per level\n   */\n  casterProgression: {\n    castsPerDay: {\n      prepared: {\n        low: [\n          [Number.POSITIVE_INFINITY],\n          [Number.POSITIVE_INFINITY],\n          [Number.POSITIVE_INFINITY],\n          [Number.POSITIVE_INFINITY, 0],\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 1, 0],\n          [Number.POSITIVE_INFINITY, 1, 1],\n          [Number.POSITIVE_INFINITY, 2, 1],\n          [Number.POSITIVE_INFINITY, 2, 1, 0],\n          [Number.POSITIVE_INFINITY, 2, 1, 1],\n          [Number.POSITIVE_INFINITY, 2, 2, 1],\n          [Number.POSITIVE_INFINITY, 3, 2, 1, 0],\n          [Number.POSITIVE_INFINITY, 3, 2, 1, 1],\n          [Number.POSITIVE_INFINITY, 3, 2, 2, 1],\n          [Number.POSITIVE_INFINITY, 3, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 3, 2, 2],\n          [Number.POSITIVE_INFINITY, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 3, 3],\n        ],\n        med: [\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 2],\n          [Number.POSITIVE_INFINITY, 3],\n          [Number.POSITIVE_INFINITY, 3, 1],\n          [Number.POSITIVE_INFINITY, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 5, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 5, 5, 4],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 5, 5, 5],\n        ],\n        high: [\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 2],\n          [Number.POSITIVE_INFINITY, 2, 1],\n          [Number.POSITIVE_INFINITY, 3, 2],\n          [Number.POSITIVE_INFINITY, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 4, 3, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 4, 4, 4],\n        ],\n      },\n      spontaneous: {\n        low: [\n          [Number.POSITIVE_INFINITY],\n          [Number.POSITIVE_INFINITY],\n          [Number.POSITIVE_INFINITY],\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 1, 1],\n          [Number.POSITIVE_INFINITY, 1, 1],\n          [Number.POSITIVE_INFINITY, 2, 1],\n          [Number.POSITIVE_INFINITY, 2, 1, 1],\n          [Number.POSITIVE_INFINITY, 2, 1, 1],\n          [Number.POSITIVE_INFINITY, 2, 2, 1],\n          [Number.POSITIVE_INFINITY, 3, 2, 1, 1],\n          [Number.POSITIVE_INFINITY, 3, 2, 1, 1],\n          [Number.POSITIVE_INFINITY, 3, 2, 2, 1],\n          [Number.POSITIVE_INFINITY, 3, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 3, 2, 1],\n          [Number.POSITIVE_INFINITY, 4, 3, 2, 2],\n          [Number.POSITIVE_INFINITY, 4, 3, 3, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 3, 2],\n        ],\n        med: [\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 2],\n          [Number.POSITIVE_INFINITY, 3],\n          [Number.POSITIVE_INFINITY, 3, 1],\n          [Number.POSITIVE_INFINITY, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 5, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 5, 5, 4],\n          [Number.POSITIVE_INFINITY, 5, 5, 5, 5, 5, 5],\n        ],\n        high: [\n          [Number.POSITIVE_INFINITY, 3],\n          [Number.POSITIVE_INFINITY, 4],\n          [Number.POSITIVE_INFINITY, 5],\n          [Number.POSITIVE_INFINITY, 6, 3],\n          [Number.POSITIVE_INFINITY, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 5, 3],\n          [Number.POSITIVE_INFINITY, 6, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 6, 5, 3],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 5, 3],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 5, 3],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 5, 3],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 6, 5, 3],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 6, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 6, 6, 5, 3],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 6, 6, 6, 4],\n          [Number.POSITIVE_INFINITY, 6, 6, 6, 6, 6, 6, 6, 6, 6],\n        ],\n      },\n      hybrid: {\n        high: [\n          [Number.POSITIVE_INFINITY, 2],\n          [Number.POSITIVE_INFINITY, 3],\n          [Number.POSITIVE_INFINITY, 4],\n          [Number.POSITIVE_INFINITY, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 4, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 4, 4, 4, 4, 4, 4, 4, 4],\n        ],\n      },\n      prestige: {\n        low: [\n          [Number.POSITIVE_INFINITY, 1],\n          [Number.POSITIVE_INFINITY, 2],\n          [Number.POSITIVE_INFINITY, 3],\n          [Number.POSITIVE_INFINITY, 3, 1],\n          [Number.POSITIVE_INFINITY, 4, 2],\n          [Number.POSITIVE_INFINITY, 4, 3],\n          [Number.POSITIVE_INFINITY, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 4, 4, 2],\n          [Number.POSITIVE_INFINITY, 5, 4, 3],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n          [Number.POSITIVE_INFINITY, 5, 4, 3, 1],\n        ],\n      },\n    },\n    spellsPreparedPerDay: {\n      prepared: {\n        low: [\n          [null],\n          [null],\n          [null],\n          [null, 0],\n          [null, 1],\n          [null, 1],\n          [null, 1, 0],\n          [null, 1, 1],\n          [null, 2, 1],\n          [null, 2, 1, 0],\n          [null, 2, 1, 1],\n          [null, 2, 2, 1],\n          [null, 3, 2, 1, 0],\n          [null, 3, 2, 1, 1],\n          [null, 3, 2, 2, 1],\n          [null, 3, 3, 2, 1],\n          [null, 4, 3, 2, 1],\n          [null, 4, 3, 2, 2],\n          [null, 4, 3, 3, 2],\n          [null, 4, 4, 3, 3],\n        ],\n        med: [\n          [3, 1],\n          [4, 2],\n          [4, 3],\n          [4, 3, 1],\n          [4, 4, 2],\n          [5, 4, 3],\n          [5, 4, 3, 1],\n          [5, 4, 4, 2],\n          [5, 5, 4, 3],\n          [5, 5, 4, 3, 1],\n          [5, 5, 4, 4, 2],\n          [5, 5, 5, 4, 3],\n          [5, 5, 5, 4, 3, 1],\n          [5, 5, 5, 4, 4, 2],\n          [5, 5, 5, 5, 4, 3],\n          [5, 5, 5, 5, 4, 3, 1],\n          [5, 5, 5, 5, 4, 4, 2],\n          [5, 5, 5, 5, 5, 4, 3],\n          [5, 5, 5, 5, 5, 5, 4],\n          [5, 5, 5, 5, 5, 5, 5],\n        ],\n        high: [\n          [3, 1],\n          [4, 2],\n          [4, 2, 1],\n          [4, 3, 2],\n          [4, 3, 2, 1],\n          [4, 3, 3, 2],\n          [4, 4, 3, 2, 1],\n          [4, 4, 3, 3, 2],\n          [4, 4, 4, 3, 2, 1],\n          [4, 4, 4, 3, 3, 2],\n          [4, 4, 4, 4, 3, 2, 1],\n          [4, 4, 4, 4, 3, 3, 2],\n          [4, 4, 4, 4, 4, 3, 2, 1],\n          [4, 4, 4, 4, 4, 3, 3, 2],\n          [4, 4, 4, 4, 4, 4, 3, 2, 1],\n          [4, 4, 4, 4, 4, 4, 3, 3, 2],\n          [4, 4, 4, 4, 4, 4, 4, 3, 2, 1],\n          [4, 4, 4, 4, 4, 4, 4, 3, 3, 2],\n          [4, 4, 4, 4, 4, 4, 4, 4, 3, 3],\n          [4, 4, 4, 4, 4, 4, 4, 4, 4, 4],\n        ],\n      },\n      spontaneous: {\n        low: [\n          [2],\n          [3],\n          [4],\n          [4, 2],\n          [5, 3],\n          [5, 4],\n          [6, 4, 2],\n          [6, 4, 3],\n          [6, 5, 4],\n          [6, 5, 4, 2],\n          [6, 5, 4, 3],\n          [6, 6, 5, 4],\n          [6, 6, 5, 4, 2],\n          [6, 6, 5, 4, 3],\n          [6, 6, 6, 5, 4],\n          [6, 6, 6, 5, 4],\n          [6, 6, 6, 5, 4],\n          [6, 6, 6, 6, 5],\n          [6, 6, 6, 6, 5],\n          [6, 6, 6, 6, 5],\n        ],\n        med: [\n          [4, 2],\n          [5, 3],\n          [6, 4],\n          [6, 4, 2],\n          [6, 4, 3],\n          [6, 4, 4],\n          [6, 5, 4, 2],\n          [6, 5, 4, 3],\n          [6, 5, 4, 4],\n          [6, 5, 5, 4, 2],\n          [6, 6, 5, 4, 3],\n          [6, 6, 5, 4, 4],\n          [6, 6, 5, 5, 4, 2],\n          [6, 6, 6, 5, 4, 3],\n          [6, 6, 6, 5, 4, 4],\n          [6, 6, 6, 5, 5, 4, 2],\n          [6, 6, 6, 6, 5, 4, 3],\n          [6, 6, 6, 6, 5, 4, 4],\n          [6, 6, 6, 6, 5, 5, 4],\n          [6, 6, 6, 6, 6, 5, 5],\n        ],\n        high: [\n          [4, 2],\n          [5, 2],\n          [5, 3],\n          [6, 3, 1],\n          [6, 4, 2],\n          [7, 4, 2, 1],\n          [7, 5, 3, 2],\n          [8, 5, 3, 2, 1],\n          [8, 5, 4, 3, 2],\n          [9, 5, 4, 3, 2, 1],\n          [9, 5, 5, 4, 3, 2],\n          [9, 5, 5, 4, 3, 2, 1],\n          [9, 5, 5, 4, 4, 3, 2],\n          [9, 5, 5, 4, 4, 3, 2, 1],\n          [9, 5, 5, 4, 4, 4, 3, 2],\n          [9, 5, 5, 4, 4, 4, 3, 2, 1],\n          [9, 5, 5, 4, 4, 4, 3, 3, 2],\n          [9, 5, 5, 4, 4, 4, 3, 3, 2, 1],\n          [9, 5, 5, 4, 4, 4, 3, 3, 3, 2],\n          [9, 5, 5, 4, 4, 4, 3, 3, 3, 3],\n        ],\n      },\n      hybrid: {\n        high: [\n          [4, 2],\n          [5, 2],\n          [5, 3],\n          [6, 3, 1],\n          [6, 4, 2],\n          [7, 4, 2, 1],\n          [7, 5, 3, 2],\n          [8, 5, 3, 2, 1],\n          [8, 5, 4, 3, 2],\n          [9, 5, 4, 3, 2, 1],\n          [9, 5, 5, 4, 3, 2],\n          [9, 5, 5, 4, 3, 2, 1],\n          [9, 5, 5, 4, 4, 3, 2],\n          [9, 5, 5, 4, 4, 3, 2, 1],\n          [9, 5, 5, 4, 4, 4, 3, 2],\n          [9, 5, 5, 4, 4, 4, 3, 2, 1],\n          [9, 5, 5, 4, 4, 4, 3, 3, 2],\n          [9, 5, 5, 4, 4, 4, 3, 3, 2, 1],\n          [9, 5, 5, 4, 4, 4, 3, 3, 3, 2],\n          [9, 5, 5, 4, 4, 4, 3, 3, 3, 3],\n        ],\n      },\n      prestige: {\n        low: [\n          [null, 2],\n          [null, 3],\n          [null, 4],\n          [null, 4, 2],\n          [null, 4, 3],\n          [null, 4, 4],\n          [null, 5, 4, 2],\n          [null, 5, 4, 3],\n          [null, 5, 4, 4],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n          [null, 5, 5, 4, 2],\n        ],\n      },\n    },\n  },\n\n  /* -------------------------------------------- */\n\n  // Healing Types\n  /**\n   * Types of healing\n   */\n  healingTypes: {\n    healing: \"FFD20.Healing\",\n    temphp: \"FFD20.HealingTemp\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * Character senses options\n   */\n  senses: {\n    bs: \"FFD20.SenseBS\",\n    bse: \"FFD20.SenseBSense\",\n    dv: \"FFD20.SenseDV\",\n    ts: \"FFD20.SenseTS\",\n    tr: \"FFD20.SenseTR\",\n    ll: \"FFD20.SenseLL\",\n    si: \"FFD20.SenseSI\",\n    sid: \"FFD20.SenseSID\",\n    sc: \"FFD20.SenseSC\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * The set of skill which can be trained in FFD20\n   */\n  skills: {\n    /* Acrobatics */ acr: \"FFD20.SkillAcr\",\n    /* Appraise */ apr: \"FFD20.SkillApr\",\n    /* Bluff */ blf: \"FFD20.SkillBlf\",\n    /* Climb */ clm: \"FFD20.SkillClm\",\n    /* craft skills */ crf: \"FFD20.SkillCrf\",\n    /* Diplomacy */ dip: \"FFD20.SkillDip\",\n    /* Disable Device */ dev: \"FFD20.SkillDev\",\n    /* Disguise */ dis: \"FFD20.SkillDis\",\n    /* Drive */ dri: \"FFD20.SkillDri\",\n    /* Escape Artist */ esc: \"FFD20.SkillEsc\",\n    /* Fly */ fly: \"FFD20.SkillFly\",\n    /* Handle Animal */ han: \"FFD20.SkillHan\",\n    /* Heal */ hea: \"FFD20.SkillHea\",\n    /* Intimidate */ int: \"FFD20.SkillInt\",\n    /* Knowledge (arcana) */ kar: \"FFD20.SkillKAr\",\n    /* Knowledge (dungeoneering) */ kdu: \"FFD20.SkillKDu\",\n    /* Knowledge (engineering) */ ken: \"FFD20.SkillKEn\",\n    /* Knowledge (geography) */ kge: \"FFD20.SkillKGe\",\n    /* Knowledge (history) */ khi: \"FFD20.SkillKHi\",\n    /* Knowledge (local) */ klo: \"FFD20.SkillKLo\",\n    /* Knowledge (nature) */ kna: \"FFD20.SkillKNa\",\n    /* Knowledge (nobility) */ kno: \"FFD20.SkillKNo\",\n    /* Knowledge (planes) */ kpl: \"FFD20.SkillKPl\",\n    /* Knowledge (religion) */ kre: \"FFD20.SkillKRe\",\n    /* Knowledge (technology) */ kte: \"FFD20.SkillKTe\",\n    /* Linguistics */ lin: \"FFD20.SkillLin\",\n    /* Navigate */ nav: \"FFD20.SkillNav\",\n    /* Perception */ per: \"FFD20.SkillPer\",\n    /* Perform */ prf: \"FFD20.SkillPrf\",\n    /* Pilot */ pil: \"FFD20.SkillPil\",\n    /* Profession */ pro: \"FFD20.SkillPro\",\n    /* Repair */ rep: \"FFD20.SkillRep\",\n    /* Ride */ rid: \"FFD20.SkillRid\",\n    /* Sense Motive */ sen: \"FFD20.SkillSen\",\n    /* Sleight of Hand */ slt: \"FFD20.SkillSlt\",\n    /* Spellcraft */ spl: \"FFD20.SkillSpl\",\n    /* Stealth */ ste: \"FFD20.SkillSte\",\n    /* Survival */ sur: \"FFD20.SkillSur\",\n    /* Swim */ swm: \"FFD20.SkillSwm\",\n    /* Use Magic Device */ umd: \"FFD20.SkillUMD\",\n  },\n\n  /**\n   * Compendium journal entries containing details about {@link skills}\n   */\n  skillCompendiumEntries: {\n    acr: \"ffd20.skills.HPsdXjjRtKNGFGRc\", // Acrobatics\n    apr: \"ffd20.skills.W5GT9F3euC4aG9zP\", // Appraise\n    blf: \"ffd20.skills.pAB2PYkZO3lsmeaC\", // Bluff\n    clm: \"ffd20.skills.xvua9V5Zggkc77Gt\", // Climb\n    crf: \"ffd20.skills.L6LEhHRrn53cMuhE\", // craft skills\n    dip: \"ffd20.skills.OtfbHJhIQsNzmiTN\", // Diplomacy\n    dev: \"ffd20.skills.CCy1fajKKU3K02iQ\", // Disable Device\n    dis: \"ffd20.skills.lP3L1RXi9q4ha9Gu\", // Disguise\n    dri: \"ffd20.skills.EiaJIZVdGDvLxVll\", // Drive\n    esc: \"ffd20.skills.AOQsMtvLY4V3wFEL\", // Escape Artist\n    fly: \"ffd20.skills.rR877UB1xVd3Z7z1\", // Fly\n    han: \"ffd20.skills.fXauAodbOBHBi7Mj\", // Handle Animal\n    hea: \"ffd20.skills.RtBGttkocvTbySjd\", // Heal\n    int: \"ffd20.skills.ImjhcPmm02QSCbPg\", // Intimidate\n    kar: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (arcana)\n    kdu: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (dungeoneering)\n    ken: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (engineering)\n    kge: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (geography)\n    khi: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (history)\n    klo: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (local)\n    kna: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (nature)\n    kno: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (nobility)\n    kpl: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (planes)\n    kre: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (religion)\n    kte: \"ffd20.skills.ki0QvL0K7u4YuK0O\", // Knowledge (technology)\n    lin: \"ffd20.skills.QXIYXqy6ivNHrDrW\", // Linguistics\n    nav: \"ffd20.skills.qtwTUimJjHnSjLkp\", // Navigate\n    per: \"ffd20.skills.YYmmxDgp0g3ltSUG\", // Perception\n    prf: \"ffd20.skills.HhV5UmaRLTjtB3Xh\", // Perform\n    pil: \"ffd20.skills.rVqzliJeSlYj7ewt\", // Pilot\n    pro: \"ffd20.skills.O7Utk8xKbHYDP7Ot\", // Profession\n    rep: \"ffd20.skills.DWB0xZqtaxOwfd2S\", // Repair\n    rid: \"ffd20.skills.mKO8Q4uMiqpMySOZ\", // Ride\n    sen: \"ffd20.skills.R8HGxGCKayOl15AO\", // Sense Motive\n    slt: \"ffd20.skills.zK0CbvpYLZhTN5Wn\", // Sleight of Hand\n    spl: \"ffd20.skills.uLZI2uWz0uB8UgBc\", // Spellcraft\n    ste: \"ffd20.skills.T6nefKotIb5vKE9h\", // Stealth\n    sur: \"ffd20.skills.TXrxgrB2sQjppZFY\", // Survival\n    swm: \"ffd20.skills.weCPHUuXi9sF5r4E\", // Swim\n    umd: \"ffd20.skills.WR5lekzyLT6T2CFH\", // Use Magic Device\n  },\n\n  /**\n   * An array of {@link skills} that can have arbitrary subskills\n   */\n  arbitrarySkills: [\"crf\", \"prf\", \"pro\"],\n\n  /**\n   * An array of {@link skills} that are considered background skills.\n   */\n  backgroundSkills: [\"apr\", \"crf\", \"han\", \"ken\", \"kge\", \"khi\", \"kno\", \"lin\", \"prf\", \"pro\", \"slt\"],\n\n  /* -------------------------------------------- */\n\n  /**\n   * Valid options for how a spell is prepared\n   */\n  spellPreparationModes: {\n    atwill: \"FFD20.SpellPrepAtWill\",\n    prepared: \"FFD20.SpellPrepPrepared\",\n    spontaneous: \"FFD20.SpellPrepSpontaneous\",\n  },\n\n  classCasterType: {\n    astrologian: \"high\",\n    blackmage: \"high\",\n    bluemage: \"high\",\n    geomancer: \"high\",\n    illusionist: \"high\",\n    necromancer: \"high\",\n    summoner: \"high\",\n    timemage: \"high\",\n    whitemage: \"high\",\n    bard: \"med\",\n    cleric: \"med\",\n    redmage: \"med\",\n    scholar: \"med\",\n    darkpaladin: \"low\",\n    holyknight: \"low\",\n  },\n\n  magicAuraByLevel: {\n    spell: [\n      { power: \"faint\", level: 1 },\n      { power: \"moderate\", level: 4 },\n      { power: \"strong\", level: 7 },\n      { power: \"overwhelming\", level: 10 },\n    ],\n    item: [\n      { power: \"faint\", level: 1 },\n      { power: \"moderate\", level: 6 },\n      { power: \"strong\", level: 12 },\n      { power: \"overwhelming\", level: 21 },\n    ],\n  },\n\n  auraStrengths: {\n    1: \"FFD20.AuraStrength_Faint\",\n    2: \"FFD20.AuraStrength_Moderate\",\n    3: \"FFD20.AuraStrength_Strong\",\n    4: \"FFD20.AuraStrength_Overwhelming\",\n  },\n\n  /* -------------------------------------------- */\n\n  /* -------------------------------------------- */\n\n  // Weapon Types\n  weaponTypes: {\n    simple: {\n      _label: \"FFD20.WeaponTypeSimple\",\n      light: \"FFD20.WeaponPropLight\",\n      \"1h\": \"FFD20.WeaponPropOneHanded\",\n      \"2h\": \"FFD20.WeaponPropTwoHanded\",\n      ranged: \"FFD20.WeaponSubtypeRanged\",\n    },\n    martial: {\n      _label: \"FFD20.WeaponTypeMartial\",\n      light: \"FFD20.WeaponPropLight\",\n      \"1h\": \"FFD20.WeaponPropOneHanded\",\n      \"2h\": \"FFD20.WeaponPropTwoHanded\",\n      ranged: \"FFD20.WeaponSubtypeRanged\",\n    },\n    exotic: {\n      _label: \"FFD20.WeaponTypeExotic\",\n      light: \"FFD20.WeaponPropLight\",\n      \"1h\": \"FFD20.WeaponPropOneHanded\",\n      \"2h\": \"FFD20.WeaponPropTwoHanded\",\n      ranged: \"FFD20.WeaponSubtypeRanged\",\n    },\n    chef: {\n      _label: \"FFD20.WeaponTypeChef\",\n      light: \"FFD20.WeaponPropLight\",\n      \"1h\": \"FFD20.WeaponPropOneHanded\",\n      \"2h\": \"FFD20.WeaponPropTwoHanded\",\n      ranged: \"FFD20.WeaponSubtypeRanged\",\n    },\n    power: {\n      _label: \"FFD20.WeaponTypePower\",\n      light: \"FFD20.WeaponPropLight\",\n      \"1h\": \"FFD20.WeaponPropOneHanded\",\n      \"2h\": \"FFD20.WeaponPropTwoHanded\",\n      ranged: \"FFD20.WeaponSubtypeRanged\",\n    },\n    misc: {\n      _label: \"FFD20.Misc\",\n      splash: \"FFD20.WeaponTypeSplash\",\n      other: \"FFD20.Other\",\n    },\n  },\n\n  // Weapon hold types\n  weaponHoldTypes: {\n    normal: \"FFD20.WeaponHoldTypeNormal\",\n    \"2h\": \"FFD20.WeaponHoldTypeTwoHanded\",\n    oh: \"FFD20.WeaponHoldTypeOffhand\",\n  },\n\n  /**\n   * Weapon groups that a weapon can belong to\n   */\n  weaponGroups: {\n    axes: \"FFD20.WeaponGroupAxes\",\n    bladesHeavy: \"FFD20.WeaponGroupBladesHeavy\",\n    bladesLight: \"FFD20.WeaponGroupBladesLight\",\n    bows: \"FFD20.WeaponGroupBows\",\n    close: \"FFD20.WeaponGroupClose\",\n    crossbows: \"FFD20.WeaponGroupCrossbows\",\n    double: \"FFD20.WeaponGroupDouble\",\n    firearms: \"FFD20.WeaponGroupFirearms\",\n    flails: \"FFD20.WeaponGroupFlails\",\n    hammers: \"FFD20.WeaponGroupHammers\",\n    monk: \"FFD20.WeaponGroupMonk\",\n    natural: \"FFD20.WeaponGroupNatural\",\n    polearms: \"FFD20.WeaponGroupPolearms\",\n    siegeEngines: \"FFD20.WeaponGroupSiegeEngines\",\n    spears: \"FFD20.WeaponGroupSpears\",\n    thrown: \"FFD20.WeaponGroupThrown\",\n    tribal: \"FFD20.WeaponGroupTribal\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * Define the set of weapon property flags which can exist on a weapon\n   */\n  weaponProperties: {\n    blc: \"FFD20.WeaponPropBlocking\",\n    brc: \"FFD20.WeaponPropBrace\",\n    dea: \"FFD20.WeaponPropDeadly\",\n    dst: \"FFD20.WeaponPropDistracting\",\n    dbl: \"FFD20.WeaponPropDouble\",\n    dis: \"FFD20.WeaponPropDisarm\",\n    fin: \"FFD20.WeaponPropFinesse\",\n    frg: \"FFD20.WeaponPropFragile\",\n    grp: \"FFD20.WeaponPropGrapple\",\n    imp: \"FFD20.WeaponPropImprovised\",\n    mnk: \"FFD20.WeaponPropMonk\",\n    nnl: \"FFD20.WeaponPropNonLethal\",\n    prf: \"FFD20.WeaponPropPerformance\",\n    rch: \"FFD20.WeaponPropReach\",\n    snd: \"FFD20.WeaponPropSunder\",\n    thr: \"FFD20.WeaponPropThrown\",\n    trp: \"FFD20.WeaponPropTrip\",\n  },\n\n  /**\n   * The components required for casting a spell\n   */\n  spellComponents: {\n    V: \"FFD20.SpellComponentVerbal\",\n    S: \"FFD20.SpellComponentSomatic\",\n    T: \"FFD20.SpellComponentThought\",\n    E: \"FFD20.SpellComponentEmotion\",\n    M: \"FFD20.SpellComponentMaterial\",\n    F: \"FFD20.SpellComponentFocus\",\n    DF: \"FFD20.SpellComponentDivineFocus\",\n  },\n\n  /**\n   * Spell schools\n   */\n  spellSchools: {\n    crn: \"FFD20.SpellSchoolChronomancy\",\n    drk: \"FFD20.SpellSchoolDark\",\n    div: \"FFD20.SpellSchoolDivination\",\n    ele: \"FFD20.SpellSchoolElemental\",\n    enc: \"FFD20.SpellSchoolEnhancing\",\n    enf: \"FFD20.SpellSchoolEnfeebling\",\n    heal: \"FFD20.SpellSchoolHealing\",\n    ill: \"FFD20.SpellSchoolIllusion\",\n    lit: \"FFD20.SpellSchoolLight\",\n    multi: \"FFD20.multiSchool\",\n    misc: \"FFD20.SpellSchoolMisc\",\n    nec: \"FFD20.SpellSchoolNecromancy\",\n    nel: \"FFD20.SpellSchoolNonElemental\",\n    sum: \"FFD20.SpellSchoolSummoning\",\n    uni: \"FFD20.SpellSchoolUniversal\",\n  },\n\n  /**\n   * Spell multi schools\n   */\n  multiSchools: {\n    blank: \"\",\n    sumhealenc: \"FFD20.SpellSchoolSummoningHealingEnhancing\",\n    sumheal: \"FFD20.SpellSchoolSummoningHealing\",\n    sumenfdrk: \"FFD20.SpellSchoolSummoningEnfeeblingDark\",\n    sumenflit: \"FFD20.SpellSchoolSummoningEnfeeblingLight\",\n    sumenfele: \"FFD20.SpellSchoolSummoningEnfeeblingElemental\",\n    sumenf: \"FFD20.SpellSchoolSummoningEnfeebling\",\n    sumenc: \"FFD20.SpellSchoolSummoningEnhancing\",\n    sumdrk: \"FFD20.SpellSchoolSummoningDark\",\n    sumlit: \"FFD20.SpellSchoolSummoningLight\",\n    sumele: \"FFD20.SpellSchoolSummoningElemental\",\n    sumnel: \"FFD20.SpellSchoolSummoningNonElemental\",\n    crnheal: \"FFD20.SpellSchoolChronomancyHealing\",\n    crnnec: \"FFD20.SpellSchoolChronomancyNecromancy\",\n    crnenf: \"FFD20.SpellSchoolChronomancyEnfeebling\",\n    crnenc: \"FFD20.SpellSchoolChronomancyEnhancing\",\n    healenf: \"FFD20.SpellSchoolHealingEnfeebling\",\n    healenc: \"FFD20.SpellSchoolHealingEnhancing\",\n    illenf: \"FFD20.SpellSchoolIllusionEnfeebling\",\n    illenc: \"FFD20.SpellSchoolIllusionEnhancing\",\n    necenc: \"FFD20.SpellSchoolNecromancyEnhancing\",\n    necenf: \"FFD20.SpellSchoolNecromancyEnfeebling\",\n    necele: \"FFD20.SpellSchoolNecromancyElemental\",\n    necnel: \"FFD20.SpellSchoolNecromancyNonElemental\",\n    enfenc: \"FFD20.SpellSchoolEnfeeblingEnhancing\",\n    enfdrkele: \"FFD20.SpellSchoolEnfeeblingDarkElemental\",\n    enfdrknel: \"FFD20.SpellSchoolEnfeeblingDarkNonElemental\",\n    enfdrk: \"FFD20.SpellSchoolEnfeeblingDark\",\n    enflit: \"FFD20.SpellSchoolEnfeeblingLight\",\n    enfele: \"FFD20.SpellSchoolEnfeeblingElemental\",\n    enfnel: \"FFD20.SpellSchoolEnfeeblingNonElemental\",\n    encdrk: \"FFD20.SpellSchoolEnhancingDark\",\n    enclit: \"FFD20.SpellSchoolEnhancingLight\",\n    encele: \"FFD20.SpellSchoolEnhancingElemental\",\n    encnel: \"FFD20.SpellSchoolEnhancingNonElemental\",\n    drkele: \"FFD20.SpellSchoolDarkElemental\",\n    drknel: \"FFD20.SpellSchoolDarkNonElemental\",\n    litele: \"FFD20.SpellSchoolLightElemental\",\n    litnel: \"FFD20.SpellSchoolLightNonElemental\",\n  },\n\n  /**\n   * Spell levels\n   */\n  spellLevels: {\n    0: \"FFD20.SpellLevel0\",\n    1: \"FFD20.SpellLevel1\",\n    2: \"FFD20.SpellLevel2\",\n    3: \"FFD20.SpellLevel3\",\n    4: \"FFD20.SpellLevel4\",\n    5: \"FFD20.SpellLevel5\",\n    6: \"FFD20.SpellLevel6\",\n    7: \"FFD20.SpellLevel7\",\n    8: \"FFD20.SpellLevel8\",\n    9: \"FFD20.SpellLevel9\",\n  },\n\n  /* -------------------------------------------- */\n\n  /**\n   * Weapon proficiency levels\n   * Each level provides a proficiency multiplier\n   */\n  proficiencyLevels: {\n    \"-4\": \"Not Proficient\",\n    0: \"Proficient\",\n  },\n\n  /* -------------------------------------------- */\n\n  conditionTypes: {\n    antagonized: \"FFD20.CondTypeAntagonized\",\n    berserk: \"FFD20.CondTypeBerserk\",\n    bleed: \"FFD20.CondTypeBleed\",\n    blinded: \"FFD20.CondTypeBlinded\",\n    burning: \"FFD20.CondTypeBurning\",\n    charmed: \"FFD20.CondTypeCharmed\",\n    confused: \"FFD20.CondTypeConfused\",\n    cowering: \"FFD20.CondTypeCowering\",\n    cursed: \"FFD20.CondTypeCursed\",\n    dazed: \"FFD20.CondTypeDazed\",\n    dazzled: \"FFD20.CondTypeDazzled\",\n    deafened: \"FFD20.CondTypeDeafened\",\n    deprotect: \"FFD20.CondTypeDeprotect\",\n    deshell: \"FFD20.CondTypeDeshell\",\n    dimmed: \"FFD20.CondTypeDimmed\",\n    disabled: \"FFD20.CondTypeDisabled\",\n    diseased: \"FFD20.CondTypeDiseased\",\n    doom: \"FFD20.CondTypeDoom\",\n    drenched: \"FFD20.CondTypeDrenched\",\n    energyDrained: \"FFD20.CondTypeEnergyDrained\",\n    entangled: \"FFD20.CondTypeEntangled\",\n    exhausted: \"FFD20.CondTypeExhausted\",\n    fascinated: \"FFD20.CondTypeFascinated\",\n    fatigued: \"FFD20.CondTypeFatigued\",\n    frightened: \"FFD20.CondTypeFrightened\",\n    frog: \"FFD20.CondTypeFrog\",\n    frozen: \"FFD20.CondTypeFrozen\",\n    immobilized: \"FFD20.CondTypeImmobilized\",\n    imperil: \"FFD20.CondTypeImperil\",\n    invisible: \"FFD20.CondTypeInvisible\",\n    mini: \"FFD20.CondTypeMini\",\n    nauseated: \"FFD20.CondTypeNauseated\",\n    panicked: \"FFD20.CondTypePanicked\",\n    paralyzed: \"FFD20.CondTypeParalyzed\",\n    petrified: \"FFD20.CondTypePetrified\",\n    poisoned: \"FFD20.CondTypePoisoned\",\n    prone: \"FFD20.CondTypeProne\",\n    sapped: \"FFD20.CondTypeSapped\",\n    shaken: \"FFD20.CondTypeShaken\",\n    sickened: \"FFD20.CondTypeSickened\",\n    silenced: \"FFD20.CondTypeSilenced\",\n    sleep: \"FFD20.CondTypeSleep\",\n    slow: \"FFD20.CondTypeSlow\",\n    squalled: \"FFD20.CondTypeSqualled\",\n    staggered: \"FFD20.CondTypeStaggered\",\n    static: \"FFD20.CondTypeStatic\",\n    stop: \"FFD20.CondTypeStop\",\n    stunned: \"FFD20.CondTypeStunned\",\n    weighted: \"FFD20.CondTypeWeighted\",\n    unlucky: \"FFD20.CondTypeUnlucky\",\n    zombie: \"FFD20.CondTypeZombie\",\n  },\n\n  conditions: {\n    antagonized: \"FFD20.CondAntagonized\",\n    berserk: \"FFD20.CondBerserk\",\n    bleed: \"FFD20.CondBleed\",\n    ffd20_blind: \"FFD20.CondBlinded\",\n    burning: \"FFD20.CondBurning\",\n    charmed: \"FFD20.CondCharmed\",\n    confused: \"FFD20.CondConfused\",\n    cowering: \"FFD20.CondCowering\",\n    cursed: \"FFD20.CondCursed\",\n    dazed: \"FFD20.CondDazed\",\n    dazzled: \"FFD20.CondDazzled\",\n    ffd20_deaf: \"FFD20.CondDeafened\",\n    deprotect: \"FFD20.CondDeprotect\",\n    deshell: \"FFD20.CondDeshell\",\n    dimmed: \"FFD20.CondDimmed\",\n    disabled: \"FFD20.CondDisabled\",\n    diseased: \"FFD20.CondDiseased\",\n    doom: \"FFD20.CondDoom\",\n    drenched: \"FFD20.CondDrenched\",\n    energyDrained: \"FFD20.CondEnergyDrained\",\n    entangled: \"FFD20.CondEntangled\",\n    exhausted: \"FFD20.CondExhausted\",\n    fascinated: \"FFD20.CondFascinated\",\n    fatigued: \"FFD20.CondFatigued\",\n    frightened: \"FFD20.CondFrightened\",\n    frog: \"FFD20.CondFrog\",\n    frozen: \"FFD20.CondFrozen\",\n    grappled: \"FFD20.CondGrappled\",\n    helpless: \"FFD20.CondHelpless\",\n    immobilized: \"FFD20.CondImmobilized\",\n    imperil: \"FFD20.CondImperil\",\n    incorporeal: \"FFD20.CondIncorporeal\",\n    invisible: \"FFD20.CondInvisible\",\n    mini: \"FFD20.CondMini\",\n    nauseated: \"FFD20.CondNauseated\",\n    panicked: \"FFD20.CondPanicked\",\n    paralyzed: \"FFD20.CondParalyzed\",\n    petrified: \"FFD20.CondPetrified\",\n    pinned: \"FFD20.CondPinned\",\n    poisoned: \"FFD20.CondPoisoned\",\n    ffd20_prone: \"FFD20.CondProne\",\n    sapped: \"FFD20.CondSapped\",\n    shaken: \"FFD20.CondShaken\",\n    sickened: \"FFD20.CondSickened\",\n    silenced: \"FFD20.CondSilenced\",\n    ffd20_sleep: \"FFD20.CondSleep\",\n    slow: \"FFD20.CondSlow\",\n    squalled: \"FFD20.CondSqualled\",\n    staggered: \"FFD20.CondStaggered\",\n    static: \"FFD20.CondStatic\",\n    stop: \"FFD20.CondStop\",\n    stunned: \"FFD20.CondStunned\",\n    unlucky: \"FFD20.CondUnlucky\",\n    weighted: \"FFD20.CondWeighted\",\n    zombie: \"FFD20.CondZombie\",\n  },\n\n  conditionMechanics: {\n    ffd20_blind: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"ac\",\n          modifier: \"penalty\",\n        },\n      ],\n      flags: [\"loseDexToAC\"],\n    },\n    dazzled: {\n      changes: [\n        {\n          formula: -1,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    ffd20_deaf: {\n      changes: [\n        {\n          formula: -4,\n          subTarget: \"init\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    entangled: {\n      changes: [\n        {\n          formula: -4,\n          subTarget: \"dex\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    grappled: {\n      changes: [\n        {\n          formula: -4,\n          subTarget: \"dex\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    helpless: {\n      changes: [\n        {\n          formula: 0,\n          subTarget: \"dex\",\n          modifier: \"untypedPerm\",\n          operator: \"set\",\n          priority: 1001,\n          continuous: true,\n        },\n      ],\n    },\n    ffd20_sleep: {\n      changes: [\n        {\n          formula: 0,\n          subTarget: \"dex\",\n          modifier: \"untypedPerm\",\n          operator: \"set\",\n          priority: 1001,\n          continuous: true,\n        },\n      ],\n    },\n    paralyzed: {\n      changes: [\n        {\n          formula: 0,\n          subTarget: \"dex\",\n          modifier: \"untypedPerm\",\n          operator: \"set\",\n          priority: 1001,\n          continuous: true,\n        },\n        {\n          formula: 0,\n          subTarget: \"str\",\n          modifier: \"untypedPerm\",\n          operator: \"set\",\n          priority: 1001,\n          continuous: true,\n        },\n      ],\n    },\n    ffd20_prone: {\n      changes: [\n        {\n          formula: -4,\n          subTarget: \"mattack\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    pinned: {\n      changes: [\n        {\n          formula: \"min(0, @abilities.dex.mod)\",\n          subTarget: \"dexMod\",\n          modifier: \"untyped\",\n          operator: \"set\",\n          priority: 1001,\n          continuous: true,\n        },\n        {\n          formula: -4,\n          subTarget: \"ac\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -4,\n          subTarget: \"cmd\",\n          modifier: \"penalty\",\n        },\n      ],\n      flags: [\"loseDexToAC\"],\n    },\n    cowering: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"ac\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    shaken: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allSavingThrows\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"skills\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allChecks\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    frightened: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allSavingThrows\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"skills\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allChecks\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    panicked: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allSavingThrows\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"skills\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allChecks\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    sickened: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"wdamage\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allSavingThrows\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"skills\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allChecks\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    nauseated: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"wdamage\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allSavingThrows\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"skills\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"allChecks\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    stunned: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"ac\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    exhausted: {\n      changes: [\n        {\n          formula: -6,\n          subTarget: \"str\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -6,\n          subTarget: \"dex\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    fatigued: {\n      changes: [\n        {\n          formula: -2,\n          subTarget: \"str\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -2,\n          subTarget: \"dex\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n    squeezing: {\n      changes: [\n        {\n          formula: -4,\n          subTarget: \"ac\",\n          modifier: \"penalty\",\n        },\n        {\n          formula: -4,\n          subTarget: \"attack\",\n          modifier: \"penalty\",\n        },\n      ],\n    },\n  },\n\n  conditionTextures: {\n    antagonized: \"systems/ffd20/icons/conditions/antagonized.png\",\n    berserk: \"systems/ffd20/icons/conditions/berserk.png\",\n    bleed: \"systems/ffd20/icons/conditions/bleed.png\",\n    ffd20_blind: \"systems/ffd20/icons/conditions/blind.png\",\n    burning: \"systems/ffd20/icons/conditions/burning.png\",\n    charmed: \"systems/ffd20/icons/conditions/charmed.png\",\n    confused: \"systems/ffd20/icons/conditions/confused.png\",\n    cowering: \"systems/ffd20/icons/conditions/cowering.png\",\n    cursed: \"systems/ffd20/icons/conditions/cursed.png\",\n    dazed: \"systems/ffd20/icons/conditions/dazed.png\",\n    dazzled: \"systems/ffd20/icons/conditions/dazzled.png\",\n    ffd20_deaf: \"systems/ffd20/icons/conditions/deaf.png\",\n    deprotect: \"systems/ffd20/icons/conditions/deprotect.png\",\n    deshell: \"systems/ffd20/icons/conditions/deshell.png\",\n    dimmed: \"systems/ffd20/icons/conditions/dimmed.png\",\n    disabled: \"systems/ffd20/icons/conditions/disabled.png\",\n    diseased: \"systems/ffd20/icons/conditions/diseased.png\",\n    doom: \"systems/ffd20/icons/conditions/doom.png\",\n    drenched: \"systems/ffd20/icons/conditions/drenched.png\",\n    energyDrained: \"systems/ffd20/icons/conditions/energydrained.png\",\n    entangled: \"systems/ffd20/icons/conditions/entangled.png\",\n    exhausted: \"systems/ffd20/icons/conditions/exhausted.png\",\n    fascinated: \"systems/ffd20/icons/conditions/fascinated.png\",\n    fatigued: \"systems/ffd20/icons/conditions/fatigued.png\",\n    frightened: \"systems/ffd20/icons/conditions/frightened.png\",\n    frog: \"systems/ffd20/icons/conditions/frog.png\",\n    frozen: \"systems/ffd20/icons/conditions/frozen.png\",\n    grappled: \"systems/ffd20/icons/conditions/grappled.png\",\n    helpless: \"systems/ffd20/icons/conditions/helpless.png\",\n    immobilized: \"systems/ffd20/icons/conditions/immobilized.png\",\n    imperil: \"systems/ffd20/icons/conditions/imperil.png\",\n    incorporeal: \"systems/ffd20/icons/conditions/incorporeal.png\",\n    invisible: \"systems/ffd20/icons/conditions/invisible.png\",\n    mini: \"systems/ffd20/icons/conditions/mini.png\",\n    nauseated: \"systems/ffd20/icons/conditions/nauseated.png\",\n    panicked: \"systems/ffd20/icons/conditions/fear.png\",\n    paralyzed: \"systems/ffd20/icons/conditions/paralyzed.png\",\n    petrified: \"systems/ffd20/icons/conditions/petrified.png\",\n    pinned: \"systems/ffd20/icons/conditions/pinned.png\",\n    poisoned: \"systems/ffd20/icons/conditions/poisoned.png\",\n    ffd20_prone: \"systems/ffd20/icons/conditions/prone.png\",\n    sapped: \"systems/ffd20/icons/conditions/sapped.png\",\n    shaken: \"systems/ffd20/icons/conditions/shaken.png\",\n    sickened: \"systems/ffd20/icons/conditions/sickened.png\",\n    silenced: \"systems/ffd20/icons/conditions/silenced.png\",\n    ffd20_sleep: \"systems/ffd20/icons/conditions/sleep.png\",\n    slow: \"systems/ffd20/icons/conditions/slow.png\",\n    squalled: \"systems/ffd20/icons/conditions/squalled.png\",\n    staggered: \"systems/ffd20/icons/conditions/staggered.png\",\n    static: \"systems/ffd20/icons/conditions/static.png\",\n    stop: \"systems/ffd20/icons/conditions/stop.png\",\n    stunned: \"systems/ffd20/icons/conditions/stunned.png\",\n    unlucky: \"systems/ffd20/icons/conditions/unlucky.png\",\n    weighted: \"systems/ffd20/icons/conditions/weighted.png\",\n    zombie: \"systems/ffd20/icons/conditions/zombie.png\",\n  },\n\n  buffTypes: {\n    temp: \"FFD20.Temporary\",\n    perm: \"FFD20.Permanent\",\n    item: \"FFD20.Item\",\n    misc: \"FFD20.Misc\",\n  },\n\n  /**\n   * Dictionaries of conditional modifier targets, each with a label and sub-categories\n   */\n  conditionalTargets: {\n    attack: {\n      _label: \"FFD20.AttackRollPlural\",\n      allAttack: \"FFD20.All\",\n      hasteAttack: \"FFD20.Haste\",\n      rapidShotAttack: \"FFD20.RapidShot\",\n    },\n    damage: {\n      _label: \"FFD20.Damage\",\n      allDamage: \"FFD20.All\",\n      hasteDamage: \"FFD20.Haste\",\n      rapidShotDamage: \"FFD20.RapidShot\",\n    },\n    size: {\n      _label: \"FFD20.Size\",\n    },\n    effect: {\n      _label: \"FFD20.Effects\",\n    },\n    misc: {\n      _label: \"FFD20.MiscShort\",\n    },\n  },\n\n  /**\n   * Dictionaries of change/buff targets, each with a label and a category it belongs to,\n   * as well as a sort value that determines this buffTarget's priority when Changes are applied.\n   */\n  buffTargets: {\n    acpA: { label: \"FFD20.ACPArmor\", category: \"misc\", sort: 10000 },\n    acpS: { label: \"FFD20.ACPShield\", category: \"misc\", sort: 11000 },\n    mDexA: { label: \"FFD20.MaxDexArmor\", category: \"misc\", sort: 20000 },\n    mDexS: { label: \"FFD20.MaxDexShield\", category: \"misc\", sort: 21000 },\n    str: { label: \"FFD20.AbilityStr\", category: \"ability\", sort: 30000 },\n    dex: { label: \"FFD20.AbilityDex\", category: \"ability\", sort: 31000 },\n    con: { label: \"FFD20.AbilityCon\", category: \"ability\", sort: 32000 },\n    int: { label: \"FFD20.AbilityInt\", category: \"ability\", sort: 33000 },\n    wis: { label: \"FFD20.AbilityWis\", category: \"ability\", sort: 34000 },\n    cha: { label: \"FFD20.AbilityCha\", category: \"ability\", sort: 35000 },\n    strMod: { label: \"FFD20.AbilityStrMod\", category: \"ability\", sort: 40000 },\n    dexMod: { label: \"FFD20.AbilityDexMod\", category: \"ability\", sort: 41000 },\n    conMod: { label: \"FFD20.AbilityConMod\", category: \"ability\", sort: 42000 },\n    intMod: { label: \"FFD20.AbilityIntMod\", category: \"ability\", sort: 43000 },\n    wisMod: { label: \"FFD20.AbilityWisMod\", category: \"ability\", sort: 44000 },\n    chaMod: { label: \"FFD20.AbilityChaMod\", category: \"ability\", sort: 45000 },\n    skills: { label: \"FFD20.BuffTarAllSkills\", category: \"skills\", sort: 50000 },\n    carryStr: { label: \"FFD20.CarryStrength\", category: \"misc\", sort: 60000 },\n    carryMult: { label: \"FFD20.CarryMultiplier\", category: \"misc\", sort: 61000 },\n    strSkills: { label: \"FFD20.BuffTarStrSkills\", category: \"skills\", sort: 70000 },\n    dexSkills: { label: \"FFD20.BuffTarDexSkills\", category: \"skills\", sort: 71000 },\n    conSkills: { label: \"FFD20.BuffTarConSkills\", category: \"skills\", sort: 72000 },\n    intSkills: { label: \"FFD20.BuffTarIntSkills\", category: \"skills\", sort: 73000 },\n    wisSkills: { label: \"FFD20.BuffTarWisSkills\", category: \"skills\", sort: 74000 },\n    chaSkills: { label: \"FFD20.BuffTarChaSkills\", category: \"skills\", sort: 75000 },\n    allChecks: { label: \"FFD20.BuffTarAllAbilityChecks\", category: \"abilityChecks\", sort: 80000 },\n    strChecks: { label: \"FFD20.BuffTarStrChecks\", category: \"abilityChecks\", sort: 81000 },\n    dexChecks: { label: \"FFD20.BuffTarDexChecks\", category: \"abilityChecks\", sort: 82000 },\n    conChecks: { label: \"FFD20.BuffTarConChecks\", category: \"abilityChecks\", sort: 83000 },\n    intChecks: { label: \"FFD20.BuffTarIntChecks\", category: \"abilityChecks\", sort: 84000 },\n    wisChecks: { label: \"FFD20.BuffTarWisChecks\", category: \"abilityChecks\", sort: 85000 },\n    chaChecks: { label: \"FFD20.BuffTarChaChecks\", category: \"abilityChecks\", sort: 86000 },\n    landSpeed: { label: \"FFD20.SpeedLand\", category: \"speed\", sort: 90000 },\n    climbSpeed: { label: \"FFD20.SpeedClimb\", category: \"speed\", sort: 91000 },\n    swimSpeed: { label: \"FFD20.SpeedSwim\", category: \"speed\", sort: 92000 },\n    burrowSpeed: { label: \"FFD20.SpeedBurrow\", category: \"speed\", sort: 93000 },\n    flySpeed: { label: \"FFD20.SpeedFly\", category: \"speed\", sort: 94000 },\n    allSpeeds: { label: \"FFD20.BuffTarAllSpeeds\", category: \"speed\", sort: 95000 },\n    ac: { label: \"FFD20.BuffTarACGeneric\", category: \"defense\", sort: 100000 },\n    aac: { label: \"FFD20.BuffTarACArmor\", category: \"defense\", sort: 101000 },\n    sac: { label: \"FFD20.BuffTarACShield\", category: \"defense\", sort: 102000 },\n    nac: { label: \"FFD20.BuffTarACNatural\", category: \"defense\", sort: 103000 },\n    tac: { label: \"FFD20.BuffTarACTouch\", category: \"defense\", sort: 104000 },\n    ffac: { label: \"FFD20.BuffTarACFlatFooted\", category: \"defense\", sort: 105000 },\n    attack: { label: \"FFD20.BuffTarAllAttackRolls\", category: \"attack\", sort: 110000 },\n    bab: { label: \"FFD20.BAB\", category: \"attack\", sort: 111000 },\n    \"~attackCore\": { label: \"\", category: \"attack\", sort: 112000 },\n    mattack: { label: \"FFD20.BuffTarMeleeAttack\", category: \"attack\", sort: 113000 },\n    rattack: { label: \"FFD20.BuffTarRangedAttack\", category: \"attack\", sort: 114000 },\n    damage: { label: \"FFD20.BuffTarAllDamageRolls\", category: \"damage\", sort: 120000 },\n    wdamage: { label: \"FFD20.WeaponDamage\", category: \"damage\", sort: 121000 },\n    sdamage: { label: \"FFD20.SpellDamage\", category: \"damage\", sort: 122000 },\n    critConfirm: { label: \"FFD20.CriticalConfirmation\", category: \"attack\", sort: 130000 },\n    allSavingThrows: { label: \"FFD20.BuffTarAllSavingThrows\", category: \"savingThrows\", sort: 140000 },\n    fort: { label: \"FFD20.SavingThrowFort\", category: \"savingThrows\", sort: 141000 },\n    ref: { label: \"FFD20.SavingThrowRef\", category: \"savingThrows\", sort: 142000 },\n    will: { label: \"FFD20.SavingThrowWill\", category: \"savingThrows\", sort: 143000 },\n    cmb: { label: \"FFD20.CMB\", category: \"attack\", sort: 150000 },\n    cmd: { label: \"FFD20.CMD\", category: \"defense\", sort: 151000 },\n    ffcmd: { label: \"FFD20.CMDFlatFooted\", category: \"defense\", sort: 152000 },\n    init: { label: \"FFD20.Initiative\", category: \"misc\", sort: 160000 },\n    mhp: { label: \"FFD20.HitPoints\", category: \"health\", sort: 170000 },\n    wounds: { label: \"FFD20.Wounds\", category: \"health\", sort: 180000 },\n    vigor: { label: \"FFD20.Vigor\", category: \"health\", sort: 181000 },\n    mmp: { label: \"FFD20.ManaPoints\", category: \"health\", sort: 171000 },\n    spellResist: { label: \"FFD20.SpellResistance\", category: \"defense\", sort: 190000 },\n    bonusFeats: { label: \"FFD20.BuffTarBonusFeats\", category: \"misc\", sort: 200000 },\n    bonusSkillRanks: { label: \"FFD20.BuffTarBonusSkillRanks\", category: \"skills\", sort: 210000 },\n    concentration: { label: \"FFD20.Concentration\", category: \"spell\", sort: 220000 },\n    cl: { label: \"FFD20.CasterLevel\", category: \"spell\", sort: 230000 },\n    //limitbreak: { label: \"FFD20.LimitBreak\", category: \"misc \", sort: 240000 },\n  },\n\n  buffTargetCategories: {\n    defense: { label: \"FFD20.Defense\" },\n    savingThrows: { label: \"FFD20.SavingThrowPlural\" },\n    attack: { label: \"FFD20.Attack\" },\n    damage: { label: \"FFD20.Damage\" },\n    ability: { label: \"FFD20.AbilityScore\" },\n    abilityChecks: { label: \"FFD20.BuffTarAbilityChecks\" },\n    health: { label: \"FFD20.Health\" },\n    skills: { label: \"FFD20.Skills\" },\n    skill: { label: \"FFD20.BuffTarSpecificSkill\" },\n    speed: { label: \"FFD20.Speed\" },\n    spell: { label: \"FFD20.BuffTarSpells\" },\n    misc: { label: \"FFD20.Misc\" },\n  },\n\n  contextNoteTargets: {\n    attack: { label: \"FFD20.AttackRollPlural\", category: \"attacks\" },\n    effect: { label: \"FFD20.Effects\", category: \"attacks\" },\n    melee: { label: \"FFD20.Melee\", category: \"attacks\" },\n    meleeWeapon: { label: \"FFD20.MeleeWeapon\", category: \"attacks\" },\n    meleeSpell: { label: \"FFD20.MeleeSpell\", category: \"attacks\" },\n    ranged: { label: \"FFD20.Ranged\", category: \"attacks\" },\n    rangedWeapon: { label: \"FFD20.RangedWeapon\", category: \"attacks\" },\n    rangedSpell: { label: \"FFD20.RangedSpell\", category: \"attacks\" },\n    cmb: { label: \"FFD20.CMB\", category: \"attacks\" },\n    allSavingThrows: { label: \"FFD20.BuffTarAllSavingThrows\", category: \"savingThrows\" },\n    fort: { label: \"FFD20.SavingThrowFort\", category: \"savingThrows\" },\n    ref: { label: \"FFD20.SavingThrowRef\", category: \"savingThrows\" },\n    will: { label: \"FFD20.SavingThrowWill\", category: \"savingThrows\" },\n    skills: { label: \"FFD20.BuffTarAllSkills\", category: \"skills\" },\n    strSkills: { label: \"FFD20.BuffTarStrSkills\", category: \"skills\" },\n    dexSkills: { label: \"FFD20.BuffTarDexSkills\", category: \"skills\" },\n    conSkills: { label: \"FFD20.BuffTarConSkills\", category: \"skills\" },\n    intSkills: { label: \"FFD20.BuffTarIntSkills\", category: \"skills\" },\n    wisSkills: { label: \"FFD20.BuffTarWisSkills\", category: \"skills\" },\n    chaSkills: { label: \"FFD20.BuffTarChaSkills\", category: \"skills\" },\n    allChecks: { label: \"FFD20.BuffTarAllAbilityChecks\", category: \"abilityChecks\" },\n    strChecks: { label: \"FFD20.BuffTarStrChecks\", category: \"abilityChecks\" },\n    dexChecks: { label: \"FFD20.BuffTarDexChecks\", category: \"abilityChecks\" },\n    conChecks: { label: \"FFD20.BuffTarConChecks\", category: \"abilityChecks\" },\n    intChecks: { label: \"FFD20.BuffTarIntChecks\", category: \"abilityChecks\" },\n    wisChecks: { label: \"FFD20.BuffTarWisChecks\", category: \"abilityChecks\" },\n    chaChecks: { label: \"FFD20.BuffTarChaChecks\", category: \"abilityChecks\" },\n    spellEffect: { label: \"FFD20.SpellBuffEffect\", category: \"spell\" },\n    concentration: { label: \"FFD20.Concentration\", category: \"spell\" },\n    cl: { label: \"FFD20.CasterLevel\", category: \"spell\" },\n    ac: { label: \"FFD20.ACNormal\", category: \"defense\" },\n    cmd: { label: \"FFD20.CMD\", category: \"defense\" },\n    sr: { label: \"FFD20.SpellResistance\", category: \"defense\" },\n    init: { label: \"FFD20.Initiative\", category: \"misc\" },\n  },\n\n  contextNoteCategories: {\n    attacks: { label: \"FFD20.Attacks\" },\n    savingThrows: { label: \"FFD20.SavingThrowPlural\" },\n    skills: { label: \"FFD20.Skills\" },\n    skill: { label: \"FFD20.BuffTarSpecificSkill\" },\n    abilityChecks: { label: \"FFD20.BuffTarAbilityChecks\" },\n    spell: { label: \"FFD20.BuffTarSpells\" },\n    defense: { label: \"FFD20.Defense\" },\n    misc: { label: \"FFD20.Misc\" },\n  },\n\n  /**\n   * A list of FFD20's languages\n   */\n  languages: {\n    common: \"FFD20.LanguageCommon\",\n    dwarven: \"FFD20.LanguageDwarven\",\n    elvaan: \"FFD20.LanguageElvaan\",\n    galkan: \"FFD20.LanguageGalkan\",\n    lalafellan: \"FFD20.LanguageLalafellan\",\n    mithran: \"FFD20.LanguageMithran\",\n    moogle: \"FFD20.LanguageMoogle\",\n    aegyllan: \"FFD20.LanguageAegyllan\",\n    albhedian: \"FFD20.LanguageAlbhedian\",\n    banganese: \"FFD20.LanguageBanganese\",\n    burmecian: \"FFD20.LanguageBurmecian\",\n    draconic: \"FFD20.LanguageDraconic\",\n    garif: \"FFD20.LanguageGarif\",\n    guado: \"FFD20.LanguageGuado\",\n    hypello: \"FFD20.LanguageHypello\",\n    lupin: \"FFD20.LanguageLupin\",\n    mandragoran: \"FFD20.LanguageMandragoran\",\n    numish: \"FFD20.LanguageNumish\",\n    qiqirn: \"FFD20.LanguageQiqirn\",\n    queran: \"FFD20.LanguageQueran\",\n    roegadyn: \"FFD20.LanguageRoegadyn\",\n    ronsaur: \"FFD20.LanguageRonsaur\",\n    seeq: \"FFD20.LanguageSeeq\",\n    tonberry: \"FFD20.LanguageTonberry\",\n    vieran: \"FFD20.LanguageVieran\",\n    celestial: \"FFD20.LanguageCelestial\",\n    infernal: \"FFD20.LanguageInfernal\",\n    abyssal: \"FFD20.LanguageAbyssal\",\n    aquan: \"FFD20.LanguageAquan\",\n    auran: \"FFD20.LanguageAuran\",\n    auroran: \"FFD20.LanguageAuroran\",\n    enochian: \"FFD20.LanguageEnochian\",\n    ignan: \"FFD20.LanguageIgnan\",\n    terran: \"FFD20.LanguageTerran\",\n    thorian: \"FFD20.LanguageThorian\",\n    umbran: \"FFD20.LanguageUmbran\",\n    amaljaa: \"FFD20.LanguageAmaljaa\",\n    antican: \"FFD20.LanguageAntican\",\n    goblin: \"FFD20.LanguageGoblin\",\n    kojin: \"FFD20.LanguageKojin\",\n    orcish: \"FFD20.LanguageOrcish\",\n    quadav: \"FFD20.LanguageQuadav\",\n    sahagin: \"FFD20.LanguageSahagin\",\n    sylvan: \"FFD20.LanguageSylvan\",\n    undercommon: \"FFD20.LanguageUndercommon\",\n    vanu: \"FFD20.LanguageVanu\",\n    yagudo: \"FFD20.LanguageYagudo\",\n  },\n\n  /**\n   * Creature types\n   */\n  creatureTypes: {\n    aberration: \"FFD20.CreatureTypeAberration\",\n    animal: \"FFD20.CreatureTypeAnimal\",\n    construct: \"FFD20.CreatureTypeConstruct\",\n    dragon: \"FFD20.CreatureTypeDragon\",\n    fey: \"FFD20.CreatureTypeFey\",\n    humanoid: \"FFD20.CreatureTypeHumanoid\",\n    magicalBeast: \"FFD20.CreatureTypeMagicalBeast\",\n    monstrousHumanoid: \"FFD20.CreatureTypeMonstrousHumanoid\",\n    ooze: \"FFD20.CreatureTypeOoze\",\n    outsider: \"FFD20.CreatureTypeOutsider\",\n    plant: \"FFD20.CreatureTypePlant\",\n    undead: \"FFD20.CreatureTypeUndead\",\n    vermin: \"FFD20.CreatureTypeVermin\",\n  },\n\n  spellRangeFormulas: {\n    close: \"25 + floor(@cl / 2) * 5\",\n    medium: \"100 + @cl * 10\",\n    long: \"400 + @cl * 40\",\n  },\n\n  /**\n   * An array containing the damage dice progression for size adjustments\n   */\n  sizeDie: [\n    \"1\",\n    \"1d2\",\n    \"1d3\",\n    \"1d4\",\n    \"1d6\",\n    \"1d8\",\n    \"1d10\",\n    \"2d6\",\n    \"2d8\",\n    \"3d6\",\n    \"3d8\",\n    \"4d6\",\n    \"4d8\",\n    \"6d6\",\n    \"6d8\",\n    \"8d6\",\n    \"8d8\",\n    \"12d6\",\n    \"12d8\",\n    \"16d6\",\n    \"16d8\",\n  ],\n\n  /**\n   * Arrays of Character Level XP Requirements by XP track\n   */\n  // prettier-ignore\n  CHARACTER_EXP_LEVELS: {\n    slow: [\n      0, 3000, 7500, 14000, 23000, 35000, 53000, 77000, 115000, 160000, 235000, 330000, 475000, 665000, 955000, 1350000, 1900000, 2700000, 3850000, 5350000, 8350000, 14350000, 26350000, 50350000, 98350000, 194350000, 386350000, 770350000, 1538350000, 3074350000,\n    ],\n    medium: [\n      0, 2000, 5000, 9000, 15000, 23000, 35000, 51000, 75000, 105000, 155000, 220000, 315000, 445000, 635000, 890000, 1300000, 1800000, 2550000, 3600000, 5700000, 9900000, 18300000, 35100000, 68700000, 135900000, 270300000, 539100000, 1076700000, 2151900000,\n    ],\n    fast: [\n      0, 1300, 3300, 6000, 10000, 15000, 23000, 34000, 50000, 71000, 105000, 145000, 210000, 295000, 425000, 600000, 850000, 1200000, 1700000, 2400000, 3800000, 6600000, 12200000, 23400000, 45800000, 90600000, 180200000, 359400000, 717800000, 1434600000,\n    ],\n  },\n\n  /**\n   * An array of Challenge Rating XP Levels\n   */\n  // prettier-ignore\n  CR_EXP_LEVELS: [\n    200, 400, 600, 800, 1200, 1600, 2400, 3200, 4800, 6400, 9600, 12800, 19200, 25600, 38400, 51200, 76800, 102400, 153600, 204800, 307200, 409600, 614400, 819200, 1228800, 1638400, 2457600, 3276800, 4915200, 6553600, 9830400,\n  ],\n\n  temporaryRollDataFields: {\n    actor: [\n      \"d20\",\n      \"attackBonus\",\n      \"damageBonus\",\n      \"pointBlankBonus\",\n      \"rapidShotPenalty\",\n      \"powerAttackBonus\",\n      \"powerAttackPenalty\",\n      \"conditionals\",\n      \"concentrationBonus\",\n      \"formulaBonus\",\n      \"dcBonus\",\n      \"chargeCostBonus\",\n      \"chargeCost\",\n      \"sizeBonus\",\n      \"bonus\",\n      \"critMult\",\n      \"ablMult\",\n      \"ablDamage\",\n      \"cl\",\n      \"sl\",\n      \"classLevel\",\n      \"ablMod\",\n      \"item\",\n      \"action\",\n      \"level\",\n      \"mod\",\n    ],\n  },\n\n  keepItemLinksOnCopy: [\"classAssociations\"],\n  classSubTypes: {\n    none: \"FFD20.None\",\n    core: \"FFD20.ClassSubTypeCore\",\n    coreArc: \"FFD20.ClassSubTypeCoreArc\",\n    base: \"FFD20.ClassSubTypeBase\",\n    baseArc: \"FFD20.ClassSubTypeBaseArc\",\n    hybrid: \"FFD20.ClassSubTypeHybrid\",\n    hybridArc: \"FFD20.ClassSubTypeHybridArc\",\n  },\n\n  countforexp: {\n    exp: \"FFD20.ClassExp\",\n    noExp: \"FFD20.ClassNoExp\",\n  },\n\n  classCastingStats: {\n    noncaster: \"FFD20.NonCaster\",\n    int: \"FFD20.AbilityShortInt\",\n    wis: \"FFD20.AbilityShortWis\",\n    cha: \"FFD20.AbilityShortCha\",\n    intAndWis: \"FFD20.AbilityShortIntAndWis\",\n  },\n\n  classBaseMPTypes: {\n    noncaster: \"FFD20.NonCaster\",\n    halfCaster: \"FFD20.HalfCaster\",\n    dimPacman: \"FFD20.DimPacman\",\n    pacman: \"FFD20.Pacman\",\n    dimFullCaster: \"FFD20.DimFullCaster\",\n    fullCaster: \"FFD20.FullCaster\",\n    advFullCaster: \"FFD20.AdvFullCaster\",\n  },\n\n  // Current Max Spell Level based on lvl\n  ClassSpellLvlProgression: {\n    noncaster: \"0\",\n    halfCaster: \"min(floor(max(@level - 3 ,0) / 3),4)\",\n    dimPacman: \"min(floor((@level + 2) / 3),6)\",\n    pacman: \"min(floor((@level + 2) / 3),6)\",\n    dimFullCaster: \"min(floor((@level + 1) / 2),9)\",\n    fullCaster: \"min(floor((@level + 1) / 2),9)\",\n    advFullCaster: \"min(floor((@level + 1) / 2),9)\",\n  },\n\n  // Character MP from levels TODO add other mp bases\n  // level        1 2 3 4 5  6  7  8  9 10 11 12 13 14 15 16 17  18  19  20\n  classMPlevels: {\n    noncaster: [0],\n    halfCaster: [0, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 12, 14, 16, 19, 22, 25, 29, 33],\n    dimPacman: [1, 2, 3, 4, 5, 6, 8, 10, 12, 15, 18, 21, 25, 29, 33, 38, 43, 48, 53, 58],\n    pacman: [2, 3, 4, 5, 6, 8, 10, 13, 16, 20, 24, 29, 34, 39, 45, 51, 57, 64, 71, 79],\n    dimFullCaster: [2, 3, 4, 5, 6, 8, 11, 15, 20, 24, 29, 35, 42, 49, 56, 65, 74, 83, 92, 101],\n    fullCaster: [3, 4, 5, 6, 8, 11, 15, 20, 26, 32, 39, 47, 56, 65, 75, 86, 98, 110, 122, 135],\n    advFullCaster: [4, 6, 8, 9, 14, 17, 25, 30, 41, 47, 60, 68, 84, 93, 111, 124, 143, 155, 167, 180],\n  },\n\n  // Character MP from stat\n  // stat mod 0 1 2 3  4  5  6  7  8  9 10 11 12  13  14  15  16  17\n  classMPStatsBonus: {\n    1: [0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5],\n    2: [0, 1, 3, 3, 3, 4, 6, 6, 6, 7, 9, 9, 9, 10, 12, 12, 12, 13],\n    3: [0, 1, 3, 6, 6, 7, 9, 12, 12, 13, 15, 18, 18, 19, 21, 24, 24, 25],\n    4: [0, 1, 3, 6, 10, 11, 13, 16, 20, 21, 23, 26, 30, 31, 33, 36, 40, 41],\n    5: [0, 1, 3, 6, 10, 16, 18, 21, 25, 31, 33, 36, 40, 46, 48, 51, 55, 61],\n    6: [0, 1, 3, 6, 10, 16, 24, 27, 31, 37, 45, 48, 52, 58, 66, 69, 73, 79],\n    7: [0, 1, 3, 6, 10, 16, 24, 34, 38, 44, 52, 62, 66, 72, 80, 90, 94, 100],\n    8: [0, 1, 3, 6, 10, 16, 24, 34, 46, 52, 60, 70, 82, 88, 96, 106, 118, 124],\n    9: [0, 1, 3, 6, 10, 16, 24, 34, 46, 61, 69, 79, 91, 106, 114, 124, 136, 151],\n  },\n\n  // to calculate auto mp\n  classBaseMPauto: {\n    no: \"FFD20.No\",\n    yes: \"FFD20.Yes\",\n    half: \"FFD20.Half\",\n  },\n\n  materiaRarity: {\n    common: \"FFD20.MateriaRarityCommon\",\n    uncommon: \"FFD20.MateriaRarityUncommon\",\n    rare: \"FFD20.MateriaRarityRare\",\n    legendary: \"FFD20.MateriaRarityLegendary\",\n  },\n  materiaRarityMath: {\n    common: 1,\n    uncommon: 2,\n    rare: 3,\n    legendary: 4,\n  },\n  materiaSlot: {\n    unslotted: \"FFD20.MateriaSlotUnslotted\",\n    weapon: \"FFD20.MateriaSlotWeapon\",\n    shield: \"FFD20.MateriaSlotShield\",\n    armor: \"FFD20.MateriaSlotArmor\",\n    other: \"FFD20.MateriaSlotOther\",\n  },\n  materiaAdvancement: {\n    common: [0, 0, 5000, 10000, 20000],\n    uncommon: [0, 5000, 10000, 20000, 40000],\n    rare: [0, 7500, 15000, 30000, 60000],\n    legendary: [0, 10000, 20000, 40000, 80000],\n  },\n};\n\n/**\n * Non-FFD20 config entries\n *\n * These keys are merged into {@link CONFIG} using {@link mergeObject}.\n */\nexport const CONFIG_OVERRIDES = {\n  \"Combat.initiative.decimals\": 2,\n  \"debug.roll\": false,\n  \"debug.template\": false,\n};\n","export class HealthConfig extends FormApplication {\n  constructor(object, options) {\n    super(object || HealthConfig.defaultSettings, options);\n  }\n\n  /** Collect data for the template. @override */\n  async getData() {\n    let settings = await game.settings.get(\"ffd20\", \"healthConfig\");\n    settings = mergeObject(HealthConfig.defaultSettings, settings);\n    return settings;\n  }\n\n  /** @override */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      title: game.i18n.localize(\"SETTINGS.ffd20HealthConfigName\"),\n      id: \"health-config\",\n      template: \"systems/ffd20/templates/settings/health.hbs\",\n      width: 480,\n      height: \"auto\",\n      tabs: [\n        {\n          navSelector: \".tabs\",\n          contentSelector: \".tabbed\",\n          initial: \"base\",\n        },\n      ],\n    });\n  }\n\n  static get defaultSettings() {\n    return {\n      hitdice: {\n        PC: { auto: false, rate: 0.5, maximized: 1 },\n        NPC: { auto: false, rate: 0.5, maximized: 0 },\n        Racial: { auto: false, rate: 0.5, maximized: 0 },\n      },\n      hitdieOptions: [\"Compute\", \"Rate\", \"Maximized\"],\n      rounding: \"up\",\n      continuity: \"discrete\",\n      variants: {\n        pc: { useWoundsAndVigor: false, useWoundThresholds: 0, allowWoundThresholdOverride: false },\n        npc: { useWoundsAndVigor: false, useWoundThresholds: 0, allowWoundThresholdOverride: true },\n      },\n    };\n  }\n\n  /**\n   * Activate the default set of listeners for the Document sheet These listeners handle basic stuff like form submission or updating images.\n   *\n   * @override\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find('button[name=\"reset\"]').click(this._onReset.bind(this));\n    html.find('button[name=\"submit\"]').click(this._onSubmit.bind(this));\n  }\n\n  /**\n   * Handle button click to reset default settings\n   *\n   * @param event {Event}   The initial button click event\n   * @private\n   */\n  async _onReset(event) {\n    event.preventDefault();\n    await game.settings.set(\"ffd20\", \"healthConfig\", HealthConfig.defaultSettings);\n    ui.notifications.info(`Reset Pathfinder health configuration.`);\n    return this.render();\n  }\n\n  _onSubmit(event) {\n    super._onSubmit(event);\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated.\n   *\n   * @override\n   */\n  async _updateObject(event, formData) {\n    const settings = expandObject(formData);\n    // Some mild sanitation for the numeric values.\n    for (const hd of Object.values(settings.hitdice)) {\n      hd.rate = Math.max(0, Math.min(hd.rate, 100));\n      hd.maximized = Math.max(0, Math.min(Math.floor(hd.maximized), 100));\n    }\n\n    settings.variants.npc.allowWoundThresholdOverride = true; // HACK: This setting vanishes otherwise\n\n    await game.settings.set(\"ffd20\", \"healthConfig\", settings);\n    ui.notifications.info(\"Updated Pathfinder health configuration.\");\n  }\n}\n","export class ExperienceConfig extends FormApplication {\n  constructor(object, options) {\n    super(object || ExperienceConfig.defaultSettings, options);\n\n    this._init = false;\n  }\n\n  /** Collect data for the template. @override */\n  async getData() {\n    const data = {};\n\n    if (!this._init) {\n      const settings = await game.settings.get(\"ffd20\", \"experienceConfig\");\n      this._settings = mergeObject(this.constructor.defaultSettings, settings);\n      this._init = true;\n    }\n    data.settings = this._settings;\n\n    // Custom experience track booleans\n    data.hasCustomFormula = data.settings.track === \"customFormula\";\n\n    return data;\n  }\n\n  /** @override */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      title: game.i18n.localize(\"FFD20.ExperienceConfigName\"),\n      id: \"experience-config\",\n      template: \"systems/ffd20/templates/settings/experience.hbs\",\n      width: 560,\n      height: \"auto\",\n    });\n  }\n\n  static get defaultSettings() {\n    return {\n      track: \"medium\",\n      disableExperienceTracking: false,\n      openXpDistributor: true,\n      custom: {\n        formula: \"\",\n      },\n    };\n  }\n\n  /**\n   * Activate the default set of listeners for the Document sheet These listeners handle basic stuff like form submission or updating images.\n   *\n   * @override\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find('button[type=\"submit\"]').click(this._onButtonSubmit.bind(this));\n  }\n\n  _onButtonSubmit(event) {\n    this._onSubmit(event);\n  }\n\n  _onChangeInput(event) {\n    super._onChangeInput(event);\n\n    this._updateApplicationSettings();\n  }\n\n  _updateApplicationSettings() {\n    // Update settings and re-render\n    this._settings = mergeObject(this._settings, expandObject(this._getSubmitData()));\n    this.render();\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated.\n   *\n   * @override\n   */\n  async _updateObject(event, formData) {\n    const settings = mergeObject(this._settings, expandObject(formData), { inplace: false });\n    // Some mild sanitation for the numeric values.\n    await game.settings.set(\"ffd20\", \"experienceConfig\", settings);\n    ui.notifications.info(\"Updated Pathfinder experience configuration.\");\n  }\n}\n","export class AccessibilityConfig extends FormApplication {\n  constructor(object, options) {\n    super(object || AccessibilityConfig.defaultSettings, options);\n\n    this._init = false;\n  }\n\n  /** Collect data for the template. @override */\n  async getData() {\n    const data = {};\n\n    if (!this._init) {\n      const settings = await game.settings.get(\"ffd20\", \"accessibilityConfig\");\n      this._settings = mergeObject(this.constructor.defaultSettings, settings);\n      this._init = true;\n    }\n    data.settings = this._settings;\n\n    return data;\n  }\n\n  /** @override */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      title: game.i18n.localize(\"FFD20.AccessibilityConfigName\"),\n      id: \"accessibility-config\",\n      template: \"systems/ffd20/templates/settings/accessibility.hbs\",\n      width: 560,\n      height: \"auto\",\n    });\n  }\n\n  static get defaultSettings() {\n    return {};\n  }\n\n  /**\n   * Activate the default set of listeners for the Document sheet These listeners handle basic stuff like form submission or updating images.\n   *\n   * @override\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find('button[type=\"submit\"]').click(this._onButtonSubmit.bind(this));\n  }\n\n  _onButtonSubmit(event) {\n    this._onSubmit(event);\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated.\n   *\n   * @override\n   */\n  async _updateObject(event, formData) {\n    const settings = expandObject(formData);\n    // Some mild sanitation for the numeric values.\n    await game.settings.set(\"ffd20\", \"accessibilityConfig\", settings);\n    ui.notifications.info(\"Updated Pathfinder accessibility configuration.\");\n  }\n}\n","export class TooltipWorldConfig extends FormApplication {\n  constructor(object, options) {\n    super(object || TooltipWorldConfig.defaultSettings, options);\n\n    this._cachedData = null;\n  }\n\n  getData() {\n    const result = {};\n\n    // Get settings\n    let settings = game.settings.get(\"ffd20\", \"tooltipWorldConfig\");\n    settings = mergeObject(this.constructor.defaultSettings, settings);\n    result.data = settings;\n\n    return result;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      title: game.i18n.localize(\"FFD20.TooltipWorldConfigName\"),\n      id: \"tooltip-world-config\",\n      template: \"systems/ffd20/templates/settings/tooltip_world.hbs\",\n      width: 720,\n      height: \"auto\",\n    });\n  }\n\n  static get defaultSettings() {\n    return {\n      disable: false,\n      portrait: {\n        hide: false,\n      },\n      hideHeld: true,\n      hideArmor: true,\n      hideBuffs: true,\n      hideConditions: false,\n      hideClothing: true,\n      hideActorName: true,\n      hideActorNameReplacement: \"???\",\n    };\n  }\n\n  activateListeners(html) {\n    html.find('button[name=\"submit\"]').click(this._onSubmit.bind(this));\n    html.find('button[name=\"reset\"]').click(this._onReset.bind(this));\n  }\n\n  async _onReset(event) {\n    event.preventDefault();\n    await game.settings.set(\"ffd20\", \"tooltipWorldConfig\", this.constructor.defaultSettings);\n    ui.notifications.info(game.i18n.localize(\"FFD20.TooltipConfigResetInfo\"));\n    return this.render();\n  }\n\n  async _updateObject(event, formData) {\n    const settings = expandObject(formData);\n\n    await game.settings.set(\"ffd20\", \"tooltipWorldConfig\", settings);\n    ui.notifications.info(game.i18n.localize(\"FFD20.TooltipConfigUpdateInfo\"));\n  }\n}\n","import { TooltipWorldConfig } from \"./tooltip_world.mjs\";\n\nexport class TooltipConfig extends FormApplication {\n  constructor(object, options) {\n    super(object || TooltipConfig.defaultSettings, options);\n\n    this._cachedData = null;\n  }\n\n  getData() {\n    if (this._cachedData) return this._cachedData;\n\n    const canvasRect = canvas.app.view.getBoundingClientRect();\n    const result = {\n      screen: {\n        width: canvasRect.width,\n        height: canvasRect.height,\n        halfWidth: Math.floor(canvasRect.width / 2),\n        halfHeight: Math.floor(canvasRect.height / 2),\n      },\n      isGM: game.user.isGM,\n    };\n\n    // Prepare preview data\n    {\n      const p = {\n        width: 320,\n        height: 320,\n        tooltip: {\n          width: 80,\n          height: 48,\n        },\n      };\n\n      const r1 = result.screen.width / result.screen.height;\n      const r2 = result.screen.height / result.screen.width;\n\n      if (r1 > r2) {\n        p.height = Math.ceil(p.height * r2);\n      } else if (r2 > r1) {\n        p.width = Math.ceil(p.width * r1);\n      }\n\n      result.preview = p;\n    }\n\n    // Get settings\n    let settings = game.settings.get(\"ffd20\", \"tooltipConfig\");\n    settings = mergeObject(this.constructor.defaultSettings, settings);\n    result.data = settings;\n\n    // Get hide key\n    result.hideKey = game.i18n.localize(\"FFD20.Key_Control\");\n\n    this._cachedData = result;\n    return result;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      title: game.i18n.localize(\"FFD20.TooltipConfigName\"),\n      id: \"tooltip-config\",\n      template: \"systems/ffd20/templates/settings/tooltip.hbs\",\n      width: 720,\n      height: \"auto\",\n    });\n  }\n\n  static get defaultSettings() {\n    return {\n      disable: false,\n      anchor: {\n        x: 1,\n        y: 1,\n      },\n      offset: {\n        x: 0,\n        y: 0,\n      },\n      onMouse: false,\n      portrait: {\n        hide: false,\n        maxSize: {\n          width: 280,\n          height: 280,\n        },\n      },\n      hideWithoutKey: false,\n    };\n  }\n\n  activateListeners(html) {\n    html.find(\".immediate-change\").change(this._handleImmediateChange.bind(this));\n\n    html.find(\"button.world-settings\").click(this._openWorldSettings.bind(this));\n\n    html.find('button[name=\"submit\"]').click(this._onSubmit.bind(this));\n    html.find('button[name=\"reset\"]').click(this._onReset.bind(this));\n  }\n\n  _handleImmediateChange(event) {\n    const el = event.currentTarget;\n    const key = el.name;\n    if (!key) return;\n\n    let value;\n    if (el.tagName.toUpperCase() === \"INPUT\") {\n      value = el.value;\n      if (el.type === \"checkbox\") value = el.checked === true ? true : false;\n    } else {\n      value = el.innerHTML;\n    }\n    if (el.dataset?.dtype === \"Boolean\") value = Boolean(value);\n    else if (el.dataset?.dtype === \"Number\") value = parseFloat(value);\n\n    setProperty(this._cachedData, `data.${key}`, value);\n    this.render();\n  }\n\n  _openWorldSettings(event) {\n    if (!game.user.can(\"SETTINGS_MODIFY\")) {\n      ui.notifications.error(\"FFD20.ErrorGenericPermission\");\n      return;\n    }\n\n    new TooltipWorldConfig().render(true);\n  }\n\n  async _onReset(event) {\n    event.preventDefault();\n    await game.settings.set(\"ffd20\", \"tooltipConfig\", this.constructor.defaultSettings);\n    this._cachedData = null;\n    ui.notifications.info(game.i18n.localize(\"FFD20.TooltipConfigResetInfo\"));\n    return this.render();\n  }\n\n  async _updateObject(event, formData) {\n    const settings = expandObject(formData);\n\n    await game.settings.set(\"ffd20\", \"tooltipConfig\", settings);\n    ui.notifications.info(game.i18n.localize(\"FFD20.TooltipConfigUpdateInfo\"));\n  }\n}\n","export class TooltipFFD20 extends Application {\n  constructor() {\n    super();\n\n    this.mousePos = {\n      x: 0,\n      y: 0,\n    };\n    document.addEventListener(\"mousemove\", (event) => {\n      this.mousePos.x = event.clientX;\n      this.mousePos.y = event.clientY;\n      if (this.onMouse && !this.hidden) this._setPosition();\n    });\n\n    this.objects = [];\n\n    this.forceHideGMInfo = false;\n    this.forceHide = false;\n\n    this.lock = {\n      new: false,\n      old: false,\n    };\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      template: \"systems/ffd20/templates/hud/tooltip.hbs\",\n      popOut: false,\n    });\n  }\n\n  get config() {\n    return game.settings.get(\"ffd20\", \"tooltipConfig\");\n  }\n\n  get worldConfig() {\n    return game.settings.get(\"ffd20\", \"tooltipWorldConfig\");\n  }\n\n  get anchor() {\n    return this.config.anchor;\n  }\n\n  get offset() {\n    return this.config.offset;\n  }\n\n  get onMouse() {\n    return this.config.onMouse;\n  }\n\n  get hidden() {\n    return this.element[0]?.style.visibility === \"hidden\";\n  }\n\n  bind(object) {\n    if (this.lock.new) return;\n\n    if (this.objects.indexOf(object) === -1) {\n      this.objects.push(object);\n      this.render(true);\n    }\n  }\n\n  unbind(object) {\n    if (this.lock.old) return;\n\n    const idx = this.objects.indexOf(object);\n    if (idx >= 0) {\n      this.objects.splice(idx, 1);\n      if (this.objects.length === 0) {\n        this.hide();\n      } else {\n        this.render();\n      }\n    }\n  }\n\n  clearBinds() {\n    this.objects = [];\n    this.hide();\n  }\n\n  get object() {\n    return this.objects[0];\n  }\n\n  async getData() {\n    if (typeof this.object === \"string\") {\n      return { stringContent: this.object };\n    } else if (this.object instanceof Token) {\n      return {\n        actorData: this.getTokenData(this.object),\n      };\n    } else if (this.object instanceof Actor) {\n      return {\n        actorData: this.getActorData(this.object),\n      };\n    }\n\n    return {};\n  }\n\n  getTokenData(token) {\n    const data = this.getActorData(token.actor);\n    if (!data) return null;\n\n    data.name = token.name;\n    if (\n      (game.user.isGM && this.forceHideGMInfo) ||\n      (!game.user.isGM && !token.actor.testUserPermission(game.user, \"OBSERVER\"))\n    ) {\n      const tooltipName = getProperty(token.actor, \"system.details.tooltip.name\");\n      data.name = tooltipName || token.name;\n\n      if (\n        (this.worldConfig.hideActorName === true && !tooltipName) ||\n        getProperty(token.actor, \"system.details.tooltip.hideName\") === true\n      ) {\n        data.name = this.worldConfig.hideActorNameReplacement || \"???\";\n      }\n    }\n\n    return data;\n  }\n\n  getActorData(actor) {\n    if (!actor) return null;\n\n    const data = {\n      data: actor.system,\n      name: actor.name,\n    };\n\n    if (!(game.user.isGM && !this.forceHideGMInfo)) {\n      data.name = getProperty(actor, \"system.details.tooltip.name\") || actor.name;\n    }\n\n    data.isOwner = game.user.isGM || actor.isOwner;\n    if (!data.isOwner) data.name = \"???\";\n    this.getPortrait(data, actor.img);\n\n    // Get conditions\n    if (\n      (game.user.isGM && !this.forceHideGMInfo) ||\n      actor.isOwner ||\n      (!getProperty(actor, \"system.details.tooltip.hideConditions\") && !getProperty(this.worldConfig, \"hideConditions\"))\n    ) {\n      const conditions = getProperty(actor, \"system.attributes.conditions\") || {};\n      for (const [ck, cv] of Object.entries(conditions)) {\n        if (cv === true) {\n          data.conditions = data.conditions || [];\n          data.conditions.push({\n            label: CONFIG.FFD20.conditions[ck],\n            icon: CONFIG.FFD20.conditionTextures[ck],\n          });\n        }\n      }\n    }\n\n    // Get buffs\n    if (\n      (game.user.isGM && !this.forceHideGMInfo) ||\n      actor.isOwner ||\n      (!getProperty(actor, \"system.details.tooltip.hideBuffs\") && !getProperty(this.worldConfig, \"hideBuffs\"))\n    ) {\n      const buffs = actor.items.filter((i) => i.type === \"buff\" && i.isActive && !i.system.hideFromToken);\n      for (const b of buffs) {\n        data.buffs = data.buffs || [];\n        data.buffs.push({\n          label: b.name,\n          icon: b.img,\n          level: b.system.level,\n        });\n      }\n    }\n\n    // Get held items\n    if (\n      (game.user.isGM && !this.forceHideGMInfo) ||\n      actor.isOwner ||\n      (!getProperty(actor, \"system.details.tooltip.hideHeld\") && !getProperty(this.worldConfig, \"hideHeld\"))\n    ) {\n      const held = actor.items.filter((i) => {\n        if (![\"weapon\", \"equipment\"].includes(i.type)) return false;\n        if (!i.system.equipped) return false;\n        if (i.type === \"equipment\") {\n          if (i.system.equipmentType !== \"shield\") return false;\n        }\n        return true;\n      });\n\n      for (const i of held) {\n        data.held = data.held || [];\n        data.held.push({\n          label: i.getName(this.forceHideGMInfo),\n          icon: i.img,\n        });\n      }\n    }\n\n    // Get armor\n    if (\n      (game.user.isGM && !this.forceHideGMInfo) ||\n      actor.isOwner ||\n      (!getProperty(actor, \"system.details.tooltip.hideArmor\") && !getProperty(this.worldConfig, \"hideArmor\"))\n    ) {\n      const armor = actor.items.filter((i) => {\n        if (i.type !== \"equipment\") return false;\n        if (!i.system.equipped) return false;\n        if (i.system.equipmentType !== \"armor\") return false;\n        return true;\n      });\n\n      for (const i of armor) {\n        data.armor = data.armor || [];\n        data.armor.push({\n          label: i.getName(this.forceHideGMInfo),\n          icon: i.img,\n        });\n      }\n    }\n\n    // Get clothing\n    if (\n      (game.user.isGM && !this.forceHideGMInfo) ||\n      actor.isOwner ||\n      (!getProperty(actor, \"item.details.tooltip.hideClothing\") && !getProperty(this.worldConfig, \"hideClothing\"))\n    ) {\n      const clothing = actor.items.filter((i) => {\n        if (i.type !== \"equipment\") return false;\n        if (!i.system.equipped) return false;\n        if (i.system.equipmentType !== \"misc\") return false;\n        if (i.system.equipmentSubtype !== \"clothing\") return false;\n        return true;\n      });\n\n      for (const i of clothing) {\n        data.clothing = data.clothing || [];\n        data.clothing.push({\n          label: i.getName(this.forceHideGMInfo),\n          icon: i.img,\n        });\n      }\n    }\n\n    return data;\n  }\n\n  getPortrait(data, url) {\n    if (getProperty(this.config, \"portrait.hide\") === true || getProperty(this.worldConfig, \"portrait.hide\") === true)\n      return;\n\n    data.portrait = {\n      maxWidth: getProperty(this.config, \"portrait.maxSize.width\") || 100,\n      maxHeight: getProperty(this.config, \"portrait.maxSize.height\") || 100,\n      url: url,\n    };\n  }\n\n  _setPosition() {\n    if (!this.element[0]) return;\n\n    const v = canvas.app.view.getBoundingClientRect();\n    const elSize = this.element[0].getBoundingClientRect();\n    const position = {\n      width: elSize.width,\n      height: elSize.height,\n      left: 0,\n      top: 0,\n    };\n\n    const sb = ui.sidebar.element[0].getBoundingClientRect();\n    const mw = v.width - position.width - sb.width,\n      mh = v.height - position.height;\n\n    // Calculate final position\n    if (this.onMouse) {\n      const minPos = {\n        x: v.left,\n        y: v.top,\n      };\n      const maxPos = {\n        x: minPos.x + mw,\n        y: minPos.y + mh,\n      };\n      const pos = {\n        x: this.mousePos.x - position.width + position.width * this.anchor.x + this.offset.x,\n        y: this.mousePos.y - position.height + position.height * this.anchor.y + this.offset.y,\n      };\n      position.left = Math.max(minPos.x, Math.min(maxPos.x, pos.x));\n      position.top = Math.max(minPos.y, Math.min(maxPos.y, pos.y));\n    } else {\n      position.left = v.left + mw * this.anchor.x + this.offset.x;\n      position.top = v.top + mh * this.anchor.y + this.offset.y;\n    }\n\n    this.element.css(position);\n  }\n\n  show() {\n    if (this.objects.length === 0) return;\n    if (this.forceHide) return;\n    if (getProperty(this.config, \"disable\") === true || getProperty(this.worldConfig, \"disable\") === true) return;\n\n    this.element.css(\"visibility\", \"visible\");\n  }\n\n  hide() {\n    this.element.css(\"visibility\", \"hidden\");\n  }\n\n  async _render(force = false, options = {}) {\n    await super._render(force, options);\n\n    this.hide();\n\n    // Required to re-align portraits\n    const loadableContent = this.element.find(\"img\");\n    const loadableContentCount = loadableContent.length;\n    if (loadableContentCount > 0) {\n      let loadedContentCount = 0;\n      loadableContent.one(\"load\", () => {\n        loadedContentCount++;\n        if (loadedContentCount === loadableContentCount && this.objects.length === 1) {\n          this._setPosition();\n          this.show();\n        }\n      });\n    } else if (this.objects.length === 1) {\n      this._setPosition();\n      this.show();\n    }\n  }\n\n  activateListeners(html) {\n    html.find(\".controls .close\").click(() => {\n      this.clearBinds();\n    });\n  }\n\n  tokenHover(token, hovering) {\n    // Show token tooltip\n    if (hovering) {\n      const p = ffd20.tooltip.mousePos;\n      const el = document.elementFromPoint(p.x, p.y);\n      // This check is required to prevent hovering over tokens under application windows\n      if (el?.id === \"board\") {\n        ffd20.tooltip.bind(token);\n      }\n    }\n    // Hide token tooltip\n    else ffd20.tooltip.unbind(token);\n  }\n\n  static toggle(enable) {\n    if (enable) {\n      if (!ffd20.tooltip) {\n        ffd20.tooltip = new TooltipFFD20();\n        Hooks.on(\"hoverToken\", ffd20.tooltip.tokenHover);\n      }\n      ffd20.tooltip?.setPosition();\n    } else {\n      if (ffd20.tooltip) {\n        Hooks.off(\"hoverToken\", ffd20.tooltip.tokenHover);\n        ffd20.tooltip = null;\n      }\n    }\n  }\n\n  async refresh() {\n    await this.render();\n\n    if (this.forceHide) this.hide();\n    else this.show();\n  }\n}\n","import { HealthConfig } from \"../applications/settings/health.mjs\";\nimport { ExperienceConfig } from \"../applications/settings/experience.mjs\";\nimport { AccessibilityConfig } from \"../applications/settings/accessibility.mjs\";\nimport { TooltipConfig } from \"../applications/settings/tooltip.mjs\";\nimport { TooltipWorldConfig } from \"../applications/settings/tooltip_world.mjs\";\nimport { TooltipFFD20 } from \"../applications/tooltip.mjs\";\n\nconst debouncedReload = foundry.utils.debounce(() => {\n  window.location.reload();\n}, 100);\n\nexport const registerSystemSettings = function () {\n  /**\n   * Track the system version upon which point a migration was last applied\n   */\n  game.settings.register(\"ffd20\", \"systemMigrationVersion\", {\n    name: \"System Migration Version\",\n    scope: \"world\",\n    config: false,\n    type: String,\n    default: \"0.0.0\",\n  });\n  /**\n   * Track when the last changelog was shown\n   */\n  game.settings.register(\"ffd20\", \"changelogVersion\", {\n    name: \"Changelog Version\",\n    scope: \"client\",\n    config: false,\n    type: String,\n    default: \"0.2.28\",\n  });\n  game.settings.register(\"ffd20\", \"dontShowChangelog\", {\n    name: \"Don't Automatically Show Changelog\",\n    scope: \"client\",\n    config: false,\n    type: Boolean,\n    default: false,\n  });\n\n  // Health configuration\n  game.settings.registerMenu(\"ffd20\", \"healthConfig\", {\n    name: \"SETTINGS.ffd20HealthConfigName\",\n    label: \"SETTINGS.ffd20HealthConfigLabel\",\n    hint: \"SETTINGS.ffd20HealthConfigHint\",\n    icon: \"fas fa-heartbeat\",\n    type: HealthConfig,\n    restricted: true,\n  });\n  game.settings.register(\"ffd20\", \"healthConfig\", {\n    name: \"SETTINGS.ffd20HealthConfigName\",\n    scope: \"world\",\n    default: HealthConfig.defaultSettings,\n    type: Object,\n    config: false,\n    onChange: () => ffd20.utils.refreshActors({ renderForEveryone: true }),\n  });\n\n  // Experience configuration\n  game.settings.registerMenu(\"ffd20\", \"experienceConfig\", {\n    name: \"FFD20.ExperienceConfigName\",\n    label: \"FFD20.ExperienceConfigLabel\",\n    hint: \"FFD20.ExperienceConfigHint\",\n    icon: \"fas fa-book\",\n    type: ExperienceConfig,\n    restricted: true,\n  });\n  game.settings.register(\"ffd20\", \"experienceConfig\", {\n    name: \"FFD20.ExperienceConfigName\",\n    scope: \"world\",\n    default: ExperienceConfig.defaultSettings,\n    type: Object,\n    config: false,\n    onChange: () => ffd20.utils.refreshActors({ renderForEveryone: true }),\n  });\n\n  // Accessibility configuration\n  /*\n  game.settings.registerMenu(\"ffd20\", \"accessibilityConfig\", {\n    name: \"FFD20.AccessibilityConfigName\",\n    label: \"FFD20.AccessibilityConfigLabel\",\n    hint: \"FFD20.AccessibilityConfigHint\",\n    restricted: false,\n    icon: \"fas fa-wheelchair\",\n    type: AccessibilityConfig,\n  });\n  */\n  game.settings.register(\"ffd20\", \"accessibilityConfig\", {\n    name: \"FFD20.AccessibilityConfigName\",\n    scope: \"client\",\n    default: AccessibilityConfig.defaultSettings,\n    type: Object,\n    config: false,\n    onChange: () => ffd20.utils.refreshActors(),\n  });\n\n  // Tooltip configuration\n  game.settings.registerMenu(\"ffd20\", \"tooltipConfig\", {\n    name: \"FFD20.TooltipConfigName\",\n    label: \"FFD20.TooltipConfigLabel\",\n    hint: \"FFD20.TooltipConfigHint\",\n    restricted: false,\n    icon: \"fas fa-window-maximize\",\n    type: TooltipConfig,\n  });\n  game.settings.register(\"ffd20\", \"tooltipConfig\", {\n    name: \"FFD20.TooltipConfigName\",\n    scope: \"client\",\n    default: TooltipConfig.defaultSettings,\n    type: Object,\n    config: false,\n    onChange: (settings) => {\n      const worldConf = game.settings.get(\"ffd20\", \"tooltipWorldConfig\");\n      const enable = !worldConf.disabled && !settings.disabled;\n      TooltipFFD20.toggle(enable);\n    },\n  });\n\n  // Tooltip World configuration\n  /* game.settings.registerMenu(\"ffd20\", \"tooltipWorldConfig\", {\n    name: \"FFD20.TooltipWorldConfigName\",\n    label: \"FFD20.TooltipWorldConfigLabel\",\n    hint: \"FFD20.TooltipWorldConfigHint\",\n    restricted: true,\n    icon: \"fas fa-window-maximize\",\n    type: TooltipWorldConfig,\n  }); */\n  game.settings.register(\"ffd20\", \"tooltipWorldConfig\", {\n    name: \"FFD20.TooltipWorldConfigName\",\n    scope: \"world\",\n    default: TooltipWorldConfig.defaultSettings,\n    type: Object,\n    config: false,\n    onChange: (settings) => {\n      TooltipFFD20.toggle(!settings.disable);\n      ffd20.tooltip?.setPosition();\n    },\n  });\n\n  /**\n   * Register diagonal movement rule setting\n   */\n  game.settings.register(\"ffd20\", \"diagonalMovement\", {\n    name: \"SETTINGS.ffd20DiagN\",\n    hint: \"SETTINGS.ffd20DiagL\",\n    scope: \"world\",\n    config: true,\n    default: \"5105\",\n    type: String,\n    choices: {\n      555: \"SETTINGS.ffd20DiagPHB\",\n      5105: \"SETTINGS.ffd20DiagDMG\",\n    },\n    onChange: (rule) => (canvas.grid.diagonalRule = rule),\n  });\n\n  /**\n   * Experience rate\n   *\n   * @deprecated\n   */\n  game.settings.register(\"ffd20\", \"experienceRate\", {\n    name: \"SETTINGS.ffd20ExpRateN\",\n    hint: \"SETTINGS.ffd20ExpRateL\",\n    scope: \"world\",\n    config: false,\n    default: \"\",\n    type: String,\n    onChange: () => ffd20.utils.refreshActors({ renderForEveryone: true }),\n  });\n\n  /**\n   * System of Units\n   */\n  game.settings.register(\"ffd20\", \"units\", {\n    name: \"SETTINGS.ffd20UnitsN\",\n    hint: \"SETTINGS.ffd20UnitsL\",\n    scope: \"world\",\n    config: true,\n    default: \"imperial\",\n    type: String,\n    choices: {\n      imperial: game.i18n.localize(\"SETTINGS.ffd20ImperialUnits\"),\n      metric: game.i18n.localize(\"SETTINGS.ffd20MetricUnits\"),\n    },\n    onChange: () => ffd20.utils.refreshActors({ renderForEveryone: true }),\n  });\n\n  game.settings.register(\"ffd20\", \"distanceUnits\", {\n    name: \"SETTINGS.ffd20DistanceUnitsN\",\n    hint: \"SETTINGS.ffd20DistanceUnitsL\",\n    scope: \"world\",\n    config: true,\n    default: \"default\",\n    type: String,\n    choices: {\n      default: game.i18n.localize(\"FFD20.Default\"),\n      imperial: game.i18n.localize(\"SETTINGS.ffd20ImperialDistanceUnits\"),\n      metric: game.i18n.localize(\"SETTINGS.ffd20MetricDistanceUnits\"),\n    },\n    onChange: () => ffd20.utils.refreshActors({ renderOnly: true, renderForEveryone: true }),\n  });\n\n  game.settings.register(\"ffd20\", \"weightUnits\", {\n    name: \"SETTINGS.ffd20WeightUnitsN\",\n    hint: \"SETTINGS.ffd20WeightUnitsL\",\n    scope: \"world\",\n    config: true,\n    default: \"default\",\n    type: String,\n    choices: {\n      default: game.i18n.localize(\"FFD20.Default\"),\n      imperial: game.i18n.localize(\"SETTINGS.ffd20ImperialWeightUnits\"),\n      metric: game.i18n.localize(\"SETTINGS.ffd20MetricWeightUnits\"),\n    },\n    onChange: () => ffd20.utils.refreshActors({ renderForEveryone: true }),\n  });\n\n  /**\n   * Option to allow the background skills optional ruleset.\n   */\n  game.settings.register(\"ffd20\", \"allowBackgroundSkills\", {\n    name: \"SETTINGS.ffd20BackgroundSkillsN\",\n    hint: \"SETTINGS.ffd20BackgroundSkillsH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => ffd20.utils.refreshActors({ renderOnly: true, renderForEveryone: true }),\n  });\n\n  /**\n   * Option to use the Fractional Base Bonuses optional ruleset.\n   */\n  game.settings.register(\"ffd20\", \"useFractionalBaseBonuses\", {\n    name: \"SETTINGS.ffd20FractionalBaseBonusesN\",\n    hint: \"SETTINGS.ffd20FractionalBaseBonusesH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => ffd20.utils.refreshActors({ renderForEveryone: true }),\n  });\n\n  /**\n   * Option to automatically collapse Item Card descriptions\n   */\n  game.settings.register(\"ffd20\", \"autoCollapseItemCards\", {\n    name: \"SETTINGS.ffd20AutoCollapseCardN\",\n    hint: \"SETTINGS.ffd20AutoCollapseCardL\",\n    scope: \"client\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      ui.chat.render();\n    },\n  });\n\n  /**\n   * Option to hide chat buttons\n   */\n  game.settings.register(\"ffd20\", \"hideChatButtons\", {\n    name: \"SETTINGS.ffd20HideChatButtonsN\",\n    hint: \"SETTINGS.ffd20HideChatButtonsH\",\n    scope: \"client\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      ui.chat.render();\n    },\n  });\n\n  /**\n   * Option to change measure style\n   */\n  game.settings.register(\"ffd20\", \"measureStyle\", {\n    name: \"SETTINGS.ffd20MeasureStyleN\",\n    hint: \"SETTINGS.ffd20MeasureStyleL\",\n    scope: \"world\",\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n\n  /**\n   * Low-light Vision Mode\n   */\n  game.settings.register(\"ffd20\", \"lowLightVisionMode\", {\n    name: \"SETTINGS.ffd20LowLightVisionModeN\",\n    hint: \"SETTINGS.ffd20LowLightVisionModeH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      // Refresh canvas sight\n      canvas.perception.schedule({\n        lighting: { initialize: true, refresh: true },\n        sight: { initialize: true, refresh: true },\n      });\n    },\n  });\n\n  game.settings.register(\"ffd20\", \"sharedVisionMode\", {\n    name: \"SETTINGS.ffd20SharedVisionModeN\",\n    hint: \"SETTINGS.ffd20SharedVisionModeH\",\n    scope: \"world\",\n    config: true,\n    default: \"0\",\n    type: String,\n    choices: {\n      0: \"SETTINGS.ffd20SharedVisionWithoutSelection\",\n      1: \"SETTINGS.ffd20SharedVisionWithSelection\",\n    },\n    onChange: () => {\n      game.socket.emit(\"system.ffd20\", { eventType: \"redrawCanvas\" });\n    },\n  });\n\n  game.settings.register(\"ffd20\", \"characterVision\", {\n    name: \"SETTINGS.ffd20characterVisionN\",\n    hint: \"SETTINGS.ffd20characterVisionH\",\n    scope: \"world\",\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n\n  /**\n   * Set coin weight\n   */\n  game.settings.register(\"ffd20\", \"coinWeight\", {\n    name: \"SETTINGS.ffd20CoinWeightN\",\n    hint: \"SETTINGS.ffd20CoinWeightH\",\n    scope: \"world\",\n    config: true,\n    default: 50,\n    type: Number,\n    onChange: () => ffd20.utils.refreshActors({ renderForEveryone: true }),\n  });\n\n  /**\n   * Low-light Vision Mode\n   */\n  game.settings.register(\"ffd20\", \"allowScriptChanges\", {\n    name: \"SETTINGS.ffd20AllowScriptChangesN\",\n    hint: \"SETTINGS.ffd20AllowScriptChangesH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: (value) => {\n      if (!value || !game.user.isGM) return;\n      // Flash scare message and confirmation\n      const d = Dialog.confirm({\n        title: game.i18n.localize(\"SETTINGS.ffd20AllowScriptChangesN\"),\n        content: game.i18n.localize(\"SETTINGS.ffd20AllowScriptChangesW\"),\n        defaultYes: false,\n      });\n      d.then((result) => {\n        if (!result) game.settings.set(\"ffd20\", \"allowScriptChanges\", false);\n      });\n    },\n  });\n\n  /**\n   * Hide token conditions\n   */\n  game.settings.register(\"ffd20\", \"hideTokenConditions\", {\n    name: \"SETTINGS.ffd20HideTokenConditionsN\",\n    hint: \"SETTINGS.ffd20HideTokenConditionsH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      const promises = [];\n      const actors = [\n        ...Array.from(game.actors.contents.filter((o) => getProperty(o.data, \"token.actorLink\"))),\n        ...Object.values(game.actors.tokens).filter((a) => a != null),\n      ];\n      for (const actor of actors) {\n        if (actor.toggleConditionStatusIcons) {\n          promises.push(actor.toggleConditionStatusIcons({ render: false }));\n        }\n      }\n      return Promise.all(promises);\n    },\n  });\n\n  /**\n   * Hide inline rolls from non-observers.\n   */\n  game.settings.register(\"ffd20\", \"obscureInlineRolls\", {\n    name: \"SETTINGS.ffd20obscureInlineRollsN\",\n    hint: \"SETTINGS.ffd20obscureInlineRollsH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: debouncedReload,\n  });\n\n  /**\n   * Hide save DCs.\n   */\n  game.settings.register(\"ffd20\", \"obscureSaveDCs\", {\n    name: \"SETTINGS.ffd20obscureSaveDCsN\",\n    hint: \"SETTINGS.ffd20obscureSaveDCsH\",\n    scope: \"world\",\n    config: true,\n    default: true,\n    type: Boolean,\n    onChange: debouncedReload,\n  });\n\n  /**\n   * Display default token conditions alongside system ones\n   */\n  game.settings.register(\"ffd20\", \"coreEffects\", {\n    name: \"SETTINGS.ffd20CoreEffectsN\",\n    hint: \"SETTINGS.ffd20CoreEffectsH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: debouncedReload,\n  });\n\n  /**\n   * Skip action dialog prompts\n   */\n  game.settings.register(\"ffd20\", \"skipActionDialogs\", {\n    name: \"SETTINGS.ffd20SkipActionDialogsN\",\n    hint: \"SETTINGS.ffd20SkipActionDialogsH\",\n    scope: \"client\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  /*\n   * When skipping an action dialog prompt still place the template if one is configured\n   */\n  game.settings.register(\"ffd20\", \"placeMeasureTemplateOnQuickRolls\", {\n    name: \"SETTINGS.placeMeasureTemplateOnQuickRollsN\",\n    hint: \"SETTINGS.placeMeasureTemplateOnQuickRollsH\",\n    scope: \"client\",\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n\n  /**\n   * Unchained action economy\n   */\n  game.settings.register(\"ffd20\", \"unchainedActionEconomy\", {\n    name: \"SETTINGS.ffd20UnchainedActionEconomyN\",\n    hint: \"SETTINGS.ffd20UnchainedActionEconomyH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => ffd20.utils.refreshActors({ renderOnly: true, renderForEveryone: true }),\n  });\n\n  /**\n   * Invert filter Shift-clicking\n   */\n  game.settings.register(\"ffd20\", \"invertSectionFilterShiftBehaviour\", {\n    name: \"SETTINGS.ffd20InvertSectionFilterBehaviourN\",\n    hint: \"SETTINGS.ffd20InvertSectionFilterBehaviourH\",\n    scope: \"client\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  /**\n   * Hide reach measurements\n   */\n  game.settings.register(\"ffd20\", \"hideReachMeasurements\", {\n    name: \"SETTINGS.ffd20HideReachMeasurementsN\",\n    hint: \"SETTINGS.ffd20HideReachMeasurementsH\",\n    scope: \"client\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  /**\n   * Display BAB iteratives instead of simply total\n   */\n  game.settings.register(\"ffd20\", \"displayIteratives\", {\n    name: \"SETTINGS.ffd20DisplayIterativesN\",\n    hint: \"SETTINGS.ffd20DisplayIterativesH\",\n    scope: \"client\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  /**\n   * Alternative reach corner rule\n   */\n  game.settings.register(\"ffd20\", \"alternativeReachCornerRule\", {\n    name: \"SETTINGS.ffd20AlternativeReachCornerRuleN\",\n    hint: \"SETTINGS.ffd20AlternativeReachCornerRuleH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  /**\n   * Allow proficiencies on NPCs.\n   */\n  game.settings.register(\"ffd20\", \"npcProficiencies\", {\n    name: \"SETTINGS.ffd20NPCProficienciesN\",\n    hint: \"SETTINGS.ffd20NPCProficienciesH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  /**\n   * Disable targets for attack cards\n   */\n  game.settings.register(\"ffd20\", \"disableAttackCardTargets\", {\n    name: \"SETTINGS.ffd20DisableAttackCardTargetsN\",\n    hint: \"SETTINGS.ffd20DisableAttackCardTargetsH\",\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  game.settings.register(\"ffd20\", \"initiativeTiebreaker\", {\n    name: \"SETTINGS.ffd20InitTiebreakerN\",\n    hint: \"SETTINGS.ffd20InitTiebreakerH\",\n    scope: \"world\",\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n\n  /**\n   * Clear targets after attack\n   */\n  game.settings.register(\"ffd20\", \"clearTargetsAfterAttack\", {\n    name: \"SETTINGS.ffd20ClearTargetsAfterAttackN\",\n    hint: \"SETTINGS.ffd20ClearTargetsAfterAttackH\",\n    scope: \"client\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n};\n\nexport const registerClientSettings = function () {\n  /**\n   * Compendium filters\n   */\n  game.settings.register(\"ffd20\", \"compendiumFilters\", {\n    name: \"Compendium Filters\",\n    hint: \"Stores compendium filters\",\n    scope: \"client\",\n    config: false,\n    default: {},\n    type: Object,\n  });\n\n  /**\n   * Compendium items\n   */\n  game.settings.register(\"ffd20\", \"compendiumItems\", {\n    name: \"Compendium Items\",\n    hint: \"Cache compendium entries\",\n    scope: \"client\",\n    config: false,\n    default: {},\n    type: Object,\n  });\n\n  /**\n   * Compendium save versions\n   */\n  game.settings.register(\"ffd20\", \"compendiumSaveVersions\", {\n    name: \"Compendium Save Versions\",\n    hint: \"Versions of compendium caches\",\n    scope: \"client\",\n    config: false,\n    default: {\n      spells: \"0.2.28\",\n      items: \"0.2.28\",\n      bestiary: \"0.2.28\",\n      feats: \"0.2.28\",\n      classes: \"0.2.28\",\n      races: \"0.2.28\",\n    },\n    type: Object,\n  });\n\n  /*\n   * Compendium difference data\n   */\n  game.settings.register(\"ffd20\", \"compendiumForceRefresh\", {\n    name: \"Compendium Force Refresh Data\",\n    hint: \"Data needed to determine whether to force refresh compendiums\",\n    scope: \"client\",\n    config: false,\n    default: {\n      diff: {\n        items: [],\n        spells: [],\n        classes: [],\n        races: [],\n        feats: [],\n        bestiary: [],\n      },\n    },\n    type: Object,\n  });\n};\n\nexport const migrateSystemSettings = async function () {\n  if (!game.user.isGM) return;\n\n  // Currently empty, since the last option was removed (2022-06-06)\n};\n\n/**\n * Returns whether the user's settings and key presses signal that dialogs should be skipped.\n *\n * @returns {boolean}\n */\nexport const getSkipActionPrompt = function () {\n  return (\n    (game.settings.get(\"ffd20\", \"skipActionDialogs\") && !ffd20.skipConfirmPrompt) ||\n    (!game.settings.get(\"ffd20\", \"skipActionDialogs\") && ffd20.skipConfirmPrompt)\n  );\n};\n","/**\n * Define a set of template paths to pre-load\n * Pre-loaded templates are compiled and cached for fast access when rendering\n *\n * @returns {Promise}\n */\nexport const preloadHandlebarsTemplates = async function () {\n  // Define template paths to load\n  const templatePaths = [\n    // Actor Sheet Partials\n    \"systems/ffd20/templates/actors/parts/actor-summary.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-traits.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-inventory.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-features.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-spellbook-front.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-spellbook.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-skills-front.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-skills.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-combat.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-defenses_tables.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-buffs.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-attributes.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-settings.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-cmb.hbs\",\n    \"systems/ffd20/templates/actors/parts/actor-contextNotes.hbs\",\n\n    \"systems/ffd20/templates/internal/item-search.hbs\",\n\n    // Item Sheet Partials\n    \"systems/ffd20/templates/items/parts/item-actions.hbs\",\n    \"systems/ffd20/templates/items/parts/item-advanced.hbs\",\n    \"systems/ffd20/templates/items/parts/item-aura.hbs\",\n    \"systems/ffd20/templates/items/parts/item-changes.hbs\",\n    \"systems/ffd20/templates/items/parts/item-contents.hbs\",\n    \"systems/ffd20/templates/items/parts/item-description.hbs\",\n    \"systems/ffd20/templates/items/parts/item-links.hbs\",\n    \"systems/ffd20/templates/items/parts/item-name.hbs\",\n    \"systems/ffd20/templates/items/parts/item-proficiencies.hbs\",\n    \"systems/ffd20/templates/items/parts/item-size.hbs\",\n    \"systems/ffd20/templates/items/parts/item-tag.hbs\",\n    \"systems/ffd20/templates/items/parts/item-weapon-groups.hbs\",\n\n    // Apps\n    \"systems/ffd20/templates/apps/attack-roll-dialog.hbs\",\n    \"systems/ffd20/templates/apps/vision-permission.hbs\",\n    \"systems/ffd20/templates/apps/help-browser.hbs\",\n\n    // Item Action Partials\n    \"systems/ffd20/templates/apps/item-action/action.hbs\",\n    \"systems/ffd20/templates/apps/item-action/activation.hbs\",\n    \"systems/ffd20/templates/apps/item-action/template.hbs\",\n    \"systems/ffd20/templates/apps/item-action/conditionals.hbs\",\n\n    // Chat\n    \"systems/ffd20/templates/chat/roll-ext.hbs\",\n    \"systems/ffd20/templates/chat/defenses.hbs\",\n    \"systems/ffd20/templates/chat/parts/gm-description.hbs\",\n\n    // Chat card partials\n    \"systems/ffd20/templates/chat/parts/attack-roll-header.hbs\",\n    \"systems/ffd20/templates/chat/parts/attack-roll-footer.hbs\",\n    \"systems/ffd20/templates/chat/parts/attack-roll-targets.hbs\",\n\n    // Internal Rendering Partials\n    \"systems/ffd20/templates/internal/spell-description.hbs\",\n    \"systems/ffd20/templates/internal/consumable-description.hbs\",\n    \"systems/ffd20/templates/internal/damage-tooltip.hbs\",\n    \"systems/ffd20/templates/internal/token-config_vision.hbs\",\n    \"systems/ffd20/templates/internal/compendium-browser_entry.hbs\",\n    \"systems/ffd20/templates/internal/damage-type-visual.hbs\",\n\n    // Tooltip\n    \"systems/ffd20/templates/hud/tooltip.hbs\",\n    \"systems/ffd20/templates/hud/tooltip_actor.hbs\",\n\n    // Level Up sections\n    \"systems/ffd20/templates/apps/level-up/fc_alt.hbs\",\n    \"systems/ffd20/templates/apps/level-up/fc_hp.hbs\",\n    \"systems/ffd20/templates/apps/level-up/fc_skill.hbs\",\n    \"systems/ffd20/templates/apps/level-up/health_roll.hbs\",\n    \"systems/ffd20/templates/apps/level-up/health_manual.hbs\",\n    \"systems/ffd20/templates/apps/level-up/ability-score.hbs\",\n    \"systems/ffd20/templates/apps/level-up/summary.hbs\",\n\n    // Level Up summary\n    \"systems/ffd20/templates/apps/level-up/summary/health.hbs\",\n    \"systems/ffd20/templates/apps/level-up/summary/fc.hbs\",\n    \"systems/ffd20/templates/apps/level-up/summary/ability-score.hbs\",\n  ];\n\n  // Load the template parts\n  return loadTemplates(templatePaths);\n};\n","export class SemanticVersion {\n  static re = /^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?)?$/\n\n  constructor() {\n    this.major = 0;\n    this.minor = 0;\n    this.patch = 0;\n    this.preRelease = \"\";\n    this.buildMetaData = \"\";\n  }\n\n  static fromString(str) {\n    if (str.match(this.re)) {\n      let result = new this();\n      result.major = parseInt(RegExp.$1);\n      result.minor = parseInt(RegExp.$2);\n      result.patch = parseInt(RegExp.$3 || 0);\n      result.preRelease = RegExp.$4 || \"\";\n      result.buildMetaData = RegExp.$5 || \"\";\n      return result;\n    }\n    return null;\n  }\n\n  toString() {\n    return `${this.major}.${this.minor}.${this.patch}`;\n  }\n\n  isHigherThan(otherVersion) {\n    if (this.major > otherVersion.major) return true;\n    if (this.major === otherVersion.major && this.minor > otherVersion.minor) return true;\n    if (this.major === otherVersion.major\n      && this.minor === otherVersion.minor\n      && this.patch > otherVersion.patch) return true;\n    return false;\n  }\n\n  isLowerThan(otherVersion) {\n    if (this.major < otherVersion.major) return true;\n    if (this.major === otherVersion.major && this.minor < otherVersion.minor) return true;\n    if (this.major === otherVersion.major\n      && this.minor === otherVersion.minor\n      && this.patch < otherVersion.patch) return true;\n    return false;\n  }\n}\n","export class RollFFD20 extends Roll {\n  get totalHalved() {\n    return Math.floor(this.total / 2);\n  }\n\n  static safeRoll(formula, data = {}, context, options = { suppressError: false }) {\n    let roll;\n    try {\n      roll = this.create(formula, data).evaluate({ async: false });\n    } catch (err) {\n      roll = this.create(\"0\", data).evaluate({ async: false });\n      roll.err = err;\n    }\n    if (roll.warning) roll.err = Error(\"This formula had a value replaced with null.\");\n    if (roll.err) {\n      if (context && !options.suppressError) console.error(context, roll.err);\n      else if (CONFIG.debug.roll) console.error(roll.err);\n    }\n    return roll;\n  }\n\n  static safeTotal(formula, data) {\n    return isNaN(+formula) ? RollFFD20.safeRoll(formula, data).total : +formula;\n  }\n\n  /**\n   * @override\n   */\n  static simplifyTerms(terms) {\n    // Simplify terms by combining with pending strings\n    let simplified = terms.reduce((terms, term) => {\n      const prior = terms[terms.length - 1];\n      const isOperator = term instanceof OperatorTerm;\n\n      // Combine a non-operator term with prior StringTerm\n      if (!isOperator && prior instanceof StringTerm) {\n        prior.term += term.total;\n        foundry.utils.mergeObject(prior.options, term.options);\n        return terms;\n      }\n\n      // Attach string terms as flavor texts to numeric terms, if appropriate\n      const priorNumeric = prior instanceof NumericTerm;\n      if (prior && priorNumeric && term instanceof StringTerm && term.term.match(/\\[(.+)\\]/)) {\n        prior.options.flavor = RegExp.$1;\n        return terms;\n      }\n\n      // Combine StringTerm with a prior non-operator term\n      const priorOperator = prior instanceof OperatorTerm;\n      if (prior && !priorOperator && term instanceof StringTerm) {\n        term.term = String(prior.total) + term.term;\n        foundry.utils.mergeObject(term.options, prior.options);\n        terms[terms.length - 1] = term;\n        return terms;\n      }\n\n      // Otherwise continue\n      terms.push(term);\n      return terms;\n    }, []);\n\n    // Convert remaining String terms to a RollTerm which can be evaluated\n    simplified = simplified.map((term) => {\n      if (!(term instanceof StringTerm)) return term;\n      const t = this._classifyStringTerm(term.formula, { intermediate: false });\n      t.options = foundry.utils.mergeObject(term.options, t.options, { inplace: false });\n      return t;\n    });\n\n    // Eliminate leading or trailing arithmetic\n    if (simplified[0] instanceof OperatorTerm && simplified[0].operator !== \"-\") simplified.shift();\n    if (simplified[terms.length - 1] instanceof OperatorTerm) simplified.pop();\n    return simplified;\n  }\n\n  /**\n   * @override\n   *\n   * Split a formula by identifying its outer-most parenthetical and math terms\n   * @param {string} _formula      The raw formula to split\n   * @returns {string[]}          An array of terms, split on parenthetical terms\n   * @private\n   */\n  static _splitParentheses(_formula) {\n    return this._splitGroup(_formula, {\n      openRegexp: ParentheticalTerm.OPEN_REGEXP,\n      closeRegexp: ParentheticalTerm.CLOSE_REGEXP,\n      openSymbol: \"(\",\n      closeSymbol: \")\",\n      onClose: (group) => {\n        // Extract group arguments\n        const fn = group.open.slice(0, -1);\n        const expression = group.terms.join(\"\");\n        const options = { flavor: group.flavor ? group.flavor.slice(1, -1) : undefined };\n\n        const terms = [];\n        if (fn in ffd20.utils.rollPreProcess) {\n          const fnParams = group.terms\n            // .slice(2, -1)\n            .reduce((cur, s) => {\n              cur.push(...s.split(/\\s*,\\s*/));\n              return cur;\n            }, [])\n            .map((o) => {\n              // Return raw string\n              if ((o.startsWith('\"') && o.endsWith('\"')) || (o.startsWith(\"'\") && o.endsWith(\"'\"))) {\n                return o.slice(1, -1);\n              }\n              // Return raw string without quotes\n              if (o.match(/^[a-zA-Z0-9]+$/)) {\n                return parseRollStringVariable(o);\n              }\n              // Return roll result\n              return RollFFD20.safeRoll(o, this.data).total;\n            });\n\n          return ffd20.utils.rollPreProcess[fn](...fnParams);\n        } else if (fn in Math) {\n          const args = this._splitMathArgs(expression);\n          terms.push(new MathTerm({ fn, terms: args, options }));\n        } else {\n          if (fn) terms.push(new StringTerm({ term: fn }));\n          terms.push(new ParentheticalTerm({ term: expression, options }));\n        }\n        return terms;\n      },\n    });\n  }\n\n  static cleanFlavor(flavor) {\n    return flavor.replace(/\\[\\];/g, \"\");\n  }\n\n  /**\n   * Render the tooltip HTML for a RollFFD20 instance\n   *\n   * @returns {Promise<string>} The rendered HTML tooltip as a string\n   */\n  async getTooltip() {\n    const parts = this.dice.map((d) => d.getTooltipData());\n    const numericParts = this.terms.reduce((cur, t, idx, arr) => {\n      const result = t instanceof NumericTerm ? t.getTooltipData() : undefined;\n\n      const prior = arr[idx - 1];\n      if (t instanceof NumericTerm && prior && prior instanceof OperatorTerm && prior.operator === \"-\") {\n        result.total = -result.total;\n      }\n\n      if (result !== undefined) {\n        if (!result.flavor) result.flavor = game.i18n.localize(\"FFD20.Undefined\");\n        cur.push(result);\n      }\n      return cur;\n    }, []);\n    return renderTemplate(\"systems/ffd20/templates/dice/tooltip.hbs\", { parts, numericParts });\n  }\n}\n\nexport const parseRollStringVariable = function (value) {\n  if (value === \"false\") return false;\n  if (value === \"true\") return true;\n  if (value === \"null\") return null;\n  if (value === \"undefined\") return undefined;\n\n  if (value.match(/^(?:[0-9]+)?(?:\\.[0-9]+)?$/)) {\n    return parseFloat(value);\n  }\n  return value;\n};\n","import { SemanticVersion } from \"./semver.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\n\n/**\n * Creates a tag from a string.\n * For example, if you input the string \"Wizard of Oz 2\", you will get \"wizardOfOz2\"\n *\n * @param str\n */\nexport const createTag = function (str) {\n  if (str.length === 0) str = \"tag\";\n  return str\n    .replace(/[^a-zA-Z0-9\\s]/g, \"\")\n    .split(/\\s+/)\n    .map((s, a) => {\n      s = s.toLowerCase();\n      if (a > 0) s = s.substring(0, 1).toUpperCase() + s.substring(1);\n      return s;\n    })\n    .join(\"\");\n};\n\n/**\n * Alters a roll in string form.\n *\n * @param str\n * @param add\n * @param multiply\n */\nexport const alterRoll = function (str, add, multiply) {\n  const rgx = /^([0-9]+)d([0-9]+)/;\n  // const rgx = new RegExp(Die.rgx.die, \"g\");\n  // if (str.match(/^([0-9]+)d([0-9]+)/)) {\n  return str.replace(rgx, (match, nd, d, mods) => {\n    nd = nd * (multiply || 1) + (add || 0);\n    mods = mods || \"\";\n    return (nd == null || Number.isNaN(nd) ? \"\" : nd) + \"d\" + d + mods;\n  });\n  // }\n};\n\n/**\n * @param {string} version - A version string to unpack. Must be something like '0.5.1'.\n * @returns {object} An object containing the keys 'release', 'major', and 'minor', which are numbers.\n */\nexport const unpackVersion = function (version) {\n  if (version.match(/^([0-9]+)\\.([0-9]+)(?:\\.([0-9]+))?$/)) {\n    return {\n      release: parseInt(RegExp.$1),\n      major: parseInt(RegExp.$2),\n      minor: parseInt(RegExp.$3) || null,\n    };\n  }\n};\n\n/**\n * @param {string} version - The minimum core version to compare to. Must be something like '0.5.1'.\n * @returns {boolean} Whether the current core version is at least the given version.\n */\nexport const isMinimumCoreVersion = function (version) {\n  // TODO: Remove after 0.8.X\n  const coreVersion = SemanticVersion.fromString(game.version);\n  const compareVersion = SemanticVersion.fromString(version);\n\n  return !coreVersion.isLowerThan(compareVersion);\n};\n\nexport const degtorad = function (degrees) {\n  return (degrees * Math.PI) / 180;\n};\n\nexport const radtodeg = function (radians) {\n  return (radians / 180) * Math.PI;\n};\n\nexport const linkData = function (expanded, flattened, key, value) {\n  setProperty(expanded, key, value);\n  flattened[key] = value;\n};\n\n/**\n * @param {object} item Item data\n * @returns {User|null}\n */\nexport const getItemOwner = function (item) {\n  if (item.actor) return item.actor;\n  if (item.id) return game.actors.find((o) => o.items.get(item.id));\n  return null;\n};\n\n/**\n * Turn some fractional numbers into pretty strings.\n *\n * @param {number} v\n * @returns {string|undefined}\n */\nexport const fractionalToString = (v) => {\n  const base = Math.floor(v);\n  const f = Math.roundDecimals(v - base, 3);\n  if (f === 0) return `${base}`;\n  const rv = [];\n  if (base !== 0) rv.push(base);\n  if (f === 0.25) rv.push(\"1/4\");\n  else if (f === 0.333) rv.push(\"1/3\");\n  else if (f === 0.5) rv.push(\"1/2\");\n  else if (f === 0.667) rv.push(\"2/3\");\n  else if (f === 0.75) rv.push(\"3/4\");\n  return rv.join(\" \");\n};\n\nexport const CR = {\n  fromString(value) {\n    if (value === \"1/8\") return 0.125;\n    if (value === \"1/6\") return 0.1625;\n    if (value === \"1/4\") return 0.25;\n    if (value === \"1/3\") return 0.3375;\n    if (value === \"1/2\") return 0.5;\n    return parseFloat(value);\n  },\n\n  fromNumber(value) {\n    if (value === 0.125) return \"1/8\";\n    if (value === 0.1625) return \"1/6\";\n    if (value === 0.25) return \"1/4\";\n    if (value === 0.3375) return \"1/3\";\n    if (value === 0.5) return \"1/2\";\n    if (!Number.isNumeric(value)) return \"0\";\n    return value.toString();\n  },\n};\n\nexport const getActorFromId = function (id) {\n  const speaker = ChatMessage.getSpeaker();\n  let actor = null;\n  if (id) {\n    actor = game.actors.tokens[id];\n    if (!actor) actor = game.actors.get(id);\n  }\n  if (speaker.token && !actor) actor = game.actors.tokens[speaker.token];\n  if (!actor) actor = game.actors.get(speaker.actor);\n  return actor;\n};\n\n/**\n * Converts feet to what the world is using as a measurement unit.\n *\n * @param {number} value - The value (in feet) to convert.\n * @param {string} type - The original type to convert from. Either 'ft' (feet, default) or 'mi' (miles, in which case the result is in km (metric))\n * @returns {Array.<number, string>} An array containing the converted value in index 0 and the new unit key in index 1 (for use in CONFIG.FFD20.measureUnits, for example)\n */\nexport const convertDistance = function (value, type = \"ft\") {\n  let system = game.settings.get(\"ffd20\", \"distanceUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      switch (type) {\n        case \"mi\":\n          return [Math.round(value * 1.6 * 100) / 100, \"km\"];\n        default:\n          return [Math.round((value / 5) * 1.5 * 100) / 100, \"m\"];\n      }\n    default:\n      return [value, type];\n  }\n};\n\n/**\n * Converts what the world is using as a measurement unit to feet.\n *\n * @param {number} value - The value (in the world's measurement unit) to convert back.\n * @param {string} type - The target type to convert back to. Either 'ft' (feet, default) or 'mi' (miles, in which case the expected given value should be in km (metric))\n * @returns {number} The resulting value.\n */\nexport const convertDistanceBack = function (value, type = \"ft\") {\n  let system = game.settings.get(\"ffd20\", \"distanceUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      switch (type) {\n        case \"mi\":\n          return [Math.round((value / 1.6) * 100) / 100, \"mi\"];\n        default:\n          return [Math.round(((value * 5) / 1.5) * 100) / 100, \"ft\"];\n      }\n    default:\n      return [value, type];\n  }\n};\n\n/**\n * @typedef Point\n * @property {number} x X coordinate\n * @param {number} y Y coordinate\n */\n\n/**\n * @typedef MeasureState\n * @param {number} diagonals Number of diagonals passed so far.\n * @param {number} cells Total cells in distance\n */\n\n/**\n * Measure distance between two points.\n *\n * @param {Point} p0 Start point on canvas\n * @param {Point} p1 End point on canvas\n * @param {object} options Measuring options.\n * @param {boolean} options.altReach Use alternate reach weapon diagonal rule at 10 ft range.\n * @param {\"5105\"|\"555\"} options.diagonalRule Used diagonal rule. Defaults to 5/10/5 FFD20 measuring.\n * @param {Ray} options.ray Pre-generated ray to use instead of the points.\n * @param {MeasureState} options.state Optional state tracking across multiple measures.\n * @returns {number} Grid distance between the two points.\n */\nexport const measureDistance = function (\n  p0,\n  p1,\n  { ray = null, diagonalRule = \"5105\", state = { diagonals: 0, cells: 0 } } = {}\n) {\n  // TODO: Optionally adjust start and end point to closest grid\n  ray ??= new Ray(p0, p1);\n  const gs = canvas.dimensions.size,\n    nx = Math.ceil(Math.abs(ray.dx / gs)),\n    ny = Math.ceil(Math.abs(ray.dy / gs));\n\n  // Get the number of straight and diagonal moves\n  const nDiagonal = Math.min(nx, ny),\n    nStraight = Math.abs(ny - nx);\n\n  state.diagonals += nDiagonal;\n\n  let cells = 0;\n  // Standard Pathfinder diagonals: double distance for every odd.\n  if (diagonalRule === \"5105\") {\n    const nd10 = Math.floor(state.diagonals / 2) - Math.floor((state.diagonals - nDiagonal) / 2);\n    cells = nd10 * 2 + (nDiagonal - nd10) + nStraight;\n  }\n  // Equal distance diagonals\n  else cells = nStraight + nDiagonal;\n\n  state.cells += cells;\n  return cells * canvas.dimensions.distance;\n};\n\n/**\n * Converts lbs to what the world is using as a measurement unit.\n *\n * @param {number} value - The value (in lbs) to convert.\n * @returns {number} The converted value. In the case of the metric system, converts to kg.\n */\nexport const convertWeight = function (value) {\n  let system = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      return Math.round((value / 2) * 100) / 100; // 1 kg is not exactly 2 lb but this conversion is officially used by Paizo/BBE\n    default:\n      return value;\n  }\n};\n\n/**\n * Converts back to lbs from what the world is using as a measurement unit.\n *\n * @param {number} value - The value to convert back to lbs.\n * @returns {number} The converted value. In the case of the metric system, converts from kg.\n */\nexport const convertWeightBack = function (value) {\n  let system = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      return Math.round(value * 2 * 100) / 100; // 1 kg is not exactly 2 lb but this conversion is officially used by Paizo/BBE\n    default:\n      return value;\n  }\n};\n\n/**\n * Like Foundry's default expandObject function, except it can make arrays\n *\n * @param obj\n * @param options\n * @param _d\n */\nexport const expandObjectExt = function (obj, options = { makeArrays: true }, _d = 0) {\n  const setPropertyExt = function (object, key, value) {\n    let target = object;\n    let changed = false;\n\n    // Convert the key to an object reference if it contains dot notation\n    if (key.indexOf(\".\") !== -1) {\n      const parts = key.split(\".\");\n      key = parts.pop();\n      target = parts.reduce((o, i, a) => {\n        const nextKey = parts.length > a ? parts[a + 1] : null;\n        if (!Object.prototype.hasOwnProperty.call(o, i)) {\n          if (((nextKey && nextKey.match(/^[0-9]+$/)) || (!nextKey && key.match(/^[0-9]+$/))) && options.makeArrays)\n            o[i] = [];\n          else o[i] = {};\n        }\n        return o[i];\n      }, object);\n    }\n\n    // Update the target\n    if (target[key] !== value) {\n      changed = true;\n      target[key] = value;\n    }\n\n    // Return changed status\n    return changed;\n  };\n\n  const expanded = {};\n  if (_d > 10) throw new Error(\"Maximum depth exceeded\");\n  for (let [k, v] of Object.entries(obj)) {\n    if (v instanceof Object && !Array.isArray(v)) {\n      v = expandObjectExt(v, options, _d + 1);\n    }\n    setPropertyExt(expanded, k, v);\n  }\n  return expanded;\n};\n\nexport const mergeObjectExt = function (\n  original,\n  other = {},\n  {\n    insertKeys = true,\n    insertValues = true,\n    overwrite = true,\n    inplace = true,\n    enforceTypes = false,\n    makeArrays = true,\n  } = {},\n  _d = 0\n) {\n  other = other || {};\n  if (!(original instanceof Object) || !(other instanceof Object)) {\n    throw new Error(\"One of original or other are not Objects!\");\n  }\n  const depth = _d + 1;\n\n  // Maybe copy the original data at depth 0\n  if (!inplace && _d === 0) original = duplicate(original);\n\n  // Enforce object expansion at depth 0\n  if (_d === 0 && Object.keys(original).some((k) => /\\./.test(k)))\n    original = expandObjectExt(original, { makeArrays: makeArrays });\n  if (_d === 0 && Object.keys(other).some((k) => /\\./.test(k))) other = expandObject(other, { makeArrays: makeArrays });\n\n  // Iterate over the other object\n  for (let [k, v] of Object.entries(other)) {\n    const tv = getType(v);\n\n    // Prepare to delete\n    let toDelete = false;\n    if (k.startsWith(\"-=\")) {\n      k = k.slice(2);\n      toDelete = v === null;\n    }\n\n    // Get the existing object\n    let x = original[k];\n    let has = Object.prototype.hasOwnProperty.call(original, k);\n    let tx = getType(x);\n\n    // Ensure that inner objects exist\n    if (!has && tv === \"Object\") {\n      x = original[k] = {};\n      has = true;\n      tx = \"Object\";\n    }\n\n    // Case 1 - Key exists\n    if (has) {\n      // 1.1 - Recursively merge an inner object\n      if (tv === \"Object\" && tx === \"Object\") {\n        mergeObjectExt(\n          x,\n          v,\n          {\n            insertKeys: insertKeys,\n            insertValues: insertValues,\n            overwrite: overwrite,\n            inplace: true,\n            enforceTypes: enforceTypes,\n            makeArrays: makeArrays,\n          },\n          depth\n        );\n      }\n\n      // 1.2 - Remove an existing key\n      else if (toDelete) {\n        delete original[k];\n      }\n\n      // 1.3 - Overwrite existing value\n      else if (overwrite) {\n        if (tx && tv !== tx && enforceTypes) {\n          throw new Error(`Mismatched data types encountered during object merge.`);\n        }\n        original[k] = v;\n      }\n\n      // 1.4 - Insert new value\n      else if (x === undefined && insertValues) {\n        original[k] = v;\n      }\n    }\n\n    // Case 2 - Key does not exist\n    else if (!toDelete) {\n      const canInsert = (depth === 1 && insertKeys) || (depth > 1 && insertValues);\n      if (canInsert) original[k] = v;\n    }\n  }\n\n  // Return the object for use\n  return original;\n};\n\nexport const naturalSort = function (arr, propertyKey = \"\") {\n  return arr.sort((a, b) => {\n    const propA = propertyKey ? getProperty(a, propertyKey) : a;\n    const propB = propertyKey ? getProperty(b, propertyKey) : b;\n    return new Intl.Collator(game.settings.get(\"core\", \"language\"), { numeric: true }).compare(propA, propB);\n  });\n};\n\nexport const createConsumableSpellDialog = async function (itemData, { allowSpell = true } = {}) {\n  const slcl = CONFIG.Item.documentClasses.spell.getMinimumCasterLevelBySpellData(itemData);\n  const content = await renderTemplate(\"systems/ffd20/templates/internal/create-consumable.hbs\", {\n    name: itemData.name,\n    sl: slcl[0],\n    cl: slcl[1],\n  });\n\n  const getData = function (html) {\n    const data = itemData;\n    data.sl = parseInt(html.find(`[name=\"sl\"]`).val());\n    data.cl = parseInt(html.find(`[name=\"cl\"]`).val()) || 1;\n    // NaN check here to allow SL 0\n    if (Number.isNaN(data.sl)) data.sl = 1;\n    return data;\n  };\n\n  return new Promise((resolve) => {\n    const dialogData = {\n      title: game.i18n.localize(\"FFD20.CreateItemForSpell\").format(itemData.name),\n      content,\n      itemData,\n      buttons: {\n        potion: {\n          icon: '<i class=\"fas fa-prescription-bottle\"></i>',\n          label: game.i18n.localize(\"FFD20.CreateItemPotion\"),\n          callback: (html) => resolve(createConsumableSpell(getData(html), \"potion\")),\n        },\n        scroll: {\n          icon: '<i class=\"fas fa-scroll\"></i>',\n          label: game.i18n.localize(\"FFD20.CreateItemScroll\"),\n          callback: (html) => resolve(createConsumableSpell(getData(html), \"scroll\")),\n        },\n        wand: {\n          icon: '<i class=\"fas fa-magic\"></i>',\n          label: game.i18n.localize(\"FFD20.CreateItemWand\"),\n          callback: (html) => resolve(createConsumableSpell(getData(html), \"wand\")),\n        },\n        spell: {\n          icon: '<i class=\"fas fa-hand-sparkles\"></i>',\n          label: game.i18n.localize(\"FFD20.ItemTypeSpell\"),\n          callback: () => resolve(\"spell\"),\n        },\n      },\n      close: () => {\n        resolve(false);\n      },\n      default: \"potion\",\n    };\n    if (!allowSpell) delete dialogData.buttons.spell;\n    new Dialog(dialogData, { classes: [\"dialog\", \"ffd20\", \"create-consumable\"] }).render(true);\n  });\n};\n\nexport const createConsumableSpell = async function (itemData, type) {\n  const data = await CONFIG.Item.documentClasses.spell.toConsumable(itemData, type);\n\n  if (data._id) delete data._id;\n  return data;\n};\n\n/**\n * Adjusts a string to a number, allowing relative adjustments.\n *\n * @param {number} initialValue - The initial number to use for relative operations.\n * @param {string} cmdStr - The exact string inputted by the user.\n * @param {number} [maxValue=null] - The maximum allowed value for this variable.\n * @param {number} [clearValue=null] - What to change the variable to if the user simply erased the value.\n * @returns {number} The resulting new value.\n */\nexport const adjustNumberByStringCommand = function (initialValue, cmdStr, maxValue = null, clearValue = null) {\n  let result = initialValue;\n\n  if (cmdStr.match(/(=)?([+-]+)?(\\d+)/)) {\n    const operator = RegExp.$2;\n    const isAbsolute = RegExp.$1 == \"=\" || [\"--\", \"++\"].includes(operator) || (!RegExp.$1 && !RegExp.$2);\n    const isNegative = [\"-\", \"--\"].includes(operator);\n    const rawValue = parseInt(RegExp.$3, 10);\n    const value = isNegative ? -rawValue : rawValue;\n    result = isAbsolute ? value : initialValue + value;\n  } else if (cmdStr === \"\" && clearValue != null) {\n    result = clearValue;\n  } else {\n    result = parseFloat(cmdStr || \"0\");\n  }\n\n  if (maxValue) result = Math.min(result, maxValue);\n  if (Number.isNaN(result)) result = initialValue;\n\n  return result;\n};\n\nexport const colorToInt = function (color) {\n  const rgb = color.rgb().color;\n  const integer =\n    ((Math.round(rgb[0]) & 0xff) << 16) + ((Math.round(rgb[1]) & 0xff) << 8) + (Math.round(rgb[2]) & 0xff);\n\n  return integer;\n};\n\n/**\n * @typedef {object} BuffTargetItem\n * @property {string} [label] - The buff target's label.\n * @property {string} category - The buff target's category.\n * @property {string} [icon] - The URL to an icon.\n */\n/**\n * Assembles an array of all possible buff targets.\n *\n * @param {ActorFFD20} [actor] - An actor for which to specifically get buff targets.\n * @param {string} [type] - Can be set to \"contextNotes\" to get context notes instead.\n * @returns {Object<string, BuffTargetItem>} The resulting array of buff targets.\n */\nexport const getBuffTargets = function (actor, type = \"buffs\") {\n  const buffTargets = duplicate(\n    {\n      buffs: CONFIG.FFD20.buffTargets,\n      contextNotes: CONFIG.FFD20.contextNoteTargets,\n    }[type]\n  );\n\n  // Append individual skills to buff targets\n  if (actor) {\n    for (const s of actor._skillTargets) {\n      const sId = s.split(\".\").slice(1).join(\".\");\n      const skill = actor.getSkillInfo(sId);\n      buffTargets[s] = { label: skill.name, category: \"skill\" };\n    }\n  } else {\n    for (const [k, v] of Object.entries(CONFIG.FFD20.skills)) {\n      buffTargets[`skill.${k}`] = { label: v, category: \"skill\" };\n    }\n  }\n\n  return buffTargets;\n};\n\n/**\n * @typedef {object} BuffTargetCategory\n * @property {string} label - The category's label.\n */\n/**\n * Assembles an array of buff targets and their categories, ready to be inserted into a Widget_CategorizedItemPicker.\n *\n * @param {ActorFFD20} [actor] - An actor for which to specifically get buff targets.\n * @param {string} [type] - Can be set to \"contextNotes\" to get context notes instead.\n * @returns {Widget_CategorizedItemPicker~Category[]}\n */\nexport const getBuffTargetDictionary = function (actor, type = \"buffs\") {\n  const buffTargets = getBuffTargets(actor, type);\n\n  // Assemble initial categories and items\n  const targetCategories = duplicate(\n    {\n      buffs: CONFIG.FFD20.buffTargetCategories,\n      contextNotes: CONFIG.FFD20.contextNoteCategories,\n    }[type]\n  );\n  let categories = Object.entries(buffTargets).reduce((cur, o) => {\n    const key = o[0];\n    const label = o[1].label;\n    const category = o[1].category;\n    const icon = o[1].icon;\n\n    if (!key.startsWith(\"~\")) {\n      cur[category] = cur[category] || {\n        label: targetCategories[category].label,\n        items: [],\n      };\n      cur[category].items.push({ key, label, icon });\n    }\n    return cur;\n  }, {});\n\n  // Turn result into a usable format, and sort\n  categories = Object.entries(categories).reduce((cur, o) => {\n    const key = o[0];\n    const label = o[1].label;\n    const items = o[1].items;\n    cur.push({ key, label, items });\n    return cur;\n  }, []);\n  categories = naturalSort(categories, \"label\");\n\n  // Return result\n  return categories;\n};\n\n/**\n * A locale-safe insertion sort of an Array of Objects, not in place. Ignores punctuation and capitalization.\n *\n * @template T\n * @param {Array.<T & {name: string}>} inputArr - Array to be sorted. Each element must have a name property set\n * @returns {T[]} - New sorted Array\n */\nexport const sortArrayByName = function (inputArr) {\n  const n = inputArr.length;\n  inputArr = duplicate(inputArr).map((o) => {\n    o.name = o.name.toLocaleLowerCase();\n    return o;\n  });\n  for (let i = 1; i < n; i++) {\n    const current = inputArr[i],\n      currentLower = current.name;\n    let j = i - 1;\n    while (j > -1 && currentLower.localeCompare(inputArr[j].name, undefined, { ignorePunctuation: true }) < 0) {\n      inputArr[j + 1] = inputArr[j];\n      j--;\n    }\n    inputArr[j + 1] = current;\n  }\n  return inputArr;\n};\n\n/**\n * A simple binary search to be used on sorted arrays\n *\n * @template T\n * @param {T[]} searchArr - Sorted Array to be searched\n * @param {T} el - Element to be compared to array values\n * @param {function(T, T): number} compare_fn - Comparison function to be apply el to every element in ar. Should return an positive/ negative integer or 0 if matching.\n * @returns {number} Index where search is found or negative index indicating where it would be inserted\n */\nexport const binarySearch = function (searchArr, el, compare_fn) {\n  let m = 0,\n    n = searchArr.length - 1;\n  while (m <= n) {\n    const k = (n + m) >> 1,\n      cmp = compare_fn(el, searchArr[k]);\n    if (cmp > 0) {\n      m = k + 1;\n    } else if (cmp < 0) {\n      n = k - 1;\n    } else {\n      return k;\n    }\n  }\n  return -m - 1;\n};\n\n/**\n * Generate permutations of an array. Complexity is O(n!).\n * Should be safe up to 7, though you should probably consider something else if you're reaching that high often.\n *\n * @template T\n * @param {T[]} perm - The Array to be generated upon\n * @returns {Array.<T[]>|false} An Array containing all Array permutations or false if failed.\n */\nfunction uniquePermutations(perm) {\n  const total = new Set();\n  if (perm.length > 7) {\n    console.warn(\"Array too large. Not attempting.\", perm);\n    return false;\n  }\n\n  for (let i = 0; i < perm.length; i = i + 1) {\n    const rest = uniquePermutations(perm.slice(0, i).concat(perm.slice(i + 1)));\n\n    if (!rest.length) {\n      total.add([perm[i]]);\n    } else {\n      for (let j = 0; j < rest.length; j = j + 1) {\n        total.add([perm[i]].concat(rest[j]));\n      }\n    }\n  }\n  return [...total];\n}\n\n/**\n * Searches through compendia quickly using the system generated index caches.\n * Exact matches excluding punctuation and case are prioritized before searching word order permutations.\n *\n * @param {string} searchTerm - The name of the Document being searched for\n * @param {object} [options] - Provides a filter to limit search to specific packs or Document types\n * @param {string[]} [options.packs] - An array of packs to search in\n * @param {\"Actor\"|\"Item\"|\"Scene\"|\"JournalEntry\"|\"Macro\"|\"RollTable\"|\"Playlist\"} [options.type] - A Document type to limit which packs are searched in\n * @returns {{pack: CompendiumCollection, index: object}|undefined} The index and pack containing it or undefined if no match is found\n */\nexport const findInCompendia = function (searchTerm, options = { packs: [], type: undefined }) {\n  let packs;\n  if (options?.packs && options.packs.length) packs = options.packs.flatMap((o) => game.packs.get(o) ?? []);\n  else packs = game.packs.filter((o) => !options?.type || o.metadata.type == options.type);\n\n  searchTerm = searchTerm.toLocaleLowerCase();\n  let found, foundDoc, foundPack;\n  for (const pack of packs) {\n    if (!pack.fuzzyIndex) pack.fuzzyIndex = sortArrayByName([...pack.index]);\n    found = binarySearch(pack.fuzzyIndex, searchTerm, (sp, it) =>\n      sp.localeCompare(it.name, undefined, { ignorePunctuation: true })\n    );\n    if (found > -1) {\n      foundDoc = pack.index.get(pack.fuzzyIndex[found]._id);\n      foundPack = pack;\n      break;\n    }\n  }\n  if (foundDoc) return { pack: foundPack, index: foundDoc };\n\n  let searchMutations = uniquePermutations(searchTerm.split(/[ _-]/));\n  if (searchMutations) searchMutations = searchMutations.map((o) => o.join(\" \"));\n  else {\n    // If array is too long, search for just a reversed version and one that pivots around commas/ semicolons\n    searchMutations = [null];\n    searchMutations.push(searchTerm.split(/[ _-]/).reverse().join(\" \"));\n    searchMutations.push(\n      searchTerm\n        .split(/[,;] ?/)\n        .reverse()\n        .flatMap((o) => o.split(\" \"))\n        .join(\" \")\n    );\n  }\n\n  for (const pack of packs) {\n    // Skip first mutation since it is already searched for manually before computing mutations\n    for (let mut = 1; mut < searchMutations.length; mut++) {\n      found = binarySearch(pack.fuzzyIndex, searchMutations[mut], (sp, it) =>\n        sp.localeCompare(it.name, undefined, { ignorePunctuation: true })\n      );\n      if (found > -1) {\n        foundDoc = pack.index.get(pack.fuzzyIndex[found]._id);\n        foundPack = pack;\n        break;\n      }\n    }\n    if (foundDoc) break;\n  }\n\n  if (foundDoc) return { pack: foundPack, index: foundDoc };\n  return false;\n};\n\n/**\n * Removes flairs from a formula.\n *\n * @param {string} formula\n */\nexport function stripRollFlairs(formula) {\n  return formula.replace(/\\[[^\\]]*]/g, \"\");\n}\n\n/**\n * Simplifies formula to very basic level.\n *\n * @param {string} formula Roll formula\n * @param {object} rollData Roll data\n * @param {object} safeEvalOpts Options to Roll.safeEval\n */\nexport function simplifyFormula(formula, rollData = {}) {\n  const temp = [];\n  const terms = RollFFD20.parse(stripRollFlairs(formula), rollData);\n  for (const term of terms) {\n    if (term instanceof DiceTerm || term instanceof OperatorTerm) {\n      temp.push(term);\n    } else if (term.isDeterministic) {\n      const evl = RollFFD20.safeTotal(term.formula);\n      temp.push(...RollFFD20.parse(`${evl}`));\n    } else {\n      temp.push(term);\n    }\n  }\n\n  // Combine simple terms (e.g. 5+3)\n  const temp2 = [];\n  let prev, term;\n  while (temp.length) {\n    prev = term;\n    term = temp.shift();\n    const next = temp[0];\n    if (term instanceof OperatorTerm) {\n      // Ternary handling\n      if (term.operator === \"?\") {\n        temp.shift(); // remove if-true val\n        const elseOp = temp.shift();\n        const falseVal = temp.shift();\n        const simpler = RollFFD20.safeEval(\n          [prev.formula, term.formula, next.formula, elseOp?.formula ?? \"\", falseVal?.formula ?? \"\"].join(\"\")\n        );\n        term = RollFFD20.parse(`${simpler}`)[0];\n        temp2.pop(); // Remove last term\n      } else if (prev instanceof NumericTerm && next instanceof NumericTerm) {\n        const simpler = RollFFD20.safeEval([prev.formula, term.formula, next.formula].join(\"\"));\n        term = RollFFD20.parse(`${simpler}`)[0];\n        temp2.pop(); // Remove the last numeric term\n        temp.shift(); // Remove the next term\n      }\n    }\n    temp2.push(term);\n  }\n\n  return RollFFD20.simplifyTerms(temp2)\n    .map((tt) => tt.formula)\n    .join(\"\");\n}\n\n/**\n * Variant of TextEditor._createInlineRoll for creating unrolled inline rolls.\n *\n * @param _match\n * @param _command\n * @param formula\n * @param closing\n * @param label\n * @param {...any} args\n */\nexport function createInlineFormula(_match, _command, formula, closing, label, ...args) {\n  console.log(arguments);\n  const rollData = args.pop();\n  if (closing.length === 3) formula += \"]\";\n\n  const cls = [\"inline-preroll\", \"inline-formula\"];\n  let e_formula;\n  try {\n    e_formula = simplifyFormula(formula, rollData);\n  } catch (err) {\n    console.error(err);\n    e_formula = \"0\";\n  }\n  label = label ? `${label}: ${e_formula}` : e_formula;\n\n  // Format return value\n  const a = document.createElement(\"a\");\n  a.classList.add(...cls);\n  a.title = formula;\n  a.innerHTML = `<i class=\"fas fa-dice-d20\"></i> ${label}`;\n  return a;\n}\n\n/**\n * enrichHTML but with inline rolls not rolled\n *\n * @param content\n * @param root0\n * @param root0.rollData\n * @param root0.secrets\n * @param root0.rolls\n * @param root0.documents\n */\nexport function enrichHTMLUnrolled(content, { rollData, secrets, rolls, documents } = {}) {\n  let pcontent = TextEditor.enrichHTML(content, { secrets, rolls, documents, rollData, async: false });\n\n  if (!rolls) {\n    const html = document.createElement(\"div\");\n    html.innerHTML = String(pcontent);\n    const text = TextEditor._getTextNodes(html);\n    const rgx = /\\[\\[(\\/[a-zA-Z]+\\s)?(.*?)([\\]]{2,3})(?:{([^}]+)})?/gi;\n    TextEditor._replaceTextContent(text, rgx, (...args) => createInlineFormula(...args, rollData));\n    pcontent = html.innerHTML;\n  }\n\n  return pcontent;\n}\n\n/**\n * Split copper gil currency into gil, silver gil and copper gil.\n *\n  * @param cgil\n */\nexport const splitCurrency = (cgil) => {\n  const gil = Math.floor(cgil / 100);\n  const sgil = Math.floor(cgil / 10) - gil * 10;\n  cgil = cgil - gil * 100 - sgil * 10;\n  return {\n    gil: Math.max(0, gil),\n    sgil: Math.max(0, sgil),\n    cgil: Math.max(0, cgil),\n  };\n};\n\n/**\n * Get first active GM user.\n *\n * @returns {User}\n */\nexport const getFirstActiveGM = function () {\n  return game.users.filter((u) => u.active && u.isGM).sort((a, b) => b.id - a.id)[0];\n};\n\n/**\n * Check whether at least one GM is active.\n */\nexport const isGMActive = function () {\n  return game.users.some((u) => u.active && u.isGM);\n};\n\n/**\n * @param formula\n * @param type\n * @param rollData\n */\nexport function calculateRangeFormula(formula, type = \"ft\", rollData = {}) {\n  switch (type) {\n    case \"melee\":\n    case \"touch\":\n      return getProperty(rollData, \"range.melee\") ?? 0;\n    case \"reach\":\n      return getProperty(rollData, \"range.reach\") ?? 0;\n    case \"close\":\n      return RollFFD20.safeRoll(CONFIG.FFD20.spellRangeFormulas.close, rollData).total;\n    case \"medium\":\n      return RollFFD20.safeRoll(CONFIG.FFD20.spellRangeFormulas.medium, rollData).total;\n    case \"long\":\n      return RollFFD20.safeRoll(CONFIG.FFD20.spellRangeFormulas.long, rollData).total;\n    case \"mi\":\n      return RollFFD20.safeRoll(formula, rollData).total * 5_280;\n    default:\n      return RollFFD20.safeRoll(formula, rollData).total;\n  }\n}\n\n/**\n * Calculates range formula and converts it.\n *\n * @param formula\n * @param type\n * @param rollData\n */\nexport function calculateRange(formula, type = \"ft\", rollData = {}) {\n  if (type == null) return null;\n  const value = calculateRangeFormula(formula, type, rollData);\n  return convertDistance(value)[0];\n}\n\n/**\n * Refreshes all actor data and re-renders sheets.\n *\n * @param options\n */\nexport function refreshActors(options = { renderOnly: false, renderForEveryone: false }) {\n  game.actors.contents.forEach((o) => {\n    if (!options.renderOnly) o.reset();\n    if (o.sheet != null && o.sheet._state > 0) o.sheet.render();\n  });\n  Object.values(game.actors.tokens).forEach((o) => {\n    if (o) {\n      if (!options.renderOnly) o.reset();\n      if (o.sheet != null && o.sheet._state > 0) o.sheet.render();\n    }\n  });\n\n  if (options.renderForEveryone) {\n    game.socket.emit(\"ffd20\", \"refreshActorSheets\");\n  }\n}\n\n/**\n * Turns dictionaries with numbered keys into arrays.\n *\n * @param {object} sourceObj The source object which contains the full array in the same path as targetObj.\n * @param {object} targetObj The target object to alter. The array doesn't have to be immediately in this object.\n * @param {string} keepPath A path to the array to keep, separated with dots. e.g. \"data.damageParts\".\n */\nexport function keepUpdateArray(sourceObj, targetObj, keepPath) {\n  const subData = Object.entries(targetObj).filter((e) => e[0].startsWith(`${keepPath}.`));\n\n  if (subData.length > 0) {\n    const arr = deepClone(getProperty(sourceObj, keepPath) || []);\n    const keySeparatorCount = (keepPath.match(/\\./g) || []).length;\n    subData.forEach((entry) => {\n      const subKey = entry[0].split(\".\").slice(keySeparatorCount + 1);\n      const i = subKey[0];\n      const subKey2 = subKey.slice(1).join(\".\");\n      if (!arr[i]) arr[i] = {};\n\n      // Single entry array\n      if (!subKey2) {\n        arr[i] = entry[1];\n      }\n      // Remove property\n      else if (subKey[subKey.length - 1].startsWith(\"-=\")) {\n        const obj = flattenObject(arr[i]);\n        subKey[subKey.length - 1] = subKey[subKey.length - 1].slice(2);\n        const deleteKeys = Object.keys(obj).filter((o) => o.startsWith(subKey.slice(1).join(\".\")));\n        for (const k of deleteKeys) {\n          if (Object.prototype.hasOwnProperty.call(obj, k)) {\n            delete obj[k];\n          }\n        }\n        arr[i] = expandObject(obj);\n      }\n      // Add or change property\n      else {\n        arr[i] = mergeObject(arr[i], expandObject({ [subKey2]: entry[1] }));\n      }\n\n      delete targetObj[entry[0]];\n    });\n\n    targetObj[keepPath] = arr;\n  }\n}\n\n/**\n * Deeply difference an object against some other, returning the update keys and values.\n * Unlike foundry.utils.diffObject, this function also deeply compares arrays.\n *\n * @param {object} original       An object comparing data against which to compare\n * @param {object} other          An object containing potentially different data\n * @param {object} [options={}]   Additional options which configure the diff operation\n * @param {boolean} [options.inner=false]  Only recognize differences in other for keys which also exist in original\n * @param {boolean} [options.keepLength=false]  Keep array length intact, possibly having to insert empty objects\n * @returns {object}               An object of the data in other which differs from that in original\n */\nexport const diffObjectAndArray = function (original, other, { inner = false, keepLength = false } = {}) {\n  /**\n   *\n   * @param v0\n   * @param v1\n   */\n  function _difference(v0, v1) {\n    const t0 = getType(v0);\n    const t1 = getType(v1);\n    if (t0 !== t1) return [true, v1];\n    if (t0 === \"Array\") {\n      if (v0.length !== v1.length) return [true, v1];\n      const d = [];\n      for (let a = 0; a < v0.length; a++) {\n        const d2 = diffObjectAndArray(v0[a], v1[a], { inner, keepLength });\n        if (!foundry.utils.isEmpty(d2)) d.push(d2);\n        else if (keepLength) d.push({});\n      }\n      if (d.length > 0) return [true, d];\n      return [false, d];\n    }\n    if (t0 === \"Object\") {\n      if (foundry.utils.isEmpty(v0) !== foundry.utils.isEmpty(v1)) return [true, v1];\n      const d = diffObjectAndArray(v0, v1, { inner, keepLength });\n      return [!foundry.utils.isEmpty(d), d];\n    }\n    return [v0 !== v1, v1];\n  }\n\n  // Recursively call the _difference function\n  return Object.keys(other).reduce((obj, key) => {\n    if (inner && !(key in original)) return obj;\n    const [isDifferent, difference] = _difference(original[key], other[key]);\n    if (isDifferent) obj[key] = difference;\n    return obj;\n  }, {});\n};\n\n/**\n * Determines what ability modifier is appropriate for a given score.\n *\n * @param {number} [score] - The score to find the modifier for.\n * @param {object} [options={}] - Options for this function.\n * @param {number} [options.penalty=0] - A penalty value to take into account.\n * @param {number} [options.damage=0] - Ability score damage to take into account.\n * @returns {number} The modifier for the given score.\n */\nexport function getAbilityModifier(score = null, options = {}) {\n  if (score != null) {\n    const penalty = Math.abs(options.penalty ?? 0);\n    const damage = Math.abs(options.damage ?? 0);\n    return Math.max(-5, Math.floor((score - 10) / 2) - Math.floor(penalty / 2) - Math.floor(damage / 2));\n  }\n  return 0;\n}\n\n/**\n * Recursively transforms an ES module to a regular, writable object.\n *\n * @template T\n * @param {T} module - The ES module to transform.\n * @returns {T} The transformed module.\n */\nexport function moduleToObject(module) {\n  const result = {};\n  for (const key in module) {\n    if (Object.prototype.toString.call(module[key]) === \"[object Module]\") {\n      result[key] = moduleToObject(module[key]);\n    } else {\n      result[key] = module[key];\n    }\n  }\n  return result;\n}\n","import { convertDistance, calculateRange, simplifyFormula } from \"../lib.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\n\nexport const registerHandlebarsHelpers = function () {\n  Handlebars.registerHelper(\"convertDistance\", (value) => (Number.isFinite(value) ? convertDistance(value)[0] : value));\n  Handlebars.registerHelper(\"distanceUnit\", (type) => convertDistance(0, type)[1]);\n\n  Handlebars.registerHelper(\"itemRange\", (item, rollData) => {\n    if (!item.document?.firstAction?.hasRange) return null;\n    const action = item.document.firstAction;\n\n    const range = action.data.range.value;\n    const rangeType = action.data.range.units;\n\n    if (rangeType == null) return null;\n\n    const ft = calculateRange(range, rangeType, rollData);\n    if (ft && typeof ft !== \"string\") {\n      const rv = convertDistance(range);\n      return `${ft} ${rv[1]}`;\n    } else {\n      return \"\" + (ft ?? \"\");\n    }\n  });\n\n  /**\n   *\n   * @param action\n   * @param rollData\n   * @param options\n   */\n  function actionDamage(action, rollData, options) {\n    if (!action.hasDamage) return null;\n\n    const actor = action.actor,\n      item = action.parent,\n      actorData = actor?.system,\n      actionData = action.data;\n\n    const rv = [];\n\n    const handleFormula = (formula, change) => {\n      // Ensure @item.level and similar gets parsed correctly\n      const rd = change?.parent?.getRollData() ?? rollData;\n      const roll = RollFFD20.safeRoll(formula, rd);\n      if (roll.total !== 0) {\n        const newformula = simplifyFormula(roll.formula);\n        rv.push(newformula);\n      }\n    };\n\n    const handleParts = (parts) => parts.forEach(([formula, _]) => handleFormula(formula));\n\n    // Normal damage parts\n    handleParts(actionData.damage.parts);\n\n    // Include ability score only if the string isn't too long yet\n    const dmgAbl = actionData.ability.damage;\n    const dmgAblMod = Math.floor((actorData?.abilities[dmgAbl]?.mod ?? 0) * (actionData.ability.damageMult || 1));\n    if (dmgAblMod != 0) rv.push(dmgAblMod);\n\n    // Include damage parts that don't happen on crits\n    handleParts(actionData.damage.nonCritParts);\n\n    // Include general sources. Item enhancement bonus is among these.\n    item.getAllDamageSources(action.id)?.forEach((s) => handleFormula(s.formula, s));\n\n    if (rv.length === 0) rv.push(\"NaN\"); // Something probably went wrong\n\n    return rv\n      .join(\"+\")\n      .replace(/\\s+/g, \"\") // remove whitespaces\n      .replace(/\\+-/, \"-\") // simplify math logic pt.1\n      .replace(/--/g, \"+\") // simplify math logic pt.2\n      .replace(/\\+\\++/, \"+\"); // simplify math logic pt.3\n  }\n\n  Handlebars.registerHelper(\"actionDamage\", actionDamage);\n\n  Handlebars.registerHelper(\"damageTypes\", (typeInfo) => {\n    const rv = [];\n    const { custom, values } = typeInfo;\n    if (custom) rv.push(custom);\n    values.forEach((dtId) => rv.push(game.i18n.localize(ffd20.registry.damageTypes.get(dtId)?.name ?? \"FFD20.Undefined\")));\n    return rv.join(\", \");\n  });\n\n  Handlebars.registerHelper(\"itemDamage\", (item, rollData) => {\n    console.warn(\"{{itemDamage}} handlebars helper is deprecated, use {{actionDamage}} instead\");\n    const action = item.document?.firstAction;\n    return actionDamage(action, rollData);\n  });\n\n  Handlebars.registerHelper(\"itemAttacks\", (item) => {\n    const attacks = item.document.attackArray;\n    const highest = Math.max(...attacks); // Highest bonus, with assumption the first might not be that.\n    return `${attacks.length} (${highest < 0 ? highest : `+${highest}`}${attacks.length > 1 ? \"/…\" : \"\"})`;\n  });\n\n  /**\n   * Returns true if there are conditionals disabled by default.\n   */\n  Handlebars.registerHelper(\"optionalConditionals\", (item) => {\n    return item.firstAction?.data.conditionals.find((c) => !c.default);\n  });\n\n  // Fetches ability mod value based on ability key.\n  // Avoids contaminating rollData or item data with excess strings.\n  Handlebars.registerHelper(\"abilityMod\", (abl, rollData, multiplier) => {\n    return Math.floor(rollData.abilities[abl]?.mod * multiplier ?? 1);\n  });\n\n  Handlebars.registerHelper(\"hasContextNotes\", (actor, context) => {\n    return !!actor.getContextNotes(context).find((n) => n.notes.length);\n  });\n\n  Handlebars.registerHelper(\"contextNotes\", (actor, context, options) => {\n    const rollData = options.data.root.rollData;\n    const noteObjs = actor.getContextNotes(context);\n    return actor.formatContextNotes(noteObjs, rollData);\n  });\n\n  Handlebars.registerHelper(\"enrich\", (content, options) => {\n    const owner = Boolean(options.hash[\"owner\"]);\n    const rollData = options.hash[\"rollData\"];\n    return new Handlebars.SafeString(TextEditor.enrichHTML(content, { secrets: owner, rollData, async: false }));\n  });\n\n  Handlebars.registerHelper(\"json-string\", (obj) => {\n    return new Handlebars.SafeString(escape(JSON.stringify(obj)));\n  });\n\n  Handlebars.registerHelper(\"halfNumber\", (value) => {\n    value = typeof value === \"number\" ? value : parseFloat(value);\n    return new Handlebars.SafeString(Math.floor(value / 2).toString());\n  });\n\n  Handlebars.registerHelper(\"arrayHas\", (options) => {\n    const array = options.hash[\"array\"];\n    const value = options.hash[\"value\"];\n    return array.includes(value);\n  });\n};\n","export const tinyMCEInit = function () {\r\n  CONFIG.TinyMCE.content_css.push(\"/systems/ffd20/ui/mce.css\");\r\n\r\n  CONFIG.TinyMCE.style_formats[0].items.push(\r\n    {\r\n      title: game.i18n.localize(\"FFD20.NotImplemented\"),\r\n      inline: \"span\",\r\n      classes: \"notImp\",\r\n      attributes: { title: game.i18n.localize(\"FFD20.NotImplemented\") },\r\n      remove: \"all\",\r\n    },\r\n    {\r\n      title: game.i18n.localize(\"FFD20.StepsRequired\"),\r\n      inline: \"span\",\r\n      classes: \"needSteps\",\r\n      attributes: { title: game.i18n.localize(\"FFD20.StepsRequired\") },\r\n      remove: \"all\",\r\n    }\r\n  );\r\n  CONFIG.TinyMCE.formats = Object.assign({}, CONFIG.TinyMCE.formats, {\r\n    removeFormat: [{ selector: \"span\", classes: \"notImp,needSteps\", remove: \"all\" }],\r\n  });\r\n\r\n  tinyMCE.on(\"addeditor\", (ev) => {\r\n    registerContextMenu(ev.editor);\r\n  });\r\n};\r\n\r\n/**\r\n * @param editor\r\n */\r\nfunction registerContextMenu(editor) {\r\n  const isInfoElement = function (node) {\r\n    if (node.nodeName.toLowerCase() !== \"span\") node = node.parentNode;\r\n    return (\r\n      node.nodeName.toLowerCase() === \"span\" &&\r\n      (node.classList.contains(\"notImp\") || node.classList.contains(\"needSteps\"))\r\n    );\r\n  };\r\n\r\n  const getInfoElement = function () {\r\n    const node = editor.selection.getNode();\r\n    return isInfoElement(node) ? node.closest(\"span.notImp,span.needSteps\") : null;\r\n  };\r\n\r\n  editor.ui.registry.addContextForm(\"info-form\", {\r\n    launch: {\r\n      type: \"contextformtogglebutton\",\r\n      icon: \"warning\",\r\n    },\r\n    label: \"Info\",\r\n    predicate: isInfoElement,\r\n    initValue: function () {\r\n      const elm = getInfoElement();\r\n      return elm ? elm.title : \"\";\r\n    },\r\n    commands: [\r\n      {\r\n        type: \"contextformtogglebutton\",\r\n        icon: \"warning\",\r\n        tooltip: game.i18n.localize(\"FFD20.NotImplemented\"),\r\n        onSetup: function (buttonApi) {\r\n          buttonApi.setActive(!!getInfoElement()?.classList.contains(\"notImp\"));\r\n          const nodeChangeHandler = function () {\r\n            buttonApi.setActive(!editor.readonly && getInfoElement()?.classList.contains(\"notImp\"));\r\n          };\r\n          editor.on(\"nodechange\", nodeChangeHandler);\r\n          return function () {\r\n            editor.off(\"nodechange\", nodeChangeHandler);\r\n          };\r\n        },\r\n        onAction: function (formApi) {\r\n          const value = formApi.getValue(),\r\n            node = getInfoElement();\r\n          editor.setDirty(true);\r\n          editor.dom.setAttribs(node, { title: value, class: \"notImp\" });\r\n          formApi.hide();\r\n        },\r\n      },\r\n      {\r\n        type: \"contextformtogglebutton\",\r\n        icon: \"selected\",\r\n        tooltip: game.i18n.localize(\"FFD20.StepsRequired\"),\r\n        onSetup: function (buttonApi) {\r\n          buttonApi.setActive(!!getInfoElement()?.classList.contains(\"needSteps\"));\r\n          const nodeChangeHandler = function () {\r\n            buttonApi.setActive(!editor.readonly && getInfoElement()?.classList.contains(\"needSteps\"));\r\n          };\r\n          editor.on(\"nodechange\", nodeChangeHandler);\r\n          return function () {\r\n            editor.off(\"nodechange\", nodeChangeHandler);\r\n          };\r\n        },\r\n        onAction: function (formApi) {\r\n          const value = formApi.getValue(),\r\n            node = getInfoElement();\r\n          editor.setDirty(true);\r\n          editor.dom.setAttribs(node, { title: value, class: \"needSteps\" });\r\n          formApi.hide();\r\n        },\r\n      },\r\n      {\r\n        type: \"contextformtogglebutton\",\r\n        icon: \"close\",\r\n        tooltip: game.i18n.localize(\"FFD20.RemoveInfo\"),\r\n        onAction: function (formApi) {\r\n          const node = getInfoElement();\r\n          editor.setDirty(true);\r\n          editor.dom.remove(node, true);\r\n          formApi.hide();\r\n        },\r\n      },\r\n    ],\r\n  });\r\n}\r\n","import { measureDistance as unifiedMeasureDistance } from \"./lib.mjs\";\n\n/**\n * Measure the distance between two pixel coordinates\n * See BaseGrid.measureDistance for more details\n *\n * @param segments\n * @param options\n */\nexport const measureDistances = function (segments, options = {}) {\n  if (!options.gridSpaces) return BaseGrid.prototype.measureDistances.call(this, segments, options);\n\n  // Track the total number of diagonals\n  const diagonalRule = this.parent.diagonalRule;\n  const state = { diagonals: 0 };\n\n  // Iterate over measured segments\n  return segments.map((s) => unifiedMeasureDistance(null, null, { ray: s.ray, diagonalRule, state }));\n};\n\n/* -------------------------------------------- */\n\n/**\n * Condition/ status effects section\n */\nexport const getConditions = function () {\n  const core = CONFIG.statusEffects;\n  let sys = Object.keys(CONFIG.FFD20.conditions).map((c) => ({\n    id: c,\n    label: CONFIG.FFD20.conditions[c],\n    icon: CONFIG.FFD20.conditionTextures[c],\n  }));\n  if (game.settings.get(\"ffd20\", \"coreEffects\")) sys.push(...core);\n  else sys = [core[0]].concat(sys);\n  return sys.sort((a, b) => a.label.localeCompare(b.label));\n};\n\nconst _TokenHUD_getStatusEffectChoices = TokenHUD.prototype._getStatusEffectChoices;\nTokenHUD.prototype._getStatusEffectChoices = function () {\n  const core = _TokenHUD_getStatusEffectChoices.call(this),\n    buffs = {};\n  // Only add buff textures for actors with that function (so not e.g. basic actors)\n  if (this.object.actor?._calcBuffActiveEffects) {\n    Object.values(this.object.actor._calcBuffActiveEffects()).forEach((obj, ind) => {\n      const buff = obj;\n      if (buffs[buff.icon] && buff.label) buff.icon += \"?\" + ind;\n      if (buff) {\n        buffs[buff.icon] = {\n          id: buff.id,\n          title: buff.label,\n          src: buff.icon,\n          isActive: buff.active,\n          isOverlay: false,\n          cssClass: buff.active ? \"active\" : \"\",\n        };\n      }\n    });\n  }\n  return Object.assign({}, core, buffs);\n};\n\n//const TokenHUD__onToggleEffect = TokenHUD.prototype._onToggleEffect;\nTokenHUD.prototype._onToggleEffect = function (event, { overlay = false } = {}) {\n  event.preventDefault();\n  const img = event.currentTarget;\n  const effect =\n    img.dataset.statusId && this.object.actor\n      ? CONFIG.statusEffects.find((e) => e.id === img.dataset.statusId) ?? img.dataset.statusId\n      : img.getAttribute(\"src\");\n  return this.object.toggleEffect(effect, { overlay });\n};\n","import { degtorad, measureDistance } from \"../utils/lib.mjs\";\n\n/**\n * Applies patches to core functions to integrate Pathfinder specific measurements.\n */\nexport class TemplateLayerFFD20 extends TemplateLayer {\n  // Foundry does not respect CONFIG.MeasuredTemplate.documentClass and CONFIG.MeasuredTemplate.objectClass\n  async _onDragLeftStart(event) {\n    if (!game.settings.get(\"ffd20\", \"measureStyle\")) return super._onDragLeftStart(event);\n\n    // Call placeables layer super instead of templatelayer\n    const origin = duplicate(event.data.origin);\n    await PlaceablesLayer.prototype._onDragLeftStart.call(this, event);\n\n    // Create the new preview template\n    const tool = game.activeTool;\n    const { originalEvent } = event.data;\n\n    // Snap to grid\n    if (!originalEvent.shiftKey) {\n      const pos = canvas.grid.getSnappedPosition(origin.x, origin.y, this.gridPrecision);\n      origin.x = pos.x;\n      origin.y = pos.y;\n    }\n\n    // Create the template\n    const data = {\n      user: game.user.id,\n      t: tool,\n      x: origin.x,\n      y: origin.y,\n      distance: 1,\n      direction: 0,\n      fillColor: game.user.color || \"#FF0000\",\n    };\n\n    // Apply some type-specific defaults\n    const defaults = CONFIG.MeasuredTemplate.defaults;\n    if (tool === \"cone\") data[\"angle\"] = defaults.angle;\n    else if (tool === \"ray\") data[\"width\"] = defaults.width * canvas.dimensions.distance;\n\n    // Create a preview template\n    const doc = new CONFIG.MeasuredTemplate.documentClass(data, { parent: canvas.scene });\n    const template = new CONFIG.MeasuredTemplate.objectClass(doc);\n    event.data.preview = this.preview.addChild(template);\n    return template.draw();\n  }\n\n  _onDragLeftMove(event) {\n    if (!game.settings.get(\"ffd20\", \"measureStyle\")) return super._onDragLeftMove(event);\n\n    const { destination, createState, preview, origin } = event.data;\n    if (createState === 0) return;\n\n    const { originalEvent } = event.data;\n\n    // Snap the destination to the grid\n    const snapToGrid = !originalEvent.shiftKey;\n    if (snapToGrid) {\n      event.data.destination = canvas.grid.getSnappedPosition(destination.x, destination.y, 2);\n    }\n\n    // Compute the ray\n    const ray = new Ray(origin, destination);\n    const dist = canvas.dimensions.distance;\n    const ratio = canvas.dimensions.size / dist;\n\n    // Update the preview object\n    const type = preview.document.t;\n    const cellSize = canvas.dimensions.distance;\n    // Set direction\n    const baseDirection = Math.normalizeDegrees(Math.toDegrees(ray.angle));\n    if (snapToGrid && [\"cone\", \"circle\"].includes(type)) {\n      const halfAngle = CONFIG.MeasuredTemplate.defaults.angle / 2;\n      preview.document.direction = Math.floor((baseDirection + halfAngle / 2) / halfAngle) * halfAngle;\n    } else if (snapToGrid && type === \"ray\") {\n      preview.document.direction = Math.floor((baseDirection + cellSize / 2) / cellSize) * cellSize;\n    } else {\n      preview.document.direction = baseDirection;\n    }\n    // Set distance\n    const baseDistance = ray.distance / ratio;\n    if (snapToGrid && [\"cone\", \"circle\", \"ray\"].includes(type)) {\n      preview.document.distance = Math.floor(baseDistance / dist) * dist;\n    } else {\n      preview.document.distance = baseDistance;\n    }\n    preview.refresh();\n\n    // Confirm the creation state\n    event.data.createState = 2;\n  }\n}\n\nexport class MeasuredTemplateFFD20 extends MeasuredTemplate {\n  getHighlightedSquares() {\n    if (!game.settings.get(\"ffd20\", \"measureStyle\") || ![\"circle\", \"cone\", \"ray\"].includes(this.document.t)) return [];\n\n    const grid = canvas.grid,\n      d = canvas.dimensions;\n\n    if (!this.id || !this.shape) return [];\n\n    // Parse rays as per Bresenham's algorithm\n    if (this.document.t === \"ray\") {\n      const result = [];\n\n      const s = d.size;\n      const line = function (x0, y0, x1, y1) {\n        x0 = Math.floor(Math.floor(x0) / s);\n        x1 = Math.floor(Math.floor(x1) / s);\n        y0 = Math.floor(Math.floor(y0) / s);\n        y1 = Math.floor(Math.floor(y1) / s);\n\n        const dx = Math.abs(x1 - x0);\n        const dy = Math.abs(y1 - y0);\n        const sx = x0 < x1 ? 1 : -1;\n        const sy = y0 < y1 ? 1 : -1;\n        let err = dx - dy;\n\n        while (!(x0 === x1 && y0 === y1)) {\n          result.push({ x: x0 * s, y: y0 * s });\n          const e2 = err << 1;\n          if (e2 > -dy) {\n            err -= dy;\n            x0 += sx;\n          }\n          if (e2 < dx) {\n            err += dx;\n            y0 += sy;\n          }\n        }\n      };\n\n      // Extend ray by half a square for better highlight calculation\n      const ray = Ray.fromAngle(this.ray.A.x, this.ray.A.y, this.ray.angle, this.ray.distance + s / 2);\n\n      // Get resulting squares\n      line(ray.A.x, ray.A.y, ray.B.x, ray.B.y);\n\n      return result;\n    }\n\n    // Get number of rows and columns\n    const nr = Math.ceil((this.document.distance * 1.5) / d.distance / (d.size / grid.h)),\n      nc = Math.ceil((this.document.distance * 1.5) / d.distance / (d.size / grid.w));\n\n    // Get the center of the grid position occupied by the template\n    const x = this.document.x,\n      y = this.document.y;\n\n    const [cx, cy] = grid.getCenter(x, y),\n      [col0, row0] = grid.grid.getGridPositionFromPixels(cx, cy),\n      minAngle = (360 + ((this.document.direction - this.document.angle * 0.5) % 360)) % 360,\n      maxAngle = (360 + ((this.document.direction + this.document.angle * 0.5) % 360)) % 360;\n\n    const within_angle = function (min, max, value) {\n      min = (360 + (min % 360)) % 360;\n      max = (360 + (max % 360)) % 360;\n      value = (360 + (value % 360)) % 360;\n\n      if (min < max) return value >= min && value <= max;\n      return value >= min || value <= max;\n    };\n\n    const originOffset = { x: 0, y: 0 };\n    // Offset measurement for cones\n    // Offset is to ensure that cones only start measuring from cell borders, as in https://www.d20pfsrd.com/magic/#Aiming_a_Spell\n    if (this.document.t === \"cone\") {\n      // Degrees anticlockwise from pointing right. In 45-degree increments from 0 to 360\n      const dir = (this.document.direction >= 0 ? 360 - this.document.direction : -this.document.direction) % 360;\n      // If we're not on a border for X, offset by 0.5 or -0.5 to the border of the cell in the direction we're looking on X axis\n      const xOffset =\n        this.document.x % d.size != 0\n          ? Math.sign((1 * Math.round(Math.cos(degtorad(dir)) * 100)) / 100) / 2 // /2 turns from 1/0/-1 to 0.5/0/-0.5\n          : 0;\n      // Same for Y, but cos Y goes down on screens, we invert\n      const yOffset =\n        this.document.y % d.size != 0 ? -Math.sign((1 * Math.round(Math.sin(degtorad(dir)) * 100)) / 100) / 2 : 0;\n      originOffset.x = xOffset;\n      originOffset.y = yOffset;\n    }\n\n    const result = [];\n    for (let a = -nc; a < nc; a++) {\n      for (let b = -nr; b < nr; b++) {\n        // Position of cell's top-left corner, in pixels\n        const [gx, gy] = canvas.grid.grid.getPixelsFromGridPosition(col0 + a, row0 + b);\n        // Position of cell's center, in pixels\n        const [cellCenterX, cellCenterY] = [gx + d.size * 0.5, gy + d.size * 0.5];\n\n        // Determine point of origin\n        const origin = { x: this.document.x, y: this.document.y };\n        origin.x += originOffset.x * d.size;\n        origin.y += originOffset.y * d.size;\n\n        const ray = new Ray(origin, { x: cellCenterX, y: cellCenterY });\n\n        const rayAngle = (360 + ((ray.angle / (Math.PI / 180)) % 360)) % 360;\n        if (this.document.t === \"cone\" && ray.distance > 0 && !within_angle(minAngle, maxAngle, rayAngle)) {\n          continue;\n        }\n\n        // Determine point we're measuring the distance to - always in the center of a grid square\n        const destination = { x: cellCenterX, y: cellCenterY };\n\n        const distance = measureDistance(destination, origin);\n        if (distance <= this.document.distance) {\n          result.push({ x: gx, y: gy });\n        }\n      }\n    }\n\n    return result;\n  }\n\n  getTokensWithin() {\n    const highlightSquares = this.getHighlightedSquares(),\n      d = canvas.dimensions;\n\n    const inRect = function (point, rect) {\n      return point.x >= rect.x && point.x < rect.x + rect.width && point.y >= rect.y && point.y < rect.y + rect.height;\n    };\n\n    const result = [];\n    for (const s of highlightSquares) {\n      for (const t of canvas.tokens.placeables) {\n        if (result.includes(t)) continue;\n\n        const tokenData = {\n          x: Math.round(t.document.x / d.size),\n          y: Math.round(t.document.y / d.size),\n          width: t.document.width,\n          height: t.document.height,\n        };\n        const squareData = {\n          x: Math.round(s.x / d.size),\n          y: Math.round(s.y / d.size),\n        };\n\n        if (inRect(squareData, tokenData)) result.push(t);\n      }\n    }\n\n    return result;\n  }\n\n  // Highlight grid in FFD20 style\n  highlightGrid() {\n    if (\n      !game.settings.get(\"ffd20\", \"measureStyle\") ||\n      ![\"circle\", \"cone\", \"ray\"].includes(this.document.t) ||\n      canvas.grid.type !== CONST.GRID_TYPES.SQUARE\n    )\n      return super.highlightGrid();\n\n    const grid = canvas.grid,\n      bc = this.borderColor,\n      fc = this.fillColor;\n\n    // Only highlight for objects which have a defined shape\n    if (!this.id || !this.shape) return;\n\n    // Clear existing highlight\n    const hl = this.getHighlightLayer();\n    hl.clear();\n\n    // Get grid squares to highlight\n    const highlightSquares = this.getHighlightedSquares();\n    for (const s of highlightSquares) {\n      grid.grid.highlightGridPosition(hl, { x: s.x, y: s.y, color: fc, border: bc });\n    }\n  }\n\n  getHighlightLayer() {\n    return canvas.grid.getHighlightLayer(this.highlightId);\n  }\n}\n","// Add Vision Permission sheet to ActorDirectory context options\nHooks.on(\"getActorDirectoryEntryContext\", function sharedVision(html, menuItems) {\n  menuItems.push({\n    name: \"FFD20.Vision\",\n    icon: '<i class=\"fas fa-eye\"></i>',\n    condition: (li) => {\n      return game.user.isGM;\n    },\n    callback: (li) => {\n      const doc = game.actors.get(li.data(\"documentId\"));\n      if (doc) {\n        const sheet = doc.visionPermissionSheet;\n        if (sheet.rendered) {\n          if (sheet._minimized) sheet.maximize();\n          else sheet.close();\n        } else sheet.render(true);\n      }\n    },\n  });\n});\n\nexport class VisionPermissionSheet extends FormApplication {\n  constructor(object, options) {\n    super(object, options);\n\n    // Register the sheet as an active Application for the Document\n    this.object.apps[this.appId] = this;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"sheet\", \"vision-permission\"],\n      template: \"systems/ffd20/templates/apps/vision-permission.hbs\",\n      width: 300,\n      height: \"auto\",\n      closeOnSubmit: true,\n      submitOnClose: false,\n      submitOnChange: false,\n    });\n  }\n\n  get title() {\n    return this.token && !this.token.data.actorLink\n      ? `Vision Permissions: [Token] ${this.object.name}`\n      : `Vision Permissions: ${this.object.name}`;\n  }\n  get isLinkedToken() {\n    return this.token ? this.token.data.actorLink : false;\n  }\n\n  async _updateObject(event, formData) {\n    await this.object.setFlag(\"ffd20\", \"visionPermission\", formData);\n    game.socket.emit(\"system.ffd20\", { eventType: \"redrawCanvas\" });\n  }\n\n  async getData() {\n    let data = super.getData();\n    data = mergeObject(data, this.object.getFlag(\"ffd20\", \"visionPermission\"));\n    data.users = data.users || {};\n\n    data.defaultLevels = [\n      { level: \"no\", name: game.i18n.localize(\"FFD20.No\") },\n      { level: \"yes\", name: game.i18n.localize(\"FFD20.Yes\") },\n    ];\n    data.levels = [{ level: \"default\", name: game.i18n.localize(\"FFD20.Default\") }, ...data.defaultLevels];\n    if (data.default == null) data.default = \"no\";\n\n    data.users = game.users.reduce((cur, o) => {\n      if (!o.isGM) {\n        cur[o.id] = {\n          user: o,\n          level: data.users[o.id]?.level || \"default\",\n          hidden: false,\n        };\n      }\n\n      return cur;\n    }, {});\n\n    return data;\n  }\n}\n\n/**\n * Check if a Token can be a vison source for the current user (due to shared vision).\n *\n * @param {Token} token - The Token\n * @returns {boolean} Whether token is a possible vision source\n */\nexport const hasTokenVision = function (token) {\n  if (!token.actor) return false;\n  if (token.actor.testUserPermission(game.user, \"OWNER\")) return true;\n\n  const visionFlag = token.actor.getFlag(\"ffd20\", \"visionPermission\");\n  if (!visionFlag || !visionFlag.users[game.user.id]) return false;\n  if (visionFlag.users[game.user.id].level === \"yes\") return true;\n  if (visionFlag.users[game.user.id].level === \"default\" && visionFlag.default === \"yes\") return true;\n\n  return false;\n};\n","import { VisionPermissionSheet } from \"../../applications/vision-permission.mjs\";\n\n/**\n * Polymorphic base class.\n * Should be fairly empty, only containing functionality that all actors should have regardless of type.\n */\nexport class ActorBaseFFD20 extends Actor {\n  /**\n   * Polymorphic constructor.\n   *\n   * @param {object} data ActorData\n   * @param {object} context Context data\n   */\n  // eslint-disable-next-line constructor-super\n  constructor(data, context = {}) {\n    if (context.ffd20?.subtyped) {\n      super(data, context);\n    } else if (data.type) {\n      const subtyped = { ffd20: { subtyped: true } };\n      const cls = CONFIG.Actor.documentClasses[data.type] ?? CONFIG.Actor.documentClasses.default;\n      if (!cls) console.warn(data?.type, data.type);\n      return new cls(data, { ...subtyped, ...context });\n    }\n  }\n\n  /**\n   * The VisionPermissionSheet instance for this actor\n   *\n   * @type {VisionPermissionSheet}\n   */\n  get visionPermissionSheet() {\n    if (!this._visionPermissionSheet) this._visionPermissionSheet = new VisionPermissionSheet(this);\n    return this._visionPermissionSheet;\n  }\n}\n","import { SemanticVersion } from \"./semver.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\n\n/**\n * Creates a tag from a string.\n * For example, if you input the string \"Wizard of Oz 2\", you will get \"wizardOfOz2\"\n *\n * @param str\n */\nexport const createTag = function (str) {\n  if (str.length === 0) str = \"tag\";\n  return str\n    .replace(/[^a-zA-Z0-9\\s]/g, \"\")\n    .split(/\\s+/)\n    .map((s, a) => {\n      s = s.toLowerCase();\n      if (a > 0) s = s.substring(0, 1).toUpperCase() + s.substring(1);\n      return s;\n    })\n    .join(\"\");\n};\n\n/**\n * Alters a roll in string form.\n *\n * @param str\n * @param add\n * @param multiply\n */\nexport const alterRoll = function (str, add, multiply) {\n  const rgx = /^([0-9]+)d([0-9]+)/;\n  // const rgx = new RegExp(Die.rgx.die, \"g\");\n  // if (str.match(/^([0-9]+)d([0-9]+)/)) {\n  return str.replace(rgx, (match, nd, d, mods) => {\n    nd = nd * (multiply || 1) + (add || 0);\n    mods = mods || \"\";\n    return (nd == null || Number.isNaN(nd) ? \"\" : nd) + \"d\" + d + mods;\n  });\n  // }\n};\n\n/**\n * @param {string} version - A version string to unpack. Must be something like '0.5.1'.\n * @returns {object} An object containing the keys 'release', 'major', and 'minor', which are numbers.\n */\nexport const unpackVersion = function (version) {\n  if (version.match(/^([0-9]+)\\.([0-9]+)(?:\\.([0-9]+))?$/)) {\n    return {\n      release: parseInt(RegExp.$1),\n      major: parseInt(RegExp.$2),\n      minor: parseInt(RegExp.$3) || null,\n    };\n  }\n};\n\n/**\n * @param {string} version - The minimum core version to compare to. Must be something like '0.5.1'.\n * @returns {boolean} Whether the current core version is at least the given version.\n */\nexport const isMinimumCoreVersion = function (version) {\n  // TODO: Remove after 0.8.X\n  const coreVersion = SemanticVersion.fromString(game.version);\n  const compareVersion = SemanticVersion.fromString(version);\n\n  return !coreVersion.isLowerThan(compareVersion);\n};\n\nexport const degtorad = function (degrees) {\n  return (degrees * Math.PI) / 180;\n};\n\nexport const radtodeg = function (radians) {\n  return (radians / 180) * Math.PI;\n};\n\nexport const linkData = function (expanded, flattened, key, value) {\n  setProperty(expanded, key, value);\n  flattened[key] = value;\n};\n\n/**\n * @param {object} item Item data\n * @returns {User|null}\n */\nexport const getItemOwner = function (item) {\n  if (item.actor) return item.actor;\n  if (item.id) return game.actors.find((o) => o.items.get(item.id));\n  return null;\n};\n\n/**\n * Turn some fractional numbers into pretty strings.\n *\n * @param {number} v\n * @returns {string|undefined}\n */\nexport const fractionalToString = (v) => {\n  const base = Math.floor(v);\n  const f = Math.roundDecimals(v - base, 3);\n  if (f === 0) return `${base}`;\n  const rv = [];\n  if (base !== 0) rv.push(base);\n  if (f === 0.25) rv.push(\"1/4\");\n  else if (f === 0.333) rv.push(\"1/3\");\n  else if (f === 0.5) rv.push(\"1/2\");\n  else if (f === 0.667) rv.push(\"2/3\");\n  else if (f === 0.75) rv.push(\"3/4\");\n  return rv.join(\" \");\n};\n\nexport const CR = {\n  fromString(value) {\n    if (value === \"1/8\") return 0.125;\n    if (value === \"1/6\") return 0.1625;\n    if (value === \"1/4\") return 0.25;\n    if (value === \"1/3\") return 0.3375;\n    if (value === \"1/2\") return 0.5;\n    return parseFloat(value);\n  },\n\n  fromNumber(value) {\n    if (value === 0.125) return \"1/8\";\n    if (value === 0.1625) return \"1/6\";\n    if (value === 0.25) return \"1/4\";\n    if (value === 0.3375) return \"1/3\";\n    if (value === 0.5) return \"1/2\";\n    if (!Number.isNumeric(value)) return \"0\";\n    return value.toString();\n  },\n};\n\nexport const getActorFromId = function (id) {\n  const speaker = ChatMessage.getSpeaker();\n  let actor = null;\n  if (id) {\n    actor = game.actors.tokens[id];\n    if (!actor) actor = game.actors.get(id);\n  }\n  if (speaker.token && !actor) actor = game.actors.tokens[speaker.token];\n  if (!actor) actor = game.actors.get(speaker.actor);\n  return actor;\n};\n\n/**\n * Converts feet to what the world is using as a measurement unit.\n *\n * @param {number} value - The value (in feet) to convert.\n * @param {string} type - The original type to convert from. Either 'ft' (feet, default) or 'mi' (miles, in which case the result is in km (metric))\n * @returns {Array.<number, string>} An array containing the converted value in index 0 and the new unit key in index 1 (for use in CONFIG.FFD20.measureUnits, for example)\n */\nexport const convertDistance = function (value, type = \"ft\") {\n  let system = game.settings.get(\"ffd20\", \"distanceUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      switch (type) {\n        case \"mi\":\n          return [Math.round(value * 1.6 * 100) / 100, \"km\"];\n        default:\n          return [Math.round((value / 5) * 1.5 * 100) / 100, \"m\"];\n      }\n    default:\n      return [value, type];\n  }\n};\n\n/**\n * Converts what the world is using as a measurement unit to feet.\n *\n * @param {number} value - The value (in the world's measurement unit) to convert back.\n * @param {string} type - The target type to convert back to. Either 'ft' (feet, default) or 'mi' (miles, in which case the expected given value should be in km (metric))\n * @returns {number} The resulting value.\n */\nexport const convertDistanceBack = function (value, type = \"ft\") {\n  let system = game.settings.get(\"ffd20\", \"distanceUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      switch (type) {\n        case \"mi\":\n          return [Math.round((value / 1.6) * 100) / 100, \"mi\"];\n        default:\n          return [Math.round(((value * 5) / 1.5) * 100) / 100, \"ft\"];\n      }\n    default:\n      return [value, type];\n  }\n};\n\n/**\n * @typedef Point\n * @property {number} x X coordinate\n * @param {number} y Y coordinate\n */\n\n/**\n * @typedef MeasureState\n * @param {number} diagonals Number of diagonals passed so far.\n * @param {number} cells Total cells in distance\n */\n\n/**\n * Measure distance between two points.\n *\n * @param {Point} p0 Start point on canvas\n * @param {Point} p1 End point on canvas\n * @param {object} options Measuring options.\n * @param {boolean} options.altReach Use alternate reach weapon diagonal rule at 10 ft range.\n * @param {\"5105\"|\"555\"} options.diagonalRule Used diagonal rule. Defaults to 5/10/5 FFD20 measuring.\n * @param {Ray} options.ray Pre-generated ray to use instead of the points.\n * @param {MeasureState} options.state Optional state tracking across multiple measures.\n * @returns {number} Grid distance between the two points.\n */\nexport const measureDistance = function (\n  p0,\n  p1,\n  { ray = null, diagonalRule = \"5105\", state = { diagonals: 0, cells: 0 } } = {}\n) {\n  // TODO: Optionally adjust start and end point to closest grid\n  ray ??= new Ray(p0, p1);\n  const gs = canvas.dimensions.size,\n    nx = Math.ceil(Math.abs(ray.dx / gs)),\n    ny = Math.ceil(Math.abs(ray.dy / gs));\n\n  // Get the number of straight and diagonal moves\n  const nDiagonal = Math.min(nx, ny),\n    nStraight = Math.abs(ny - nx);\n\n  state.diagonals += nDiagonal;\n\n  let cells = 0;\n  // Standard Pathfinder diagonals: double distance for every odd.\n  if (diagonalRule === \"5105\") {\n    const nd10 = Math.floor(state.diagonals / 2) - Math.floor((state.diagonals - nDiagonal) / 2);\n    cells = nd10 * 2 + (nDiagonal - nd10) + nStraight;\n  }\n  // Equal distance diagonals\n  else cells = nStraight + nDiagonal;\n\n  state.cells += cells;\n  return cells * canvas.dimensions.distance;\n};\n\n/**\n * Converts lbs to what the world is using as a measurement unit.\n *\n * @param {number} value - The value (in lbs) to convert.\n * @returns {number} The converted value. In the case of the metric system, converts to kg.\n */\nexport const convertWeight = function (value) {\n  let system = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      return Math.round((value / 2) * 100) / 100; // 1 kg is not exactly 2 lb but this conversion is officially used by Paizo/BBE\n    default:\n      return value;\n  }\n};\n\n/**\n * Converts back to lbs from what the world is using as a measurement unit.\n *\n * @param {number} value - The value to convert back to lbs.\n * @returns {number} The converted value. In the case of the metric system, converts from kg.\n */\nexport const convertWeightBack = function (value) {\n  let system = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n  if (system === \"default\") system = game.settings.get(\"ffd20\", \"units\");\n  switch (system) {\n    case \"metric\":\n      return Math.round(value * 2 * 100) / 100; // 1 kg is not exactly 2 lb but this conversion is officially used by Paizo/BBE\n    default:\n      return value;\n  }\n};\n\n/**\n * Like Foundry's default expandObject function, except it can make arrays\n *\n * @param obj\n * @param options\n * @param _d\n */\nexport const expandObjectExt = function (obj, options = { makeArrays: true }, _d = 0) {\n  const setPropertyExt = function (object, key, value) {\n    let target = object;\n    let changed = false;\n\n    // Convert the key to an object reference if it contains dot notation\n    if (key.indexOf(\".\") !== -1) {\n      const parts = key.split(\".\");\n      key = parts.pop();\n      target = parts.reduce((o, i, a) => {\n        const nextKey = parts.length > a ? parts[a + 1] : null;\n        if (!Object.prototype.hasOwnProperty.call(o, i)) {\n          if (((nextKey && nextKey.match(/^[0-9]+$/)) || (!nextKey && key.match(/^[0-9]+$/))) && options.makeArrays)\n            o[i] = [];\n          else o[i] = {};\n        }\n        return o[i];\n      }, object);\n    }\n\n    // Update the target\n    if (target[key] !== value) {\n      changed = true;\n      target[key] = value;\n    }\n\n    // Return changed status\n    return changed;\n  };\n\n  const expanded = {};\n  if (_d > 10) throw new Error(\"Maximum depth exceeded\");\n  for (let [k, v] of Object.entries(obj)) {\n    if (v instanceof Object && !Array.isArray(v)) {\n      v = expandObjectExt(v, options, _d + 1);\n    }\n    setPropertyExt(expanded, k, v);\n  }\n  return expanded;\n};\n\nexport const mergeObjectExt = function (\n  original,\n  other = {},\n  {\n    insertKeys = true,\n    insertValues = true,\n    overwrite = true,\n    inplace = true,\n    enforceTypes = false,\n    makeArrays = true,\n  } = {},\n  _d = 0\n) {\n  other = other || {};\n  if (!(original instanceof Object) || !(other instanceof Object)) {\n    throw new Error(\"One of original or other are not Objects!\");\n  }\n  const depth = _d + 1;\n\n  // Maybe copy the original data at depth 0\n  if (!inplace && _d === 0) original = duplicate(original);\n\n  // Enforce object expansion at depth 0\n  if (_d === 0 && Object.keys(original).some((k) => /\\./.test(k)))\n    original = expandObjectExt(original, { makeArrays: makeArrays });\n  if (_d === 0 && Object.keys(other).some((k) => /\\./.test(k))) other = expandObject(other, { makeArrays: makeArrays });\n\n  // Iterate over the other object\n  for (let [k, v] of Object.entries(other)) {\n    const tv = getType(v);\n\n    // Prepare to delete\n    let toDelete = false;\n    if (k.startsWith(\"-=\")) {\n      k = k.slice(2);\n      toDelete = v === null;\n    }\n\n    // Get the existing object\n    let x = original[k];\n    let has = Object.prototype.hasOwnProperty.call(original, k);\n    let tx = getType(x);\n\n    // Ensure that inner objects exist\n    if (!has && tv === \"Object\") {\n      x = original[k] = {};\n      has = true;\n      tx = \"Object\";\n    }\n\n    // Case 1 - Key exists\n    if (has) {\n      // 1.1 - Recursively merge an inner object\n      if (tv === \"Object\" && tx === \"Object\") {\n        mergeObjectExt(\n          x,\n          v,\n          {\n            insertKeys: insertKeys,\n            insertValues: insertValues,\n            overwrite: overwrite,\n            inplace: true,\n            enforceTypes: enforceTypes,\n            makeArrays: makeArrays,\n          },\n          depth\n        );\n      }\n\n      // 1.2 - Remove an existing key\n      else if (toDelete) {\n        delete original[k];\n      }\n\n      // 1.3 - Overwrite existing value\n      else if (overwrite) {\n        if (tx && tv !== tx && enforceTypes) {\n          throw new Error(`Mismatched data types encountered during object merge.`);\n        }\n        original[k] = v;\n      }\n\n      // 1.4 - Insert new value\n      else if (x === undefined && insertValues) {\n        original[k] = v;\n      }\n    }\n\n    // Case 2 - Key does not exist\n    else if (!toDelete) {\n      const canInsert = (depth === 1 && insertKeys) || (depth > 1 && insertValues);\n      if (canInsert) original[k] = v;\n    }\n  }\n\n  // Return the object for use\n  return original;\n};\n\nexport const naturalSort = function (arr, propertyKey = \"\") {\n  return arr.sort((a, b) => {\n    const propA = propertyKey ? getProperty(a, propertyKey) : a;\n    const propB = propertyKey ? getProperty(b, propertyKey) : b;\n    return new Intl.Collator(game.settings.get(\"core\", \"language\"), { numeric: true }).compare(propA, propB);\n  });\n};\n\nexport const createConsumableSpellDialog = async function (itemData, { allowSpell = true } = {}) {\n  const slcl = CONFIG.Item.documentClasses.spell.getMinimumCasterLevelBySpellData(itemData);\n  const content = await renderTemplate(\"systems/ffd20/templates/internal/create-consumable.hbs\", {\n    name: itemData.name,\n    sl: slcl[0],\n    cl: slcl[1],\n  });\n\n  const getData = function (html) {\n    const data = itemData;\n    data.sl = parseInt(html.find(`[name=\"sl\"]`).val());\n    data.cl = parseInt(html.find(`[name=\"cl\"]`).val()) || 1;\n    // NaN check here to allow SL 0\n    if (Number.isNaN(data.sl)) data.sl = 1;\n    return data;\n  };\n\n  return new Promise((resolve) => {\n    const dialogData = {\n      title: game.i18n.localize(\"FFD20.CreateItemForSpell\").format(itemData.name),\n      content,\n      itemData,\n      buttons: {\n        potion: {\n          icon: '<i class=\"fas fa-prescription-bottle\"></i>',\n          label: game.i18n.localize(\"FFD20.CreateItemPotion\"),\n          callback: (html) => resolve(createConsumableSpell(getData(html), \"potion\")),\n        },\n        scroll: {\n          icon: '<i class=\"fas fa-scroll\"></i>',\n          label: game.i18n.localize(\"FFD20.CreateItemScroll\"),\n          callback: (html) => resolve(createConsumableSpell(getData(html), \"scroll\")),\n        },\n        wand: {\n          icon: '<i class=\"fas fa-magic\"></i>',\n          label: game.i18n.localize(\"FFD20.CreateItemWand\"),\n          callback: (html) => resolve(createConsumableSpell(getData(html), \"wand\")),\n        },\n        spell: {\n          icon: '<i class=\"fas fa-hand-sparkles\"></i>',\n          label: game.i18n.localize(\"FFD20.ItemTypeSpell\"),\n          callback: () => resolve(\"spell\"),\n        },\n      },\n      close: () => {\n        resolve(false);\n      },\n      default: \"potion\",\n    };\n    if (!allowSpell) delete dialogData.buttons.spell;\n    new Dialog(dialogData, { classes: [\"dialog\", \"ffd20\", \"create-consumable\"] }).render(true);\n  });\n};\n\nexport const createConsumableSpell = async function (itemData, type) {\n  const data = await CONFIG.Item.documentClasses.spell.toConsumable(itemData, type);\n\n  if (data._id) delete data._id;\n  return data;\n};\n\n/**\n * Adjusts a string to a number, allowing relative adjustments.\n *\n * @param {number} initialValue - The initial number to use for relative operations.\n * @param {string} cmdStr - The exact string inputted by the user.\n * @param {number} [maxValue=null] - The maximum allowed value for this variable.\n * @param {number} [clearValue=null] - What to change the variable to if the user simply erased the value.\n * @returns {number} The resulting new value.\n */\nexport const adjustNumberByStringCommand = function (initialValue, cmdStr, maxValue = null, clearValue = null) {\n  let result = initialValue;\n\n  if (cmdStr.match(/(=)?([+-]+)?(\\d+)/)) {\n    const operator = RegExp.$2;\n    const isAbsolute = RegExp.$1 == \"=\" || [\"--\", \"++\"].includes(operator) || (!RegExp.$1 && !RegExp.$2);\n    const isNegative = [\"-\", \"--\"].includes(operator);\n    const rawValue = parseInt(RegExp.$3, 10);\n    const value = isNegative ? -rawValue : rawValue;\n    result = isAbsolute ? value : initialValue + value;\n  } else if (cmdStr === \"\" && clearValue != null) {\n    result = clearValue;\n  } else {\n    result = parseFloat(cmdStr || \"0\");\n  }\n\n  if (maxValue) result = Math.min(result, maxValue);\n  if (Number.isNaN(result)) result = initialValue;\n\n  return result;\n};\n\nexport const colorToInt = function (color) {\n  const rgb = color.rgb().color;\n  const integer =\n    ((Math.round(rgb[0]) & 0xff) << 16) + ((Math.round(rgb[1]) & 0xff) << 8) + (Math.round(rgb[2]) & 0xff);\n\n  return integer;\n};\n\n/**\n * @typedef {object} BuffTargetItem\n * @property {string} [label] - The buff target's label.\n * @property {string} category - The buff target's category.\n * @property {string} [icon] - The URL to an icon.\n */\n/**\n * Assembles an array of all possible buff targets.\n *\n * @param {ActorFFD20} [actor] - An actor for which to specifically get buff targets.\n * @param {string} [type] - Can be set to \"contextNotes\" to get context notes instead.\n * @returns {Object<string, BuffTargetItem>} The resulting array of buff targets.\n */\nexport const getBuffTargets = function (actor, type = \"buffs\") {\n  const buffTargets = duplicate(\n    {\n      buffs: CONFIG.FFD20.buffTargets,\n      contextNotes: CONFIG.FFD20.contextNoteTargets,\n    }[type]\n  );\n\n  // Append individual skills to buff targets\n  if (actor) {\n    for (const s of actor._skillTargets) {\n      const sId = s.split(\".\").slice(1).join(\".\");\n      const skill = actor.getSkillInfo(sId);\n      buffTargets[s] = { label: skill.name, category: \"skill\" };\n    }\n  } else {\n    for (const [k, v] of Object.entries(CONFIG.FFD20.skills)) {\n      buffTargets[`skill.${k}`] = { label: v, category: \"skill\" };\n    }\n  }\n\n  return buffTargets;\n};\n\n/**\n * @typedef {object} BuffTargetCategory\n * @property {string} label - The category's label.\n */\n/**\n * Assembles an array of buff targets and their categories, ready to be inserted into a Widget_CategorizedItemPicker.\n *\n * @param {ActorFFD20} [actor] - An actor for which to specifically get buff targets.\n * @param {string} [type] - Can be set to \"contextNotes\" to get context notes instead.\n * @returns {Widget_CategorizedItemPicker~Category[]}\n */\nexport const getBuffTargetDictionary = function (actor, type = \"buffs\") {\n  const buffTargets = getBuffTargets(actor, type);\n\n  // Assemble initial categories and items\n  const targetCategories = duplicate(\n    {\n      buffs: CONFIG.FFD20.buffTargetCategories,\n      contextNotes: CONFIG.FFD20.contextNoteCategories,\n    }[type]\n  );\n  let categories = Object.entries(buffTargets).reduce((cur, o) => {\n    const key = o[0];\n    const label = o[1].label;\n    const category = o[1].category;\n    const icon = o[1].icon;\n\n    if (!key.startsWith(\"~\")) {\n      cur[category] = cur[category] || {\n        label: targetCategories[category].label,\n        items: [],\n      };\n      cur[category].items.push({ key, label, icon });\n    }\n    return cur;\n  }, {});\n\n  // Turn result into a usable format, and sort\n  categories = Object.entries(categories).reduce((cur, o) => {\n    const key = o[0];\n    const label = o[1].label;\n    const items = o[1].items;\n    cur.push({ key, label, items });\n    return cur;\n  }, []);\n  categories = naturalSort(categories, \"label\");\n\n  // Return result\n  return categories;\n};\n\n/**\n * A locale-safe insertion sort of an Array of Objects, not in place. Ignores punctuation and capitalization.\n *\n * @template T\n * @param {Array.<T & {name: string}>} inputArr - Array to be sorted. Each element must have a name property set\n * @returns {T[]} - New sorted Array\n */\nexport const sortArrayByName = function (inputArr) {\n  const n = inputArr.length;\n  inputArr = duplicate(inputArr).map((o) => {\n    o.name = o.name.toLocaleLowerCase();\n    return o;\n  });\n  for (let i = 1; i < n; i++) {\n    const current = inputArr[i],\n      currentLower = current.name;\n    let j = i - 1;\n    while (j > -1 && currentLower.localeCompare(inputArr[j].name, undefined, { ignorePunctuation: true }) < 0) {\n      inputArr[j + 1] = inputArr[j];\n      j--;\n    }\n    inputArr[j + 1] = current;\n  }\n  return inputArr;\n};\n\n/**\n * A simple binary search to be used on sorted arrays\n *\n * @template T\n * @param {T[]} searchArr - Sorted Array to be searched\n * @param {T} el - Element to be compared to array values\n * @param {function(T, T): number} compare_fn - Comparison function to be apply el to every element in ar. Should return an positive/ negative integer or 0 if matching.\n * @returns {number} Index where search is found or negative index indicating where it would be inserted\n */\nexport const binarySearch = function (searchArr, el, compare_fn) {\n  let m = 0,\n    n = searchArr.length - 1;\n  while (m <= n) {\n    const k = (n + m) >> 1,\n      cmp = compare_fn(el, searchArr[k]);\n    if (cmp > 0) {\n      m = k + 1;\n    } else if (cmp < 0) {\n      n = k - 1;\n    } else {\n      return k;\n    }\n  }\n  return -m - 1;\n};\n\n/**\n * Generate permutations of an array. Complexity is O(n!).\n * Should be safe up to 7, though you should probably consider something else if you're reaching that high often.\n *\n * @template T\n * @param {T[]} perm - The Array to be generated upon\n * @returns {Array.<T[]>|false} An Array containing all Array permutations or false if failed.\n */\nfunction uniquePermutations(perm) {\n  const total = new Set();\n  if (perm.length > 7) {\n    console.warn(\"Array too large. Not attempting.\", perm);\n    return false;\n  }\n\n  for (let i = 0; i < perm.length; i = i + 1) {\n    const rest = uniquePermutations(perm.slice(0, i).concat(perm.slice(i + 1)));\n\n    if (!rest.length) {\n      total.add([perm[i]]);\n    } else {\n      for (let j = 0; j < rest.length; j = j + 1) {\n        total.add([perm[i]].concat(rest[j]));\n      }\n    }\n  }\n  return [...total];\n}\n\n/**\n * Searches through compendia quickly using the system generated index caches.\n * Exact matches excluding punctuation and case are prioritized before searching word order permutations.\n *\n * @param {string} searchTerm - The name of the Document being searched for\n * @param {object} [options] - Provides a filter to limit search to specific packs or Document types\n * @param {string[]} [options.packs] - An array of packs to search in\n * @param {\"Actor\"|\"Item\"|\"Scene\"|\"JournalEntry\"|\"Macro\"|\"RollTable\"|\"Playlist\"} [options.type] - A Document type to limit which packs are searched in\n * @returns {{pack: CompendiumCollection, index: object}|undefined} The index and pack containing it or undefined if no match is found\n */\nexport const findInCompendia = function (searchTerm, options = { packs: [], type: undefined }) {\n  let packs;\n  if (options?.packs && options.packs.length) packs = options.packs.flatMap((o) => game.packs.get(o) ?? []);\n  else packs = game.packs.filter((o) => !options?.type || o.metadata.type == options.type);\n\n  searchTerm = searchTerm.toLocaleLowerCase();\n  let found, foundDoc, foundPack;\n  for (const pack of packs) {\n    if (!pack.fuzzyIndex) pack.fuzzyIndex = sortArrayByName([...pack.index]);\n    found = binarySearch(pack.fuzzyIndex, searchTerm, (sp, it) =>\n      sp.localeCompare(it.name, undefined, { ignorePunctuation: true })\n    );\n    if (found > -1) {\n      foundDoc = pack.index.get(pack.fuzzyIndex[found]._id);\n      foundPack = pack;\n      break;\n    }\n  }\n  if (foundDoc) return { pack: foundPack, index: foundDoc };\n\n  let searchMutations = uniquePermutations(searchTerm.split(/[ _-]/));\n  if (searchMutations) searchMutations = searchMutations.map((o) => o.join(\" \"));\n  else {\n    // If array is too long, search for just a reversed version and one that pivots around commas/ semicolons\n    searchMutations = [null];\n    searchMutations.push(searchTerm.split(/[ _-]/).reverse().join(\" \"));\n    searchMutations.push(\n      searchTerm\n        .split(/[,;] ?/)\n        .reverse()\n        .flatMap((o) => o.split(\" \"))\n        .join(\" \")\n    );\n  }\n\n  for (const pack of packs) {\n    // Skip first mutation since it is already searched for manually before computing mutations\n    for (let mut = 1; mut < searchMutations.length; mut++) {\n      found = binarySearch(pack.fuzzyIndex, searchMutations[mut], (sp, it) =>\n        sp.localeCompare(it.name, undefined, { ignorePunctuation: true })\n      );\n      if (found > -1) {\n        foundDoc = pack.index.get(pack.fuzzyIndex[found]._id);\n        foundPack = pack;\n        break;\n      }\n    }\n    if (foundDoc) break;\n  }\n\n  if (foundDoc) return { pack: foundPack, index: foundDoc };\n  return false;\n};\n\n/**\n * Removes flairs from a formula.\n *\n * @param {string} formula\n */\nexport function stripRollFlairs(formula) {\n  return formula.replace(/\\[[^\\]]*]/g, \"\");\n}\n\n/**\n * Simplifies formula to very basic level.\n *\n * @param {string} formula Roll formula\n * @param {object} rollData Roll data\n * @param {object} safeEvalOpts Options to Roll.safeEval\n */\nexport function simplifyFormula(formula, rollData = {}) {\n  const temp = [];\n  const terms = RollFFD20.parse(stripRollFlairs(formula), rollData);\n  for (const term of terms) {\n    if (term instanceof DiceTerm || term instanceof OperatorTerm) {\n      temp.push(term);\n    } else if (term.isDeterministic) {\n      const evl = RollFFD20.safeTotal(term.formula);\n      temp.push(...RollFFD20.parse(`${evl}`));\n    } else {\n      temp.push(term);\n    }\n  }\n\n  // Combine simple terms (e.g. 5+3)\n  const temp2 = [];\n  let prev, term;\n  while (temp.length) {\n    prev = term;\n    term = temp.shift();\n    const next = temp[0];\n    if (term instanceof OperatorTerm) {\n      // Ternary handling\n      if (term.operator === \"?\") {\n        temp.shift(); // remove if-true val\n        const elseOp = temp.shift();\n        const falseVal = temp.shift();\n        const simpler = RollFFD20.safeEval(\n          [prev.formula, term.formula, next.formula, elseOp?.formula ?? \"\", falseVal?.formula ?? \"\"].join(\"\")\n        );\n        term = RollFFD20.parse(`${simpler}`)[0];\n        temp2.pop(); // Remove last term\n      } else if (prev instanceof NumericTerm && next instanceof NumericTerm) {\n        const simpler = RollFFD20.safeEval([prev.formula, term.formula, next.formula].join(\"\"));\n        term = RollFFD20.parse(`${simpler}`)[0];\n        temp2.pop(); // Remove the last numeric term\n        temp.shift(); // Remove the next term\n      }\n    }\n    temp2.push(term);\n  }\n\n  return RollFFD20.simplifyTerms(temp2)\n    .map((tt) => tt.formula)\n    .join(\"\");\n}\n\n/**\n * Variant of TextEditor._createInlineRoll for creating unrolled inline rolls.\n *\n * @param _match\n * @param _command\n * @param formula\n * @param closing\n * @param label\n * @param {...any} args\n */\nexport function createInlineFormula(_match, _command, formula, closing, label, ...args) {\n  console.log(arguments);\n  const rollData = args.pop();\n  if (closing.length === 3) formula += \"]\";\n\n  const cls = [\"inline-preroll\", \"inline-formula\"];\n  let e_formula;\n  try {\n    e_formula = simplifyFormula(formula, rollData);\n  } catch (err) {\n    console.error(err);\n    e_formula = \"0\";\n  }\n  label = label ? `${label}: ${e_formula}` : e_formula;\n\n  // Format return value\n  const a = document.createElement(\"a\");\n  a.classList.add(...cls);\n  a.title = formula;\n  a.innerHTML = `<i class=\"fas fa-dice-d20\"></i> ${label}`;\n  return a;\n}\n\n/**\n * enrichHTML but with inline rolls not rolled\n *\n * @param content\n * @param root0\n * @param root0.rollData\n * @param root0.secrets\n * @param root0.rolls\n * @param root0.documents\n */\nexport function enrichHTMLUnrolled(content, { rollData, secrets, rolls, documents } = {}) {\n  let pcontent = TextEditor.enrichHTML(content, { secrets, rolls, documents, rollData, async: false });\n\n  if (!rolls) {\n    const html = document.createElement(\"div\");\n    html.innerHTML = String(pcontent);\n    const text = TextEditor._getTextNodes(html);\n    const rgx = /\\[\\[(\\/[a-zA-Z]+\\s)?(.*?)([\\]]{2,3})(?:{([^}]+)})?/gi;\n    TextEditor._replaceTextContent(text, rgx, (...args) => createInlineFormula(...args, rollData));\n    pcontent = html.innerHTML;\n  }\n\n  return pcontent;\n}\n\n/**\n * Split copper gil currency into gil, silver gil and copper gil.\n *\n  * @param cgil\n */\nexport const splitCurrency = (cgil) => {\n  const gil = Math.floor(cgil / 100);\n  const sgil = Math.floor(cgil / 10) - gil * 10;\n  cgil = cgil - gil * 100 - sgil * 10;\n  return {\n    gil: Math.max(0, gil),\n    sgil: Math.max(0, sgil),\n    cgil: Math.max(0, cgil),\n  };\n};\n\n/**\n * Get first active GM user.\n *\n * @returns {User}\n */\nexport const getFirstActiveGM = function () {\n  return game.users.filter((u) => u.active && u.isGM).sort((a, b) => b.id - a.id)[0];\n};\n\n/**\n * Check whether at least one GM is active.\n */\nexport const isGMActive = function () {\n  return game.users.some((u) => u.active && u.isGM);\n};\n\n/**\n * @param formula\n * @param type\n * @param rollData\n */\nexport function calculateRangeFormula(formula, type = \"ft\", rollData = {}) {\n  switch (type) {\n    case \"melee\":\n    case \"touch\":\n      return getProperty(rollData, \"range.melee\") ?? 0;\n    case \"reach\":\n      return getProperty(rollData, \"range.reach\") ?? 0;\n    case \"close\":\n      return RollFFD20.safeRoll(CONFIG.FFD20.spellRangeFormulas.close, rollData).total;\n    case \"medium\":\n      return RollFFD20.safeRoll(CONFIG.FFD20.spellRangeFormulas.medium, rollData).total;\n    case \"long\":\n      return RollFFD20.safeRoll(CONFIG.FFD20.spellRangeFormulas.long, rollData).total;\n    case \"mi\":\n      return RollFFD20.safeRoll(formula, rollData).total * 5_280;\n    default:\n      return RollFFD20.safeRoll(formula, rollData).total;\n  }\n}\n\n/**\n * Calculates range formula and converts it.\n *\n * @param formula\n * @param type\n * @param rollData\n */\nexport function calculateRange(formula, type = \"ft\", rollData = {}) {\n  if (type == null) return null;\n  const value = calculateRangeFormula(formula, type, rollData);\n  return convertDistance(value)[0];\n}\n\n/**\n * Refreshes all actor data and re-renders sheets.\n *\n * @param options\n */\nexport function refreshActors(options = { renderOnly: false, renderForEveryone: false }) {\n  game.actors.contents.forEach((o) => {\n    if (!options.renderOnly) o.reset();\n    if (o.sheet != null && o.sheet._state > 0) o.sheet.render();\n  });\n  Object.values(game.actors.tokens).forEach((o) => {\n    if (o) {\n      if (!options.renderOnly) o.reset();\n      if (o.sheet != null && o.sheet._state > 0) o.sheet.render();\n    }\n  });\n\n  if (options.renderForEveryone) {\n    game.socket.emit(\"ffd20\", \"refreshActorSheets\");\n  }\n}\n\n/**\n * Turns dictionaries with numbered keys into arrays.\n *\n * @param {object} sourceObj The source object which contains the full array in the same path as targetObj.\n * @param {object} targetObj The target object to alter. The array doesn't have to be immediately in this object.\n * @param {string} keepPath A path to the array to keep, separated with dots. e.g. \"data.damageParts\".\n */\nexport function keepUpdateArray(sourceObj, targetObj, keepPath) {\n  const subData = Object.entries(targetObj).filter((e) => e[0].startsWith(`${keepPath}.`));\n\n  if (subData.length > 0) {\n    const arr = deepClone(getProperty(sourceObj, keepPath) || []);\n    const keySeparatorCount = (keepPath.match(/\\./g) || []).length;\n    subData.forEach((entry) => {\n      const subKey = entry[0].split(\".\").slice(keySeparatorCount + 1);\n      const i = subKey[0];\n      const subKey2 = subKey.slice(1).join(\".\");\n      if (!arr[i]) arr[i] = {};\n\n      // Single entry array\n      if (!subKey2) {\n        arr[i] = entry[1];\n      }\n      // Remove property\n      else if (subKey[subKey.length - 1].startsWith(\"-=\")) {\n        const obj = flattenObject(arr[i]);\n        subKey[subKey.length - 1] = subKey[subKey.length - 1].slice(2);\n        const deleteKeys = Object.keys(obj).filter((o) => o.startsWith(subKey.slice(1).join(\".\")));\n        for (const k of deleteKeys) {\n          if (Object.prototype.hasOwnProperty.call(obj, k)) {\n            delete obj[k];\n          }\n        }\n        arr[i] = expandObject(obj);\n      }\n      // Add or change property\n      else {\n        arr[i] = mergeObject(arr[i], expandObject({ [subKey2]: entry[1] }));\n      }\n\n      delete targetObj[entry[0]];\n    });\n\n    targetObj[keepPath] = arr;\n  }\n}\n\n/**\n * Deeply difference an object against some other, returning the update keys and values.\n * Unlike foundry.utils.diffObject, this function also deeply compares arrays.\n *\n * @param {object} original       An object comparing data against which to compare\n * @param {object} other          An object containing potentially different data\n * @param {object} [options={}]   Additional options which configure the diff operation\n * @param {boolean} [options.inner=false]  Only recognize differences in other for keys which also exist in original\n * @param {boolean} [options.keepLength=false]  Keep array length intact, possibly having to insert empty objects\n * @returns {object}               An object of the data in other which differs from that in original\n */\nexport const diffObjectAndArray = function (original, other, { inner = false, keepLength = false } = {}) {\n  /**\n   *\n   * @param v0\n   * @param v1\n   */\n  function _difference(v0, v1) {\n    const t0 = getType(v0);\n    const t1 = getType(v1);\n    if (t0 !== t1) return [true, v1];\n    if (t0 === \"Array\") {\n      if (v0.length !== v1.length) return [true, v1];\n      const d = [];\n      for (let a = 0; a < v0.length; a++) {\n        const d2 = diffObjectAndArray(v0[a], v1[a], { inner, keepLength });\n        if (!foundry.utils.isEmpty(d2)) d.push(d2);\n        else if (keepLength) d.push({});\n      }\n      if (d.length > 0) return [true, d];\n      return [false, d];\n    }\n    if (t0 === \"Object\") {\n      if (foundry.utils.isEmpty(v0) !== foundry.utils.isEmpty(v1)) return [true, v1];\n      const d = diffObjectAndArray(v0, v1, { inner, keepLength });\n      return [!foundry.utils.isEmpty(d), d];\n    }\n    return [v0 !== v1, v1];\n  }\n\n  // Recursively call the _difference function\n  return Object.keys(other).reduce((obj, key) => {\n    if (inner && !(key in original)) return obj;\n    const [isDifferent, difference] = _difference(original[key], other[key]);\n    if (isDifferent) obj[key] = difference;\n    return obj;\n  }, {});\n};\n\n/**\n * Determines what ability modifier is appropriate for a given score.\n *\n * @param {number} [score] - The score to find the modifier for.\n * @param {object} [options={}] - Options for this function.\n * @param {number} [options.penalty=0] - A penalty value to take into account.\n * @param {number} [options.damage=0] - Ability score damage to take into account.\n * @returns {number} The modifier for the given score.\n */\nexport function getAbilityModifier(score = null, options = {}) {\n  if (score != null) {\n    const penalty = Math.abs(options.penalty ?? 0);\n    const damage = Math.abs(options.damage ?? 0);\n    return Math.max(-5, Math.floor((score - 10) / 2) - Math.floor(penalty / 2) - Math.floor(damage / 2));\n  }\n  return 0;\n}\n\n/**\n * Recursively transforms an ES module to a regular, writable object.\n *\n * @template T\n * @param {T} module - The ES module to transform.\n * @returns {T} The transformed module.\n */\nexport function moduleToObject(module) {\n  const result = {};\n  for (const key in module) {\n    if (Object.prototype.toString.call(module[key]) === \"[object Module]\") {\n      result[key] = moduleToObject(module[key]);\n    } else {\n      result[key] = module[key];\n    }\n  }\n  return result;\n}\n","export class ChatMessageFFD20 extends ChatMessage {\n  get isRoll() {\n    return this.type === CONST.CHAT_MESSAGE_TYPES.ROLL || this.getFlag(\"ffd20\", \"noRollRender\");\n  }\n\n  /**\n   * Linked item.\n   *\n   * @type {ItemFFD20|undefined|null} - Null is returned if no item is linked, undefined if item is not found, and ItemFFD20 otherwise.\n   */\n  get itemSource() {\n    const itemId = this.flags?.ffd20?.metadata?.item;\n    if (itemId) {\n      const actor = this.constructor.getSpeakerActor(this.speaker);\n      return actor?.items.get(itemId);\n    }\n    return null;\n  }\n\n  /**\n   * @type {boolean} True if item source is defined, regardless if that item source still exists.\n   */\n  get hasItemSource() {\n    return this.flags?.ffd20?.metadata?.item !== undefined;\n  }\n\n  /**\n   * Return associated template or null.\n   *\n   * @type {MeasuredTemplateFFD20}\n   */\n  get measureTemplate() {\n    const templateId = this.system.flags?.ffd20?.metadata?.template;\n    if (!templateId) return null;\n    const template = canvas.templates.get(templateId);\n    return template || null;\n  }\n\n  /**\n   * @returns {TokenFFD20[]} The tokens which were targeted with this chat card.\n   */\n  get targets() {\n    const targetIds = this.system.flags?.ffd20?.metadata?.targets ?? [];\n    return canvas.tokens.placeables.filter((o) => targetIds.includes(o.id));\n  }\n}\n\n/**\n * @typedef {object} ChatMessageFFD20IdentifiedInfo\n * @property {boolean} identified - True if item was identified when rolled.\n * @property {string} name - Name of the identified item.\n * @property {string} description - Description of the identified item.\n * @property {string} [actionName] - Name of the action that was used\n * @property {string} [actionDescription] - Description of the action that was used\n */\n\n// Returns a promise to the created chatMessage or false if no command was executed\nexport const customRolls = function (message, speaker, rollData) {\n  if (message.match(/^\\/(\\w+)(?: +([^#]+))(?:#(.+))?/)) {\n    const type = RegExp.$1?.toUpperCase();\n    const value = RegExp.$2;\n    const flavor = RegExp.$3;\n    const cMsg = CONFIG.ChatMessage.documentClass;\n\n    speaker = speaker ?? cMsg.getSpeaker();\n    const actor = cMsg.getSpeakerActor(speaker);\n    const scene = speaker.scene ? game.scenes.get(speaker.scene) : canvas.scene;\n    const tokenDocument = scene?.tokens.get(speaker.token);\n    const tokenUuid = tokenDocument?.uuid;\n\n    switch (type) {\n      case \"D\":\n      case \"DAMAGE\":\n      case \"H\":\n      case \"HEAL\": {\n        rollData = rollData ?? actor?.getRollData() ?? {};\n        const roll = Roll.create(value, rollData).roll();\n\n        return roll.then(async (roll) => {\n          const total = roll.total;\n          const isHealing = type === \"HEAL\" || type === \"H\";\n          const content = await renderTemplate(\"systems/ffd20/templates/chat/simple-damage.hbs\", {\n            tokenId: tokenUuid,\n            isHealing,\n            css: isHealing ? \"heal\" : \"damage\",\n            roll,\n          });\n          const chatOptions = {\n            type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n            roll: roll,\n            flavor,\n            speaker: speaker,\n            rollMode: game.settings.get(\"core\", \"rollMode\"),\n            content: content,\n            flags: { ffd20: { subject: { health: isHealing ? \"healing\" : \"damage\" } } },\n          };\n          cMsg.create(chatOptions);\n        });\n      }\n    }\n  }\n  return false;\n};\n","/**\n * Calls a deprecated hook, logging a warning if any callbacks are registered for it.\n *\n * @param {string} oldHook - The name of the deprecated hook to be called\n * @param {string} newHook - The name of the new hook to use instead\n * @param {boolean} allowed - The result of a previous {@link Hooks.call}. If false, the deprecated hook will not be called,\n *   as the return value of the hook has already been determined by a previous callback.\n * @param {any} [args] - The arguments to pass to the deprecated hook\n * @returns {boolean} - The return value of the call\n */\nexport const callOldNamespaceHook = (oldHook, newHook, allowed, ...args) => {\n  if (Hooks.events[oldHook]?.length > 0) {\n    foundry.utils.logCompatibilityWarning(\n      `This usage of the ${oldHook} hook has been deprecated in favor of ${newHook}.`,\n      {\n        since: \"FFD20 0.82.0\",\n        until: \"FFD20 0.83.0\",\n      }\n    );\n  }\n  // A previous callback has already returned false\n  if (allowed === false) return false;\n  return Hooks.call(oldHook, ...args);\n};\n\n/**\n * Calls a deprecated hook, logging a warning if any callbacks are registered for it.\n *\n * @param {string} oldHook - The name of the deprecated hook to be called\n * @param {string} newHook - The name of the new hook to use instead\n * @param {any} [args] - The arguments to pass to the deprecated hook\n * @returns {boolean} - The return value of the call\n */\nexport const callOldNamespaceHookAll = (oldHook, newHook, ...args) => {\n  if (Hooks.events[oldHook]?.length > 0) {\n    foundry.utils.logCompatibilityWarning(\n      `This usage of the ${oldHook} hook has been deprecated in favor of ${newHook}.`,\n      {\n        since: \"FFD20 0.82.0\",\n        until: \"FFD20 0.83.0\",\n      }\n    );\n  }\n  return Hooks.callAll(oldHook, ...args);\n};\n","import { RollFFD20 } from \"./roll.mjs\";\n\n/**\n * A class adding additional functionality to {@link Roll Rolls} for d20 based Pathfinder rolls.\n */\nexport class D20RollFFD20 extends RollFFD20 {\n  /** @type {D20RollOptions} */\n  options;\n\n  /**\n   * @param {string} formula - The roll formula to parse\n   * @param {object} [data] - The data object against which to parse attributes within the formula\n   * @param {Partial<D20RollConstructorOptions>} [options]\n   */\n  constructor(formula, data, options = {}) {\n    super(formula, data, options);\n    this.options = mergeObject(this.constructor.defaultOptions, options);\n\n    // No dice in the formula\n    if (!(this.terms[0] instanceof Die)) {\n      // If the first term is a number, use it as the static roll\n      if (this.terms[0] instanceof NumericTerm && this.options.staticRoll === null) {\n        this.options.staticRoll = this.terms[0].total;\n        this.terms[0] = new Die({ number: 1, faces: 20 });\n        this._formula = this.constructor.getFormula(this.terms);\n      } else {\n        // Conflict between numeric term and static roll\n        throw new Error(`Invalid D20RollFFD20 formula provided: ${this._formula}`);\n      }\n    }\n  }\n\n  /**\n   * Default options for D20Rolls\n   *\n   * @type {Partial<D20RollOptions>}\n   */\n  static get defaultOptions() {\n    return { critical: 20, fumble: 1, flavor: \"\", staticRoll: null, bonus: \"\" };\n  }\n\n  /**\n   * The default handlebars template used to render the roll's dialog\n   *\n   * @type {string}\n   */\n  static DIALOG_TEMPLATE = \"systems/ffd20/templates/chat/roll-dialog.hbs\";\n\n  /**\n   * The default handlebars template used to render the roll's chat message\n   *\n   * @type {string}\n   */\n  static CHAT_TEMPLATE = \"systems/ffd20/templates/chat/roll-ext.hbs\";\n\n  /**\n   * Static roll results\n   *\n   * @enum {number}\n   */\n  static STATIC_ROLL = {\n    TEN: 10,\n    TWENTY: 20,\n  };\n\n  /**\n   * Is this roll a critical success? Returns undefined if roll isn't evaluated.\n   *\n   * @type {boolean|void}\n   */\n  get isCrit() {\n    if (!this._evaluated) return undefined;\n    if (!Number.isNumeric(this.options.critical)) return false;\n    return this.dice[0].total >= this.options.critical;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Is this roll a critical failure? Returns undefined if roll isn't evaluated.\n   *\n   * @type {boolean|void}\n   */\n  get isFumble() {\n    if (!this._evaluated) return undefined;\n    if (!Number.isNumeric(this.options.fumble)) return false;\n    return this.dice[0].total <= this.options.fumble;\n  }\n\n  /**\n   * Is this roll a natural 20? Returns undefined if roll isn't evaluated.\n   *\n   * @type {boolean|void}\n   */\n  get isNat20() {\n    if (!this._evaluated) return undefined;\n    return this.dice[0].total === 20;\n  }\n\n  /**\n   * Return a standardized representation for the displayed formula associated with this Roll.\n   * This formula includes any {@link ffd20!types.D20RollOptions.bonus bonus} that might not be part of this roll's {@link terms}.\n   *\n   * @returns {string}\n   */\n  get formula() {\n    let formula = this.constructor.getFormula(this.terms);\n    const bonusTerms = this.constructor.parse(`${this.options.bonus}`, this.data);\n    if (this.options.bonus && !this._evaluated) formula += ` + ${this.constructor.getFormula(bonusTerms)}`;\n    return formula;\n  }\n\n  /**\n   * Render a {@link Dialog} for the user to enter additional bonuses, set a static roll result, or take 10/20.\n   *\n   * @param {D20RollDialogOptions} [options={}] - Additional options determining what options to show in the dialog\n   * @returns {Promise<this | null>} A promise that resolves when the dialog is closed\n   */\n  async promptDialog(options = {}) {\n    const { rollMode = game.settings.get(\"core\", \"rollMode\"), template = this.constructor.DIALOG_TEMPLATE } = options;\n    const d20 = this.options.staticRoll === null ? this.terms[0].formula : this.options.staticRoll;\n    const renderData = {\n      data: this.data,\n      rollMode: options.rollMode || rollMode,\n      rollModes: CONFIG.Dice.rollModes,\n      d20: d20 === \"1d20\" ? \"\" : d20,\n      bonus: this.options.bonus,\n    };\n\n    const html = await renderTemplate(template, renderData);\n\n    return new Promise((resolve) => {\n      new Dialog(\n        {\n          title: options.title || game.i18n.localize(\"FFD20.Roll\"),\n          content: html,\n          buttons: {\n            normal: {\n              label: game.i18n.localize(\"FFD20.Normal\"),\n              callback: (html) => resolve(this._onDialogSubmit(html, null)),\n            },\n            takeTen: {\n              label: game.i18n.format(\"FFD20.TakeX\", { number: this.constructor.STATIC_ROLL.TEN }),\n              callback: (html) => resolve(this._onDialogSubmit(html, this.constructor.STATIC_ROLL.TEN)),\n            },\n            takeTwenty: {\n              label: game.i18n.format(\"FFD20.TakeX\", { number: this.constructor.STATIC_ROLL.TWENTY }),\n              callback: (html) => resolve(this._onDialogSubmit(html, this.constructor.STATIC_ROLL.TWENTY)),\n            },\n          },\n          default: \"normal\",\n          close: () => {\n            resolve(null);\n          },\n        },\n        options.dialogOptions || {}\n      ).render(true);\n    });\n  }\n\n  /**\n   * A callback applying the user's input from the dialog to the roll and its options.\n   *\n   * @protected\n   * @param {JQuery | HTMLElement} html - The dialog's submitted HTML\n   * @param {number | null} [staticRoll] - A static roll result to use instead of rolling the dice\n   * @returns {D20RollFFD20} This roll\n   */\n  _onDialogSubmit(html, staticRoll) {\n    if (html instanceof jQuery) html = html[0];\n    const form = html.querySelector(\"form\");\n    if (form) {\n      if (form.bonus.value) {\n        this.options.bonus = form.bonus.value;\n      }\n\n      if (form.d20.value) {\n        const baseDice = this.constructor.parse(form.d20.value, this.data);\n        // If a static roll is given as d20 input, Take X button clicks are ignored\n        if (baseDice[0] instanceof NumericTerm) this.options.staticRoll = baseDice[0].total;\n        else if (baseDice[0] instanceof Die) {\n          this.terms = [...baseDice, ...this.terms.slice(1)];\n          // d20 input is actual dice, so Take X buttons are respected\n          if (staticRoll !== undefined) this.options.staticRoll = staticRoll;\n        }\n      } else {\n        // No d20 input, base die is default, so Take X buttons are respected\n        if (staticRoll !== undefined) this.options.staticRoll = staticRoll;\n      }\n\n      if (form.rollMode) {\n        this.options.rollMode = form.rollMode.value;\n      }\n\n      this._formula = this.constructor.getFormula(this.terms);\n    }\n\n    return this;\n  }\n\n  /**\n   * Transform this roll into a {@link ChatMessage} displaying the result.\n   * This function can either create a ChatMessage (by default) or return the data object that would be used to create one.\n   *\n   * @param {object} messageData - The data object to use when creating the message\n   * @param {D20RollChatOptions} options - Additional options which configure how the message is created\n   * @returns {Promise<ChatMessage | object>} The created ChatMessage document, or the object of data that would be used to create one\n   */\n  async toMessage(messageData = {}, options = {}) {\n    if (!this._evaluated) await this.evaluate({ async: true });\n\n    const chatTemplate = options.chatTemplate || this.constructor.CHAT_TEMPLATE;\n    const chatTemplateData = mergeObject(\n      {\n        user: game.user.id,\n        formula: this.formula,\n        tooltip: await this.getTooltip(),\n        total: this.total,\n        isCrit: this.isCrit,\n        isFumble: this.isFumble,\n        isNat20: this.isNat20,\n        flavor: this.options.flavor,\n        compendiumEntry: options.compendium?.entry,\n        compendiumEntryType: options.compendium?.type,\n      },\n      options.chatTemplateData || {}\n    );\n\n    const rollMode = options.rollMode || this.options.rollMode || game.settings.get(\"core\", \"rollMode\");\n    messageData = foundry.utils.mergeObject(\n      {\n        user: game.user.id,\n        type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n        sound: options.noSound ? undefined : CONFIG.sounds.dice,\n        content: await renderTemplate(chatTemplate, chatTemplateData),\n        roll: this.toJSON(),\n        \"flags.ffd20.noRollRender\": true,\n      },\n      messageData\n    );\n    if (options.subject) foundry.utils.setProperty(messageData, \"flags.ffd20.subject\", options.subject);\n\n    const messageClass = CONFIG.ChatMessage.documentClass;\n    const message = new messageClass(messageData);\n    const messageObject = message.toObject();\n\n    const create = options.create ?? true;\n    if (create) {\n      return messageClass.create(message, { rollMode });\n    } else {\n      if (rollMode) messageClass.applyRollMode(messageObject, rollMode);\n      return messageObject;\n    }\n  }\n\n  /** @inheritDoc */\n  async _evaluate(options) {\n    this._applyBonus();\n    await super._evaluate(options);\n    this._applyStaticRoll();\n    return this;\n  }\n\n  /** @inheritDoc */\n  _evaluateSync(options) {\n    this._applyBonus();\n    super._evaluateSync(options);\n    this._applyStaticRoll();\n    return this;\n  }\n\n  /**\n   * Apply the bonus the roll was created with or the user entered into the dialog.\n   *\n   * @private\n   */\n  _applyBonus() {\n    if (this.options.bonus) {\n      const bonusTerms = this.constructor.parse(`${this.options.bonus}`, this.data);\n      if (!(bonusTerms[0] instanceof OperatorTerm)) bonusTerms.unshift(new OperatorTerm({ operator: \"+\" }));\n      this.terms = this.terms.concat(...bonusTerms);\n      this._formula = this.constructor.getFormula(this.terms);\n    }\n  }\n\n  /**\n   * Replace the rolled result of the active d20 (or its replacement) with a static value,\n   * and adjust the total accordingly.\n   *\n   * @remarks This requires the roll to be evaluated.\n   * @private\n   */\n  _applyStaticRoll() {\n    if (!this._evaluated) throw new Error(\"Roll must be evaluated before applying static roll.\");\n\n    if (this.options.staticRoll !== null && this.options.staticRoll >= 0) {\n      const diff = this.options.staticRoll - this.dice[0].total;\n      const newTotal = this._total + diff;\n      const activeDie = this.dice[0].results.find((r) => r.active) ?? this.dice[0].results[0];\n      activeDie.result = this.options.staticRoll;\n      this._total = newTotal;\n      this.options.flavor += ` (${game.i18n.format(\"FFD20.TakeX\", { number: this.options.staticRoll })})`;\n    }\n  }\n}\n\n/**\n * Performs an actor based d20 roll.\n *\n * @param {Partial<D20ActorRollOptions>} [options={}]\n * @example Rolling a 1d20 + an actor's BAB + 2 for good behavior\n * ```js\n * const actor = game.actors.getName(\"Righteous Paladin\");\n * await ffd20.dice.d20Roll({\n *   skipDialog: true, // Roll away without a dialog\n *   flavor: \"BAB\", // Add a flavor/title to the roll\n *   parts: [`${actor.system.attributes.bab.total}[BAB]`], // Use the actor's BAB\n *   dice: \"2d20kh\", // Roll 2 d20s and keep the highest\n *   bonus: \"2[Good Behavior]\", // Add a static bonus of 2\n *   rollMode: \"gmroll\", // Make roll only visible to user and GM\n * });\n * ```\n */\nexport async function d20Roll(options = {}) {\n  const {\n    skipDialog = false,\n    staticRoll = null,\n    chatTemplateData = {},\n    chatMessage = true,\n    compendium,\n    noSound = false,\n    flavor = \"\",\n    parts = [],\n    dice = \"1d20\",\n    rollData = {},\n    subject,\n    rollMode,\n    bonus = \"\",\n    speaker,\n  } = options;\n  const formula = [dice, ...parts].join(\"+\");\n\n  const roll = new CONFIG.Dice.rolls.D20RollFFD20(formula, rollData, { flavor, staticRoll, bonus });\n  if (!skipDialog) {\n    const title = speaker?.alias ? `${speaker.alias}: ${flavor}` : flavor;\n    const dialogResult = await roll.promptDialog({ title, rollMode });\n    if (dialogResult === null) return;\n  }\n  return roll.toMessage({ speaker }, { create: chatMessage, noSound, chatTemplateData, compendium, subject });\n}\n","import { ChatMessageFFD20 } from \"../documents/chat-message.mjs\";\nimport { RollFFD20 } from \"./roll.mjs\";\nimport { callOldNamespaceHook, callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\nimport { D20RollFFD20 } from \"./d20roll.mjs\";\n\nexport const formulaHasDice = function (formula) {\n  return formula.match(/[0-9)][dD]/) || formula.match(/[dD][0-9(]/);\n};\n\n/**\n * @deprecated Use {@link D20RollFFD20} instead\n */\nexport class DiceFFD20 {\n  /**\n   * A standardized helper function for managing game system rolls.\n   *\n   * Holding SHIFT, ALT, or CTRL when the attack is rolled will \"fast-forward\".\n   * This chooses the default options of a normal attack with no bonus, Advantage, or Disadvantage respectively\n   *\n   * @deprecated Use {@link ffd20.dice.d20Roll} instead\n   * @param {Event} event           The triggering event which initiated the roll\n   * @param {Array} parts           The dice roll component parts, excluding the initial d20\n   * @param {string} dice           The initial d20\n   * @param {Actor} actor           The Actor making the d20 roll\n   * @param {object} data           Actor or item data against which to parse the roll\n   * @param {string} template       The HTML template used to render the roll dialog\n   * @param {string} title          The dice roll UI window title\n   * @param {object} speaker        The ChatMessage speaker to pass when creating the chat\n   * @param {Function} flavor       A callable function for determining the chat message flavor given parts and data\n   * @param {boolean} takeTwenty    Allow rolling with take twenty (and therefore also with take ten)\n   * @param {boolean} situational   Allow for an arbitrary situational bonus field\n   * @param {boolean} fastForward   Allow fast-forward advantage selection\n   * @param {number} critical       The value of d20 result which represents a critical success\n   * @param {number} fumble         The value of d20 result which represents a critical failure\n   * @param {Function} onClose      Callback for actions to take when the dialog form is closed\n   * @param {object} dialogOptions  Modal dialog options\n   * @param {Array} extraRolls      An array containing bonuses/penalties for extra rolls\n   * @param {boolean} autoRender    Whether to automatically render the chat messages\n   */\n  static async d20Roll({\n    event,\n    parts,\n    dice = \"1d20\",\n    actor,\n    data,\n    subject,\n    template,\n    title,\n    speaker,\n    flavor,\n    takeTwenty = true,\n    situational = true,\n    fastForward = true,\n    critical = 20,\n    fumble = 1,\n    onClose,\n    dialogOptions = {},\n    extraRolls = [],\n    chatTemplate,\n    chatTemplateData,\n    staticRoll = null,\n    chatMessage = true,\n    noSound = false,\n    compendiumEntry = null,\n    compendiumEntryType = null,\n    originalOptions = {},\n  }) {\n    foundry.utils.logCompatibilityWarning(`DiceFFD20.d20Roll has been deprecated in favor of ffd20.dice.d20Roll`, {\n      since: \"FFD20 0.82.2\",\n      until: \"FFD20 0.83.0\",\n    });\n    // Call pre-roll handlers\n    callOldNamespaceHookAll(\"ffd20.preRoll\", \"ffd20PreRoll\", ...arguments);\n    if (callOldNamespaceHook(\"ffd20PreRoll\", \"ffd20PreActorRoll*\", undefined, ...arguments) === false) return;\n\n    // Handle input arguments\n    flavor = flavor || title;\n    let rollMode = game.settings.get(\"core\", \"rollMode\");\n    let rolled = false;\n\n    // Inner roll function\n    const _roll = async (parts, setRoll, form) => {\n      let baseDice = form ? form.find(`[name=\"d20\"]`).val() : dice;\n      if (!baseDice) baseDice = dice;\n      parts = [baseDice].concat(parts);\n\n      const originalFlavor = flavor;\n      rollMode = form ? form.find('[name=\"rollMode\"]').val() : rollMode;\n      for (let a = 0; a < 1 + extraRolls.length; a++) {\n        flavor = originalFlavor;\n        const curParts = duplicate(parts);\n        // Don't include situational bonus unless it is defined\n        data.bonus = form ? form.find('[name=\"bonus\"]').val() : 0;\n        if (!data.bonus && curParts.indexOf(\"@bonus\") !== -1) curParts.pop();\n\n        // Extra roll specifics\n        if (a >= 1) {\n          const extraRoll = extraRolls[a - 1];\n          curParts.push(extraRoll.bonus);\n          flavor += ` <div class=\"extra-roll-label\">${extraRoll.label}</div>`;\n        }\n\n        // Execute the roll\n        const roll = await Roll.create(curParts.join(\" + \"), data).evaluate({ async: true });\n\n        // Spoof a roll (e.g. Take 10/20)\n        if (setRoll != null && setRoll >= 0) {\n          const diff = setRoll - roll.dice[0].total,\n            newTotal = roll._total + diff;\n          roll.terms[0].results[0].result = setRoll;\n          roll._total = newTotal;\n          flavor += ` (Take ${setRoll})`;\n        }\n\n        // Convert the roll to a chat message\n        if (chatTemplate) {\n          // Create roll template data\n          const d20 = roll.terms[0];\n          const rollData = mergeObject(\n            {\n              user: game.user.id,\n              formula: roll.formula,\n              tooltip: await roll.getTooltip(),\n              total: roll.total,\n              isCrit: d20.total >= critical,\n              isFumble: d20.total <= fumble,\n              isNat20: d20.total === 20,\n              flavor: flavor,\n              compendiumEntry: compendiumEntry,\n              compendiumEntryType: compendiumEntryType,\n            },\n            chatTemplateData || {}\n          );\n\n          // Create chat data\n          const chatData = {\n            user: game.user.id,\n            type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n            sound: noSound ? null : a === 0 ? CONFIG.sounds.dice : null,\n            speaker: speaker,\n            content: await renderTemplate(chatTemplate, rollData),\n            rollMode: rollMode,\n            roll: roll.toJSON(),\n            \"flags.ffd20.noRollRender\": true,\n          };\n          if (subject) setProperty(chatData, \"flags.ffd20.subject\", subject);\n\n          // Send message\n          rolled = true;\n\n          if (chatMessage) return await ChatMessageFFD20.create(chatData);\n        } else {\n          rolled = true;\n          if (chatMessage) {\n            const msgData = {\n              speaker: speaker,\n              flavor: flavor,\n              rollMode: rollMode,\n              sound: a === 0 ? CONFIG.sounds.dice : null,\n            };\n            if (subject) setProperty(msgData, \"flags.ffd20.subject\", subject);\n\n            await roll.toMessage(msgData);\n          }\n        }\n        return roll;\n      }\n    };\n\n    // Modify the roll and handle fast-forwarding\n    if (fastForward === true) return _roll(parts, staticRoll);\n    else parts = parts.concat([\"@bonus\"]);\n\n    // Render modal dialog\n    template = template || \"systems/ffd20/templates/chat/roll-dialog.hbs\";\n    const dialogData = {\n      data: data,\n      rollMode: rollMode,\n      rollModes: CONFIG.Dice.rollModes,\n      d20: dice === \"1d20\" ? \"\" : dice,\n    };\n    const html = await renderTemplate(template, dialogData);\n\n    let roll;\n    return new Promise((resolve) => {\n      if (!(dialogOptions.classes instanceof Array)) dialogOptions.classes = [];\n      dialogOptions.classes.push(\"dialog\", \"ffd20\", \"die-roll\");\n      // Enrich dialog identity\n      if (subject) {\n        dialogOptions.subject = subject;\n        for (const [key, value] of Object.entries(subject)) {\n          dialogOptions.classes.push(key, `${key}-${value}`);\n        }\n      }\n\n      new Dialog(\n        {\n          title: actor ? `${title}: ${actor.name}` : title,\n          content: html,\n          buttons: {\n            normal: {\n              label: game.i18n.localize(\"FFD20.Normal\"),\n              callback: (html) => resolve((roll = _roll(parts, staticRoll != null ? staticRoll : -1, html))),\n            },\n            takeTen: {\n              label: game.i18n.localize(\"FFD20.Take10\"),\n              condition: takeTwenty,\n              callback: (html) => resolve((roll = _roll(parts, 10, html))),\n            },\n            takeTwenty: {\n              label: game.i18n.localize(\"FFD20.Take20\"),\n              condition: takeTwenty,\n              callback: (html) => resolve((roll = _roll(parts, 20, html))),\n            },\n          },\n          default: \"normal\",\n          close: (html) => {\n            if (onClose) onClose(html, parts, data);\n            resolve(rolled ? roll : false);\n          },\n        },\n        dialogOptions\n      ).render(true);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * A standardized helper function for managing damage rolls.\n   *\n   * Holding SHIFT, ALT, or CTRL when the attack is rolled will \"fast-forward\".\n   * This chooses the default options of a normal attack with no bonus, Critical, or no bonus respectively\n   *\n   * @param {Event} event           The triggering event which initiated the roll\n   * @param {Array} parts           The dice roll component parts, excluding the initial d20\n   * @param {Actor} actor           The Actor making the damage roll\n   * @param {object} data           Actor or item data against which to parse the roll\n   * @param {string} template       The HTML template used to render the roll dialog\n   * @param {string} title          The dice roll UI window title\n   * @param {object} speaker        The ChatMessage speaker to pass when creating the chat\n   * @param {Function} flavor       A callable function for determining the chat message flavor given parts and data\n   * @param {boolean} critical      Allow critical hits to be chosen\n   * @param {Function} onClose      Callback for actions to take when the dialog form is closed\n   * @param {object} dialogOptions  Modal dialog options\n   */\n  static async damageRoll({\n    event = {},\n    parts,\n    actor,\n    data,\n    template,\n    title,\n    speaker,\n    flavor,\n    critical = true,\n    onClose,\n    dialogOptions = {},\n    chatTemplate,\n    chatTemplateData,\n    chatMessage = true,\n    noSound = false,\n  }) {\n    foundry.utils.logCompatibilityWarning(`DiceFFD20.damageRoll has been deprecated in favor of ffd20.dice.d20Roll`, {\n      since: \"FFD20 0.82.2\",\n      until: \"FFD20 0.83.0\",\n    });\n    flavor = flavor || title;\n    const rollMode = game.settings.get(\"core\", \"rollMode\");\n    let rolled = false;\n\n    // Inner roll function\n    const _roll = async (crit, form) => {\n      // Don't include situational bonus unless it is defined\n      data.bonus = form ? form.find('[name=\"bonus\"]').val() : 0;\n\n      // Detemrine critical multiplier\n      data[\"critMult\"] = crit ? data.item.ability.critMult : 1;\n      // Determine damage ability\n      data[\"ablMult\"] = 0;\n      if (data.item.ability.damageMult != null) {\n        data[\"ablMult\"] = data.item.ability.damageMult;\n      }\n\n      const roll = Roll.create(parts.join(\"+\"), data);\n      if (crit === true) {\n        const mult = data.item.ability.critMult || 2;\n\n        // Update first damage part\n        roll.alter(0, mult);\n        flavor = `${flavor} (Critical)`;\n      }\n\n      await roll.evaluate({ async: true });\n\n      // Convert the roll to a chat message\n      if (chatTemplate) {\n        // Create roll template data\n        const rollData = mergeObject(\n          {\n            user: game.user.id,\n            formula: roll.formula,\n            tooltip: await roll.getTooltip(),\n            total: roll.total,\n          },\n          chatTemplateData || {}\n        );\n\n        // Create chat data\n        const chatData = {\n          user: game.user.id,\n          type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n          sound: noSound ? null : CONFIG.sounds.dice,\n          speaker: speaker,\n          flavor: flavor,\n          rollMode: rollMode,\n          roll: roll,\n          content: await renderTemplate(chatTemplate, rollData),\n          useCustomContent: true,\n        };\n        setProperty(chatData, \"flags.ffd20.subject.core\", \"damage\");\n\n        // Handle different roll modes\n        ChatMessage.applyRollMode(chatData, chatData.rollMode);\n\n        // Send message\n        rolled = true;\n        if (chatMessage) ChatMessageFFD20.create(chatData);\n      } else {\n        rolled = true;\n        if (chatMessage) {\n          roll.toMessage({\n            speaker: speaker,\n            flavor: flavor,\n            rollMode: rollMode,\n          });\n        }\n      }\n\n      // Return the Roll object\n      return roll;\n    };\n\n    // Modify the roll and handle fast-forwarding\n    if (!event.shiftKey) return _roll(event.ctrlKey);\n    else parts = parts.concat([\"@bonus\"]);\n\n    // Construct dialog data\n    template = template || \"systems/ffd20/templates/chat/roll-dialog.hbs\";\n    const dialogData = {\n      formula: parts.join(\" + \"),\n      data: data,\n      rollMode: rollMode,\n      rollModes: CONFIG.Dice.rollModes,\n    };\n    const html = await renderTemplate(template, dialogData);\n\n    // Render modal dialog\n    let roll;\n    return new Promise((resolve) => {\n      if (!(dialogOptions.classes instanceof Array)) dialogOptions.classes = [];\n      dialogOptions.classes.push(\"dialog\", \"ffd20\", \"damage-roll\");\n\n      new Dialog(\n        {\n          title: title,\n          content: html,\n          buttons: {\n            normal: {\n              label: critical ? \"Normal\" : \"Roll\",\n              callback: (html) => (roll = _roll(false, html)),\n            },\n            critical: {\n              condition: critical,\n              label: \"Critical Hit\",\n              callback: (html) => (roll = _roll(true, html)),\n            },\n          },\n          default: \"normal\",\n          close: (html) => {\n            if (onClose) onClose(html, parts, data);\n            resolve(rolled ? roll : false);\n          },\n        },\n        dialogOptions\n      ).render(true);\n    });\n  }\n\n  static messageRoll({ data, msgStr }) {\n    const re = /\\[\\[(.+)\\]\\]/g;\n    return msgStr.replace(re, (_, p1) => {\n      const roll = RollFFD20.safeRoll(p1, data);\n      return roll.total.toString();\n    });\n  }\n}\n","/**\n * Polymorphic base class.\n * Should be fairly empty, only containing functionality that all items should have regardless of type.\n */\nexport class ItemBaseFFD20 extends Item {\n  /**\n   * Polymorphic constructor.\n   *\n   * @param {object} data ActorData\n   * @param {object} context Context data\n   */\n  // eslint-disable-next-line constructor-super\n  constructor(data, context = {}) {\n    if (context.ffd20?.subtyped) {\n      super(data, context);\n    } else if (data.type) {\n      const subtyped = { ffd20: { subtyped: true } };\n      const cls = CONFIG.Item.documentClasses[data?.type ?? data.type] ?? CONFIG.Item.documentClasses.default;\n      if (!cls) console.warn(data?.type, data.type);\n      return new cls(data, { ...subtyped, ...context });\n    }\n  }\n\n  /**\n   * @returns {string} Item subtype.\n   */\n  get subType() {\n    return null;\n  }\n}\n","'use strict';\n\nvar isArrayish = require('is-arrayish');\n\nvar concat = Array.prototype.concat;\nvar slice = Array.prototype.slice;\n\nvar swizzle = module.exports = function swizzle(args) {\n\tvar results = [];\n\n\tfor (var i = 0, len = args.length; i < len; i++) {\n\t\tvar arg = args[i];\n\n\t\tif (isArrayish(arg)) {\n\t\t\t// http://jsperf.com/javascript-array-concat-vs-push/98\n\t\t\tresults = concat.call(results, slice.call(arg));\n\t\t} else {\n\t\t\tresults.push(arg);\n\t\t}\n\t}\n\n\treturn results;\n};\n\nswizzle.wrap = function (fn) {\n\treturn function () {\n\t\treturn fn(swizzle(arguments));\n\t};\n};\n","module.exports = function isArrayish(obj) {\n\tif (!obj || typeof obj === 'string') {\n\t\treturn false;\n\t}\n\n\treturn obj instanceof Array || Array.isArray(obj) ||\n\t\t(obj.length >= 0 && (obj.splice instanceof Function ||\n\t\t\t(Object.getOwnPropertyDescriptor(obj, (obj.length - 1)) && obj.constructor.name !== 'String')));\n};\n","/* MIT license */\nvar colorNames = require('color-name');\nvar swizzle = require('simple-swizzle');\nvar hasOwnProperty = Object.hasOwnProperty;\n\nvar reverseNames = Object.create(null);\n\n// create a list of reverse color names\nfor (var name in colorNames) {\n\tif (hasOwnProperty.call(colorNames, name)) {\n\t\treverseNames[colorNames[name]] = name;\n\t}\n}\n\nvar cs = module.exports = {\n\tto: {},\n\tget: {}\n};\n\ncs.get = function (string) {\n\tvar prefix = string.substring(0, 3).toLowerCase();\n\tvar val;\n\tvar model;\n\tswitch (prefix) {\n\t\tcase 'hsl':\n\t\t\tval = cs.get.hsl(string);\n\t\t\tmodel = 'hsl';\n\t\t\tbreak;\n\t\tcase 'hwb':\n\t\t\tval = cs.get.hwb(string);\n\t\t\tmodel = 'hwb';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tval = cs.get.rgb(string);\n\t\t\tmodel = 'rgb';\n\t\t\tbreak;\n\t}\n\n\tif (!val) {\n\t\treturn null;\n\t}\n\n\treturn {model: model, value: val};\n};\n\ncs.get.rgb = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar abbr = /^#([a-f0-9]{3,4})$/i;\n\tvar hex = /^#([a-f0-9]{6})([a-f0-9]{2})?$/i;\n\tvar rgba = /^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/;\n\tvar per = /^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/;\n\tvar keyword = /^(\\w+)$/;\n\n\tvar rgb = [0, 0, 0, 1];\n\tvar match;\n\tvar i;\n\tvar hexAlpha;\n\n\tif (match = string.match(hex)) {\n\t\thexAlpha = match[2];\n\t\tmatch = match[1];\n\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\t// https://jsperf.com/slice-vs-substr-vs-substring-methods-long-string/19\n\t\t\tvar i2 = i * 2;\n\t\t\trgb[i] = parseInt(match.slice(i2, i2 + 2), 16);\n\t\t}\n\n\t\tif (hexAlpha) {\n\t\t\trgb[3] = parseInt(hexAlpha, 16) / 255;\n\t\t}\n\t} else if (match = string.match(abbr)) {\n\t\tmatch = match[1];\n\t\thexAlpha = match[3];\n\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = parseInt(match[i] + match[i], 16);\n\t\t}\n\n\t\tif (hexAlpha) {\n\t\t\trgb[3] = parseInt(hexAlpha + hexAlpha, 16) / 255;\n\t\t}\n\t} else if (match = string.match(rgba)) {\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = parseInt(match[i + 1], 0);\n\t\t}\n\n\t\tif (match[4]) {\n\t\t\tif (match[5]) {\n\t\t\t\trgb[3] = parseFloat(match[4]) * 0.01;\n\t\t\t} else {\n\t\t\t\trgb[3] = parseFloat(match[4]);\n\t\t\t}\n\t\t}\n\t} else if (match = string.match(per)) {\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = Math.round(parseFloat(match[i + 1]) * 2.55);\n\t\t}\n\n\t\tif (match[4]) {\n\t\t\tif (match[5]) {\n\t\t\t\trgb[3] = parseFloat(match[4]) * 0.01;\n\t\t\t} else {\n\t\t\t\trgb[3] = parseFloat(match[4]);\n\t\t\t}\n\t\t}\n\t} else if (match = string.match(keyword)) {\n\t\tif (match[1] === 'transparent') {\n\t\t\treturn [0, 0, 0, 0];\n\t\t}\n\n\t\tif (!hasOwnProperty.call(colorNames, match[1])) {\n\t\t\treturn null;\n\t\t}\n\n\t\trgb = colorNames[match[1]];\n\t\trgb[3] = 1;\n\n\t\treturn rgb;\n\t} else {\n\t\treturn null;\n\t}\n\n\tfor (i = 0; i < 3; i++) {\n\t\trgb[i] = clamp(rgb[i], 0, 255);\n\t}\n\trgb[3] = clamp(rgb[3], 0, 1);\n\n\treturn rgb;\n};\n\ncs.get.hsl = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar hsl = /^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/;\n\tvar match = string.match(hsl);\n\n\tif (match) {\n\t\tvar alpha = parseFloat(match[4]);\n\t\tvar h = ((parseFloat(match[1]) % 360) + 360) % 360;\n\t\tvar s = clamp(parseFloat(match[2]), 0, 100);\n\t\tvar l = clamp(parseFloat(match[3]), 0, 100);\n\t\tvar a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\n\n\t\treturn [h, s, l, a];\n\t}\n\n\treturn null;\n};\n\ncs.get.hwb = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar hwb = /^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/;\n\tvar match = string.match(hwb);\n\n\tif (match) {\n\t\tvar alpha = parseFloat(match[4]);\n\t\tvar h = ((parseFloat(match[1]) % 360) + 360) % 360;\n\t\tvar w = clamp(parseFloat(match[2]), 0, 100);\n\t\tvar b = clamp(parseFloat(match[3]), 0, 100);\n\t\tvar a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\n\t\treturn [h, w, b, a];\n\t}\n\n\treturn null;\n};\n\ncs.to.hex = function () {\n\tvar rgba = swizzle(arguments);\n\n\treturn (\n\t\t'#' +\n\t\thexDouble(rgba[0]) +\n\t\thexDouble(rgba[1]) +\n\t\thexDouble(rgba[2]) +\n\t\t(rgba[3] < 1\n\t\t\t? (hexDouble(Math.round(rgba[3] * 255)))\n\t\t\t: '')\n\t);\n};\n\ncs.to.rgb = function () {\n\tvar rgba = swizzle(arguments);\n\n\treturn rgba.length < 4 || rgba[3] === 1\n\t\t? 'rgb(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ')'\n\t\t: 'rgba(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ', ' + rgba[3] + ')';\n};\n\ncs.to.rgb.percent = function () {\n\tvar rgba = swizzle(arguments);\n\n\tvar r = Math.round(rgba[0] / 255 * 100);\n\tvar g = Math.round(rgba[1] / 255 * 100);\n\tvar b = Math.round(rgba[2] / 255 * 100);\n\n\treturn rgba.length < 4 || rgba[3] === 1\n\t\t? 'rgb(' + r + '%, ' + g + '%, ' + b + '%)'\n\t\t: 'rgba(' + r + '%, ' + g + '%, ' + b + '%, ' + rgba[3] + ')';\n};\n\ncs.to.hsl = function () {\n\tvar hsla = swizzle(arguments);\n\treturn hsla.length < 4 || hsla[3] === 1\n\t\t? 'hsl(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%)'\n\t\t: 'hsla(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%, ' + hsla[3] + ')';\n};\n\n// hwb is a bit different than rgb(a) & hsl(a) since there is no alpha specific syntax\n// (hwb have alpha optional & 1 is default value)\ncs.to.hwb = function () {\n\tvar hwba = swizzle(arguments);\n\n\tvar a = '';\n\tif (hwba.length >= 4 && hwba[3] !== 1) {\n\t\ta = ', ' + hwba[3];\n\t}\n\n\treturn 'hwb(' + hwba[0] + ', ' + hwba[1] + '%, ' + hwba[2] + '%' + a + ')';\n};\n\ncs.to.keyword = function (rgb) {\n\treturn reverseNames[rgb.slice(0, 3)];\n};\n\n// helpers\nfunction clamp(num, min, max) {\n\treturn Math.min(Math.max(min, num), max);\n}\n\nfunction hexDouble(num) {\n\tvar str = Math.round(num).toString(16).toUpperCase();\n\treturn (str.length < 2) ? '0' + str : str;\n}\n","'use strict'\r\n\r\nmodule.exports = {\r\n\t\"aliceblue\": [240, 248, 255],\r\n\t\"antiquewhite\": [250, 235, 215],\r\n\t\"aqua\": [0, 255, 255],\r\n\t\"aquamarine\": [127, 255, 212],\r\n\t\"azure\": [240, 255, 255],\r\n\t\"beige\": [245, 245, 220],\r\n\t\"bisque\": [255, 228, 196],\r\n\t\"black\": [0, 0, 0],\r\n\t\"blanchedalmond\": [255, 235, 205],\r\n\t\"blue\": [0, 0, 255],\r\n\t\"blueviolet\": [138, 43, 226],\r\n\t\"brown\": [165, 42, 42],\r\n\t\"burlywood\": [222, 184, 135],\r\n\t\"cadetblue\": [95, 158, 160],\r\n\t\"chartreuse\": [127, 255, 0],\r\n\t\"chocolate\": [210, 105, 30],\r\n\t\"coral\": [255, 127, 80],\r\n\t\"cornflowerblue\": [100, 149, 237],\r\n\t\"cornsilk\": [255, 248, 220],\r\n\t\"crimson\": [220, 20, 60],\r\n\t\"cyan\": [0, 255, 255],\r\n\t\"darkblue\": [0, 0, 139],\r\n\t\"darkcyan\": [0, 139, 139],\r\n\t\"darkgoldenrod\": [184, 134, 11],\r\n\t\"darkgray\": [169, 169, 169],\r\n\t\"darkgreen\": [0, 100, 0],\r\n\t\"darkgrey\": [169, 169, 169],\r\n\t\"darkkhaki\": [189, 183, 107],\r\n\t\"darkmagenta\": [139, 0, 139],\r\n\t\"darkolivegreen\": [85, 107, 47],\r\n\t\"darkorange\": [255, 140, 0],\r\n\t\"darkorchid\": [153, 50, 204],\r\n\t\"darkred\": [139, 0, 0],\r\n\t\"darksalmon\": [233, 150, 122],\r\n\t\"darkseagreen\": [143, 188, 143],\r\n\t\"darkslateblue\": [72, 61, 139],\r\n\t\"darkslategray\": [47, 79, 79],\r\n\t\"darkslategrey\": [47, 79, 79],\r\n\t\"darkturquoise\": [0, 206, 209],\r\n\t\"darkviolet\": [148, 0, 211],\r\n\t\"deeppink\": [255, 20, 147],\r\n\t\"deepskyblue\": [0, 191, 255],\r\n\t\"dimgray\": [105, 105, 105],\r\n\t\"dimgrey\": [105, 105, 105],\r\n\t\"dodgerblue\": [30, 144, 255],\r\n\t\"firebrick\": [178, 34, 34],\r\n\t\"floralwhite\": [255, 250, 240],\r\n\t\"forestgreen\": [34, 139, 34],\r\n\t\"fuchsia\": [255, 0, 255],\r\n\t\"gainsboro\": [220, 220, 220],\r\n\t\"ghostwhite\": [248, 248, 255],\r\n\t\"gold\": [255, 215, 0],\r\n\t\"goldenrod\": [218, 165, 32],\r\n\t\"gray\": [128, 128, 128],\r\n\t\"green\": [0, 128, 0],\r\n\t\"greenyellow\": [173, 255, 47],\r\n\t\"grey\": [128, 128, 128],\r\n\t\"honeydew\": [240, 255, 240],\r\n\t\"hotpink\": [255, 105, 180],\r\n\t\"indianred\": [205, 92, 92],\r\n\t\"indigo\": [75, 0, 130],\r\n\t\"ivory\": [255, 255, 240],\r\n\t\"khaki\": [240, 230, 140],\r\n\t\"lavender\": [230, 230, 250],\r\n\t\"lavenderblush\": [255, 240, 245],\r\n\t\"lawngreen\": [124, 252, 0],\r\n\t\"lemonchiffon\": [255, 250, 205],\r\n\t\"lightblue\": [173, 216, 230],\r\n\t\"lightcoral\": [240, 128, 128],\r\n\t\"lightcyan\": [224, 255, 255],\r\n\t\"lightgoldenrodyellow\": [250, 250, 210],\r\n\t\"lightgray\": [211, 211, 211],\r\n\t\"lightgreen\": [144, 238, 144],\r\n\t\"lightgrey\": [211, 211, 211],\r\n\t\"lightpink\": [255, 182, 193],\r\n\t\"lightsalmon\": [255, 160, 122],\r\n\t\"lightseagreen\": [32, 178, 170],\r\n\t\"lightskyblue\": [135, 206, 250],\r\n\t\"lightslategray\": [119, 136, 153],\r\n\t\"lightslategrey\": [119, 136, 153],\r\n\t\"lightsteelblue\": [176, 196, 222],\r\n\t\"lightyellow\": [255, 255, 224],\r\n\t\"lime\": [0, 255, 0],\r\n\t\"limegreen\": [50, 205, 50],\r\n\t\"linen\": [250, 240, 230],\r\n\t\"magenta\": [255, 0, 255],\r\n\t\"maroon\": [128, 0, 0],\r\n\t\"mediumaquamarine\": [102, 205, 170],\r\n\t\"mediumblue\": [0, 0, 205],\r\n\t\"mediumorchid\": [186, 85, 211],\r\n\t\"mediumpurple\": [147, 112, 219],\r\n\t\"mediumseagreen\": [60, 179, 113],\r\n\t\"mediumslateblue\": [123, 104, 238],\r\n\t\"mediumspringgreen\": [0, 250, 154],\r\n\t\"mediumturquoise\": [72, 209, 204],\r\n\t\"mediumvioletred\": [199, 21, 133],\r\n\t\"midnightblue\": [25, 25, 112],\r\n\t\"mintcream\": [245, 255, 250],\r\n\t\"mistyrose\": [255, 228, 225],\r\n\t\"moccasin\": [255, 228, 181],\r\n\t\"navajowhite\": [255, 222, 173],\r\n\t\"navy\": [0, 0, 128],\r\n\t\"oldlace\": [253, 245, 230],\r\n\t\"olive\": [128, 128, 0],\r\n\t\"olivedrab\": [107, 142, 35],\r\n\t\"orange\": [255, 165, 0],\r\n\t\"orangered\": [255, 69, 0],\r\n\t\"orchid\": [218, 112, 214],\r\n\t\"palegoldenrod\": [238, 232, 170],\r\n\t\"palegreen\": [152, 251, 152],\r\n\t\"paleturquoise\": [175, 238, 238],\r\n\t\"palevioletred\": [219, 112, 147],\r\n\t\"papayawhip\": [255, 239, 213],\r\n\t\"peachpuff\": [255, 218, 185],\r\n\t\"peru\": [205, 133, 63],\r\n\t\"pink\": [255, 192, 203],\r\n\t\"plum\": [221, 160, 221],\r\n\t\"powderblue\": [176, 224, 230],\r\n\t\"purple\": [128, 0, 128],\r\n\t\"rebeccapurple\": [102, 51, 153],\r\n\t\"red\": [255, 0, 0],\r\n\t\"rosybrown\": [188, 143, 143],\r\n\t\"royalblue\": [65, 105, 225],\r\n\t\"saddlebrown\": [139, 69, 19],\r\n\t\"salmon\": [250, 128, 114],\r\n\t\"sandybrown\": [244, 164, 96],\r\n\t\"seagreen\": [46, 139, 87],\r\n\t\"seashell\": [255, 245, 238],\r\n\t\"sienna\": [160, 82, 45],\r\n\t\"silver\": [192, 192, 192],\r\n\t\"skyblue\": [135, 206, 235],\r\n\t\"slateblue\": [106, 90, 205],\r\n\t\"slategray\": [112, 128, 144],\r\n\t\"slategrey\": [112, 128, 144],\r\n\t\"snow\": [255, 250, 250],\r\n\t\"springgreen\": [0, 255, 127],\r\n\t\"steelblue\": [70, 130, 180],\r\n\t\"tan\": [210, 180, 140],\r\n\t\"teal\": [0, 128, 128],\r\n\t\"thistle\": [216, 191, 216],\r\n\t\"tomato\": [255, 99, 71],\r\n\t\"turquoise\": [64, 224, 208],\r\n\t\"violet\": [238, 130, 238],\r\n\t\"wheat\": [245, 222, 179],\r\n\t\"white\": [255, 255, 255],\r\n\t\"whitesmoke\": [245, 245, 245],\r\n\t\"yellow\": [255, 255, 0],\r\n\t\"yellowgreen\": [154, 205, 50]\r\n};\r\n","/* MIT license */\n/* eslint-disable no-mixed-operators */\nconst cssKeywords = require('color-name');\n\n// NOTE: conversions should only return primitive values (i.e. arrays, or\n//       values that give correct `typeof` results).\n//       do not use box values types (i.e. Number(), String(), etc.)\n\nconst reverseKeywords = {};\nfor (const key of Object.keys(cssKeywords)) {\n\treverseKeywords[cssKeywords[key]] = key;\n}\n\nconst convert = {\n\trgb: {channels: 3, labels: 'rgb'},\n\thsl: {channels: 3, labels: 'hsl'},\n\thsv: {channels: 3, labels: 'hsv'},\n\thwb: {channels: 3, labels: 'hwb'},\n\tcmyk: {channels: 4, labels: 'cmyk'},\n\txyz: {channels: 3, labels: 'xyz'},\n\tlab: {channels: 3, labels: 'lab'},\n\tlch: {channels: 3, labels: 'lch'},\n\thex: {channels: 1, labels: ['hex']},\n\tkeyword: {channels: 1, labels: ['keyword']},\n\tansi16: {channels: 1, labels: ['ansi16']},\n\tansi256: {channels: 1, labels: ['ansi256']},\n\thcg: {channels: 3, labels: ['h', 'c', 'g']},\n\tapple: {channels: 3, labels: ['r16', 'g16', 'b16']},\n\tgray: {channels: 1, labels: ['gray']}\n};\n\nmodule.exports = convert;\n\n// Hide .channels and .labels properties\nfor (const model of Object.keys(convert)) {\n\tif (!('channels' in convert[model])) {\n\t\tthrow new Error('missing channels property: ' + model);\n\t}\n\n\tif (!('labels' in convert[model])) {\n\t\tthrow new Error('missing channel labels property: ' + model);\n\t}\n\n\tif (convert[model].labels.length !== convert[model].channels) {\n\t\tthrow new Error('channel and label counts mismatch: ' + model);\n\t}\n\n\tconst {channels, labels} = convert[model];\n\tdelete convert[model].channels;\n\tdelete convert[model].labels;\n\tObject.defineProperty(convert[model], 'channels', {value: channels});\n\tObject.defineProperty(convert[model], 'labels', {value: labels});\n}\n\nconvert.rgb.hsl = function (rgb) {\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\tconst min = Math.min(r, g, b);\n\tconst max = Math.max(r, g, b);\n\tconst delta = max - min;\n\tlet h;\n\tlet s;\n\n\tif (max === min) {\n\t\th = 0;\n\t} else if (r === max) {\n\t\th = (g - b) / delta;\n\t} else if (g === max) {\n\t\th = 2 + (b - r) / delta;\n\t} else if (b === max) {\n\t\th = 4 + (r - g) / delta;\n\t}\n\n\th = Math.min(h * 60, 360);\n\n\tif (h < 0) {\n\t\th += 360;\n\t}\n\n\tconst l = (min + max) / 2;\n\n\tif (max === min) {\n\t\ts = 0;\n\t} else if (l <= 0.5) {\n\t\ts = delta / (max + min);\n\t} else {\n\t\ts = delta / (2 - max - min);\n\t}\n\n\treturn [h, s * 100, l * 100];\n};\n\nconvert.rgb.hsv = function (rgb) {\n\tlet rdif;\n\tlet gdif;\n\tlet bdif;\n\tlet h;\n\tlet s;\n\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\tconst v = Math.max(r, g, b);\n\tconst diff = v - Math.min(r, g, b);\n\tconst diffc = function (c) {\n\t\treturn (v - c) / 6 / diff + 1 / 2;\n\t};\n\n\tif (diff === 0) {\n\t\th = 0;\n\t\ts = 0;\n\t} else {\n\t\ts = diff / v;\n\t\trdif = diffc(r);\n\t\tgdif = diffc(g);\n\t\tbdif = diffc(b);\n\n\t\tif (r === v) {\n\t\t\th = bdif - gdif;\n\t\t} else if (g === v) {\n\t\t\th = (1 / 3) + rdif - bdif;\n\t\t} else if (b === v) {\n\t\t\th = (2 / 3) + gdif - rdif;\n\t\t}\n\n\t\tif (h < 0) {\n\t\t\th += 1;\n\t\t} else if (h > 1) {\n\t\t\th -= 1;\n\t\t}\n\t}\n\n\treturn [\n\t\th * 360,\n\t\ts * 100,\n\t\tv * 100\n\t];\n};\n\nconvert.rgb.hwb = function (rgb) {\n\tconst r = rgb[0];\n\tconst g = rgb[1];\n\tlet b = rgb[2];\n\tconst h = convert.rgb.hsl(rgb)[0];\n\tconst w = 1 / 255 * Math.min(r, Math.min(g, b));\n\n\tb = 1 - 1 / 255 * Math.max(r, Math.max(g, b));\n\n\treturn [h, w * 100, b * 100];\n};\n\nconvert.rgb.cmyk = function (rgb) {\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\n\tconst k = Math.min(1 - r, 1 - g, 1 - b);\n\tconst c = (1 - r - k) / (1 - k) || 0;\n\tconst m = (1 - g - k) / (1 - k) || 0;\n\tconst y = (1 - b - k) / (1 - k) || 0;\n\n\treturn [c * 100, m * 100, y * 100, k * 100];\n};\n\nfunction comparativeDistance(x, y) {\n\t/*\n\t\tSee https://en.m.wikipedia.org/wiki/Euclidean_distance#Squared_Euclidean_distance\n\t*/\n\treturn (\n\t\t((x[0] - y[0]) ** 2) +\n\t\t((x[1] - y[1]) ** 2) +\n\t\t((x[2] - y[2]) ** 2)\n\t);\n}\n\nconvert.rgb.keyword = function (rgb) {\n\tconst reversed = reverseKeywords[rgb];\n\tif (reversed) {\n\t\treturn reversed;\n\t}\n\n\tlet currentClosestDistance = Infinity;\n\tlet currentClosestKeyword;\n\n\tfor (const keyword of Object.keys(cssKeywords)) {\n\t\tconst value = cssKeywords[keyword];\n\n\t\t// Compute comparative distance\n\t\tconst distance = comparativeDistance(rgb, value);\n\n\t\t// Check if its less, if so set as closest\n\t\tif (distance < currentClosestDistance) {\n\t\t\tcurrentClosestDistance = distance;\n\t\t\tcurrentClosestKeyword = keyword;\n\t\t}\n\t}\n\n\treturn currentClosestKeyword;\n};\n\nconvert.keyword.rgb = function (keyword) {\n\treturn cssKeywords[keyword];\n};\n\nconvert.rgb.xyz = function (rgb) {\n\tlet r = rgb[0] / 255;\n\tlet g = rgb[1] / 255;\n\tlet b = rgb[2] / 255;\n\n\t// Assume sRGB\n\tr = r > 0.04045 ? (((r + 0.055) / 1.055) ** 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? (((g + 0.055) / 1.055) ** 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? (((b + 0.055) / 1.055) ** 2.4) : (b / 12.92);\n\n\tconst x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tconst y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tconst z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n\n\treturn [x * 100, y * 100, z * 100];\n};\n\nconvert.rgb.lab = function (rgb) {\n\tconst xyz = convert.rgb.xyz(rgb);\n\tlet x = xyz[0];\n\tlet y = xyz[1];\n\tlet z = xyz[2];\n\n\tx /= 95.047;\n\ty /= 100;\n\tz /= 108.883;\n\n\tx = x > 0.008856 ? (x ** (1 / 3)) : (7.787 * x) + (16 / 116);\n\ty = y > 0.008856 ? (y ** (1 / 3)) : (7.787 * y) + (16 / 116);\n\tz = z > 0.008856 ? (z ** (1 / 3)) : (7.787 * z) + (16 / 116);\n\n\tconst l = (116 * y) - 16;\n\tconst a = 500 * (x - y);\n\tconst b = 200 * (y - z);\n\n\treturn [l, a, b];\n};\n\nconvert.hsl.rgb = function (hsl) {\n\tconst h = hsl[0] / 360;\n\tconst s = hsl[1] / 100;\n\tconst l = hsl[2] / 100;\n\tlet t2;\n\tlet t3;\n\tlet val;\n\n\tif (s === 0) {\n\t\tval = l * 255;\n\t\treturn [val, val, val];\n\t}\n\n\tif (l < 0.5) {\n\t\tt2 = l * (1 + s);\n\t} else {\n\t\tt2 = l + s - l * s;\n\t}\n\n\tconst t1 = 2 * l - t2;\n\n\tconst rgb = [0, 0, 0];\n\tfor (let i = 0; i < 3; i++) {\n\t\tt3 = h + 1 / 3 * -(i - 1);\n\t\tif (t3 < 0) {\n\t\t\tt3++;\n\t\t}\n\n\t\tif (t3 > 1) {\n\t\t\tt3--;\n\t\t}\n\n\t\tif (6 * t3 < 1) {\n\t\t\tval = t1 + (t2 - t1) * 6 * t3;\n\t\t} else if (2 * t3 < 1) {\n\t\t\tval = t2;\n\t\t} else if (3 * t3 < 2) {\n\t\t\tval = t1 + (t2 - t1) * (2 / 3 - t3) * 6;\n\t\t} else {\n\t\t\tval = t1;\n\t\t}\n\n\t\trgb[i] = val * 255;\n\t}\n\n\treturn rgb;\n};\n\nconvert.hsl.hsv = function (hsl) {\n\tconst h = hsl[0];\n\tlet s = hsl[1] / 100;\n\tlet l = hsl[2] / 100;\n\tlet smin = s;\n\tconst lmin = Math.max(l, 0.01);\n\n\tl *= 2;\n\ts *= (l <= 1) ? l : 2 - l;\n\tsmin *= lmin <= 1 ? lmin : 2 - lmin;\n\tconst v = (l + s) / 2;\n\tconst sv = l === 0 ? (2 * smin) / (lmin + smin) : (2 * s) / (l + s);\n\n\treturn [h, sv * 100, v * 100];\n};\n\nconvert.hsv.rgb = function (hsv) {\n\tconst h = hsv[0] / 60;\n\tconst s = hsv[1] / 100;\n\tlet v = hsv[2] / 100;\n\tconst hi = Math.floor(h) % 6;\n\n\tconst f = h - Math.floor(h);\n\tconst p = 255 * v * (1 - s);\n\tconst q = 255 * v * (1 - (s * f));\n\tconst t = 255 * v * (1 - (s * (1 - f)));\n\tv *= 255;\n\n\tswitch (hi) {\n\t\tcase 0:\n\t\t\treturn [v, t, p];\n\t\tcase 1:\n\t\t\treturn [q, v, p];\n\t\tcase 2:\n\t\t\treturn [p, v, t];\n\t\tcase 3:\n\t\t\treturn [p, q, v];\n\t\tcase 4:\n\t\t\treturn [t, p, v];\n\t\tcase 5:\n\t\t\treturn [v, p, q];\n\t}\n};\n\nconvert.hsv.hsl = function (hsv) {\n\tconst h = hsv[0];\n\tconst s = hsv[1] / 100;\n\tconst v = hsv[2] / 100;\n\tconst vmin = Math.max(v, 0.01);\n\tlet sl;\n\tlet l;\n\n\tl = (2 - s) * v;\n\tconst lmin = (2 - s) * vmin;\n\tsl = s * vmin;\n\tsl /= (lmin <= 1) ? lmin : 2 - lmin;\n\tsl = sl || 0;\n\tl /= 2;\n\n\treturn [h, sl * 100, l * 100];\n};\n\n// http://dev.w3.org/csswg/css-color/#hwb-to-rgb\nconvert.hwb.rgb = function (hwb) {\n\tconst h = hwb[0] / 360;\n\tlet wh = hwb[1] / 100;\n\tlet bl = hwb[2] / 100;\n\tconst ratio = wh + bl;\n\tlet f;\n\n\t// Wh + bl cant be > 1\n\tif (ratio > 1) {\n\t\twh /= ratio;\n\t\tbl /= ratio;\n\t}\n\n\tconst i = Math.floor(6 * h);\n\tconst v = 1 - bl;\n\tf = 6 * h - i;\n\n\tif ((i & 0x01) !== 0) {\n\t\tf = 1 - f;\n\t}\n\n\tconst n = wh + f * (v - wh); // Linear interpolation\n\n\tlet r;\n\tlet g;\n\tlet b;\n\t/* eslint-disable max-statements-per-line,no-multi-spaces */\n\tswitch (i) {\n\t\tdefault:\n\t\tcase 6:\n\t\tcase 0: r = v;  g = n;  b = wh; break;\n\t\tcase 1: r = n;  g = v;  b = wh; break;\n\t\tcase 2: r = wh; g = v;  b = n; break;\n\t\tcase 3: r = wh; g = n;  b = v; break;\n\t\tcase 4: r = n;  g = wh; b = v; break;\n\t\tcase 5: r = v;  g = wh; b = n; break;\n\t}\n\t/* eslint-enable max-statements-per-line,no-multi-spaces */\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.cmyk.rgb = function (cmyk) {\n\tconst c = cmyk[0] / 100;\n\tconst m = cmyk[1] / 100;\n\tconst y = cmyk[2] / 100;\n\tconst k = cmyk[3] / 100;\n\n\tconst r = 1 - Math.min(1, c * (1 - k) + k);\n\tconst g = 1 - Math.min(1, m * (1 - k) + k);\n\tconst b = 1 - Math.min(1, y * (1 - k) + k);\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.xyz.rgb = function (xyz) {\n\tconst x = xyz[0] / 100;\n\tconst y = xyz[1] / 100;\n\tconst z = xyz[2] / 100;\n\tlet r;\n\tlet g;\n\tlet b;\n\n\tr = (x * 3.2406) + (y * -1.5372) + (z * -0.4986);\n\tg = (x * -0.9689) + (y * 1.8758) + (z * 0.0415);\n\tb = (x * 0.0557) + (y * -0.2040) + (z * 1.0570);\n\n\t// Assume sRGB\n\tr = r > 0.0031308\n\t\t? ((1.055 * (r ** (1.0 / 2.4))) - 0.055)\n\t\t: r * 12.92;\n\n\tg = g > 0.0031308\n\t\t? ((1.055 * (g ** (1.0 / 2.4))) - 0.055)\n\t\t: g * 12.92;\n\n\tb = b > 0.0031308\n\t\t? ((1.055 * (b ** (1.0 / 2.4))) - 0.055)\n\t\t: b * 12.92;\n\n\tr = Math.min(Math.max(0, r), 1);\n\tg = Math.min(Math.max(0, g), 1);\n\tb = Math.min(Math.max(0, b), 1);\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.xyz.lab = function (xyz) {\n\tlet x = xyz[0];\n\tlet y = xyz[1];\n\tlet z = xyz[2];\n\n\tx /= 95.047;\n\ty /= 100;\n\tz /= 108.883;\n\n\tx = x > 0.008856 ? (x ** (1 / 3)) : (7.787 * x) + (16 / 116);\n\ty = y > 0.008856 ? (y ** (1 / 3)) : (7.787 * y) + (16 / 116);\n\tz = z > 0.008856 ? (z ** (1 / 3)) : (7.787 * z) + (16 / 116);\n\n\tconst l = (116 * y) - 16;\n\tconst a = 500 * (x - y);\n\tconst b = 200 * (y - z);\n\n\treturn [l, a, b];\n};\n\nconvert.lab.xyz = function (lab) {\n\tconst l = lab[0];\n\tconst a = lab[1];\n\tconst b = lab[2];\n\tlet x;\n\tlet y;\n\tlet z;\n\n\ty = (l + 16) / 116;\n\tx = a / 500 + y;\n\tz = y - b / 200;\n\n\tconst y2 = y ** 3;\n\tconst x2 = x ** 3;\n\tconst z2 = z ** 3;\n\ty = y2 > 0.008856 ? y2 : (y - 16 / 116) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16 / 116) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16 / 116) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100;\n\tz *= 108.883;\n\n\treturn [x, y, z];\n};\n\nconvert.lab.lch = function (lab) {\n\tconst l = lab[0];\n\tconst a = lab[1];\n\tconst b = lab[2];\n\tlet h;\n\n\tconst hr = Math.atan2(b, a);\n\th = hr * 360 / 2 / Math.PI;\n\n\tif (h < 0) {\n\t\th += 360;\n\t}\n\n\tconst c = Math.sqrt(a * a + b * b);\n\n\treturn [l, c, h];\n};\n\nconvert.lch.lab = function (lch) {\n\tconst l = lch[0];\n\tconst c = lch[1];\n\tconst h = lch[2];\n\n\tconst hr = h / 360 * 2 * Math.PI;\n\tconst a = c * Math.cos(hr);\n\tconst b = c * Math.sin(hr);\n\n\treturn [l, a, b];\n};\n\nconvert.rgb.ansi16 = function (args, saturation = null) {\n\tconst [r, g, b] = args;\n\tlet value = saturation === null ? convert.rgb.hsv(args)[2] : saturation; // Hsv -> ansi16 optimization\n\n\tvalue = Math.round(value / 50);\n\n\tif (value === 0) {\n\t\treturn 30;\n\t}\n\n\tlet ansi = 30\n\t\t+ ((Math.round(b / 255) << 2)\n\t\t| (Math.round(g / 255) << 1)\n\t\t| Math.round(r / 255));\n\n\tif (value === 2) {\n\t\tansi += 60;\n\t}\n\n\treturn ansi;\n};\n\nconvert.hsv.ansi16 = function (args) {\n\t// Optimization here; we already know the value and don't need to get\n\t// it converted for us.\n\treturn convert.rgb.ansi16(convert.hsv.rgb(args), args[2]);\n};\n\nconvert.rgb.ansi256 = function (args) {\n\tconst r = args[0];\n\tconst g = args[1];\n\tconst b = args[2];\n\n\t// We use the extended greyscale palette here, with the exception of\n\t// black and white. normal palette only has 4 greyscale shades.\n\tif (r === g && g === b) {\n\t\tif (r < 8) {\n\t\t\treturn 16;\n\t\t}\n\n\t\tif (r > 248) {\n\t\t\treturn 231;\n\t\t}\n\n\t\treturn Math.round(((r - 8) / 247) * 24) + 232;\n\t}\n\n\tconst ansi = 16\n\t\t+ (36 * Math.round(r / 255 * 5))\n\t\t+ (6 * Math.round(g / 255 * 5))\n\t\t+ Math.round(b / 255 * 5);\n\n\treturn ansi;\n};\n\nconvert.ansi16.rgb = function (args) {\n\tlet color = args % 10;\n\n\t// Handle greyscale\n\tif (color === 0 || color === 7) {\n\t\tif (args > 50) {\n\t\t\tcolor += 3.5;\n\t\t}\n\n\t\tcolor = color / 10.5 * 255;\n\n\t\treturn [color, color, color];\n\t}\n\n\tconst mult = (~~(args > 50) + 1) * 0.5;\n\tconst r = ((color & 1) * mult) * 255;\n\tconst g = (((color >> 1) & 1) * mult) * 255;\n\tconst b = (((color >> 2) & 1) * mult) * 255;\n\n\treturn [r, g, b];\n};\n\nconvert.ansi256.rgb = function (args) {\n\t// Handle greyscale\n\tif (args >= 232) {\n\t\tconst c = (args - 232) * 10 + 8;\n\t\treturn [c, c, c];\n\t}\n\n\targs -= 16;\n\n\tlet rem;\n\tconst r = Math.floor(args / 36) / 5 * 255;\n\tconst g = Math.floor((rem = args % 36) / 6) / 5 * 255;\n\tconst b = (rem % 6) / 5 * 255;\n\n\treturn [r, g, b];\n};\n\nconvert.rgb.hex = function (args) {\n\tconst integer = ((Math.round(args[0]) & 0xFF) << 16)\n\t\t+ ((Math.round(args[1]) & 0xFF) << 8)\n\t\t+ (Math.round(args[2]) & 0xFF);\n\n\tconst string = integer.toString(16).toUpperCase();\n\treturn '000000'.substring(string.length) + string;\n};\n\nconvert.hex.rgb = function (args) {\n\tconst match = args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);\n\tif (!match) {\n\t\treturn [0, 0, 0];\n\t}\n\n\tlet colorString = match[0];\n\n\tif (match[0].length === 3) {\n\t\tcolorString = colorString.split('').map(char => {\n\t\t\treturn char + char;\n\t\t}).join('');\n\t}\n\n\tconst integer = parseInt(colorString, 16);\n\tconst r = (integer >> 16) & 0xFF;\n\tconst g = (integer >> 8) & 0xFF;\n\tconst b = integer & 0xFF;\n\n\treturn [r, g, b];\n};\n\nconvert.rgb.hcg = function (rgb) {\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\tconst max = Math.max(Math.max(r, g), b);\n\tconst min = Math.min(Math.min(r, g), b);\n\tconst chroma = (max - min);\n\tlet grayscale;\n\tlet hue;\n\n\tif (chroma < 1) {\n\t\tgrayscale = min / (1 - chroma);\n\t} else {\n\t\tgrayscale = 0;\n\t}\n\n\tif (chroma <= 0) {\n\t\thue = 0;\n\t} else\n\tif (max === r) {\n\t\thue = ((g - b) / chroma) % 6;\n\t} else\n\tif (max === g) {\n\t\thue = 2 + (b - r) / chroma;\n\t} else {\n\t\thue = 4 + (r - g) / chroma;\n\t}\n\n\thue /= 6;\n\thue %= 1;\n\n\treturn [hue * 360, chroma * 100, grayscale * 100];\n};\n\nconvert.hsl.hcg = function (hsl) {\n\tconst s = hsl[1] / 100;\n\tconst l = hsl[2] / 100;\n\n\tconst c = l < 0.5 ? (2.0 * s * l) : (2.0 * s * (1.0 - l));\n\n\tlet f = 0;\n\tif (c < 1.0) {\n\t\tf = (l - 0.5 * c) / (1.0 - c);\n\t}\n\n\treturn [hsl[0], c * 100, f * 100];\n};\n\nconvert.hsv.hcg = function (hsv) {\n\tconst s = hsv[1] / 100;\n\tconst v = hsv[2] / 100;\n\n\tconst c = s * v;\n\tlet f = 0;\n\n\tif (c < 1.0) {\n\t\tf = (v - c) / (1 - c);\n\t}\n\n\treturn [hsv[0], c * 100, f * 100];\n};\n\nconvert.hcg.rgb = function (hcg) {\n\tconst h = hcg[0] / 360;\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\n\tif (c === 0.0) {\n\t\treturn [g * 255, g * 255, g * 255];\n\t}\n\n\tconst pure = [0, 0, 0];\n\tconst hi = (h % 1) * 6;\n\tconst v = hi % 1;\n\tconst w = 1 - v;\n\tlet mg = 0;\n\n\t/* eslint-disable max-statements-per-line */\n\tswitch (Math.floor(hi)) {\n\t\tcase 0:\n\t\t\tpure[0] = 1; pure[1] = v; pure[2] = 0; break;\n\t\tcase 1:\n\t\t\tpure[0] = w; pure[1] = 1; pure[2] = 0; break;\n\t\tcase 2:\n\t\t\tpure[0] = 0; pure[1] = 1; pure[2] = v; break;\n\t\tcase 3:\n\t\t\tpure[0] = 0; pure[1] = w; pure[2] = 1; break;\n\t\tcase 4:\n\t\t\tpure[0] = v; pure[1] = 0; pure[2] = 1; break;\n\t\tdefault:\n\t\t\tpure[0] = 1; pure[1] = 0; pure[2] = w;\n\t}\n\t/* eslint-enable max-statements-per-line */\n\n\tmg = (1.0 - c) * g;\n\n\treturn [\n\t\t(c * pure[0] + mg) * 255,\n\t\t(c * pure[1] + mg) * 255,\n\t\t(c * pure[2] + mg) * 255\n\t];\n};\n\nconvert.hcg.hsv = function (hcg) {\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\n\tconst v = c + g * (1.0 - c);\n\tlet f = 0;\n\n\tif (v > 0.0) {\n\t\tf = c / v;\n\t}\n\n\treturn [hcg[0], f * 100, v * 100];\n};\n\nconvert.hcg.hsl = function (hcg) {\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\n\tconst l = g * (1.0 - c) + 0.5 * c;\n\tlet s = 0;\n\n\tif (l > 0.0 && l < 0.5) {\n\t\ts = c / (2 * l);\n\t} else\n\tif (l >= 0.5 && l < 1.0) {\n\t\ts = c / (2 * (1 - l));\n\t}\n\n\treturn [hcg[0], s * 100, l * 100];\n};\n\nconvert.hcg.hwb = function (hcg) {\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\tconst v = c + g * (1.0 - c);\n\treturn [hcg[0], (v - c) * 100, (1 - v) * 100];\n};\n\nconvert.hwb.hcg = function (hwb) {\n\tconst w = hwb[1] / 100;\n\tconst b = hwb[2] / 100;\n\tconst v = 1 - b;\n\tconst c = v - w;\n\tlet g = 0;\n\n\tif (c < 1) {\n\t\tg = (v - c) / (1 - c);\n\t}\n\n\treturn [hwb[0], c * 100, g * 100];\n};\n\nconvert.apple.rgb = function (apple) {\n\treturn [(apple[0] / 65535) * 255, (apple[1] / 65535) * 255, (apple[2] / 65535) * 255];\n};\n\nconvert.rgb.apple = function (rgb) {\n\treturn [(rgb[0] / 255) * 65535, (rgb[1] / 255) * 65535, (rgb[2] / 255) * 65535];\n};\n\nconvert.gray.rgb = function (args) {\n\treturn [args[0] / 100 * 255, args[0] / 100 * 255, args[0] / 100 * 255];\n};\n\nconvert.gray.hsl = function (args) {\n\treturn [0, 0, args[0]];\n};\n\nconvert.gray.hsv = convert.gray.hsl;\n\nconvert.gray.hwb = function (gray) {\n\treturn [0, 100, gray[0]];\n};\n\nconvert.gray.cmyk = function (gray) {\n\treturn [0, 0, 0, gray[0]];\n};\n\nconvert.gray.lab = function (gray) {\n\treturn [gray[0], 0, 0];\n};\n\nconvert.gray.hex = function (gray) {\n\tconst val = Math.round(gray[0] / 100 * 255) & 0xFF;\n\tconst integer = (val << 16) + (val << 8) + val;\n\n\tconst string = integer.toString(16).toUpperCase();\n\treturn '000000'.substring(string.length) + string;\n};\n\nconvert.rgb.gray = function (rgb) {\n\tconst val = (rgb[0] + rgb[1] + rgb[2]) / 3;\n\treturn [val / 255 * 100];\n};\n","'use strict'\r\n\r\nmodule.exports = {\r\n\t\"aliceblue\": [240, 248, 255],\r\n\t\"antiquewhite\": [250, 235, 215],\r\n\t\"aqua\": [0, 255, 255],\r\n\t\"aquamarine\": [127, 255, 212],\r\n\t\"azure\": [240, 255, 255],\r\n\t\"beige\": [245, 245, 220],\r\n\t\"bisque\": [255, 228, 196],\r\n\t\"black\": [0, 0, 0],\r\n\t\"blanchedalmond\": [255, 235, 205],\r\n\t\"blue\": [0, 0, 255],\r\n\t\"blueviolet\": [138, 43, 226],\r\n\t\"brown\": [165, 42, 42],\r\n\t\"burlywood\": [222, 184, 135],\r\n\t\"cadetblue\": [95, 158, 160],\r\n\t\"chartreuse\": [127, 255, 0],\r\n\t\"chocolate\": [210, 105, 30],\r\n\t\"coral\": [255, 127, 80],\r\n\t\"cornflowerblue\": [100, 149, 237],\r\n\t\"cornsilk\": [255, 248, 220],\r\n\t\"crimson\": [220, 20, 60],\r\n\t\"cyan\": [0, 255, 255],\r\n\t\"darkblue\": [0, 0, 139],\r\n\t\"darkcyan\": [0, 139, 139],\r\n\t\"darkgoldenrod\": [184, 134, 11],\r\n\t\"darkgray\": [169, 169, 169],\r\n\t\"darkgreen\": [0, 100, 0],\r\n\t\"darkgrey\": [169, 169, 169],\r\n\t\"darkkhaki\": [189, 183, 107],\r\n\t\"darkmagenta\": [139, 0, 139],\r\n\t\"darkolivegreen\": [85, 107, 47],\r\n\t\"darkorange\": [255, 140, 0],\r\n\t\"darkorchid\": [153, 50, 204],\r\n\t\"darkred\": [139, 0, 0],\r\n\t\"darksalmon\": [233, 150, 122],\r\n\t\"darkseagreen\": [143, 188, 143],\r\n\t\"darkslateblue\": [72, 61, 139],\r\n\t\"darkslategray\": [47, 79, 79],\r\n\t\"darkslategrey\": [47, 79, 79],\r\n\t\"darkturquoise\": [0, 206, 209],\r\n\t\"darkviolet\": [148, 0, 211],\r\n\t\"deeppink\": [255, 20, 147],\r\n\t\"deepskyblue\": [0, 191, 255],\r\n\t\"dimgray\": [105, 105, 105],\r\n\t\"dimgrey\": [105, 105, 105],\r\n\t\"dodgerblue\": [30, 144, 255],\r\n\t\"firebrick\": [178, 34, 34],\r\n\t\"floralwhite\": [255, 250, 240],\r\n\t\"forestgreen\": [34, 139, 34],\r\n\t\"fuchsia\": [255, 0, 255],\r\n\t\"gainsboro\": [220, 220, 220],\r\n\t\"ghostwhite\": [248, 248, 255],\r\n\t\"gold\": [255, 215, 0],\r\n\t\"goldenrod\": [218, 165, 32],\r\n\t\"gray\": [128, 128, 128],\r\n\t\"green\": [0, 128, 0],\r\n\t\"greenyellow\": [173, 255, 47],\r\n\t\"grey\": [128, 128, 128],\r\n\t\"honeydew\": [240, 255, 240],\r\n\t\"hotpink\": [255, 105, 180],\r\n\t\"indianred\": [205, 92, 92],\r\n\t\"indigo\": [75, 0, 130],\r\n\t\"ivory\": [255, 255, 240],\r\n\t\"khaki\": [240, 230, 140],\r\n\t\"lavender\": [230, 230, 250],\r\n\t\"lavenderblush\": [255, 240, 245],\r\n\t\"lawngreen\": [124, 252, 0],\r\n\t\"lemonchiffon\": [255, 250, 205],\r\n\t\"lightblue\": [173, 216, 230],\r\n\t\"lightcoral\": [240, 128, 128],\r\n\t\"lightcyan\": [224, 255, 255],\r\n\t\"lightgoldenrodyellow\": [250, 250, 210],\r\n\t\"lightgray\": [211, 211, 211],\r\n\t\"lightgreen\": [144, 238, 144],\r\n\t\"lightgrey\": [211, 211, 211],\r\n\t\"lightpink\": [255, 182, 193],\r\n\t\"lightsalmon\": [255, 160, 122],\r\n\t\"lightseagreen\": [32, 178, 170],\r\n\t\"lightskyblue\": [135, 206, 250],\r\n\t\"lightslategray\": [119, 136, 153],\r\n\t\"lightslategrey\": [119, 136, 153],\r\n\t\"lightsteelblue\": [176, 196, 222],\r\n\t\"lightyellow\": [255, 255, 224],\r\n\t\"lime\": [0, 255, 0],\r\n\t\"limegreen\": [50, 205, 50],\r\n\t\"linen\": [250, 240, 230],\r\n\t\"magenta\": [255, 0, 255],\r\n\t\"maroon\": [128, 0, 0],\r\n\t\"mediumaquamarine\": [102, 205, 170],\r\n\t\"mediumblue\": [0, 0, 205],\r\n\t\"mediumorchid\": [186, 85, 211],\r\n\t\"mediumpurple\": [147, 112, 219],\r\n\t\"mediumseagreen\": [60, 179, 113],\r\n\t\"mediumslateblue\": [123, 104, 238],\r\n\t\"mediumspringgreen\": [0, 250, 154],\r\n\t\"mediumturquoise\": [72, 209, 204],\r\n\t\"mediumvioletred\": [199, 21, 133],\r\n\t\"midnightblue\": [25, 25, 112],\r\n\t\"mintcream\": [245, 255, 250],\r\n\t\"mistyrose\": [255, 228, 225],\r\n\t\"moccasin\": [255, 228, 181],\r\n\t\"navajowhite\": [255, 222, 173],\r\n\t\"navy\": [0, 0, 128],\r\n\t\"oldlace\": [253, 245, 230],\r\n\t\"olive\": [128, 128, 0],\r\n\t\"olivedrab\": [107, 142, 35],\r\n\t\"orange\": [255, 165, 0],\r\n\t\"orangered\": [255, 69, 0],\r\n\t\"orchid\": [218, 112, 214],\r\n\t\"palegoldenrod\": [238, 232, 170],\r\n\t\"palegreen\": [152, 251, 152],\r\n\t\"paleturquoise\": [175, 238, 238],\r\n\t\"palevioletred\": [219, 112, 147],\r\n\t\"papayawhip\": [255, 239, 213],\r\n\t\"peachpuff\": [255, 218, 185],\r\n\t\"peru\": [205, 133, 63],\r\n\t\"pink\": [255, 192, 203],\r\n\t\"plum\": [221, 160, 221],\r\n\t\"powderblue\": [176, 224, 230],\r\n\t\"purple\": [128, 0, 128],\r\n\t\"rebeccapurple\": [102, 51, 153],\r\n\t\"red\": [255, 0, 0],\r\n\t\"rosybrown\": [188, 143, 143],\r\n\t\"royalblue\": [65, 105, 225],\r\n\t\"saddlebrown\": [139, 69, 19],\r\n\t\"salmon\": [250, 128, 114],\r\n\t\"sandybrown\": [244, 164, 96],\r\n\t\"seagreen\": [46, 139, 87],\r\n\t\"seashell\": [255, 245, 238],\r\n\t\"sienna\": [160, 82, 45],\r\n\t\"silver\": [192, 192, 192],\r\n\t\"skyblue\": [135, 206, 235],\r\n\t\"slateblue\": [106, 90, 205],\r\n\t\"slategray\": [112, 128, 144],\r\n\t\"slategrey\": [112, 128, 144],\r\n\t\"snow\": [255, 250, 250],\r\n\t\"springgreen\": [0, 255, 127],\r\n\t\"steelblue\": [70, 130, 180],\r\n\t\"tan\": [210, 180, 140],\r\n\t\"teal\": [0, 128, 128],\r\n\t\"thistle\": [216, 191, 216],\r\n\t\"tomato\": [255, 99, 71],\r\n\t\"turquoise\": [64, 224, 208],\r\n\t\"violet\": [238, 130, 238],\r\n\t\"wheat\": [245, 222, 179],\r\n\t\"white\": [255, 255, 255],\r\n\t\"whitesmoke\": [245, 245, 245],\r\n\t\"yellow\": [255, 255, 0],\r\n\t\"yellowgreen\": [154, 205, 50]\r\n};\r\n","const conversions = require('./conversions');\n\n/*\n\tThis function routes a model to all other models.\n\n\tall functions that are routed have a property `.conversion` attached\n\tto the returned synthetic function. This property is an array\n\tof strings, each with the steps in between the 'from' and 'to'\n\tcolor models (inclusive).\n\n\tconversions that are not possible simply are not included.\n*/\n\nfunction buildGraph() {\n\tconst graph = {};\n\t// https://jsperf.com/object-keys-vs-for-in-with-closure/3\n\tconst models = Object.keys(conversions);\n\n\tfor (let len = models.length, i = 0; i < len; i++) {\n\t\tgraph[models[i]] = {\n\t\t\t// http://jsperf.com/1-vs-infinity\n\t\t\t// micro-opt, but this is simple.\n\t\t\tdistance: -1,\n\t\t\tparent: null\n\t\t};\n\t}\n\n\treturn graph;\n}\n\n// https://en.wikipedia.org/wiki/Breadth-first_search\nfunction deriveBFS(fromModel) {\n\tconst graph = buildGraph();\n\tconst queue = [fromModel]; // Unshift -> queue -> pop\n\n\tgraph[fromModel].distance = 0;\n\n\twhile (queue.length) {\n\t\tconst current = queue.pop();\n\t\tconst adjacents = Object.keys(conversions[current]);\n\n\t\tfor (let len = adjacents.length, i = 0; i < len; i++) {\n\t\t\tconst adjacent = adjacents[i];\n\t\t\tconst node = graph[adjacent];\n\n\t\t\tif (node.distance === -1) {\n\t\t\t\tnode.distance = graph[current].distance + 1;\n\t\t\t\tnode.parent = current;\n\t\t\t\tqueue.unshift(adjacent);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn graph;\n}\n\nfunction link(from, to) {\n\treturn function (args) {\n\t\treturn to(from(args));\n\t};\n}\n\nfunction wrapConversion(toModel, graph) {\n\tconst path = [graph[toModel].parent, toModel];\n\tlet fn = conversions[graph[toModel].parent][toModel];\n\n\tlet cur = graph[toModel].parent;\n\twhile (graph[cur].parent) {\n\t\tpath.unshift(graph[cur].parent);\n\t\tfn = link(conversions[graph[cur].parent][cur], fn);\n\t\tcur = graph[cur].parent;\n\t}\n\n\tfn.conversion = path;\n\treturn fn;\n}\n\nmodule.exports = function (fromModel) {\n\tconst graph = deriveBFS(fromModel);\n\tconst conversion = {};\n\n\tconst models = Object.keys(graph);\n\tfor (let len = models.length, i = 0; i < len; i++) {\n\t\tconst toModel = models[i];\n\t\tconst node = graph[toModel];\n\n\t\tif (node.parent === null) {\n\t\t\t// No possible conversion, or this node is the source model.\n\t\t\tcontinue;\n\t\t}\n\n\t\tconversion[toModel] = wrapConversion(toModel, graph);\n\t}\n\n\treturn conversion;\n};\n\n","const conversions = require('./conversions');\nconst route = require('./route');\n\nconst convert = {};\n\nconst models = Object.keys(conversions);\n\nfunction wrapRaw(fn) {\n\tconst wrappedFn = function (...args) {\n\t\tconst arg0 = args[0];\n\t\tif (arg0 === undefined || arg0 === null) {\n\t\t\treturn arg0;\n\t\t}\n\n\t\tif (arg0.length > 1) {\n\t\t\targs = arg0;\n\t\t}\n\n\t\treturn fn(args);\n\t};\n\n\t// Preserve .conversion property if there is one\n\tif ('conversion' in fn) {\n\t\twrappedFn.conversion = fn.conversion;\n\t}\n\n\treturn wrappedFn;\n}\n\nfunction wrapRounded(fn) {\n\tconst wrappedFn = function (...args) {\n\t\tconst arg0 = args[0];\n\n\t\tif (arg0 === undefined || arg0 === null) {\n\t\t\treturn arg0;\n\t\t}\n\n\t\tif (arg0.length > 1) {\n\t\t\targs = arg0;\n\t\t}\n\n\t\tconst result = fn(args);\n\n\t\t// We're assuming the result is an array here.\n\t\t// see notice in conversions.js; don't use box types\n\t\t// in conversion functions.\n\t\tif (typeof result === 'object') {\n\t\t\tfor (let len = result.length, i = 0; i < len; i++) {\n\t\t\t\tresult[i] = Math.round(result[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t// Preserve .conversion property if there is one\n\tif ('conversion' in fn) {\n\t\twrappedFn.conversion = fn.conversion;\n\t}\n\n\treturn wrappedFn;\n}\n\nmodels.forEach(fromModel => {\n\tconvert[fromModel] = {};\n\n\tObject.defineProperty(convert[fromModel], 'channels', {value: conversions[fromModel].channels});\n\tObject.defineProperty(convert[fromModel], 'labels', {value: conversions[fromModel].labels});\n\n\tconst routes = route(fromModel);\n\tconst routeModels = Object.keys(routes);\n\n\trouteModels.forEach(toModel => {\n\t\tconst fn = routes[toModel];\n\n\t\tconvert[fromModel][toModel] = wrapRounded(fn);\n\t\tconvert[fromModel][toModel].raw = wrapRaw(fn);\n\t});\n});\n\nmodule.exports = convert;\n","const colorString = require('color-string');\nconst convert = require('color-convert');\n\nconst skippedModels = [\n\t// To be honest, I don't really feel like keyword belongs in color convert, but eh.\n\t'keyword',\n\n\t// Gray conflicts with some method names, and has its own method defined.\n\t'gray',\n\n\t// Shouldn't really be in color-convert either...\n\t'hex',\n];\n\nconst hashedModelKeys = {};\nfor (const model of Object.keys(convert)) {\n\thashedModelKeys[[...convert[model].labels].sort().join('')] = model;\n}\n\nconst limiters = {};\n\nfunction Color(object, model) {\n\tif (!(this instanceof Color)) {\n\t\treturn new Color(object, model);\n\t}\n\n\tif (model && model in skippedModels) {\n\t\tmodel = null;\n\t}\n\n\tif (model && !(model in convert)) {\n\t\tthrow new Error('Unknown model: ' + model);\n\t}\n\n\tlet i;\n\tlet channels;\n\n\tif (object == null) { // eslint-disable-line no-eq-null,eqeqeq\n\t\tthis.model = 'rgb';\n\t\tthis.color = [0, 0, 0];\n\t\tthis.valpha = 1;\n\t} else if (object instanceof Color) {\n\t\tthis.model = object.model;\n\t\tthis.color = [...object.color];\n\t\tthis.valpha = object.valpha;\n\t} else if (typeof object === 'string') {\n\t\tconst result = colorString.get(object);\n\t\tif (result === null) {\n\t\t\tthrow new Error('Unable to parse color from string: ' + object);\n\t\t}\n\n\t\tthis.model = result.model;\n\t\tchannels = convert[this.model].channels;\n\t\tthis.color = result.value.slice(0, channels);\n\t\tthis.valpha = typeof result.value[channels] === 'number' ? result.value[channels] : 1;\n\t} else if (object.length > 0) {\n\t\tthis.model = model || 'rgb';\n\t\tchannels = convert[this.model].channels;\n\t\tconst newArray = Array.prototype.slice.call(object, 0, channels);\n\t\tthis.color = zeroArray(newArray, channels);\n\t\tthis.valpha = typeof object[channels] === 'number' ? object[channels] : 1;\n\t} else if (typeof object === 'number') {\n\t\t// This is always RGB - can be converted later on.\n\t\tthis.model = 'rgb';\n\t\tthis.color = [\n\t\t\t(object >> 16) & 0xFF,\n\t\t\t(object >> 8) & 0xFF,\n\t\t\tobject & 0xFF,\n\t\t];\n\t\tthis.valpha = 1;\n\t} else {\n\t\tthis.valpha = 1;\n\n\t\tconst keys = Object.keys(object);\n\t\tif ('alpha' in object) {\n\t\t\tkeys.splice(keys.indexOf('alpha'), 1);\n\t\t\tthis.valpha = typeof object.alpha === 'number' ? object.alpha : 0;\n\t\t}\n\n\t\tconst hashedKeys = keys.sort().join('');\n\t\tif (!(hashedKeys in hashedModelKeys)) {\n\t\t\tthrow new Error('Unable to parse color from object: ' + JSON.stringify(object));\n\t\t}\n\n\t\tthis.model = hashedModelKeys[hashedKeys];\n\n\t\tconst {labels} = convert[this.model];\n\t\tconst color = [];\n\t\tfor (i = 0; i < labels.length; i++) {\n\t\t\tcolor.push(object[labels[i]]);\n\t\t}\n\n\t\tthis.color = zeroArray(color);\n\t}\n\n\t// Perform limitations (clamping, etc.)\n\tif (limiters[this.model]) {\n\t\tchannels = convert[this.model].channels;\n\t\tfor (i = 0; i < channels; i++) {\n\t\t\tconst limit = limiters[this.model][i];\n\t\t\tif (limit) {\n\t\t\t\tthis.color[i] = limit(this.color[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.valpha = Math.max(0, Math.min(1, this.valpha));\n\n\tif (Object.freeze) {\n\t\tObject.freeze(this);\n\t}\n}\n\nColor.prototype = {\n\ttoString() {\n\t\treturn this.string();\n\t},\n\n\ttoJSON() {\n\t\treturn this[this.model]();\n\t},\n\n\tstring(places) {\n\t\tlet self = this.model in colorString.to ? this : this.rgb();\n\t\tself = self.round(typeof places === 'number' ? places : 1);\n\t\tconst args = self.valpha === 1 ? self.color : [...self.color, this.valpha];\n\t\treturn colorString.to[self.model](args);\n\t},\n\n\tpercentString(places) {\n\t\tconst self = this.rgb().round(typeof places === 'number' ? places : 1);\n\t\tconst args = self.valpha === 1 ? self.color : [...self.color, this.valpha];\n\t\treturn colorString.to.rgb.percent(args);\n\t},\n\n\tarray() {\n\t\treturn this.valpha === 1 ? [...this.color] : [...this.color, this.valpha];\n\t},\n\n\tobject() {\n\t\tconst result = {};\n\t\tconst {channels} = convert[this.model];\n\t\tconst {labels} = convert[this.model];\n\n\t\tfor (let i = 0; i < channels; i++) {\n\t\t\tresult[labels[i]] = this.color[i];\n\t\t}\n\n\t\tif (this.valpha !== 1) {\n\t\t\tresult.alpha = this.valpha;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tunitArray() {\n\t\tconst rgb = this.rgb().color;\n\t\trgb[0] /= 255;\n\t\trgb[1] /= 255;\n\t\trgb[2] /= 255;\n\n\t\tif (this.valpha !== 1) {\n\t\t\trgb.push(this.valpha);\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tunitObject() {\n\t\tconst rgb = this.rgb().object();\n\t\trgb.r /= 255;\n\t\trgb.g /= 255;\n\t\trgb.b /= 255;\n\n\t\tif (this.valpha !== 1) {\n\t\t\trgb.alpha = this.valpha;\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tround(places) {\n\t\tplaces = Math.max(places || 0, 0);\n\t\treturn new Color([...this.color.map(roundToPlace(places)), this.valpha], this.model);\n\t},\n\n\talpha(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color([...this.color, Math.max(0, Math.min(1, value))], this.model);\n\t\t}\n\n\t\treturn this.valpha;\n\t},\n\n\t// Rgb\n\tred: getset('rgb', 0, maxfn(255)),\n\tgreen: getset('rgb', 1, maxfn(255)),\n\tblue: getset('rgb', 2, maxfn(255)),\n\n\thue: getset(['hsl', 'hsv', 'hsl', 'hwb', 'hcg'], 0, value => ((value % 360) + 360) % 360),\n\n\tsaturationl: getset('hsl', 1, maxfn(100)),\n\tlightness: getset('hsl', 2, maxfn(100)),\n\n\tsaturationv: getset('hsv', 1, maxfn(100)),\n\tvalue: getset('hsv', 2, maxfn(100)),\n\n\tchroma: getset('hcg', 1, maxfn(100)),\n\tgray: getset('hcg', 2, maxfn(100)),\n\n\twhite: getset('hwb', 1, maxfn(100)),\n\twblack: getset('hwb', 2, maxfn(100)),\n\n\tcyan: getset('cmyk', 0, maxfn(100)),\n\tmagenta: getset('cmyk', 1, maxfn(100)),\n\tyellow: getset('cmyk', 2, maxfn(100)),\n\tblack: getset('cmyk', 3, maxfn(100)),\n\n\tx: getset('xyz', 0, maxfn(95.047)),\n\ty: getset('xyz', 1, maxfn(100)),\n\tz: getset('xyz', 2, maxfn(108.833)),\n\n\tl: getset('lab', 0, maxfn(100)),\n\ta: getset('lab', 1),\n\tb: getset('lab', 2),\n\n\tkeyword(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color(value);\n\t\t}\n\n\t\treturn convert[this.model].keyword(this.color);\n\t},\n\n\thex(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color(value);\n\t\t}\n\n\t\treturn colorString.to.hex(this.rgb().round().color);\n\t},\n\n\thexa(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color(value);\n\t\t}\n\n\t\tconst rgbArray = this.rgb().round().color;\n\n\t\tlet alphaHex = Math.round(this.valpha * 255).toString(16).toUpperCase();\n\t\tif (alphaHex.length === 1) {\n\t\t\talphaHex = '0' + alphaHex;\n\t\t}\n\n\t\treturn colorString.to.hex(rgbArray) + alphaHex;\n\t},\n\n\trgbNumber() {\n\t\tconst rgb = this.rgb().color;\n\t\treturn ((rgb[0] & 0xFF) << 16) | ((rgb[1] & 0xFF) << 8) | (rgb[2] & 0xFF);\n\t},\n\n\tluminosity() {\n\t\t// http://www.w3.org/TR/WCAG20/#relativeluminancedef\n\t\tconst rgb = this.rgb().color;\n\n\t\tconst lum = [];\n\t\tfor (const [i, element] of rgb.entries()) {\n\t\t\tconst chan = element / 255;\n\t\t\tlum[i] = (chan <= 0.04045) ? chan / 12.92 : ((chan + 0.055) / 1.055) ** 2.4;\n\t\t}\n\n\t\treturn 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];\n\t},\n\n\tcontrast(color2) {\n\t\t// http://www.w3.org/TR/WCAG20/#contrast-ratiodef\n\t\tconst lum1 = this.luminosity();\n\t\tconst lum2 = color2.luminosity();\n\n\t\tif (lum1 > lum2) {\n\t\t\treturn (lum1 + 0.05) / (lum2 + 0.05);\n\t\t}\n\n\t\treturn (lum2 + 0.05) / (lum1 + 0.05);\n\t},\n\n\tlevel(color2) {\n\t\t// https://www.w3.org/TR/WCAG/#contrast-enhanced\n\t\tconst contrastRatio = this.contrast(color2);\n\t\tif (contrastRatio >= 7) {\n\t\t\treturn 'AAA';\n\t\t}\n\n\t\treturn (contrastRatio >= 4.5) ? 'AA' : '';\n\t},\n\n\tisDark() {\n\t\t// YIQ equation from http://24ways.org/2010/calculating-color-contrast\n\t\tconst rgb = this.rgb().color;\n\t\tconst yiq = (rgb[0] * 2126 + rgb[1] * 7152 + rgb[2] * 722) / 10000;\n\t\treturn yiq < 128;\n\t},\n\n\tisLight() {\n\t\treturn !this.isDark();\n\t},\n\n\tnegate() {\n\t\tconst rgb = this.rgb();\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\trgb.color[i] = 255 - rgb.color[i];\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tlighten(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[2] += hsl.color[2] * ratio;\n\t\treturn hsl;\n\t},\n\n\tdarken(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[2] -= hsl.color[2] * ratio;\n\t\treturn hsl;\n\t},\n\n\tsaturate(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[1] += hsl.color[1] * ratio;\n\t\treturn hsl;\n\t},\n\n\tdesaturate(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[1] -= hsl.color[1] * ratio;\n\t\treturn hsl;\n\t},\n\n\twhiten(ratio) {\n\t\tconst hwb = this.hwb();\n\t\thwb.color[1] += hwb.color[1] * ratio;\n\t\treturn hwb;\n\t},\n\n\tblacken(ratio) {\n\t\tconst hwb = this.hwb();\n\t\thwb.color[2] += hwb.color[2] * ratio;\n\t\treturn hwb;\n\t},\n\n\tgrayscale() {\n\t\t// http://en.wikipedia.org/wiki/Grayscale#Converting_color_to_grayscale\n\t\tconst rgb = this.rgb().color;\n\t\tconst value = rgb[0] * 0.3 + rgb[1] * 0.59 + rgb[2] * 0.11;\n\t\treturn Color.rgb(value, value, value);\n\t},\n\n\tfade(ratio) {\n\t\treturn this.alpha(this.valpha - (this.valpha * ratio));\n\t},\n\n\topaquer(ratio) {\n\t\treturn this.alpha(this.valpha + (this.valpha * ratio));\n\t},\n\n\trotate(degrees) {\n\t\tconst hsl = this.hsl();\n\t\tlet hue = hsl.color[0];\n\t\thue = (hue + degrees) % 360;\n\t\thue = hue < 0 ? 360 + hue : hue;\n\t\thsl.color[0] = hue;\n\t\treturn hsl;\n\t},\n\n\tmix(mixinColor, weight) {\n\t\t// Ported from sass implementation in C\n\t\t// https://github.com/sass/libsass/blob/0e6b4a2850092356aa3ece07c6b249f0221caced/functions.cpp#L209\n\t\tif (!mixinColor || !mixinColor.rgb) {\n\t\t\tthrow new Error('Argument to \"mix\" was not a Color instance, but rather an instance of ' + typeof mixinColor);\n\t\t}\n\n\t\tconst color1 = mixinColor.rgb();\n\t\tconst color2 = this.rgb();\n\t\tconst p = weight === undefined ? 0.5 : weight;\n\n\t\tconst w = 2 * p - 1;\n\t\tconst a = color1.alpha() - color2.alpha();\n\n\t\tconst w1 = (((w * a === -1) ? w : (w + a) / (1 + w * a)) + 1) / 2;\n\t\tconst w2 = 1 - w1;\n\n\t\treturn Color.rgb(\n\t\t\tw1 * color1.red() + w2 * color2.red(),\n\t\t\tw1 * color1.green() + w2 * color2.green(),\n\t\t\tw1 * color1.blue() + w2 * color2.blue(),\n\t\t\tcolor1.alpha() * p + color2.alpha() * (1 - p));\n\t},\n};\n\n// Model conversion methods and static constructors\nfor (const model of Object.keys(convert)) {\n\tif (skippedModels.includes(model)) {\n\t\tcontinue;\n\t}\n\n\tconst {channels} = convert[model];\n\n\t// Conversion methods\n\tColor.prototype[model] = function (...args) {\n\t\tif (this.model === model) {\n\t\t\treturn new Color(this);\n\t\t}\n\n\t\tif (args.length > 0) {\n\t\t\treturn new Color(args, model);\n\t\t}\n\n\t\treturn new Color([...assertArray(convert[this.model][model].raw(this.color)), this.valpha], model);\n\t};\n\n\t// 'static' construction methods\n\tColor[model] = function (...args) {\n\t\tlet color = args[0];\n\t\tif (typeof color === 'number') {\n\t\t\tcolor = zeroArray(args, channels);\n\t\t}\n\n\t\treturn new Color(color, model);\n\t};\n}\n\nfunction roundTo(number, places) {\n\treturn Number(number.toFixed(places));\n}\n\nfunction roundToPlace(places) {\n\treturn function (number) {\n\t\treturn roundTo(number, places);\n\t};\n}\n\nfunction getset(model, channel, modifier) {\n\tmodel = Array.isArray(model) ? model : [model];\n\n\tfor (const m of model) {\n\t\t(limiters[m] || (limiters[m] = []))[channel] = modifier;\n\t}\n\n\tmodel = model[0];\n\n\treturn function (value) {\n\t\tlet result;\n\n\t\tif (value !== undefined) {\n\t\t\tif (modifier) {\n\t\t\t\tvalue = modifier(value);\n\t\t\t}\n\n\t\t\tresult = this[model]();\n\t\t\tresult.color[channel] = value;\n\t\t\treturn result;\n\t\t}\n\n\t\tresult = this[model]().color[channel];\n\t\tif (modifier) {\n\t\t\tresult = modifier(result);\n\t\t}\n\n\t\treturn result;\n\t};\n}\n\nfunction maxfn(max) {\n\treturn function (v) {\n\t\treturn Math.max(0, Math.min(max, v));\n\t};\n}\n\nfunction assertArray(value) {\n\treturn Array.isArray(value) ? value : [value];\n}\n\nfunction zeroArray(array, length) {\n\tfor (let i = 0; i < length; i++) {\n\t\tif (typeof array[i] !== 'number') {\n\t\t\tarray[i] = 0;\n\t\t}\n\t}\n\n\treturn array;\n}\n\nmodule.exports = Color;\n","import { getSkipActionPrompt } from \"../documents/settings.mjs\";\nimport Color from \"color\";\n\n/* -------------------------------------------- */\n\nexport const createCustomChatMessage = async function (\n  chatTemplate,\n  chatTemplateData = {},\n  chatData = {},\n  { rolls = [] } = {}\n) {\n  chatData = mergeObject(\n    {\n      user: game.user.id,\n      type: CONST.CHAT_MESSAGE_TYPES.CHAT,\n    },\n    chatData\n  );\n\n  chatData.content = await renderTemplate(chatTemplate, chatTemplateData);\n\n  // Handle different roll modes\n  ChatMessage.implementation.applyRollMode(chatData, chatData.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\n\n  // Dice So Nice integration\n  if (chatData.roll != null && rolls.length === 0) rolls = [chatData.roll];\n  if (game.dice3d != null && game.dice3d.isEnabled()) {\n    for (const roll of rolls) {\n      await game.dice3d.showForRoll(roll, game.user, false, chatData.whisper, chatData.blind);\n      chatData.sound = null;\n    }\n  }\n\n  return ChatMessage.implementation.create(chatData);\n};\n\nexport const hideRollInfo = function (app, html, data) {\n  const whisper = app.whisper || [];\n  const isBlind = whisper.length && app.blind;\n  const isVisible = whisper.length ? whisper.includes(game.user.id) || (app.isAuthor && !isBlind) : true;\n  if (!isVisible) {\n    html.find(\".dice-formula\").text(\"???\");\n    html.find(\".dice-total\").text(\"?\");\n    html.find(\".dice\").text(\"\");\n    html.find(\".success\").removeClass(\"success\");\n    html.find(\".failure\").removeClass(\"failure\");\n  }\n};\n\n/**\n * Generates an info block containing an item's identified info for GMs\n *\n * @remarks This HTML has to be generated in a synchronous way, as adding to a rendered chat message's content\n *          will cause erratic scrolling behaviour.\n * @param {ChatMessageFFD20IdentifiedInfo} info - An object containing the item's identified info\n * @returns {string} HTML string containing the info block\n */\nconst getIdentifiedBlock = (info) => {\n  const hasCombinedName = info.actionName && !info.actionDescription;\n  return (\n    _templateCache[\"systems/ffd20/templates/chat/parts/gm-description.hbs\"]?.(\n      { ...info, hasCombinedName },\n      { allowProtoMethodsByDefault: true, allowProtoPropertiesByDefault: true }\n    ) ?? \"\"\n  );\n};\n\n/**\n * Add GM-sensitive info for GMs and hide GM-sensitive info for players\n *\n * @param {ChatMessageFFD20} app - The chat message\n * @param {JQuery} html - The chat message's HTML\n * @param {object} data - Data used to render the chat message\n */\nexport const hideGMSensitiveInfo = function (app, html, data) {\n  // Handle adding of GM-sensitive info\n  if (game.user.isGM) {\n    // Show identified info box for GM if item was unidentified when rolled\n    const identifiedInfo = app.flags.ffd20?.identifiedInfo ?? {};\n    const { identified = true } = identifiedInfo;\n    if (!identified && app.hasItemSource) {\n      const cardContent = html.find(\".card-content\");\n      cardContent.append(getIdentifiedBlock(identifiedInfo));\n    }\n    // Return early, as the rest of the function handles removing already existing info\n    return;\n  }\n\n  // Hide info that's always sensitive, no matter the card's owner\n  html.find(\".gm-sensitive-always\").remove();\n\n  // Hide info about unowned tokens\n  html.find(\"[data-gm-sensitive-uuid]\").each((a, elem) => {\n    // Quickly hide element\n    elem = $(elem);\n    elem.hide();\n\n    // Then check for stuff\n    const uuid = elem.data(\"gm-sensitive-uuid\");\n    if (!uuid) return;\n    fromUuid(uuid).then((obj) => {\n      // If token or token document, get actor for testing user permissions\n      if (obj instanceof Token || obj instanceof TokenDocument) obj = obj.actor;\n      //  Show element again, since we have permission\n      if (obj?.testUserPermission && obj.testUserPermission(game.user, \"OBSERVER\")) {\n        elem.show();\n      }\n      // Remove element completely, since we don't have permission\n      else {\n        elem.remove();\n      }\n    });\n  });\n\n  const speaker = app.speaker;\n  let actor = null;\n  if (speaker != null) {\n    if (speaker.token) {\n      actor = game.actors.tokens[speaker.token];\n    }\n    if (!actor) {\n      actor = game.actors.get(speaker.actor);\n    }\n  }\n\n  if (!actor || (actor && actor.testUserPermission(game.user, \"OBSERVER\"))) return;\n\n  // Hide info\n  html.find(\".gm-sensitive\").remove();\n\n  // Alter GM inner texts\n  html.find(\"[data-gm-sensitive-inner]\").each((a, elem) => {\n    if (!game.settings.get(\"ffd20\", \"obscureSaveDCs\") && elem.dataset.action === \"save\") return;\n\n    elem = $(elem);\n    elem.text(elem.data(\"gm-sensitive-inner\"));\n    elem.removeData(\"gm-sensitive-inner\");\n  });\n\n  if (game.settings.get(\"ffd20\", \"obscureInlineRolls\")) {\n    // Turn rolls into raw strings\n    html.find(\".inline-roll\").each((a, elem) => {\n      const roll = Roll.fromJSON(unescape(elem.dataset.roll));\n      const parent = elem.parentNode;\n      parent.insertBefore($(`<span>${roll.total}</span>`)[0], elem);\n      parent.removeChild(elem);\n    });\n  }\n};\n\nexport const addChatCardTitleGradient = async function (app, html, data) {\n  const card = html.find(\".chat-card\")[0];\n  if (!card) return;\n  const actor = await CONFIG.Item.documentClasses.default._getChatCardActor(card);\n  if (!actor) return;\n  const item = actor.items.get(card.dataset.itemId);\n  if (!item) return;\n  const title = $(card).find(\".card-header\");\n  if (!title.length) return;\n\n  title.css(\"background-image\", `linear-gradient(to right, ${item.typeColor}, ${item.typeColor2})`);\n\n  const titleText = title.find(\"h2, h3\");\n  if (Color(item.typeColor).isLight()) titleText.css(\"color\", \"black\");\n  else titleText.css(\"color\", \"white\");\n};\n\nexport const alterAmmoRecovery = function (app, html) {\n  const recoveryData = app.getFlag(\"ffd20\", \"ammoRecovery\");\n  if (!recoveryData) return;\n\n  html.find(\".chat-attack .ammo[data-ammo-id]\").each((a, el) => {\n    const attackIndex = el.closest(\".chat-attack\").dataset.index;\n    const ammoId = el.dataset.ammoId;\n    const data = recoveryData[attackIndex]?.[ammoId];\n    if (!data) return;\n    $(el)\n      .find(\".inline-action\")\n      .each((i, ia) => {\n        // TODO: Disable button & track proper quantities\n        if (data.recovered) ia.classList.add(\"recovered\");\n        if (data.failed) ia.classList.add(\"recovery-failed\");\n      });\n  });\n};\n\nexport const alterTargetDefense = function (app, html) {\n  const defenseData = app.getFlag(\"ffd20\", \"targetDefense\");\n  if (!defenseData) return;\n\n  html.find(\".attack-targets .saving-throws div[data-saving-throw]\").each((a, el) => {\n    const actorUUID = el.closest(\".target\").dataset.uuid;\n    const save = el.dataset.savingThrow;\n    const value = getProperty(defenseData, `${actorUUID}.save.${save}`);\n    if (value == null) return;\n    $(el).find(\".value\").text(value.toString());\n  });\n};\n\nexport const applyAccessibilitySettings = function (app, html, data, conf) {};\n\n/**\n * Returns an inline roll string suitable for chat messages.\n *\n * @param {Roll} roll - The roll to be stringified\n * @param {object} [options] - Additional options affecting the inline roll\n * @param {boolean} [options.hide3d] - Whether the roll should be hidden from DsN\n * @returns {string} The inline roll string\n */\nexport const createInlineRollString = (roll, { hide3d = true } = {}) =>\n  `<a class=\"inline-roll inline-result ${hide3d ? \"inline-dsn-hidden\" : \"\"}\" \\\n  title=\"${roll.formula}\" data-roll=\"${escape(JSON.stringify(roll))}\"> \\\n  <i class=\"fas fa-dice-d20\"></i> ${roll.total}</a>`;\n\nexport const hideInvisibleTargets = async function (app, html) {\n  const targetElems = html.find(\".attack-targets .target\");\n  const targets = targetElems.toArray().reduce((cur, o) => {\n    cur.push({ uuid: o.dataset.uuid, elem: o });\n    return cur;\n  }, []);\n\n  for (const t of targets) {\n    const elem = $(t.elem);\n\n    // Gather token\n    const token = await fromUuid(t.uuid);\n    if (!token) continue;\n    t.token = token.object;\n\n    // Hide if token invisible\n    if (!t.token?.visible) elem.hide();\n    else elem.show();\n  }\n};\n\nexport const addTargetCallbacks = function (app, html) {\n  const targetElems = html.find(\".attack-targets .target[data-uuid]\");\n\n  // Define getter functions\n  const _getTokenByElem = async function (elem) {\n    return (await fromUuid(elem?.dataset.uuid ?? \"\"))?.object;\n  };\n  const _getRootTargetElement = function (elem) {\n    if (elem.dataset.uuid != null) return elem;\n    return elem.closest(\"[data-uuid]\");\n  };\n\n  // Create image callback functions\n  const _mouseEnterCallback = function (event) {\n    _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n      t?._onHoverIn(event, { hoverOutOthers: false });\n    });\n  };\n  const _mouseLeaveCallback = function (event) {\n    _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n      t?._onHoverOut(event);\n    });\n  };\n  const _imageClickCallback = function (event) {\n    event.preventDefault();\n    _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n      if (t?.actor.testUserPermission(game.user, \"OWNER\")) {\n        if (t._controlled) {\n          if (event.shiftKey) t.release();\n        } else {\n          t.control({ releaseOthers: !event.shiftKey });\n        }\n      }\n    });\n  };\n\n  // Add callbacks\n  for (let elem of targetElems) {\n    elem = $(elem);\n\n    // Image element events\n    const imgElem = elem.find(\".target-image\");\n    imgElem.on(\"mouseenter\", _mouseEnterCallback);\n    imgElem.on(\"mouseleave\", _mouseLeaveCallback);\n    imgElem.on(\"click\", _imageClickCallback);\n\n    // Misc element events\n    elem.find(\".ac\").on(\"click\", (event) => {\n      event.preventDefault();\n\n      _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n        if (!t?.actor) return;\n        ffd20.utils.chat.targetACClick(app, html, t.actor, event);\n      });\n    });\n    elem.find(\".saving-throws .click\").on(\"click\", (event) => {\n      event.preventDefault();\n\n      _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n        if (!t?.actor) return;\n        ffd20.utils.chat.targetSavingThrowClick(app, html, t.actor, event);\n      });\n    });\n  }\n};\n\nexport const targetACClick = async function (app, html, actor, event) {\n  actor.rollDefenses({ rollMode: \"selfroll\" });\n};\n\nexport const targetSavingThrowClick = async function (app, html, actor, event) {\n  const elem = event.currentTarget;\n  const save = elem.dataset.savingThrow;\n\n  const message = await actor.rollSavingThrow(save, { event, skipDialog: getSkipActionPrompt() });\n  const total = message?.rolls?.[0]?.total;\n\n  // Replace saving throw value on original chat card's target\n  if (total != null) {\n    const actorUUID = elem.closest(\".target\").dataset.uuid;\n    await app.setFlag(\"ffd20\", \"targetDefense\", { [actorUUID]: { save: { [save]: total } } });\n  }\n};\n","import { FFD20 } from \"../../../config.mjs\";\nimport { RollFFD20 } from \"../../../dice/roll.mjs\";\nimport { fractionalToString } from \"@utils\";\nimport { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n/**\n * @this {import(\"@actor/actor-ffd20.mjs\").ActorFFD20}\n */\nexport function applyChanges() {\n  this.changeOverrides = {};\n  const changes = Array.from(this.changes);\n\n  const priority = getSortChangePriority.call(this);\n  const _sortChanges = function (a, b) {\n    const typeA = priority.types.indexOf(a.subTarget);\n    const typeB = priority.types.indexOf(b.subTarget);\n    const modA = priority.modifiers.indexOf(a.modifier);\n    const modB = priority.modifiers.indexOf(b.modifier);\n    let prioA = typeof a.priority === \"string\" ? parseInt(a.priority) : a.priority;\n    let prioB = typeof b.priority === \"string\" ? parseInt(b.priority) : b.priority;\n    prioA = (prioA || 0) + 1000;\n    prioB = (prioB || 0) + 1000;\n\n    return prioB - prioA || typeA - typeB || modA - modB;\n  };\n\n  // Organize changes by priority\n  changes.sort((a, b) => _sortChanges.call(this, a, b));\n\n  // Parse change flags\n  for (const i of this.changeItems) {\n    for (const [k, v] of Object.entries(i.system.changeFlags)) {\n      if (v === true) {\n        this.changeFlags[k] = true;\n\n        if (k === \"loseDexToAC\") {\n          for (const k2 of [\"normal\", \"touch\"]) {\n            getSourceInfo(this.sourceInfo, `system.attributes.ac.${k2}.total`).negative.push({\n              value: game.i18n.localize(\"FFD20.ChangeFlagLoseDexToAC\"),\n              name: i.name,\n              type: i.type,\n            });\n          }\n          getSourceInfo(this.sourceInfo, \"system.attributes.cmd.total\").negative.push({\n            value: game.i18n.localize(\"FFD20.ChangeFlagLoseDexToAC\"),\n            name: i.name,\n            type: i.type,\n          });\n        }\n      }\n    }\n  }\n  this.refreshDerivedData();\n\n  // Determine continuous changes\n  const continuousChanges = changes.filter((o) => o.continuous === true);\n\n  // Apply all changes\n  for (let a = 0; a < changes.length; a++) {\n    const change = changes[a];\n    let flats = getChangeFlat.call(this, change.subTarget, change.modifier);\n    if (!(flats instanceof Array)) flats = [flats];\n    for (const f of flats) {\n      if (!this.changeOverrides[f]) this.changeOverrides[f] = createOverride();\n    }\n\n    change.applyChange(this, flats, { applySourceInfo: false });\n\n    // Apply continuous changes\n    for (const cc of continuousChanges) {\n      if (cc === change) continue;\n\n      let flats = getChangeFlat.call(this, cc.subTarget, cc.modifier);\n      if (!(flats instanceof Array)) flats = [flats];\n      for (const f of flats) {\n        if (!this.changeOverrides[f]) this.changeOverrides[f] = createOverride();\n      }\n\n      cc.applyChange(this, flats, { applySourceInfo: false });\n    }\n\n    this.refreshDerivedData();\n  }\n\n  // Apply source info for changes\n  for (const change of changes) {\n    change.applySourceInfo(this);\n  }\n\n  resetSkills.call(this);\n}\n\nconst createOverride = function () {\n  const result = {\n    add: {},\n    set: {},\n  };\n\n  for (const k of Object.keys(CONFIG.FFD20.bonusModifiers)) {\n    result.add[k] = null;\n    result.set[k] = null;\n  }\n\n  return result;\n};\n\nconst getSortChangePriority = function () {\n  /** @type {[string, {sort: number}][]}*/\n  const skillTargets = this._skillTargets.map((target, index) => [target, { sort: 76000 + index * 10 }]);\n  const buffTargets = Object.entries(FFD20.buffTargets);\n  const types = [...skillTargets, ...buffTargets]\n    .sort(([, { sort: aSort }], [, { sort: bSort }]) => aSort - bSort)\n    .map(([target]) => target);\n\n  return {\n    types: types,\n    modifiers: [\n      \"untyped\",\n      \"untypedPerm\",\n      \"base\",\n      \"enh\",\n      \"dodge\",\n      \"inherent\",\n      \"deflection\",\n      \"morale\",\n      \"luck\",\n      \"sacred\",\n      \"insight\",\n      \"resist\",\n      \"profane\",\n      \"trait\",\n      \"racial\",\n      \"size\",\n      \"competence\",\n      \"circumstance\",\n      \"alchemical\",\n      \"penalty\",\n    ],\n  };\n};\n\nexport const getChangeFlat = function (changeTarget, changeType, curData = null) {\n  if (changeTarget == null) return null;\n\n  curData = curData ?? this.system;\n  /** @type {string[]} */\n  const result = [];\n\n  switch (changeTarget) {\n    case \"mhp\":\n      result.push(\"system.attributes.hp.max\");\n      break;\n    case \"wounds\":\n      result.push(\"system.attributes.wounds.max\");\n      break;\n    case \"vigor\":\n      result.push(\"system.attributes.vigor.max\");\n      break;\n    case \"mmp\":\n      result.push(\"system.attributes.mp.max\");\n      break;\n    case \"limitbreak\":\n      result.push(\"system.attributes.limitbreak.max\");\n      break;\n    case \"str\":\n    case \"dex\":\n    case \"con\":\n    case \"int\":\n    case \"wis\":\n    case \"cha\":\n      if (changeType === \"penalty\") {\n        result.push(`system.abilities.${changeTarget}.penalty`);\n        break;\n      }\n      if ([\"base\", \"untypedPerm\"].includes(changeType)) {\n        result.push(`system.abilities.${changeTarget}.total`, `system.abilities.${changeTarget}.base`);\n        break;\n      }\n      result.push(`system.abilities.${changeTarget}.total`);\n      break;\n    case \"strMod\":\n    case \"dexMod\":\n    case \"conMod\":\n    case \"intMod\":\n    case \"wisMod\":\n    case \"chaMod\":\n      result.push(`system.abilities.${changeTarget.slice(0, 3)}.mod`);\n      break;\n    case \"carryStr\":\n      result.push(\"system.details.carryCapacity.bonus.total\");\n      break;\n    case \"carryMult\":\n      result.push(\"system.details.carryCapacity.multiplier.total\");\n      break;\n    case \"ac\":\n      switch (changeType) {\n        case \"dodge\":\n          result.push(\n            \"system.attributes.ac.normal.total\",\n            \"system.attributes.ac.touch.total\",\n            \"system.attributes.cmd.total\"\n          );\n          break;\n        case \"deflection\":\n          result.push(\n            \"system.attributes.ac.normal.total\",\n            \"system.attributes.ac.touch.total\",\n            \"system.attributes.ac.flatFooted.total\",\n            \"system.attributes.cmd.total\",\n            \"system.attributes.cmd.flatFootedTotal\"\n          );\n          break;\n        case \"circumstance\":\n        case \"insight\":\n        case \"luck\":\n        case \"morale\":\n        case \"profane\":\n        case \"sacred\":\n          result.push(\n            \"system.attributes.ac.normal.total\",\n            \"system.attributes.ac.touch.total\",\n            \"system.attributes.ac.flatFooted.total\",\n            \"system.attributes.cmd.total\",\n            \"system.attributes.cmd.flatFootedTotal\"\n          );\n          break;\n        default:\n          result.push(\n            \"system.attributes.ac.normal.total\",\n            \"system.attributes.ac.touch.total\",\n            \"system.attributes.ac.flatFooted.total\"\n          );\n          break;\n      }\n      break;\n    case \"aac\": {\n      const targets = [\"system.ac.normal.total\"];\n      switch (changeType) {\n        case \"base\":\n          targets.push(\"system.ac.normal.base\");\n          break;\n        case \"enh\":\n          targets.push(\"system.ac.normal.enh\");\n          break;\n        default:\n          targets.push(\"system.ac.normal.misc\");\n          break;\n      }\n      result.push(...targets);\n      break;\n    }\n    case \"sac\": {\n      const targets = [\"system.ac.shield.total\"];\n      switch (changeType) {\n        case \"base\":\n          targets.push(\"system.ac.shield.base\");\n          break;\n        case \"enh\":\n          targets.push(\"system.ac.shield.enh\");\n          break;\n        default:\n          targets.push(\"system.ac.shield.misc\");\n          break;\n      }\n      result.push(...targets);\n      break;\n    }\n    case \"nac\": {\n      const targets = [\"system.ac.natural.total\"];\n      switch (changeType) {\n        case \"base\":\n          targets.push(\"system.ac.natural.base\");\n          break;\n        case \"enh\":\n          targets.push(\"system.ac.natural.enh\");\n          break;\n        default:\n          targets.push(\"system.ac.natural.misc\");\n          break;\n      }\n      result.push(...targets);\n      break;\n    }\n    case \"tac\":\n      result.push(\"system.attributes.ac.touch.total\");\n      break;\n    case \"ffac\":\n      result.push(\"system.attributes.ac.flatFooted.total\");\n      break;\n    case \"ffcmd\":\n      result.push(\"system.attributes.cmd.flatFootedTotal\");\n      break;\n    case \"bab\":\n      result.push(\"system.attributes.bab.total\");\n      break;\n    case \"~attackCore\":\n      result.push(\"system.attributes.attack.shared\");\n      break;\n    case \"attack\":\n      result.push(\"system.attributes.attack.general\");\n      break;\n    case \"mattack\":\n      result.push(\"system.attributes.attack.melee\");\n      break;\n    case \"rattack\":\n      result.push(\"system.attributes.attack.ranged\");\n      break;\n    case \"critConfirm\":\n      result.push(\"system.attributes.attack.critConfirm\");\n      break;\n    case \"allSavingThrows\":\n      result.push(\n        \"system.attributes.savingThrows.fort.total\",\n        \"system.attributes.savingThrows.ref.total\",\n        \"system.attributes.savingThrows.will.total\"\n      );\n      break;\n    case \"fort\":\n      result.push(\"system.attributes.savingThrows.fort.total\");\n      break;\n    case \"ref\":\n      result.push(\"system.attributes.savingThrows.ref.total\");\n      break;\n    case \"will\":\n      result.push(\"system.attributes.savingThrows.will.total\");\n      break;\n    case \"skills\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        result.push(`system.skills.${a}.changeBonus`);\n\n        if (skl.subSkills != null) {\n          for (const b of Object.keys(skl.subSkills)) {\n            result.push(`system.skills.${a}.subSkills.${b}.changeBonus`);\n          }\n        }\n      }\n      break;\n    case \"~skillMods\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        result.push(`system.skills.${a}.mod`);\n\n        if (skl.subSkills != null) {\n          for (const b of Object.keys(skl.subSkills)) {\n            result.push(`system.skills.${a}.subSkills.${b}.mod`);\n          }\n        }\n      }\n      break;\n    case \"strSkills\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        if (skl.ability === \"str\") result.push(`system.skills.${a}.changeBonus`);\n\n        if (skl.subSkills != null) {\n          for (const [b, subSkl] of Object.entries(skl.subSkills)) {\n            if (subSkl != null && subSkl.ability === \"str\")\n              result.push(`system.skills.${a}.subSkills.${b}.changeBonus`);\n          }\n        }\n      }\n      break;\n    case \"dexSkills\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        if (skl.ability === \"dex\") result.push(`system.skills.${a}.changeBonus`);\n\n        if (skl.subSkills != null) {\n          for (const [b, subSkl] of Object.entries(skl.subSkills)) {\n            if (subSkl != null && subSkl.ability === \"dex\")\n              result.push(`system.skills.${a}.subSkills.${b}.changeBonus`);\n          }\n        }\n      }\n      break;\n    case \"conSkills\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        if (skl.ability === \"con\") result.push(`system.skills.${a}.changeBonus`);\n\n        if (skl.subSkills != null) {\n          for (const [b, subSkl] of Object.entries(skl.subSkills)) {\n            if (subSkl != null && subSkl.ability === \"con\")\n              result.push(`system.skills.${a}.subSkills.${b}.changeBonus`);\n          }\n        }\n      }\n      break;\n    case \"intSkills\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        if (skl.ability === \"int\") result.push(`system.skills.${a}.changeBonus`);\n\n        if (skl.subSkills != null) {\n          for (const [b, subSkl] of Object.entries(skl.subSkills)) {\n            if (subSkl != null && subSkl.ability === \"int\")\n              result.push(`system.skills.${a}.subSkills.${b}.changeBonus`);\n          }\n        }\n      }\n      break;\n    case \"wisSkills\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        if (skl.ability === \"wis\") result.push(`system.skills.${a}.changeBonus`);\n\n        if (skl.subSkills != null) {\n          for (const [b, subSkl] of Object.entries(skl.subSkills)) {\n            if (subSkl != null && subSkl.ability === \"wis\")\n              result.push(`system.skills.${a}.subSkills.${b}.changeBonus`);\n          }\n        }\n      }\n      break;\n    case \"chaSkills\":\n      for (const [a, skl] of Object.entries(curData.skills)) {\n        if (skl == null) continue;\n        if (skl.ability === \"cha\") result.push(`system.skills.${a}.changeBonus`);\n\n        if (skl.subSkills != null) {\n          for (const [b, subSkl] of Object.entries(skl.subSkills)) {\n            if (subSkl != null && subSkl.ability === \"cha\")\n              result.push(`system.skills.${a}.subSkills.${b}.changeBonus`);\n          }\n        }\n      }\n      break;\n    case \"allChecks\":\n      result.push(\n        \"system.abilities.str.checkMod\",\n        \"system.abilities.dex.checkMod\",\n        \"system.abilities.con.checkMod\",\n        \"system.abilities.int.checkMod\",\n        \"system.abilities.wis.checkMod\",\n        \"system.abilities.cha.checkMod\",\n        ...(this.system.attributes.init.ability ? [\"system.attributes.init.total\"] : [])\n      );\n      break;\n    case \"strChecks\":\n      result.push(\n        \"system.abilities.str.checkMod\",\n        ...(this.system.attributes.init.ability === \"str\" ? [\"system.attributes.init.total\"] : [])\n      );\n      break;\n    case \"dexChecks\":\n      result.push(\n        \"system.abilities.dex.checkMod\",\n        ...(this.system.attributes.init.ability === \"dex\" ? [\"system.attributes.init.total\"] : [])\n      );\n      break;\n    case \"conChecks\":\n      result.push(\n        \"system.abilities.con.checkMod\",\n        ...(this.system.attributes.init.ability === \"con\" ? [\"system.attributes.init.total\"] : [])\n      );\n      break;\n    case \"intChecks\":\n      result.push(\n        \"system.abilities.int.checkMod\",\n        ...(this.system.attributes.init.ability === \"int\" ? [\"system.attributes.init.total\"] : [])\n      );\n      break;\n    case \"wisChecks\":\n      result.push(\n        \"system.abilities.wis.checkMod\",\n        ...(this.system.attributes.init.ability === \"wis\" ? [\"system.attributes.init.total\"] : [])\n      );\n      break;\n    case \"chaChecks\":\n      result.push(\n        \"system.abilities.cha.checkMod\",\n        ...(this.system.attributes.init.ability === \"cha\" ? [\"system.attributes.init.total\"] : [])\n      );\n      break;\n    case \"allSpeeds\":\n      for (const speedKey of Object.keys(curData.attributes.speed)) {\n        const base = curData.attributes.speed[speedKey]?.base;\n        if (base !== undefined) result.push(`system.attributes.speed.${speedKey}.total`);\n      }\n      break;\n    case \"landSpeed\":\n      if (changeType === \"base\") return [\"system.attributes.speed.land.total\"];\n      result.push(\"system.attributes.speed.land.add\", \"system.attributes.speed.land.total\");\n      break;\n    case \"climbSpeed\":\n      if (changeType === \"base\") {\n        result.push(\"system.attributes.speed.climb.total\");\n        break;\n      }\n      result.push(\"system.attributes.speed.climb.add\", \"system.attributes.speed.climb.total\");\n      break;\n    case \"swimSpeed\":\n      if (changeType === \"base\") {\n        result.push(\"system.attributes.speed.swim.total\");\n        break;\n      }\n      result.push(\"system.attributes.speed.swim.add\", \"system.attributes.speed.swim.total\");\n      break;\n    case \"burrowSpeed\":\n      if (changeType === \"base\") {\n        result.push(\"system.attributes.speed.burrow.total\");\n        break;\n      }\n      result.push(\"system.attributes.speed.burrow.add\", \"system.attributes.speed.burrow.total\");\n      break;\n    case \"flySpeed\":\n      if (changeType === \"base\") {\n        result.push(\"system.attributes.speed.fly.total\");\n        break;\n      }\n      result.push(\"system.attributes.speed.fly.add\", \"system.attributes.speed.fly.total\");\n      break;\n    case \"cmb\":\n      result.push(\"system.attributes.cmb.bonus\");\n      break;\n    case \"cmd\":\n      if (changeType === \"dodge\") {\n        result.push(\"system.attributes.cmd.total\");\n        break;\n      }\n      result.push(\"system.attributes.cmd.total\", \"system.attributes.cmd.flatFootedTotal\");\n      break;\n    case \"init\":\n      result.push(\"system.attributes.init.total\");\n      break;\n    case \"acpA\":\n      result.push(\"system.attributes.acp.armorBonus\");\n      break;\n    case \"acpS\":\n      result.push(\"system.attributes.acp.shieldBonus\");\n      break;\n    case \"mDexA\":\n      result.push(\"system.attributes.mDex.armorBonus\");\n      break;\n    case \"mDexS\":\n      result.push(\"system.attributes.mDex.shieldBonus\");\n      break;\n    case \"spellResist\":\n      result.push(\"system.attributes.sr.total\");\n      break;\n    case \"damage\":\n      result.push(\"system.attributes.damage.general\");\n      break;\n    case \"wdamage\":\n      result.push(\"system.attributes.damage.weapon\");\n      break;\n    case \"sdamage\":\n      result.push(\"system.attributes.damage.spell\");\n      break;\n    case \"bonusFeats\":\n      result.push(\"system.details.feats.bonus\");\n      break;\n    case \"bonusSkillRanks\":\n      result.push(\"system.details.skills.bonus\");\n      break;\n    case \"concentration\":\n      result.push(\n        \"system.attributes.spells.spellbooks.primary.concentration.total\",\n        \"system.attributes.spells.spellbooks.secondary.concentration.total\",\n        \"system.attributes.spells.spellbooks.tertiary.concentration.total\",\n        \"system.attributes.spells.spellbooks.Quaternary.concentration.total\",\n        \"system.attributes.spells.spellbooks.spelllike.concentration.total\"\n      );\n      break;\n    case \"cl\":\n      result.push(\n        \"system.attributes.spells.spellbooks.primary.cl.total\",\n        \"system.attributes.spells.spellbooks.secondary.cl.total\",\n        \"system.attributes.spells.spellbooks.tertiary.cl.total\",\n        \"system.attributes.spells.spellbooks.Quaternary.cl.total\",\n        \"system.attributes.spells.spellbooks.spelllike.cl.total\"\n      );\n      break;\n  }\n\n  if (changeTarget.match(/^skill\\.([a-zA-Z0-9]+)$/)) {\n    const sklKey = RegExp.$1;\n    if (curData.skills[sklKey] != null) {\n      result.push(`system.skills.${sklKey}.changeBonus`);\n    }\n  } else if (changeTarget.match(/^skill\\.([a-zA-Z0-9]+)\\.subSkills\\.([a-zA-Z0-9_]+)$/)) {\n    const sklKey = RegExp.$1;\n    const subSklKey = RegExp.$2;\n    if (curData.skills[sklKey]?.subSkills?.[subSklKey] != null) {\n      result.push(`system.skills.${sklKey}.subSkills.${subSklKey}.changeBonus`);\n    }\n  }\n\n  // Call hooks to enable modules to add or adjust the result array\n  callOldNamespaceHookAll(\"ffd20.getChangeFlat\", \"ffd20GetChangeFlat\", changeTarget, changeType, { keys: result });\n  Hooks.callAll(\"ffd20GetChangeFlat\", changeTarget, changeType, result, curData);\n\n  // Return results directly when deprecation is removed\n  return result.map((key) => {\n    const fixedKey = key.replace(\"data.\", \"system.\");\n    if (key.startsWith(\"data.\")) {\n      foundry.utils.logCompatibilityWarning(\n        `Change targets pointing towards \"data.\" (${key}) are deprecated. Use \"system.\" (${fixedKey}) instead.`,\n        { since: \"FFD20 0.82.0\", until: \"FFD20 0.83.0\" }\n      );\n      return fixedKey;\n    }\n    return key;\n  });\n};\n\nconst getBabTotal = function (d) {\n  return d.attributes.bab.total;\n};\n\nconst getNegativeEnergyDrain = function (d) {\n  return -d.attributes.energyDrain;\n};\n\nconst getAbilityMod = function (ability) {\n  return function (d) {\n    return d.abilities[ability]?.mod ?? 0;\n  };\n};\n\nexport const addDefaultChanges = function (changes) {\n  const actorData = this.system;\n  // Call hook\n  const tempChanges = [];\n  callOldNamespaceHookAll(\"ffd20.addDefaultChanges\", \"ffd20AddDefaultChanges\", this, tempChanges);\n  Hooks.callAll(\"ffd20AddDefaultChanges\", this, tempChanges);\n  changes.push(...tempChanges.filter((c) => c instanceof ffd20.components.ItemChange));\n\n  // Class hit points\n  const classes = this.items\n    .filter((o) => o.type === \"class\" && ![\"racial\"].includes(o.classType))\n    .sort((a, b) => {\n      return a.sort - b.sort;\n    });\n  const racialHD = this.items\n    .filter((o) => o.type === \"class\" && o.classType === \"racial\")\n    .sort((a, b) => {\n      return a.sort - b.sort;\n    });\n\n  const healthConfig = game.settings.get(\"ffd20\", \"healthConfig\");\n  const cls_options = this.type === \"character\" ? healthConfig.hitdice.PC : healthConfig.hitdice.NPC;\n  const race_options = healthConfig.hitdice.Racial;\n  const round = { up: Math.ceil, nearest: Math.round, down: Math.floor }[healthConfig.rounding];\n  const continuous = { discrete: false, continuous: true }[healthConfig.continuity];\n\n  const push_health = (value, source) => {\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: value,\n        target: \"misc\",\n        subTarget: \"mhp\",\n        modifier: \"untypedPerm\",\n        flavor: source.name,\n      })\n    );\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: value,\n        target: \"misc\",\n        subTarget: \"vigor\",\n        modifier: \"untypedPerm\",\n        flavor: source.name,\n      })\n    );\n  };\n  const manual_health = (health_source) => {\n    let health =\n      health_source.system.hp + (health_source.system.classType === \"base\") * health_source.system.fc.hp.value;\n\n    if (!continuous) health = round(health);\n    push_health(health, health_source);\n  };\n  const auto_health = (health_source, options, maximized = 0) => {\n    if (health_source.system.hd === 0) return;\n\n    let die_health = 1 + (health_source.system.hd - 1) * options.rate;\n    if (!continuous) die_health = round(die_health);\n\n    const maxed_health = Math.min(health_source.system.level, maximized) * health_source.system.hd;\n    const level_health = Math.max(0, health_source.system.level - maximized) * die_health;\n    const favor_health = (health_source.system.classType === \"base\") * health_source.system.fc.hp.value;\n    const health = maxed_health + level_health + favor_health;\n\n    push_health(health, health_source);\n  };\n  const compute_health = (health_sources, options) => {\n    // Compute and push health, tracking the remaining maximized levels.\n    if (options.auto) {\n      let maximized = options.maximized;\n      for (const hd of health_sources) {\n        auto_health(hd, options, maximized);\n        maximized = Math.max(0, maximized - hd.system.level);\n      }\n    } else health_sources.forEach((race) => manual_health(race));\n  };\n\n  compute_health(racialHD, race_options);\n  compute_health(classes, cls_options);\n\n  // Class mana points, call class and race info from above\n\n  const push_mana = (value, source) => {\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: value.toString(),\n        target: \"misc\",\n        subTarget: \"mmp\",\n        modifier: \"untypedPerm\",\n        flavor: source.name,\n      })\n    );\n  };\n\n  const manual_mana = (mana_source) => {\n    const mana = mana_source.system.mp === null ? 0 : mana_source.system.mp;\n    getSourceInfo(this.sourceInfo, \"system.attributes.mp.max\").positive.push({\n      value: mana_source.system.mp,\n      name: game.i18n.format(\"FFD20.SourceInfoSkillRank_ClassBase\", { className: mana_source.name }),\n    });\n    push_mana(mana, mana_source);\n  };\n\n  const auto_mana = (mana_source) => {\n    if (mana_source.system.classBaseMPTypes === \"noncaster\") return;\n    if (mana_source.system.level === 0) return;\n    // figure out how much mp comes from the class\n    let mult = 1;\n    if (mana_source.system.classBaseMPauto === \"half\") mult = 0.5;\n    const manaChart = CONFIG.FFD20.classMPlevels[mana_source.system.classBaseMPTypes];\n    const level_mana = Math.floor(manaChart[mana_source.system.level - 1] * mult);\n    push_mana(level_mana, mana_source);\n  };\n\n  /* Compute and push mana, tracking the remaining maximized levels.\n   * for each class, check if it is calulating mp or defaulting to manually entered value\n   * step 1 - gather all classes\n   * step 2 - check for each if it is auto or manual\n   * step 3 - pass to correct function\n   * step 4 - if manual just add mp to pool\n   * step 5 - for auto follow substeps\n   * the following is for each class passed to it\n   * step 5a - condence relevant variables\n   *   MP type: which mp chart does it look at - mana_source.system. classBaseMPTypes\n   *   Max spell lvl: which spell prog does it look at - mana_source.system.classBaseMPTypes\n   *   level: level of the class - mana_source.system.level\n   *   casting stat: what stat(s) are used for it - mana_source.system.classCastingStat\n   * pass result\n   * else\n   * pass manual mp value\n   * total results\n   */\n\n  // TODO adjust for class autos\n  // check each for false or null, do first manual option, if true move to auto\n\n  const compute_mana = (mana_sources) => {\n    mana_sources.forEach((mpsource) => {\n      if (mpsource.system.classBaseMPauto == \"no\" || mpsource.system.classBaseMPauto == null) {\n        manual_mana(mpsource);\n      } else {\n        auto_mana(mpsource);\n      }\n    });\n  };\n\n  compute_mana(racialHD);\n  compute_mana(classes);\n\n  // Add class data to saving throws\n  const allClasses = [...classes, ...racialHD];\n  const useFractional = game.settings.get(\"ffd20\", \"useFractionalBaseBonuses\") === true;\n  for (const a of Object.keys(actorData.attributes.savingThrows)) {\n    let hasGoodSave = false;\n    actorData.attributes.savingThrows[a].total = actorData.attributes.savingThrows[a]?.base ?? 0;\n\n    const total = allClasses.reduce((cur, cls) => {\n      const base = cls.system.savingThrows[a].base;\n\n      if (!useFractional) {\n        // Add per class change\n        changes.push(\n          new ffd20.components.ItemChange({\n            formula: base,\n            target: \"savingThrows\",\n            subTarget: a,\n            modifier: \"untypedPerm\",\n            flavor: cls.name,\n          })\n        );\n      } else {\n        if (cls.system.savingThrows[a].good === true) hasGoodSave = true;\n      }\n      return cur + base;\n    }, 0);\n\n    if (useFractional) {\n      // Add shared change with fractional\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: Math.floor(total),\n          target: \"savingThrows\",\n          subTarget: a,\n          modifier: \"untypedPerm\",\n          flavor: game.i18n.localize(\"FFD20.Base\"),\n        })\n      );\n    }\n\n    // Fractional bonus +2 when one class has good save\n    if (useFractional && hasGoodSave) {\n      const goodSaveFormula = CONFIG.FFD20.classFractionalSavingThrowFormulas.goodSaveBonus;\n      const total = RollFFD20.safeRoll(goodSaveFormula).total;\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: total,\n          target: \"savingThrows\",\n          subTarget: a,\n          modifier: \"untypedPerm\",\n          flavor: game.i18n.localize(\"FFD20.SavingThrowGoodFractionalBonus\"),\n        })\n      );\n    }\n  }\n\n  // Add Constitution to HP\n  const hpAbility = actorData.attributes.hpAbility;\n  if (hpAbility) {\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: (d) => d.abilities[hpAbility].mod * d.attributes.hd.total,\n        operator: \"function\",\n        target: \"misc\",\n        subTarget: \"mhp\",\n        modifier: \"base\",\n        flavor: CONFIG.FFD20.abilities[hpAbility],\n      })\n    );\n\n    if (!getProperty(this, \"system.attributes.wounds.base\")) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: (d) => d.abilities[hpAbility].total * 2 + d.abilities[hpAbility].drain,\n          operator: \"function\",\n          target: \"misc\",\n          subTarget: \"wounds\",\n          modifier: \"base\",\n          flavor: CONFIG.FFD20.abilities[hpAbility],\n        })\n      );\n    }\n  }\n\n  // add bonus mp and does it after all stat mods\n  classes.forEach((mp_source) => {\n    let mpAbility = mp_source.system.classCastingStat;\n    if (mpAbility == null) mpAbility = \"noncaster\";\n    if (mpAbility === \"noncaster\") return;\n    if (mp_source.system.level === 0) return;\n    const spellMath = CONFIG.FFD20.ClassSpellLvlProgression[mp_source.system.classBaseMPTypes];\n    const currentSpellLvl = Math.floor(RollFFD20.safeRoll(spellMath, { level: mp_source.system.level }).total);\n    const mpProg = CONFIG.FFD20.classMPStatsBonus[currentSpellLvl];\n    if (mpAbility !== \"\") {\n      const arrayStr = JSON.stringify(mpProg);\n      if (mpAbility === \"intAndWis\") {\n        changes.push(\n          new ffd20.components.ItemChange({\n            formula: `${arrayStr}[[@abilities.int.mod]] + ${arrayStr}[[@abilities.wis.mod]]`,\n            target: \"misc\",\n            subTarget: \"mmp\",\n            modifier: \"base\",\n          })\n        );\n      } else {\n        changes.push(\n          new ffd20.components.ItemChange({\n            formula: `${arrayStr}[[@abilities.${mpAbility}.mod]]`,\n            target: \"misc\",\n            subTarget: \"mmp\",\n            modifier: \"base\",\n          })\n        );\n      }\n    }\n  });\n\n  // Add movement speed(s)\n  for (const [k, s] of Object.entries(actorData.attributes.speed)) {\n    let base = s.base;\n    if (!base) base = 0;\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: base,\n        target: \"speed\",\n        subTarget: `${k}Speed`,\n        modifier: \"base\",\n        operator: \"set\",\n        priority: 1001,\n        flavor: game.i18n.localize(\"FFD20.Base\"),\n      })\n    );\n  }\n\n  // Add base attack modifiers shared by all attacks\n  {\n    // BAB to attack\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: getBabTotal,\n        operator: \"function\",\n        target: \"attack\",\n        subTarget: \"~attackCore\",\n        modifier: \"untypedPerm\",\n        flavor: game.i18n.localize(\"FFD20.BAB\"),\n      })\n    );\n    // Energy drain to attack\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: getNegativeEnergyDrain,\n        operator: \"function\",\n        target: \"attack\",\n        subTarget: \"~attackCore\",\n        modifier: \"untypedPerm\",\n        flavor: game.i18n.localize(\"FFD20.CondTypeEnergyDrain\"),\n      })\n    );\n    // ACP to attack\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: (d) => -d.attributes.acp.attackPenalty,\n        operator: \"function\",\n        target: \"attack\",\n        subTarget: \"~attackCore\",\n        modifier: \"penalty\",\n        flavor: game.i18n.localize(\"FFD20.ArmorCheckPenalty\"),\n      })\n    );\n  }\n\n  // Add variables to CMD\n  {\n    // BAB to CMD\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: getBabTotal,\n        operator: \"function\",\n        target: \"misc\",\n        subTarget: \"cmd\",\n        modifier: \"untypedPerm\",\n        flavor: game.i18n.localize(\"FFD20.BAB\"),\n      })\n    );\n    // Strength or substitute to CMD\n    const strAbl = actorData.attributes.cmd.strAbility;\n    if (strAbl in CONFIG.FFD20.abilities) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: `@abilities.${strAbl}.mod`,\n          target: \"misc\",\n          subTarget: \"cmd\",\n          modifier: \"untypedPerm\",\n          flavor: CONFIG.FFD20.abilities[strAbl],\n        })\n      );\n    }\n    // Energy Drain to CMD\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: getNegativeEnergyDrain,\n        operator: \"function\",\n        target: \"misc\",\n        subTarget: \"cmd\",\n        modifier: \"untypedPerm\",\n        flavor: game.i18n.localize(\"FFD20.CondTypeEnergyDrain\"),\n      })\n    );\n  }\n\n  // Add Dexterity Modifier to Initiative\n  {\n    const abl = actorData.attributes.init.ability;\n    if (abl) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: getAbilityMod(abl),\n          operator: \"function\",\n          target: \"misc\",\n          subTarget: \"init\",\n          modifier: \"untypedPerm\",\n          priority: -100,\n          flavor: CONFIG.FFD20.abilities[abl],\n        })\n      );\n    }\n\n    // Add ACP penalty\n    if ([\"str\", \"dex\"].includes(abl)) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: (d) => -d.attributes.acp.attackPenalty,\n          operator: \"function\",\n          target: \"misc\",\n          subTarget: \"init\",\n          modifier: \"penalty\",\n          priority: -100,\n          flavor: game.i18n.localize(\"FFD20.ArmorCheckPenalty\"),\n        })\n      );\n    }\n  }\n\n  // Add Ability modifiers and Energy Drain to saving throws\n  {\n    // Ability Mod to Fortitude\n    let abl = actorData.attributes.savingThrows.fort.ability;\n    if (abl) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: getAbilityMod(abl),\n          operator: \"function\",\n          target: \"savingThrows\",\n          subTarget: \"fort\",\n          modifier: \"untypedPerm\",\n          flavor: CONFIG.FFD20.abilities[abl],\n        })\n      );\n    }\n    // Ability Mod to Reflex\n    abl = actorData.attributes.savingThrows.ref.ability;\n    if (abl) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: getAbilityMod(abl),\n          operator: \"function\",\n          target: \"savingThrows\",\n          subTarget: \"ref\",\n          modifier: \"untypedPerm\",\n          flavor: CONFIG.FFD20.abilities[abl],\n        })\n      );\n    }\n    // Ability Mod to Will\n    abl = actorData.attributes.savingThrows.will.ability;\n    if (abl) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: getAbilityMod(abl),\n          operator: \"function\",\n          target: \"savingThrows\",\n          subTarget: \"will\",\n          modifier: \"untypedPerm\",\n          flavor: CONFIG.FFD20.abilities[abl],\n        })\n      );\n    }\n    // Energy Drain\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: getNegativeEnergyDrain,\n        operator: \"function\",\n        target: \"savingThrows\",\n        subTarget: \"allSavingThrows\",\n        modifier: \"penalty\",\n        flavor: game.i18n.localize(\"FFD20.CondTypeEnergyDrain\"),\n      })\n    );\n  }\n  // Spell Resistance\n  {\n    const sr = actorData.attributes.sr.formula || 0;\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: sr,\n        target: \"misc\",\n        subTarget: \"spellResist\",\n        modifier: \"base\",\n        priority: 1000,\n        flavor: game.i18n.localize(\"FFD20.Base\"),\n      })\n    );\n  }\n  {\n    // Carry capacity strength bonus\n    const cStr = actorData.details.carryCapacity.bonus.user || 0;\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: cStr,\n        target: \"misc\",\n        subTarget: \"carryStr\",\n        modifier: \"untyped\",\n        priority: 1000,\n        flavor: game.i18n.localize(\"FFD20.Custom\"),\n      })\n    );\n    // Carry capacity multiplier\n    const cMultBase = actorData.details.carryCapacity.multiplier.base ?? 1;\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: cMultBase,\n        target: \"misc\",\n        subTarget: \"carryMult\",\n        modifier: \"base\",\n        priority: 1000,\n        flavor: game.i18n.localize(\"FFD20.Base\"),\n      })\n    );\n    const cMult = actorData.details.carryCapacity.multiplier.user || 0;\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: cMult,\n        target: \"misc\",\n        subTarget: \"carryMult\",\n        modifier: \"untyped\",\n        priority: 1000,\n        flavor: game.i18n.localize(\"FFD20.Custom\"),\n      })\n    );\n  }\n  // Natural armor\n  {\n    const ac = actorData.attributes.naturalAC || 0;\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: ac,\n        subTarget: \"nac\",\n        modifier: \"base\",\n        flavor: game.i18n.localize(\"FFD20.EquipTypeNatural\"),\n      })\n    );\n  }\n  // Add armor bonuses from equipment\n  this.items\n    .filter((obj) => {\n      return obj.type === \"equipment\" && obj.system.equipped;\n    })\n    .forEach((item) => {\n      let armorTarget = \"aac\";\n      if (item.system.equipmentType === \"shield\") armorTarget = \"sac\";\n      // Push base armor\n      if (item.system.armor.value || item.system.armor.enh) {\n        let ac = item.system.armor.value + item.system.armor.enh;\n        if (item.system.broken) ac = Math.floor(ac / 2);\n        changes.push(\n          new ffd20.components.ItemChange(\n            {\n              formula: item.system.armor.value,\n              subTarget: armorTarget,\n              modifier: \"base\",\n            },\n            item\n          )\n        );\n        changes.push(\n          new ffd20.components.ItemChange(\n            {\n              formula: item.system.armor.enh,\n              subTarget: armorTarget,\n              modifier: \"enhancement\",\n            },\n            item\n          )\n        );\n      }\n    });\n\n  // Add fly bonuses or penalties based on maneuverability\n  {\n    const flyKey = actorData.attributes.speed.fly.maneuverability;\n    let flyValue = 0;\n    if (flyKey != null) flyValue = CONFIG.FFD20.flyManeuverabilityValues[flyKey];\n    if (flyValue !== 0) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: flyValue,\n          target: \"skill\",\n          subTarget: \"skill.fly\",\n          modifier: \"racial\",\n          flavor: game.i18n.localize(\"FFD20.FlyManeuverability\"),\n        })\n      );\n    }\n  }\n  // Add swim and climb skill bonuses based on having speeds for them\n  {\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: (d) => (d.attributes.speed.climb.total > 0 ? 8 : 0),\n        operator: \"function\",\n        target: \"skill\",\n        subTarget: \"skill.clm\",\n        modifier: \"racial\",\n        priority: -1,\n        flavor: game.i18n.localize(\"FFD20.SpeedClimb\"),\n      })\n    );\n\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: (d) => (d.attributes.speed.swim.total > 0 ? 8 : 0),\n        operator: \"function\",\n        target: \"skill\",\n        subTarget: \"skill.swm\",\n        modifier: \"racial\",\n        priority: -1,\n        flavor: game.i18n.localize(\"FFD20.SpeedSwim\"),\n      })\n    );\n  }\n\n  // Add energy drain to skills\n  {\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: getNegativeEnergyDrain,\n        operator: \"function\",\n        target: \"skills\",\n        subTarget: \"skills\",\n        modifier: \"untypedPerm\",\n        flavor: game.i18n.localize(\"FFD20.CondTypeEnergyDrain\"),\n      })\n    );\n  }\n\n  // Add size bonuses to various attributes\n  const sizeKey = actorData.traits.size;\n  if (sizeKey !== \"med\") {\n    // AC\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: CONFIG.FFD20.sizeMods[sizeKey],\n        target: \"ac\",\n        subTarget: \"ac\",\n        modifier: \"size\",\n        flavor: game.i18n.localize(\"FFD20.BonusModifierSize\"),\n      })\n    );\n    // Stealth skill\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: CONFIG.FFD20.sizeStealthMods[sizeKey],\n        target: \"skill\",\n        subTarget: \"skill.ste\",\n        modifier: \"size\",\n        flavor: game.i18n.localize(\"FFD20.BonusModifierSize\"),\n      })\n    );\n    // Fly skill\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: CONFIG.FFD20.sizeFlyMods[sizeKey],\n        target: \"skill\",\n        subTarget: \"skill.fly\",\n        modifier: \"size\",\n        flavor: game.i18n.localize(\"FFD20.BonusModifierSize\"),\n      })\n    );\n    // CMD\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: CONFIG.FFD20.sizeSpecialMods[sizeKey],\n        target: \"misc\",\n        subTarget: \"cmd\",\n        modifier: \"size\",\n        flavor: game.i18n.localize(\"FFD20.BonusModifierSize\"),\n      })\n    );\n  }\n\n  // Add conditions\n  for (const [con, v] of Object.entries(actorData.attributes.conditions || {})) {\n    if (!v) continue;\n\n    const mechanic = CONFIG.FFD20.conditionMechanics[con];\n    if (!mechanic) continue;\n\n    // Add changes\n    for (const change of mechanic.changes ?? []) {\n      // Alter change data\n      const changeData = deepClone(change);\n      changeData.flavor = CONFIG.FFD20.conditions[con];\n\n      // Create change object\n      const changeObj = new ffd20.components.ItemChange(changeData);\n      changes.push(changeObj);\n    }\n\n    // Set flags\n    for (const flag of mechanic.flags ?? []) {\n      this.changeFlags[flag] = true;\n    }\n  }\n\n  // Apply level drain to hit points\n  if (!Number.isNaN(actorData.attributes.energyDrain) && actorData.attributes.energyDrain > 0) {\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: (d) => -d.attributes.energyDrain * 5,\n        operator: \"function\",\n        subTarget: \"mhp\",\n        modifier: \"untyped\",\n        priority: -750,\n        flavor: game.i18n.localize(\"FFD20.CondTypeEnergyDrain\"),\n      })\n    );\n\n    changes.push(\n      new ffd20.components.ItemChange({\n        formula: (d) => -d.attributes.energyDrain * 5,\n        operator: \"function\",\n        subTarget: \"vigor\",\n        modifier: \"untyped\",\n        priority: -750,\n        flavor: game.i18n.localize(\"FFD20.CondTypeEnergyDrain\"),\n      })\n    );\n  }\n};\n\nconst resetSkills = function () {\n  const actorData = this.system;\n  const skills = actorData.skills;\n\n  for (const [sklKey, skl] of Object.entries(skills)) {\n    if (!skl) continue;\n\n    let acpPenalty = skl.acp ? actorData.attributes.acp.total : 0;\n    let ablMod = actorData.abilities[skl.ability]?.mod || 0;\n    let specificSkillBonus = skl.changeBonus || 0;\n\n    // Parse main skills\n    let sklValue = skl.rank + (skl.cs && skl.rank > 0 ? 3 : 0) + ablMod + specificSkillBonus - acpPenalty;\n    skl.mod = sklValue;\n\n    // Parse sub-skills\n    for (const [subSklKey, subSkl] of Object.entries(skl.subSkills || {})) {\n      if (!subSkl) continue;\n      const subSkill = skl.subSkills?.[subSklKey];\n      if (!subSkill) continue;\n\n      acpPenalty = subSkl.acp ? actorData.attributes.acp.total : 0;\n      ablMod = actorData.abilities[subSkl.ability]?.mod || 0;\n      specificSkillBonus = subSkl.changeBonus || 0;\n      sklValue = subSkl.rank + (subSkl.cs && subSkl.rank > 0 ? 3 : 0) + ablMod + specificSkillBonus - acpPenalty;\n      subSkill.mod = sklValue;\n    }\n  }\n};\n\nexport const getSourceInfo = function (obj, key) {\n  if (!obj[key]) {\n    obj[key] = { negative: [], positive: [] };\n  }\n  return obj[key];\n};\n\nexport const setSourceInfoByName = function (obj, key, name, value, positive = true) {\n  const target = positive ? \"positive\" : \"negative\";\n  const sourceInfo = getSourceInfo(obj, key)[target];\n  const data = sourceInfo.find((o) => o.name === name);\n  if (data) data.value = value;\n  else {\n    sourceInfo.push({\n      name: name,\n      value: value,\n    });\n  }\n};\n\n/**\n * @param {ItemChange[]} changes - An array containing all changes to check. Must be called after they received a value (by ItemChange.applyChange)\n * @param {object} [options]\n * @param {boolean} [options.ignoreTarget] - Whether to only check for modifiers such as enhancement, insight (true) or whether the target (AC, weapon damage) is also important (false)\n * @returns {ItemChange[]} - A list of processed changes, excluding the lower-valued ones inserted (if they don't stack)\n */\nexport const getHighestChanges = function (changes, options = { ignoreTarget: false }) {\n  const highestTemplate = {\n    value: 0,\n    ids: [],\n    highestID: null,\n  };\n  const highest = Object.keys(CONFIG.FFD20.bonusModifiers).reduce((cur, k) => {\n    if (options.ignoreTarget) cur[k] = duplicate(highestTemplate);\n    else cur[k] = {};\n    return cur;\n  }, {});\n\n  for (const c of changes) {\n    let h;\n    if (options.ignoreTarget) h = highest[c.modifier];\n    else h = highest[c.modifier][c.subTarget];\n\n    h.ids.push(c._id);\n    if (h.value < c.value || !h.highestID) {\n      h.value = c.value;\n      h.highestID = c._id;\n    }\n  }\n\n  {\n    let mod, h;\n    const filterFunc = function (c) {\n      if (h.highestID === c._id) return true;\n      if (CONFIG.FFD20.stackingBonusModifiers.indexOf(mod) === -1 && h.ids.includes(c._id)) return false;\n      return true;\n    };\n\n    for (mod of Object.keys(highest)) {\n      if (options.ignoreTarget) {\n        h = highest[mod];\n        changes = changes.filter(filterFunc);\n      } else {\n        for (const subTarget of Object.keys(highest[mod])) {\n          h = highest[mod][subTarget];\n          changes = changes.filter(filterFunc);\n        }\n      }\n    }\n  }\n\n  return changes;\n};\n","import { getChangeFlat, getSourceInfo } from \"../documents/actor/utils/apply-changes.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\nimport { getAbilityModifier } from \"@utils\";\n\nexport class ItemChange {\n  constructor(data, parent) {\n    this.data = mergeObject(this.constructor.defaultData, data);\n    this.parent = parent;\n    this.updateTime = new Date();\n  }\n\n  /**\n   * Creates a change.\n   *\n   * @param {object[]} data - Data to initialize the change(s) with.\n   * @param {object} context - An object containing context information.\n   * @param {ItemFFD20} [context.parent] - The parent entity to create the change within.\n   * @returns The resulting changes, or an empty array if nothing was created.\n   */\n  static async create(data, context) {\n    const { parent } = context;\n\n    if (parent instanceof ffd20.documents.item.ItemFFD20) {\n      // Prepare data\n      data = data.map((dataObj) => mergeObject(this.defaultData, dataObj));\n      const newChangeData = deepClone(parent.system.changes || []);\n      newChangeData.push(...data);\n\n      // Update parent\n      await parent.update({ \"system.changes\": newChangeData });\n\n      // Return results\n      return data.map((o) => parent.changes.get(o._id));\n    }\n\n    return [];\n  }\n\n  static get defaultData() {\n    return {\n      _id: randomID(8),\n      formula: \"\",\n      operator: \"add\",\n      subTarget: \"\",\n      modifier: \"\",\n      priority: 0,\n      value: 0,\n      flavor: undefined,\n    };\n  }\n\n  get id() {\n    return this.data._id;\n  }\n  get _id() {\n    return this.data._id;\n  }\n  get formula() {\n    return this.data.formula;\n  }\n  get operator() {\n    return this.data.operator;\n  }\n  get subTarget() {\n    return this.data.subTarget;\n  }\n  get modifier() {\n    return this.data.modifier;\n  }\n  get priority() {\n    return this.data.priority;\n  }\n  get value() {\n    return this.data.value;\n  }\n  get flavor() {\n    return this.data.flavor ?? this.parent?.name.replace(/\\[|\\]/g, \"\") ?? this.modifier;\n  }\n  get continuous() {\n    return this.data.continuous;\n  }\n  get isDeferred() {\n    return [\"damage\", \"wdamage\", \"sdamage\"].includes(this.subTarget);\n  }\n\n  get source() {\n    return this.data.source;\n  }\n  getSourceInfoTargets(actor) {\n    switch (this.subTarget) {\n      case \"aac\":\n      case \"sac\":\n      case \"nac\":\n        return [\"system.attributes.ac.normal.total\", \"system.attributes.ac.flatFooted.total\"];\n    }\n\n    // Return default targets\n    let flats = getChangeFlat.call(actor, this.subTarget, this.modifier);\n    if (!(flats instanceof Array)) flats = [flats];\n    return flats;\n  }\n\n  prepareData() {}\n\n  preUpdate(data) {\n    // Make sure sub-target is valid\n    {\n      if (data[\"target\"]) {\n        const subTarget = data[\"subTarget\"] || this.subTarget;\n        const changeSubTargets = this.parent.getChangeSubTargets(data[\"target\"]);\n        if (changeSubTargets[subTarget] == null) {\n          data[\"subTarget\"] = Object.keys(changeSubTargets)[0];\n        }\n      }\n    }\n\n    return data;\n  }\n\n  async update(data, options = {}) {\n    this.updateTime = new Date();\n\n    if (this.parent != null) {\n      data = this.preUpdate(data);\n\n      const rawChange = this.parent.system.changes.find((o) => o._id === this._id);\n      const idx = this.parent.system.changes.indexOf(rawChange);\n      if (idx >= 0) {\n        data = Object.entries(data).reduce((cur, o) => {\n          cur[`system.changes.${idx}.${o[0]}`] = o[1];\n          return cur;\n        }, {});\n        return this.parent.update(data, options);\n      }\n    }\n  }\n\n  /**\n   * Applies this change to an actor.\n   *\n   * @param {ActorFFD20} actor - The actor to apply the change's data to.\n   * @param {string[]} [targets] - Property paths to target on the actor's data.\n   * @param {object} [options] - Optional options to change the behavior of this function.\n   * @param {boolean} [options.applySourceInfo=true] - Whether to add the changes to the actor's source information.\n   */\n  applyChange(actor, targets = null, { applySourceInfo = true } = {}) {\n    // Prepare change targets\n    if (!targets) {\n      targets = getChangeFlat.call(actor, this.subTarget, this.modifier);\n      if (!(targets instanceof Array)) targets = [targets];\n    }\n\n    const rollData = this.parent ? this.parent.getRollData({ refresh: true }) : actor.getRollData({ refresh: true });\n\n    const overrides = actor.changeOverrides;\n    for (const t of targets) {\n      const override = overrides[t];\n      if (!overrides || override) {\n        let operator = this.operator;\n        if (operator === \"+\") operator = \"add\";\n        if (operator === \"=\") operator = \"set\";\n\n        const modifierChanger =\n          t != null ? t.match(/^system\\.abilities\\.([a-zA-Z0-9]+)\\.(?:total|penalty|base)$/) : null;\n        const isModifierChanger = modifierChanger != null;\n        const abilityTarget = modifierChanger?.[1];\n        const ability = isModifierChanger ? deepClone(actor.system.abilities[abilityTarget]) : null;\n\n        let value = 0;\n        if (this.formula) {\n          if (operator === \"script\") {\n            if (!game.settings.get(\"ffd20\", \"allowScriptChanges\")) {\n              ui.notifications?.warn(game.i18n.localize(\"SETTINGS.ffd20AllowScriptChangesE\"), { console: false });\n              console.warn(game.i18n.localize(\"SETTINGS.ffd20AllowScriptChangesE\"), this.parent);\n              value = 0;\n              operator = \"add\";\n            } else {\n              const fn = this.createFunction(this.formula, [\"d\", \"item\"]);\n              const result = fn(rollData, this.parent);\n              value = result.value;\n              operator = result.operator;\n            }\n          } else if (operator === \"function\") {\n            value = this.formula(rollData, this.parent);\n            operator = \"add\";\n          } else if (!isNaN(this.formula)) {\n            value = parseFloat(this.formula);\n          } else if (this.isDeferred) {\n            value = RollFFD20.replaceFormulaData(this.formula, rollData, { missing: 0 });\n          } else {\n            value = RollFFD20.safeRoll(this.formula, rollData, [t, this, rollData], {\n              suppressError: this.parent && !this.parent.testUserPermission(game.user, \"OWNER\"),\n            }).total;\n          }\n        }\n\n        this.data.value = value;\n\n        if (!t) continue;\n        const prior = override[operator][this.modifier];\n\n        switch (operator) {\n          case \"add\":\n            {\n              let base = getProperty(actor, t);\n\n              // Don't change non-existing ability scores\n              if (base == null) {\n                if (t.match(/^system\\.abilities/)) continue;\n                base = 0;\n              }\n\n              if (typeof base === \"number\") {\n                if (CONFIG.FFD20.stackingBonusModifiers.indexOf(this.modifier) !== -1) {\n                  setProperty(actor, t, base + value);\n                  override[operator][this.modifier] = (prior ?? 0) + value;\n                } else {\n                  const diff = !prior ? value : Math.max(0, value - (prior ?? 0));\n                  setProperty(actor, t, base + diff);\n                }\n              }\n            }\n            break;\n\n          case \"set\":\n            setProperty(actor, t, value);\n            override[operator][this.modifier] = value;\n            break;\n        }\n\n        if (applySourceInfo) this.applySourceInfo(actor, value);\n\n        // Adjust ability modifier\n        if (isModifierChanger) {\n          const prevMod = getAbilityModifier(ability.total, {\n            damage: ability.damage,\n            penalty: ability.penalty,\n          });\n          const newAbility = actor.system.abilities[abilityTarget];\n          const mod = getAbilityModifier(newAbility.total, {\n            damage: newAbility.damage,\n            penalty: newAbility.penalty,\n          });\n          setProperty(\n            actor,\n            `system.abilities.${abilityTarget}.mod`,\n            getProperty(actor, `system.abilities.${abilityTarget}.mod`) - (prevMod - mod)\n          );\n        }\n      }\n    }\n  }\n\n  applySourceInfo(actor) {\n    const sourceInfoTargets = this.getSourceInfoTargets(actor);\n    let value = this.value;\n\n    switch (this.operator) {\n      case \"add\":\n      case \"function\":\n        if (CONFIG.FFD20.stackingBonusModifiers.indexOf(this.modifier) !== -1) {\n          const sourceInfoGroup = value >= 0 ? \"positive\" : \"negative\";\n          for (const si of sourceInfoTargets) {\n            getSourceInfo(actor.sourceInfo, si)[sourceInfoGroup].push({\n              value: value,\n              name: this.parent ? this.parent.name : this.flavor,\n              type: this.parent ? this.parent.type : null,\n              change: this,\n            });\n          }\n        } else {\n          for (const si of sourceInfoTargets) {\n            const sourceInfoGroup = value >= 0 ? \"positive\" : \"negative\";\n            const sInfo = getSourceInfo(actor.sourceInfo, si)[sourceInfoGroup];\n\n            // Remove entries with lower values\n            let doAdd = true;\n            sInfo.forEach((o) => {\n              const hasSameParent = o.change?.parent === this.parent;\n              const isEnh =\n                (o.change?.modifier === \"base\" && this.modifier === \"enhancement\") ||\n                (o.change?.modifier === \"enhancement\" && this.modifier === \"base\");\n              const hasSameTarget = o.change?.subTarget === this.subTarget;\n              const alterBase = hasSameParent && isEnh && hasSameTarget;\n\n              if (o.modifier === this.modifier || alterBase) {\n                if (alterBase) {\n                  if (o.change?.modifier === \"base\") {\n                    o.value += value;\n                    doAdd = false;\n                  } else {\n                    value += o.value;\n                    sInfo.splice(sInfo.indexOf(o), 1);\n                  }\n                } else if (o.value < value) {\n                  sInfo.splice(sInfo.indexOf(o), 1);\n                } else {\n                  doAdd = false;\n                }\n              }\n            });\n\n            if (doAdd) {\n              sInfo.push({\n                value: value,\n                name: this.parent ? this.parent.name : this.flavor,\n                type: this.parent ? this.parent.type : null,\n                change: this,\n              });\n            }\n          }\n        }\n        break;\n      case \"set\":\n        for (const si of sourceInfoTargets) {\n          getSourceInfo(actor.sourceInfo, si).positive.push({\n            value: value,\n            operator: \"set\",\n            name: this.parent ? this.parent.name : this.flavor,\n            type: this.parent ? this.parent.type : null,\n            change: this,\n          });\n        }\n        break;\n    }\n  }\n\n  createFunction(funcDef, funcArgs = []) {\n    try {\n      const preDef = `const actor = item.actor; const result = { operator: \"add\", value: 0, };`;\n      const postDef = `return result;`;\n      const fullDef = `return function(${funcArgs.join(\",\")}) {${preDef}${funcDef}\\n${postDef}};`;\n      return new Function(fullDef)();\n    } catch (e) {\n      console.warn(\"Could not create change function with definition \", funcDef);\n      return function () {\n        return { operator: \"add\", value: 0 };\n      };\n    }\n  }\n}\n","import { calculateRange, convertDistance } from \"../utils/lib.mjs\";\nimport { getHighestChanges } from \"../documents/actor/utils/apply-changes.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\nimport { keepUpdateArray, createTag } from \"../utils/lib.mjs\";\n\nexport class ItemAction {\n  constructor(data, parent) {\n    this.data = data;\n    /** @type {import(\"../documents/item/item-ffd20.mjs\").ItemFFD20} */\n    this.parent = parent;\n    this.apps = {};\n    this.sheet = null;\n\n    this.prepareData();\n  }\n\n  get description() {\n    return this.data.description;\n  }\n\n  /**\n   * Creates an action.\n   *\n   * @param {object[]} data - Data to initialize the action(s) with.\n   * @param {object} context - An object containing context information.\n   * @param {ItemFFD20} [context.parent] - The parent entity to create the action within.\n   * @returns The resulting actions, or an empty array if nothing was created.\n   */\n  static async create(data, context = {}) {\n    const { parent } = context;\n\n    if (parent instanceof ffd20.documents.item.ItemFFD20) {\n      // Prepare data\n      data = data.map((dataObj) => mergeObject(this.defaultData, dataObj));\n      const newActionData = deepClone(parent.system.actions || []);\n      newActionData.push(...data);\n\n      // Update parent\n      await parent.update({ \"system.actions\": newActionData });\n\n      // Return results\n      return data.map((o) => parent.actions.get(o._id));\n    }\n\n    return [];\n  }\n\n  static get defaultDamageType() {\n    return {\n      values: [],\n      custom: \"\",\n    };\n  }\n\n  get item() {\n    return this.parent;\n  }\n  get actor() {\n    return this.parent.parentActor;\n  }\n\n  get id() {\n    return this.data._id;\n  }\n  get img() {\n    return this.data.img;\n  }\n  get name() {\n    return this.data.name;\n  }\n  get tag() {\n    return this.data.tag || createTag(this.name);\n  }\n\n  get hasAction() {\n    return !!this.data.actionType;\n  }\n  get hasAttack() {\n    return [\"mwak\", \"rwak\", \"msak\", \"rsak\", \"mcman\", \"rcman\"].includes(this.data.actionType);\n  }\n\n  get hasMultiAttack() {\n    return (\n      this.hasAttack &&\n      ((this.data.attackParts != null && this.data.attackParts.length > 0) ||\n        this.data.formulaicAttacks?.count?.value > 0)\n    );\n  }\n\n  get autoDeductCharges() {\n    if (this.item.type === \"spell\" && !this.item.useSpellPoints()) return true;\n    return this.isCharged && this.data.uses.autoDeductCharges === true;\n  }\n\n  get isCharged() {\n    return this.item.isCharged;\n  }\n\n  get isSelfCharged() {\n    return [\"single\", \"day\", \"week\", \"charges\"].includes(this.data.uses.self?.per);\n  }\n\n  /**\n   * @deprecated\n   * @returns {number} Cost in charges for this action.\n   */\n  get chargeCost() {\n    foundry.utils.logCompatibilityWarning(\"Action.chargeCost is deprecated. Please use Action#getChargeCost instead.\", {\n      since: \"0.82.2\",\n      until: \"0.83.0\",\n    });\n    return this.getChargeCost();\n  }\n\n  /**\n   * @param {object} [options] - Additional options to configure behavior.\n   * @param {object} [options.rollData=null] - Pre-determined roll data to pass for determining the charge cost.\n   * @returns {number} Cost in charges for this action.\n   */\n  getChargeCost({ rollData = null } = {}) {\n    if (!this.autoDeductCharges) return 0;\n\n    if (this.item.type === \"spell\" && !this.item.useSpellPoints()) return 1;\n\n    const formula = this.data.uses.autoDeductChargesCost;\n    if (!(typeof formula === \"string\" && formula.length > 0)) return 1;\n\n    if (!rollData) rollData = this.getRollData();\n    const cost = RollFFD20.safeRoll(formula, rollData).total;\n    return this.item.isSingleUse ? Math.max(-1, Math.min(1, cost)) : cost;\n  }\n\n  /**\n   * @deprecated\n   * @returns {number} The action's range (in system configured units)\n   */\n  get range() {\n    foundry.utils.logCompatibilityWarning(\"Action.range is deprecated. Please use Action#getRange instead.\", {\n      since: \"0.82.2\",\n      until: \"0.83.0\",\n    });\n    return this.getRange({ type: \"single\" });\n  }\n\n  /**\n   * @deprecated\n   * @returns {number} The action's minimum range.\n   */\n  get minRange() {\n    foundry.utils.logCompatibilityWarning(\"Action.minRange is deprecated. Please use Action#getRange instead.\", {\n      since: \"0.82.2\",\n      until: \"0.83.0\",\n    });\n    return this.getRange({ type: \"min\" });\n  }\n\n  /**\n   * @deprecated\n   * @returns {number} The action's maximum range (range multiplied by range increments).\n   */\n  get maxRange() {\n    foundry.utils.logCompatibilityWarning(\"Action.maxRange is deprecated. Please use Action#getRange instead.\", {\n      since: \"0.82.2\",\n      until: \"0.83.0\",\n    });\n    return this.getRange({ type: \"max\" });\n  }\n\n  /**\n   * @param {object} [options] - Additional options to configure behavior.\n   * @param {string} [options.type=\"single\"] - What type of range to query. Either \"single\" (for a single range increment), \"max\" or \"min\".\n   * @param {object} [options.rollData=null] - Specific roll data to pass.\n   * @returns {number|null} The given range, in system configured units, or `null` if no range is applicable.\n   */\n  getRange({ type = \"single\", rollData = null } = {}) {\n    const range = type === \"min\" ? this.data.range.minValue : this.data.range.value;\n    const rangeType = type === \"min\" ? this.data.range.minUnits : this.data.range.units;\n    if (!rangeType) {\n      if (type === \"min\") return 0;\n      return null;\n    }\n\n    if (!rollData) rollData = this.getRollData();\n    const singleIncrementRange = calculateRange(range, rangeType, rollData);\n\n    if ([\"single\", \"min\"].includes(type)) return singleIncrementRange;\n    return singleIncrementRange * this.data.range.maxIncrements;\n  }\n\n  get hasTemplate() {\n    const v = this.data.measureTemplate.type;\n    const s = this.data.measureTemplate.size;\n    return (\n      typeof v === \"string\" && v !== \"\" && ((typeof s === \"string\" && s.length > 0) || (typeof s === \"number\" && s > 0))\n    );\n  }\n\n  /**\n   * Does the action implement a damage roll as part of its usage\n   *\n   * @type {boolean}\n   */\n  get hasDamage() {\n    return !!this.data.damage.parts?.length;\n  }\n\n  /**\n   * Does the item have range defined.\n   *\n   * @type {boolean}\n   */\n  get hasRange() {\n    return this.data.range?.units != null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Does the item provide an amount of healing instead of conventional damage?\n   *\n   * @returns {boolean}\n   */\n  get isHealing() {\n    return this.data.actionType === \"heal\" && this.data.damage.parts.length;\n  }\n\n  get hasEffect() {\n    return this.hasDamage || (this.data.effectNotes != null && this.data.effectNotes.length > 0);\n  }\n\n  /**\n   * Does the Item implement a saving throw as part of its usage\n   *\n   * @type {boolean}\n   */\n  get hasSave() {\n    return typeof this.data.save?.type === \"string\" && this.data.save?.type.length > 0;\n  }\n\n  /**\n   * @param {object} [rollData] - Data to pass to the roll. If none is given, get new roll data.\n   * @returns {number} The Difficulty Class for this action.\n   */\n  getDC(rollData = null) {\n    // No actor? No DC!\n    if (!this.actor) return 0;\n\n    rollData = rollData ?? this.getRollData();\n    let result = 10;\n\n    // Get conditional save DC bonus\n    const dcBonus = rollData[\"dcBonus\"] ?? 0;\n\n    if (this.item.type === \"spell\") {\n      const spellbook = this.item.spellbook;\n      if (spellbook) {\n        let formula = spellbook.baseDCFormula;\n\n        const data = rollData.action;\n        if (data.save.dc.length > 0) formula += ` + ${data.save.dc}`;\n\n        return RollFFD20.safeRoll(formula, rollData).total + dcBonus;\n      }\n    } else {\n      const dcFormula = this.data.save.dc.toString() || \"0\";\n      result = RollFFD20.safeRoll(dcFormula, rollData).total + dcBonus;\n      return result;\n    }\n    return result;\n  }\n\n  get hasSound() {\n    return !!this.data.soundEffect;\n  }\n\n  get enhancementBonus() {\n    return this.data.enh?.value ?? this.item.system.enh;\n  }\n\n  /**\n   * An array of changes affecting this action's damage\n   *\n   * @type {ItemChange[]}\n   */\n  get damageSources() {\n    const isSpell = [\"msak\", \"rsak\", \"spellsave\"].includes(this.data.actionType);\n    const isWeapon = [\"mwak\", \"rwak\"].includes(this.data.actionType);\n    const changes = this.parent.getContextChanges(isSpell ? \"sdamage\" : isWeapon ? \"wdamage\" : \"damage\");\n    const highest = getHighestChanges(changes, { ignoreTarget: true });\n    return highest;\n  }\n\n  getRollData() {\n    const result = this.item.getRollData();\n\n    result.action = deepClone(this.data);\n    result.dc = this.hasSave ? this.getDC(result) : 0;\n\n    if (Hooks.events[\"ffd20GetRollData\"]?.length > 0) Hooks.callAll(\"ffd20GetRollData\", this, result);\n\n    return result;\n  }\n\n  static get defaultData() {\n    return {\n      _id: randomID(16),\n      name: game.i18n.localize(\"FFD20.Action\"),\n      img: \"systems/ffd20/icons/skills/gray_04.jpg\",\n      description: \"\",\n      tag: \"\",\n      activation: {\n        cost: 1,\n        type: \"\",\n      },\n      unchainedAction: {\n        activation: {\n          cost: 1,\n          type: \"\",\n        },\n      },\n      duration: {\n        value: null,\n        units: \"\",\n      },\n      target: {\n        value: \"\",\n      },\n      range: {\n        value: null,\n        units: \"\",\n        maxIncrements: 1,\n        minValue: null,\n        minUnits: \"\",\n      },\n      uses: {\n        autoDeductCharges: true,\n        autoDeductChargesCost: \"1\",\n        self: {\n          value: 0,\n          maxFormula: \"\",\n          per: null,\n        },\n      },\n      measureTemplate: {\n        type: \"\",\n        size: \"\",\n        overrideColor: false,\n        customColor: \"\",\n        overrideTexture: false,\n        customTexture: \"\",\n      },\n      attackName: \"\",\n      actionType: null,\n      attackBonus: \"\",\n      critConfirmBonus: \"\",\n      damage: {\n        parts: [],\n        critParts: [],\n        nonCritParts: [],\n      },\n      attackParts: [],\n      formulaicAttacks: {\n        count: { formula: \"\" },\n        bonus: { formula: \"\" },\n        label: null,\n      },\n      formula: \"\",\n      ability: {\n        attack: null,\n        damage: null,\n        damageMult: 1,\n        critRange: 20,\n        critMult: 2,\n      },\n      save: {\n        dc: \"\",\n        type: \"\",\n        description: \"\",\n      },\n      effectNotes: [],\n      attackNotes: [],\n      soundEffect: \"\",\n      powerAttack: {\n        multiplier: \"\",\n        damageBonus: 2,\n        critMultiplier: 1,\n      },\n      naturalAttack: {\n        primaryAttack: true,\n        secondary: {\n          attackBonus: \"-5\",\n          damageMult: 0.5,\n        },\n      },\n      nonlethal: false,\n      usesAmmo: false,\n      spellEffect: \"\",\n      spellArea: \"\",\n      conditionals: [],\n      enh: {\n        value: null,\n      },\n    };\n  }\n\n  prepareData() {\n    this.labels = {};\n\n    // Parse formulaic attacks\n    if (this.hasAttack) {\n      this.parseFormulaicAttacks({ formula: getProperty(this.data, \"formulaicAttacks.count.formula\") });\n    }\n\n    // Update conditionals\n    if (this.data.conditionals instanceof Array) {\n      this.conditionals = this._prepareConditionals(this.data.conditionals);\n    }\n\n    // Prepare max personal charges\n    if (this.data.uses.self?.per) {\n      const maxFormula = this.data.uses.self.per === \"single\" ? \"1\" : this.data.uses.self.maxFormula;\n      const maxUses = RollFFD20.safeTotal(maxFormula, this.getRollData());\n      setProperty(this.data, \"uses.self.max\", maxUses);\n    }\n\n    // Remove enhancement bonus override, if wrong type\n    if (this.data.enh?.value != null && ![\"weapon\", \"attack\"].includes(this.item.type)) {\n      setProperty(this.data, \"enh.value\", null);\n    }\n  }\n\n  _prepareConditionals(conditionals) {\n    const prior = this.conditionals;\n    const collection = new Collection();\n    for (const o of conditionals) {\n      let conditional = null;\n      if (prior && prior.has(o._id)) {\n        conditional = prior.get(o._id);\n        conditional.data = o;\n        conditional.prepareData();\n      } else conditional = new ffd20.components.ItemConditional(o, this);\n      collection.set(o._id || conditional.data._id, conditional);\n    }\n    return collection;\n  }\n\n  async delete() {\n    const actions = deepClone(this.item.system.actions);\n    const idx = this.item.system.actions.indexOf(this.data);\n    actions.splice(idx, 1);\n\n    // Close applications\n    const promises = [];\n    for (const app of Object.values(this.apps)) {\n      promises.push(app.close());\n    }\n    await Promise.all(promises);\n\n    // Delete action\n    return this.item.update({ \"system.actions\": actions });\n  }\n\n  async update(updateData, options = {}) {\n    const idx = this.item.system.actions.indexOf(this.data);\n    const prevData = deepClone(this.data);\n    const newUpdateData = flattenObject(mergeObject(prevData, expandObject(updateData)));\n\n    // Make sure this action has a name, even if it's removed\n    if (!newUpdateData[\"name\"]) newUpdateData[\"name\"] = this.name;\n\n    // Make sure stuff remains an array\n    {\n      const keepPaths = [\n        \"attackParts\",\n        \"damage.parts\",\n        \"damage.critParts\",\n        \"damage.nonCritParts\",\n        \"attackNotes\",\n        \"effectNotes\",\n        \"conditionals\",\n      ];\n\n      for (const path of keepPaths) {\n        keepUpdateArray(this.data, newUpdateData, path);\n      }\n    }\n\n    await this.item.update({ [`system.actions.${idx}`]: expandObject(newUpdateData) });\n    await this.sheet?.render();\n  }\n\n  /* -------------------------------------------- */\n  /*  Chat Data Generation\t\t\t\t\t\t\t\t\t\t\t\t*/\n  /* -------------------------------------------- */\n\n  /**\n   * Generates {@link ChatData} for this action's parent item, but with this action's data,\n   * regardless of whether it is the first action or not.\n   *\n   * @see {@link ItemFFD20#getChatData}\n   * @param {EnrichmentOptions} [htmlOptions] - Options passed to {@link ItemFFD20#getChatData} affecting text enrichment\n   * @param {object} [chatDataOptions] - Options passed to {@link ItemFFD20#getChatData} affecting the chat data\n   * @returns {import(\"../documents/item/item-ffd20.mjs\").ChatData} Chat data for this action's parent and this action\n   */\n  getChatData(htmlOptions = {}, chatDataOptions = {}) {\n    return this.parent.getChatData(htmlOptions, { ...chatDataOptions, actionId: this.id });\n  }\n\n  /**\n   * Returns labels related to this particular action\n   *\n   * @param {object} [options]\n   * @param {object} [options.rollData] - Pre-determined roll data. If not provided, finds the action's own roll data.\n   * @returns {Record<string, string>} This action's labels\n   */\n  getLabels(options = {}) {\n    const actionData = this.data;\n    const labels = {};\n    const rollData = options.rollData ?? this.getRollData();\n\n    // Activation method\n    if (actionData.activation) {\n      const activationTypes = game.settings.get(\"ffd20\", \"unchainedActionEconomy\")\n        ? CONFIG.FFD20.abilityActivationTypes_unchained\n        : CONFIG.FFD20.abilityActivationTypes;\n      const activationTypesPlural = game.settings.get(\"ffd20\", \"unchainedActionEconomy\")\n        ? CONFIG.FFD20.abilityActivationTypesPlurals_unchained\n        : CONFIG.FFD20.abilityActivationTypesPlurals;\n\n      const activation = game.settings.get(\"ffd20\", \"unchainedActionEconomy\")\n        ? actionData.unchainedAction.activation || {}\n        : actionData.activation || {};\n      if (activation && activation.cost > 1 && activationTypesPlural[activation.type] != null) {\n        labels.activation = [activation.cost.toString(), activationTypesPlural[activation.type]].filterJoin(\" \");\n      } else if (activation) {\n        labels.activation = [\n          [\"minute\", \"hour\", \"action\"].includes(activation.type) && activation.cost ? activation.cost.toString() : \"\",\n          activationTypes[activation.type],\n        ].filterJoin(\" \");\n      }\n    }\n\n    // Difficulty Class\n    if (this.hasSave) {\n      labels.save = `DC ${this.getDC()}`;\n    }\n\n    return labels;\n  }\n\n  // -----------------------------------------------------------------------\n\n  parseFormulaicAttacks({ formula = null } = {}) {\n    if (!this.actor) return;\n\n    const exAtkCountFormula = formula ?? (this.data.formulaicAttacks?.count?.formula || \"\");\n    let extraAttacks = 0,\n      xaroll;\n    const rollData = this.getRollData();\n    if (exAtkCountFormula.length > 0) {\n      xaroll = RollFFD20.safeRoll(exAtkCountFormula, rollData);\n      extraAttacks = Math.min(50, Math.max(0, xaroll.total)); // Arbitrarily clamp attacks\n    }\n    if (xaroll?.err) {\n      const msg = game.i18n.localize(\"FFD20.ErrorItemFormula\").format(this.name, this.actor?.name);\n      console.warn(msg, xaroll.err, exAtkCountFormula);\n      ui.notifications.warn(msg);\n    }\n\n    // Test bonus attack formula\n    const exAtkBonusFormula = this.data.formulaicAttacks?.bonus || \"\";\n    try {\n      if (exAtkBonusFormula.length > 0) {\n        rollData[\"attackCount\"] = 1;\n        RollFFD20.safeRoll(exAtkBonusFormula, rollData);\n      }\n    } catch (err) {\n      const msg = game.i18n.localize(\"FFD20.ErrorItemFormula\").format(this.name, this.actor?.name);\n      console.warn(msg, err, exAtkBonusFormula);\n      ui.notifications.warn(msg);\n    }\n\n    // Update item\n    setProperty(this.data, \"formulaicAttacks.count.value\", extraAttacks);\n\n    return extraAttacks;\n  }\n\n  /**\n   * Place an attack roll using an item (weapon, feat, spell, or equipment)\n   *\n   * @param root0\n   * @param root0.data\n   * @param root0.extraParts\n   * @param root0.bonus\n   * @param root0.primaryAttack\n   */\n  async rollAttack({ data = null, extraParts = [], bonus = null, primaryAttack = true } = {}) {\n    const rollData = data ?? this.getRollData();\n    const itemData = rollData.item;\n    const actionData = rollData.action;\n\n    rollData.item.primaryAttack = primaryAttack;\n\n    const isRanged = [\"rwak\", \"rsak\", \"rcman\"].includes(actionData.actionType);\n    const isCMB = [\"mcman\", \"rcman\"].includes(actionData.actionType);\n\n    // Determine size bonus\n    rollData.sizeBonus = !isCMB\n      ? CONFIG.FFD20.sizeMods[rollData.traits.size]\n      : CONFIG.FFD20.sizeSpecialMods[rollData.traits.size];\n\n    // Add misc bonuses/penalties\n    rollData.item.proficiencyPenalty = -4;\n\n    // Determine ability score modifier\n    const abl = actionData.ability.attack;\n\n    // Define Roll parts\n    let parts = [];\n\n    this.actor.sourceDetails[\"system.attributes.attack.shared\"]\n      ?.reverse()\n      .forEach((s) => parts.push(`${s.value}[${s.name}]`));\n\n    // CMB specific modifiers\n    if (isCMB) {\n      this.actor.sourceDetails[\"system.attributes.cmb.bonus\"]\n        ?.reverse()\n        .forEach((s) => parts.push(`${s.value}[${s.name}]`));\n    }\n\n    // Add size bonus\n    if (rollData.sizeBonus !== 0) parts.push(`@sizeBonus[${game.i18n.localize(\"FFD20.Size\")}]`);\n\n    // Add ability modifier\n    if (abl != \"\" && rollData.abilities[abl] != null && rollData.abilities[abl].mod !== 0) {\n      parts.push(`@abilities.${abl}.mod[${CONFIG.FFD20.abilities[abl]}]`);\n    }\n    // Add bonus parts\n    parts = parts.concat(extraParts);\n    // Add attack bonus\n    if (typeof actionData.attackBonus === \"string\" && ![\"\", \"0\"].includes(actionData.attackBonus)) {\n      parts.push(actionData.attackBonus);\n    }\n    // Backwards compatibility\n    else if (typeof actionData.attackBonus === \"number\") {\n      rollData.item.attackBonus = actionData.attackBonus;\n      parts.push(`@item.attackBonus[${game.i18n.localize(\"FFD20.AttackRollBonus\")}]`);\n    }\n\n    // Add change bonus\n    const changes = this.item.getContextChanges(isRanged ? \"rattack\" : \"mattack\");\n    // Add masterwork bonus to changes (if applicable)\n    if ([\"mwak\", \"rwak\", \"mcman\", \"rcman\"].includes(this.data.actionType) && this.item.system.masterwork) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: \"1\",\n          operator: \"add\",\n          subTarget: \"attack\",\n          modifier: \"enh\",\n          value: 1,\n          flavor: game.i18n.localize(\"FFD20.EnhancementBonus\"),\n        })\n      );\n    }\n    // Add enhancement bonus to changes\n    if (this.enhancementBonus) {\n      changes.push(\n        new ffd20.components.ItemChange({\n          formula: this.enhancementBonus.toString(),\n          operator: \"add\",\n          subTarget: \"attack\",\n          modifier: \"enh\",\n          value: this.enhancementBonus,\n          flavor: game.i18n.localize(\"FFD20.EnhancementBonus\"),\n        })\n      );\n    }\n    let changeBonus = [];\n    // Get attack bonus\n    changeBonus = getHighestChanges(\n      changes.filter((c) => {\n        c.applyChange(this.actor);\n        return ![\"set\", \"=\"].includes(c.operator);\n      }),\n      { ignoreTarget: true }\n    ).reduce((cur, c) => {\n      cur.push({\n        value: c.value,\n        source: c.flavor,\n      });\n      return cur;\n    }, []);\n    for (const c of changeBonus) {\n      parts.push(`${c.value}[${RollFFD20.cleanFlavor(c.source)}]`);\n    }\n\n    // Add proficiency penalty\n    if (this.item.type === \"attack\" && !itemData.proficient) {\n      parts.push(`@item.proficiencyPenalty[${game.i18n.localize(\"FFD20.ProficiencyPenalty\")}]`);\n    }\n    // Add secondary natural attack penalty\n    if (this.item.system.attackType === \"natural\" && primaryAttack === false) {\n      const penalty = -5;\n      parts.push(`${penalty}[${game.i18n.localize(\"FFD20.SecondaryAttack\")}]`);\n    }\n    // Add bonus\n    if (bonus) {\n      rollData.bonus = RollFFD20.safeRoll(bonus, rollData).total;\n      parts.push(`@bonus[${game.i18n.localize(\"FFD20.SituationalBonus\")}]`);\n    }\n\n    const roll = await RollFFD20.create(\n      [rollData.d20 || \"1d20\", ...parts.filter((p) => !!p)].join(\"+\"),\n      rollData\n    ).evaluate({ async: true });\n    return roll;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Only roll the item's effect.\n   *\n   * @param root0\n   * @param root0.critical\n   * @param root0.primaryAttack\n   */\n  rollEffect({ critical = false, primaryAttack = true } = {}) {\n    const rollData = this.getRollData();\n\n    if (!this.hasEffect) {\n      throw new Error(\"You may not make an Effect Roll with this Item.\");\n    }\n\n    // Determine critical multiplier\n    rollData.critMult = 1;\n    if (critical) rollData.critMult = this.data.ability.critMult;\n    // Determine ability multiplier\n    if (this.data.ability.damageMult != null) rollData.ablMult = this.data.ability.damageMult;\n\n    // Create effect string\n    const effectNotes = this.parent.getContextNotes(\"attacks.effect\").reduce((cur, o) => {\n      o.notes\n        .reduce((cur2, n) => {\n          cur2.push(...n.split(/[\\n\\r]+/));\n          return cur2;\n        }, [])\n        .forEach((n) => {\n          cur.push(n);\n        });\n      return cur;\n    }, []);\n    effectNotes.push(...this.data.effectNotes);\n    let effectContent = \"\";\n    for (const fx of effectNotes) {\n      if (fx.length > 0) {\n        effectContent += `<span class=\"tag\">${fx}</span>`;\n      }\n    }\n\n    if (effectContent.length === 0) return \"\";\n\n    const inner = TextEditor.enrichHTML(effectContent, { rollData: rollData });\n    return `<div class=\"flexcol property-group\"><label>${game.i18n.localize(\n      \"FFD20.EffectNotes\"\n    )}</label><div class=\"flexrow tag-list\">${inner}</div></div>`;\n  }\n\n  /**\n   * Place an attack roll using an item (weapon, feat, spell, or equipment)\n   * Rely upon the DiceFFD20.d20Roll logic for the core implementation\n   *\n   * @param options\n   */\n  async rollFormula(options = {}) {\n    const itemData = this.data;\n    if (!itemData.formula) {\n      throw new Error(game.i18n.localize(\"FFD20.ErrorNoFormula\").format(this.name));\n    }\n\n    // Define Roll Data\n    const rollData = this.parent.getRollData();\n    rollData.item = itemData;\n    const title = `${this.name} - ${game.i18n.localize(\"FFD20.OtherFormula\")}`;\n\n    const roll = await RollFFD20.create(itemData.formula, rollData).evaluate({ async: true });\n    return roll.toMessage({\n      speaker: ChatMessage.getSpeaker({ actor: this.parent }),\n      flavor: itemData.chatFlavor || title,\n      rollMode: game.settings.get(\"core\", \"rollMode\"),\n    });\n  }\n\n  /**\n   * Place a damage roll using an item (weapon, feat, spell, or equipment)\n   * Rely upon the DiceFFD20.damageRoll logic for the core implementation\n   *\n   * @param root0\n   * @param root0.data\n   * @param root0.critical\n   * @param root0.extraParts\n   * @param root0.conditionalParts\n   * @param root0.primaryAttack\n   */\n  async rollDamage({\n    data = null,\n    critical = false,\n    extraParts = [],\n    conditionalParts = {},\n    primaryAttack = true,\n  } = {}) {\n    const rollData = data ?? this.getRollData();\n\n    if (!this.hasDamage) {\n      throw new Error(\"You may not make a Damage Roll with this Action.\");\n    }\n\n    // Determine critical multiplier\n    rollData.critMult = 1;\n    if (critical) rollData.critMult = this.data.ability.critMult;\n    // Determine ability multiplier\n    if (rollData.ablMult == null) rollData.ablMult = rollData.action?.ability.damageMult;\n\n    // Define Roll parts\n    let parts = this.data.damage.parts.map((p) => {\n      return { base: p[0], extra: [], damageType: p[1], type: \"normal\" };\n    });\n    // Add conditionals damage\n    conditionalParts[\"damage.normal\"]?.forEach((p) => {\n      const [base, damageType, isExtra] = p;\n      isExtra ? parts[0].extra.push(base) : parts.push({ base, extra: [], damageType, type: \"normal\" });\n    });\n    // Add critical damage parts\n    if (critical === true) {\n      if (getProperty(this.data, \"damage.critParts\") != null) {\n        parts = parts.concat(\n          this.data.damage.critParts.map((p) => {\n            return { base: p[0], extra: [], damageType: p[1], type: \"crit\" };\n          })\n        );\n      }\n      // Add conditional critical damage parts\n      conditionalParts[\"damage.crit\"]?.forEach((p) => {\n        const [base, damageType, isExtra] = p;\n        isExtra ? parts[0].extra.push(base) : parts.push({ base, extra: [], damageType, type: \"crit\" });\n      });\n    }\n    // Add non-critical damage parts\n    if (critical === false) {\n      if (getProperty(this.data, \"damage.nonCritParts\") != null) {\n        parts = parts.concat(\n          this.data.damage.nonCritParts.map((p) => {\n            return { base: p[0], extra: [], damageType: p[1], type: \"nonCrit\" };\n          })\n        );\n      }\n      // Add conditional non-critical damage parts\n      conditionalParts[\"damage.nonCrit\"]?.forEach((p) => {\n        const [base, damageType, isExtra] = p;\n        isExtra ? parts[0].extra.push(base) : parts.push({ base, extra: [], damageType, type: \"nonCrit\" });\n      });\n    }\n\n    if (!this.isHealing) {\n      // Gather changes\n      const isSpell = [\"msak\", \"rsak\", \"spellsave\"].includes(this.data.actionType);\n      const isWeapon = [\"mwak\", \"rwak\"].includes(this.data.actionType);\n      const changes = this.item.getContextChanges(isSpell ? \"sdamage\" : isWeapon ? \"wdamage\" : \"damage\");\n\n      // Add enhancement bonus to changes\n      if (this.enhancementBonus) {\n        changes.push(\n          new ffd20.components.ItemChange({\n            formula: this.enhancementBonus.toString(),\n            operator: \"add\",\n            subTarget: \"damage\",\n            modifier: \"enh\",\n            value: this.enhancementBonus,\n            flavor: game.i18n.localize(\"FFD20.EnhancementBonus\"),\n          })\n        );\n      }\n\n      // Get damage bonus\n      getHighestChanges(\n        changes.filter((c) => {\n          c.applyChange(this.actor);\n          return ![\"set\", \"=\"].includes(c.operator);\n        }),\n        { ignoreTarget: true }\n      ).forEach((c) => {\n        let value = c.value;\n        // Put in parenthesis if there's a chance it is more complex\n        if (/[\\s+-?:]/.test(value)) value = `(${value})`;\n        parts[0].extra.push(`${value}[${c.flavor}]`);\n      });\n\n      // Add broken penalty\n      if (this.item.system.broken) {\n        const label = game.i18n.localize(\"FFD20.Broken\");\n        parts[0].extra.push(`-2[${label}]`);\n      }\n    }\n\n    // Determine ability score modifier\n    const abl = this.data.ability.damage;\n    if (typeof abl === \"string\" && abl !== \"\") {\n      // Determine ability score bonus\n      rollData.ablDamage = Math.floor(rollData.abilities[abl].mod * rollData.ablMult);\n      if (rollData.abilities[abl].mod < 0) rollData.ablDamage = rollData.abilities[abl].mod;\n\n      // Determine ability score label\n      const ablLabel = CONFIG.FFD20.abilities[abl];\n\n      // Add ability score\n      parts[0].extra.push(`@ablDamage[${ablLabel}]`);\n    }\n\n    // Create roll\n    const rolls = [];\n    for (let a = 0; a < parts.length; a++) {\n      const part = parts[a];\n      let rollParts = [];\n      if (a === 0) rollParts = [...part.extra, ...extraParts];\n      const formula = [part.base, ...rollParts].join(\" + \");\n      // Skip empty formulas instead of erroring on them\n      if (formula.length == 0) continue;\n      try {\n        const roll = {\n          roll: await RollFFD20.create(formula, rollData).evaluate({ async: true }),\n          damageType: part.damageType,\n          type: part.type,\n        };\n        // Remove all negative damage results on critical damage\n        if (critical) {\n          const parts = [];\n          roll.roll.terms.forEach((t, i, arr) => {\n            const prior = arr[i - 1];\n            const isPriorNegativeOperator = prior instanceof OperatorTerm && prior.operator === \"-\";\n\n            if (t instanceof NumericTerm) {\n              const isNegative =\n                (t.number <= 0 && !isPriorNegativeOperator) || (t.number >= 0 && isPriorNegativeOperator);\n              if (isNegative) {\n                if (prior instanceof OperatorTerm) parts.pop();\n              } else {\n                if (t.flavor) parts.push(`${t.number}[${t.flavor}]`);\n                else parts.push(`${t.number}`);\n              }\n            } else parts.push(t.formula);\n          });\n          roll.roll = await RollFFD20.create(parts.join(\" \"), rollData).evaluate({ async: true });\n        }\n\n        // Add to result\n        rolls.push(roll);\n      } catch (err) {\n        console.error(\"Error with damage formula:\", formula, this);\n        throw err;\n      }\n    }\n\n    return rolls;\n  }\n\n  /**\n   * Generates a list of targets this modifier can have.\n   *\n   * @param {ItemFFD20} item - The item for which the modifier is to be created.\n   * @returns {Object<string, string>} A list of targets\n   */\n  getConditionalTargets() {\n    const result = {};\n    if (this.hasAttack) result[\"attack\"] = game.i18n.localize(CONFIG.FFD20.conditionalTargets.attack._label);\n    if (this.hasDamage) result[\"damage\"] = game.i18n.localize(CONFIG.FFD20.conditionalTargets.damage._label);\n    result[\"size\"] = game.i18n.localize(CONFIG.FFD20.conditionalTargets.size._label);\n    if (this.item.type === \"spell\" || this.hasSave)\n      result[\"effect\"] = game.i18n.localize(CONFIG.FFD20.conditionalTargets.effect._label);\n    // Only add Misc target if subTargets are available\n    if (Object.keys(this.getConditionalSubTargets(\"misc\")).length > 0) {\n      result[\"misc\"] = game.i18n.localize(CONFIG.FFD20.conditionalTargets.misc._label);\n    }\n    return result;\n  }\n\n  /**\n   * Generates lists of conditional subtargets this attack can have.\n   *\n   * @param {string} target - The target key, as defined in CONFIG.FFD20.conditionTargets.\n   * @returns {Object<string, string>} A list of conditionals\n   */\n  getConditionalSubTargets(target) {\n    const result = {};\n    // Add static targets\n    if (hasProperty(CONFIG.FFD20.conditionalTargets, target)) {\n      for (const [k, v] of Object.entries(CONFIG.FFD20.conditionalTargets[target])) {\n        if (!k.startsWith(\"_\") && !k.startsWith(\"~\")) result[k] = v;\n      }\n    }\n    // Add subtargets depending on attacks\n    if ([\"attack\", \"damage\"].includes(target)) {\n      // Add specific attacks\n      if (this.hasAttack) {\n        result[\"attack_0\"] = `${game.i18n.localize(\"FFD20.Attack\")} 1`;\n      } else {\n        delete result[\"rapidShotDamage\"];\n      }\n      if (this.hasMultiAttack) {\n        for (const [k, v] of Object.entries(this.data.attackParts)) {\n          result[`attack_${Number(k) + 1}`] = v[1];\n        }\n      }\n    }\n    // Add subtargets affecting effects\n    if (target === \"effect\") {\n      if (this.hasSave) result[\"dc\"] = game.i18n.localize(\"FFD20.DC\");\n    }\n    // Add misc subtargets\n    if (target === \"misc\") {\n      // Add charges subTarget with specific label\n      if (this.isCharged && this.type !== \"spell\") result[\"charges\"] = game.i18n.localize(\"FFD20.ChargeCost\");\n    }\n    return result;\n  }\n\n  /* Generates lists of conditional modifier bonus types applicable to a formula.\n   * @param {string} target - The target key as defined in CONFIG.FFD20.conditionTargets.\n   * @returns {Object.<string, string>} A list of bonus types.\n   * */\n  getConditionalModifierTypes(target) {\n    const result = {};\n    if (target === \"attack\" || target === \"damage\") {\n      // Add bonusModifiers from CONFIG.FFD20.bonusModifiers\n      for (const [k, v] of Object.entries(CONFIG.FFD20.bonusModifiers)) {\n        result[k] = v;\n      }\n    }\n    if (target === \"damage\") {\n      for (const [k, v] of Object.entries(CONFIG.FFD20.damageTypes)) {\n        result[k] = v;\n      }\n    }\n    return result;\n  }\n\n  /* Generates a list of critical applications for a given formula target.\n   * @param {string} target - The target key as defined in CONFIG.FFD20.conditionalTargets.\n   * @returns {Object.<string, string>} A list of critical applications.\n   * */\n  getConditionalCritical(target) {\n    let result = {};\n    // Attack bonuses can only apply as critical confirm bonus\n    if (target === \"attack\") {\n      result = { ...result, normal: \"FFD20.Normal\", crit: \"FFD20.CriticalConfirmBonus\" };\n    }\n    // Damage bonuses can be multiplied or not\n    if (target === \"damage\") {\n      result = { ...result, normal: \"FFD20.Normal\" };\n      if (this.hasAttack) {\n        result = { ...result, crit: \"FFD20.CritDamageBonusFormula\", nonCrit: \"FFD20.NonCritDamageBonusFormula\" };\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @param {object} options - See ItemFFD20#useAttack.\n   * @returns {Promise<void>}\n   */\n  async use(options = {}) {\n    options.actionID = this.id;\n\n    return this.item.use(options);\n  }\n}\n","import { RollFFD20 } from \"../dice/roll.mjs\";\n\nexport class ChatAttack {\n  constructor(action, { label = \"\", rollData = {}, targets = null } = {}) {\n    this._rollData = rollData;\n    this.setAction(action);\n    this.label = label;\n\n    this.attack = {\n      flavor: \"\",\n      total: 0,\n      isCrit: false,\n      isFumble: false,\n      roll: null,\n    };\n    this.critConfirm = {\n      flavor: \"\",\n      total: 0,\n      isCrit: false,\n      isFumble: false,\n      roll: null,\n    };\n    this.hasAttack = false;\n    this.hasCritConfirm = false;\n\n    this.damage = {\n      flavor: \"\",\n      tooltip: \"\",\n      total: 0,\n      rolls: [],\n      parts: [],\n    };\n    this.critDamage = {\n      flavor: \"\",\n      tooltip: \"\",\n      total: 0,\n      rolls: [],\n      parts: [],\n    };\n    this.hasDamage = false;\n    this.hasRange = action.item.hasRange;\n    this.minimumDamage = false;\n    this.nonlethal = false;\n    this.damageRows = [];\n\n    this.notesOnly = true;\n\n    this.cards = {};\n    this.hasCards = false;\n    this.attackNotes = [];\n    this.effectNotes = [];\n    this.attackNotesHTML = \"\";\n    this.effectNotesHTML = \"\";\n    this.targets = targets;\n    this.ammo = null;\n  }\n\n  setAmmo(ammoId) {\n    if (ammoId == null) {\n      this.ammo = null;\n    } else {\n      const ammoItem = this.action.item.actor?.items.get(ammoId);\n      if (ammoItem == null) {\n        this.ammo = null;\n        return;\n      }\n\n      this.ammo = {\n        id: ammoId,\n        img: ammoItem.img,\n        name: ammoItem.name,\n      };\n    }\n  }\n\n  get critRange() {\n    if (this.action.item.system.broken) return 20;\n    return getProperty(this.action, \"data.ability.critRange\") || 20;\n  }\n\n  /**\n   * Sets the attack's item reference.\n   *\n   * @param {ItemAction} item - The action to reference.\n   * @param action\n   */\n  setAction(action) {\n    if (action == null) {\n      this.rollData = this._rollData;\n      this.attackType = \"\";\n      this.action = null;\n      return;\n    }\n\n    this.action = action;\n    this.rollData = mergeObject(this.action.getRollData(), this._rollData, { inplace: false });\n    this.attackType = getProperty(action.data, \"data.attackType\") ?? \"\";\n    this.isHealing = action.isHealing;\n\n    this.setRollData();\n  }\n\n  /**\n   * Applies changes to the roll data.\n   */\n  setRollData() {\n    const data = this.rollData;\n    // Set critical hit multiplier\n    data.critMult = 1;\n    data.critCount = 0;\n    // Add critical confirmation bonus\n    data.critConfirmBonus = RollFFD20.safeTotal(data.action.critConfirmBonus || \"0\") ?? 0;\n    // Determine ability multiplier\n    if (data.action.ability.damageMult != null) data.ablMult = data.action.ability.damageMult;\n  }\n\n  setAttackNotesHTML() {\n    if (this.attackNotes.length === 0) {\n      this.attackNotesHTML = \"\";\n      return;\n    }\n\n    let result = \"\";\n    for (const n of this.attackNotes) {\n      if (n.length > 0) {\n        result += `<span class=\"tag\">${n}</span>`;\n      }\n    }\n    const inner = TextEditor.enrichHTML(result, { rollData: this.rollData, async: false });\n    this.attackNotesHTML = `<div class=\"flexcol property-group gm-sensitive attack-notes\"><label>${game.i18n.localize(\n      \"FFD20.AttackNotes\"\n    )}</label><div class=\"flexrow tag-list\">${inner}</div></div>`;\n  }\n\n  setEffectNotesHTML() {\n    if (this.effectNotes.length === 0) {\n      this.effectNotesHTML = \"\";\n      return;\n    }\n\n    let result = \"\";\n    for (const n of this.effectNotes) {\n      if (n.length > 0) {\n        result += `<span class=\"tag\">${n}</span>`;\n      }\n    }\n    const inner = TextEditor.enrichHTML(result, { rollData: this.rollData, async: false });\n    this.effectNotesHTML = `<div class=\"flexcol property-group gm-sensitive effect-notes\"><label>${game.i18n.localize(\n      \"FFD20.EffectNotes\"\n    )}</label><div class=\"flexrow tag-list\">${inner}</div></div>`;\n  }\n\n  async addAttack({ noAttack = false, bonus = null, extraParts = [], critical = false, conditionalParts = {} } = {}) {\n    if (!this.action.item) return;\n\n    this.hasAttack = true;\n    this.notesOnly = false;\n    let data = this.attack;\n    if (critical === true) {\n      data = this.critConfirm;\n      if (this.rollData.critConfirmBonus !== 0) {\n        extraParts.push(`@critConfirmBonus[${game.i18n.localize(\"FFD20.CriticalConfirmation\")}]`);\n      }\n\n      const ccKey = ffd20.documents.actor.changes.getChangeFlat.call(this.action.item, \"critConfirm\");\n      this.action.item.parentActor?.sourceDetails[ccKey]?.forEach((c) => extraParts.push(`(${c.value})[${c.name}]`));\n\n      // Add conditionals for critical confirmation\n      if (conditionalParts[\"attack.crit\"]?.length) extraParts.push(...conditionalParts[\"attack.crit\"]);\n    } else {\n      // Add conditional attack bonus\n      if (conditionalParts[\"attack.normal\"]?.length) extraParts.push(...conditionalParts[\"attack.normal\"]);\n    }\n\n    // Add broken penalty\n    if (this.action.item.broken && !critical) {\n      const label = game.i18n.localize(\"FFD20.Broken\");\n      extraParts.push(`-2[${label}]`);\n    }\n\n    // Roll attack\n    if (!noAttack) {\n      const roll = await this.action.rollAttack({\n        data: this.rollData,\n        bonus: bonus,\n        extraParts: extraParts,\n      });\n      data.roll = roll;\n      const d20 = roll.dice.length ? roll.dice[0].total : roll.terms[0].total;\n      let critType = 0;\n      const isCmb = [\"mcman\", \"rcman\"].includes(this.action.data.actionType);\n      if ((d20 >= this.critRange && !critical && !isCmb) || (d20 === 20 && (critical || isCmb))) critType = 1;\n      else if (d20 === 1) critType = 2;\n\n      data.total = roll.total;\n      data.isCrit = critType === 1;\n      data.isFumble = critType === 2;\n      data.isNat20 = d20 === 20;\n      data.formula = roll.formula;\n\n      // Add crit confirm\n      if (!critical && !isCmb && d20 >= this.critRange && this.rollData.action.ability.critMult > 1) {\n        this.hasCritConfirm = true;\n        this.rollData.critMult = Math.max(1, this.rollData.action.ability.critMult);\n        if (this.action.item.system.broken) this.rollData.critMult = 1;\n\n        await this.addAttack({ bonus: bonus, extraParts: extraParts, critical: true, conditionalParts });\n      }\n    }\n\n    // Add tooltip\n    data.flavor = critical ? game.i18n.localize(\"FFD20.CriticalConfirmation\") : this.label;\n\n    if (this.attackNotes === \"\") this.addAttackNotes();\n  }\n\n  addAttackNotes() {\n    if (!this.action.item) return;\n\n    const type = this.action.data.actionType;\n    const typeMap = {\n      rsak: [\"ranged\", /*\"spell\",*/ \"rangedSpell\"],\n      rwak: [\"ranged\", /*\"weapon\",*/ \"rangedWeapon\"],\n      rcman: [\"ranged\"],\n      mwak: [\"melee\", /*\"weapon\",*/ \"meleeWeapon\"],\n      msak: [\"melee\", /*\"spell\",*/ \"meleeSpell\"],\n      mcman: [\"melee\"],\n    };\n\n    const notes = [];\n    // Add actor notes\n    if (this.action.item != null && this.action.item.actor != null) {\n      notes.push(...this.action.item.actor.getContextNotesParsed(\"attacks.attack\"));\n      if ((typeMap[type]?.length || 0) > 0)\n        typeMap[type].forEach((subTarget) =>\n          notes.push(...this.action.item.actor.getContextNotesParsed(`attacks.${subTarget}`))\n        );\n    }\n    // Add item notes\n    if (this.action.item != null && this.action.item.system.attackNotes) {\n      notes.push(...this.action.item.system.attackNotes);\n    }\n    // Add action notes\n    if (this.action.data.attackNotes) {\n      notes.push(...this.action.data.attackNotes);\n    }\n    // Add CMB notes\n    if ([\"mcman\", \"rcman\"].includes(this.action.data.actionType)) {\n      notes.push(...(this.action.item?.actor?.getContextNotesParsed(\"misc.cmb\") ?? []));\n    }\n\n    this.attackNotes = notes;\n    this.setAttackNotesHTML();\n  }\n\n  async addDamage({ flavor = null, extraParts = [], critical = false, conditionalParts = {} } = {}) {\n    if (!this.action.item) return;\n\n    this.hasDamage = true;\n    this.notesOnly = false;\n    let data = this.damage;\n    if (critical === true) data = this.critDamage;\n\n    const rollData = duplicate(this.rollData);\n    // Enforce critical multiplier\n    rollData.critCount = 0;\n\n    // Roll damage\n    const repeatCount = critical ? Math.max(1, rollData.critMult - 1) : 1;\n    for (let repeat = 0; repeat < repeatCount; ++repeat) {\n      if (critical) rollData.critCount++;\n      const rolls = await this.action.rollDamage({\n        data: rollData,\n        extraParts: extraParts,\n        critical: critical,\n        conditionalParts,\n      });\n      data.rolls = rolls;\n      // Add damage parts\n      for (const roll of rolls) {\n        const dtype = roll.damageType;\n        data.parts.push(new DamagePart(roll.roll.total, dtype, roll.roll, roll.type));\n      }\n    }\n\n    // Consolidate damage parts based on damage type\n    let tooltips = \"\";\n\n    // Add tooltip\n    for (const p of Object.values(data.parts)) {\n      tooltips += await renderTemplate(\"systems/ffd20/templates/internal/damage-tooltip.hbs\", {\n        part: p,\n      });\n    }\n\n    // Add normal data\n    if (!flavor) {\n      if (!critical) flavor = this.isHealing ? game.i18n.localize(\"FFD20.Healing\") : game.i18n.localize(\"FFD20.Damage\");\n      else\n        flavor = this.isHealing ? game.i18n.localize(\"FFD20.HealingCritical\") : game.i18n.localize(\"FFD20.DamageCritical\");\n    }\n\n    // Determine total damage\n    let totalDamage = data.parts.reduce((cur, p) => {\n      return cur + p.amount;\n    }, 0);\n    if (critical) {\n      totalDamage = this.damage.parts.reduce((cur, p) => {\n        return cur + p.amount;\n      }, totalDamage);\n    }\n\n    // Handle minimum damage rule\n    let minimumDamage = false;\n    if (totalDamage < 1) {\n      totalDamage = 1;\n      minimumDamage = true;\n      flavor = game.i18n.localize(\"FFD20.Nonlethal\");\n      this.nonlethal = true;\n    }\n\n    // Handle nonlethal attacks\n    if (this.action.data.nonlethal || this.action.item.system.properties?.nnl) {\n      this.nonlethal = true;\n      flavor = game.i18n.localize(\"FFD20.Nonlethal\");\n    }\n\n    // Finalize data\n    data.flavor = flavor;\n    data.tooltip = tooltips;\n    data.total = totalDamage;\n  }\n\n  addEffectNotes() {\n    if (!this.action.item) return;\n\n    let notes = [];\n    if (this.action.item != null && this.action.item.actor != null) {\n      notes = this.action.item.actor.getContextNotes(\"attacks.effect\").reduce((arr, o) => {\n        for (const n of o.notes) {\n          arr.push(...n.split(/[\\n\\r]+/));\n        }\n        return arr;\n      }, []);\n\n      // Spell specific notes\n      if (this.action.item.type === \"spell\") {\n        this.action.item.actor.getContextNotes(\"spell.effect\").forEach((o) => {\n          for (const n of o.notes) notes.push(...n.split(/[\\n\\r]+/));\n        });\n      }\n    }\n\n    // Add item notes\n    if (this.action.item != null && this.action.item.system.effectNotes) {\n      notes.push(...this.action.item.system.effectNotes);\n    }\n    // Add action notes\n    if (this.action.data.effectNotes) {\n      notes.push(...this.action.data.effectNotes);\n    }\n\n    this.effectNotes = this.effectNotes.concat(notes);\n    this.setEffectNotesHTML();\n  }\n\n  finalize() {\n    this.hasCards = Object.keys(this.cards).length > 0;\n\n    // Determine damage rows for chat cards\n    // this.damageRows = [];\n    for (let a = 0; a < Math.max(this.damage.parts.length, this.critDamage.parts.length); a++) {\n      this.damageRows.push({ normal: null, crit: null });\n    }\n    for (let a = 0; a < this.damage.parts.length; a++) {\n      this.damageRows[a].normal = this.damage.parts[a];\n    }\n    for (let a = 0; a < this.critDamage.parts.length; a++) {\n      this.damageRows[a].crit = this.critDamage.parts[a];\n    }\n\n    return this;\n  }\n}\n\nexport class DamagePart {\n  constructor(amount, damageType, roll, type = \"normal\") {\n    this.amount = amount;\n    this.damageType = damageType ?? \"Untyped\";\n    this.type = type;\n    this.roll = roll;\n  }\n}\n","import { getSkipActionPrompt } from \"../documents/settings.mjs\";\nimport Color from \"color\";\n\n/* -------------------------------------------- */\n\nexport const createCustomChatMessage = async function (\n  chatTemplate,\n  chatTemplateData = {},\n  chatData = {},\n  { rolls = [] } = {}\n) {\n  chatData = mergeObject(\n    {\n      user: game.user.id,\n      type: CONST.CHAT_MESSAGE_TYPES.CHAT,\n    },\n    chatData\n  );\n\n  chatData.content = await renderTemplate(chatTemplate, chatTemplateData);\n\n  // Handle different roll modes\n  ChatMessage.implementation.applyRollMode(chatData, chatData.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\n\n  // Dice So Nice integration\n  if (chatData.roll != null && rolls.length === 0) rolls = [chatData.roll];\n  if (game.dice3d != null && game.dice3d.isEnabled()) {\n    for (const roll of rolls) {\n      await game.dice3d.showForRoll(roll, game.user, false, chatData.whisper, chatData.blind);\n      chatData.sound = null;\n    }\n  }\n\n  return ChatMessage.implementation.create(chatData);\n};\n\nexport const hideRollInfo = function (app, html, data) {\n  const whisper = app.whisper || [];\n  const isBlind = whisper.length && app.blind;\n  const isVisible = whisper.length ? whisper.includes(game.user.id) || (app.isAuthor && !isBlind) : true;\n  if (!isVisible) {\n    html.find(\".dice-formula\").text(\"???\");\n    html.find(\".dice-total\").text(\"?\");\n    html.find(\".dice\").text(\"\");\n    html.find(\".success\").removeClass(\"success\");\n    html.find(\".failure\").removeClass(\"failure\");\n  }\n};\n\n/**\n * Generates an info block containing an item's identified info for GMs\n *\n * @remarks This HTML has to be generated in a synchronous way, as adding to a rendered chat message's content\n *          will cause erratic scrolling behaviour.\n * @param {ChatMessageFFD20IdentifiedInfo} info - An object containing the item's identified info\n * @returns {string} HTML string containing the info block\n */\nconst getIdentifiedBlock = (info) => {\n  const hasCombinedName = info.actionName && !info.actionDescription;\n  return (\n    _templateCache[\"systems/ffd20/templates/chat/parts/gm-description.hbs\"]?.(\n      { ...info, hasCombinedName },\n      { allowProtoMethodsByDefault: true, allowProtoPropertiesByDefault: true }\n    ) ?? \"\"\n  );\n};\n\n/**\n * Add GM-sensitive info for GMs and hide GM-sensitive info for players\n *\n * @param {ChatMessageFFD20} app - The chat message\n * @param {JQuery} html - The chat message's HTML\n * @param {object} data - Data used to render the chat message\n */\nexport const hideGMSensitiveInfo = function (app, html, data) {\n  // Handle adding of GM-sensitive info\n  if (game.user.isGM) {\n    // Show identified info box for GM if item was unidentified when rolled\n    const identifiedInfo = app.flags.ffd20?.identifiedInfo ?? {};\n    const { identified = true } = identifiedInfo;\n    if (!identified && app.hasItemSource) {\n      const cardContent = html.find(\".card-content\");\n      cardContent.append(getIdentifiedBlock(identifiedInfo));\n    }\n    // Return early, as the rest of the function handles removing already existing info\n    return;\n  }\n\n  // Hide info that's always sensitive, no matter the card's owner\n  html.find(\".gm-sensitive-always\").remove();\n\n  // Hide info about unowned tokens\n  html.find(\"[data-gm-sensitive-uuid]\").each((a, elem) => {\n    // Quickly hide element\n    elem = $(elem);\n    elem.hide();\n\n    // Then check for stuff\n    const uuid = elem.data(\"gm-sensitive-uuid\");\n    if (!uuid) return;\n    fromUuid(uuid).then((obj) => {\n      // If token or token document, get actor for testing user permissions\n      if (obj instanceof Token || obj instanceof TokenDocument) obj = obj.actor;\n      //  Show element again, since we have permission\n      if (obj?.testUserPermission && obj.testUserPermission(game.user, \"OBSERVER\")) {\n        elem.show();\n      }\n      // Remove element completely, since we don't have permission\n      else {\n        elem.remove();\n      }\n    });\n  });\n\n  const speaker = app.speaker;\n  let actor = null;\n  if (speaker != null) {\n    if (speaker.token) {\n      actor = game.actors.tokens[speaker.token];\n    }\n    if (!actor) {\n      actor = game.actors.get(speaker.actor);\n    }\n  }\n\n  if (!actor || (actor && actor.testUserPermission(game.user, \"OBSERVER\"))) return;\n\n  // Hide info\n  html.find(\".gm-sensitive\").remove();\n\n  // Alter GM inner texts\n  html.find(\"[data-gm-sensitive-inner]\").each((a, elem) => {\n    if (!game.settings.get(\"ffd20\", \"obscureSaveDCs\") && elem.dataset.action === \"save\") return;\n\n    elem = $(elem);\n    elem.text(elem.data(\"gm-sensitive-inner\"));\n    elem.removeData(\"gm-sensitive-inner\");\n  });\n\n  if (game.settings.get(\"ffd20\", \"obscureInlineRolls\")) {\n    // Turn rolls into raw strings\n    html.find(\".inline-roll\").each((a, elem) => {\n      const roll = Roll.fromJSON(unescape(elem.dataset.roll));\n      const parent = elem.parentNode;\n      parent.insertBefore($(`<span>${roll.total}</span>`)[0], elem);\n      parent.removeChild(elem);\n    });\n  }\n};\n\nexport const addChatCardTitleGradient = async function (app, html, data) {\n  const card = html.find(\".chat-card\")[0];\n  if (!card) return;\n  const actor = await CONFIG.Item.documentClasses.default._getChatCardActor(card);\n  if (!actor) return;\n  const item = actor.items.get(card.dataset.itemId);\n  if (!item) return;\n  const title = $(card).find(\".card-header\");\n  if (!title.length) return;\n\n  title.css(\"background-image\", `linear-gradient(to right, ${item.typeColor}, ${item.typeColor2})`);\n\n  const titleText = title.find(\"h2, h3\");\n  if (Color(item.typeColor).isLight()) titleText.css(\"color\", \"black\");\n  else titleText.css(\"color\", \"white\");\n};\n\nexport const alterAmmoRecovery = function (app, html) {\n  const recoveryData = app.getFlag(\"ffd20\", \"ammoRecovery\");\n  if (!recoveryData) return;\n\n  html.find(\".chat-attack .ammo[data-ammo-id]\").each((a, el) => {\n    const attackIndex = el.closest(\".chat-attack\").dataset.index;\n    const ammoId = el.dataset.ammoId;\n    const data = recoveryData[attackIndex]?.[ammoId];\n    if (!data) return;\n    $(el)\n      .find(\".inline-action\")\n      .each((i, ia) => {\n        // TODO: Disable button & track proper quantities\n        if (data.recovered) ia.classList.add(\"recovered\");\n        if (data.failed) ia.classList.add(\"recovery-failed\");\n      });\n  });\n};\n\nexport const alterTargetDefense = function (app, html) {\n  const defenseData = app.getFlag(\"ffd20\", \"targetDefense\");\n  if (!defenseData) return;\n\n  html.find(\".attack-targets .saving-throws div[data-saving-throw]\").each((a, el) => {\n    const actorUUID = el.closest(\".target\").dataset.uuid;\n    const save = el.dataset.savingThrow;\n    const value = getProperty(defenseData, `${actorUUID}.save.${save}`);\n    if (value == null) return;\n    $(el).find(\".value\").text(value.toString());\n  });\n};\n\nexport const applyAccessibilitySettings = function (app, html, data, conf) {};\n\n/**\n * Returns an inline roll string suitable for chat messages.\n *\n * @param {Roll} roll - The roll to be stringified\n * @param {object} [options] - Additional options affecting the inline roll\n * @param {boolean} [options.hide3d] - Whether the roll should be hidden from DsN\n * @returns {string} The inline roll string\n */\nexport const createInlineRollString = (roll, { hide3d = true } = {}) =>\n  `<a class=\"inline-roll inline-result ${hide3d ? \"inline-dsn-hidden\" : \"\"}\" \\\n  title=\"${roll.formula}\" data-roll=\"${escape(JSON.stringify(roll))}\"> \\\n  <i class=\"fas fa-dice-d20\"></i> ${roll.total}</a>`;\n\nexport const hideInvisibleTargets = async function (app, html) {\n  const targetElems = html.find(\".attack-targets .target\");\n  const targets = targetElems.toArray().reduce((cur, o) => {\n    cur.push({ uuid: o.dataset.uuid, elem: o });\n    return cur;\n  }, []);\n\n  for (const t of targets) {\n    const elem = $(t.elem);\n\n    // Gather token\n    const token = await fromUuid(t.uuid);\n    if (!token) continue;\n    t.token = token.object;\n\n    // Hide if token invisible\n    if (!t.token?.visible) elem.hide();\n    else elem.show();\n  }\n};\n\nexport const addTargetCallbacks = function (app, html) {\n  const targetElems = html.find(\".attack-targets .target[data-uuid]\");\n\n  // Define getter functions\n  const _getTokenByElem = async function (elem) {\n    return (await fromUuid(elem?.dataset.uuid ?? \"\"))?.object;\n  };\n  const _getRootTargetElement = function (elem) {\n    if (elem.dataset.uuid != null) return elem;\n    return elem.closest(\"[data-uuid]\");\n  };\n\n  // Create image callback functions\n  const _mouseEnterCallback = function (event) {\n    _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n      t?._onHoverIn(event, { hoverOutOthers: false });\n    });\n  };\n  const _mouseLeaveCallback = function (event) {\n    _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n      t?._onHoverOut(event);\n    });\n  };\n  const _imageClickCallback = function (event) {\n    event.preventDefault();\n    _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n      if (t?.actor.testUserPermission(game.user, \"OWNER\")) {\n        if (t._controlled) {\n          if (event.shiftKey) t.release();\n        } else {\n          t.control({ releaseOthers: !event.shiftKey });\n        }\n      }\n    });\n  };\n\n  // Add callbacks\n  for (let elem of targetElems) {\n    elem = $(elem);\n\n    // Image element events\n    const imgElem = elem.find(\".target-image\");\n    imgElem.on(\"mouseenter\", _mouseEnterCallback);\n    imgElem.on(\"mouseleave\", _mouseLeaveCallback);\n    imgElem.on(\"click\", _imageClickCallback);\n\n    // Misc element events\n    elem.find(\".ac\").on(\"click\", (event) => {\n      event.preventDefault();\n\n      _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n        if (!t?.actor) return;\n        ffd20.utils.chat.targetACClick(app, html, t.actor, event);\n      });\n    });\n    elem.find(\".saving-throws .click\").on(\"click\", (event) => {\n      event.preventDefault();\n\n      _getTokenByElem(_getRootTargetElement(event.currentTarget)).then((t) => {\n        if (!t?.actor) return;\n        ffd20.utils.chat.targetSavingThrowClick(app, html, t.actor, event);\n      });\n    });\n  }\n};\n\nexport const targetACClick = async function (app, html, actor, event) {\n  actor.rollDefenses({ rollMode: \"selfroll\" });\n};\n\nexport const targetSavingThrowClick = async function (app, html, actor, event) {\n  const elem = event.currentTarget;\n  const save = elem.dataset.savingThrow;\n\n  const message = await actor.rollSavingThrow(save, { event, skipDialog: getSkipActionPrompt() });\n  const total = message?.rolls?.[0]?.total;\n\n  // Replace saving throw value on original chat card's target\n  if (total != null) {\n    const actorUUID = elem.closest(\".target\").dataset.uuid;\n    await app.setFlag(\"ffd20\", \"targetDefense\", { [actorUUID]: { save: { [save]: total } } });\n  }\n};\n","import { createTag, convertDistance } from \"@utils\";\nimport { ChatAttack } from \"./chat-attack.mjs\";\nimport { createCustomChatMessage } from \"@utils/chat.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\nimport { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n// Documentation/type imports\n/** @typedef {import(\"@item/item-ffd20.mjs\").SharedActionData} SharedActionData */\n/** @typedef {import(\"@item/item-ffd20.mjs\").ItemFFD20} ItemFFD20 */\n/** @typedef {import(\"@actor/actor-ffd20.mjs\").ActorFFD20} ActorFFD20 */\n/** @typedef {import(\"@component/action.mjs\").ItemAction} ItemAction */\n\n/**\n * Error states for when an item does not meet the requirements for an attack.\n *\n * @enum {number}\n * @readonly\n */\nexport const ERR_REQUIREMENT = Object.freeze({\n  NO_ACTOR_PERM: 1,\n  DISABLED: 2,\n  INSUFFICIENT_QUANTITY: 3,\n  INSUFFICIENT_CHARGES: 4,\n  MISSING_AMMO: 5,\n  INSUFFICIENT_AMMO: 6,\n});\n\n/**\n *\n */\nexport class ActionUse {\n  /**\n   * The actor this action use is based on.\n   *\n   * @type {ActorFFD20}\n   */\n  actor;\n  /**\n   * The item this action use is based on.\n   *\n   * @type {ItemFFD20}\n   */\n  item;\n  /**\n   * The action this action use is based on.\n   *\n   * @type {ItemAction}\n   */\n  action;\n  /**\n   * The shared data object holding all relevant data for this action use.\n   *\n   * @type {SharedActionData}\n   */\n  shared;\n\n  /**\n   * @param {Partial<SharedActionData>} [shared={}] - The shared context for this action use\n   */\n  constructor(shared = {}) {\n    Object.defineProperties(this, {\n      shared: { value: shared },\n      item: { value: shared.item },\n      action: { value: shared.action },\n      actor: { value: shared.item.parentActor },\n    });\n  }\n\n  /**\n   * @returns {Promise<number>} - 0 when successful, otherwise one of the ERR_REQUIREMENT constants.\n   */\n  checkRequirements() {\n    const actor = this.item.parentActor;\n    if (actor && !actor.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(actor.name);\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.NO_ACTOR_PERM;\n    }\n\n    if (this.item.type === \"feat\" && this.item.system.disabled) {\n      const msg = game.i18n.localize(\"FFD20.ErrorFeatDisabled\");\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.DISABLED;\n    }\n\n    const itemQuantity = getProperty(this, \"system.quantity\");\n    if (itemQuantity != null && itemQuantity <= 0) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoQuantity\");\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.INSUFFICIENT_QUANTITY;\n    }\n\n    if (this.item.isCharged && this.item.charges < this.shared.chargeCost) {\n      const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(this.item.name);\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.INSUFFICIENT_CHARGES;\n    }\n\n    if (this.action.isSelfCharged && this.action.data.uses.self?.value < 1) {\n      const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(`${this.item.name}: ${this.action.name}`);\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.INSUFFICIENT_CHARGES;\n    }\n\n    return 0;\n  }\n\n  /**\n   * @returns {object} The roll data object for this attack.\n   */\n  getRollData() {\n    const rollData = duplicate(this.shared.action.getRollData());\n    rollData.d20 = this.shared.dice !== \"1d20\" ? this.shared.dice : \"\";\n\n    return rollData;\n  }\n\n  /**\n   * Creates and renders an attack roll dialog, and returns a result.\n   *\n   * @returns {ItemAttack_Dialog_Result|boolean}\n   */\n  createAttackDialog() {\n    const dialog = new ffd20.applications.AttackDialog(this.shared.action, this.shared.rollData);\n    return dialog.show();\n  }\n\n  /**\n   * Alters roll (and shared) data based on user input during the attack's dialog.\n   *\n   * @param {JQuery | object} form - The attack dialog's jQuery form data or FormData object\n   */\n  alterRollData(form = {}) {\n    let formData;\n    if (form instanceof jQuery) formData = new FormDataExtended(form[0].querySelector(\"form\")).object;\n    else formData = form;\n    if (formData[\"d20\"]) this.shared.rollData.d20 = formData[\"d20\"];\n    const atkBonus = formData[\"attack-bonus\"];\n    if (atkBonus) {\n      this.shared.attackBonus.push(atkBonus);\n    }\n    const dmgBonus = formData[\"damage-bonus\"];\n    if (dmgBonus) {\n      this.shared.damageBonus.push(dmgBonus);\n    }\n    this.shared.rollMode = formData[\"rollMode\"] ?? game.settings.get(\"core\", \"rollMode\");\n\n    // Point-Blank Shot\n    if (formData[\"point-blank-shot\"]) {\n      this.shared.attackBonus.push(`1[${game.i18n.localize(\"FFD20.PointBlankShot\")}]`);\n      this.shared.damageBonus.push(`1[${game.i18n.localize(\"FFD20.PointBlankShot\")}]`);\n      this.shared.pointBlankShot = true;\n    }\n\n    // Many-shot\n    if (this.shared.fullAttack && formData[\"manyshot\"]) {\n      this.shared.manyShot = true;\n    }\n\n    // Rapid Shot\n    if (this.shared.fullAttack && formData[\"rapid-shot\"]) {\n      this.shared.attackBonus.push(`-2[${game.i18n.localize(\"FFD20.RapidShot\")}]`);\n    }\n\n    // Primary attack\n    if (formData[\"primary-attack\"] != null)\n      setProperty(this.shared.rollData, \"action.naturalAttack.primaryAttack\", formData[\"primary-attack\"]);\n\n    // Use measure template\n    if (formData[\"measure-template\"] != null) this.shared.useMeasureTemplate = formData[\"measure-template\"];\n\n    // Set held type\n    setProperty(this.shared.rollData, \"item.held\", formData[\"held\"] ?? \"normal\");\n\n    // Damage multiplier\n    if (formData[\"damage-ability-multiplier\"] != null)\n      this.shared.rollData.action.ability.damageMult = formData[\"damage-ability-multiplier\"];\n\n    // Power Attack\n    if (formData[\"power-attack\"]) {\n      const basePowerAttackBonus = this.shared.rollData.action?.powerAttack?.damageBonus ?? 2;\n      let powerAttackBonus = (1 + Math.floor(this.shared.rollData.attributes.bab.total / 4)) * basePowerAttackBonus;\n\n      // Get multiplier\n      let powerAttackMultiplier = this.shared.rollData.item?.powerAttack?.multiplier;\n      if (!powerAttackMultiplier) {\n        powerAttackMultiplier = 1;\n        if (this.item.system.attackType === \"natural\") {\n          if (this.shared.rollData.action?.naturalAttack.primaryAttack)\n            powerAttackMultiplier = this.shared.rollData.action.ability?.damageMult;\n          else {\n            powerAttackMultiplier = this.shared.rollData.action.naturalAttack?.secondary?.damageMult ?? 0.5;\n          }\n        } else {\n          if (this.shared.rollData?.item?.held === \"2h\") powerAttackMultiplier = 1.5;\n          else if (this.shared.rollData?.item?.held === \"oh\") powerAttackMultiplier = 0.5;\n        }\n      } else {\n        powerAttackMultiplier = parseFloat(powerAttackMultiplier);\n      }\n\n      // Apply multiplier\n      powerAttackBonus = Math.floor(powerAttackBonus * powerAttackMultiplier);\n\n      // Get label\n      const label = [\"rwak\", \"rsak\"].includes(this.action.data.actionType)\n        ? game.i18n.localize(\"FFD20.DeadlyAim\")\n        : game.i18n.localize(\"FFD20.PowerAttack\");\n\n      // Get penalty\n      const powerAttackPenalty = -(1 + Math.floor(getProperty(this.shared.rollData, \"attributes.bab.total\") / 4));\n\n      // Add bonuses\n      this.shared.rollData.powerAttackPenalty = powerAttackPenalty;\n      this.shared.attackBonus.push(`${powerAttackPenalty}[${label}]`);\n      this.shared.powerAttack = true;\n      this.shared.rollData.powerAttackBonus = powerAttackBonus;\n      this.shared.rollData.powerAttackPenalty = powerAttackPenalty;\n    } else {\n      this.shared.rollData.powerAttackBonus = 0;\n      this.shared.rollData.powerAttackPenalty = 0;\n    }\n\n    // Conditionals\n    Object.keys(formData).forEach((f) => {\n      const idx = f.match(/conditional\\.(\\d+)/)?.[1];\n      if (idx && formData[f]) {\n        if (!this.shared.conditionals) this.shared.conditionals = [parseInt(idx)];\n        else this.shared.conditionals.push(parseInt(idx));\n      }\n    });\n\n    // Apply secondary attack penalties\n    if (\n      this.shared.rollData.item.attackType === \"natural\" &&\n      this.shared.rollData.action?.naturalAttack.primaryAttack === false\n    ) {\n      const attackBonus = this.shared.rollData.action.naturalAttack?.secondary?.attackBonus || \"-5\";\n      const damageMult = this.shared.rollData.action.naturalAttack?.secondary?.damageMult ?? 0.5;\n      this.shared.attackBonus.push(`(${attackBonus})[${game.i18n.localize(\"FFD20.SecondaryAttack\")}]`);\n      this.shared.rollData.action.ability.damageMult = damageMult;\n    }\n\n    // CL check enabled\n    this.shared.casterLevelCheck = formData[\"cl-check\"];\n\n    // Concentration enabled\n    this.shared.concentrationCheck = formData[\"concentration\"];\n\n    // Conditional defaults for fast-forwarding\n    if (!this.shared.conditionals && foundry.utils.isEmpty(formData)) {\n      this.shared.conditionals = this.shared.action.data.conditionals?.reduce((arr, con, i) => {\n        if (con.default) arr.push(i);\n        return arr;\n      }, []);\n    }\n  }\n\n  /**\n   * @typedef {object} ItemAttack_AttackData\n   * @property {string} label - The attack's name\n   * @property {number|string|undefined} [attackBonus] - An attack bonus specific to this attack\n   * @property {number|string|undefined} [damageBonus] - A damage bonus specific to this attack\n   * @property {string|null} [ammo] - The ID of the ammo item used\n   */\n  /**\n   * Generates attacks for an item's action.\n   *\n   * @param {boolean} [forceFullAttack=false] - Generate full attack data, e.g. as base data for an {@link AttackDialog}\n   * @returns {Promise<ItemAttack_AttackData[]> | ItemAttack_AttackData[]} The generated default attacks.\n   */\n  generateAttacks(forceFullAttack = false) {\n    const rollData = this.shared.rollData;\n    const action = rollData.action;\n\n    /**\n     * Counter for unnamed or other numbered attacks, to be incremented with each usage.\n     * Starts at 1 to account for the base attack.\n     */\n    let unnamedAttackIndex = 1;\n\n    const attackName = action.attackName || game.i18n.format(\"FFD20.FormulaAttack\", { 0: unnamedAttackIndex });\n    // Use either natural fullAttack state, or force generation of all attacks via override\n    const fullAttack = forceFullAttack || this.shared.fullAttack;\n\n    const allAttacks = fullAttack\n      ? action.attackParts.reduce(\n          (cur, r) => {\n            cur.push({\n              attackBonus: r[0],\n              // Use defined label, or fall back to continuously numbered default attack name\n              label: r[1] || game.i18n.format(\"FFD20.FormulaAttack\", { 0: (unnamedAttackIndex += 1) }),\n            });\n            return cur;\n          },\n          [{ attackBonus: \"\", label: attackName }]\n        )\n      : [{ attackBonus: \"\", label: attackName }];\n\n    // Formulaic extra attacks\n    if (fullAttack) {\n      const exAtkCountFormula = action.formulaicAttacks?.count?.formula,\n        exAtkCount = RollFFD20.safeRoll(exAtkCountFormula, rollData)?.total ?? 0,\n        exAtkBonusFormula = action.formulaicAttacks?.bonus?.formula || \"0\";\n      if (exAtkCount > 0) {\n        try {\n          for (let i = 0; i < exAtkCount; i++) {\n            rollData[\"formulaicAttack\"] = i + 1; // Add and update attack counter\n            const bonus = RollFFD20.safeRoll(exAtkBonusFormula, rollData).total;\n            allAttacks.push({\n              attackBonus: `(${bonus})[${game.i18n.localize(\"FFD20.Iterative\")}]`,\n              // If formulaic attacks have a non-default name, number them with their own counter; otherwise, continue unnamed attack numbering\n              label: action.formulaicAttacks.label\n                ? action.formulaicAttacks.label.format(i + 1)\n                : game.i18n.format(\"FFD20.FormulaAttack\", { 0: (unnamedAttackIndex += 1) }),\n            });\n          }\n        } catch (err) {\n          console.error(err);\n        }\n      }\n    }\n\n    // Set ammo usage\n    if (action.usesAmmo) {\n      const ammoId = this.item.getFlag(\"ffd20\", \"defaultAmmo\");\n      const item = this.item.actor.items.get(ammoId);\n      const quantity = item?.system.quantity ?? 0;\n      const abundant = item?.flags.ffd20?.abundant;\n      for (let a = 0; a < allAttacks.length; a++) {\n        const atk = allAttacks[a];\n        if (abundant || quantity >= a + 1) atk.ammo = ammoId;\n        else atk.ammo = null;\n      }\n    }\n\n    return allAttacks;\n  }\n\n  /**\n   * Subtracts ammo for this attack.\n   *\n   * @param {number} [value=1] - How much ammo to subtract.\n   * @returns {Promise}\n   */\n  async subtractAmmo(value = 1) {\n    if (!this.shared.action.data.usesAmmo) return;\n\n    const ammoUsage = {};\n    for (const atk of this.shared.attacks) {\n      if (atk.ammo) {\n        const item = this.item.actor.items.get(atk.ammo);\n        // Don't remove abundant ammunition\n        if (item.flags?.ffd20?.abundant) continue;\n\n        if (!ammoUsage[atk.ammo]) ammoUsage[atk.ammo] = 1;\n        else ammoUsage[atk.ammo]++;\n      }\n    }\n\n    if (!foundry.utils.isEmpty(ammoUsage)) {\n      const updateData = Object.entries(ammoUsage).reduce((cur, o) => {\n        const currentValue = this.item.actor.items.get(o[0]).system.quantity;\n        const obj = {\n          _id: o[0],\n          \"system.quantity\": currentValue - o[1],\n        };\n\n        cur.push(obj);\n        return cur;\n      }, []);\n\n      return this.item.actor.updateEmbeddedDocuments(\"Item\", updateData);\n    }\n  }\n\n  /**\n   */\n  handleConditionals() {\n    if (this.shared.conditionals) {\n      const conditionalData = {};\n      for (const i of this.shared.conditionals) {\n        const conditional = this.shared.action.data.conditionals[i];\n        const tag = createTag(conditional.name);\n        for (const [i, modifier] of conditional.modifiers.entries()) {\n          // Adds a formula's result to rollData to allow referencing it.\n          // Due to being its own roll, this will only correctly work for static formulae.\n          const conditionalRoll = RollFFD20.safeRoll(modifier.formula, this.shared.rollData);\n          if (conditionalRoll.err) {\n            const msg = game.i18n.format(\"FFD20.WarningConditionalRoll\", { number: i + 1, name: conditional.name });\n            console.warn(msg);\n            ui.notifications.warn(msg);\n            // Skip modifier to avoid multiple errors from one non-evaluating entry\n            continue;\n          } else conditionalData[[tag, i].join(\".\")] = RollFFD20.safeRoll(modifier.formula, this.shared.rollData).total;\n\n          // Create a key string for the formula array\n          const partString = `${modifier.target}.${modifier.subTarget}${\n            modifier.critical ? \".\" + modifier.critical : \"\"\n          }`;\n          // Add formula in simple format\n          if ([\"attack\", \"effect\", \"misc\"].includes(modifier.target)) {\n            const hasFlavor = /\\[.*\\]/.test(modifier.formula);\n            const flavoredFormula = hasFlavor ? modifier.formula : `(${modifier.formula})[${conditional.name}]`;\n            this.shared.conditionalPartsCommon[partString] = [\n              ...(this.shared.conditionalPartsCommon[partString] ?? []),\n              flavoredFormula,\n            ];\n          }\n          // Add formula as array for damage\n          else if (modifier.target === \"damage\") {\n            this.shared.conditionalPartsCommon[partString] = [\n              ...(this.shared.conditionalPartsCommon[partString] ?? []),\n              [modifier.formula, modifier.damageType, false],\n            ];\n          }\n          // Add formula to the size property\n          else if (modifier.target === \"size\") {\n            this.shared.rollData.size += conditionalRoll.total;\n          }\n        }\n      }\n      // Expand data into rollData to enable referencing in formulae\n      this.shared.rollData.conditionals = expandObject(conditionalData, 5);\n\n      // Add specific pre-rolled rollData entries\n      for (const target of [\"effect.cl\", \"effect.dc\", \"misc.charges\"]) {\n        if (this.shared.conditionalPartsCommon[target] != null) {\n          const formula = this.shared.conditionalPartsCommon[target].join(\"+\");\n          const roll = RollFFD20.safeRoll(formula, this.shared.rollData, [target, formula]).total;\n          switch (target) {\n            case \"effect.cl\":\n              this.shared.rollData.cl += roll;\n              break;\n            case \"effect.dc\":\n              this.shared.rollData.dcBonus = roll;\n              break;\n            case \"misc.charges\":\n              this.shared.rollData.chargeCostBonus = roll;\n              break;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Checks all requirements to make the attack. This is after the attack dialog's data has been parsed.\n   *\n   * @returns {Promise<number> | number} 0 if successful, otherwise one of the ERR_REQUIREMENT constants.\n   */\n  checkAttackRequirements() {\n    // Enforce zero charge cost on cantrips/orisons, but make sure they have at least 1 charge\n    if (\n      this.item.type === \"spell\" &&\n      !this.item.useSpellPoints() &&\n      this.shared.rollData.item?.level === 0 &&\n      this.shared.rollData.item?.preparation?.preparedAmount > 0\n    ) {\n      this.shared.rollData.chargeCost = 0;\n      return 0;\n    }\n\n    // Determine charge cost\n    let cost = 0;\n    if (this.shared.action.isCharged) {\n      cost = this.shared.action.getChargeCost({ rollData: this.shared.rollData });\n      let uses = this.item.charges;\n      if (this.item.type === \"spell\") {\n        if (this.item.useSpellPoints()) {\n          uses = this.item.getSpellUses();\n        }\n      }\n      // Add charge cost from conditional modifiers\n      cost += this.shared.rollData[\"chargeCostBonus\"] ?? 0;\n\n      // Cancel usage on insufficient charges\n      if (cost > uses) {\n        const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(this.item.name);\n        console.warn(msg);\n        ui.notifications.warn(msg);\n        return ERR_REQUIREMENT.INSUFFICIENT_CHARGES;\n      }\n    }\n\n    // Save chargeCost as rollData entry for following formulae\n    this.shared.rollData.chargeCost = cost;\n\n    return 0;\n  }\n\n  /**\n   * Generates ChatAttack entries based off the attack type.\n   */\n  async generateChatAttacks() {\n    // Normal attack(s)\n    if (this.shared.action.hasAttack) await this.addAttacks();\n    // Damage only\n    else if (this.shared.action.hasDamage) await this.addDamage();\n    // Effect notes only\n    else await this.addEffectNotes();\n\n    // Add attack cards\n    this.shared.attacks.forEach((attack) => {\n      if (!attack.ammo) return;\n      const atk = attack.chatAttack;\n      if (atk) atk.setAmmo(attack.ammo);\n    });\n\n    // Add save info\n    this.shared.save = this.shared.action.data.save.type;\n    this.shared.saveDC = this.shared.action.getDC(this.shared.rollData);\n  }\n\n  /**\n   * Determines conditional parts used in a specific attack.\n   *\n   * @param {object} atk - The attack used.\n   * @param {number} [index=0] - The index of the attack, in order of enabled attacks.\n   * @returns {object} The conditional parts used.\n   */\n  _getConditionalParts(atk, { index = 0 }) {\n    const result = {};\n\n    const conditionalTemplates = {\n      \"attack.normal\": \"attack.;id;.normal\",\n      \"attack.crit\": \"attack.;id;.crit\",\n      \"damage.normal\": \"damage.;id;.normal\",\n      \"damage.crit\": \"damage.;id;.crit\",\n      \"damage.nonCrit\": \"damage.;id;.nonCrit\",\n    };\n    const addPart = (id) => {\n      for (const [templateKey, templateStr] of Object.entries(conditionalTemplates)) {\n        if (!result[templateKey]) result[templateKey] = [];\n\n        const parsedStr = templateStr.replace(\";id;\", id);\n        result[templateKey].push(...(this.shared.conditionalPartsCommon[parsedStr] ?? []));\n      }\n    };\n\n    addPart(`attack_${index}`);\n    addPart(\"allAttack\");\n    addPart(\"allDamage\");\n\n    if (atk.id === \"rapid-shot\") {\n      addPart(\"rapidShotAttack\");\n      addPart(\"rapidShotDamage\");\n    } else if (atk.id === \"haste-attack\") {\n      addPart(\"hasteAttack\");\n      addPart(\"hasteDamage\");\n    }\n\n    return result;\n  }\n\n  /**\n   * Adds ChatAttack entries to an attack's shared context.\n   */\n  async addAttacks() {\n    for (let a = 0; a < this.shared.attacks.length; a++) {\n      const atk = this.shared.attacks[a];\n\n      // Combine conditional modifiers for attack and damage\n      const conditionalParts = this._getConditionalParts(atk, { index: a });\n\n      this.shared.rollData.attackCount = a;\n\n      // Create attack object\n      const attack = new ChatAttack(this.shared.action, {\n        label: atk.label,\n        rollData: this.shared.rollData,\n        targets: game.user.targets,\n      });\n\n      if (atk.id !== \"manyshot\") {\n        // Add attack roll\n        await attack.addAttack({\n          extraParts: duplicate(this.shared.attackBonus).concat([atk.attackBonus]),\n          conditionalParts,\n        });\n      }\n\n      // Add damage\n      if (this.shared.action.hasDamage) {\n        const extraParts = duplicate(this.shared.damageBonus);\n        const nonCritParts = [];\n        const critParts = [];\n\n        // Add power attack bonus\n        if (this.shared.rollData.powerAttackBonus > 0) {\n          // Get label\n          const label = [\"rwak\", \"rsak\"].includes(this.shared.action.data.actionType)\n            ? game.i18n.localize(\"FFD20.DeadlyAim\")\n            : game.i18n.localize(\"FFD20.PowerAttack\");\n\n          const powerAttackBonus = this.shared.rollData.powerAttackBonus;\n          const powerAttackCritBonus = powerAttackBonus * (this.shared.rollData.item?.powerAttack?.critMultiplier ?? 1);\n          nonCritParts.push(`${powerAttackBonus}[${label}]`);\n          critParts.push(`${powerAttackCritBonus}[${label}]`);\n        }\n\n        // Add damage\n        let flavor = null;\n        if (atk.id === \"manyshot\") flavor = game.i18n.localize(\"FFD20.Manyshot\");\n        await attack.addDamage({\n          flavor,\n          extraParts: [...extraParts, ...nonCritParts],\n          critical: false,\n          conditionalParts,\n        });\n\n        // Add critical hit damage\n        if (attack.hasCritConfirm) {\n          await attack.addDamage({ extraParts: [...extraParts, ...critParts], critical: true, conditionalParts });\n        }\n      }\n\n      // Add attack notes\n      if (a === 0) attack.addAttackNotes();\n\n      // Add effect notes\n      if (atk.id !== \"manyshot\") {\n        attack.addEffectNotes();\n      }\n\n      // Add to list\n      this.shared.chatAttacks.push(attack);\n\n      // Add a reference to the attack that created this chat attack\n      atk.chatAttack = attack;\n    }\n\n    // Cleanup rollData\n    delete this.shared.rollData.attackCount;\n  }\n\n  /**\n   * Adds a ChatAttack entry for damage to an attack's shared context.\n   */\n  async addDamage() {\n    // Set conditional modifiers\n    this.shared.conditionalParts = {\n      \"damage.normal\": this.shared.conditionalPartsCommon[\"damage.allDamage.normal\"] ?? [],\n    };\n\n    const attack = new ChatAttack(this.shared.action, {\n      rollData: this.shared.rollData,\n      primaryAttack: this.shared.primaryAttack,\n    });\n    // Add damage\n    await attack.addDamage({\n      extraParts: duplicate(this.shared.damageBonus),\n      critical: false,\n      conditionalParts: this.shared.conditionalParts,\n    });\n\n    // Add effect notes\n    attack.addEffectNotes();\n\n    // Add to list\n    this.shared.chatAttacks.push(attack);\n  }\n\n  /**\n   * Adds a ChatAttack entry for effect notes to an attack's shared context.\n   */\n  addEffectNotes() {\n    const attack = new ChatAttack(this.shared.action, {\n      rollData: this.shared.rollData,\n      primaryAttack: this.shared.primaryAttack,\n    });\n\n    // Add effect notes\n    attack.addEffectNotes();\n\n    // Add to list\n    this.shared.chatAttacks.push(attack);\n  }\n\n  /**\n   * @typedef {object} Attack_MeasureTemplateResult\n   * @property {boolean} result - Whether an area was selected.\n   * @property {Function} [place] - Function to place the template, if an area was selected.\n   * @property {Function} [delete] - Function to delete the template, if it has been placed.\n   */\n  /**\n   * Prompts the user for an area, based on the attack's measure template.\n   *\n   * @returns {Promise.<Attack_MeasureTemplateResult>} Whether an area was selected.\n   */\n  async promptMeasureTemplate() {\n    // Determine size\n    let dist = this.shared.action.data.measureTemplate.size;\n    if (typeof dist === \"string\") {\n      dist = RollFFD20.safeRoll(this.shared.action.data.measureTemplate.size, this.shared.rollData).total;\n    }\n    dist = convertDistance(dist)[0];\n\n    // Create data object\n    const templateOptions = {\n      type: this.shared.action.data.measureTemplate.type,\n      distance: dist,\n    };\n    if (this.shared.action.data.measureTemplate.overrideColor) {\n      templateOptions.color = this.shared.action.data.measureTemplate.customColor;\n    }\n    if (this.shared.action.data.measureTemplate.overrideTexture) {\n      templateOptions.texture = this.shared.action.data.measureTemplate.customTexture;\n    }\n\n    // Create template\n    this.shared.template = null;\n    const template = ffd20.canvas.AbilityTemplate.fromData(templateOptions);\n    let result;\n    if (template) {\n      const sheetRendered = this.item.parent?.sheet?._element != null;\n      if (sheetRendered) this.item.parent.sheet.minimize();\n      result = await template.drawPreview(this.shared.event);\n      if (!result.result) {\n        if (sheetRendered) this.item.parent.sheet.maximize();\n        return result;\n      }\n    }\n\n    this.shared.template = await result.place();\n    return result;\n  }\n\n  /**\n   * Handles Dice So Nice integration.\n   */\n  async handleDiceSoNice() {\n    if (game.dice3d != null && game.dice3d.isEnabled()) {\n      // Use try to make sure a chat card is rendered even if DsN fails\n      try {\n        // Define common visibility options for whole attack\n        const chatData = {};\n        ChatMessage.applyRollMode(chatData, this.shared.rollMode);\n\n        const mergeRolls = game.settings.get(\"dice-so-nice\", \"enabledSimultaneousRolls\");\n        const skipRolls = game.settings.get(\"dice-so-nice\", \"immediatelyDisplayChatMessages\");\n\n        /**\n         * Visually roll dice\n         *\n         * @async\n         * @param {PoolTerm[]} pools - An array of PoolTerms to be rolled together\n         * @returns {Promise} A Promise that is resolved when all rolls have been displayed\n         */\n        const showRoll = async (pools) => {\n          const whisper = chatData.whisper?.length ? chatData.whisper : undefined; // DSN does not like empty array for whisper\n          if (mergeRolls) {\n            return Promise.all(\n              pools.map((pool) => game.dice3d.showForRoll(pool, game.user, true, whisper, chatData.blind))\n            );\n          } else {\n            for (const pool of pools) {\n              await game.dice3d.showForRoll(pool, game.user, true, whisper, chatData.blind);\n            }\n          }\n        };\n\n        /** @type {PoolTerm[]} */\n        const pools = [];\n\n        for (const atk of this.shared.chatAttacks) {\n          // Create PoolTerm for attack and damage rolls\n          const attackPool = new PoolTerm();\n          if (atk.attack.roll) attackPool.rolls.push(atk.attack.roll);\n          attackPool.rolls.push(...(atk.damage?.rolls?.map((dmgRoll) => dmgRoll.roll) ?? []));\n\n          // Create PoolTerm for crit confirmation and crit damage rolls\n          const critPool = new PoolTerm();\n          if (atk.hasCritConfirm) critPool.rolls.push(atk.critConfirm.roll);\n          critPool.rolls.push(...(atk.critDamage?.rolls?.map((dmgRoll) => dmgRoll.roll) ?? []));\n\n          // Add non-empty pools to the array of rolls to be displayed\n          if (attackPool.rolls.length) pools.push(attackPool);\n          if (critPool.rolls.length) pools.push(critPool);\n        }\n\n        if (pools.length) {\n          // Chat card is to be shown immediately\n          if (skipRolls) showRoll(pools);\n          // Wait for rolls to finish before showing the chat card\n          else await showRoll(pools);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }\n\n  /**\n   * Adds an attack's chat card data to the shared object.\n   */\n  getMessageData() {\n    if (this.shared.chatAttacks.length === 0) return;\n\n    // Create chat template data\n    this.shared.templateData = {\n      action: this.shared.action,\n      name: this.item.name,\n      type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n      rollMode: this.shared.rollMode,\n      attacks: this.shared.chatAttacks.map((o) => o.finalize()),\n    };\n\n    // Set chat data\n    this.shared.chatData = {\n      speaker: ChatMessage.getSpeaker({ actor: this.item.parent }),\n      rollMode: this.shared.rollMode,\n    };\n\n    // Set attack sound\n    if (this.shared.action.data.soundEffect) this.shared.chatData.sound = this.shared.action.data.soundEffect;\n    // Set dice sound if neither attack sound nor Dice so Nice are available\n    else if (game.dice3d == null || !game.dice3d.isEnabled()) this.shared.chatData.sound = CONFIG.sounds.dice;\n\n    // Get extra text\n    const props = [];\n    let extraText = \"\";\n    if (this.shared.templateData.attacks.length > 0) extraText = this.shared.templateData.attacks[0].attackNotesHTML;\n\n    const itemChatData = this.item.getChatData({ rollData: this.shared.rollData }, { actionId: this.shared.action.id });\n\n    // Get properties\n    const properties = [...itemChatData.properties, ...this.addGenericPropertyLabels()];\n    if (properties.length > 0) props.push({ header: game.i18n.localize(\"FFD20.InfoShort\"), value: properties });\n\n    // Get combat properties\n    if (game.combat) {\n      const combatProps = this.addCombatPropertyLabels();\n\n      if (combatProps.length > 0) {\n        props.push({ header: game.i18n.localize(\"FFD20.CombatInfo_Header\"), value: combatProps });\n      }\n    }\n\n    // Add CL notes\n    if (this.item.type === \"spell\" && this.item.parent) {\n      const clNotes = this.item.parent.getContextNotesParsed(`spell.cl.${this.item.system.spellbook}`);\n\n      if (clNotes.length) {\n        props.push({\n          header: game.i18n.localize(\"FFD20.CLNotes\"),\n          value: clNotes,\n        });\n      }\n    }\n\n    // Parse template data\n    const token =\n      this.item.parentActor?.token ??\n      canvas.tokens?.placeables.find((t) => t.actor && t.actor.id === this.item.parentActor?.id);\n    const identified = Boolean(this.shared.rollData.item?.identified ?? true);\n    const name = identified\n      ? `${this.shared.rollData.item.identifiedName || this.item.name} (${this.shared.action.name})`\n      : this.shared.rollData.item.unidentified?.name || this.item.name;\n    this.shared.templateData = mergeObject(\n      this.shared.templateData,\n      {\n        tokenUuid: token ? token.document?.uuid ?? token.uuid : null,\n        actionId: this.shared.action?.id,\n        extraText: extraText,\n        identified: identified,\n        name: name,\n        description: identified ? this.item.fullDescription : itemChatData.unidentifiedDescription,\n        actionDescription: itemChatData.actionDescription,\n        hasExtraText: extraText.length > 0,\n        properties: props,\n        hasProperties: props.length > 0,\n        item: this.item.toObject(),\n        actor: this.item.parentActor,\n        hasSave: this.shared.action.hasSave,\n        rollData: this.shared.rollData,\n        save: {\n          dc: this.shared.saveDC,\n          type: this.shared.save,\n          label: game.i18n.format(\"FFD20.SavingThrowButtonLabel\", {\n            0: CONFIG.FFD20.savingThrows[this.shared.save],\n            1: this.shared.saveDC.toString(),\n          }),\n          gmSensitiveLabel: game.i18n.format(\"FFD20.SavingThrowButtonLabelGMSensitive\", {\n            save: CONFIG.FFD20.savingThrows[this.shared.save],\n          }),\n        },\n      },\n      { inplace: false }\n    );\n\n    // Add range info\n    {\n      const range = this.shared.action.getRange({ type: \"max\", rollData: this.shared.rollData });\n      if (range != null) {\n        this.shared.templateData.range = range;\n        let usystem = game.settings.get(\"ffd20\", \"distanceUnits\"); // override\n        if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n        this.shared.templateData.rangeLabel = usystem === \"metric\" ? `${range} m` : `${range} ft.`;\n\n        const rangeUnits = this.shared.action.data.range.units;\n        if ([\"melee\", \"touch\", \"reach\", \"close\", \"medium\", \"long\"].includes(rangeUnits)) {\n          this.shared.templateData.rangeLabel = CONFIG.FFD20.distanceUnits[rangeUnits];\n        }\n      }\n    }\n\n    // Add spell info\n    if (this.item.type === \"spell\" && this.item.parent != null) {\n      // Spell failure\n      if (this.item.parent.spellFailure > 0 && this.item.system.components.somatic) {\n        const spellbook = getProperty(\n          this.item.parentActor,\n          `system.attributes.spells.spellbooks.${this.item.system.spellbook}`\n        );\n        if (spellbook && spellbook.arcaneSpellFailure) {\n          const roll = RollFFD20.safeRoll(\"1d100\");\n          this.shared.templateData.spellFailure = roll.total;\n          this.shared.templateData.spellFailureRoll = roll;\n          this.shared.templateData.spellFailureSuccess =\n            this.shared.templateData.spellFailure > this.item.parentActor.spellFailure;\n        }\n      }\n      // Caster Level Check\n      this.shared.templateData.casterLevelCheck = this.shared.casterLevelCheck;\n      // Concentration check\n      this.shared.templateData.concentrationCheck = this.shared.concentrationCheck;\n    }\n\n    // Generate metadata\n    const metadata = this.generateChatMetadata();\n\n    // Get target info\n    if (!game.settings.get(\"ffd20\", \"disableAttackCardTargets\")) {\n      const targets = metadata.targets?.length\n        ? metadata.targets.map((o) => canvas.tokens.get(o)).filter((o) => o != null)\n        : [];\n      if (targets.length) {\n        this.shared.templateData.targets = targets.map((o) => {\n          return {\n            actorData: o.actor?.toObject(false),\n            tokenData: o.document?.toObject(false),\n            uuid: o.document.uuid,\n          };\n        });\n      }\n    }\n\n    this.shared.chatData[\"flags.ffd20.metadata\"] = metadata;\n    this.shared.chatData[\"flags.core.canPopout\"] = true;\n    if (!identified)\n      this.shared.chatData[\"flags.ffd20.identifiedInfo\"] = {\n        identified,\n        name: this.item.name,\n        description: itemChatData.identifiedDescription,\n        actionName: this.shared.action.name,\n        actionDescription: itemChatData.actionDescription,\n      };\n  }\n\n  /**\n   * Adds generic property labels to an attack's chat card.\n   *\n   * @returns {string[]} The resulting property labels.\n   */\n  addGenericPropertyLabels() {\n    const properties = [];\n\n    // Add actual cost\n    const cost = this.shared.rollData.chargeCost;\n    if (cost && !this.item.system.atWill) {\n      if (this.item.type === \"spell\" && this.item.useSpellPoints()) {\n        properties.push(`${game.i18n.localize(\"FFD20.SpellPointsCost\")}: ${cost}`);\n      } else {\n        properties.push(`${game.i18n.localize(\"FFD20.ChargeCost\")}: ${cost}`);\n      }\n    }\n\n    // Add info for broken state\n    if (this.item.system.broken) {\n      properties.push(game.i18n.localize(\"FFD20.Broken\"));\n    }\n\n    // Nonlethal\n    if (this.item.system.nonlethal) properties.push(game.i18n.localize(\"FFD20.Nonlethal\"));\n\n    // Add info for Power Attack to melee, Deadly Aim to ranged attacks\n    if (this.shared.powerAttack) {\n      if (this.action.data.actionType === \"rwak\") properties.push(game.i18n.localize(\"FFD20.DeadlyAim\"));\n      if (this.action.data.actionType === \"mwak\") properties.push(game.i18n.localize(\"FFD20.PowerAttack\"));\n    }\n\n    // Add info for Point-Blank shot\n    if (this.shared.pointBlankShot) properties.push(game.i18n.localize(\"FFD20.PointBlankShot\"));\n\n    // Add info for Rapid Shot\n    if (this.shared.attacks.find((o) => o.id === \"rapid-shot\")) properties.push(game.i18n.localize(\"FFD20.RapidShot\"));\n\n    if (this.shared.manyShot) properties.push(game.i18n.localize(\"FFD20.Manyshot\"));\n\n    // Add Armor Check Penalty's application to attack rolls info\n    if (this.item.hasAttack && this.shared.rollData.attributes.acp.attackPenalty > 0)\n      properties.push(game.i18n.localize(\"FFD20.ArmorCheckPenalty\"));\n\n    // Add conditionals info\n    if (this.shared.conditionals?.length) {\n      this.shared.conditionals.forEach((c) => {\n        properties.push(this.shared.action.data.conditionals[c].name);\n      });\n    }\n\n    // Add Wound Thresholds info\n    if (this.shared.rollData.attributes.woundThresholds.level > 0)\n      properties.push(\n        game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[this.shared.rollData.attributes.woundThresholds.level])\n      );\n\n    return properties;\n  }\n\n  /**\n   * Adds combat property labels to an attack's chat card.\n   *\n   * @returns {string[]} The resulting property labels.\n   */\n  addCombatPropertyLabels() {\n    const properties = [];\n\n    // Add round info\n    properties.push(game.i18n.localize(\"FFD20.CombatInfo_Round\").format(game.combat.round));\n\n    return properties;\n  }\n\n  /**\n   * Generates metadata for this attack for the chat card to store.\n   *\n   * @returns {object} The resulting metadata object.\n   */\n  generateChatMetadata() {\n    const metadata = {};\n\n    metadata.item = this.item.id;\n    metadata.template = this.shared.template ? this.shared.template.id : null;\n    metadata.rolls = {\n      attacks: {},\n    };\n\n    // Get template for later variables\n    const template = canvas.scene ? canvas.templates.get(metadata.template) : null;\n\n    // Add targets\n    if (template != null) {\n      metadata.targets = template.getTokensWithin().map((o) => o.id);\n    } else {\n      metadata.targets = Array.from(game.user.targets).map((o) => o.id);\n    }\n\n    // Add attack rolls\n    for (let a = 0; a < this.shared.chatAttacks.length; a++) {\n      const atk = this.shared.chatAttacks[a];\n      const attackRolls = { attack: null, damage: {}, critConfirm: null, critDamage: {} };\n      // Add attack roll\n      if (atk.attack.roll) attackRolls.attack = atk.attack.roll.toJSON();\n      // Add damage rolls\n      if (atk.damage.rolls.length) {\n        for (let b = 0; b < atk.damage.rolls.length; b++) {\n          const r = atk.damage.rolls[b];\n          attackRolls.damage[b] = {\n            damageType: r.damageType,\n            roll: r.roll.toJSON(),\n          };\n        }\n      }\n      // Add critical confirmation roll\n      if (atk.critConfirm.roll) attackRolls.critConfirm = atk.critConfirm.roll.toJSON();\n      // Add critical damage rolls\n      if (atk.critDamage.rolls.length) {\n        for (let b = 0; b < atk.critDamage.rolls.length; b++) {\n          const r = atk.critDamage.rolls[b];\n          attackRolls.critDamage[b] = {\n            damageType: r.damageType,\n            roll: r.roll.toJSON(),\n          };\n        }\n      }\n\n      metadata.rolls.attacks[a] = attackRolls;\n    }\n\n    // Add miscellaneous metadata\n    if (this.shared.saveDC) metadata.save = { dc: this.shared.saveDC, type: this.shared.save };\n    if (this.item.type === \"spell\") metadata.spell = { cl: this.shared.rollData.cl, sl: this.shared.rollData.sl };\n\n    return metadata;\n  }\n\n  /**\n   * Executes the item's script calls.\n   *\n   * @returns {object} The resulting data from the script calls.\n   */\n  async executeScriptCalls() {\n    // Execute script call\n    this.shared.scriptData = await this.item.executeScriptCalls(\"use\", {\n      attackData: this.shared,\n    });\n  }\n\n  /**\n   * Posts the attack's chat card.\n   */\n  async postMessage() {\n    // Old hook data + callAll\n    const hookData = {\n      ev: this.shared.event,\n      skipDialog: this.shared.skipDialog,\n      chatData: this.shared.chatData,\n      templateData: this.shared.templateData,\n      shared: this.shared,\n    };\n    callOldNamespaceHookAll(\"itemUse\", \"ffd20PreDisplayActionUse\", this.item, \"postAttack\", hookData);\n\n    this.shared.chatTemplate ||= \"systems/ffd20/templates/chat/attack-roll.hbs\";\n    this.shared.templateData.damageTypes = ffd20.registry.damageTypes.toRecord();\n    if (Hooks.call(\"ffd20PreDisplayActionUse\", this) === false) return;\n\n    // Show chat message\n    let result;\n    if (this.shared.chatAttacks.length > 0) {\n      if (this.shared.chatMessage && this.shared.scriptData.hideChat !== true)\n        result = await createCustomChatMessage(\n          this.shared.chatTemplate,\n          this.shared.templateData,\n          this.shared.chatData\n        );\n      else result = this.shared;\n    } else {\n      if (this.shared.chatMessage && this.shared.scriptData.hideChat !== true) result = this.item.roll();\n      else result = { descriptionOnly: true };\n    }\n\n    return result;\n  }\n}\n\n/**\n * @typedef {object} ItemAttack_Dialog_Result\n * @property {boolean} fullAttack - Whether it's a full attack (true) or a single attack (false)\n * @property {JQuery} html - The html containing user input and selections.\n */\n","import { DiceFFD20, formulaHasDice } from \"../../dice/dice.mjs\";\nimport { ItemBaseFFD20 } from \"./item-base.mjs\";\nimport { createCustomChatMessage } from \"../../utils/chat.mjs\";\nimport {\n  createTag,\n  linkData,\n  convertDistance,\n  calculateRange,\n  keepUpdateArray,\n  diffObjectAndArray,\n} from \"../../utils/lib.mjs\";\nimport { ItemChange } from \"../../components/change.mjs\";\nimport { ItemAction } from \"../../components/action.mjs\";\nimport { getHighestChanges } from \"../actor/utils/apply-changes.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\nimport { ActionUse } from \"@actionUse/action-use.mjs\";\nimport { callOldNamespaceHook, callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n/**\n * Override and extend the basic :class:`Item` implementation\n */\nexport class ItemFFD20 extends ItemBaseFFD20 {\n  constructor(...args) {\n    super(...args);\n\n    if (this.links === undefined)\n      /**\n       * An object containing links to other items.\n       *\n       * @type {object}\n       */\n      this.links = {};\n\n    if (this._rollData === undefined)\n      /**\n       * Cached {@link ItemFFD20.getRollData}\n       *\n       * @type {null|object}\n       * @private\n       */\n      this._rollData = null;\n\n    if (this.actions === undefined && this.actions instanceof Array)\n      /**\n       * A {@link Collection} of {@link ItemAction}s.\n       *\n       * @type {Collection<ItemAction>}\n       */\n      this.actions = new Collection();\n  }\n\n  static isInventoryItem(type) {\n    return [\"weapon\", \"equipment\", \"consumable\", \"loot\", \"container\"].includes(type);\n  }\n\n  _preCreate(data, options, user) {\n    super._preCreate(data, options, user);\n\n    // Ensure unique Change IDs\n    const actor = this.parentActor;\n    if (actor && data?.changes?.length > 0) {\n      const changes = data.changes;\n      let updated = false;\n      for (const c of changes) {\n        let i = 0;\n        // Forcibly seek unused ID.\n        while (actor.changes.get(c._id) !== undefined || !c._id) {\n          updated = true;\n          // Revert to default ID generation if too many iterations have passed. Just let it break if even more has passed.\n          if (i > 10_000) break;\n          else if (i++ > 1_000) c._id = foundry.utils.randomID();\n          else c._id = ItemChange.defaultData._id;\n        }\n      }\n      if (updated) this.system.update({ \"system.changes\": changes });\n    }\n\n    let updates = {};\n    if (typeof this.preCreateData === \"function\") {\n      updates = this.preCreateData(data, options, user);\n    }\n\n    if (Object.keys(updates).length) return this.system.update(updates);\n  }\n\n  /**\n   * Meant to be overridden.\n   *\n   * @param data\n   * @param options\n   * @param user\n   * @returns {object} Update data to replace with.\n   */\n  preCreateData(data, options, user) {\n    return {};\n  }\n\n  /**\n   * @returns {string[]} The keys of data variables to memorize between updates, for e.g. determining the difference in update.\n   */\n  get memoryVariables() {\n    return [\"system.quantity\", \"system.level\", \"system.inventoryItems\"];\n  }\n\n  get isPhysical() {\n    return this.constructor.isInventoryItem(this.type);\n  }\n\n  get firstAction() {\n    if (!this.system.actions?.length) return undefined;\n    return this.actions.get(this.system.actions[0]._id);\n  }\n\n  /**\n   * Returns `true` if any of this item's actions have an attack, see {@link ItemAction#hasAttack}.\n   *\n   * @type {boolean}\n   */\n  get hasAttack() {\n    return this.actions?.some((o) => o.hasAttack) ?? false;\n  }\n\n  /**\n   * Returns `true` if any of this item's actions have a damage roll, see {@link ItemAction#hasDamage}.\n   *\n   * @type {boolean}\n   */\n  get hasDamage() {\n    return this.actions?.some((o) => o.hasDamage) ?? false;\n  }\n\n  /* -------------------------------------------- */\n  /*  Item Properties                             */\n  /* -------------------------------------------- */\n\n  get isOwned() {\n    return super.isOwned || this.parentItem != null;\n  }\n\n  // Overriden by more specific implementations where necessary\n  get isActive() {\n    return true;\n  }\n\n  get hasAction() {\n    return this.system.actions?.length > 0;\n  }\n\n  get isSingleUse() {\n    return this.system.uses?.per === \"single\" || (this.isPhysical && !this.hasAction);\n  }\n\n  get isCharged() {\n    return this.isSingleUse || [\"day\", \"week\", \"charges\"].includes(this.system.uses?.per);\n  }\n\n  get charges() {\n    // No actor? No charges!\n    if (!this.parentActor) return 0;\n\n    // Get linked charges\n    const link = this.links?.charges;\n    if (link) return link.charges;\n\n    // Get own charges\n    if (this.isSingleUse) return this.system.quantity;\n    return this.system.uses?.value ?? 0;\n  }\n\n  get maxCharges() {\n    // No actor? No charges!\n    if (!this.parentActor) return 0;\n\n    // Get linked charges\n    const link = this.links?.charges;\n    if (link) return link.maxCharges;\n\n    // Get own charges\n    if (this.isSingleUse) return this.system.quantity;\n    return this.system.uses?.max ?? 0;\n  }\n\n  /**\n   * Returns total duration in seconds or null.\n   *\n   * @returns {number|null} Seconds or null.\n   */\n  get totalDurationSeconds() {\n    return this.system.duration?.totalSeconds ?? null;\n  }\n\n  get auraStrength() {\n    const cl = getProperty(this, \"system.cl\") || 0;\n    if (cl < 1) {\n      return 0;\n    } else if (cl < 6) {\n      return 1;\n    } else if (cl < 12) {\n      return 2;\n    } else if (cl < 21) {\n      return 3;\n    }\n    return 4;\n  }\n\n  get parentActor() {\n    if (this.parent) return this.parent;\n\n    let actor = null;\n    let p = this.parentItem;\n    while (!actor && p) {\n      actor = p.actor;\n      p = p.parentItem;\n    }\n    return actor;\n  }\n\n  get limited() {\n    if (this.parentItem) return this.parentItem.limited;\n    return super.limited;\n  }\n\n  getName(forcePlayerPerspective = false) {\n    if (game.user.isGM && !forcePlayerPerspective) return this.name;\n    if (getProperty(this, \"system.identified\") === false && getProperty(this, \"system.unidentified.name\"))\n      return getProperty(this, \"system.unidentified.name\");\n    return this.name;\n  }\n\n  testUserPermission(user, permission, { exact = false } = {}) {\n    if (this.parentActor) return this.parentActor.testUserPermission(user, permission, { exact });\n    if (this.parentItem) return this.parentItem.testUserPermission(user, permission, { exact });\n    return super.testUserPermission(user, permission, { exact });\n  }\n\n  get permission() {\n    if (this.parentActor) return this.parentActor.permission;\n    return super.permission;\n  }\n\n  get fullDescription() {\n    return this.system.description.value;\n  }\n\n  /**\n   * @returns {ActiveEffect} An active effect associated with this item.\n   */\n  get effect() {\n    return this.actor.effects.find((o) => {\n      const origin = o.data.origin.split(\".\");\n      if (origin[2] === \"Item\" && origin[3] === this.id) return true;\n      return false;\n    });\n  }\n\n  /**\n   * @param {string} type - The item type (such as \"attack\" or \"equipment\")\n   * @param {number} colorType - 0 for the primary color, 1 for the secondary color\n   * @returns {string} A color hex, in the format \"#RRGGBB\"\n   */\n  static getTypeColor(type, colorType) {\n    switch (colorType) {\n      case 0:\n        switch (type) {\n          case \"feat\":\n            return \"#8900EA\";\n          case \"spell\":\n            return \"#5C37FF\";\n          case \"class\":\n            return \"#85B1D2\";\n          case \"race\":\n            return \"#00BD29\";\n          case \"attack\":\n            return \"#F21B1B\";\n          case \"weapon\":\n          case \"equipment\":\n          case \"consumable\":\n          case \"loot\":\n            return \"#E5E5E5\";\n          case \"buff\":\n            return \"#FDF767\";\n          default:\n            return \"#FFFFFF\";\n        }\n      case 1:\n        switch (type) {\n          case \"feat\":\n            return \"#5F00A3\";\n          case \"spell\":\n            return \"#4026B2\";\n          case \"class\":\n            return \"#6A8DA8\";\n          case \"race\":\n            return \"#00841C\";\n          case \"attack\":\n            return \"#A91212\";\n          case \"weapon\":\n          case \"equipment\":\n          case \"consumable\":\n          case \"loot\":\n            return \"#B7B7B7\";\n          case \"buff\":\n            return \"#FDF203\";\n          default:\n            return \"#C1C1C1\";\n        }\n    }\n\n    return \"#FFFFFF\";\n  }\n\n  get typeColor() {\n    return this.constructor.getTypeColor(this.type, 0);\n  }\n\n  get typeColor2() {\n    return this.constructor.getTypeColor(this.type, 1);\n  }\n\n  /**\n   * An array containing all action types from this item's actions.\n   *\n   * @see {@link config.itemActionTypes}\n   * @type {string[]}\n   */\n  get actionTypes() {\n    const actionTypes = this.actions?.map((action) => action.data.actionType).filter(Boolean) ?? [];\n    return [...new Set(actionTypes)];\n  }\n\n  static get defaultContextNote() {\n    return {\n      text: \"\",\n      subTarget: \"\",\n    };\n  }\n\n  /**\n   * Generic charge addition (or subtraction) function that either adds charges\n   * or quantity, based on item data.\n   *\n   * @param {number} value       - The amount of charges to add.\n   * @returns {Promise}\n   */\n  async addCharges(value) {\n    // Add link charges\n    const link = getProperty(this, \"links.charges\");\n    if (link) return link.addCharges(value);\n\n    // Add own charges\n    if (getProperty(this, \"system.uses.per\") === \"single\" && getProperty(this, \"system.quantity\") == null) return;\n\n    const prevValue = this.isSingleUse ? getProperty(this, \"system.quantity\") : getProperty(this, \"system.uses.value\");\n\n    if (this.isSingleUse) await this.update({ \"system.quantity\": prevValue + value });\n    else await this.update({ \"system.uses.value\": prevValue + value });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Should the item show unidentified data\n   *\n   * @type {boolean}\n   */\n  get showUnidentifiedData() {\n    return !game.user.isGM && getProperty(this, \"system.identified\") === false;\n  }\n\n  /* -------------------------------------------- */\n  /*\tData Preparation\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\n  /* -------------------------------------------- */\n\n  /**\n   * Augment the basic Item data model with additional dynamic data.\n   */\n  prepareData() {\n    super.prepareData();\n    const itemData = this.system;\n    const data = itemData;\n    const C = CONFIG.FFD20;\n    const labels = {};\n\n    this.prepareLinks();\n\n    // Update changes\n    if (this.system.changes instanceof Array) {\n      this.changes = this._prepareChanges(this.system.changes);\n    }\n\n    // Update actions\n    if (this.system.actions instanceof Array) {\n      this.actions = this._prepareActions(this.system.actions);\n    }\n\n    // Update script calls\n    if (this.system.scriptCalls instanceof Array) {\n      this.scriptCalls = this._prepareScriptCalls(this.system.scriptCalls);\n    }\n\n    // Update contained items\n    if (this.system.inventoryItems instanceof Array) {\n      this.items = this._prepareInventory(this.system.inventoryItems);\n    }\n    this.prepareWeight();\n\n    // Prepare labels\n    this.labels = this.prepareLabels();\n\n    if (!this.actor) {\n      this.prepareDerivedItemData();\n    }\n\n    return itemData;\n  }\n\n  /**\n   * Prepare this item's {@link ItemWeightData}\n   */\n  prepareWeight() {\n    const itemData = this.system;\n\n    // HACK: Migration shim. Allows unmigrated items to have their weight correct.\n    {\n      const weight = itemData.weight;\n      if (weight === undefined || Number.isFinite(weight)) {\n        const sourceData = this._source.system,\n          sourceWeight = sourceData.baseWeight ?? sourceData.weight ?? 0;\n        itemData.weight = { value: sourceWeight };\n      }\n    }\n\n    const weight = itemData.weight;\n\n    // Make sure there is a weight value\n    weight.value ??= 0;\n    weight.total ??= 0;\n\n    // Determine actual item weight, including sub-items\n    const weightReduction = (100 - (itemData.weightReduction ?? 0)) / 100;\n    weight.total = (this.items ?? []).reduce((cur, o) => {\n      return cur + o.system.weight.total * weightReduction;\n    }, weight.value * itemData.quantity);\n\n    // Add contained currency (mainly containers)\n    weight.currency ??= 0;\n    weight.total += weight.currency;\n\n    // Convert weight according metric system (lb vs kg)\n    let usystem = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n    if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n    weight.converted = {\n      value: ffd20.utils.convertWeight(weight.value),\n      total: ffd20.utils.convertWeight(weight.total),\n    };\n    weight.units = usystem === \"metric\" ? game.i18n.localize(\"FFD20.Kgs\") : game.i18n.localize(\"FFD20.Lbs\");\n    itemData.priceUnits = game.i18n.localize(\"FFD20.CurrencyGil\").toLowerCase();\n  }\n\n  prepareDerivedData() {\n    super.prepareDerivedData();\n\n    // Physical items\n    if (this.isPhysical) {\n      // Sync name\n      if (this.system.identifiedName === undefined) this.system.identifiedName = this.name;\n      if (this.showUnidentifiedData) {\n        // Set unidentified name for players\n        const unidentifiedName = this.system.unidentified.name;\n        if (unidentifiedName) this.system.name = unidentifiedName;\n        // Set unidentified description for players\n        this.system.description.value = this.system.description.unidentified;\n      }\n    }\n  }\n\n  prepareBaseData() {\n    const itemData = this.system;\n\n    // Initialize tag for items that have tagged template\n    const itemTemplate = game.system.template.Item;\n    const taggedTypes = itemTemplate.types.filter((t) => itemTemplate[t].templates?.includes(\"tagged\"));\n    if (itemData.useCustomTag !== true && taggedTypes.includes(this.type)) {\n      itemData.tag = createTag(this.name);\n    }\n  }\n\n  prepareDerivedItemData() {\n    // Update maximum uses\n    this._updateMaxUses();\n  }\n\n  /**\n   * Returns this item's default labels, using the item's data and the first action's data, if one is present.\n   *\n   * @returns {Record<string, string>} This item's labels\n   */\n  prepareLabels() {\n    const action = this.firstAction;\n    return { ...this.getLabels(), ...(action?.getLabels() ?? {}) };\n  }\n\n  /**\n   * Returns labels for this item\n   *\n   * @returns {Record<string, string>} This item's labels\n   */\n  getLabels() {\n    const labels = {};\n    const itemData = this.system;\n\n    // Equipped label\n    const checkYes = '<i class=\"fas fa-check\"></i>';\n    const checkNo = '<i class=\"fas fa-times\"></i>';\n    labels.equipped = \"\";\n    if (itemData.equipped === true) labels.equipped = checkYes;\n    else labels.equipped = checkNo;\n\n    // Carried label\n    labels.carried = \"\";\n    if (itemData.carried === true) labels.carried = checkYes;\n    else labels.carried = checkNo;\n\n    // Identified label\n    labels.identified = \"\";\n    if (itemData.identified === true) labels.identified = checkYes;\n    else labels.identified = checkNo;\n\n    // Slot label\n    if (itemData.slot) {\n      // Add equipment slot\n      const equipmentType = this.system.equipmentType || null;\n      if (equipmentType != null) {\n        const equipmentSlot = this.system.slot || null;\n        labels.slot = equipmentSlot == null ? null : CONFIG.FFD20.equipmentSlots[equipmentType]?.[equipmentSlot];\n      } else labels.slot = null;\n    }\n\n    return labels;\n  }\n\n  prepareLinks() {\n    if (!this.links) return;\n\n    for (const [k, i] of Object.entries(this.links)) {\n      switch (k) {\n        case \"charges\": {\n          const uses = i.system.uses;\n          if (!uses) break;\n          for (const [k, v] of Object.entries(uses)) {\n            if ([\"autoDeductCharges\", \"autoDeductChargesCost\"].includes(k)) continue;\n            this.system.uses[k] = v;\n          }\n          break;\n        }\n      }\n    }\n  }\n\n  _prepareChanges(changes) {\n    const prior = this.changes;\n    const collection = new Collection();\n    for (const c of changes) {\n      let change = null;\n      if (prior && prior.has(c._id)) {\n        change = prior.get(c._id);\n        change.data = c;\n        change.prepareData();\n      } else change = new ffd20.components.ItemChange(c, this);\n      collection.set(c._id || change.data._id, change);\n    }\n    return collection;\n  }\n\n  _prepareActions(actions) {\n    const prior = this.actions;\n    const collection = new Collection();\n    for (const o of actions) {\n      let action = null;\n      if (prior && prior.has(o._id)) {\n        action = prior.get(o._id);\n        action.data = o;\n        action.prepareData();\n      } else action = new ffd20.components.ItemAction(o, this);\n      collection.set(o._id || action.data._id, action);\n    }\n    return collection;\n  }\n\n  _prepareScriptCalls(scriptCalls) {\n    const prior = this.scriptCalls;\n    const collection = new Collection();\n    for (const s of scriptCalls) {\n      let scriptCall = null;\n      if (prior && prior.has(s.id)) {\n        scriptCall = prior.get(s.id);\n        scriptCall.data = s;\n      } else scriptCall = new ffd20.components.ItemScriptCall(s, this);\n      collection.set(s._id || scriptCall.data._id, scriptCall);\n    }\n    return collection;\n  }\n\n  _prepareInventory(inventory) {\n    const prior = this.items;\n    const collection = new Collection();\n    for (const o of inventory) {\n      let item = null;\n      if (prior && prior.has(o._id)) {\n        item = prior.get(o._id);\n        item.updateSource(o);\n        item.reset();\n      } else {\n        item = new CONFIG.Item.documentClass(o);\n        item.parentItem = this;\n      }\n\n      collection.set(o._id || item.id, item);\n    }\n    return collection;\n  }\n\n  /**\n   * Executes all script calls on this item of a specified category.\n   *\n   * @param {string} category - The category of script calls to call.\n   * @param {Object<string, object>} [extraParams={}] - A dictionary of extra parameters to pass as variables for use in the script.\n   * @returns {Promise.<object>} The shared object between calls which may have been given data.\n   */\n  async executeScriptCalls(category, extraParams = {}) {\n    const scripts = this.scriptCalls?.filter((o) => o.category === category) ?? [];\n    const shared = {};\n    if (extraParams.attackData) {\n      shared.attackData = extraParams.attackData;\n      delete extraParams.attackData;\n    }\n\n    for (const s of scripts) {\n      await s.execute(shared, extraParams);\n    }\n\n    return shared;\n  }\n\n  async update(data, context = {}) {\n    // Avoid regular update flow for explicitly non-recursive update calls\n    if (context.recursive === false) {\n      return super.update(data, context);\n    }\n    const baseData = this.toObject();\n    const srcData = mergeObject(baseData, data, { inplace: false });\n\n    // Make sure stuff remains an array\n    {\n      const keepPaths = [\n        \"system.attackNotes\",\n        \"system.effectNotes\",\n        \"system.contextNotes\",\n        \"system.scriptCalls\",\n        \"system.actions\",\n        \"system.inventoryItems\",\n        \"system.changes\",\n      ];\n\n      for (const path of keepPaths) {\n        keepUpdateArray(this, data, path);\n        linkData(srcData, data, path, data[path]);\n      }\n    }\n\n    // Update price from base price\n    if (data[\"system.basePrice\"] != null) {\n      linkData(srcData, data, \"system.price\", getProperty(srcData, \"system.basePrice\") || 0);\n    }\n    if (data[\"system.unidentified.basePrice\"] != null) {\n      linkData(srcData, data, \"system.unidentified.price\", getProperty(srcData, \"system.unidentified.basePrice\") || 0);\n    }\n\n    // Update name\n    if (data[\"system.identifiedName\"]) linkData(srcData, data, \"name\", data[\"system.identifiedName\"]);\n    else if (data[\"name\"]) linkData(srcData, data, \"system.identifiedName\", data[\"name\"]);\n\n    // Make sure charges doesn't exceed max charges, and vice versa\n    if (this.isCharged) {\n      let charges = 0;\n      let maxCharges = 0;\n      let target = \"value\";\n\n      if (this.type === \"spell\") {\n        if (data[\"system.preparation.maxAmount\"] != null) target = \"max\";\n        charges = data[\"system.preparation.preparedAmount\"] ?? this.charges;\n        maxCharges = data[\"system.preparation.maxAmount\"] ?? this.maxCharges;\n      } else {\n        if (data[\"system.uses.max\"] != null) target = \"max\";\n        charges = data[\"system.uses.value\"] ?? this.charges;\n        maxCharges = data[\"system.uses.max\"] ?? this.maxCharges;\n      }\n\n      if (target === \"value\" && charges > maxCharges) maxCharges = charges;\n      else if (target === \"max\" && maxCharges < charges) charges = maxCharges;\n\n      const link = getProperty(this, \"links.charges\");\n      if (!link) {\n        if (this.type === \"spell\") {\n          if (charges !== undefined) linkData(srcData, data, \"system.preparation.preparedAmount\", charges);\n          if (maxCharges !== undefined) linkData(srcData, data, \"system.preparation.maxAmount\", maxCharges);\n        } else {\n          if (charges !== undefined) linkData(srcData, data, \"system.uses.value\", charges);\n          if (maxCharges !== undefined) linkData(srcData, data, \"system.uses.max\", maxCharges);\n        }\n      } else {\n        // Update charges for linked items\n        if (data[\"system.uses.value\"] != null) {\n          if (link && getProperty(link, \"links.charges\") == null) {\n            await link.update({ \"system.uses.value\": data[\"system.uses.value\"] });\n          }\n        }\n      }\n    }\n\n    this.memorizeVariables();\n\n    const diff = diffObject(flattenObject(this.toObject()), data);\n    // Filter diff for undefined values. Single value depth with speed as priority\n    for (const [k, v] of Object.entries(diff)) {\n      if (v === undefined) delete diff[k];\n    }\n    // Filter diff for arrays that haven't changed. Single level depth with speed as priority\n    for (const d of Object.keys(diff)) {\n      if (!Array.isArray(diff[d])) continue;\n      const origData = getProperty(this._source, d) || [];\n      if (diff[d].length !== origData?.length) continue;\n      const anyDiff = diff[d].some((obj, idx) => {\n        // Bidirectional diff is required or else it will not detect some changes (e.g. empty attack note being filled).\n        // First is additions, second is deletions.\n        if (\n          !foundry.utils.isEmpty(diffObjectAndArray(origData[idx], obj)) ||\n          !foundry.utils.isEmpty(diffObjectAndArray(obj, origData[idx]))\n        )\n          return true;\n      });\n      if (!anyDiff) delete diff[d];\n    }\n\n    if (Object.keys(diff).length && !context.skipUpdate) {\n      if (this.parentItem == null) {\n        await super.update(diff, context);\n      } else {\n        // Determine item index to update in parent\n        const parentInventory = this.parentItem.system.inventoryItems || [];\n        const parentItem = parentInventory.find((o) => o._id === this.id);\n        const idx = parentInventory.indexOf(parentItem);\n\n        if (idx >= 0) {\n          // Replace keys to suit parent item\n          for (const [k, v] of Object.entries(diff)) {\n            delete diff[k];\n            diff[`system.inventoryItems.${idx}.${k}`] = v;\n          }\n\n          // Update parent item\n          await this.parentItem.update(diff);\n        }\n      }\n    } else if (context.skipUpdate) {\n      diff[\"_id\"] = this.id;\n    }\n\n    // Update tokens and the actor using this item\n    const actor = this.parent;\n    if (actor) {\n      // Update tokens\n      const promises = [];\n      const tokens = canvas?.tokens?.placeables?.filter((token) => token.actor?.id === actor.id) ?? [];\n      for (const token of tokens) {\n        const tokenUpdateData = {};\n\n        // Update tokens with this item as a resource bar\n        if (diff[\"system.uses.value\"] != null) {\n          for (const barKey of [\"bar1\", \"bar2\"]) {\n            const bar = token.document.getBarAttribute(barKey);\n            if (bar && bar.attribute === `resources.${this.system.tag}`) {\n              tokenUpdateData[`${barKey}.value`] = diff[\"system.uses.value\"];\n            }\n          }\n        }\n\n        if (!foundry.utils.isEmpty(tokenUpdateData)) {\n          promises.push(token.document.update(tokenUpdateData));\n        }\n      }\n      if (promises.length) await Promise.all(promises);\n    }\n  }\n\n  memorizeVariables() {\n    if (this._memoryVariables != null) return;\n\n    const memKeys = this.memoryVariables;\n    this._memoryVariables = {};\n    for (const k of memKeys) {\n      if (hasProperty(this, k)) {\n        this._memoryVariables[k] = deepClone(getProperty(this, k));\n      }\n    }\n\n    // Memorize variables recursively on container items\n    for (const item of this.items ?? []) {\n      item.memorizeVariables();\n    }\n  }\n\n  _onUpdate(changed, options, userId) {\n    super._onUpdate(changed, options, userId);\n\n    if (userId === game.user.id) {\n      // Call 'toggle' script calls\n      {\n        let state = null;\n        if (this.type === \"buff\") state = getProperty(changed, \"system.active\");\n        if (this.type === \"feat\" && hasProperty(changed, \"system.disabled\"))\n          state = getProperty(changed, \"system.disabled\") === true ? false : true;\n        if (state != null) {\n          this.executeScriptCalls(\"toggle\", { state });\n        }\n      }\n\n      // Call 'equip' script calls\n      {\n        const equipped = getProperty(changed, \"system.equipped\");\n        if (equipped != null) {\n          this.executeScriptCalls(\"equip\", { equipped });\n        }\n      }\n\n      // Call 'changeQuantity' script calls\n      if (this._memoryVariables?.[\"system.quantity\"] !== undefined) {\n        const quantity = {\n          previous: this._memoryVariables[\"system.quantity\"],\n          new: getProperty(this, \"system.quantity\"),\n        };\n        if (quantity.new != null && quantity.new !== quantity.previous) {\n          this.executeScriptCalls(\"changeQuantity\", { quantity });\n        }\n      }\n\n      // Call 'changeLevel' script calls\n      if (this._memoryVariables?.[\"system.level\"] !== undefined) {\n        const level = {\n          previous: parseInt(this._memoryVariables[\"system.level\"]),\n          new: parseInt(getProperty(this, \"system.level\")),\n        };\n        for (const [k, v] of Object.entries(level)) {\n          if (Number.isNaN(v)) level[k] = null;\n        }\n        if (level.new !== undefined && level.new !== level.previous) {\n          this.executeScriptCalls(\"changeLevel\", { level });\n        }\n      }\n    }\n\n    // Call _onUpdate for changed items\n    for (let a = 0; a < (changed.system?.inventoryItems ?? []).length; a++) {\n      const itemUpdateData = changed.system?.inventoryItems[a];\n      const memoryItemData = this._memoryVariables?.[\"system.inventoryItems\"]?.[a];\n      if (!memoryItemData) continue;\n\n      const diffData = diffObjectAndArray(memoryItemData, itemUpdateData, { keepLength: true });\n      if (!foundry.utils.isEmpty(diffData)) {\n        const item = this.items.get(memoryItemData._id);\n        item._onUpdate(diffData, options, userId);\n      }\n    }\n\n    // Forget memory variables\n    this._memoryVariables = null;\n  }\n\n  _updateMaxUses() {\n    // No actor? No charges!\n    if (!this.parentActor) return;\n\n    // No charges? No charges!\n    if (![\"day\", \"week\", \"charges\"].includes(getProperty(this, \"system.uses.per\"))) return;\n\n    const rollData = this.getRollData();\n\n    if (hasProperty(this, \"system.uses.maxFormula\")) {\n      const maxFormula = getProperty(this, \"system.uses.maxFormula\");\n      if (maxFormula !== \"\" && !formulaHasDice(maxFormula)) {\n        const roll = RollFFD20.safeRoll(maxFormula, rollData);\n        setProperty(this, \"system.uses.max\", roll.total);\n      } else if (formulaHasDice(maxFormula)) {\n        const msg = game.i18n\n          .localize(\"FFD20.WarningNoDiceAllowedInFormula\")\n          .format(game.i18n.localize(\"FFD20.ChargePlural\"), this.name);\n        console.warn(msg);\n        ui.notifications.warn(msg);\n      }\n    }\n  }\n\n  // Determines the starting data for an ActiveEffect based off this item\n  getRawEffectData() {\n    return {\n      label: this.name,\n      icon: this.img,\n      origin: this.uuid,\n      flags: { ffd20: { origin: { item: this.id } } },\n      disabled: !this.isActive,\n      duration: {},\n    };\n  }\n\n  // Fetches all this item's script calls of a specified category\n  getScriptCalls(category) {\n    return this.scriptCalls?.filter((s) => s.category === category) ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Display the chat card for an Item as a message in chat\n   *\n   * @deprecated Use {@link displayCard} instead.\n   * @param {object} [altChatData={}] - Optional data that will be merged into the chat data object.\n   * @returns {Promise<ChatMessage | void>}\n   */\n  async roll(altChatData = {}) {\n    foundry.utils.logCompatibilityWarning(`ActorFFD20#roll has been deprecated in favor of ActorFFD20#displayCard`, {\n      since: \"FFD20 0.82.0\",\n      until: \"FFD20 0.83.0\",\n    });\n    return this.displayCard(altChatData);\n  }\n\n  /**\n   * Display the chat card for an Item as a message in chat\n   *\n   * @param {object} [altChatData={}] - Optional data that will be merged into the chat data object.\n   * @returns {Promise<ChatMessage | void>}\n   */\n  async displayCard(altChatData = {}) {\n    const actor = this.parent;\n    if (actor && !actor.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(actor.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    // Basic template rendering data\n    const token = this.parentActor.token;\n    const rollData = this.getRollData();\n    const itemChatData = this.getChatData({ rollData });\n    const identified = Boolean(rollData.item?.identified ?? true);\n\n    const templateData = {\n      actor: this.parent,\n      tokenId: token ? token.uuid : null,\n      item: this.toObject(),\n      labels: this.labels,\n      hasAttack: this.hasAttack,\n      hasMultiAttack: this.hasMultiAttack,\n      hasAction: this.hasAction,\n      isVersatile: this.isVersatile,\n      isSpell: this.type === \"spell\",\n      name: (identified ? rollData.identifiedName : rollData.item.unidentified?.name) || this.name,\n      description: identified ? this.fullDescription : itemChatData.unidentifiedDescription,\n      rollData: rollData,\n      hasExtraProperties: false,\n      extraProperties: [],\n    };\n\n    const ffd20Flags = {};\n\n    // If the item is unidentified, store data for GM info box containing identified info\n    if (identified === false) {\n      ffd20Flags.identifiedInfo = {\n        identified,\n        name: rollData.identifiedName || this.name,\n        description: itemChatData.identifiedDescription,\n      };\n    }\n\n    // Add combat info\n    if (game.combat) {\n      const combatProps = [];\n      // Add round info\n      combatProps.push(game.i18n.localize(\"FFD20.CombatInfo_Round\").format(game.combat.round));\n\n      if (combatProps.length > 0) {\n        templateData.extraProperties.push({ header: game.i18n.localize(\"FFD20.CombatInfo_Header\"), value: combatProps });\n        templateData.hasExtraProperties = true;\n      }\n    }\n\n    // Roll spell failure chance\n    if (templateData.isSpell && this.parent != null && this.parent.spellFailure > 0 && this.system.components.somatic) {\n      const spellbook = getProperty(this.parent, `system.attributes.spells.spellbooks.${this.system.spellbook}`);\n      if (spellbook && spellbook.arcaneSpellFailure) {\n        templateData.spellFailure = RollFFD20.safeRoll(\"1d100\").total;\n        templateData.spellFailureSuccess = templateData.spellFailure > this.parentActor.spellFailure;\n      }\n    }\n\n    // Render the chat card template\n    const templateType = [\"consumable\"].includes(this.type) ? this.type : \"item\";\n    const template = `systems/ffd20/templates/chat/${templateType}-card.hbs`;\n\n    // Determine metadata\n    ffd20Flags.metadata = {};\n    ffd20Flags.metadata.item = this.id;\n\n    // Basic chat message data\n    const chatData = flattenObject(\n      mergeObject(\n        {\n          user: game.user.id,\n          type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n          speaker: ChatMessage.getSpeaker({ actor: this.parent }),\n          flags: {\n            core: {\n              canPopout: true,\n            },\n            ffd20: ffd20Flags,\n          },\n        },\n        altChatData\n      )\n    );\n\n    if (Hooks.call(\"ffd20DisplayCard\", this, { template, templateData, chatData }) === false) return;\n\n    // Create the chat message\n    return createCustomChatMessage(template, templateData, chatData);\n  }\n\n  /* -------------------------------------------- */\n  /*  Chat Cards\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\n  /* -------------------------------------------- */\n\n  /**\n   * Generates {@link ChatData} for this item, either in a default configuration or for a specific action.\n   *\n   * @param {EnrichmentOptions} [enrichOptions] - Options affecting how descriptions are enriched.\n   *                                              `rollData` defaults to {@link ItemAction#getRollData}/{@link ItemFFD20#getRollData}.\n   *                                              `secrets` defaults to {@link Item#isOwner}.\n   * @param {object} [options] - Additional options affecting the chat data generation\n   * @param {string} [options.actionId] - The ID of an action on this item to generate chat data for,\n   *                                      defaults to {@link ItemFFD20.firstAction}\n   * @returns {ChatData} The chat data for this item (+action)\n   */\n  getChatData(enrichOptions = {}, options = {}) {\n    /** @type {ChatData} */\n    const data = {};\n    const { actionId = null } = options;\n    const action = actionId ? this.actions.get(actionId) : this.firstAction;\n    const labels = { ...this.getLabels(), ...(action?.getLabels() ?? {}) };\n\n    enrichOptions.rollData ??= action ? action.getRollData() : this.getRollData();\n    enrichOptions.secrets ??= this.isOwner;\n    enrichOptions.async = false; // @TODO: Work on making this async, somehow\n\n    const itemData = enrichOptions.rollData?.item ?? this.system;\n    const actionData = enrichOptions.rollData?.action ?? action?.data ?? {};\n\n    // Rich text descriptions\n    data.identifiedDescription = TextEditor.enrichHTML(itemData.description.value, enrichOptions);\n    if (itemData.shortDescription) {\n      data.identifiedDescription = `${data.identifiedDescription}${TextEditor.enrichHTML(\n        itemData.shortDescription,\n        enrichOptions\n      )}`;\n    }\n    data.unidentifiedDescription = TextEditor.enrichHTML(itemData.description.unidentified, enrichOptions);\n    data.description = this.showUnidentifiedData ? data.unidentifiedDescription : data.identifiedDescription;\n    data.actionDescription = TextEditor.enrichHTML(actionData.description, enrichOptions);\n\n    // General equipment properties\n    const props = [];\n    if (Object.prototype.hasOwnProperty.call(itemData, \"equipped\") && [\"weapon\", \"equipment\"].includes(this.type)) {\n      props.push(itemData.equipped ? game.i18n.localize(\"FFD20.Equipped\") : game.i18n.localize(\"FFD20.NotEquipped\"));\n    }\n\n    if (!this.showUnidentifiedData) {\n      // Gather dynamic labels\n      const dynamicLabels = {};\n      dynamicLabels.range = labels.range || \"\";\n      dynamicLabels.level = labels.sl || \"\";\n      // Range\n      if (actionData.range != null) {\n        const range = action.getRange({ type: \"max\" }),\n          units = actionData.range.units === \"mi\" ? \"mi\" : \"ft\";\n        const distanceValues = convertDistance(range, units);\n        dynamicLabels.range =\n          range > 0 ? game.i18n.format(\"FFD20.RangeNote\", { 0: `${range} ${distanceValues[1]}` }) : null;\n      }\n\n      // Add Difficulty Modifier (DC) label\n      props.push(labels.save);\n      const saveDesc = actionData.save?.description;\n      if (saveDesc?.length > 0) props.push(saveDesc);\n\n      // Duration\n      if (actionData.duration != null) {\n        if (![\"inst\", \"perm\"].includes(actionData.duration.units) && typeof actionData.duration.value === \"string\") {\n          const duration = RollFFD20.safeRoll(actionData.duration.value || \"0\", enrichOptions.rollData).total;\n          dynamicLabels.duration = [duration, CONFIG.FFD20.timePeriods[actionData.duration.units]].filterJoin(\" \");\n        }\n      }\n\n      // Ability activation properties\n      if (actionData.activation?.type) {\n        props.push(labels.target, labels.activation, dynamicLabels.range, dynamicLabels.duration);\n      }\n    }\n\n    // Get per item type chat data\n    this.getTypeChatData(data, labels, props, enrichOptions.rollData);\n\n    // Filter properties and return\n    data.properties = props.filter((p) => !!p);\n    return data;\n  }\n\n  /**\n   * Per item type chat data.\n   *\n   * @param {ChatData} data - A partial of a chat data object that can be modified to add per item type data.\n   * @param {Object<string, string>} labels - The labels for this item.\n   * @param {string[]} props - Additional property strings\n   * @param {object} rollData - A rollData object to be used for checks\n   */\n  getTypeChatData(data, labels, props, rollData) {\n    // Charges as used by most item types, except spells\n    if (this.isCharged) {\n      props.push(`${game.i18n.localize(\"FFD20.ChargePlural\")}: ${this.charges}/${this.maxCharges}`);\n    }\n  }\n\n  /* -------------------------------------------- */\n  /*  Item Rolls - Attack, Damage, Saves, Checks  */\n  /* -------------------------------------------- */\n\n  /**\n   * @deprecated Use {@link use ItemFFD20#use} instead.\n   * @param options\n   * @returns {Promise<*>}\n   */\n  useAttack(options) {\n    foundry.utils.logCompatibilityWarning(\"ItemFFD20#useAttack has been deprecated in favor of ItemFFD20#use\", {\n      since: \"FFD20 0.82.0\",\n      until: \"FFD20 0.83.0\",\n    });\n    return this.use(options);\n  }\n\n  /**\n   * Use an attack, using {@link SharedActionData}\n   *\n   * @see {@link SharedActionData}\n   * @param {string} [actionID=\"\"] - The ID of the action to use, defaults to the first action\n   * @param {Event | null} [ev=null] - The event that triggered the use, if any\n   * @param {boolean} [skipDialog=false] - Whether to skip the dialog for this action\n   * @param {boolean} [chatMessage=true] - Whether to send a chat message for this action\n   * @param {string} [dice=\"1d20\"] - The base dice to roll for this action\n   * @param {string} [rollMode] - The roll mode to use for the chat message\n   * @returns {Promise<SharedActionData | void | ChatMessage | *>}\n   */\n  async use({ actionID = \"\", ev = null, skipDialog = false, chatMessage = true, dice = \"1d20\", rollMode } = {}) {\n    // Old use method\n    if (!this.hasAction) {\n      // Use\n      const useScriptCalls = this.scriptCalls.filter((o) => o.category === \"use\");\n      let shared;\n      if (useScriptCalls.length > 0) {\n        shared = await this.executeScriptCalls(\"use\", {\n          attackData: { event: ev, skipDialog, chatMessage, rollMode },\n        });\n        if (shared.reject) return shared;\n        if (shared.hideChat !== true) await this.displayCard();\n      }\n      // Show a chat card if this item doesn't have 'use' type script call(s)\n      else {\n        if (chatMessage) return this.displayCard({ rollMode });\n        else return { descriptionOnly: true }; // nothing to show for printing description\n      }\n\n      // Deduct charges\n      if (this.isCharged) {\n        if (this.charges < this.chargeCost) {\n          if (this.isSingleUse) {\n            const msg = game.i18n.localize(\"FFD20.ErrorNoQuantity\");\n            console.warn(msg);\n            return ui.notifications.warn(msg);\n          }\n          const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(this.name);\n          console.warn(msg);\n          return ui.notifications.warn(msg);\n        }\n        if (this.autoDeductCharges) {\n          await this.addCharges(-this.chargeCost);\n        }\n      }\n\n      return shared;\n    }\n\n    if (ev && ev.originalEvent) ev = ev.originalEvent;\n\n    /** @type {ItemAction | undefined} */\n    let action;\n    if (!actionID && this.system.actions.length > 1 && skipDialog === false) {\n      const app = new ffd20.applications.ActionChooser(this);\n      app.render(true);\n      return;\n    } else if (actionID || this.system.actions.length === 1 || skipDialog) {\n      action = this.actions.get(actionID || this.system.actions[0]._id);\n    } else {\n      console.error(\"This item does not have an action associated with it.\");\n      return;\n    }\n\n    // Prepare variables\n    /** @type {SharedActionData} */\n    const shared = {\n      event: ev,\n      rollData: {},\n      skipDialog,\n      chatMessage,\n      dice,\n      fullAttack: true,\n      attackBonus: [],\n      damageBonus: [],\n      attacks: [],\n      chatAttacks: [],\n      rollMode: game.settings.get(\"core\", \"rollMode\"),\n      useMeasureTemplate: action.hasTemplate && game.settings.get(\"ffd20\", \"placeMeasureTemplateOnQuickRolls\"),\n      conditionals: null,\n      conditionalPartsCommon: {},\n      casterLevelCheck: false,\n      concentrationCheck: false,\n      scriptData: {},\n    };\n\n    // Prevent reassigning the ActionUse's item and action\n    Object.defineProperties(shared, {\n      action: { value: action, writable: false, enumerable: true },\n      item: { value: this, writable: false, enumerable: true },\n    });\n\n    const actionUse = new ActionUse(shared);\n\n    // Check requirements for item\n    let reqErr = await actionUse.checkRequirements();\n    if (reqErr > 0) return { err: ffd20.actionUse.ERR_REQUIREMENT, code: reqErr };\n\n    // Get new roll data\n    shared.rollData = await actionUse.getRollData();\n\n    // Show attack dialog, if appropriate\n    if (!skipDialog) {\n      const result = await actionUse.createAttackDialog();\n\n      // Stop if result is a boolean (i.e. when closed is clicked on the dialog)\n      if (typeof result !== \"object\") return;\n\n      // Alter roll data\n      shared.fullAttack = result.fullAttack;\n      shared.attacks = result.attacks;\n      await actionUse.alterRollData(result.html);\n    } else {\n      shared.attacks = await actionUse.generateAttacks();\n      await actionUse.alterRollData();\n    }\n\n    // Filter out attacks without ammo usage\n    if (shared.action.data.usesAmmo) {\n      shared.attacks = shared.attacks.filter((o) => o.ammo != null);\n      if (shared.attacks.length === 0) {\n        ui.notifications.error(game.i18n.localize(\"FFD20.AmmoDepleted\"));\n        return;\n      }\n    }\n\n    // Limit attacks to 1 if not full rounding\n    if (!shared.fullAttack) shared.attacks = shared.attacks.slice(0, 1);\n    // Handle conditionals\n    await actionUse.handleConditionals();\n\n    // Check attack requirements, post-dialog\n    reqErr = await actionUse.checkAttackRequirements();\n    if (reqErr > 0) return { err: ffd20.actionUse.ERR_REQUIREMENT, code: reqErr };\n\n    // Generate chat attacks\n    await actionUse.generateChatAttacks();\n\n    // Prompt measure template\n    let measureResult;\n    if (shared.useMeasureTemplate && canvas.scene) {\n      measureResult = await actionUse.promptMeasureTemplate();\n      if (!measureResult.result) return;\n    }\n\n    // Override roll mode if present.\n    if (rollMode) shared.rollMode = rollMode;\n\n    // Call itemUse hook and determine whether the item can be used based off that\n    let allowed = Hooks.call(\"ffd20PreActionUse\", actionUse);\n    allowed = callOldNamespaceHook(\"itemUse\", \"ffd20PreUseAttack\", allowed, this, \"attack\", {\n      ev,\n      skipDialog,\n      dice,\n      shared,\n    });\n    if (allowed === false) {\n      await measureResult?.delete();\n      return;\n    }\n\n    // Call script calls\n    await actionUse.executeScriptCalls();\n    if (shared.scriptData?.reject) {\n      await measureResult?.delete();\n      return;\n    }\n\n    // Handle Dice So Nice\n    await actionUse.handleDiceSoNice();\n\n    // Subtract uses\n    await actionUse.subtractAmmo();\n    if (shared.rollData.chargeCost < 0 || shared.rollData.chargeCost > 0)\n      await this.addCharges(-shared.rollData.chargeCost);\n    if (shared.action.isSelfCharged)\n      await shared.action.update({ \"uses.self.value\": shared.action.data.uses.self.value - 1 });\n\n    // Retrieve message data\n    await actionUse.getMessageData();\n\n    // Post message\n    let result;\n    if (shared.scriptData?.hideChat !== true) {\n      result = await actionUse.postMessage();\n    } else return;\n\n    // Deselect targets\n    if (game.settings.get(\"ffd20\", \"clearTargetsAfterAttack\")) {\n      for (const t of game.user.targets) {\n        t.setTarget(false);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Finds, filters and alters changes relevant to a context, and returns the result (as an array)\n   *\n   * @param {string} [context=\"mattack\"] - The given context. Either \"mattack\", \"rattack\", \"wdamage\", \"sdamage\".\n   * @returns {ItemChange[]} The resulting changes.\n   */\n  getContextChanges(context = \"attack\") {\n    let result = this.parentActor.changes;\n\n    switch (context) {\n      case \"mattack\":\n      case \"rattack\": {\n        const subTargetList = [\"attack\", context];\n        result = result.filter((c) => {\n          if (!subTargetList.includes(c.subTarget)) return false;\n          return true;\n        });\n        break;\n      }\n      case \"wdamage\":\n      case \"sdamage\": {\n        const subTargetList = [\"damage\", context];\n        result = result.filter((c) => {\n          if (!subTargetList.includes(c.subTarget)) return false;\n          return true;\n        });\n        break;\n      }\n      case \"damage\": {\n        result = result.filter((c) => c.subTarget === \"damage\");\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * @returns {object} An object with data to be used in rolls in relation to this item.\n   */\n  getRollData() {\n    const parentActor = this.parentActor;\n    const result = parentActor ? parentActor.getRollData() : {};\n\n    result.item = deepClone(this.system);\n\n    // Add dictionary flag\n    if (this.system.tag) {\n      result.item.dFlags = getProperty(result, `dFlags.${this.system.tag}`);\n    }\n\n    // Set aura strength\n    setProperty(result, \"item.auraStrength\", this.auraStrength);\n\n    result.dc = this.hasSave ? this.getDC(result) : 0;\n\n    this._rollData = result.item;\n\n    if (Hooks.events[\"ffd20GetRollData\"]?.length > 0) Hooks.callAll(\"ffd20GetRollData\", this, result);\n    callOldNamespaceHookAll(\"ffd20.getRollData\", \"ffd20GetRollData\", this, result, true);\n\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  static chatListeners(html) {\n    html.on(\"click\", \".card-buttons button, .inline-action\", this._onChatCardButton.bind(this));\n    html.on(\"click\", \".item-name\", this._onChatCardToggleContent.bind(this));\n  }\n\n  /* -------------------------------------------- */\n\n  static async _onChatCardButton(event) {\n    event.preventDefault();\n\n    // Extract card data\n    const button = event.currentTarget;\n    button.disabled = true;\n    const card = button.closest(\".chat-card\");\n    const messageId = card.closest(\".message\").dataset.messageId;\n    const message = game.messages.get(messageId);\n    const action = button.dataset.action;\n\n    // Validate permission to proceed with the roll\n    const isTargetted = [\"save\", \"applyDamage\"].includes(action);\n    if (!(isTargetted || game.user.isGM || message.isAuthor)) return;\n\n    // Get the Actor from a synthetic Token\n    const actor = await this._getChatCardActor(card);\n    if (!actor) {\n      if (action === \"applyDamage\") {\n        await this._onChatCardAction(action, { button: button });\n        button.disabled = false;\n      }\n      return;\n    }\n\n    // Get the Item\n    const item = actor.items.get(card.dataset.itemId);\n\n    // Perform action\n    if (!(await this._onChatCardAction(action, { button: button, item: item }))) {\n      button.disabled = false;\n    }\n  }\n\n  static async _onChatCardAction(action, { button = null, item = null } = {}) {\n    // Get card targets\n    // const targets = isTargetted ? this._getChatCardTargets(card) : [];\n\n    // Apply damage\n    if (action === \"applyDamage\") {\n      let asNonlethal = [...(button.closest(\".chat-message\")?.querySelectorAll(\".tag\") ?? [])]\n        .map((o) => o.innerText)\n        .includes(game.i18n.localize(\"FFD20.Nonlethal\"));\n      if (button.dataset.tags?.split(\" \").includes(\"nonlethal\")) asNonlethal = true;\n\n      const value = button.dataset.value;\n      if (!isNaN(parseInt(value))) CONFIG.Actor.documentClasses.default.applyDamage(parseInt(value), { asNonlethal });\n    }\n    // Recover ammunition\n    else if ([\"recoverAmmo\", \"forceRecoverAmmo\"].includes(action)) {\n      if (!item) return;\n      if (!item.isOwner) return;\n\n      // Check for recovery state\n      const attackIndex = button.closest(\".chat-attack\").dataset.index;\n      const card = game.messages.get(button.closest(\".chat-message\").dataset.messageId);\n      const ammoId = button.closest(\".ammo\")?.dataset.ammoId || button.dataset.ammoId;\n      const recoveryData = card.getFlag(\"ffd20\", \"ammoRecovery\");\n      const ammoRecovery = recoveryData?.[attackIndex]?.[ammoId];\n      if (ammoRecovery?.failed || ammoRecovery?.recovered) return;\n\n      let recovered = false;\n      let failed = false;\n      const promises = [];\n\n      // Find ammo item\n      const ammoItem = item.actor.items.get(ammoId);\n      if (!ammoItem) return;\n      let chance = 100;\n      if (action === \"recoverAmmo\") {\n        chance = 50; // @TODO: Allow user to set chance to something else, somehow\n      }\n\n      // (Try to) recover ammo\n      if (chance >= Math.random() * 100) {\n        recovered = true;\n        promises.push(ammoItem.addCharges(1));\n      } else {\n        failed = true;\n      }\n\n      // Update chat card\n      if (recovered || failed) {\n        if (attackIndex) {\n          promises.push(card.setFlag(\"ffd20\", \"ammoRecovery\", { [attackIndex]: { [ammoId]: { failed, recovered } } }));\n        }\n      }\n\n      await Promise.all(promises);\n\n      return true;\n    } else if (action === \"concentration\") {\n      item.parentActor.rollConcentration(item.system.spellbook);\n    } else if (action === \"caster-level-check\") {\n      item.parentActor.rollCL(item.system.spellbook);\n    }\n\n    return false;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle toggling the visibility of chat card content when the name is clicked\n   *\n   * @param {Event} event   The originating click event\n   * @private\n   */\n  static _onChatCardToggleContent(event) {\n    event.preventDefault();\n    const header = event.currentTarget;\n    const card = header.closest(\".chat-card\");\n    const content = card.querySelector(\".card-content\");\n    content.style.display = content.style.display === \"none\" ? \"block\" : \"none\";\n\n    // Update chat popout size\n    const popout = header.closest(\".chat-popout\");\n    if (popout) {\n      popout.style.height = \"auto\";\n    }\n  }\n\n  /**\n   * Get the Actor which is the author of a chat card\n   *\n   * @param {HTMLElement} card    The chat card being used\n   * @returns {Actor|null}         The Actor Document or null\n   * @private\n   */\n  static async _getChatCardActor(card) {\n    // Case 1 - a synthetic actor from a Token\n    const tokenUuid = card.dataset.tokenId;\n    if (tokenUuid) {\n      return (await fromUuid(tokenUuid))?.actor;\n    }\n\n    // Case 2 - use Actor ID directory\n    const actorId = card.dataset.actorId;\n    return game.actors.get(actorId) || null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the Actor which is the author of a chat card\n   *\n   * @param {HTMLElement} card    The chat card being used\n   * @returns {Array.<Actor>}      The Actor Document or null\n   * @private\n   */\n  static _getChatCardTargets(card) {\n    const character = game.user.character;\n    const controlled = canvas.tokens.controlled;\n    const targets = controlled.reduce((arr, t) => (t.actor ? arr.concat([t.actor]) : arr), []);\n    if (character && controlled.length === 0) targets.push(character);\n    if (!targets.length) throw new Error(`You must designate a specific Token as the roll target`);\n    return targets;\n  }\n\n  /**\n   * @param {string} linkType - The type of link.\n   * @param {string} dataType - Either \"compendium\", \"data\" or \"world\".\n   * @param {object} targetItem - The target item to link to.\n   * @param {string} itemLink - The link identifier for the item.\n   * @returns {boolean} Whether a link to the item is possible here.\n   */\n  canCreateItemLink(linkType, dataType, targetItem, itemLink) {\n    const actor = this.parent;\n    const sameActor = actor && targetItem.actor && targetItem.actor.id === actor.id;\n\n    // Don't create link to self\n    const itemId = itemLink.split(\".\").slice(-1)[0];\n    if (itemId === this.id) return false;\n\n    // Don't create existing links\n    const links = getProperty(this, `system.links.${linkType}`) || [];\n    if (links.filter((o) => o.id === itemLink).length) return false;\n\n    const targetLinks = getProperty(targetItem, `system.links.${linkType}`);\n    if ([\"children\", \"charges\", \"ammunition\"].includes(linkType) && sameActor) {\n      if (linkType === \"charges\") {\n        // Prevent the closing of charge link loops\n        if (targetLinks.length > 0) {\n          ui.notifications.warn(\n            game.i18n.localize(\"FFD20.WarningCannotCreateChargeLink\").format(this.name, targetItem.name)\n          );\n          return false;\n        } else if (targetItem.links.charges != null) {\n          // Prevent the linking of one item to multiple resource pools\n          ui.notifications.warn(\n            game.i18n\n              .localize(\"FFD20.WarningCannotCreateChargeLink2\")\n              .format(this.name, targetItem.name, targetItem.links.charges.name)\n          );\n          return false;\n        }\n      }\n      return true;\n    }\n\n    if (linkType === \"classAssociations\" && dataType === \"compendium\") return true;\n\n    return false;\n  }\n\n  /**\n   * @param {string} linkType - The type of link.\n   * @param {string} dataType - Either \"compendium\", \"data\" or \"world\".\n   * @param {object} targetItem - The target item to link to.\n   * @param {string} itemLink - The link identifier for the item.\n   * @returns {Array} An array to insert into this item's link data.\n   */\n  generateInitialLinkData(linkType, dataType, targetItem, itemLink) {\n    const result = {\n      id: itemLink,\n      dataType: dataType,\n      name: targetItem.name,\n      img: targetItem.img,\n    };\n\n    if (linkType === \"classAssociations\") {\n      result.level = 1;\n    }\n\n    if (linkType === \"ammunition\") {\n      result.recoverChance = 50;\n    }\n\n    return result;\n  }\n\n  /**\n   * Creates a link to another item.\n   *\n   * @param {string} linkType - The type of link.\n   * e.g. \"children\", \"charges\", \"classAssociations\" or \"ammunition\".\n   * @param {string} dataType - Either \"compendium\", \"data\" or \"world\".\n   * @param {object} targetItem - The target item to link to.\n   * @param {string} itemLink - The link identifier for the item.\n   * e.g. \"world.NExqvEMCMbDuDxv5\" (world item), \"ffd20.feats.NExqvEMCMbDuDxv5\" (compendium item) or\n   * \"NExqvEMCMbDuDxv5\" (item on same actor)\n   * @returns {boolean} Whether a link was created.\n   */\n  async createItemLink(linkType, dataType, targetItem, itemLink) {\n    if (this.canCreateItemLink(linkType, dataType, targetItem, itemLink)) {\n      const updateData = {};\n      const _links = duplicate(getProperty(this, `system.links.${linkType}`) || []);\n      const link = this.generateInitialLinkData(linkType, dataType, targetItem, itemLink);\n      _links.push(link);\n      updateData[`system.links.${linkType}`] = _links;\n\n      // Call link creation hook\n      await this.update(updateData);\n      callOldNamespaceHookAll(\"createItemLink\", \"ffd20CreateItemLink\", this, link, linkType);\n      Hooks.callAll(\"ffd20CreateItemLink\", this, link, linkType);\n\n      /**\n       * @TODO This is a really shitty way of re-rendering the actor sheet, so I should change this method at some point,\n       * but the premise is that the actor sheet should show data for newly linked items, and it won't do it immediately for some reason\n       */\n      window.setTimeout(() => {\n        if (this.parent) this.parent.sheet.render();\n      }, 50);\n\n      return true;\n    } else if (linkType === \"children\" && dataType !== \"data\") {\n      const itemData = targetItem.toObject();\n      delete itemData._id;\n\n      // Default to spell-like tab until a selector is designed in the Links tab or elsewhere\n      if (getProperty(itemData, \"type\") === \"spell\") setProperty(itemData, \"system.spellbook\", \"spelllike\");\n\n      const newItemData = await this.parent.createEmbeddedDocuments(\"Item\", [itemData]);\n      const newItem = this.parent.items.get(newItemData._id);\n\n      await this.createItemLink(\"children\", \"data\", newItem, newItem._id);\n    }\n\n    return false;\n  }\n\n  async getLinkedItems(type, extraData = false) {\n    const items = getProperty(this, `system..links.${type}`);\n    if (!items) return [];\n\n    const result = [];\n    for (const l of items) {\n      const item = await this.getLinkItem(l, extraData);\n      if (item) result.push(item);\n    }\n\n    return result;\n  }\n\n  async getAllLinkedItems() {\n    const result = [];\n\n    for (const items of Object.values(getProperty(this, \"system.links\"))) {\n      for (const l of items) {\n        const item = await this.getLinkItem(l);\n        if (item) result.push(item);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Removes all link references to an item.\n   *\n   * @param {string} id - The id of the item to remove links to.\n   */\n  async removeItemLink(id) {\n    const updateData = {};\n    for (const [k, linkItems] of Object.entries(getProperty(this, \"system.links\") || {})) {\n      const items = duplicate(linkItems);\n      for (let a = 0; a < items.length; a++) {\n        const item = items[a];\n        if (item.id === id) {\n          items.splice(a, 1);\n          a--;\n        }\n      }\n\n      if (linkItems.length > items.length) {\n        updateData[`data.links.${k}`] = items;\n      }\n    }\n\n    if (Object.keys(updateData).length) {\n      return this.update(updateData);\n    }\n  }\n\n  async getLinkItem(l, extraData = false) {\n    const id = l.id.split(\".\");\n    let item;\n\n    // Compendium entry\n    if (l.dataType === \"compendium\") {\n      const pack = game.packs.get(id.slice(0, 2).join(\".\"));\n      if (!pack) return null;\n      item = await pack.getDocument(id[2]);\n    }\n    // World entry\n    else if (l.dataType === \"world\") {\n      item = game.items.get(id[1]);\n    }\n    // Same actor's item\n    else if (this.parent != null && this.parent.items != null) {\n      item = this.parent.items.get(id[0]);\n    }\n\n    // Package extra data\n    if (extraData) {\n      item = { item: item, linkData: l };\n    }\n\n    return item;\n  }\n\n  async updateLinkItems() {\n    // Update link items\n    const linkGroups = getProperty(this, \"system.links\") || {};\n    for (const links of Object.values(linkGroups)) {\n      for (const l of links) {\n        const i = await this.getLinkItem(l);\n        if (i == null) {\n          l.name = l.name + (l.name?.indexOf(\"[x]\") > -1 ? \"\" : \" [x]\");\n          l.img = CONST.DEFAULT_TOKEN;\n          continue;\n        }\n        l.name = i.name;\n        l.img = i.img;\n      }\n    }\n  }\n\n  _cleanLink(oldLink, linkType) {\n    if (!this.parent) return;\n\n    const otherItem = this.parent.items.get(oldLink.id);\n    if (linkType === \"charges\" && otherItem && hasProperty(otherItem, \"links.charges\")) {\n      delete otherItem.links.charges;\n    }\n  }\n\n  /**\n   * Generates lists of change subtargets this item can have.\n   *\n   * @param {string} target - The target key, as defined in CONFIG.FFD20.buffTargets.\n   * @returns {Object<string, string>} A list of changes\n   */\n  getChangeSubTargets(target) {\n    const result = {};\n    // Add specific skills\n    if (target === \"skill\") {\n      if (this.parent == null) {\n        for (const [s, skl] of Object.entries(CONFIG.FFD20.skills)) {\n          result[`skill.${s}`] = skl;\n        }\n      } else {\n        const actorSkills = mergeObject(duplicate(CONFIG.FFD20.skills), this.parent.data.skills);\n        for (const [s, skl] of Object.entries(actorSkills)) {\n          if (!skl.subSkills) {\n            if (skl.custom) result[`skill.${s}`] = skl.name;\n            else result[`skill.${s}`] = CONFIG.FFD20.skills[s];\n          } else {\n            for (const [s2, skl2] of Object.entries(skl.subSkills)) {\n              result[`skill.${s}.subSkills.${s2}`] = `${CONFIG.FFD20.skills[s]} (${skl2.name})`;\n            }\n          }\n        }\n      }\n    }\n    // Add static subtargets\n    else if (hasProperty(CONFIG.FFD20.buffTargets, target)) {\n      for (const [k, v] of Object.entries(CONFIG.FFD20.buffTargets[target])) {\n        if (!k.startsWith(\"_\") && !k.startsWith(\"~\")) result[k] = v;\n      }\n    }\n\n    return result;\n  }\n\n  async addChange() {\n    const change = new ItemChange({}, this);\n    return change;\n  }\n\n  /**\n   * Returns the currency this item contains\n   *\n   * @param {object} [options] - Additional options affecting how the value is returned\n   * @param {boolean} [options.inLowestDenomination=false] - Whether to return the value in copper, or in gil (default)\n   * @returns {number} The total amount of currency this item contains, in gil pieces\n   */\n  getTotalCurrency({ inLowestDenomination = false } = {}) {\n    return 0;\n  }\n\n  /**\n   * Returns the displayed value of an item according to multiple options\n   *\n   * @param {object} [options] - Various optional parameters affecting value calculations\n   * @param {boolean} [options.recursive=true] - Whether the value of contained items should be included\n   * @param {number} [options.sellValue=0.5] - The sell value multiplier\n   * @param {boolean} [options.inLowestDenomination=false] - Whether the value should be returned in the lowest denomination\n   * @param {boolean} [options.forceUnidentified=false] - Override whether the value should use the unidentified price\n   * @returns {number} The item's value\n   */\n  getValue({ recursive = true, sellValue = 0.5, inLowestDenomination = false, forceUnidentified = false } = {}) {\n    let result = 0;\n\n    const getActualValue = (identified = true) => {\n      let value = 0;\n      if (identified) value = this.system.price;\n      else value = this.system.unidentified.price;\n\n      // Add charge price\n      if (identified) value += (this.system.uses?.pricePerUse ?? 0) * (this.system.uses?.value ?? 0);\n\n      if (inLowestDenomination) value *= 100;\n      if (this.system.broken) value *= 0.75; // TODO: Make broken value configurable\n      return value;\n    };\n\n    const quantity = getProperty(this, \"system.quantity\") || 0;\n\n    // Add item's price\n    result += getActualValue(forceUnidentified ? false : !this.showUnidentifiedData) * quantity;\n\n    // Modify sell value\n    if (!(this.type === \"loot\" && this.system.subType === \"tradeGoods\")) result *= sellValue;\n\n    // Add item's contained currencies at full value\n    result += this.getTotalCurrency({ inLowestDenomination });\n\n    return result;\n  }\n\n  /**\n   * Converts currencies of the given category to the given currency type\n   *\n   * @param {string} type - Either 'pgil', 'gil', 'sgil' or 'cgil'. Converts as much currency as possible to this type.\n   */\n  convertCurrency(type = \"pgil\") {\n    const totalValue = this.getTotalCurrency();\n    const values = [0, 0, 0, 0];\n    switch (type) {\n      case \"pgil\":\n        values[0] = Math.floor(totalValue / 10);\n        values[1] = Math.max(0, Math.floor(totalValue) - values[0] * 10);\n        values[2] = Math.max(0, Math.floor(totalValue * 10) - values[0] * 100 - values[1] * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[0] * 1000 - values[1] * 100 - values[2] * 10);\n        break;\n      case \"gil\":\n        values[1] = Math.floor(totalValue);\n        values[2] = Math.max(0, Math.floor(totalValue * 10) - values[1] * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[1] * 100 - values[2] * 10);\n        break;\n      case \"sgil\":\n        values[2] = Math.floor(totalValue * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[2] * 10);\n        break;\n      case \"cgil\":\n        values[3] = Math.floor(totalValue * 100);\n        break;\n    }\n\n    const updateData = {};\n    updateData[`data.currency.pgil`] = values[0];\n    updateData[`data.currency.gil`] = values[1];\n    updateData[`data.currency.sgil`] = values[2];\n    updateData[`data.currency.cgil`] = values[3];\n    return this.update(updateData);\n  }\n\n  _calculateCoinWeight(data) {\n    const coinWeightDivisor = game.settings.get(\"ffd20\", \"coinWeight\");\n    if (!coinWeightDivisor) return 0;\n    return (\n      Object.values(getProperty(data, \"currency\") || {}).reduce((cur, amount) => {\n        return cur + amount;\n      }, 0) / coinWeightDivisor\n    );\n  }\n\n  /**\n   * Sets a boolean flag on this item.\n   *\n   * @param {string} flagName - The name/key of the flag to set.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async addItemBooleanFlag(flagName, context = {}) {\n    flagName = String(flagName);\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n\n    if (Array.isArray(flags)) throw new Error(`${this.name} [${this.id}] requires migration.`);\n\n    if (flags[flagName] === undefined) {\n      await this.update({ [`data.flags.boolean.${flagName}`]: true }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Removes a boolean flag from this item.\n   *\n   * @param {string} flagName - The name/key of the flag to remove.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async removeItemBooleanFlag(flagName, context = {}) {\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n\n    if (flags[flagName] !== undefined) {\n      await this.update({ [`data.flags.boolean.-=${flagName}`]: null }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * @param {string} flagName - The name/key of the flag on this item.\n   * @returns {boolean} Whether the flag was found on this item.\n   */\n  hasItemBooleanFlag(flagName) {\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n    return flags[flagName] === true;\n  }\n\n  /**\n   * Get all item boolean flags as array.\n   *\n   * @returns {string[]}\n   */\n  getItemBooleanFlags() {\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n    return Object.keys(flags);\n  }\n\n  /**\n   * Sets a dictionary flag value on this item.\n   *\n   * @param {string} flagName - The name/key of the flag to set.\n   * @param {number|string} value - The flag's new value.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async setItemDictionaryFlag(flagName, value, context = {}) {\n    flagName = String(flagName);\n    const flags = duplicate(getProperty(this, \"system.flags.dictionary\") ?? {});\n\n    if (flags[flagName] !== value) {\n      await this.update({ [`data.flags.dictionary.${flagName}`]: value }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Removes a dictionary flag from this item.\n   *\n   * @param {string} flagName - The name/key of the flag to remove.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async removeItemDictionaryFlag(flagName, context = {}) {\n    const flags = getProperty(this, \"system.flags.dictionary\") ?? {};\n\n    if (flags[flagName] !== undefined) {\n      await this.update({ [`data.flags.dictionary.-=${flagName}`]: null }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * @param {string} flagName - The name/key of the flag to get.\n   * @returns {object} The value stored in the flag.\n   */\n  getItemDictionaryFlag(flagName) {\n    const flags = getProperty(this, \"system.flags.dictionary\") || {};\n    return flags[flagName];\n  }\n\n  /**\n   * Get all item dictionary flags as array of objects.\n   *\n   * @returns {object[]}\n   */\n  getItemDictionaryFlags() {\n    const flags = getProperty(this, \"system.flags.dictionary\") || {};\n    return flags;\n  }\n\n  /**\n   * Get attack array for specific action.\n   *\n   * @param {string} actionId Action identifier.\n   * @returns {number[]} Simple array describing the individual guaranteed attacks.\n   */\n  getAttackArray(actionId) {\n    const action = this.actions.get(actionId),\n      actionData = action?.data,\n      rollData = action?.getRollData(),\n      attacks = [0];\n    if (!actionData) return attacks;\n\n    const appendAttack = (formula) => {\n      const bonus = RollFFD20.safeRoll(formula, rollData).total;\n      if (Number.isFinite(bonus)) attacks.push(bonus);\n    };\n\n    // Static extra attacks\n    const extraAttacks = actionData.attackParts.map((n) => n[0]?.toString().trim()).filter((n) => n?.length > 0);\n    for (const formula of extraAttacks) appendAttack(formula);\n\n    // Formula-based extra attacks\n    const fmAtk = actionData.formulaicAttacks?.count?.formula?.trim();\n    if (fmAtk?.length > 0) {\n      const fmAtkBonus = actionData.formulaicAttacks?.bonus?.formula?.trim() || \"0\";\n      const count = RollFFD20.safeRoll(fmAtk, rollData);\n      for (let i = 0; i < count.total; i++) {\n        rollData.formulaicAttack = i + 1;\n        appendAttack(fmAtkBonus);\n      }\n      delete rollData.formulaicAttack;\n    }\n\n    // Conditional modifiers\n    const condBonuses = new Array(attacks.length).fill(0);\n    actionData.conditionals\n      .filter((c) => c.default && c.modifiers.find((sc) => sc.target === \"attack\"))\n      .forEach((c) => {\n        c.modifiers.forEach((cc) => {\n          const bonusRoll = RollFFD20.safeRoll(cc.formula, rollData);\n          if (bonusRoll.total == 0) return;\n          if (cc.subTarget?.match(/^attack\\.(\\d+)$/)) {\n            const atk = parseInt(RegExp.$1, 10);\n            if (atk in condBonuses) condBonuses[atk] += bonusRoll.total;\n          }\n        });\n      });\n\n    const sources = this.getAttackSources(actionId);\n    const totalBonus = sources.reduce((f, s) => f + s.value, 0);\n\n    return attacks.map((a, i) => a + totalBonus + condBonuses[i]);\n  }\n\n  /**\n   * Get default action's attack array.\n   *\n   * @returns {number[]} Simple array describing the individual guaranteed attacks.\n   */\n  get attackArray() {\n    return this.getAttackArray(this.firstAction.id);\n  }\n\n  /**\n   * Attack sources for a specific action.\n   *\n   * @param actionId\n   * @returns {object[]} Array of value and label pairs for attack bonus sources on the main attack.\n   */\n  getAttackSources(actionId) {\n    const action = this.actions.get(actionId);\n    if (!action) return;\n\n    const sources = [];\n\n    const actorData = this.parentActor?.system,\n      itemData = this.system,\n      actionData = action.data;\n\n    if (!actorData || !actionData) return sources;\n    const rollData = action.getRollData();\n\n    // Attack type identification\n    const isMelee =\n      [\"mwak\", \"msak\", \"mcman\"].includes(actionData.actionType) || [\"melee\", \"reach\"].includes(actionData.range.units);\n    const isRanged =\n      [\"rwak\", \"rsak\", \"rcman\"].includes(actionData.actionType) || this.system.weaponSubtype === \"ranged\";\n    const isManeuver = [\"mcman\", \"rcman\"].includes(actionData.actionType);\n\n    const describePart = (value, label, sort = 0) => {\n      sources.push({ value, label, sort });\n    };\n\n    // BAB is last for some reason, array is reversed to try make it the first.\n    const srcDetails = (s) => s?.reverse().forEach((d) => describePart(d.value, d.name, -10));\n\n    // Unreliable melee/ranged identification\n    const sizeBonus = !isManeuver\n      ? CONFIG.FFD20.sizeMods[rollData.traits.size]\n      : CONFIG.FFD20.sizeSpecialMods[rollData.traits.size];\n\n    // Add size bonus\n    if (sizeBonus != 0) describePart(sizeBonus, game.i18n.localize(\"FFD20.Size\"), -20);\n\n    srcDetails(this.parentActor.sourceDetails[\"system.attributes.attack.shared\"]);\n    if (isManeuver) srcDetails(this.parentActor.sourceDetails[\"system.attributes.cmb.bonus\"]);\n    srcDetails(this.parentActor.sourceDetails[\"system.attributes.attack.general\"]);\n\n    const changeSources = [];\n    if (isRanged) changeSources.push(\"rattack\");\n    if (isMelee) changeSources.push(\"mattack\");\n    const effectiveChanges = getHighestChanges(\n      this.parentActor.changes.filter((c) => changeSources.includes(c.subTarget)),\n      { ignoreTarget: true }\n    );\n    effectiveChanges.forEach((ic) => describePart(ic.value, ic.flavor, -800));\n\n    if (actionData.ability.attack) {\n      const ablMod = getProperty(actorData, `abilities.${actionData.ability.attack}.mod`) ?? 0;\n      describePart(ablMod, CONFIG.FFD20.abilities[actionData.ability.attack], -50);\n    }\n\n    // Attack bonus formula\n    const bonusRoll = RollFFD20.safeRoll(actionData.attackBonus || \"0\", rollData);\n    if (bonusRoll.total != 0)\n      describePart(bonusRoll.total, bonusRoll.flavor ?? game.i18n.localize(\"FFD20.AttackRollBonus\"), -100);\n\n    // Masterwork or enhancement bonus\n    // Only add them if there's no larger enhancement bonus from some other source\n    const virtualEnh = action.enhancementBonus ?? (itemData.masterwork ? 1 : 0);\n    if (!effectiveChanges.find((i) => i.modifier === \"enh\" && i.value > virtualEnh)) {\n      if (Number.isFinite(action.enhancementBonus) && action.enhancementBonus !== 0) {\n        describePart(action.enhancementBonus, game.i18n.localize(\"FFD20.EnhancementBonus\"), -300);\n      } else if (itemData.masterwork) {\n        describePart(1, game.i18n.localize(\"FFD20.Masterwork\"), -300);\n      }\n    }\n\n    // Add proficiency penalty\n    if (!itemData.proficient) {\n      describePart(-4, game.i18n.localize(\"FFD20.ProficiencyPenalty\"), -500);\n    }\n\n    // Broken condition\n    if (itemData.broken) {\n      describePart(-2, game.i18n.localize(\"FFD20.Broken\"), -500);\n    }\n\n    // Add secondary natural attack penalty\n    if (actionData.naturalAttack.primaryAttack !== true && itemData.attackType === \"natural\") {\n      const attackBonus = actionData.naturalAttack?.secondary?.attackBonus || \"-5\";\n      const secondaryModifier = RollFFD20.safeTotal(`${attackBonus}`, rollData);\n      describePart(secondaryModifier, game.i18n.localize(\"FFD20.SecondaryAttack\"), -400);\n    }\n\n    // Conditional modifiers\n    actionData.conditionals\n      .filter((c) => c.default && c.modifiers.find((sc) => sc.target === \"attack\"))\n      .forEach((c) => {\n        c.modifiers.forEach((cc) => {\n          if (cc.subTarget === \"allAttack\") {\n            const bonusRoll = RollFFD20.safeRoll(cc.formula, rollData);\n            if (bonusRoll.total == 0) return;\n            describePart(bonusRoll.total, c.name, -5000);\n          }\n        });\n      });\n\n    return sources.sort((a, b) => b.sort - a.sort);\n  }\n\n  /**\n   * Return attack sources for default action.\n   *\n   * @returns {object[]} Array of value and label pairs for attack bonus sources on the main attack.\n   */\n  get attackSources() {\n    return this.getAttackSources(this.firstAction.id);\n  }\n\n  /**\n   * Generic damage source retrieval\n   *\n   * @deprecated\n   */\n  get damageSources() {\n    foundry.utils.logCompatibilityWarning(\"ItemFFD20.damageSources is deprecated, use ItemAction.damageSources instead\", {\n      since: \"FFD20 0.82.2\",\n      until: \"FFD20 0.83.0\",\n    });\n    return this.firstAction?.damageSources ?? [];\n  }\n\n  getAllDamageSources(actionId) {\n    const action = this.actions.get(actionId);\n    if (!action) return;\n\n    const conds = action.data.conditionals\n      .filter((c) => c.default)\n      .filter((c) => c.modifiers.find((m) => m.target === \"damage\"));\n    const rollData = action.getRollData();\n\n    if (!rollData) return [];\n\n    const mods = Object.keys(CONFIG.FFD20.bonusModifiers);\n\n    // Turn relevant conditionals into structure accepted by getHighestChanges\n    const fakeCondChanges = [];\n    for (const c of conds) {\n      for (const m of c.modifiers) {\n        if (m.target !== \"damage\") continue;\n        const roll = RollFFD20.safeRoll(m.formula, rollData);\n        if (roll.err) continue;\n        const isModifier = mods.includes(m.type);\n        fakeCondChanges.push({\n          flavor: c.name,\n          value: roll.total,\n          modifier: isModifier ? m.type : \"untyped\", // Turn unrecognized types to untyped\n          type: isModifier ? undefined : m.type, // Preserve damage type if present\n          formula: m.formula,\n        });\n      }\n    }\n\n    const allChanges = [...action.damageSources, ...fakeCondChanges];\n\n    // Add enhancement bonus\n    if (action.enhancementBonus) {\n      allChanges.push({\n        flavor: game.i18n.localize(\"FFD20.EnhancementBonus\"),\n        value: action.enhancementBonus,\n        modifier: \"enh\",\n        formula: action.enhancementBonus.toString(),\n      });\n    }\n\n    // Add special cases specific to the item\n    // Broken\n    if (this.system.broken) {\n      allChanges.push({\n        flavor: game.i18n.localize(\"FFD20.Broken\"),\n        value: -2,\n        modifier: \"untyped\",\n        formula: \"-2\",\n      });\n    }\n\n    return getHighestChanges(allChanges, { ignoreTarget: true });\n  }\n\n  /**\n   * Generic damage source retrieval, includes default conditionals and other item specific modifiers.\n   */\n  get allDamageSources() {\n    return this.getAllDamageSources(this.firstAction.id);\n  }\n\n  /**\n   * @param {boolean} active\n   * @param {object} context Optional update context\n   * @returns Update promise if item type supports the operation.\n   */\n  setActive(active, context) {\n    throw new Error(`Item type ${this.type} does not support ItemFFD20#setActive`);\n  }\n}\n\n/**\n * @typedef {object} ItemWeightData\n * An item's `weight` data. The only property to be stored is `value`, from which all other values are derived.\n * @see {@link ItemFFD20.prepareWeight} for generation\n * @remarks A weight property is considered \"effective\" if it is the value that is added to its parent's weight.\n *          An item with a weight of 10 lbs in a container with 50% weight reduction would increase\n *          the container's effective `weight.total` by 5 lbs, but increases the container's `weight.contents` weight by 10 lbs.\n * @property {number} value - The weight of a single item instance, in lbs\n * @property {number} total - The effective total weight of the item (including quantity and contents), in lbs\n * @property {number} [currency] - Effective weight of contained currency for containers, in lbs\n * @property {number} [contents] - Weight of contained items and currency, in lbs\n * @property {object} converted - Weight of this item, converted to the current unit system\n * @property {number} converted.value - The weight of a single item instance, in world units\n * @property {number} converted.total - The effective total weight of the item (including quantity and contents), in world units\n * @property {number} [converted.contents] - Weight of contained items and currency, in world units\n */\n\n/**\n * @typedef {object} ChatData\n * Data required to render an item's summary or chat card, including descriptions and properties/tags/labels\n * @property {string} description - The item's enriched description as appropriate for the current user\n * @property {string} identifiedDescription - The item's full enriched description when identified\n * @property {string} unidentifiedDescription - The item's enriched description when unidentified\n * @property {string} [actionDescription] - The enriched description of a specific action\n * @property {string[]} properties - Additional properties/labels for the item and the action\n */\n\n/**\n * @typedef {object} SharedActionData\n * A common data object used to store and share data between stages of an action's usage.\n * @property {Event | null} event - The event that triggered the action. Defaults to `null`.\n * @property {object} rollData - The singular rollData object used for all rolls in the action\n * @property {boolean} skipDialog - Whether the user-facing dialog should get skipped. Defaults to `false`.\n * @property {boolean} chatMessage - Whether a chat message should be created at the end of the action's usage. Defaults to `true`.\n * @property {string} dice - The base dice used for the action's attack rolls. Defaults to `\"1d20\"`.\n * @property {boolean} fullAttack - Whether the action is a full attack. Defaults to `true`.\n * @property {string[]} attackBonus - Bonus values to be added to the attack roll formula\n * @property {string[]} damageBonus - Bonus values to be added to the damage roll formula\n * @property {object[]} attacks - Array of attacks\n * @property {import(\"@actionUse/chat-attack.mjs\").ChatAttack[]} chatAttacks - Array of chat attacks for this action's use\n * @property {string} rollMode - The roll mode to be used for the creation of the chat message. Defaults to the `core.rollMode` setting.\n * @property {boolean} useMeasureTemplate - Whether to use a measure template\n * @property {object[] | null} conditionals\n * @property {object} conditionalPartsCommon\n * @property {boolean} casterLevelCheck\n * @property {boolean} concentrationCheck\n * @property {object} scriptData\n * @property {ItemAction} action - The {@link ItemAction} this use is based on\n * @property {ItemFFD20} item - The {@link ItemFFD20} this use is based on\n * @property {object} chatData - Data to be passed to {@link ChatMessage.create}, excluding `content` rendered using {@link templateData} and {@link template}.\n * @property {string} [chatTemplate] - The template to be used for the creation of the chat message.\n * @property {object} templateData - Data used to render the chat card, passed to {@link foundry.utils.renderTemplate}.\n */\n","export const LinkFunctions = {\n  charges: function (item, links) {\n    for (const l of links) {\n      const otherItem = this.items.get(l.id);\n      if (!otherItem) continue;\n\n      otherItem.links.charges = item;\n      otherItem.prepareLinks();\n    }\n  },\n};\n","import { calculateRange } from \"../../../utils/lib.mjs\";\n\n/**\n * Spellbook details.\n */\nexport class Spellbook {\n  /**\n   * Book key.\n   */\n  key;\n\n  /**\n   * Owning actor.\n   */\n  actor;\n\n  /**\n   * Raw spellbook data.\n   */\n  data;\n\n  /**\n   * All spells.\n   */\n  spells = [];\n\n  level = {};\n\n  /**\n   * @param bookKey Book key.\n   * @param {ActorFFD20} actor Owning actor.\n   */\n  constructor(bookKey, actor) {\n    this.actor = actor;\n    this.data = actor.system.attributes.spells.spellbooks[bookKey];\n  }\n\n  /**\n   * Add spell to the spellbook and to its appropriate level.\n   *\n   * @param {ItemSpellFFD20} spell\n   */\n  addSpell(spell) {\n    this.spells.push(spell);\n\n    // Basic sanity check\n    const level = spell.system.level;\n    if (Math.clamped(level, 0, 9) !== level) {\n      console.error(\"Spell with impossible spell level:\", spell);\n      return;\n    }\n\n    // Ensure appropriate spell level exists\n    this.level[level] ??= new SpellbookLevel(this);\n\n    // Add spell to the spell level also\n    this.level[level].spells.push(spell);\n  }\n}\n\n/**\n * Spellbook leveled details.\n */\nexport class SpellbookLevel {\n  /**\n   * Owning book.\n   */\n\n  book;\n  /**\n   * Spells for level.\n   */\n  spells = [];\n\n  constructor(book) {\n    this.book = book;\n  }\n}\n\nexport class SpellbookSlots {\n  max;\n  value;\n  domain;\n  domainMax;\n  domainUnused = 0;\n  used = 0;\n\n  constructor({ value = 0, max = 0, domain = 0 } = {}) {\n    this.value = value ?? 0;\n    this.max = max ?? 0;\n\n    this.domain = domain ?? 0;\n    this.domainMax = this.domain;\n    this.domainUnused = this.domainMax;\n  }\n}\n\nexport class SpellRanges {\n  close;\n  medium;\n  long;\n\n  cl;\n\n  constructor(cl) {\n    this.cl = cl;\n    this.close = calculateRange(null, \"close\", { cl });\n    this.medium = calculateRange(null, \"medium\", { cl });\n    this.long = calculateRange(null, \"long\", { cl });\n  }\n}\n\nexport class SpellbookMode {\n  raw;\n\n  get isHybrid() {\n    return this.raw === \"hybrid\";\n  }\n\n  get isPrestige() {\n    return this.raw === \"prestige\";\n  }\n\n  get isSpontaneous() {\n    return this.raw === \"spontaneous\";\n  }\n\n  get isPrepared() {\n    return this.raw === \"prepared\";\n  }\n\n  get isSemiSpontaneous() {\n    return this.isSpontaneous || this.isHybrid || this.isPrestige;\n  }\n\n  constructor(book) {\n    let mode = book.spellPreparationMode;\n\n    // Shunt invalid mode\n    if (!mode) mode = book.spellPreparationMode = \"spontaneous\";\n\n    this.raw = mode;\n  }\n}\n","import { ActorBaseFFD20 } from \"./actor-base.mjs\";\nimport { getAbilityModifier } from \"@utils\";\nimport { ItemFFD20 } from \"../item/item-ffd20.mjs\";\nimport { createTag, fractionalToString } from \"../../utils/lib.mjs\";\nimport { createCustomChatMessage } from \"../../utils/chat.mjs\";\nimport { LinkFunctions } from \"../../utils/links.mjs\";\nimport { getSkipActionPrompt } from \"../settings.mjs\";\nimport {\n  applyChanges,\n  addDefaultChanges,\n  getChangeFlat,\n  getSourceInfo,\n  setSourceInfoByName,\n  getHighestChanges,\n} from \"./utils/apply-changes.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\nimport { Spellbook, SpellRanges, SpellbookMode, SpellbookSlots } from \"./utils/spellbook.mjs\";\nimport { ItemChange } from \"../../components/change.mjs\";\nimport { callOldNamespaceHook, callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n/**\n * Extend the base Actor class to implement additional game system logic.\n */\nexport class ActorFFD20 extends ActorBaseFFD20 {\n  static get relativeAttributes() {\n    return [\"system.attributes.hp\", \"system.attributes.wounds\", \"system.attributes.vigor\", \"system.attributes.mp\"];\n  }\n\n  constructor(...args) {\n    super(...args);\n\n    if (this.itemFlags === undefined)\n      /**\n       * Init item flags.\n       */\n      this.itemFlags = { boolean: {}, dictionary: {} };\n\n    if (this.changeItems === undefined)\n      /**\n       * A list of all the active items with changes.\n       *\n       * @type {ItemFFD20[]}\n       */\n      this.changeItems = [];\n\n    if (this.changes === undefined)\n      /**\n       * Stores all ItemChanges from carried items.\n       *\n       * @public\n       * @type {Collection<ItemChange>}\n       */\n      this.changes = new Collection();\n\n    if (this._queuedUpdates === undefined)\n      /**\n       * Stores updates to be applied to the actor near the end of the _onUpdate method.\n       *\n       * @private\n       * @type {Object<string, any>}\n       */\n      this._queuedUpdates = {};\n\n    if (this._rollData === undefined)\n      /**\n       * Cached roll data for this item.\n       *\n       * @type {object}\n       */\n      this._rollData = null;\n\n    if (this._runningFunctions === undefined)\n      /**\n       * Keeps track of currently running async functions that shouldn't run multiple times simultaneously.\n       *\n       * @type {Object<string>}\n       */\n      this._runningFunctions = {};\n\n    if (this.containerItems === undefined)\n      /**\n       * All items this actor is holding in containers.\n       *\n       * @type {ItemFFD20[]}\n       */\n      this.containerItems = [];\n\n    if (this._states === undefined)\n      /**\n       * Tracks various states which need to be tracked.\n       *\n       * @type {object}\n       */\n      this._states = {};\n\n    /**\n     * Race cache\n     */\n    this._race ??= null;\n  }\n\n  _preCreate(data, options, user) {\n    super._preCreate(data, options, user);\n\n    let updates = {};\n    if (typeof this.preCreateData === \"function\") {\n      updates = this.preCreateData(data, options, user);\n    }\n\n    if (Object.keys(updates).length) return this.system.update(updates);\n  }\n\n  /**\n   * Meant to be overridden.\n   *\n   * @param data\n   * @param options\n   * @param user\n   * @returns {object} Update data to replace with.\n   */\n  preCreateData(data, options, user) {\n    return {};\n  }\n\n  /* -------------------------------------------- */\n\n  static chatListeners(html) {\n    html.on(\"click\", \"button[data-action], a[data-action]\", this._onChatCardButtonAction.bind(this));\n  }\n\n  static async _onChatCardButtonAction(event) {\n    event.preventDefault();\n\n    // Extract card data\n    const button = event.currentTarget;\n    const card = button.closest(\".chat-card\");\n    const action = button.dataset.action;\n\n    // Roll saving throw\n    if (action === \"defense-save\") {\n      const actor = await ItemFFD20._getChatCardActor(card);\n      const saveId = button.dataset.save;\n      if (actor) actor.rollSavingThrow(saveId, { event: event, skipPrompt: getSkipActionPrompt() });\n    } else if (action === \"save\") {\n      const actors = ActorFFD20.getSelectedActors();\n      const saveId = button.dataset.type;\n      let noSound = false;\n      for (const a of actors) {\n        a[0].rollSavingThrow(saveId, { event: event, noSound: noSound, skipPrompt: getSkipActionPrompt() });\n        noSound = true;\n      }\n    }\n    // Show compendium entry\n    else if (action === \"open-compendium-entry\") {\n      const uuid = button.dataset.compendiumEntry;\n      const document = await fromUuid(uuid);\n\n      if (document instanceof JournalEntryPage) {\n        document.parent.sheet.render(true, { pageId: document.id });\n      } else {\n        document.sheet.render(true);\n      }\n    }\n  }\n\n  static getActiveActor({ actorName = null, actorId = null } = {}) {\n    const speaker = ChatMessage.getSpeaker();\n    let actor;\n\n    if (actorName || actorId) {\n      actor = game.actors.contents.find((o) => {\n        if (actorName && o.name !== actorName) return false;\n        if (actorId && o.id !== actorId) return false;\n        return true;\n      });\n    }\n    if (speaker.token && !actor) actor = canvas.tokens.get(speaker.token)?.actor;\n    if (!actor) actor = game.actors.get(speaker.actor);\n\n    return actor;\n  }\n\n  /**\n   * Returns an array of all selected tokens, along with their actors.\n   *\n   * @returns {Array.<ActorFFD20, Token>[]}\n   */\n  static getSelectedActors() {\n    const result = [];\n    for (const t of canvas.tokens.controlled) {\n      result.push([t.actor, t]);\n    }\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  get spellFailure() {\n    return this.items\n      .filter((o) => {\n        return o.type === \"equipment\" && o.system.equipped === true;\n      })\n      .reduce((cur, o) => {\n        if (typeof o.system.spellFailure === \"number\") return cur + o.system.spellFailure;\n        return cur;\n      }, 0);\n  }\n\n  /**\n   * @returns {ItemRaceFFD20|null}\n   */\n  get race() {\n    return this._race;\n  }\n\n  get typeColor() {\n    return \"#FDE600\";\n  }\n\n  static _translateSourceInfo(type, subtype, name) {\n    let result = \"\";\n    if (type === \"size\") result = game.i18n.localize(\"FFD20.SourceInfoSize\");\n    if (type === \"buff\") {\n      result = game.i18n.localize(\"FFD20.SourceInfoBuffs\");\n      if (subtype === \"temp\") result = game.i18n.localize(\"FFD20.SourceInfoTemporaryBuffs\");\n      if (subtype === \"perm\") result = game.i18n.localize(\"FFD20.SourceInfoPermanentBuffs\");\n      if (subtype === \"item\") result = game.i18n.localize(\"FFD20.SourceInfoItemBuffs\");\n      if (subtype === \"misc\") result = game.i18n.localize(\"FFD20.SourceInfoMiscBuffs\");\n    }\n    if (type === \"equipment\") result = game.i18n.localize(\"FFD20.SourceInfoEquipment\");\n    if (type === \"weapon\") result = game.i18n.localize(\"FFD20.SourceInfoWeapons\");\n    if (type === \"feat\") {\n      result = game.i18n.localize(\"FFD20.SourceInfoFeats\");\n      if (subtype === \"classFeat\") result = game.i18n.localize(\"FFD20.SourceInfoClassFeatures\");\n      if (subtype === \"trait\") result = game.i18n.localize(\"FFD20.SourceInfoTraits\");\n      if (subtype === \"racial\") result = game.i18n.localize(\"FFD20.SourceInfoRacialTraits\");\n      if (subtype === \"misc\") result = game.i18n.localize(\"FFD20.SourceInfoMiscFeatures\");\n      if (subtype === \"template\") result = game.i18n.localize(\"FFD20.SourceInfoTemplate\");\n    }\n    if (type === \"race\") {\n      result = game.i18n.localize(\"FFD20.SourceInfoRace\");\n    }\n\n    if (!name || name.length === 0) return result;\n    if (result === \"\") return name;\n    return `${result} (${name})`;\n  }\n\n  static _getChangeItemSubtype(item) {\n    if (item.type === \"buff\") return item.system.buffType;\n    if (item.type === \"feat\") return item.system.featType;\n    return \"\";\n  }\n\n  get _skillTargets() {\n    const skills = [];\n    const subSkills = [];\n    for (const [sklKey, skl] of Object.entries(this.system.skills)) {\n      if (skl == null) continue;\n      if (skl.subSkills != null) {\n        for (const subSklKey of Object.keys(skl.subSkills)) {\n          subSkills.push(`skill.${sklKey}.subSkills.${subSklKey}`);\n        }\n      } else skills.push(`skill.${sklKey}`);\n    }\n    return [...skills, ...subSkills];\n  }\n\n  _prepareContainerItems(items) {\n    const collection = [];\n\n    const getContainerContents = function (item) {\n      if (item.type !== \"container\") return;\n\n      item.items.forEach((i) => {\n        collection.push(i);\n        getContainerContents(i);\n      });\n    };\n\n    items.forEach((item) => {\n      getContainerContents(item);\n    });\n\n    return collection;\n  }\n\n  _prepareItemFlags(items) {\n    const bFlags = {};\n    const dFlags = {};\n\n    for (const i of items) {\n      // Process boolean flags\n      if (i.isActive) {\n        const flags = getProperty(i, \"system.flags.boolean\") || {};\n        for (const f of Object.keys(flags)) {\n          bFlags[f] ??= { sources: [] };\n          bFlags[f].sources.push(i);\n        }\n      }\n\n      // Process dictionary flags\n      const tag = i.system.tag;\n      if (tag) {\n        const flags = getProperty(i, \"system.flags.dictionary\") || {};\n        for (const [key, value] of Object.entries(flags)) {\n          setProperty(dFlags, `${tag}.${key}`, i.isActive ? value : 0);\n        }\n      }\n    }\n\n    this.itemFlags = {\n      boolean: bFlags,\n      dictionary: dFlags,\n    };\n  }\n\n  _prepareChanges() {\n    this.changeItems = this.items\n      .filter((obj) => {\n        return (\n          (obj.system.changes instanceof Array && obj.system.changes.length) ||\n          (obj.system.changeFlags && Object.values(obj.system.changeFlags).filter((o) => o === true).length)\n        );\n      })\n      .filter((obj) => obj.isActive);\n\n    const changes = [];\n    for (const i of this.changeItems) {\n      changes.push(...i.changes);\n    }\n    addDefaultChanges.call(this, changes);\n\n    const c = new Collection();\n    for (const change of changes) {\n      c.set(change._id, change);\n    }\n    this.changes = c;\n  }\n\n  applyActiveEffects() {\n    super.applyActiveEffects();\n\n    this.containerItems = this._prepareContainerItems(this.items);\n    this._prepareItemFlags(this.allItems);\n    this._prepareChanges();\n  }\n\n  prepareData() {\n    this.sourceInfo = {};\n    this.changeFlags = {};\n\n    // Prepare data\n    super.prepareData();\n\n    this._initialized = true;\n    this._setSourceDetails(this.sourceInfo);\n  }\n\n  /**\n   * Deletes expired temporary active effects and disables linked expired buffs.\n   *\n   * @param {DocumentModificationContext} context\n   */\n  async expireActiveEffects(context = {}) {\n    const temporaryEffects = this.temporaryEffects.filter(\n      (ae) => Number.isFinite(ae.duration?.remaining) && ae.duration?.remaining <= 0\n    );\n    const disableActiveEffects = [],\n      disableBuffs = [];\n    for (const ae of temporaryEffects) {\n      const re = ae.data.origin?.match(/Item\\.(?<itemId>\\w+)/);\n      const item = this.items.get(re?.groups.itemId);\n      if (!item || item.type !== \"buff\") {\n        disableActiveEffects.push({ _id: ae.id, active: false });\n      } else {\n        disableBuffs.push({ _id: item.id, \"system.active\": false });\n      }\n    }\n    const disableAEContext = mergeObject({ render: !disableBuffs.length }, context);\n    if (disableActiveEffects.length)\n      await this.updateEmbeddedDocuments(\"ActiveEffect\", disableActiveEffects, disableAEContext);\n    if (disableBuffs.length) await this.updateEmbeddedDocuments(\"Item\", disableBuffs, context);\n  }\n\n  /**\n   * Prepare actor data before items are prepared.\n   *\n   * @override\n   */\n  prepareBaseData() {\n    super.prepareBaseData();\n\n    // Reset equipment info\n    this.equipment = {\n      shield: { type: 0, id: undefined },\n      armor: { type: 0, id: undefined },\n    };\n    // Reset class info\n    this.classes = {};\n\n    // HACK: Init missing resources structure. Needed mostly for JSON imports.\n    this.resources ??= {};\n\n    this._resetInherentTotals();\n    callOldNamespaceHookAll(\"ffd20.prepareBaseActorData\", \"ffd20PrepareBaseActorData\", this);\n    Hooks.callAll(\"ffd20PrepareBaseActorData\", this);\n\n    // Update total level and mythic tier\n    const classes = this.items.filter((o) => o.type === \"class\");\n    const { level, mythicTier } = classes.reduce(\n      (cur, o) => {\n        o.prepareDerivedData(); // HACK: Out of order preparation for later.\n        cur.level += o.hitDice;\n        cur.mythicTier += o.mythicTier;\n        return cur;\n      },\n      { level: 0, mythicTier: 0 }\n    );\n\n    this.system.details.level.value = level;\n    this.system.details.mythicTier = mythicTier;\n\n    // Populate conditions\n    for (const condition of Object.keys(CONFIG.FFD20.conditions)) {\n      this.system.attributes.conditions[condition] ??= false;\n    }\n\n    // Refresh ability scores\n    {\n      const abs = Object.keys(this.system.abilities);\n      for (const ab of abs) {\n        const value = this.system.abilities[ab].value;\n        if (value == null) {\n          this.system.abilities[ab].total = null;\n          this.system.abilities[ab].base = null;\n          this.system.abilities[ab].baseMod = 0;\n        } else {\n          this.system.abilities[ab].total = value - this.system.abilities[ab].drain;\n          this.system.abilities[ab].penalty =\n            (this.system.abilities[ab].penalty || 0) - Math.abs(this.system.abilities[ab].userPenalty || 0);\n          this.system.abilities[ab].base = this.system.abilities[ab].total;\n        }\n      }\n      this.refreshAbilityModifiers();\n    }\n\n    // Reset BAB\n    {\n      const k = \"system.attributes.bab.total\";\n      const v = Math.floor(\n        classes.reduce((cur, cls) => {\n          // HACK: Depends on earlier out of order preparation\n          const bab = cls.system.babBase;\n          if (bab !== 0) {\n            getSourceInfo(this.sourceInfo, k).positive.push({\n              name: cls.name,\n              value: fractionalToString(bab),\n            });\n          }\n          return cur + bab;\n        }, 0)\n      );\n      this.system.attributes.bab.total = Math.floor(v);\n    }\n\n    // Reset HD\n    setProperty(this, \"system.attributes.hd.total\", this.system.details.level.value);\n\n    // recalulate limitbreaks\n    setProperty(this, \"system.attributes.limitbreak.max\",\n      1 + Math.floor(getProperty(this, \"system.details.level.value\") / 4)\n    );\n\n    // Reset class skills\n    {\n      const skillSet = new Set();\n      this.items\n        .filter((actorItems) => [\"class\", \"race\", \"feat\"].includes(actorItems.type))\n        .forEach((relevantActorItems) => {\n          for (const [classSkillName, isClassSkill] of Object.entries(relevantActorItems.system.classSkills || {})) {\n            if (isClassSkill === true) skillSet.add(classSkillName);\n          }\n        });\n\n      for (const [k, s] of Object.entries(this.system.skills)) {\n        if (!s) continue;\n        this.system.skills[k].cs = skillSet.has(k);\n        for (const k2 of Object.keys(s.subSkills ?? {})) {\n          setProperty(s, `subSkills.${k2}.cs`, skillSet.has(k));\n        }\n      }\n    }\n  }\n\n  /**\n   * Checks if there's any matching proficiency\n   *\n   * @param {ItemFFD20 } item - The item to check for.\n   * @param {string} proficiencyName - The proficiency name to look for. e.g. 'lightShield' or 'mediumArmor'.\n   * @returns {boolean} Whether the actor is proficient with that item.\n   */\n  hasArmorProficiency(item, proficiencyName) {\n    // Check for item type\n    if (item.type !== \"equipment\" || ![\"armor\", \"shield\"].includes(item.system.equipmentType)) return true;\n\n    // Custom proficiencies\n    const customProficiencies =\n      this.system.traits.armorProf?.customTotal\n        ?.split(CONFIG.FFD20.re.traitSeparator)\n        .map((item) => item.trim().toLowerCase())\n        .filter((item) => item.length > 0) || [];\n\n    const name = item.name.toLowerCase(),\n      tag = item.system.tag;\n    return (\n      this.system.traits.armorProf.total.includes(proficiencyName) ||\n      customProficiencies.find((prof) => prof.includes(name) || prof.includes(tag)) != undefined\n    );\n  }\n\n  /**\n   * Update specific spellbook.\n   *\n   * @param {string} bookKey\n   * @param {object} rollData\n   * @param {object} cache Pre-calculated data for re-use from _generateSpellbookCache\n   */\n  _updateSpellBook(bookKey, rollData, cache) {\n    const actorData = this.system;\n    const book = actorData.attributes.spells.spellbooks[bookKey];\n    if (!book) {\n      console.error(`Spellbook data not found for \"${bookKey} on actor`, this);\n      return;\n    }\n\n    // Set spellbook label\n    book.label = `FFD20.SpellBook${bookKey.capitalize()}`;\n    if (book.class) {\n      if (book.class === \"_hd\") book.label = \"FFD20.SpellBookSpelllike\";\n      else {\n        const bookClass = this.items.find((o) => o.type === \"class\" && o.system.tag === book.class);\n        if (bookClass != null) book.label = bookClass.name;\n      }\n    }\n    if (book.name) book.label = book.name;\n\n    rollData ??= this.getRollData({ refresh: true });\n    cache ??= this._generateSpellbookCache();\n\n    const bookInfo = cache.books[bookKey];\n\n    const spellbookAbility = actorData.abilities[book.ability];\n\n    // Add spell slots based on ability bonus slot formula\n    const spellSlotAbilityScoreBonus = RollFFD20.safeRoll(book.spellSlotAbilityBonusFormula || \"0\", rollData).total,\n      spellSlotAbilityScore = (spellbookAbility?.total ?? 10) + spellSlotAbilityScoreBonus,\n      spellSlotAbilityMod = getAbilityModifier(spellSlotAbilityScore);\n\n    // Set CL\n    let clTotal = 0;\n    {\n      const key = `system.attributes.spells.spellbooks.${bookKey}.cl.total`;\n      const formula = book.cl.formula || \"0\";\n      let total = 0;\n\n      // Add NPC base\n      if (this.type === \"npc\") {\n        const value = book.cl.base || 0;\n        total += value;\n        clTotal += value;\n        setSourceInfoByName(this.sourceInfo, key, game.i18n.localize(\"FFD20.Base\"), value);\n      }\n      // Add HD\n      if (book.class === \"_hd\") {\n        const value = actorData.attributes.hd.total;\n        total += value;\n        clTotal += value;\n        setSourceInfoByName(this.sourceInfo, key, game.i18n.localize(\"FFD20.HitDie\"), value);\n      }\n      // Add class levels\n      else if (book.class && rollData.classes[book.class]) {\n        const value = rollData.classes[book.class].level;\n        total += value;\n        clTotal += value;\n\n        setSourceInfoByName(this.sourceInfo, key, rollData.classes[book.class].name, value);\n      }\n\n      // Set auto spell level calculation offset\n      if (book.autoSpellLevelCalculation) {\n        const autoFormula = book.cl.autoSpellLevelCalculationFormula || \"0\";\n        const autoBonus = RollFFD20.safeTotal(autoFormula, rollData);\n        const autoTotal = Math.max(1, Math.min(20, total + autoBonus));\n        book.cl.autoSpellLevelTotal = autoTotal;\n\n        clTotal += autoBonus;\n        if (autoBonus !== 0) {\n          setSourceInfoByName(\n            this.sourceInfo,\n            key,\n            game.i18n.localize(\"FFD20.AutoSpellClassLevelOffset.Formula\"),\n            autoBonus\n          );\n        }\n      }\n\n      // Add from bonus formula\n      const clBonus = RollFFD20.safeRoll(formula, rollData).total;\n      clTotal += clBonus;\n      if (clBonus > 0) {\n        setSourceInfoByName(this.sourceInfo, key, game.i18n.localize(\"FFD20.CasterLevelBonusFormula\"), clBonus);\n      } else if (clBonus < 0) {\n        setSourceInfoByName(this.sourceInfo, key, game.i18n.localize(\"FFD20.CasterLevelBonusFormula\"), clBonus, false);\n      }\n\n      if (rollData.attributes.woundThresholds.penalty != null) {\n        // Subtract Wound Thresholds penalty. Can't reduce below 1.\n        if (rollData.attributes.woundThresholds.penalty > 0 && clTotal > 1) {\n          clTotal = Math.max(1, clTotal - rollData.attributes.woundThresholds.penalty);\n          setSourceInfoByName(\n            this.sourceInfo,\n            key,\n            game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[rollData.attributes.woundThresholds.level]),\n            -rollData.attributes.woundThresholds.penalty\n          );\n        }\n      }\n\n      // Subtract energy drain\n      if (rollData.attributes.energyDrain) {\n        clTotal = Math.max(0, clTotal - rollData.attributes.energyDrain);\n        setSourceInfoByName(\n          this.sourceInfo,\n          key,\n          game.i18n.localize(\"FFD20.CondTypeEnergyDrain\"),\n          -Math.abs(rollData.attributes.energyDrain),\n          false\n        );\n      }\n\n      const prevTotal = book.cl.total ?? 0;\n      clTotal += prevTotal;\n      book.cl.total = clTotal;\n    }\n\n    // Set concentration bonus\n    {\n      // Temp fix for old actors that fail migration\n      if (Number.isFinite(book.concentration)) book.concentration = {};\n      const concFormula = book.concentrationFormula;\n      const formulaRoll = concFormula.length ? RollFFD20.safeRoll(concFormula, rollData).total : 0;\n      const classAbilityMod = actorData.abilities[book.ability]?.mod ?? 0;\n      const concentration = clTotal + classAbilityMod + formulaRoll;\n      const prevTotal = book.concentration.total ?? 0;\n\n      // Set source info\n      setSourceInfoByName(\n        this.sourceInfo,\n        `system.attributes.spells.spellbooks.${bookKey}.concentration.total`,\n        game.i18n.localize(\"FFD20.CasterLevel\"),\n        clTotal,\n        false\n      );\n      setSourceInfoByName(\n        this.sourceInfo,\n        `system.attributes.spells.spellbooks.${bookKey}.concentration.total`,\n        game.i18n.localize(\"FFD20.SpellcastingAbility\"),\n        classAbilityMod,\n        false\n      );\n      setSourceInfoByName(\n        this.sourceInfo,\n        `system.attributes.spells.spellbooks.${bookKey}.concentration.total`,\n        game.i18n.localize(\"FFD20.ByBonus\"),\n        formulaRoll,\n        false\n      );\n\n      // Apply value\n      book.concentration = { total: prevTotal + concentration };\n    }\n\n    const getAbilityBonus = (a) => (a !== 0 ? ActorFFD20.getSpellSlotIncrease(spellSlotAbilityMod, a) : 0);\n\n    const mode = new SpellbookMode(book);\n    const useSpellPoints = book.spellPoints.useSystem === true;\n\n    // Spell slots\n    const useAuto = book.autoSpellLevelCalculation;\n    if (useAuto) {\n      // turn off spell points\n      book.spellPoints.useSystem = false;\n\n      // set base \"spontaneous\" based on spell prep mode\n      book.spontaneous = mode.isSemiSpontaneous;\n\n      let casterType = book.casterType;\n      if (!casterType || (mode.isHybrid && casterType !== \"high\")) {\n        book.casterType = casterType = \"high\";\n      }\n      if (mode.isPrestige && casterType !== \"low\") {\n        book.casterType = casterType = \"low\";\n      }\n\n      const castsForLevels =\n        CONFIG.FFD20.casterProgression[book.spontaneous ? \"castsPerDay\" : \"spellsPreparedPerDay\"][mode.raw][casterType];\n      let classLevel = Math.clamped(book.cl.autoSpellLevelTotal, 1, 20);\n\n      // Protect against invalid class level bricking actors\n      if (!Number.isSafeInteger(classLevel)) {\n        const msg = `Actor ${this.id} has invalid caster class level.`;\n        console.error(msg, classLevel);\n        ui.notifications?.error(msg);\n        classLevel = Math.floor(classLevel);\n      }\n\n      rollData.ablMod = spellSlotAbilityMod;\n\n      const allLevelModFormula =\n        book[book.spontaneous ? \"castPerDayAllOffsetFormula\" : \"preparedAllOffsetFormula\"] || \"0\";\n      const allLevelMod = RollFFD20.safeTotal(allLevelModFormula, rollData);\n\n      for (let level = 0; level < 10; level++) {\n        const levelData = book.spells[`spell${level}`];\n        // 0 is special because it doesn't get bonus preps and can cast them indefinitely so can't use the \"cast per day\" value\n        const spellsForLevel =\n          level === 0 && book.spontaneous\n            ? CONFIG.FFD20.casterProgression.spellsPreparedPerDay[mode.raw][casterType][classLevel - 1][level]\n            : castsForLevels[classLevel - 1][level];\n        levelData.base = spellsForLevel;\n\n        const offsetFormula = levelData[book.spontaneous ? \"castPerDayOffsetFormula\" : \"preparedOffsetFormula\"] || \"0\";\n\n        const max =\n          typeof spellsForLevel === \"number\" || (level === 0 && book.hasCantrips)\n            ? spellsForLevel + getAbilityBonus(level) + allLevelMod + RollFFD20.safeTotal(offsetFormula, rollData)\n            : null;\n\n        levelData.max = max;\n        if (!Number.isFinite(levelData.value)) levelData.value = max;\n      }\n    } else {\n      for (let level = 0; level < 10; level++) {\n        const spellLevel = book.spells[`spell${level}`];\n        let base = parseInt(spellLevel.base);\n        if (Number.isNaN(base)) {\n          spellLevel.base = null;\n          spellLevel.max = 0;\n        } else if (book.autoSpellLevels) {\n          base += getAbilityBonus(level);\n          spellLevel.max = base;\n        } else {\n          spellLevel.max = base;\n        }\n\n        const max = spellLevel.max;\n        const oldval = spellLevel.value;\n        if (!Number.isFinite(oldval)) spellLevel.value = max;\n      }\n    }\n\n    // Set spontaneous spell slots to something sane\n    for (let a = 0; a < 10; a++) {\n      const spellLevel = book.spells[`spell${a}`];\n      const current = spellLevel.value;\n      spellLevel.value = current || 0;\n    }\n\n    // Update spellbook slots\n    {\n      const slots = {};\n      for (let spellLevel = 0; spellLevel < 10; spellLevel++) {\n        slots[spellLevel] = new SpellbookSlots({\n          value: book.spells[`spell${spellLevel}`].max,\n          domain: book.domainSlotValue,\n        });\n      }\n\n      // Slot usage\n      if (!book.spontaneous) {\n        for (let level = 0; level < 10; level++) {\n          const levelSpells = bookInfo.level[level]?.spells ?? [];\n          const lvlSlots = slots[level];\n          for (const spell of levelSpells) {\n            if (Number.isFinite(spell.maxCharges)) {\n              const slotCost = spell.system.slotCost ?? 1;\n              const subtract = { domain: 0, uses: 0 };\n              if (spell.system.domain === true) {\n                subtract.domain = Math.min(spell.maxCharges, lvlSlots.domain);\n                subtract.uses = (spell.maxCharges - subtract.domain) * slotCost;\n              } else {\n                subtract.uses = spell.maxCharges * slotCost;\n              }\n              lvlSlots.domain -= subtract.domain;\n              lvlSlots.value -= subtract.uses;\n            }\n          }\n          book.spells[`spell${level}`].value = lvlSlots.value;\n        }\n      }\n\n      // Spells available hint text if auto spell levels is enabled\n      const useAuto = book.autoSpellLevelCalculation;\n      if (useAuto) {\n        const maxLevelByAblScore = (spellbookAbility?.total ?? 0) - 10;\n\n        const allLevelModFormula = book.preparedAllOffsetFormula || \"0\";\n        const allLevelMod = RollFFD20.safeTotal(allLevelModFormula, rollData);\n\n        const casterType = book.casterType || \"high\";\n        const classLevel = Math.floor(Math.clamped(book.cl.autoSpellLevelTotal, 1, 20));\n\n        for (let spellLevel = 0; spellLevel < 10; spellLevel++) {\n          const spellLevelData = book.spells[`spell${spellLevel}`];\n          if (maxLevelByAblScore < spellLevel) {\n            spellLevelData.lowAbilityScore = true;\n            continue;\n          }\n\n          spellLevelData.known = { unused: 0, max: 0 };\n          spellLevelData.preparation = { unused: 0, max: 0 };\n\n          let remaining;\n          if (mode.isPrepared) {\n            // for prepared casters, just use the 'value' calculated above\n            remaining = spellLevelData.value;\n            spellLevelData.preparation.max = spellLevelData.max;\n          } else {\n            // spontaneous or hybrid\n            // if not prepared then base off of casts per day\n            let available =\n              CONFIG.FFD20.casterProgression.spellsPreparedPerDay[mode.raw][casterType]?.[classLevel - 1][spellLevel];\n            available += allLevelMod;\n\n            const formula = spellLevelData.preparedOffsetFormula || \"0\";\n            available += RollFFD20.safeTotal(formula, rollData);\n\n            // Leave record of max known\n            spellLevelData.known.max = available;\n\n            // Count spell slots used\n            let dSlots = slots[spellLevel].domain;\n            const used =\n              bookInfo.level[spellLevel]?.spells.reduce((acc, i) => {\n                const { preparation, atWill, domain, slotCost } = i.system;\n                if (!atWill && preparation.spontaneousPrepared) {\n                  if (domain && dSlots > 0) dSlots -= slotCost;\n                  else acc += slotCost;\n                }\n                return acc;\n              }, 0) ?? 0;\n            slots[spellLevel].domainUnused = dSlots;\n            slots[spellLevel].used = used;\n\n            remaining = available - used;\n          }\n\n          if (!remaining) {\n            spellLevelData.spellMessage = \"\";\n            continue;\n          }\n\n          let spellRemainingMsg = \"\";\n\n          if (remaining < 0) {\n            spellRemainingMsg = game.i18n.format(\"FFD20.TooManySpells\", { quantity: Math.abs(remaining) });\n            if (mode.isSpontaneous) spellLevelData.unusedKnown = remaining;\n            else spellLevelData.preparation.unused = remaining;\n          } else if (remaining > 0) {\n            if (mode.isSpontaneous) {\n              spellRemainingMsg =\n                remaining === 1\n                  ? game.i18n.localize(\"FFD20.LearnMoreSpell\")\n                  : game.i18n.format(\"FFD20.LearnMoreSpells\", { quantity: remaining });\n              spellLevelData.known.unused = remaining;\n            } else {\n              // hybrid or prepared\n              spellRemainingMsg =\n                remaining === 1\n                  ? game.i18n.localize(\"FFD20.PrepareMoreSpell\")\n                  : game.i18n.format(\"FFD20.PrepareMoreSpells\", { quantity: remaining });\n              spellLevelData.preparation.unused = remaining;\n            }\n          }\n\n          spellLevelData.spellMessage = spellRemainingMsg;\n        }\n      }\n    }\n\n    // Spell points fix for mp\n    if (useSpellPoints) {\n      const formula = book.spellPoints.maxFormula || \"0\";\n      rollData.cl = book.cl.total;\n      rollData.ablMod = spellSlotAbilityMod;\n      const spellClass = book.class ?? \"\";\n      rollData.classLevel = spellClass === \"_hd\" ? rollData.attributes.hd.total : rollData[spellClass]?.level || 0;\n      const roll = RollFFD20.safeRoll(formula, rollData);\n      book.spellPoints.max = roll.total;\n    } else {\n      book.spellPoints.max = 0;\n    }\n\n    // Set spellbook ranges\n    book.range = new SpellRanges(book.cl.total);\n  }\n\n  /**\n   * Collect some basic spellbook info so it doesn't need to be gathered again for each spellbook.\n   */\n  _generateSpellbookCache() {\n    const bookKeys = Object.keys(this.system.attributes.spells.spellbooks);\n\n    const allSpells = this.items.filter((i) => i.type === \"spell\");\n\n    const cache = {\n      spells: allSpells,\n      books: {},\n    };\n\n    // Prepare spellbooks\n    bookKeys.forEach((bookKey) => {\n      cache.books[bookKey] ??= new Spellbook(bookKey, this);\n    });\n\n    // Spread out spells to books\n    allSpells.forEach((spell) => {\n      const bookKey = spell.system.spellbook;\n      if (!bookKeys.includes(bookKey)) return console.error(\"Spell has invalid book\", spell);\n      cache.books[bookKey].addSpell(spell);\n    });\n\n    return cache;\n  }\n\n  /**\n   * Update all spellbooks\n   *\n   * @param rollData\n   * @param cache\n   */\n  updateSpellbookInfo(rollData, cache) {\n    rollData ??= this.getRollData({ refresh: true });\n    cache ??= this._generateSpellbookCache();\n\n    const spellbooks = this.system.attributes.spells.spellbooks;\n\n    // Set spellbook info\n    for (const bookKey of Object.keys(spellbooks)) {\n      this._updateSpellBook(bookKey, rollData, cache);\n    }\n\n    // usedSpellbooks backwards compatibility. Mostly unused by the system itself\n    this.system.attributes.spells.usedSpellbooks = Object.keys(spellbooks).filter((book) => spellbooks[book].inUse);\n  }\n\n  /**\n   * Called just before the first change is applied, and after every change is applied.\n   * Sets additional variables (such as spellbook range)\n   */\n  refreshDerivedData() {\n    // Reset maximum dexterity bonus\n    this.system.attributes.maxDexBonus = null;\n    this.system.abilities.dex.maxBonus = this.system.abilities.dex.mod;\n\n    {\n      // Compute encumbrance\n      const encPen = this._computeEncumbrance();\n\n      // Apply armor penalties\n      const gearPen = this._applyArmorPenalties();\n\n      // Set armor check penalty\n      this.system.attributes.acp.encumbrance = encPen.acp;\n      this.system.attributes.acp.gear = gearPen.acp;\n      this.system.attributes.acp.total = Math.max(encPen.acp, gearPen.acp);\n\n      // Set maximum dexterity bonus\n      if (encPen.maxDexBonus != null || gearPen.maxDexBonus != null) {\n        this.system.attributes.maxDexBonus = Math.min(\n          encPen.maxDexBonus ?? Number.POSITIVE_INFINITY,\n          gearPen.maxDexBonus ?? Number.POSITIVE_INFINITY\n        );\n        this.system.abilities.dex.maxBonus = Math.min(\n          this.system.abilities.dex.maxBonus,\n          this.system.attributes.maxDexBonus\n        );\n      }\n    }\n  }\n\n  /**\n   * Augment the basic actor data with additional dynamic data.\n   */\n  prepareDerivedData() {\n    super.prepareDerivedData();\n\n    this.prepareProficiencies();\n\n    // Refresh roll data\n    // Some changes act wonky without this\n    // Example: `@skills.hea.rank >= 10 ? 6 : 3` doesn't work well without this\n    this.getRollData({ refresh: true });\n\n    this.items.forEach((item) => {\n      item.prepareDerivedItemData();\n      this.updateItemResources(item);\n    });\n\n    applyChanges.call(this);\n\n    // Prepare specific derived data\n    this.prepareSpecificDerivedData();\n\n    // Prepare CMB total\n    this.prepareCMB();\n\n    // Setup links\n    this.prepareItemLinks();\n\n    // Refresh roll data again to include processed  info\n    this.getRollData({ refresh: true });\n\n    // Update item resources\n    this.items.forEach((item) => {\n      item.prepareDerivedItemData();\n      this.updateItemResources(item);\n    });\n\n    // Update tokens for resources\n    const tokens = this.isToken ? [this.token] : this.getActiveTokens();\n    tokens.forEach((t) => {\n      try {\n        t.drawBars();\n      } catch (err) {\n        // Drop the harmless error\n      }\n    });\n  }\n\n  /**\n   * Prepare armor, weapon, and language proficiencies.\n   */\n  prepareProficiencies() {\n    const actorData = this.system;\n    // Handle armor and weapon proficiencies for PCs\n    // NPCs are considered proficient with their armor\n    // Collect proficiencies from items, add them to actor's proficiency totals\n    const proficiencies = {\n      armorProf: CONFIG.FFD20.armorProficiencies,\n      weaponProf: CONFIG.FFD20.weaponProficiencies,\n      languages: CONFIG.FFD20.languages,\n    };\n    for (const [prof, translations] of Object.entries(proficiencies)) {\n      // Custom proficiency baseline from actor\n      const customProficiencies =\n        actorData.traits[prof]?.custom?.split(CONFIG.FFD20.re.traitSeparator).filter((item) => item.length > 0) || [];\n\n      // Iterate over all items to create one array of non-custom proficiencies\n      const proficiencies = this.items.reduce(\n        (profs, item) => {\n          // Check only items able to grant proficiencies\n          if (hasProperty(item, `system.${prof}`)) {\n            // Get existing sourceInfo for item with this name, create sourceInfo if none is found\n            // Remember whether sourceInfo can be modified or has to be pushed at the end\n            let sInfo = getSourceInfo(this.sourceInfo, `system.traits.${prof}`).positive.find(\n              (o) => o.name === item.name\n            );\n            const hasInfo = !!sInfo;\n            if (!sInfo) sInfo = { name: item.name, value: [] };\n            else if (typeof sInfo.value === \"string\") sInfo.value = sInfo.value.split(\", \");\n\n            // Regular proficiencies\n            for (const proficiency of item.system[prof].value) {\n              // Add localized source info if item's info does not have this proficiency already\n              if (!sInfo.value.includes(proficiency)) sInfo.value.push(translations[proficiency]);\n              // Add raw proficiency key\n              if (!profs.includes(proficiency)) profs.push(proficiency);\n            }\n\n            // Collect trimmed but otherwise original proficiency strings, dedupe array for actor's total\n            const customProfs =\n              item.system[prof].custom\n                ?.split(CONFIG.FFD20.re.traitSeparator)\n                .map((i) => i.trim())\n                .filter((el, i, arr) => el.length > 0 && arr.indexOf(el) === i) || [];\n            // Add readable custom profs to sources and overall collection\n            sInfo.value.push(...customProfs);\n            customProficiencies.push(...customProfs);\n\n            if (sInfo.value.length > 0) {\n              // Dedupe if adding to existing sourceInfo\n              if (hasInfo) sInfo.value = [...new Set(sInfo.value)];\n              // Transform arrays into presentable strings\n              sInfo.value = sInfo.value.join(\", \");\n              // If sourceInfo was not a reference to existing info, push it now\n              if (!hasInfo) getSourceInfo(this.sourceInfo, `system.traits.${prof}`).positive.push(sInfo);\n            }\n          }\n          return profs;\n        },\n        [...(actorData.traits[prof]?.value ?? [])] // Default proficiency baseline from actor\n      );\n\n      // Save collected proficiencies in actor's data\n      actorData.traits[prof] ??= {}; // In case the data structure is missing\n      actorData.traits[prof].total = [...proficiencies];\n      actorData.traits[prof].customTotal = customProficiencies.join(\";\");\n    }\n  }\n\n  prepareCMB() {\n    const shrAtk = this.system.attributes.attack.shared ?? 0,\n      genAtk = this.system.attributes.attack.general ?? 0,\n      cmbAbl = this.system.attributes.cmbAbility,\n      cmbAblMod = this.system.abilities[cmbAbl]?.mod ?? 0,\n      size = this.system.traits.size,\n      szCMBMod = CONFIG.FFD20.sizeSpecialMods[size] ?? 0,\n      cmbBonus = this.system.attributes.cmb.bonus ?? 0,\n      cmb = shrAtk + genAtk + szCMBMod + cmbBonus + cmbAblMod;\n    this.system.attributes.cmb.total = cmb;\n  }\n\n  prepareSpecificDerivedData() {\n    callOldNamespaceHookAll(\"ffd20.prepareDerivedActorData\", \"ffd20PrepareDerivedActorData\", this);\n    Hooks.callAll(\"ffd20PrepareDerivedActorData\", this);\n\n    this.refreshDerivedData();\n\n    const attributes = this.system.attributes,\n      abilities = this.system.abilities;\n\n    // Set base ability modifier\n    for (const ab of Object.keys(abilities)) {\n      const total = abilities[ab].base;\n      const penalty = abilities[ab].penalty || 0;\n      const damage = abilities[ab].damage;\n      abilities[ab].baseMod = getAbilityModifier(total, { penalty, damage });\n    }\n\n    const actorData = this.system;\n    const data = actorData;\n\n    // Round health\n    const healthConfig = game.settings.get(\"ffd20\", \"healthConfig\");\n    const round = { up: Math.ceil, nearest: Math.round, down: Math.floor }[healthConfig.rounding];\n    for (const k of [\"hp\", \"vigor\"]) {\n      attributes[k].max = round(attributes[k].max);\n    }\n\n    // Offset relative attributes\n    for (const k of this.constructor.relativeAttributes) {\n      const offset = getProperty(this, `${k}.offset`);\n      const max = getProperty(this, `${k}.max`);\n      if (offset != null) setProperty(this, `${k}.value`, offset + max);\n    }\n\n    // Shared attack bonuses\n    {\n      // Total\n      const totalAtk = attributes.bab.total - attributes.acp.attackPenalty - (attributes.energyDrain ?? 0);\n      attributes.attack.shared = totalAtk;\n    }\n\n    // Update wound threshold\n    this.updateWoundThreshold();\n\n    // Create arbitrary skill slots\n    for (const skillId of CONFIG.FFD20.arbitrarySkills) {\n      if (data.skills[skillId] == null) continue;\n      const skill = data.skills[skillId];\n      skill.subSkills = skill.subSkills || {};\n      for (const subSkillId of Object.keys(skill.subSkills)) {\n        if (skill.subSkills[subSkillId] == null) delete skill.subSkills[subSkillId];\n      }\n    }\n\n    // Delete removed skills\n    for (const skillId of Object.keys(data.skills)) {\n      const skl = data.skills[skillId];\n      if (skl == null) {\n        delete data.skills[skillId];\n      }\n    }\n\n    // Mark background skills\n    for (const skillId of Object.keys(data.skills)) {\n      if (CONFIG.FFD20.backgroundSkills.includes(skillId)) {\n        const skill = data.skills[skillId];\n        skill.background = true;\n        for (const subSkillId of Object.keys(skill.subSkills ?? {})) skill.subSkills[subSkillId].background = true;\n      }\n    }\n\n    // Set labels\n    this.labels = {};\n    this.labels.race =\n      this.race == null ? game.i18n.localize(\"FFD20.Race\") : game.i18n.localize(\"FFD20.RaceTitle\").format(this.race.name);\n    this.labels.alignment = CONFIG.FFD20.alignments[data.details.alignment];\n\n    // Set speed labels\n    this.labels.speed = {};\n    for (const [key, obj] of Object.entries(attributes.speed ?? {})) {\n      const dist = ffd20.utils.convertDistance(obj.total);\n      this.labels.speed[key] = `${dist[0]} ${CONFIG.FFD20.measureUnitsShort[dist[1]]}`;\n    }\n\n    // Combine AC types\n    for (const k of [\"ac.normal.total\", \"ac.shield.total\", \"ac.natural.total\"]) {\n      const v = getProperty(actorData, k);\n      if (v) {\n        for (const k2 of [\"normal\", \"flatFooted\"]) {\n          attributes.ac[k2].total += v;\n        }\n      }\n    }\n\n    // Add Dexterity to AC\n    {\n      // get configured ability scores\n      const acAbl = attributes.ac.normal.ability ?? \"dex\";\n      const acTouchAbl = attributes.ac.touch.ability ?? \"dex\";\n      const cmdDexAbl = attributes.cmd.dexAbility ?? \"dex\";\n      let acAblMod = abilities[acAbl]?.mod ?? 0;\n      let acTouchAblMod = abilities[acTouchAbl]?.mod ?? 0;\n      const cmdDexAblMod = abilities[cmdDexAbl]?.mod ?? 0;\n      if (this.changeFlags[\"loseDexToAC\"]) {\n        acAblMod = Math.min(acAblMod, 0);\n        acTouchAblMod = Math.min(acTouchAblMod, 0);\n      }\n      const maxDex = attributes.maxDexBonus ?? null;\n      const ac = {\n        normal: maxDex !== null ? Math.min(maxDex, acAblMod) : acAblMod,\n        touch: maxDex !== null ? Math.min(maxDex, acTouchAblMod) : acTouchAblMod,\n        flatFooted: Math.min(0, acAblMod),\n      };\n      const acAblKey = {\n        normal: acAbl,\n        touch: acTouchAbl,\n        flatFooted: acAbl,\n      };\n      const cmd = {\n        total: cmdDexAblMod,\n        flatFootedTotal: Math.min(0, cmdDexAblMod),\n      };\n      for (const [k, v] of Object.entries(ac)) {\n        attributes.ac[k].total += v;\n        getSourceInfo(this.sourceInfo, `system.attributes.ac.${k}.total`).positive.push({\n          value: v,\n          name: CONFIG.FFD20.abilities[acAblKey[k]],\n        });\n      }\n      for (const [k, v] of Object.entries(cmd)) {\n        attributes.cmd[k] += v;\n        getSourceInfo(this.sourceInfo, `system.attributes.cmd.${k}`).positive.push({\n          value: v,\n          name: CONFIG.FFD20.abilities[cmdDexAbl],\n        });\n      }\n    }\n\n    // Reduce final speed under certain circumstances\n    {\n      const armorItems = this.items.filter((o) => o.type === \"equipment\");\n      let reducedSpeed = false;\n      const sInfo = { name: \"\", value: game.i18n.localize(\"FFD20.ReducedMovementSpeed\") };\n      if (attributes.encumbrance.level >= 1 && !this.changeFlags[\"noEncumbrance\"]) {\n        reducedSpeed = true;\n        sInfo.name = game.i18n.localize(\"FFD20.Encumbrance\");\n      }\n      if (\n        armorItems.filter((o) => o.system.equipmentSubtype === \"mediumArmor\" && o.system.equipped).length &&\n        !this.changeFlags[\"mediumArmorFullSpeed\"]\n      ) {\n        reducedSpeed = true;\n        sInfo.name = game.i18n.localize(\"FFD20.EquipTypeMedium\");\n      }\n      if (\n        armorItems.filter((o) => o.system.equipmentSubtype === \"heavyArmor\" && o.system.equipped).length &&\n        !this.changeFlags[\"heavyArmorFullSpeed\"]\n      ) {\n        reducedSpeed = true;\n        sInfo.name = game.i18n.localize(\"FFD20.EquipTypeHeavy\");\n      }\n      if (reducedSpeed) {\n        for (const speedKey of Object.keys(this.system.attributes.speed)) {\n          const key = `system.attributes.speed.${speedKey}.total`;\n          const value = getProperty(this, key);\n          setProperty(this, key, this.constructor.getReducedMovementSpeed(value));\n          if (value > 0) {\n            getSourceInfo(this.sourceInfo, `system.attributes.speed.${speedKey}.add`).negative.push(sInfo);\n          }\n        }\n      }\n    }\n\n    // Add encumbrance source details\n    switch (attributes.encumbrance.level) {\n      case 1:\n        getSourceInfo(this.sourceInfo, \"system.attributes.acp.total\").negative.push({\n          name: game.i18n.localize(\"FFD20.Encumbrance\"),\n          value: 3,\n        });\n        getSourceInfo(this.sourceInfo, \"system.attributes.maxDexBonus\").negative.push({\n          name: game.i18n.localize(\"FFD20.Encumbrance\"),\n          value: 3,\n        });\n        break;\n      case 2:\n        getSourceInfo(this.sourceInfo, \"system.attributes.acp.total\").negative.push({\n          name: game.i18n.localize(\"FFD20.Encumbrance\"),\n          value: 6,\n        });\n        getSourceInfo(this.sourceInfo, \"system.attributes.maxDexBonus\").negative.push({\n          name: game.i18n.localize(\"FFD20.Encumbrance\"),\n          value: 1,\n        });\n        break;\n    }\n\n    this.updateSpellbookInfo();\n  }\n\n  /**\n   * Computes armor penalties for this actor.\n   *\n   * @returns {MobilityPenaltyResult} The resulting penalties from armor.\n   */\n  _applyArmorPenalties() {\n    // Item type to proficiency maps\n    const proficiencyMaps = {\n      armor: {\n        lightArmor: \"lgt\",\n        mediumArmor: \"med\",\n        heavyArmor: \"hvy\",\n      },\n      shield: {\n        other: \"shl\", // buckler\n        lightShield: \"shl\",\n        heavyShield: \"shl\",\n        towerShield: \"twr\",\n      },\n    };\n\n    let attackACPPenalty = 0; // ACP to attack penalty from lacking proficiency. Stacks infinitely.\n    const acp = { armor: 0, shield: 0 };\n    const broken = { armor: { value: 0, item: null }, shield: { value: 0, item: null } };\n    const mdex = { armor: null, shield: null };\n\n    this.items\n      .filter((obj) => {\n        return obj.type === \"equipment\" && obj.system.equipped;\n      })\n      .forEach((obj) => {\n        const eqType = obj.system.equipmentType;\n        const isShieldOrArmor = [\"armor\", \"shield\"].includes(eqType);\n        let itemACP = Math.abs(obj.system.armor.acp);\n        if (obj.system.masterwork === true && isShieldOrArmor) itemACP = Math.max(0, itemACP - 1);\n\n        if (isShieldOrArmor)\n          itemACP = Math.max(0, itemACP + (getProperty(this, `system.attributes.acp.${eqType}Bonus`) ?? 0));\n\n        let brokenACP = 0;\n        if (obj.system.broken) {\n          brokenACP = itemACP;\n          itemACP *= 2;\n        }\n\n        if (itemACP) {\n          const sInfo = getSourceInfo(this.sourceInfo, \"system.attributes.acp.total\").negative.find(\n            (o) => o.itemId === obj.id\n          );\n\n          if (brokenACP) {\n            broken[eqType].value = brokenACP;\n            broken[eqType].item = obj;\n          }\n\n          if (sInfo) sInfo.value = itemACP;\n          else {\n            getSourceInfo(this.sourceInfo, \"system.attributes.acp.total\").negative.push({\n              name: obj.name,\n              itemId: obj.id,\n              value: itemACP,\n            });\n          }\n        }\n\n        if (isShieldOrArmor) {\n          if (itemACP > acp[eqType]) acp[eqType] = itemACP;\n          if (!this.hasArmorProficiency(obj, proficiencyMaps[eqType][obj.system.equipmentSubtype]))\n            attackACPPenalty += itemACP;\n        }\n\n        if (obj.system.armor.dex !== null && isShieldOrArmor) {\n          const mDex = Number.parseInt(obj.system.armor.dex, 10);\n          if (Number.isInteger(mDex)) {\n            const mod = getProperty(this, `system.attributes.mDex.${eqType}Bonus`) ?? 0;\n            const itemMDex = mDex + mod;\n            mdex[eqType] = Math.min(itemMDex, mdex[eqType] ?? Number.POSITIVE_INFINITY);\n\n            const sInfo = getSourceInfo(this.sourceInfo, \"system.attributes.maxDexBonus\").negative.find(\n              (o) => o.itemId === obj.id\n            );\n            if (sInfo) sInfo.value = mDex;\n            else {\n              getSourceInfo(this.sourceInfo, \"system.attributes.maxDexBonus\").negative.push({\n                name: obj.name,\n                itemId: obj.id,\n                value: mDex,\n                ignoreNull: false,\n              });\n            }\n          }\n        }\n      });\n\n    // Add Broken to sources\n    {\n      const name = game.i18n.localize(\"FFD20.Broken\");\n      for (const eqType of Object.keys(broken)) {\n        const value = broken[eqType].value;\n        if (value == 0) continue;\n        const brokenId = broken[eqType].item.id;\n        const sInfo = getSourceInfo(this.sourceInfo, `system.attributes.acp.${eqType}Bonus`).negative.find(\n          (o) => o.brokenId === brokenId\n        );\n        if (sInfo) sInfo.value = value;\n        else\n          getSourceInfo(this.sourceInfo, `system.attributes.acp.${eqType}Bonus`).negative.push({\n            name,\n            brokenId,\n            value,\n          });\n      }\n    }\n\n    // Return result\n    const totalACP = acp.armor + acp.shield;\n    const result = {\n      maxDexBonus: null,\n      acp: totalACP,\n    };\n    this.system.attributes.acp.gear = totalACP;\n    if (mdex.armor !== null || mdex.shield !== null)\n      result.maxDexBonus = Math.min(mdex.armor ?? Number.POSITIVE_INFINITY, mdex.shield ?? Number.POSITIVE_INFINITY);\n\n    // Set armor penalty to attack rolls\n    this.system.attributes.acp.attackPenalty = attackACPPenalty;\n\n    return result;\n  }\n\n  prepareItemLinks() {\n    if (!this.items) return;\n\n    for (const a of this.items) {\n      if (a.system.links == null) continue;\n\n      for (const l of Object.keys(a.system.links)) {\n        if (LinkFunctions[l] != null) {\n          LinkFunctions[l].call(this, a, a.system.links[l]);\n        }\n      }\n    }\n  }\n\n  _setSourceDetails(extraData) {\n    const actorData = this.system;\n    const sourceDetails = {};\n    // Get empty source arrays\n    for (const b of Object.keys(CONFIG.FFD20.buffTargets)) {\n      let buffTargets = getChangeFlat.call(this, b, null);\n      if (!(buffTargets instanceof Array)) buffTargets = [buffTargets];\n      for (const bt of buffTargets) {\n        if (!sourceDetails[bt]) sourceDetails[bt] = [];\n      }\n    }\n    // Add additional source arrays not covered by changes\n    sourceDetails[\"system.attributes.bab.total\"] = [];\n\n    // Add base values to certain bonuses\n    sourceDetails[\"system.attributes.ac.normal.total\"].push({ name: game.i18n.localize(\"FFD20.Base\"), value: 10 });\n    sourceDetails[\"system.attributes.ac.touch.total\"].push({ name: game.i18n.localize(\"FFD20.Base\"), value: 10 });\n    sourceDetails[\"system.attributes.ac.flatFooted.total\"].push({ name: game.i18n.localize(\"FFD20.Base\"), value: 10 });\n    sourceDetails[\"system.attributes.cmd.total\"].push({ name: game.i18n.localize(\"FFD20.Base\"), value: 10 });\n    sourceDetails[\"system.attributes.cmd.flatFootedTotal\"].push({ name: game.i18n.localize(\"FFD20.Base\"), value: 10 });\n    // Add ability score data\n    for (const [a, abl] of Object.entries(actorData.abilities)) {\n      sourceDetails[`system.abilities.${a}.total`].push({ name: game.i18n.localize(\"FFD20.Base\"), value: abl.value });\n      // Add ability penalty, damage and drain\n      if (abl.damage != null && abl.damage !== 0) {\n        sourceDetails[`system.abilities.${a}.total`].push({\n          name: game.i18n.localize(\"FFD20.AbilityDamage\"),\n          value: `-${Math.floor(Math.abs(abl.damage) / 2)} (Mod only)`,\n        });\n      }\n      if (abl.drain != null && abl.drain !== 0) {\n        sourceDetails[`system.abilities.${a}.total`].push({\n          name: game.i18n.localize(\"FFD20.AbilityDrain\"),\n          value: -Math.abs(abl.drain),\n        });\n      }\n    }\n\n    // Add wound threshold data\n    {\n      const hpconf = game.settings.get(\"ffd20\", \"healthConfig\").variants;\n      const wtUsage = this.type === \"npc\" ? hpconf.npc.useWoundThresholds : hpconf.pc.useWoundThresholds;\n      if (wtUsage > 0) {\n        const wtData = this.getWoundThresholdData(actorData);\n\n        if (wtData.level > 0) {\n          const changeFlatKeys = [\"~attackCore\", \"cmd\", \"init\", \"allSavingThrows\", \"ac\", \"skills\", \"abilityChecks\"];\n          for (const fk of changeFlatKeys) {\n            let flats = getChangeFlat.call(this, fk, \"penalty\", actorData);\n            if (!(flats instanceof Array)) flats = [flats];\n            for (const k of flats) {\n              if (!k) continue;\n              sourceDetails[k].push({\n                name: game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[wtData.level]),\n                value: -wtData.penalty,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    // Add extra data\n    const rollData = this.getRollData();\n    for (const [changeTarget, changeGrp] of Object.entries(extraData)) {\n      for (const grp of Object.values(changeGrp)) {\n        if (grp.length > 0) {\n          sourceDetails[changeTarget] = sourceDetails[changeTarget] || [];\n          for (const src of grp) {\n            if (!src.operator) src.operator = \"add\";\n            const srcInfo = this.constructor._translateSourceInfo(src.type, src.subtype, src.name);\n            let srcValue =\n              src.value != null\n                ? src.value\n                : RollFFD20.safeRoll(src.formula || \"0\", rollData, [changeTarget, src, this], {\n                    suppressError: !this.testUserPermission(game.user, \"OWNER\"),\n                  }).total;\n            if (src.operator === \"set\") srcValue = game.i18n.localize(\"FFD20.SetTo\").format(srcValue);\n            if (!(src.operator === \"add\" && srcValue === 0) || src.ignoreNull === false) {\n              sourceDetails[changeTarget].push({\n                name: srcInfo.replace(/[[\\]]/g, \"\"),\n                value: srcValue,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    this.sourceDetails = sourceDetails;\n  }\n\n  _getInherentTotalsKeys() {\n    // Determine base keys\n    const keys = {\n      \"attributes.ac.normal.total\": 10,\n      \"attributes.ac.touch.total\": 10,\n      \"attributes.ac.flatFooted.total\": 10,\n      \"attributes.bab.total\": 0,\n      \"attributes.bab.value\": 0,\n      \"attributes.cmd.total\": 10,\n      \"attributes.cmd.flatFootedTotal\": 10,\n      \"attributes.acp.armorBonus\": 0,\n      \"attributes.acp.shieldBonus\": 0,\n      \"attributes.acp.gear\": 0,\n      \"attributes.acp.encumbrance\": 0,\n      \"attributes.acp.total\": 0,\n      \"attributes.acp.attackPenalty\": 0,\n      \"attributes.maxDexBonus\": null,\n      \"ac.normal.total\": 0,\n      \"ac.normal.base\": 0,\n      \"ac.normal.enh\": 0,\n      \"ac.normal.misc\": 0,\n      \"ac.natural.total\": 0,\n      \"ac.natural.base\": 0,\n      \"ac.natural.misc\": 0,\n      \"ac.natural.enh\": 0,\n      \"ac.shield.total\": 0,\n      \"ac.shield.base\": 0,\n      \"ac.shield.enh\": 0,\n      \"ac.shield.misc\": 0,\n      \"attributes.sr.total\": 0,\n      \"attributes.init.bonus\": 0,\n      \"attributes.init.total\": 0,\n      \"attributes.cmb.bonus\": 0,\n      \"attributes.cmb.total\": 0,\n      \"attributes.cmb.value\": 0,\n      \"attributes.hp.max\": this.system.attributes.hp.base ?? 0,\n      \"attributes.vigor.max\": this.system.attributes.vigor.base ?? 0,\n      \"attributes.wounds.max\": this.system.attributes.wounds.base ?? 0,\n      \"attributes.mp.max\": this.system.attributes.mp.base ?? 0,\n      \"attributes.attack.general\": 0,\n      \"attributes.attack.melee\": 0,\n      \"attributes.attack.ranged\": 0,\n      \"attributes.attack.critConfirm\": 0,\n      \"attributes.mDex\": { armorBonus: 0, shieldBonus: 0 },\n      \"attributes.damage.general\": 0,\n      \"attributes.damage.weapon\": 0,\n      \"attributes.damage.spell\": 0,\n      \"attributes.damage.shared\": 0,\n      \"attributes.woundThresholds.level\": 0,\n      \"attributes.woundThresholds.mod\": 0,\n      \"attributes.woundThresholds.override\": -1,\n      \"attributes.woundThresholds.penaltyBase\": 0,\n      \"attributes.woundThresholds.penalty\": 0,\n      \"abilities.str.checkMod\": 0,\n      \"abilities.dex.checkMod\": 0,\n      \"abilities.con.checkMod\": 0,\n      \"abilities.int.checkMod\": 0,\n      \"abilities.wis.checkMod\": 0,\n      \"abilities.cha.checkMod\": 0,\n      \"attributes.spells.spellbooks.primary.concentration.total\": 0,\n      \"attributes.spells.spellbooks.secondary.concentration.total\": 0,\n      \"attributes.spells.spellbooks.tertiary.concentration.total\": 0,\n      \"attributes.spells.spellbooks.quaternary.concentration\": 0,\n      \"attributes.spells.spellbooks.spelllike.concentration.total\": 0,\n      \"attributes.spells.spellbooks.primary.cl.total\": 0,\n      \"attributes.spells.spellbooks.secondary.cl.total\": 0,\n      \"attributes.spells.spellbooks.tertiary.cl.total\": 0,\n      \"attributes.spells.spellbooks.quaternary.cl.total\": 0,\n      \"attributes.spells.spellbooks.spelllike.cl.total\": 0,\n      \"details.carryCapacity.bonus.total\": 0,\n      \"details.carryCapacity.multiplier.total\": 0,\n    };\n\n    // Determine skill keys\n    try {\n      const skillKeys = getChangeFlat.call(this, \"skills\", \"skills\");\n      for (const k of skillKeys) {\n        keys[k] = 0;\n      }\n    } catch (err) {\n      console.warn(\"Could not determine skills for an unknown actor in the creation process\", this);\n    }\n\n    return keys;\n  }\n\n  _resetInherentTotals() {\n    const keys = this._getInherentTotalsKeys();\n\n    // Reset totals\n    for (const [k, v] of Object.entries(keys)) {\n      try {\n        setProperty(this.system, k, v);\n      } catch (err) {\n        console.log(err, k);\n      }\n    }\n  }\n\n  /**\n   * Return reduced movement speed.\n   *\n   * @param {number} value - The non-reduced movement speed.\n   * @returns {number} The reduced movement speed.\n   */\n  static getReducedMovementSpeed(value) {\n    return value - Math.floor(value / 5 / 3) * 5;\n  }\n\n  /**\n   * Return increased amount of spell slots by ability score modifier.\n   *\n   * @param {number} mod - The associated ability modifier.\n   * @param {number} level - Spell level.\n   * @returns {number} Amount of spell levels to increase.\n   */\n  static getSpellSlotIncrease(mod, level) {\n    if (level === 0) return 0;\n    if (mod <= 0) return 0;\n    return Math.max(0, Math.ceil((mod + 1 - level) / 4));\n  }\n\n  /**\n   * Return the amount of experience required to gain a certain character level.\n   *\n   * @param level {number}  The desired level\n   * @returns {number}       The XP required\n   */\n  getLevelExp(level) {\n    return 0; // Only used by PCs\n  }\n\n  /* -------------------------------------------- */\n\n  /* -------------------------------------------- */\n  /*  Socket Listeners and Handlers\n  /* -------------------------------------------- */\n\n  async _preUpdate(update, options, userId) {\n    await super._preUpdate(update, options, userId);\n\n    // Offset HP value\n    if (this._initialized) {\n      for (const k of this.constructor.relativeAttributes) {\n        const isPathKey = {\n          value: Object.hasOwnProperty.call(update, `${k}.value`),\n          offset: Object.hasOwnProperty.call(update, `${k}.offset`),\n          max: Object.hasOwnProperty.call(update, `${k}.max`),\n        };\n        const value = Object.entries(isPathKey).reduce((cur, o) => {\n          cur[o[0]] = o[1] ? update[`${k}.${o[0]}`] : getProperty(update, `${k}.${o[0]}`);\n          if (o[0] === \"max\" && cur[o[0]] === undefined) cur[o[0]] = getProperty(this, `${k}.max`);\n          return cur;\n        }, {});\n        if (value.value !== undefined && value.offset === undefined)\n          setProperty(update, `${k}.offset`, value.value - value.max);\n      }\n    }\n\n    if (!update.system) return; // No system updates.\n\n    const oldData = this.system;\n\n    // Apply changes in Actor size to Token width/height\n    const newSize = update.system.traits?.size;\n    if (newSize !== undefined && oldData.traits.size !== undefined) {\n      const size = CONFIG.FFD20.tokenSizes[newSize];\n      if (!this.isToken && !getProperty(this, \"prototypeToken.flags.ffd20.staticSize\")) {\n        if (!update.token) update.token = {};\n        update.token.width = size.w;\n        update.token.height = size.h;\n        update.token.scale = size.scale;\n      }\n    }\n\n    // Make certain variables absolute\n    const abilities = update.system.abilities;\n    if (abilities) {\n      const absoluteKeys = [\"userPenalty\", \"damage\", \"drain\"];\n      const keys = Object.keys(abilities);\n      for (const abl of keys) {\n        for (const absKey of absoluteKeys) {\n          if (abilities[abl][absKey] !== undefined) {\n            abilities[abl][absKey] = Math.abs(abilities[abl][absKey]);\n          }\n        }\n      }\n    }\n\n    const energyDrain = update.system.attributes?.energyDrain;\n    if (energyDrain !== undefined) {\n      update.system.attributes.energyDrain = Math.abs(energyDrain);\n    }\n\n    // Make only 1 fear or fatigue condition active at most\n    const conditions = update.system.attributes?.conditions;\n    if (conditions) {\n      const conditionStages = [\n        [\"shaken\", \"frightened\", \"panicked\"],\n        [\"fatigued\", \"exhausted\"],\n      ];\n      for (const conditionGroup of conditionStages) {\n        const conditionKey = Object.keys(conditions).find((o) => conditionGroup.includes(o));\n        if (conditionKey != null) {\n          for (const key of conditionGroup) {\n            if (key !== conditionKey) conditions[key] = false;\n          }\n        }\n      }\n    }\n\n    // Update experience\n    this._updateExp(update);\n  }\n\n  _onUpdate(data, options, userId, context = {}) {\n    super._onUpdate(data, options, userId, context);\n\n    if (game.user.id === userId && hasProperty(data, \"system.attributes.conditions\")) {\n      this.toggleConditionStatusIcons({ render: false });\n      // Redraw canvas on condition toggle\n      canvas.perception.update(\n        {\n          initializeLighting: true,\n          initializeVision: true,\n        },\n        true\n      );\n      game.socket.emit(\"system.ffd20\", { eventType: \"redrawCanvas\" });\n    }\n\n    // Resize token(s)\n    if (game.user.id === userId) {\n      const sizeKey = getProperty(data, \"system.traits.size\");\n      if (sizeKey) {\n        const size = CONFIG.FFD20.tokenSizes[sizeKey];\n        const tokens = this.getActiveTokens(false, true).filter((o) => {\n          if (o.getFlag(\"ffd20\", \"staticSize\")) return false;\n          return true;\n        });\n        tokens.forEach((o) => {\n          o.update({ width: size.w, height: size.h, scale: size.scale });\n        });\n      }\n    }\n  }\n\n  _onCreateEmbeddedDocuments(embeddedName, documents, result, options, userId) {\n    super._onCreateEmbeddedDocuments(...arguments);\n\n    if (userId === game.user.id && embeddedName === \"Item\") {\n      this.toggleConditionStatusIcons({ render: false });\n\n      // Apply race size to actor\n      const race = documents.find((d) => d.type === \"race\");\n      if (race?.system.size) {\n        if (this.system.traits.size !== race.system.size) this.update({ \"system.traits.size\": race.system.size });\n      }\n    }\n  }\n\n  _onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId) {\n    super._onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId);\n\n    if (userId === game.user.id && embeddedName === \"Item\") {\n      this.toggleConditionStatusIcons({ render: false });\n    }\n  }\n\n  updateItemResources(item) {\n    const isCharged = item.isCharged;\n    if (isCharged) {\n      const itemTag = !item.system.useCustomTag ? createTag(item.name) : item.system.tag;\n\n      const res = {\n        value: item.charges,\n        max: item.maxCharges,\n        _id: item.id,\n      };\n      this.system.resources[itemTag] = res;\n      return true;\n    }\n\n    return false;\n  }\n\n  /* -------------------------------------------- */\n  /*  Rolls                                       */\n  /* -------------------------------------------- */\n\n  async createAttackFromWeapon(item) {\n    if (item.type !== \"weapon\") throw new Error(\"Wrong Item type\");\n\n    if (!this.isOwner) {\n      const msg = game.i18n.format(\"FFD20.ErrorNoActorPermissionAlt\", { 0: this.name });\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    // Get attack template\n    const attackData = {};\n\n    // Add misc things\n    attackData[\"type\"] = \"attack\";\n    attackData[\"name\"] = item.name;\n    attackData[\"img\"] = item.img;\n    attackData[\"system.attackType\"] = \"weapon\";\n    attackData[\"system.masterwork\"] = item.system.masterwork;\n    attackData[\"system.enh\"] = item.system.enh;\n    attackData[\"system.broken\"] = item.system.broken;\n\n    // Add actions\n    const actions = deepClone(item._source.system.actions ?? []);\n    for (const action of actions) {\n      action._id = randomID(16);\n    }\n    attackData[\"system.actions\"] = actions;\n\n    // Create attack\n    const newItem = (await this.createEmbeddedDocuments(\"Item\", [expandObject(attackData)]))[0];\n\n    // Create link\n    if (newItem) {\n      await item.createItemLink(\"children\", \"data\", newItem, newItem.id);\n    }\n\n    // Notify user\n    ui.notifications.info(game.i18n.localize(\"FFD20.NotificationCreatedAttack\").format(item.system.name));\n\n    // Disable quick use of weapon\n    await item.update({\n      \"system.showInQuickbar\": false,\n    });\n\n    return newItem;\n  }\n\n  /* -------------------------------------------- */\n\n  getSkillInfo(skillId) {\n    let skill, skillName, parentSkill;\n    const [mainSkillId, subSkillDelim, subSkillId] = skillId.split(\".\", 3),\n      isSubSkill = subSkillDelim === \"subSkills\" && !!subSkillId,\n      mainSkill = this.system.skills[mainSkillId];\n    if (!mainSkill) return null;\n\n    if (isSubSkill) {\n      skill = mainSkill.subSkills[subSkillId];\n      if (!skill) return null;\n      skillName = `${CONFIG.FFD20.skills[mainSkillId]} (${skill.name})`;\n      parentSkill = this.getSkillInfo(mainSkillId);\n    } else {\n      skill = mainSkill;\n      skillName = skill.name ?? CONFIG.FFD20.skills[skillId];\n    }\n\n    const result = duplicate(skill);\n    result.id = skillId;\n    result.name = skillName;\n\n    if (parentSkill) result.parentSkill = parentSkill;\n\n    return result;\n  }\n\n  /**\n   * Roll a Skill Check\n   *\n   * @param {string} skillId      The skill id (e.g. \"per\", or \"prf.subSkills.prf1\")\n   * @param {ActorRollOptions} [options={}]      Options which configure how the skill check is rolled\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollSkill(skillId, options = {}) {\n    if (!this.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    if (callOldNamespaceHook(\"actorRoll\", \"ffd20PreActorRollSkill\", undefined, this, \"skill\", skillId, options) === false)\n      return;\n\n    const skl = this.getSkillInfo(skillId);\n\n    // Add contextual attack string\n    const rollData = this.getRollData();\n    const noteObjects = this.getContextNotes(`skill.${skillId}`);\n    const notes = this.formatContextNotes(noteObjects, rollData);\n\n    // Add untrained note\n    if (skl.rt && !skl.rank) {\n      notes.push(game.i18n.localize(\"FFD20.Untrained\"));\n    }\n\n    // Gather changes\n    const parts = [];\n    const changes = getHighestChanges(\n      this.changes.filter((c) => {\n        let cf = getChangeFlat.call(this, c.subTarget, c.modifier);\n        if (!(cf instanceof Array)) cf = [cf];\n\n        return cf.includes(`system.skills.${skillId}.changeBonus`);\n      }),\n      { ignoreTarget: true }\n    );\n\n    // Add ability modifier\n    if (skl.ability) {\n      parts.push(`@abilities.${skl.ability}.mod[${CONFIG.FFD20.abilities[skl.ability]}]`);\n    }\n\n    // Add rank\n    if (skl.rank > 0) {\n      parts.push(`${skl.rank}[${game.i18n.localize(\"FFD20.SkillRankPlural\")}]`);\n      if (skl.cs) {\n        parts.push(`3[${game.i18n.localize(\"FFD20.CSTooltip\")}]`);\n      }\n    }\n\n    // Add armor check penalty\n    if (skl.acp && rollData.attributes.acp.total !== 0) {\n      parts.push(`-@attributes.acp.total[${game.i18n.localize(\"FFD20.ACPLong\")}]`);\n    }\n\n    // Add Wound Thresholds info\n    if (rollData.attributes.woundThresholds?.penalty > 0) {\n      parts.push(\n        `- @attributes.woundThresholds.penalty[${game.i18n.localize(\n          CONFIG.FFD20.woundThresholdConditions[rollData.attributes.woundThresholds.level]\n        )}]`\n      );\n    }\n\n    // Add changes\n    for (const c of changes) {\n      if (!c.value) continue;\n      parts.push(`${c.value}[${c.flavor}]`);\n    }\n\n    const props = [];\n    if (notes.length > 0) props.push({ header: game.i18n.localize(\"FFD20.Notes\"), value: notes });\n\n    const rollOptions = {\n      ...options,\n      parts,\n      rollData,\n      flavor: game.i18n.localize(\"FFD20.SkillCheck\").format(skl.name),\n      chatTemplateData: { hasProperties: props.length > 0, properties: props },\n      compendium: { entry: CONFIG.FFD20.skillCompendiumEntries[skillId] ?? skl.journal, type: \"JournalEntry\" },\n      subject: { skill: skillId },\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollSkill\", this, rollOptions, skillId) === false) return;\n    const result = await ffd20.dice.d20Roll(rollOptions);\n    if (result) Hooks.callAll(\"ffd20ActorRollSkill\", this, result, skillId);\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Roll a 1d20 adding the actor's BAB\n   *\n   * @param {ActorRollOptions} [options]\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollBAB(options = {}) {\n    if (!this.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    if (callOldNamespaceHook(\"actorRoll\", \"ffd20PreActorRollBab\", undefined, this, \"bab\", null, options) === false)\n      return;\n    const rollOptions = {\n      ...options,\n      parts: [`${this.system.attributes.bab.total}[${game.i18n.localize(\"FFD20.BABAbbr\")}]`],\n      subject: { core: \"bab\" },\n      flavor: game.i18n.localize(\"FFD20.BAB\"),\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollBab\", this, rollOptions) === false) return;\n    const result = await ffd20.dice.d20Roll(rollOptions);\n    Hooks.callAll(\"ffd20ActorRollBab\", this, result);\n    return result;\n  }\n\n  /**\n   * Roll a basic CMB check for this actor\n   *\n   * @param {ActorRollOptions & {ranged: boolean, ability: string | null}} [options={}]\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollCMB(options = {}) {\n    if (!this.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    options.ranged ??= false;\n    options.ability ??= null;\n\n    if (callOldNamespaceHook(\"actorRoll\", \"ffd20PreActorRollCmb\", undefined, this, \"cmb\", null, options) === false)\n      return;\n\n    // Add contextual notes\n    const rollData = this.getRollData();\n    const noteObjects = this.getContextNotes(\"misc.cmb\");\n    const notes = this.formatContextNotes(noteObjects, rollData);\n\n    const parts = [];\n\n    const describePart = (value, label) => parts.push(`${value}[${label}]`);\n    const srcDetails = (s) => s?.reverse().forEach((d) => describePart(d.value, d.name, -10));\n    srcDetails(this.sourceDetails[\"system.attributes.cmb.bonus\"]);\n    srcDetails(this.sourceDetails[\"system.attributes.attack.shared\"]);\n\n    const size = this.system.traits.size ?? \"med\";\n    rollData.sizeBonus = CONFIG.FFD20.sizeSpecialMods[size];\n    if (rollData.sizeBonus != 0) parts.push(`@sizeBonus[${game.i18n.localize(\"FFD20.Size\")}]`);\n\n    const changeSources = [\"attack\"];\n    if (options.ranged === true) changeSources.push(\"rattack\");\n    else changeSources.push(\"mattack\");\n    const effectiveChanges = getHighestChanges(\n      this.changes.filter((c) => changeSources.includes(c.subTarget)),\n      { ignoreTarget: true }\n    );\n    effectiveChanges.forEach((ic) => describePart(ic.value, ic.flavor));\n\n    const abl = options.ability ?? this.system.attributes.cmbAbility;\n    const ablMod = this.system.abilities[abl]?.mod ?? 0;\n    if (ablMod != 0) describePart(ablMod, CONFIG.FFD20.abilities[abl]);\n\n    // Add grapple note\n    if (this.system.attributes.conditions.grappled) {\n      notes.push(\"+2 to Grapple\");\n    }\n\n    const props = [];\n    if (notes.length > 0) props.push({ header: game.i18n.localize(\"FFD20.Notes\"), value: notes });\n\n    const rollOptions = {\n      ...options,\n      parts,\n      rollData,\n      subject: { core: \"cmb\" },\n      flavor: game.i18n.localize(\"FFD20.CMB\"),\n      chatTemplateData: { hasProperties: props.length > 0, properties: props },\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollCmb\", this, options) === false) return;\n    const result = await ffd20.dice.d20Roll(rollOptions);\n    Hooks.callAll(\"ffd20ActorRollCmb\", this, result);\n    return result;\n  }\n\n  /**\n   * Roll a generic attack\n   *\n   * @param {ActorRollOptions & {melee?: boolean}} [options={}]\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollAttack(options = {}) {\n    if (!this.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    // Default to melee attacks\n    options.melee ??= true;\n\n    const sources = [\n      ...this.sourceDetails[\"system.attributes.attack.shared\"],\n      // ...this.sourceDetails[\"system.attributes.attack.general\"],\n      // ...this.sourceDetails[`system.attributes.attack.${options.melee ? \"melee\" : \"ranged\"}`],\n    ];\n\n    // Add contextual notes\n    const rollData = this.getRollData();\n    const noteObjects = [...this.getContextNotes(\"attacks.effect\"), ...this.getContextNotes(\"attacks.attack\")];\n    const notes = this.formatContextNotes(noteObjects, rollData);\n    rollData.item = {};\n\n    const changes = sources\n      .filter((item) => Number.isInteger(item.value))\n      .map((i) => {\n        return `${i.value}[${i.name}]`;\n      });\n\n    // Add attack bonuses from changes\n    const attackTargets = [\"attack\"].concat(options.melee ? [\"mattack\"] : [\"rattack\"]);\n    const attackChanges = this.changes.filter((c) => {\n      return attackTargets.includes(c.subTarget);\n    });\n    changes.push(\n      ...attackChanges.map((c) => {\n        c.applyChange(this);\n        return `${c.value}[${c.parent ? c.parent.name : c.data.modifier}]`;\n      })\n    );\n\n    // Add ability modifier\n    const atkAbl = getProperty(this, `system.attributes.attack.${options.melee ? \"melee\" : \"ranged\"}Ability`);\n    changes.push(`${getProperty(this, `system.abilities.${atkAbl}.mod`)}[${CONFIG.FFD20.abilities[atkAbl]}]`);\n\n    const size = this.system.traits.size ?? \"med\";\n    rollData.sizeBonus = CONFIG.FFD20.sizeMods[size];\n    if (rollData.sizeBonus != 0) changes.push(`@sizeBonus[${game.i18n.localize(\"FFD20.Size\")}]`);\n\n    const props = [];\n    if (notes.length > 0) props.push({ header: game.i18n.localize(\"FFD20.Notes\"), value: notes });\n\n    const rollOptions = {\n      ...options,\n      parts: changes,\n      rollData,\n      subject: { core: \"attack\" },\n      flavor: game.i18n.localize(`FFD20.${options.melee ? \"Melee\" : \"Ranged\"}`),\n      chatTemplateData: { hasProperties: props.length > 0, properties: props },\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollAttack\", this, rollOptions) === false) return;\n    const result = await ffd20.dice.d20Roll(rollOptions);\n    Hooks.callAll(\"ffd20ActorRollAttack\", this, result);\n    return result;\n  }\n\n  /**\n   * Roll a Caster Level check using a particular spellbook of this actor\n   *\n   * @param {string} spellbookKey\n   * @param {ActorRollOptions} [options={}]\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollCL(spellbookKey, options = {}) {\n    const spellbook = this.system.attributes.spells.spellbooks[spellbookKey];\n    const rollData = duplicate(this.getRollData());\n    rollData.cl = spellbook.cl.total;\n\n    if (callOldNamespaceHook(\"actorRoll\", \"ffd20PreActorRollCl\", undefined, this, \"cl\", spellbookKey, options) === false)\n      return;\n\n    // Set up roll parts\n    const parts = [];\n\n    const describePart = (value, label) => parts.push(`${value}[${label}]`);\n    const srcDetails = (s) => s?.reverse().forEach((d) => describePart(d.value, d.name, -10));\n    srcDetails(this.sourceDetails[`system.attributes.spells.spellbooks.${spellbookKey}.cl.total`]);\n\n    // Add contextual caster level string\n    const notes = this.getContextNotesParsed(`spell.cl.${spellbookKey}`);\n\n    // Wound Threshold penalty\n    const wT = this.getWoundThresholdData();\n    if (wT.valid) notes.push(game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[wT.level]));\n\n    const props = [];\n    if (notes.length > 0) props.push({ header: game.i18n.localize(\"FFD20.Notes\"), value: notes });\n\n    const rollOptions = {\n      ...options,\n      parts,\n      rollData,\n      subject: { core: \"cl\", spellbook: spellbookKey },\n      flavor: game.i18n.localize(\"FFD20.CasterLevelCheck\"),\n      chatTemplateData: { hasProperties: props.length > 0, properties: props },\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollCl\", this, spellbookKey, rollOptions) === false) return;\n    const result = await ffd20.dice.d20Roll(rollOptions);\n    Hooks.callAll(\"ffd20ActorRollCl\", this, result, spellbookKey);\n    return result;\n  }\n\n  /**\n   * Roll a concentration check using a particular spellbook of this actor\n   *\n   * @param {string} spellbookKey\n   * @param {ActorRollOptions} [options={}]\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollConcentration(spellbookKey, options = {}) {\n    const spellbook = this.system.attributes.spells.spellbooks[spellbookKey];\n    const rollData = duplicate(this.getRollData());\n    rollData.cl = spellbook.cl.total;\n    rollData.mod = this.system.abilities[spellbook.ability]?.mod ?? 0;\n\n    if (\n      Hooks.call(\n        \"actorRoll\",\n        \"ffd20PreActorRollConcentration\",\n        undefined,\n        this,\n        \"concentration\",\n        spellbookKey,\n        options\n      ) === false\n    )\n      return;\n\n    // Set up roll parts\n    const parts = [];\n\n    const describePart = (value, label) => parts.push(`${value}[${label}]`);\n    const srcDetails = (s) => s?.reverse().forEach((d) => describePart(d.value, d.name, -10));\n    srcDetails(this.sourceDetails[`system.attributes.spells.spellbooks.${spellbookKey}.concentration.total`]);\n\n    // Add contextual concentration string\n    const notes = this.getContextNotesParsed(`spell.concentration.${spellbookKey}`);\n\n    // Wound Threshold penalty\n    const wT = this.getWoundThresholdData();\n    if (wT.valid) notes.push(game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[wT.level]));\n    // TODO: Make the penalty show separate of the CL.total.\n\n    const props = [];\n    if (notes.length > 0) props.push({ header: game.i18n.localize(\"FFD20.Notes\"), value: notes });\n\n    let formulaRoll = 0;\n    if (spellbook.concentrationFormula.length)\n      formulaRoll = RollFFD20.safeRoll(spellbook.concentrationFormula, rollData).total;\n    rollData.formulaBonus = formulaRoll;\n\n    const rollOptions = {\n      ...options,\n      parts,\n      rollData,\n      subject: { core: \"concentration\", spellbook: spellbookKey },\n      flavor: game.i18n.localize(\"FFD20.ConcentrationCheck\"),\n      chatTemplateData: { hasProperties: props.length > 0, properties: props },\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollConcentration\", this, rollOptions, spellbookKey) === false) return;\n    const result = ffd20.dice.d20Roll(rollOptions);\n    Hooks.callAll(\"ffd20ActorRollConcentration\", this, result, spellbookKey);\n    return result;\n  }\n\n  getDefenseHeaders() {\n    const data = this.system;\n    const headers = [];\n\n    const reSplit = CONFIG.FFD20.re.traitSeparator;\n    const misc = [];\n\n    // Damage reduction\n    if (data.traits.dr.length) {\n      headers.push({ header: game.i18n.localize(\"FFD20.DamRed\"), value: data.traits.dr.split(reSplit) });\n    }\n    // Energy resistance\n    if (data.traits.eres.length) {\n      headers.push({ header: game.i18n.localize(\"FFD20.EnRes\"), value: data.traits.eres.split(reSplit) });\n    }\n    // Damage vulnerabilities\n    if (data.traits.dv.value.length || data.traits.dv.custom.length) {\n      const value = [].concat(\n        data.traits.dv.value.map((obj) => {\n          return CONFIG.FFD20.damageTypes[obj];\n        }),\n        data.traits.dv.custom.length > 0 ? data.traits.dv.custom.split(\";\") : []\n      );\n      headers.push({ header: game.i18n.localize(\"FFD20.DamVuln\"), value: value });\n    }\n    // Condition resistance\n    if (data.traits.cres.length) {\n      headers.push({ header: game.i18n.localize(\"FFD20.ConRes\"), value: data.traits.cres.split(reSplit) });\n    }\n    // Immunities\n    if (\n      data.traits.di.value.length ||\n      data.traits.di.custom.length ||\n      data.traits.ci.value.length ||\n      data.traits.ci.custom.length\n    ) {\n      const value = [].concat(\n        data.traits.di.value.map((obj) => {\n          return CONFIG.FFD20.damageTypes[obj];\n        }),\n        data.traits.di.custom.length > 0 ? data.traits.di.custom.split(\";\") : [],\n        data.traits.ci.value.map((obj) => {\n          return CONFIG.FFD20.conditionTypes[obj];\n        }),\n        data.traits.ci.custom.length > 0 ? data.traits.ci.custom.split(\";\") : []\n      );\n      headers.push({ header: game.i18n.localize(\"FFD20.ImmunityPlural\"), value: value });\n    }\n    // Spell Resistance\n    if (data.attributes.sr.total > 0) {\n      misc.push(game.i18n.localize(\"FFD20.SpellResistanceNote\").format(data.attributes.sr.total));\n    }\n\n    if (misc.length > 0) {\n      headers.push({ header: game.i18n.localize(\"FFD20.MiscShort\"), value: misc });\n    }\n\n    return headers;\n  }\n\n  getInitiativeContextNotes() {\n    const notes = this.getContextNotes(\"misc.init\").reduce((arr, o) => {\n      for (const n of o.notes) arr.push(...n.split(/[\\n\\r]+/));\n      return arr;\n    }, []);\n\n    let notesHTML;\n    if (notes.length > 0) {\n      // Format notes if they're present\n      const notesHTMLParts = [];\n      notes.forEach((note) => notesHTMLParts.push(`<span class=\"tag\">${note}</span>`));\n      notesHTML =\n        '<div class=\"flexcol property-group gm-sensitive\"><label>' +\n        game.i18n.localize(\"FFD20.Notes\") +\n        '</label> <div class=\"flexrow tag-list\">' +\n        notesHTMLParts.join(\"\") +\n        \"</div></div>\";\n    }\n\n    return [notes, notesHTML];\n  }\n\n  async rollInitiative({\n    createCombatants = false,\n    rerollInitiative = false,\n    initiativeOptions = {},\n    skipDialog = false,\n  } = {}) {\n    // Obtain (or create) a combat encounter\n    let combat = game.combat;\n    if (!combat) {\n      if (game.user.isGM) {\n        const combatData = { active: true };\n        if (canvas?.scene?.id) combatData.scene = canvas.scene.id;\n        combat = await game.combats.documentClass.create(combatData);\n      } else {\n        ui.notifications.warn(game.i18n.localize(\"COMBAT.NoneActive\"));\n        return null;\n      }\n    }\n\n    // Create new combatants\n    if (createCombatants) {\n      const tokens = this.isToken ? [this.token] : this.getActiveTokens();\n      const createData = tokens.reduce((arr, t) => {\n        if (t.inCombat) return arr;\n        arr.push({ tokenId: t.id, actorId: this.id, hidden: t.hidden });\n        return arr;\n      }, []);\n      // Add special combatant if there are no tokens\n      if (tokens.length == 0) {\n        createData.push({ actorId: this.id });\n      }\n      await combat.createEmbeddedDocuments(\"Combatant\", createData);\n    }\n\n    // Iterate over combatants to roll for\n    const combatantIds = combat.combatants.reduce((arr, c) => {\n      if (c.actor.id !== this.id || (this.isToken && c.data.tokenId !== this.token.id)) return arr;\n      if (c.initiative !== null && !rerollInitiative) return arr;\n      arr.push(c.id);\n      return arr;\n    }, []);\n    return combatantIds.length\n      ? combat.rollInitiative(\n          combatantIds,\n          mergeObject(initiativeOptions, {\n            skipDialog,\n          })\n        )\n      : { combat, messages: [] };\n  }\n\n  /**\n   * Roll a specific saving throw\n   *\n   * @param {string} savingThrowId\n   * @param {ActorRollOptions} [options={}]\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollSavingThrow(savingThrowId, options = {}) {\n    if (!this.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    if (\n      callOldNamespaceHook(\"actorRoll\", \"ffd20PreActorRollSave\", undefined, this, \"save\", savingThrowId, options) ===\n      false\n    )\n      return;\n\n    // Add contextual notes\n    const rollData = this.getRollData();\n    const noteObjects = this.getContextNotes(`savingThrow.${savingThrowId}`);\n    const notes = this.formatContextNotes(noteObjects, rollData);\n\n    const parts = [];\n\n    // Get base\n    const base = this.system.attributes.savingThrows[savingThrowId]?.base;\n    if (base) parts.push(`${base}[${game.i18n.localize(\"FFD20.Base\")}]`);\n\n    // Add changes\n    let changeBonus = [];\n    const changes = this.changes.filter((c) => [\"allSavingThrows\", savingThrowId].includes(c.subTarget));\n    {\n      // Get damage bonus\n      changeBonus = getHighestChanges(\n        changes.filter((c) => {\n          return ![\"set\", \"=\"].includes(c.operator);\n        }),\n        { ignoreTarget: true }\n      ).reduce((cur, c) => {\n        if (c.value)\n          cur.push({\n            value: c.value,\n            source: c.flavor,\n          });\n        return cur;\n      }, []);\n    }\n    for (const c of changeBonus) {\n      parts.push(`${c.value}[${c.source}]`);\n    }\n\n    // Wound Threshold penalty\n    if (rollData.attributes.woundThresholds.penalty > 0) {\n      notes.push(game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[rollData.attributes.woundThresholds.level]));\n      parts.push(\n        `- @attributes.woundThresholds.penalty[${game.i18n.localize(\n          CONFIG.FFD20.woundThresholdConditions[rollData.attributes.woundThresholds.level]\n        )}]`\n      );\n    }\n\n    // Roll saving throw\n    const props = this.getDefenseHeaders();\n    if (notes.length > 0) props.push({ header: game.i18n.localize(\"FFD20.Notes\"), value: notes });\n    const label = CONFIG.FFD20.savingThrows[savingThrowId];\n\n    const rollOptions = {\n      ...options,\n      parts,\n      rollData,\n      flavor: game.i18n.localize(\"FFD20.SavingThrow\").format(label),\n      subject: { save: savingThrowId },\n      chatTemplateData: { hasProperties: props.length > 0, properties: props },\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollSave\", this, options, savingThrowId) === false) return;\n    const result = await ffd20.dice.d20Roll(rollOptions);\n    Hooks.callAll(\"ffd20ActorRollSave\", this, result, savingThrowId);\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Roll an Ability Test\n   * Prompt the user for input regarding Advantage/Disadvantage and any Situational Bonus\n   *\n   * @param {string} abilityId    The ability ID (e.g. \"str\")\n   * @param {object} [options={}]      Options which configure how ability tests are rolled\n   * @returns {ChatMessage|object|void} The chat message if one was created, or its data if not. `void` if the roll was cancelled.\n   */\n  async rollAbilityTest(abilityId, options = {}) {\n    if (!this.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    if (\n      callOldNamespaceHook(\"actorRoll\", \"ffd20PreActorRollAbility\", undefined, this, \"ability\", abilityId, options) ===\n      false\n    )\n      return;\n\n    // Add contextual notes\n    const rollData = this.getRollData();\n    const noteObjects = this.getContextNotes(`abilityChecks.${abilityId}`);\n    const notes = this.formatContextNotes(noteObjects, rollData);\n\n    const label = CONFIG.FFD20.abilities[abilityId];\n    const abl = this.system.abilities[abilityId];\n\n    const parts = [`@abilities.${abilityId}.mod[${label}]`];\n    if (abl.checkMod != 0) {\n      const changes = this.sourceDetails[`system.abilities.${abilityId}.checkMod`];\n      for (const c of changes) parts.push(`${c.value}[${c.name}]`);\n    }\n    if (this.system.attributes.energyDrain) {\n      parts.push(\"-@attributes.energyDrain\");\n    }\n\n    // Wound Threshold penalty\n    if (rollData.attributes.woundThresholds.penalty > 0) {\n      notes.push(game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[rollData.attributes.woundThresholds.level]));\n      parts.push(\n        `- @attributes.woundThresholds.penalty[${game.i18n.localize(\n          CONFIG.FFD20.woundThresholdConditions[rollData.attributes.woundThresholds.level]\n        )}]`\n      );\n    }\n\n    const props = [];\n    if (notes.length > 0) props.push({ header: game.i18n.localize(\"FFD20.Notes\"), value: notes });\n\n    const rollOptions = {\n      ...options,\n      parts,\n      rollData,\n      flavor: game.i18n.localize(\"FFD20.AbilityTest\").format(label),\n      subject: { ability: abilityId },\n      chatTemplateData: { hasProperties: props.length > 0, properties: props },\n      speaker: CONFIG.ChatMessage.documentClass.getSpeaker({ actor: this }),\n    };\n    if (Hooks.call(\"ffd20PreActorRollAbility\", this, options, abilityId) === false);\n    const result = await ffd20.dice.d20Roll(rollOptions);\n    Hooks.callAll(\"ffd20ActorRollAbility\", this, result, abilityId);\n    return result;\n  }\n\n  /**\n   * Show defenses in chat\n   *\n   * @param root0\n   * @param root0.rollMode\n   */\n  async rollDefenses({ rollMode = null } = {}) {\n    if (!this.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n    const rollData = this.getRollData();\n\n    // Add contextual AC notes\n    const acNoteObjects = this.getContextNotes(\"misc.ac\");\n    const acNotes = this.formatContextNotes(acNoteObjects, rollData);\n    if (this.system.attributes.acNotes.length > 0) acNotes.push(...this.system.attributes.acNotes.split(/[\\n\\r]+/));\n\n    // Add contextual CMD notes\n    const cmdNoteObjects = this.getContextNotes(\"misc.cmd\");\n    const cmdNotes = this.formatContextNotes(cmdNoteObjects, rollData);\n    if (this.system.attributes.cmdNotes.length > 0) cmdNotes.push(...this.system.attributes.cmdNotes.split(/[\\n\\r]+/));\n\n    // Add contextual SR notes\n    const srNoteObjects = this.getContextNotes(\"misc.sr\");\n    const srNotes = this.formatContextNotes(srNoteObjects, rollData);\n    if (this.system.attributes.srNotes.length > 0) srNotes.push(...this.system.attributes.srNotes.split(/[\\n\\r]+/));\n\n    // Add misc data\n    const reSplit = CONFIG.FFD20.re.traitSeparator;\n    // Damage Reduction\n    let drNotes = [];\n    if (this.system.traits.dr.length) {\n      drNotes = this.system.traits.dr.split(reSplit);\n    }\n    // Energy Resistance\n    const energyResistance = [];\n    if (this.system.traits.eres.length) {\n      energyResistance.push(...this.system.traits.eres.split(reSplit));\n    }\n    // Damage Immunity\n    if (this.system.traits.di.value.length || this.system.traits.di.custom.length) {\n      const values = [\n        ...this.system.traits.di.value.map((obj) => {\n          return CONFIG.FFD20.damageTypes[obj];\n        }),\n        ...(this.system.traits.di.custom.length > 0 ? this.system.traits.di.custom.split(reSplit) : []),\n      ];\n      energyResistance.push(...values.map((o) => game.i18n.localize(\"FFD20.ImmuneTo\").format(o)));\n    }\n    // Damage Vulnerability\n    if (this.system.traits.dv.value.length || this.system.traits.dv.custom.length) {\n      const values = [\n        ...this.system.traits.dv.value.map((obj) => {\n          return CONFIG.FFD20.damageTypes[obj];\n        }),\n        ...(this.system.traits.dv.custom.length > 0 ? this.system.traits.dv.custom.split(reSplit) : []),\n      ];\n      energyResistance.push(...values.map((o) => game.i18n.localize(\"FFD20.VulnerableTo\").format(o)));\n    }\n\n    // Wound Threshold penalty\n    const wT = this.getWoundThresholdData();\n    if (wT.valid) {\n      const wTlabel = game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[wT.level]);\n      acNotes.push(wTlabel);\n      cmdNotes.push(wTlabel);\n    }\n\n    // Get actor's token\n    const token =\n      this.token instanceof TokenDocument\n        ? this.token.object\n        : this.token ?? canvas.tokens.placeables.find((t) => t.actor && t.actor.id === this.id);\n\n    // Create message\n    const d = this.system;\n    const data = {\n      actor: this,\n      name: this.name,\n      tokenId: this.token ? `${this.token.uuid}` : null,\n      ac: {\n        normal: d.attributes.ac.normal.total,\n        touch: d.attributes.ac.touch.total,\n        flatFooted: d.attributes.ac.flatFooted.total,\n        notes: acNotes,\n      },\n      cmd: {\n        normal: d.attributes.cmd.total,\n        flatFooted: d.attributes.cmd.flatFootedTotal,\n        notes: cmdNotes,\n      },\n      misc: {\n        sr: d.attributes.sr.total,\n        srNotes: srNotes,\n        drNotes: drNotes,\n        energyResistance: energyResistance,\n      },\n      tokenUuid: token?.document.uuid,\n    };\n    // Add regeneration and fast healing\n    if ((getProperty(d, \"traits.fastHealing\") || \"\").length || (getProperty(d, \"traits.regen\") || \"\").length) {\n      data.regen = {\n        regen: d.traits.regen,\n        fastHealing: d.traits.fastHealing,\n      };\n    }\n\n    setProperty(data, \"flags.ffd20.subject\", \"defenses\");\n\n    const chatData = {\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      rollMode,\n    };\n\n    const msg = await createCustomChatMessage(\"systems/ffd20/templates/chat/defenses.hbs\", data, chatData);\n  }\n\n  /**\n   * Wrapper for the static function, taking this actor as the only target.\n   *\n   * @param value\n   * @param options\n   */\n  async applyDamage(value, options = {}) {\n    return this.constructor.applyDamage(\n      value,\n      mergeObject(options, {\n        targets: [this],\n      })\n    );\n  }\n\n  /**\n   * Easy way to toggle a condition.\n   *\n   * @param key - A direct condition key, as per CONFIG.FFD20.conditions, such as `shaken` or `dazed`.\n   */\n  async toggleCondition(key) {\n    key = `system.attributes.conditions.${key}`;\n\n    const newStatus = !getProperty(this, key);\n    const deleteKey = key.replace(/(\\w+)$/, (condition) => `-=${condition}`);\n    const updateData = newStatus ? { [key]: true } : { [deleteKey]: null };\n    await this.update(updateData);\n  }\n\n  /**\n   * Easy way to set a condition.\n   *\n   * @param {string} key - A direct condition key, as per CONFIG.FFD20.conditions, such as `shaken` or `dazed`.\n   * @param {boolean} enabled - Whether to enable (true) the condition, or disable (false) it.\n   */\n  async setCondition(key, enabled) {\n    key = `system.attributes.conditions.${key}`;\n\n    const newStatus = !getProperty(this, key);\n    if (newStatus !== enabled) return;\n    const deleteKey = key.replace(/(\\w+)$/, (condition) => `-=${condition}`);\n    const updateData = newStatus ? { [key]: true } : { [deleteKey]: null };\n    await this.update(updateData);\n  }\n\n  /**\n   * Easy way to determine whether this actor has a condition.\n   *\n   * @param {string} key - A direct condition key, as per CONFIG.FFD20.conditions, such as `shaken` or `dazed`.\n   */\n  hasCondition(key) {\n    key = `system.attributes.conditions.${key}`;\n    return getProperty(this, key) === true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Apply rolled dice damage to the token or tokens which are currently controlled.\n   * This allows for damage to be scaled by a multiplier to account for healing, critical hits, or resistance\n   * If Shift is held, will prompt for adjustments based on damage reduction and energy resistances\n   *\n   * @param {number} value - The amount of damage to deal.\n   * @param {object} [options] - Object containing default settings for overriding\n   * @param {boolean} [options.forceDialog=true] - Forces the opening of a Dialog as if Shift was pressed\n   * @param {string} [options.reductionDefault] - Default value for Damage Reduction\n   * @param {boolean} [options.asNonlethal] - Marks the damage as non-lethal\n   * @param {Array.<Token|Actor>} [options.targets] - Override the targets to apply damage to\n   * @param {number} options.critMult - Critical multiplier as needed for Wounds & Vigor variant health rule. Set to 0 for non-critical hits.\n   * @param {boolean} options.asWounds - Apply damage to wounds directly instead of vigor, as needed for Wounds & Vigor variant health rule.\n   * @returns {Promise}\n   */\n  static async applyDamage(\n    value,\n    {\n      forceDialog = false,\n      reductionDefault = \"\",\n      asNonlethal = false,\n      targets = null,\n      critMult = 0,\n      asWounds = false,\n    } = {}\n  ) {\n    const promises = [];\n    let controlled = canvas.tokens.controlled,\n      healingInvert = 1;\n\n    // Override targets, if supplied\n    if (targets instanceof Array) {\n      controlled = targets.filter((o) => o instanceof Token || o instanceof Actor);\n    }\n\n    const healthConfig = game.settings.get(\"ffd20\", \"healthConfig\");\n\n    const numReg = /(\\d+)/g,\n      sliceReg = /[^,;\\n]*(\\d+)[^,;\\n]*/g,\n      sliceReg2 = /[^,;\\n]+/g;\n\n    const _submit = async function (form, multiplier) {\n      if (form) {\n        value = form.find('[name=\"damage\"]').val();\n        let dR = form.find('[name=\"damage-reduction\"]').val();\n        value = value.length ? RollFFD20.safeRoll(value, {}, []).total : 0;\n        dR = dR.length ? RollFFD20.safeRoll(dR, {}, []).total : 0;\n        if (multiplier < 0) {\n          value = Math.ceil(value * multiplier);\n          value = Math.min(value - dR, 0);\n        } else {\n          value = Math.floor(value * (multiplier ?? 1));\n          value = Math.max(value - dR, 0);\n        }\n        const checked = [...form.find(\".tokenAffected:checked\")].map((tok) => tok.name.replace(\"affect.\", \"\"));\n        controlled = controlled.filter((con) => checked.includes(con.id));\n      }\n\n      if (value == 0) return; // Early exit\n\n      for (const t of controlled) {\n        const a = t instanceof Token ? t.actor : t;\n\n        if (!a.isOwner) {\n          const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(this.name);\n          console.warn(msg);\n          ui.notifications.warn(msg);\n          continue;\n        }\n\n        const actorType = { character: \"pc\", npc: \"npc\" }[a.type];\n        const useWoundsAndVigor = healthConfig.variants[actorType]?.useWoundsAndVigor ?? false,\n          hp = !useWoundsAndVigor ? a.system.attributes.hp : a.system.attributes.vigor,\n          tmp = hp.temp || 0;\n\n        const update = {};\n\n        if (useWoundsAndVigor) {\n          const currentHealth = hp.value;\n          let woundAdjust = 0;\n\n          if (asWounds) {\n            woundAdjust -= value;\n            value = 0;\n          }\n\n          // Temp HP adjustment\n          const dt = value > 0 ? Math.min(tmp, value) : 0;\n          value -= dt;\n\n          // Nonlethal damage\n          if (asNonlethal && value > 0) {\n            // Wounds & Vigor\n            if (currentHealth > 0) {\n              value = Math.min(currentHealth, value);\n            } else {\n              woundAdjust -= critMult > 1 ? critMult : 1;\n              value = 0; // No other bleedover to wounds\n            }\n          }\n\n          // Create update data\n          if (dt != 0) update[\"system.attributes.vigor.temp\"] = tmp - dt;\n          if (value != 0) {\n            let newHP = Math.min(hp.value - value, hp.max);\n            if (value > 0) {\n              if (hp.value > 0) {\n                if (newHP < 0) {\n                  if (critMult > 0) {\n                    woundAdjust -= -newHP;\n                    woundAdjust -= critMult;\n                  }\n                  newHP = 0;\n                }\n              } else {\n                woundAdjust -= value;\n              }\n            }\n\n            if (newHP != hp.value) update[\"system.attributes.vigor.value\"] = newHP;\n          }\n          if (woundAdjust != 0) {\n            const wounds = a.data.attributes.wounds;\n            update[\"system.attributes.wounds.value\"] = Math.max(0, Math.min(wounds.value + woundAdjust, wounds.max));\n          }\n        }\n        // Normal Hit Points\n        else {\n          // Nonlethal damage\n          let nld = 0;\n          if (asNonlethal && value > 0) {\n            nld = Math.min(hp.max - hp.nonlethal, value);\n            value -= nld;\n          }\n\n          // Temp HP adjustment\n          const dt = value > 0 ? Math.min(tmp, value) : 0;\n\n          // Create update data\n          update[\"system.attributes.hp.nonlethal\"] = hp.nonlethal + nld;\n          update[\"system.attributes.hp.temp\"] = tmp - dt;\n          update[\"system.attributes.hp.value\"] = Math.min(hp.value - (value - dt), hp.max);\n        }\n\n        promises.push(a.update(update));\n      }\n      return Promise.all(promises);\n    };\n\n    if (ffd20.skipConfirmPrompt ? !forceDialog : forceDialog) {\n      if (value < 0) {\n        healingInvert = -1;\n        value = -1 * value;\n      }\n      const tokens = controlled.map((tok) => {\n        const isToken = tok instanceof Token;\n        const actor = isToken ? tok.actor : tok;\n        return {\n          _id: isToken ? tok.id : actor.id,\n          name: isToken ? tok.name : actor.name,\n          isToken,\n          dr: actor.system.traits.dr.match(sliceReg),\n          eres: actor.system.traits.eres.match(sliceReg),\n          di: [...actor.system.traits.di.value, ...(actor.system.traits.di.custom.match(sliceReg2) ?? [])],\n          dv: [...actor.system.traits.dv.value, ...(actor.system.traits.dv.custom.match(sliceReg2) ?? [])],\n          checked: true,\n        };\n      });\n\n      reductionDefault = reductionDefault ?? \"\";\n\n      // Dialog configuration and callbacks\n      const template = \"systems/ffd20/templates/apps/damage-dialog.hbs\";\n      const dialogData = {\n        damage: value,\n        healing: healingInvert == -1 ? true : false,\n        damageReduction: reductionDefault,\n        tokens: tokens,\n        nonlethal: asNonlethal,\n      };\n      const html = await renderTemplate(template, dialogData);\n\n      return new Promise((resolve) => {\n        const buttons = {};\n        buttons.normal = {\n          label: game.i18n.localize(\"FFD20.Apply\"),\n          callback: (html) => resolve(_submit.call(this, html, 1 * healingInvert)),\n        };\n        buttons.half = {\n          label: game.i18n.localize(\"FFD20.ApplyHalf\"),\n          callback: (html) => resolve(_submit.call(this, html, 0.5 * healingInvert)),\n        };\n\n        const d = new Dialog(\n          {\n            title: healingInvert > 0 ? game.i18n.localize(\"FFD20.ApplyDamage\") : game.i18n.localize(\"FFD20.ApplyHealing\"),\n            content: html,\n            buttons: buttons,\n            default: \"normal\",\n            close: (html) => {\n              resolve(false);\n            },\n            render: (inp) => {\n              /**\n               *\n               */\n              function swapSelected() {\n                const checked = [...inp[0].querySelectorAll('.selected-tokens input[type=\"checkbox\"]')];\n                checked.forEach((chk) => (chk.checked = !chk.checked));\n              }\n              /**\n               * @param e\n               */\n              function setReduction(e) {\n                inp[0].querySelector('input[name=\"damage-reduction\"]').value =\n                  e.currentTarget.innerText.match(numReg) ?? \"\";\n              }\n              /**\n               * @param event\n               */\n              function mouseWheelAdd(event) {\n                const el = event.currentTarget;\n\n                //Digits with optional sign only\n                if (/[^\\d+-]|(?:\\d[+-])/.test(el.value.trim())) return;\n\n                const value = parseFloat(el.value) || 0;\n                const increase = -Math.sign(event.originalEvent.deltaY);\n\n                el.value = (value + increase).toString();\n              }\n\n              inp.on(\"click\", 'a[name=\"swap-selected\"]', swapSelected);\n              inp.on(\"click\", 'a[name=\"clear-reduction\"], p.notes a', setReduction);\n              inp.on(\"wheel\", \"input\", mouseWheelAdd);\n            },\n          },\n          {\n            classes: [\"dialog\", \"ffd20\", \"apply-hit-points\"],\n          }\n        );\n        d.render(true);\n      });\n    } else return _submit();\n  }\n\n  /**\n   * Returns effective Wound Threshold multiplier with rules and overrides applied.\n   *\n   * @param data\n   */\n  getWoundThresholdMultiplier(data = null) {\n    data = data ?? this.system;\n\n    const hpconf = game.settings.get(\"ffd20\", \"healthConfig\").variants;\n    const conf = this.type === \"npc\" ? hpconf.npc : hpconf.pc;\n    const override = data.attributes.woundThresholds.override ?? -1;\n    return override >= 0 && conf.allowWoundThresholdOverride ? override : conf.useWoundThresholds;\n  }\n\n  /**\n   * Returns Wound Threshold relevant data.\n   *\n   * @param {*} rollData Provided valid rollData\n   * @param data\n   */\n  getWoundThresholdData(data = null) {\n    data = data ?? this.system;\n\n    const woundMult = this.getWoundThresholdMultiplier(data),\n      woundLevel = data.attributes.woundThresholds.level ?? 0,\n      woundPenalty = woundLevel * woundMult + (data.attributes.woundThresholds.mod ?? 0);\n    return {\n      level: woundLevel,\n      penalty: woundPenalty,\n      multiplier: woundMult,\n      valid: woundLevel > 0 && woundMult > 0,\n    };\n  }\n\n  /**\n   * Updates attributes.woundThresholds.level variable.\n   */\n  updateWoundThreshold() {\n    const hpconf = game.settings.get(\"ffd20\", \"healthConfig\").variants;\n    const usage = this.type === \"npc\" ? hpconf.npc.useWoundThresholds : hpconf.pc.useWoundThresholds;\n    const wt = this.system.attributes.woundThresholds;\n    if (!usage) {\n      wt.level = 0;\n      wt.penaltyBase = 0;\n      wt.penalty = 0;\n      wt.mod = 0;\n      return;\n    }\n    const hp = this.system.attributes.hp,\n      curHP = hp.value,\n      tempHP = hp.temp ?? 0,\n      maxHP = hp.max;\n\n    let level = usage > 0 ? Math.clamped(4 - Math.ceil(((curHP + tempHP) / maxHP) * 4), 0, 3) : 0;\n    if (Number.isNaN(level)) level = 0; // Division by 0 due to max HP on new actors.\n\n    const wtMult = this.getWoundThresholdMultiplier();\n    const wtMod = wt.mod ?? 0;\n\n    wt.level = level;\n    wt.penaltyBase = level * wtMult; // To aid relevant formulas\n    wt.penalty = level * wtMult + wtMod;\n\n    const penalty = wt.penalty;\n    const changeFlatKeys = CONFIG.FFD20.woundThresholdChangeTargets;\n    for (const fk of changeFlatKeys) {\n      let flats = getChangeFlat.call(this, fk, \"penalty\", this.system);\n      if (!(flats instanceof Array)) flats = [flats];\n      for (const k of flats) {\n        if (!k) continue;\n        const curValue = getProperty(this, k) ?? 0;\n        setProperty(this, k, curValue - penalty);\n      }\n    }\n  }\n\n  get allSkills() {\n    const result = [];\n    for (const [k, s] of Object.entries(this.system.skills)) {\n      if (!s) continue;\n      result.push(k);\n      if (s.subSkills) {\n        for (const k2 of Object.keys(s.subSkills)) {\n          result.push(`${k}.subSkills.${k2}`);\n        }\n      }\n    }\n    return result;\n  }\n\n  get allNotes() {\n    const result = [];\n\n    const noteItems = this.items.filter((o) => {\n      return o.system.contextNotes != null;\n    });\n\n    for (const o of noteItems) {\n      if (!o.isActive) continue;\n      if (!o.system.contextNotes || o.system.contextNotes.length === 0) continue;\n      result.push({ notes: o.system.contextNotes, item: o });\n    }\n\n    return result;\n  }\n\n  /**\n   * @returns {ItemFFD20[]} All items on this actor, including those in containers.\n   */\n  get allItems() {\n    return [...this.containerItems, ...Array.from(this.items)];\n  }\n\n  /**\n   * Generates an array with all the active context-sensitive notes for the given context on this actor.\n   *\n   * @param {string|Handlebars.SafeString} context - The context to draw from.\n   */\n  getContextNotes(context) {\n    if (context.string) context = context.string;\n    const result = this.allNotes;\n\n    // Attacks\n    if (context.match(/^attacks\\.(.+)/)) {\n      const key = RegExp.$1;\n      for (const note of result) {\n        note.notes = note.notes\n          .filter((o) => {\n            return o.subTarget === key;\n          })\n          .map((o) => {\n            return o.text;\n          });\n      }\n\n      return result;\n    }\n\n    // Skill\n    if (context.match(/^skill\\.(.+)/)) {\n      const skillKey = RegExp.$1;\n      const skill = this.getSkillInfo(skillKey);\n      const ability = skill.ability;\n      for (const note of result) {\n        note.notes = note.notes\n          .filter((o) => {\n            return (\n              // Check for skill.context or skill.xyz.subSkills.context\n              o.subTarget === context ||\n              o.subTarget?.split(\".\")?.[3] === context?.split(\".\")?.[1] ||\n              o.subTarget === `${ability}Skills` ||\n              o.subTarget === \"skills\"\n            );\n          })\n          .map((o) => {\n            return o.text;\n          });\n      }\n\n      return result;\n    }\n\n    // Saving throws\n    if (context.match(/^savingThrow\\.(.+)/)) {\n      const saveKey = RegExp.$1;\n      for (const note of result) {\n        note.notes = note.notes\n          .filter((o) => {\n            return o.subTarget === saveKey || o.subTarget === \"allSavingThrows\";\n          })\n          .map((o) => {\n            return o.text;\n          });\n      }\n\n      if (this.system.attributes.saveNotes != null && this.system.attributes.saveNotes !== \"\") {\n        result.push({ notes: [this.system.attributes.saveNotes], item: null });\n      }\n\n      return result;\n    }\n\n    // Ability checks\n    if (context.match(/^abilityChecks\\.(.+)/)) {\n      const ablKey = RegExp.$1;\n      for (const note of result) {\n        note.notes = note.notes\n          .filter((o) => {\n            return o.subTarget === `${ablKey}Checks` || o.subTarget === \"allChecks\";\n          })\n          .map((o) => {\n            return o.text;\n          });\n      }\n\n      return result;\n    }\n\n    // Misc\n    if (context.match(/^misc\\.(.+)/)) {\n      const miscKey = RegExp.$1;\n      for (const note of result) {\n        note.notes = note.notes\n          .filter((o) => {\n            return o.subTarget === miscKey;\n          })\n          .map((o) => {\n            return o.text;\n          });\n      }\n\n      return result;\n    }\n\n    if (context.match(/^spell\\.concentration\\.([a-z]+)$/)) {\n      const spellbookKey = RegExp.$1;\n      for (const note of result) {\n        note.notes = note.notes\n          .filter((o) => {\n            return o.subTarget === \"concentration\";\n          })\n          .map((o) => {\n            return o.text;\n          });\n      }\n\n      const spellbookNotes = getProperty(\n        this,\n        `system.attributes.spells.spellbooks.${spellbookKey}.concentrationNotes`\n      );\n      if (spellbookNotes.length) {\n        result.push({ notes: spellbookNotes.split(/[\\n\\r]+/), item: null });\n      }\n\n      return result;\n    }\n\n    if (context.match(/^spell\\.cl\\.([a-z]+)$/)) {\n      const spellbookKey = RegExp.$1;\n      for (const note of result) {\n        note.notes = note.notes\n          .filter((o) => {\n            return o.subTarget === \"cl\";\n          })\n          .map((o) => {\n            return o.text;\n          });\n      }\n\n      const spellbookNotes = getProperty(this, `system.attributes.spells.spellbooks.${spellbookKey}.clNotes`);\n      if (spellbookNotes.length) {\n        result.push({ notes: spellbookNotes.split(/[\\n\\r]+/), item: null });\n      }\n\n      return result;\n    }\n\n    if (context.match(/^spell\\.effect$/)) {\n      for (const note of result) {\n        note.notes = note.notes.filter((o) => o.subTarget === \"spellEffect\").map((o) => o.text);\n      }\n\n      return result;\n    }\n\n    return [];\n  }\n\n  /**\n   * Returns a list of already parsed context notes.\n   *\n   * @param {string} context - The context to draw notes from.\n   * @returns {string[]} The resulting notes, already parsed.\n   */\n  getContextNotesParsed(context) {\n    const noteObjects = this.getContextNotes(context);\n\n    return noteObjects.reduce((cur, o) => {\n      for (const note of o.notes) {\n        cur.push(\n          TextEditor.enrichHTML(note, {\n            rollData: o.item != null ? o.item.getRollData() : this.getRollData(),\n            async: false,\n          })\n        );\n      }\n\n      return cur;\n    }, []);\n  }\n\n  formatContextNotes(notes, rollData, { roll = true } = {}) {\n    const result = [];\n    rollData = rollData ?? this.getRollData();\n    for (const noteObj of notes) {\n      rollData.item = {};\n      if (noteObj.item != null) rollData = noteObj.item.getRollData();\n\n      for (const note of noteObj.notes) {\n        result.push(\n          ...note.split(/[\\n\\r]+/).map((o) => TextEditor.enrichHTML(o, { rollData, rolls: roll, async: false }))\n        );\n      }\n    }\n    return result;\n  }\n\n  async createEmbeddedDocuments(embeddedName, createData, options = {}) {\n    createData = createData instanceof Array ? createData : [createData];\n    const rv = await super.createEmbeddedDocuments(embeddedName, createData, options);\n\n    // Create class\n    for (const item of rv) {\n      if (item.type === \"class\") {\n        await item._onLevelChange(0, item.system.level);\n      }\n    }\n\n    return rv;\n  }\n\n  /**\n   * @typedef {object} MobilityPenaltyResult\n   * @property {number|null} maxDexBonus - The maximum dexterity bonus allowed for this result.\n   * @property {number} acp - The armor check penalty of this result.\n   */\n\n  /**\n   * Computes encumbrance values for this actor.\n   *\n   * @returns {MobilityPenaltyResult} The resulting penalties from encumbrance.\n   */\n  _computeEncumbrance() {\n    // Init base data\n    const attributes = this.system.attributes;\n    if (attributes.encumbrance === undefined) attributes.encumbrance = {};\n    const encumbrance = attributes.encumbrance;\n\n    const carry = this.getCarryCapacity();\n    // Set levels\n    encumbrance.levels = carry;\n    encumbrance.levels.carry = carry.heavy * 2;\n    encumbrance.levels.drag = carry.heavy * 5;\n\n    const carriedWeight = Math.max(0, this.getCarriedWeight());\n    encumbrance.carriedWeight = Math.round(carriedWeight * 10) / 10;\n\n    // Determine load level\n    let encLevel = 0;\n    if (carriedWeight > 0) {\n      if (carriedWeight > encumbrance.levels.light) encLevel++;\n      if (carriedWeight > encumbrance.levels.medium) encLevel++;\n    }\n    encumbrance.level = encLevel;\n\n    const result = {\n      maxDexBonus: null,\n      acp: 0,\n    };\n\n    switch (encumbrance.level) {\n      case 1:\n        result.acp = 3;\n        result.maxDexBonus = 3;\n        break;\n      case 2:\n        result.acp = 6;\n        result.maxDexBonus = 1;\n        break;\n    }\n\n    return result;\n  }\n\n  _calculateCoinWeight() {\n    const coinWeightDivisor = game.settings.get(\"ffd20\", \"coinWeight\");\n    if (!coinWeightDivisor) return 0;\n    return (\n      Object.values(this.system.currency).reduce((cur, amount) => {\n        return (parseInt(cur) || 0) + amount;\n      }, 0) / coinWeightDivisor\n    );\n  }\n\n  getCarryCapacity() {\n    // Determine carrying capacity\n    const carryCapacity = this.system.details.carryCapacity;\n    const carryStr = this.system.abilities.str.total + carryCapacity.bonus.total;\n    let carryMultiplier = carryCapacity.multiplier.total;\n    const size = this.system.traits.size;\n    if (this.system.attributes.quadruped) carryMultiplier *= CONFIG.FFD20.encumbranceMultipliers.quadruped[size];\n    else carryMultiplier *= CONFIG.FFD20.encumbranceMultipliers.normal[size];\n    const table = CONFIG.FFD20.encumbranceLoads;\n\n    let heavy = Math.floor(table[carryStr] * carryMultiplier);\n    if (carryStr >= table.length) {\n      const multiplierCount = (carryStr - (table.length - 1)) / 10;\n      heavy = Math.floor(table[table.length - 1] * Math.pow(4, multiplierCount) * carryMultiplier);\n    }\n    // Convert to world unit system\n    heavy = ffd20.utils.convertWeight(heavy);\n\n    return {\n      light: Math.floor(heavy / 3),\n      medium: Math.floor((heavy / 3) * 2),\n      heavy: heavy,\n    };\n  }\n\n  getCarriedWeight() {\n    // Determine carried weight\n    const physicalItems = this.items.filter((o) => {\n      return o.system.weight != null;\n    });\n    const weight = physicalItems.reduce((cur, o) => {\n      if (!o.system.carried) return cur;\n      return cur + o.system.weight.total;\n    }, this._calculateCoinWeight());\n\n    return ffd20.utils.convertWeight(weight);\n  }\n\n  /**\n   * @param root0\n   * @param root0.inLowestDenomination\n   * @returns {number} The total amount of currency this actor has, in gil pieces\n   */\n  mergeCurrency({ inLowestDenomination = false } = {}) {\n    const total =\n      this.getTotalCurrency(\"currency\", { inLowestDenomination }) +\n      this.getTotalCurrency(\"altCurrency\", { inLowestDenomination });\n    return inLowestDenomination ? total : total / 100;\n  }\n\n  getTotalCurrency(category = \"currency\", { inLowestDenomination = false } = {}) {\n    const currencies = this.system[category];\n    const total = currencies.pgil * 1000 + currencies.gil * 100 + currencies.sgil * 10 + currencies.cgil;\n    return inLowestDenomination ? total : total / 100;\n  }\n\n  /**\n   * Converts currencies of the given category to the given currency type\n   *\n   * @param {string} category - Either 'currency' or 'altCurrency'.\n   * @param {string} type - Either 'pgil', 'gil', 'sgil' or 'cgil'. Converts as much currency as possible to this type.\n   */\n  convertCurrency(category = \"currency\", type = \"pgil\") {\n    const totalValue =\n      category === \"currency\" ? this.getTotalCurrency(\"currency\") : this.getTotalCurrency(\"altCurrency\");\n    const values = [0, 0, 0, 0];\n    switch (type) {\n      case \"pgil\":\n        values[0] = Math.floor(totalValue / 10);\n        values[1] = Math.max(0, Math.floor(totalValue) - values[0] * 10);\n        values[2] = Math.max(0, Math.floor(totalValue * 10) - values[0] * 100 - values[1] * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[0] * 1000 - values[1] * 100 - values[2] * 10);\n        break;\n      case \"gil\":\n        values[1] = Math.floor(totalValue);\n        values[2] = Math.max(0, Math.floor(totalValue * 10) - values[1] * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[1] * 100 - values[2] * 10);\n        break;\n      case \"sgil\":\n        values[2] = Math.floor(totalValue * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[2] * 10);\n        break;\n      case \"cgil\":\n        values[3] = Math.floor(totalValue * 100);\n        break;\n    }\n\n    const updateData = {};\n    updateData[`system.${category}.pgil`] = values[0];\n    updateData[`system.${category}.gil`] = values[1];\n    updateData[`system.${category}.sgil`] = values[2];\n    updateData[`system.${category}.cgil`] = values[3];\n    return this.update(updateData);\n  }\n\n  getRollData(options = { refresh: false }) {\n    let result;\n\n    // Return cached data, if applicable\n    const skipRefresh = !options.refresh && this._rollData;\n    if (skipRefresh) {\n      result = this._rollData;\n\n      // Clear certain fields\n      const clearFields = CONFIG.FFD20.temporaryRollDataFields.actor;\n      for (const k of clearFields) {\n        const arr = k.split(\".\");\n        const k2 = arr.slice(0, -1).join(\".\");\n        const k3 = arr.slice(-1)[0];\n        if (k2 === \"\") delete result[k];\n        else {\n          const obj = getProperty(result, k2);\n          if (typeof obj === \"object\") delete obj[k3];\n        }\n      }\n    } else {\n      result = deepClone(this.system);\n    }\n\n    /* ----------------------------- */\n    /* Always add the following data\n    /* ----------------------------- */\n    // Add combat round, if in combat\n    if (game.combats?.viewed) {\n      result.combat = {\n        round: game.combat.round || 0,\n      };\n    }\n\n    // Add denied Dex to AC\n    setProperty(result, \"conditions.loseDexToAC\", this.changeFlags?.loseDexToAC ?? false);\n\n    // Return cached data, if applicable\n    if (skipRefresh) return result;\n\n    /* ----------------------------- */\n    /* Set the following data on a refresh\n    /* ----------------------------- */\n    // Set size index\n    {\n      const sizeChart = Object.keys(CONFIG.FFD20.sizeChart);\n      result.size = sizeChart.indexOf(result.traits.size);\n    }\n\n    // Add more info for formulas\n    result.armor = { type: 0 };\n    result.shield = { type: 0 };\n\n    // Determine equipped armor type\n    {\n      const armorId = this.equipment?.armor?.id;\n      const eqArmor = { total: Number.NEGATIVE_INFINITY, ac: 0, enh: 0 };\n      const armor = armorId ? this.items.get(armorId) : null;\n      if (armor) {\n        result.armor.type = this.equipment.armor.type;\n        const armorData = armor.system;\n        const enhAC = armorData.armor.enh ?? 0,\n          baseAC = armorData.armor.value ?? 0,\n          fullAC = baseAC + enhAC;\n        if (eqArmor.total < fullAC) {\n          eqArmor.ac = baseAC;\n          eqArmor.total = fullAC;\n          eqArmor.enh = enhAC;\n        }\n      }\n      if (!Number.isFinite(eqArmor.total)) eqArmor.total = 0;\n      mergeObject(result.armor, eqArmor);\n    }\n\n    // Determine equipped shield type\n    {\n      const shieldId = this.equipment?.shield?.id;\n      const shield = shieldId ? this.items.get(shieldId) : null;\n      const eqShield = { total: Number.NEGATIVE_INFINITY, ac: 0, enh: 0 };\n      if (shield) {\n        result.shield.type = this.equipment.shield.type;\n        const shieldData = shield.system;\n        const enhAC = shieldData.armor.enh ?? 0,\n          baseAC = shieldData.armor.value ?? 0,\n          fullAC = baseAC + enhAC;\n        if (eqShield.total < fullAC) {\n          eqShield.ac = baseAC;\n          eqShield.total = fullAC;\n          eqShield.enh = enhAC;\n        }\n      }\n      mergeObject(result.shield, eqShield);\n    }\n\n    // Add spellbook info\n    result.spells = result.attributes.spells.spellbooks;\n    for (const [k, book] of Object.entries(result.spells)) {\n      book.abilityMod = result.abilities[book.ability]?.mod ?? 0;\n      // Add alias\n      if (book.class && book.class !== \"_hd\") result.spells[book.class] ??= book;\n    }\n\n    // Add item dictionary flags\n    if (this.itemFlags) result.dFlags = this.itemFlags.dictionary;\n\n    // Add range info\n    result.range = this.constructor.getReach(this.system.traits.size, this.system.traits.stature);\n\n    // Add class info\n    if (this.items) {\n      result.classes = this.items\n        .filter((o) => o.type === \"class\")\n        .reduce((cur, o) => {\n          cur[o.system.tag] = {\n            level: o.system.level,\n            name: o.name,\n          };\n\n          return cur;\n        }, {});\n    }\n\n    this._rollData = result;\n\n    // Call hook\n    if (Hooks.events[\"ffd20GetRollData\"]?.length > 0) Hooks.callAll(\"ffd20GetRollData\", this, result);\n    callOldNamespaceHookAll(\"ffd20.getRollData\", \"ffd20GetRollData\", this, result, true);\n\n    return result;\n  }\n\n  static getReach(size = \"med\", stature = \"tall\") {\n    const result = {\n      melee: 5,\n      reach: 10,\n    };\n\n    switch (size) {\n      case \"fine\":\n      case \"dim\":\n        result.melee = 0;\n        result.reach = 0;\n        break;\n      case \"tiny\":\n        result.melee = 0;\n        result.reach = 5;\n        break;\n      case \"lg\":\n        if (stature === \"tall\") {\n          result.melee = 10;\n          result.reach = 20;\n        }\n        break;\n      case \"huge\":\n        if (stature === \"tall\") {\n          result.melee = 15;\n          result.reach = 30;\n        } else {\n          result.melee = 10;\n          result.reach = 20;\n        }\n        break;\n      case \"grg\":\n        if (stature === \"tall\") {\n          result.melee = 20;\n          result.reach = 40;\n        } else {\n          result.melee = 15;\n          result.reach = 30;\n        }\n        break;\n      case \"col\":\n        if (stature === \"tall\") {\n          result.melee = 30;\n          result.reach = 60;\n        } else {\n          result.melee = 20;\n          result.reach = 40;\n        }\n        break;\n    }\n\n    return result;\n  }\n\n  async deleteEmbeddedDocuments(embeddedName, data, options = {}) {\n    if (embeddedName === \"Item\") {\n      if (!(data instanceof Array)) data = [data];\n\n      // Add children to list of items to be deleted\n      const _addChildren = async function (id) {\n        const item = this.items.get(id);\n        const children = await item.getLinkedItems(\"children\");\n        for (const child of children) {\n          if (!data.includes(child.id)) {\n            data.push(child.id);\n            await _addChildren.call(this, child.id);\n          }\n        }\n      };\n      for (const id of data) {\n        await _addChildren.call(this, id);\n      }\n\n      // Remove links to this item (and child items)\n      for (const id of data) {\n        for (const i of this.items) {\n          await i.removeItemLink(id);\n        }\n      }\n    }\n\n    await super.deleteEmbeddedDocuments(embeddedName, data, options);\n  }\n\n  getQuickActions() {\n    return this.items\n      .filter(\n        (o) =>\n          o.isActive &&\n          o.system.showInQuickbar === true &&\n          [\"weapon\", \"equipment\", \"consumable\", \"attack\", \"spell\", \"feat\"].includes(o.type) &&\n          !o.showUnidentifiedData\n      )\n      .sort((a, b) => a.sort - b.sort)\n      .map((o) => {\n        return {\n          item: o,\n          isSingleUse: o.isSingleUse,\n          get haveAnyCharges() {\n            return this.item.isCharged;\n          },\n          maxCharge: o.maxCharges,\n          get charges() {\n            return this.item.charges;\n          },\n          color1: ItemFFD20.getTypeColor(o.type, 0),\n          color2: ItemFFD20.getTypeColor(o.type, 1),\n        };\n      });\n  }\n\n  /**\n   * @param {DocumentModificationContext} context\n   */\n  async toggleConditionStatusIcons(context = {}) {\n    if (this._states.togglingStatusIcons) return;\n    this._states.togglingStatusIcons = true;\n\n    if (!this.testUserPermission(game.user, \"OWNER\")) return;\n\n    const buffTextures = this._calcBuffActiveEffects();\n    const fx = [...this.effects];\n\n    // Create and delete buff ActiveEffects\n    const toCreate = [];\n    const toDelete = [];\n    const toUpdate = [];\n    for (const [id, obj] of Object.entries(buffTextures)) {\n      const existing = fx.find((f) => {\n        return f.origin === id || f.flags.ffd20?.origin?.item === obj.id;\n      });\n      if (!existing) {\n        if (obj.active) toCreate.push(obj.item.getRawEffectData());\n      } else {\n        if (!obj.active) toDelete.push(existing.id);\n        else {\n          const existingData = existing.toObject();\n          const mergedData = foundry.utils.mergeObject(existingData, obj.item.getRawEffectData(), { inplace: false });\n          const hideIcon = obj.item.system.hideFromToken || game.settings.get(\"ffd20\", \"hideTokenConditions\");\n          if (hideIcon) mergedData.icon = null;\n          const diffData = foundry.utils.diffObject(existingData, mergedData);\n          if (!foundry.utils.isEmpty(diffData)) {\n            diffData._id = existing.id;\n            toUpdate.push(diffData);\n          }\n        }\n      }\n    }\n\n    // Create and delete condition ActiveEffects\n    for (const condKey of Object.keys(CONFIG.FFD20.conditions)) {\n      const idx = fx.findIndex((e) => e.getFlag(\"core\", \"statusId\") === condKey);\n      const hasCondition = this.system.attributes.conditions[condKey] === true;\n      const hasEffectIcon = idx >= 0;\n\n      if (hasCondition && !hasEffectIcon) {\n        toCreate.push({\n          \"flags.core.statusId\": condKey,\n          name: CONFIG.FFD20.conditions[condKey],\n          icon: CONFIG.FFD20.conditionTextures[condKey],\n          label: CONFIG.FFD20.conditions[condKey],\n        });\n      } else if (!hasCondition && hasEffectIcon) {\n        const removeEffects = fx.filter((e) => e.getFlag(\"core\", \"statusId\") === condKey);\n        toDelete.push(...removeEffects.map((e) => e.id));\n      }\n    }\n\n    // Create sub-contexts and disable render if more updates are done\n    const deleteContext = deepClone(context);\n    if (context.render !== false) deleteContext.render = !toCreate.length && !toUpdate.length;\n    const createContext = deepClone(context);\n    if (context.render !== false) createContext.render = !toUpdate.length;\n\n    if (toDelete.length) await this.deleteEmbeddedDocuments(\"ActiveEffect\", toDelete, deleteContext);\n    if (toCreate.length) await this.createEmbeddedDocuments(\"ActiveEffect\", toCreate, createContext);\n    if (toUpdate.length) await this.updateEmbeddedDocuments(\"ActiveEffect\", toUpdate, context);\n    this._states.togglingStatusIcons = false;\n\n    // Special case for unlinked tokens, which don't seem to draw their effects on an actor update\n    const tokens = this.getActiveTokens();\n    for (const token of tokens) {\n      const linked = token.document.actorLink;\n      if (!linked) {\n        token.drawEffects();\n      }\n    }\n  }\n\n  // @Object { id: { title: String, type: buff/string, img: imgPath, active: true/false }, ... }\n  _calcBuffActiveEffects() {\n    const buffs = this.items.filter((o) => o.type === \"buff\");\n    return buffs.reduce((acc, cur) => {\n      const id = cur.uuid;\n      if (!acc[id]) acc[id] = { id: cur.id, label: cur.name, icon: cur.img, item: cur };\n      if (cur.system.active) acc[id].active = true;\n      else acc[id].active = false;\n      return acc;\n    }, {});\n  }\n\n  refreshAbilityModifiers() {\n    for (const k of Object.keys(this.system.abilities)) {\n      const total = this.system.abilities[k].total;\n      const penalty = Math.abs(this.system.abilities[k].penalty || 0);\n      const damage = this.system.abilities[k].damage;\n      const newMod = getAbilityModifier(total, { penalty, damage });\n      this.system.abilities[k].mod = newMod;\n\n      // Store previous ability score\n      if (!ffd20.migrations.isMigrating && this._initialized && this._prevAbilityScores) {\n        const prevMod = this._prevAbilityScores?.[k].mod ?? 0;\n        const diffMod = newMod - prevMod;\n        const result = this.system.abilities[k].mod + diffMod;\n\n        this._prevAbilityScores[k] = {\n          total,\n          mod: result,\n        };\n      }\n    }\n  }\n\n  async importFromJSON(json) {\n    // Set _initialized flag to prevent faults (such as HP changing incorrectly)\n    this._initialized = false;\n\n    // Import from JSON\n    const data = JSON.parse(json);\n    delete data._id;\n    data.effects = [];\n\n    // Update data\n    return this.update(data, { diff: false, recursive: false });\n  }\n\n  /**\n   * @typdef MaxAndValue\n   * @type {object}\n   * @property {number} max - The maximum value.\n   * @property {number} value - The current value.\n   * @returns {MaxAndValue} An object with a property `value` which refers to the current used feats, and `max` which refers to the maximum available feats.\n   */\n  getFeatCount() {\n    const result = { max: 0, value: 0 };\n    result.value = this.items.filter((o) => {\n      return o.type === \"feat\" && o.system.featType === \"feat\" && !o.system.disabled;\n    }).length;\n\n    // Add feat count by level\n    const totalLevels = this.items\n      .filter((o) => o.type === \"class\" && [\"base\", \"npc\", \"prestige\", \"racial\"].includes(o.system.classType))\n      .reduce((cur, o) => {\n        return cur + o.hitDice;\n      }, 0);\n    result.max += Math.ceil(totalLevels / 2);\n\n    // Bonus feat formula\n    const featCountRoll = RollFFD20.safeRoll(this.system.details.bonusFeatFormula || \"0\", this.getRollData());\n    result.max += featCountRoll.total;\n    if (featCountRoll.err) {\n      const msg = game.i18n\n        .localize(\"FFD20.ErrorActorFormula\")\n        .format(game.i18n.localize(\"FFD20.BonusFeatFormula\"), this.actor.name);\n      console.error(msg);\n      ui.notifications.error(msg);\n    }\n\n    // Changes\n    this.changes\n      .filter((o) => o.subTarget === \"bonusFeats\")\n      .forEach((o) => {\n        if (!o.value) return;\n\n        result.max += o.value;\n      });\n\n    return result;\n  }\n\n  /**\n   * @param {string} flagName - The name/key of the flag to search for.\n   * @returns {boolean} Whether this actor has any owned item with the given flag.\n   */\n  hasItemBooleanFlag(flagName) {\n    return this.itemFlags.boolean[flagName] != null;\n  }\n\n  /**\n   * Perform all changes related to an actor resting, including restoring HP, ability scores, item uses, etc.\n   *\n   * @see {@link hookEvents!ffd20PreActorRest ffd20PreActorRest hook}\n   * @see {@link hookEvents!ffd20ActorRest ffd20ActorRest hook}\n   * @param {Partial<ActorRestOptions>} options - Options affecting an actor's resting\n   * @returns {Promise<ActorRestData | void>} Updates applied to the actor, if resting was completed\n   */\n  async performRest(options = {}) {\n    const {\n      restoreHealth = true,\n      longTermCare = false,\n      aidedCare = false,\n      restoreDailyUses = true,\n      hours = 8,\n    } = options;\n    const actorData = this.system;\n\n    const updateData = {};\n    // Restore health and ability damage\n    if (restoreHealth === true) {\n      const hd = actorData.attributes.hd.total;\n      const mprev = actorData.attributes.mp.recover;\n      const heal = {\n        hp: hd,\n        mp: mprev, // change this to reflect total caster level and casting mods\n        abl: 1,\n        nonlethal: hours * hd,\n      };\n      if (longTermCare === true && aidedCare === false) {\n        heal.hp *= 2;\n        heal.mp *= 2;\n        heal.abl *= 2;\n      }\n      if (longTermCare === false && aidedCare === true) {\n        heal.hp *= 2;\n        heal.mp *= 2;\n        heal.abl *= 2;\n      }\n      if (longTermCare === true && aidedCare === true) {\n        heal.hp *= 5;\n        heal.mp *= 5;\n        heal.abl *= 5;\n      }\n      updateData[\"system.attributes.hp.value\"] = Math.min(\n        actorData.attributes.hp.value + heal.hp,\n        actorData.attributes.hp.max\n      );\n      updateData[\"system.attributes.mp.value\"] = Math.min(\n        actorData.attributes.mp.value + heal.mp,\n        actorData.attributes.mp.max\n      );\n      updateData[\"system.attributes.hp.nonlethal\"] = Math.max(\n        0,\n        (actorData.attributes.hp.nonlethal || 0) - heal.nonlethal\n      );\n      for (const [key, abl] of Object.entries(actorData.abilities)) {\n        const dmg = Math.abs(abl.damage);\n        updateData[`system.abilities.${key}.damage`] = Math.max(0, dmg - heal.abl);\n      }\n    }\n\n    const itemUpdates = [];\n    // Restore daily uses of spells, feats, etc.\n    if (restoreDailyUses === true) {\n      // Update spellbooks\n      for (const [sbKey, sb] of Object.entries(getProperty(actorData, `attributes.spells.spellbooks`) || {})) {\n        for (let a = 0; a < 10; a++) {\n          updateData[`system.attributes.spells.spellbooks.${sbKey}.spells.spell${a}.value`] =\n            getProperty(sb, `spells.spell${a}.max`) || 0;\n        }\n      }\n\n      // refresh limitbreak uses\n      updateData[\"system.attributes.limitbreak.value\"] = actorData.attributes.limitbreak.max;\n\n      // Update charged items\n      for (const item of this.items) {\n        const itemUpdate = {};\n        const itemData = item.system;\n\n        if (itemData.uses && itemData.uses.per === \"day\" && itemData.uses.value !== itemData.uses.max) {\n          itemUpdate[\"system.uses.value\"] = itemData.uses.max;\n        } else if (item.type === \"spell\") {\n          const spellbook = getProperty(actorData, `attributes.spells.spellbooks.${itemData.spellbook}`),\n            isSpontaneous = spellbook.spontaneous;\n          if (!isSpontaneous) {\n            if (itemData.preparation.preparedAmount < itemData.preparation.maxAmount) {\n              itemUpdate[\"system.preparation.preparedAmount\"] = itemData.preparation.maxAmount;\n              itemUpdates.push(itemUpdate);\n            }\n            if (!item.system.domain) {\n              let sbUses =\n                updateData[\n                  `system.attributes.spells.spellbooks.${itemData.spellbook}.spells.spell${itemData.level}.value`\n                ] || 0;\n              sbUses -= itemData.preparation.maxAmount;\n              updateData[\n                `system.attributes.spells.spellbooks.${itemData.spellbook}.spells.spell${itemData.level}.value`\n              ] = sbUses;\n            }\n          }\n        }\n\n        // Update charged actions\n        if (item.system.actions?.length > 0) {\n          const actions = deepClone(item.system.actions);\n          let _changed = false;\n          for (const actionData of actions) {\n            if (actionData.uses.self?.per === \"day\") {\n              const maxUses = actionData.uses.self.max || 0;\n              if (actionData.uses.self.value < maxUses) {\n                actionData.uses.self.value = maxUses;\n                _changed = true;\n              }\n            }\n          }\n\n          if (_changed) {\n            itemUpdate[\"system.actions\"] = actions;\n          }\n        }\n\n        // Append update to queue\n        if (!foundry.utils.isEmpty(itemUpdate)) {\n          itemUpdate._id = item.id;\n          itemUpdates.push(itemUpdate);\n        }\n      }\n\n      for (const [key, spellbook] of Object.entries(actorData.attributes.spells.spellbooks)) {\n        // Restore spellbooks using spell points\n        if (spellbook.spellPoints.useSystem) {\n          // Try to roll restoreFormula, fall back to restoring max spell points\n          let restorePoints = spellbook.spellPoints.max;\n          if (spellbook.spellPoints.restoreFormula) {\n            const restoreRoll = RollFFD20.safeRoll(spellbook.spellPoints.restoreFormula, this.getRollData());\n            if (restoreRoll.err) console.error(restoreRoll.err, spellbook.spellPoints.restoreFormula);\n            else restorePoints = Math.min(spellbook.spellPoints.value + restoreRoll.total, spellbook.spellPoints.max);\n          }\n          updateData[`system.attributes.spells.spellbooks.${key}.spellPoints.value`] = restorePoints;\n        }\n      }\n    }\n\n    options = { restoreHealth, restoreDailyUses, longTermCare, aidedCare, hours };\n    let allowed = Hooks.call(\"ffd20PreActorRest\", this, options, updateData, itemUpdates);\n    allowed = callOldNamespaceHook(\"actorRest\", \"ffd20ActorRest\", allowed, this, options, updateData, itemUpdates);\n    if (allowed === false) return;\n\n    await this.updateEmbeddedDocuments(\"Item\", itemUpdates);\n    await this.update(updateData);\n\n    Hooks.callAll(\"ffd20ActorRest\", this, options, updateData, itemUpdates);\n    return { options, updateData, itemUpdates };\n  }\n\n  /**\n   * @override\n   */\n  async modifyTokenAttribute(attribute, value, isDelta = false, isBar = true) {\n    let doc = this;\n    const current = getProperty(this.system, attribute),\n      updates = {};\n    if (attribute.startsWith(\"resources.\")) {\n      const itemTag = attribute.split(\".\").slice(-1)[0];\n      doc = this.items.find((item) => item.system.tag === itemTag);\n    }\n    if (!doc) return;\n    const updateData = {};\n\n    // Special keys\n    if (attribute === \"attributes.hp\") {\n      if (!isDelta) value = (current.temp + current.value - value) * -1;\n      let dt = value;\n      if (current.temp > 0 && value < 0) {\n        dt = Math.min(0, current.temp + value);\n        updates[\"system.attributes.hp.temp\"] = Math.max(0, current.temp + value);\n      }\n      updates[\"system.attributes.hp.value\"] = Math.min(current.value + dt, current.max);\n    } else if (attribute === \"attributes.vigor\") {\n      if (!isDelta) value = (current.temp + current.value - value) * -1;\n      let dt = value;\n      if (current.temp > 0 && value < 0) {\n        dt = Math.min(0, current.temp + value);\n        updates[\"system.attributes.vigor.temp\"] = Math.max(0, current.temp + value);\n      }\n      updates[\"system.attributes.vigor.value\"] = Math.min(current.value + dt, current.max);\n    }\n    // Absolute\n    else if (!isDelta) {\n      if (doc instanceof Actor) {\n        if (isBar) updates[`system.${attribute}.value`] = value;\n        else updates[`system.${attribute}`] = value;\n      } else {\n        updates[\"system.uses.value\"] = value;\n      }\n      // Relative\n    } else {\n      if (doc instanceof Actor) {\n        if (isBar)\n          updates[`system.${attribute}.value`] = Math.clamped(current.min || 0, current.value + value, current.max);\n        else updates[`system.${attribute}`] = current + value;\n      } else {\n        updates[\"system.uses.value\"] = current.value + value;\n      }\n    }\n\n    const allowed = Hooks.call(\"modifyTokenAttribute\", { attribute, value, isDelta, isBar }, updates);\n    return allowed !== false ? doc.update(updates) : this;\n  }\n\n  getItemByTag(tag) {\n    return this.items.find((o) => o.system.tag === tag);\n  }\n}\n\n/**\n * @typedef {object} ActorRestOptions\n * Options given to {@link ActorFFD20.performRest} affecting an actor's resting.\n * @property {boolean} restoreHealth - Whether the actor's health should be restored. Defaults to `true`.\n * @property {boolean} restoreDailyUses - Whether daily uses of spells and abilities should be restored. Defaults to `true`.\n * @property {boolean} longTermCare - Whether additional hit and ability score points should be restored through the Heal skill. Defaults to `false`.\n * @property {number} hours - The number of hours the actor will rest. Defaults to `8`.\n */\n\n/**\n * @typedef {object} ActorRestData\n * @property {ActorRestOptions} options - Options for resting\n * @property {object} updateData - Updates applied to the actor\n * @property {object[]} itemUpdates - Updates applied to the actor's items\n */\n","import { ActorFFD20 } from \"./actor-ffd20.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\n\nexport class ActorCharacterFFD20 extends ActorFFD20 {\n  /**\n   * @param {object} data Creation data\n   * @param {User} user User instance\n   */\n  _preCreate(data, user) {\n    super._preCreate(data, user);\n\n    const tokenUpdateData = {};\n    // Link token data by default\n    if (data.prototypeToken?.actorLink === undefined) {\n      tokenUpdateData[\"actorLink\"] = true;\n    }\n\n    // Enable vision by default\n    if (game.settings.get(\"ffd20\", \"characterVision\")) {\n      setProperty(data, \"prototypeToken.sight.enabled\", true);\n    }\n\n    if (!foundry.utils.isEmpty(tokenUpdateData)) this.prototypeToken.updateSource(tokenUpdateData);\n  }\n\n  prepareBaseData() {\n    super.prepareBaseData();\n\n    const actorData = this.system;\n\n    const maxExp = this.getLevelExp(actorData.details.level.value);\n    actorData.details.xp.max = maxExp;\n\n    if (!hasProperty(this, \"system.details.level.value\")) return;\n\n    // Experience bar\n    const prior = this.getLevelExp(actorData.details.level.value - 1 || 0),\n      max = this.getLevelExp(actorData.details.level.value || 1);\n\n    actorData.details.xp.pct =\n      ((Math.max(prior, Math.min(max, actorData.details.xp.value)) - prior) / (max - prior)) * 100 || 0;\n  }\n\n  _updateExp(updateData) {\n    const xpData = updateData.details?.xp;\n    if (xpData?.value == undefined) return;\n\n    // Get total level\n    const classes = this.items.filter((o) => o.type === \"class\");\n    const level = classes.filter((o) => o.system.classType !== \"mythic\").reduce((cur, o) => cur + o.system.level, 0);\n\n    const oldData = this.system;\n\n    // Translate update exp value to number\n    let newExp = xpData.value,\n      resetExp = false;\n    if (typeof newExp === \"string\") {\n      const curExp = Number(oldData.details.xp.value);\n      if (newExp.match(/^\\+([0-9]+)$/)) {\n        newExp = curExp + parseInt(RegExp.$1);\n      } else if (newExp.match(/^-([0-9]+)$/)) {\n        newExp = curExp - parseInt(RegExp.$1);\n      } else if (newExp === \"\") {\n        resetExp = true;\n      } else if (newExp.match(/^([0-9]+)$/)) {\n        newExp = parseInt(newExp);\n      } else {\n        newExp = curExp;\n      }\n\n      xpData.value = newExp;\n    }\n    const maxExp = this.getLevelExp(level);\n    xpData.max = maxExp;\n\n    if (resetExp) {\n      const minExp = level > 0 ? this.getLevelExp(level - 1) : 0;\n      xpData.value = minExp;\n    }\n  }\n\n  /**\n   * Return the amount of experience required to gain a certain character level.\n   *\n   * @param level {number}  The desired level\n   * @returns {number}       The XP required\n   */\n  getLevelExp(level) {\n    const expConfig = game.settings.get(\"ffd20\", \"experienceConfig\");\n    const expTrack = expConfig.track;\n    // Preset experience tracks\n    if ([\"fast\", \"medium\", \"slow\"].includes(expTrack)) {\n      const levels = CONFIG.FFD20.CHARACTER_EXP_LEVELS[expTrack];\n      return levels[Math.min(level, levels.length - 1)];\n    }\n    // Custom formula experience track\n    let totalXP = 0;\n    if (expConfig.custom.formula.length > 0) {\n      for (let a = 0; a < level; a++) {\n        const rollData = this.getRollData();\n        rollData.level = a + 1;\n        const roll = RollFFD20.safeRoll(expConfig.custom.formula, rollData);\n        totalXP += roll.total;\n      }\n    }\n    return Math.max(1, totalXP);\n  }\n}\n","import { ActorFFD20 } from \"./actor-ffd20.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\n\nexport class ActorNPCFFD20 extends ActorFFD20 {\n  prepareBaseData() {\n    super.prepareBaseData();\n    this.system.details.cr.total = this.getCR(this.system);\n\n    // Add base initiative (for NPC Lite sheets)\n    this.system.attributes.init.total = this.system.attributes.init.value;\n  }\n\n  prepareSpecificDerivedData() {\n    super.prepareSpecificDerivedData();\n\n    // Reset CR\n    setProperty(this.system, \"details.cr.total\", this.getCR());\n\n    // Reset experience value\n    try {\n      const crTotal = getProperty(this.system, \"details.cr.total\") || 0;\n      setProperty(this.system, \"details.xp.value\", this.getCRExp(crTotal));\n    } catch (e) {\n      setProperty(this.system, \"details.xp.value\", this.getCRExp(1));\n    }\n  }\n\n  hasArmorProficiency(item, proficiencyName) {\n    // Assume NPCs to be proficient with their armor\n    return game.settings.get(\"ffd20\", \"npcProficiencies\") ? super.hasArmorProficiency(item, proficiencyName) : true;\n  }\n\n  /* Not used by NPCs */\n  _updateExp() {}\n\n  getCR() {\n    if (this.type !== \"npc\") return 0;\n    const data = this.system;\n\n    const base = data.details.cr.base;\n    if (this.items == null) return base;\n\n    // Gather CR from templates\n    const templates = this.items.filter(\n      (o) => o.type === \"feat\" && o.system.featType === \"template\" && !o.system.disabled\n    );\n    return templates.reduce((cur, o) => {\n      const crOffset = o.data.crOffset;\n      if (typeof crOffset === \"string\" && crOffset.length)\n        cur += RollFFD20.safeRoll(crOffset, this.getRollData(data)).total;\n      return cur;\n    }, base);\n  }\n\n  /**\n   * Return the amount of experience granted by killing a creature of a certain CR.\n   *\n   * @param cr {null | number}     The creature's challenge rating\n   * @returns {number}       The amount of experience granted per kill\n   */\n  getCRExp(cr) {\n    if (cr < 1.0) return Math.max(400 * cr, 0);\n    return CONFIG.FFD20.CR_EXP_LEVELS[cr];\n  }\n}\n","import { ActorBaseFFD20 } from \"./actor-base.mjs\";\n\n/**\n * Basic actor with no built-in functionality.\n */\nexport class BasicActorFFD20 extends ActorBaseFFD20 {}\n","/**\n * A specialized form used to select damage or condition types which apply to an Actor\n *\n * @type {DocumentSheet}\n */\nexport class ActorTraitSelector extends DocumentSheet {\n  constructor(doc, options) {\n    super(doc, options);\n    // Enrich dialog identity\n    this.options.classes.push(options.subject);\n  }\n\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    options.classes = [\"ffd20\", \"trait-selector\"];\n    options.title = \"Actor Trait Selection\";\n    options.template = \"systems/ffd20/templates/apps/trait-selector.hbs\";\n    options.width = 320;\n    options.height = \"auto\";\n    return options;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Return a reference to the target attribute\n   *\n   * @type {string}\n   */\n  get attribute() {\n    return this.options.name;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Provide data to the HTML template for rendering\n   *\n   * @type {object}\n   */\n  getData() {\n    // Get current values\n    const attr = getProperty(this.object, this.attribute) ?? { value: [], custom: \"\" };\n\n    // Populate choices\n    const choices = duplicate(this.options.choices);\n    for (const [k, v] of Object.entries(choices)) {\n      choices[k] = {\n        label: v,\n        chosen: attr.value?.includes(k),\n      };\n    }\n\n    // Object type\n    const updateButton = this.object instanceof Actor ? \"FFD20.UpdateActor\" : \"FFD20.UpdateItem\";\n\n    // Return data\n    return {\n      choices: choices,\n      custom: attr.custom,\n      updateButton,\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update the Actor object with new trait data processed from the form\n   *\n   * @param event\n   * @param formData\n   * @private\n   */\n  _updateObject(event, formData) {\n    const choices = [];\n    for (const [k, v] of Object.entries(formData)) {\n      if (k !== \"custom\" && v) choices.push(k);\n    }\n    this.object.update({\n      [`${this.attribute}.value`]: choices,\n      [`${this.attribute}.custom`]: formData.custom,\n    });\n  }\n}\n","export class ActorRestDialog extends DocumentSheet {\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    return mergeObject(options, {\n      classes: [\"ffd20\", \"actor-rest\"],\n      template: \"systems/ffd20/templates/apps/actor-rest.hbs\",\n      width: 500,\n      closeOnSubmit: true,\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Configure the title of the special traits selection window to include the Actor name\n   *\n   * @type {string}\n   */\n  get title() {\n    return `${game.i18n.localize(\"FFD20.Rest\")}: ${this.object.name}`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update the Actor using the configured options\n   * Remove/unset any flags which are no longer configured\n   *\n   * @param event\n   * @param formData\n   */\n  async _updateObject(event, formData) {\n    this.object.performRest({\n      /**\n       * add rest options\n       * Natural healing(8 hours rest, once per 24 hours): Restore HP equal to level plus con  and MP equal to caster level plus primary casting stat. Complete rest(24 hours of rest, no combat or hard training): Double natural healing Aided Healing(8 hours with someone trained in heal 5 ranks or more looking after you): double natural healing Aided Complete Rest(24 hours with someone trained in heal 5 ranks or more looking after you): 5x natural healing There are items that boost natural healing that can be found.\n       */\n      restoreHealth: formData[\"restoreHealth\"],\n      longTermCare: formData[\"longTermCare\"],\n      aidedcare: formData[\"aidedCare\"],\n      restoreDailyUses: formData[\"restoreDailyUses\"],\n      hours: formData[\"hours\"],\n    });\n  }\n}\n","export class PointBuyCalculator extends DocumentSheet {\n  constructor(...args) {\n    super(...args);\n\n    const actorAbl = this.actor.system.abilities;\n\n    this.abilities = [];\n    for (const [k, name] of Object.entries(CONFIG.FFD20.abilities)) {\n      this.abilities.push({\n        key: k,\n        name: name,\n        value: actorAbl[k]?.value ?? 10,\n      });\n    }\n\n    const ablValues = Object.keys(CONFIG.FFD20.abilityCost).map((i) => Number(i));\n    this.min = Math.min(...ablValues);\n    this.max = Math.max(...ablValues);\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"pointbuy-calculator\"],\n      title: \"Point Buy Calculator\",\n      template: \"systems/ffd20/templates/apps/point-buy-calculator.hbs\",\n      width: 320,\n      height: \"auto\",\n      closeOnSubmit: false,\n      submitOnClose: false,\n    });\n  }\n\n  get title() {\n    return `${this.options.title}: ${this.object.name}`;\n  }\n\n  get actor() {\n    return this.document;\n  }\n\n  getData() {\n    const points = this.getSpentPoints();\n\n    return {\n      abilities: this.abilities,\n      points: points,\n    };\n  }\n\n  getSpentPoints() {\n    let result = 0;\n\n    for (const a of this.abilities) {\n      result += CONFIG.FFD20.abilityCost[a.value];\n    }\n    return result;\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.find(\".ability-control\").click(this._onAbilityControl.bind(this));\n  }\n\n  _onAbilityControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const ablKey = a.closest(\".item\").dataset.ability;\n    const abl = this.abilities.find((o) => o.key === ablKey);\n\n    if (a.classList.contains(\"add\")) {\n      abl.value = Math.min(this.max, abl.value + 1);\n    } else if (a.classList.contains(\"subtract\")) {\n      abl.value = Math.max(this.min, abl.value - 1);\n    }\n    this.render();\n  }\n\n  _updateObject() {\n    const updateData = {};\n    for (const a of this.abilities) {\n      updateData[`system.abilities.${a.key}.value`] = a.value;\n    }\n    this.actor.update(updateData);\n\n    this.close();\n  }\n}\n","export class Widget_ItemPicker {\r\n  constructor(callback, { items, columns = 3 } = {}) {\r\n    /**\r\n     * @property\r\n     * The HTML element that represents this widget.\r\n     */\r\n    this.element = null;\r\n\r\n    /**\r\n     * @property\r\n     * The callback to fire if an item is clicked.\r\n     */\r\n    this.callback = callback;\r\n\r\n    /**\r\n     * @typedef Widget_ItemPicker_Item\r\n     * @type {object}\r\n     * @property {string} value\r\n     * @property {string} label\r\n     */\r\n    /**\r\n     * @property\r\n     * @type Widget_ItemPicker_Item[]\r\n     * The items in this widget.\r\n     */\r\n    this._items = items;\r\n\r\n    /**\r\n     * @property\r\n     * @type {number}\r\n     * The maximum amount of columns shown.\r\n     */\r\n    this.columns = columns;\r\n  }\r\n\r\n  render(parentElem) {\r\n    // Generate widget\r\n    const rootElem = $($.parseHTML('<div class=\"widget item-picker\"></div>'));\r\n    // Add rows\r\n    let rowElem;\r\n    for (let a = 0; a < this._items.length; a++) {\r\n      const item = this._items[a];\r\n      if (a % this.columns === 0) {\r\n        rowElem = $($.parseHTML('<div class=\"row\"></div>'));\r\n        rootElem.append(rowElem);\r\n      }\r\n\r\n      const itemElem = $($.parseHTML(`<div class=\"item\" value=\"${item.value}\">${item.label}</div>`));\r\n      const widthRate = Math.floor(10000 / this.columns) / 100;\r\n      itemElem.css(\"flex\", `0 0 calc(${widthRate}% - 4px)`);\r\n      rowElem.append(itemElem);\r\n    }\r\n\r\n    // Replace parent element\r\n    if (!(parentElem instanceof jQuery)) parentElem = $(parentElem);\r\n    rootElem.css(\"position\", \"absolute\");\r\n    rootElem.css(\"left\", `${parentElem[0].offsetLeft}px`);\r\n    rootElem.css(\"position\", `${parentElem[0].offsetBottom}px`);\r\n    parentElem.parent().append(rootElem);\r\n\r\n    this.element = rootElem;\r\n\r\n    window.setTimeout(() => {\r\n      this.activateListeners(rootElem);\r\n    }, 10);\r\n  }\r\n\r\n  activateListeners(html) {\r\n    // Click item callback\r\n    html.find(\".item\").click(this._onClickItem.bind(this));\r\n\r\n    // Cancel widget\r\n    this._cancelCallback = this._onCancel.bind(this);\r\n    document.addEventListener(\"click\", this._cancelCallback);\r\n  }\r\n\r\n  _onCancel(event) {\r\n    event.preventDefault();\r\n\r\n    // Don't cancel if this widget was clicked\r\n    const target = event.target;\r\n    let node = target;\r\n    if (node === this.element[0]) return;\r\n    while (node.parentNode) {\r\n      if (node === this.element[0]) return;\r\n      node = node.parentNode;\r\n    }\r\n\r\n    this.cancel();\r\n  }\r\n\r\n  _onClickItem(event) {\r\n    event.preventDefault();\r\n    const a = event.currentTarget;\r\n\r\n    this.callback($(a).attr(\"value\"));\r\n  }\r\n\r\n  cancel() {\r\n    document.removeEventListener(\"click\", this._cancelCallback);\r\n    this.element.remove();\r\n  }\r\n}\r\n","import { isGMActive } from \"./lib.mjs\";\n\n/**\n * @param root0\n * @param root0.title\n * @param root0.initial\n * @param root0.min\n * @param root0.max\n */\nexport function dialogGetNumber({\n  title = \"Input Number\",\n  initial = null,\n  min = Number.NEGATIVE_INFINITY,\n  max = Number.POSITIVE_INFINITY,\n} = {}) {\n  return new Promise((resolve) => {\n    let cancelled = true;\n\n    new Dialog(\n      {\n        title: title,\n        content: `<input type=\"number\" name=\"result\" min=\"${min}\" max=\"${max}\" value=\"${initial || 0}\">`,\n        buttons: {\n          ok: {\n            label: \"Submit\",\n            callback: (html) => {\n              cancelled = false;\n              const input = html.find('input[name=\"result\"]');\n              resolve(input.val());\n            },\n          },\n        },\n        close: () => {\n          if (!cancelled) {\n            resolve(initial);\n          }\n        },\n        default: \"ok\",\n        render: (htm) => {\n          htm.find(\"input\").select();\n        },\n      },\n      {\n        classes: [\"dialog\", \"ffd20\", \"get-number\"],\n      }\n    ).render(true);\n  });\n}\n\nexport const dialogGetActor = function (title = \"\", actors = []) {\n  return new Promise((resolve) => {\n    const cancelled = true;\n\n    let content = \"\";\n    actors.forEach((target) => {\n      if (target instanceof Actor) {\n        const gmActive = isGMActive();\n        const enabled = gmActive || target.testUserPermission(game.user, \"OWNER\");\n        const disabledClass = enabled ? \"\" : \"disabled\";\n        content += `<div class=\"dialog-get-actor flexrow ${disabledClass}\" data-actor-id=\"${target.id}\"><img src=\"${target.data.img}\"><h2>${target.name}</h2></div>`;\n      } else if (target instanceof Item) {\n        content += `<div class=\"dialog-get-actor flexrow\" data-item-id=\"${target.id}\"><img src=\"${target.data.img}\"><h2>${target.name}</h2></div>`;\n      }\n    });\n\n    const dialog = new Dialog(\n      {\n        title: title,\n        content: content,\n        buttons: {},\n        close: () => {\n          if (cancelled) {\n            resolve(null);\n          }\n        },\n      },\n      {\n        classes: [\"dialog\", \"ffd20\", \"get-actor\"],\n      }\n    );\n\n    dialog.activateListeners = function (html) {\n      Dialog.prototype.activateListeners.call(this, html);\n\n      html.find(\".dialog-get-actor:not(.disabled)\").click((event) => {\n        const elem = event.currentTarget;\n        const actorId = elem.dataset.actorId;\n        if (actorId) {\n          resolve({ type: \"actor\", id: actorId });\n        } else {\n          const itemId = elem.dataset.itemId;\n          if (itemId) {\n            resolve({ type: \"item\", id: itemId });\n          }\n        }\n        this.close();\n      });\n    };\n\n    dialog.render(true);\n  });\n};\n","import { createInlineRollString } from \"../utils/chat.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\n\nexport class LevelUpForm extends FormApplication {\n  constructor(...args) {\n    super(...args);\n\n    /**\n     * Tracks whether this form has already been submitted.\n     */\n    this._submitted = false;\n\n    /**\n     * Tracks the currently viewed section.\n     */\n    this._section = 0;\n\n    /**\n     * Tracks section data.\n     */\n    this._sections = this._addSections();\n\n    // Add summary section at the end\n    this._sections.push(this._addSummarySection());\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"level-up\"],\n      template: \"systems/ffd20/templates/apps/level-up.hbs\",\n      width: 720,\n      height: 480,\n      closeOnSubmit: true,\n    });\n  }\n\n  get section() {\n    return this._section;\n  }\n  get currentSection() {\n    return this._sections[this.section];\n  }\n\n  setSection(idx) {\n    this._section = idx;\n\n    return this._render();\n  }\n\n  get title() {\n    return game.i18n.format(\"FFD20.LevelUpForm_Title\", { className: this.object.name });\n  }\n\n  /** @type {Actor} */\n  get actor() {\n    return this.object.actor;\n  }\n\n  static async addClassWizard(actor, rawData) {\n    // Alter initial data\n    setProperty(rawData, \"system.hp\", 0);\n    setProperty(rawData, \"system.level\", 0);\n\n    // Add class item\n    let itemData = await actor.createEmbeddedDocuments(\"Item\", [rawData]);\n    itemData = itemData instanceof Array ? itemData : [itemData];\n    const item = actor.items.get(itemData[0].id);\n    if (!item) {\n      throw new Error(\"No class was created at class initialization wizard\");\n    }\n\n    // Add level up form for new class\n    return new Promise((resolve) => {\n      const _app = new LevelUpForm(item).render(true);\n      Hooks.on(\"closeLevelUpForm\", function _onClose(app) {\n        if (app === _app) {\n          if (getProperty(item, \"system.level\") === 0) {\n            actor.deleteEmbeddedDocuments(\"Item\", [item.id]);\n          }\n          Hooks.off(\"closeLevelUpForm\", _onClose);\n          resolve();\n        }\n      });\n    });\n  }\n\n  getData() {\n    const result = {};\n\n    result.data = this.object.toObject();\n    result.actor = this.actor.toObject();\n    result.config = CONFIG.FFD20;\n\n    // Add sections\n    result.section = this.currentSection;\n    result.sections = this._sections;\n\n    // Add summary data\n    result.summary = this.getSummaryData();\n\n    result.uuid = this.object.uuid;\n\n    return result;\n  }\n\n  getSummaryData() {\n    const result = {};\n\n    for (const section of this._sections) {\n      if (section.name === \"summary\") continue;\n      const { summary } = this._parseSection(section);\n      result[section.name] = summary;\n    }\n\n    return result;\n  }\n\n  _addSections() {\n    const result = [];\n\n    // Add health section\n    const hpSettings = game.settings.get(\"ffd20\", \"healthConfig\");\n    const hpOptions = this.actor.type === \"character\" ? hpSettings.hitdice.PC : hpSettings.hitdice.NPC;\n    if (hpOptions.auto !== true) {\n      result.push({\n        name: \"health\",\n        label: \"FFD20.LevelUpForm_Health\",\n        choice: null,\n        manualValue: Math.ceil(1 + (this.object.system.hd - 1) / 2),\n        items: [\n          {\n            img: \"systems/ffd20/icons/items/inventory/dice.jpg\",\n            name: game.i18n.localize(\"FFD20.LevelUpForm_Health_Roll\"),\n            id: \"roll\",\n            type: \"html\",\n            target: \"systems/ffd20/templates/apps/level-up/health_roll.hbs\",\n          },\n          {\n            img: \"systems/ffd20/icons/skills/green_19.jpg\",\n            name: game.i18n.localize(\"FFD20.LevelUpForm_Health_Manual\"),\n            id: \"manual\",\n            type: \"html\",\n            target: \"systems/ffd20/templates/apps/level-up/health_manual.hbs\",\n          },\n        ],\n      });\n    }\n\n    // Add favoured class bonus\n    if (this.isFavouredClass()) {\n      result.push({\n        name: \"fc\",\n        label: \"FFD20.LevelUp.FC.Label\",\n        choice: null,\n        items: [\n          {\n            name: game.i18n.localize(\"FFD20.None\"),\n            id: \"none\",\n          },\n          {\n            img: \"systems/ffd20/icons/skills/green_19.jpg\",\n            name: game.i18n.localize(\"FFD20.FavouredClassBonus.HP\"),\n            id: \"hp\",\n            type: \"html\",\n            target: \"systems/ffd20/templates/apps/level-up/fc_hp.hbs\",\n          },\n          {\n            img: \"systems/ffd20/icons/items/inventory/dice.jpg\",\n            name: game.i18n.localize(\"FFD20.FavouredClassBonus.Skill\"),\n            id: \"skill\",\n            type: \"html\",\n            target: \"systems/ffd20/templates/apps/level-up/fc_skill.hbs\",\n          },\n          {\n            img: \"systems/ffd20/icons/skills/affliction_22.jpg\",\n            name: game.i18n.localize(\"FFD20.FavouredClassBonus.Alt\"),\n            id: \"alt\",\n            type: \"html\",\n            target: \"systems/ffd20/templates/apps/level-up/fc_alt.hbs\",\n          },\n        ],\n      });\n    }\n\n    // Add ability score\n    const newHD = this.actor.getRollData().attributes.hd.total + 1;\n    const newAbilityScores = CONFIG.FFD20.levelAbilityScores[newHD];\n    if (typeof newAbilityScores === \"number\" && newAbilityScores > 0) {\n      result.push({\n        name: \"ability\",\n        label: \"FFD20.LevelUp.AbilityScore.Label\",\n        template: \"systems/ffd20/templates/apps/level-up/ability-score.hbs\",\n        choice: null,\n        abilities: Object.keys(CONFIG.FFD20.abilities).reduce((cur, o) => {\n          cur[o] = {\n            value: this.actor.system.abilities[o].total,\n            name: CONFIG.FFD20.abilities[o],\n            added: 0,\n            isEnhanced: this.actor.system.abilities[o].total !== this.actor.system.abilities[o].base,\n          };\n          return cur;\n        }, {}),\n        value: newAbilityScores,\n      });\n    }\n\n    return result;\n  }\n\n  _addSummarySection() {\n    return {\n      name: \"summary\",\n      label: \"FFD20.LevelUp.Summary.Label\",\n      template: \"systems/ffd20/templates/apps/level-up/summary.hbs\",\n    };\n  }\n\n  /**\n   * @returns {boolean} Whether this form's associated class is a favoured class.\n   * @// TODO: Add better logic for determining this <26-01-22, Furyspark> //\n   */\n  isFavouredClass() {\n    return this.object.system.classType === \"base\";\n  }\n\n  async _updateObject(event, formData) {\n    const itemData = {};\n    const actorData = {};\n    const chatData = {\n      config: CONFIG.FFD20,\n    };\n    const newItems = [];\n    const callbacks = [];\n\n    for (const section of this._sections) {\n      const data = this._parseSection(section);\n      mergeObject(itemData, data.item);\n      mergeObject(actorData, data.actor);\n      mergeObject(chatData, data.chatData);\n      callbacks.push(...data.callbacks);\n      for (const item of data.newItems) {\n        const prevItem = newItems.find((o) => o._id === item._id);\n        if (prevItem != null) mergeObject(prevItem, item);\n        else newItems.push(item);\n      }\n    }\n\n    // Add level\n    chatData.level = {\n      previous: this.object.system.level,\n      new: this.object.system.level + 1,\n    };\n\n    // Update class\n    mergeObject(itemData, { \"system.level\": chatData.level.new });\n    const levelingClass = this.object;\n    const lvlwaiter = new Promise((resolve) => {\n      const hid = Hooks.on(\"ffd20.classLevelChange\", function _waiter(actor, item, curLevel, newLevel) {\n        if (item.id === levelingClass.id) {\n          Hooks.off(\"ffd20.classLevelChange\", hid);\n          resolve();\n        }\n      });\n    });\n    await levelingClass.update(itemData);\n    await lvlwaiter;\n\n    // Update actor\n    if (Object.keys(actorData).length) {\n      await this.actor.update(actorData);\n    }\n    // Add items\n    if (newItems.length > 0) {\n      await this.actor.createEmbeddedDocuments(\"Item\", newItems);\n    }\n    // Run callbacks\n    for (const cb of callbacks) {\n      await cb.call(this);\n    }\n\n    // Add new class features to chat data\n    {\n      const classAssociations = getProperty(this.object, \"flags.ffd20.links.classAssociations\") || {};\n      const newAssociations = Object.entries(classAssociations).filter((o) => {\n        return o[1] === chatData.level.new;\n      });\n      chatData.newFeatures = [];\n      for (const co of newAssociations) {\n        const item = this.actor.items.get(co[0]);\n        if (item) chatData.newFeatures.push(item.toObject());\n      }\n    }\n\n    // Add extra info (new feats, skill ranks, etc.)\n    {\n      const ex = {};\n      chatData.extra = ex;\n\n      // Show new feat count\n      const featCount = this.actor.getFeatCount();\n      featCount.new = Math.max(0, featCount.max - featCount.value);\n      ex.feats = featCount;\n      if (featCount.new > 0) {\n        ex.enabled = true;\n        if (featCount.new === 1) featCount.label = game.i18n.localize(\"FFD20.LevelUp.Chat.Extra.NewFeat\");\n        else featCount.label = game.i18n.format(\"FFD20.LevelUp.Chat.Extra.NewFeats\", { newValue: featCount.new });\n      }\n\n      // Show new ability score\n      const hd = this.actor.system.attributes.hd.total;\n      if (typeof hd === \"number\" && hd % 4 === 0) {\n        ex.enabled = true;\n        ex.newAbilityScore = {\n          label: game.i18n.localize(\"FFD20.LevelUp.Chat.Extra.NewAbilityScore\"),\n        };\n      }\n    }\n\n    // Create chat message\n    return this.createChatMessage(chatData);\n  }\n\n  /**\n   * @typedef {object} LevelUp_UpdateData\n   * @property {object} item - The update data for the leveling class item.\n   * @property {object} actor - The update data for the associated actor.\n   * @property {object} chatData - Data to add for the level up's chat card.\n   * @property {object[]} newItems - Items to add due to this update.\n   * @property {object[]} summary - Data for the summary to show.\n   * @property {Function[]} callbacks - Asynchronous callbacks to call upon submit.\n   */\n  /**\n   * Parses a section, and sets updateData as appropriate for a submit.\n   *\n   * @param {object} section - The given section.\n   * @returns {LevelUp_UpdateData}\n   */\n  _parseSection(section) {\n    const result = {\n      item: {},\n      actor: {},\n      chatData: {},\n      newItems: [],\n      summary: {},\n      callbacks: [],\n    };\n\n    const fn = this[`_parseSection_${section.name}`];\n    if (fn instanceof Function) return fn.call(this, section, result);\n\n    return result;\n  }\n\n  _parseSection_health(section, result) {\n    result.summary = {\n      label: \"FFD20.LevelUp.Chat.Health.Header\",\n      template: \"systems/ffd20/templates/apps/level-up/summary/health.hbs\",\n      type: section.choice,\n    };\n\n    // Manual health\n    if (section.choice === \"manual\") {\n      const hpValue = section.manualValue;\n      result.item[\"system.hp\"] = this.object.system.hp + hpValue;\n      result.chatData.hp = {\n        label: \"FFD20.LevelUp.Chat.Health.Manual\",\n        add: hpValue,\n        roll: RollFFD20.safeRoll(`${hpValue}`),\n      };\n      result.summary.hp = hpValue;\n    }\n    // Roll health\n    else if (section.choice === \"roll\") {\n      const formula = `1d${this.object.system.hd}`;\n      const roll = RollFFD20.safeRoll(formula);\n      result.chatData.hp = {\n        label: \"FFD20.LevelUp.Chat.Health.Roll\",\n        add: createInlineRollString(roll),\n        roll: roll,\n      };\n      if (!Number.isNaN(roll.total)) {\n        result.item[\"system.hp\"] = this.object.system.hp + roll.total;\n      }\n    }\n\n    return result;\n  }\n\n  _parseSection_fc(section, result) {\n    result.summary = {\n      label: \"FFD20.LevelUp.Chat.FC.Header\",\n      template: \"systems/ffd20/templates/apps/level-up/summary/fc.hbs\",\n      id: section.choice,\n    };\n\n    const id = section.choice;\n    if ([\"hp\", \"skill\", \"alt\"].includes(id)) {\n      const key = `system.fc.${section.choice}.value`;\n      result.item[key] = getProperty(this.object, key) + 1;\n\n      const fcKey = { hp: \"HP\", skill: \"Skill\", alt: \"Alt\" }[id];\n      result.chatData.fc = {\n        type: id,\n        label: `FFD20.FavouredClassBonus.${fcKey}`,\n      };\n\n      result.summary.desc = `FFD20.LevelUp.FC.${fcKey}.Desc`;\n    }\n\n    return result;\n  }\n\n  _parseSection_ability(section, result) {\n    const added = Object.entries(section.abilities).reduce((cur, o) => {\n      if (!(o[1].added > 0)) return cur;\n      cur[o[0]] = o[1].added;\n      return cur;\n    }, {});\n\n    // Add summary data\n    result.summary = {\n      label: \"FFD20.LevelUp.AbilityScore.Label\",\n      template: \"systems/ffd20/templates/apps/level-up/summary/ability-score.hbs\",\n      choices: added,\n    };\n\n    // Add chat data\n    if (Object.keys(added).length) {\n      result.chatData.ability = {\n        choices: added,\n      };\n    }\n\n    const item = this.actor.items.find((o) => o.getFlag(\"ffd20\", \"levelUp\") === true);\n    // Add level up ability score feature if it doesn't exist yet\n    if (!item) {\n      const newItem = mergeObject(\n        CONFIG.FFD20.levelAbilityScoreFeature,\n        {\n          flags: {\n            ffd20: {\n              levelUp: true,\n            },\n          },\n        },\n        { inplace: false }\n      );\n\n      // Translate name and description\n      newItem.name = game.i18n.localize(newItem.name);\n      setProperty(\n        newItem,\n        \"system.description.value\",\n        game.i18n.localize(getProperty(newItem, \"system.description.value\") ?? \"\")\n      );\n\n      // Add changes\n      setProperty(\n        newItem,\n        \"system.changes\",\n        Object.entries(added).reduce((cur, o) => {\n          const change = mergeObject(ffd20.components.ItemChange.defaultData, {\n            formula: `${o[1]}`,\n            subTarget: o[0],\n            modifier: \"untypedPerm\",\n          });\n\n          cur.push(change);\n          return cur;\n        }, [])\n      );\n\n      result.newItems.push(newItem);\n    }\n    // If a level up ability score feature already exists, update it\n    else {\n      const cb = async function () {\n        const changes = duplicate(item.system.changes ?? []);\n        for (const [key, value] of Object.entries(added)) {\n          const change = changes.find((o) => o.subTarget === key);\n\n          // Update previous change\n          if (change != null) {\n            const prevValue = parseInt(change.formula);\n            if (!Number.isNaN(prevValue)) {\n              const newValue = prevValue + value;\n              change.formula = `${newValue}`;\n              continue;\n            }\n          }\n\n          // Add new change\n          changes.push(\n            mergeObject(ffd20.components.ItemChange.defaultData, {\n              subTarget: key,\n              formula: `${value}`,\n              modifier: \"untypedPerm\",\n            })\n          );\n        }\n\n        await item.update({\n          \"system.changes\": changes,\n        });\n      };\n\n      result.callbacks.push(cb);\n    }\n\n    return result;\n  }\n\n  async createChatMessage(formData) {\n    const speaker = ChatMessage.getSpeaker({ actor: this.actor });\n\n    const templateData = {\n      formData,\n      config: CONFIG.FFD20,\n      item: this.object.toObject(),\n      actor: this.actor.toObject(),\n    };\n\n    return ChatMessage.create({\n      content: await renderTemplate(\"systems/ffd20/templates/chat/level-up.hbs\", templateData),\n      user: game.user.id,\n      type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n      speaker,\n      roll: formData.hp?.roll ?? RollFFD20.safeRoll(\"0\"),\n    });\n  }\n\n  activateListeners(html) {\n    html.find(\".list-selector .item\").on(\"click\", this._onClickListItem.bind(this));\n    html.find(\"input.section-choice\").on(\"change\", this._onChangeSectionChoice.bind(this));\n\n    html.find(\".ability-scores .ability-score .operator\").on(\"click\", this._onClickAbilityScoreOperator.bind(this));\n\n    html.find(`button[data-type=\"previous\"]`).on(\"click\", this._onPreviousSection.bind(this));\n    html.find(`button[data-type=\"next\"]`).on(\"click\", this._onNextSection.bind(this));\n    html.find('button[name=\"submit\"]').on(\"click\", this._onSubmit.bind(this));\n  }\n\n  _onPreviousSection(event) {\n    event.preventDefault();\n\n    this.setSection(this.section - 1);\n  }\n\n  _onNextSection(event) {\n    event.preventDefault();\n\n    this.setSection(this.section + 1);\n  }\n\n  _onClickListItem(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Return if item already selected\n    if (a.classList.contains(\"active\")) return;\n\n    this.currentSection.currentItem = this.currentSection.items.find((o) => o.id === a.dataset.id);\n    setProperty(this.currentSection, \"choice\", a.dataset.id);\n    return this._render();\n  }\n\n  async _render(...args) {\n    await super._render(...args);\n    this._updateNavButtons();\n  }\n\n  _onChangeSectionChoice(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const [sectionName, key] = a.name.split(\":\");\n    const section = this._sections.find((o) => o.name === sectionName);\n\n    if (!section) return;\n\n    // Get value\n    let value = a.value;\n    switch (a.dataset.dtype.toLowerCase()) {\n      case \"number\":\n        value = parseFloat(value);\n        break;\n      case \"boolean\":\n        value = [\"true\", \"1\"].includes(value);\n        break;\n    }\n\n    // Change section choice\n    setProperty(section, key, value);\n  }\n\n  _onClickAbilityScoreOperator(event) {\n    event.preventDefault();\n\n    const a = event.currentTarget;\n    const operator = a.dataset.operator;\n    const ablKey = a.closest(\".ability-score\").dataset.key;\n    const section = this.currentSection;\n    const add = operator === \"add\" ? 1 : operator === \"subtract\" ? -1 : 0;\n\n    section.abilities[ablKey].value += add;\n    section.abilities[ablKey].added += add;\n    section.value -= add;\n\n    section.choice = section.value === 0 ? true : null;\n\n    this._render();\n  }\n\n  _updateNavButtons() {\n    const formDiv = this.element.find(\".nav-buttons\");\n\n    const buttons = {\n      previous: formDiv.find(`button[data-type=\"previous\"]`),\n      next: formDiv.find(`button[data-type=\"next\"]`),\n      submit: formDiv.find(`button[type=\"submit\"]`),\n    };\n    if (this._section > 0) {\n      buttons.previous.prop(\"disabled\", false);\n    } else {\n      buttons.previous.prop(\"disabled\", true);\n    }\n\n    const hasMadeChoice = !!this.currentSection.choice;\n    if (this.section < this._sections.length - 1 && hasMadeChoice) {\n      buttons.next.prop(\"disabled\", false);\n    } else {\n      buttons.next.prop(\"disabled\", true);\n    }\n\n    if (this.section === this._sections.length - 1) {\n      buttons.submit.prop(\"disabled\", false);\n    } else {\n      buttons.submit.prop(\"disabled\", true);\n    }\n  }\n\n  _onSubmit(event, ...args) {\n    event.preventDefault();\n    if (this._submitted) return;\n\n    this._submitted = true;\n    super._onSubmit(event, ...args);\n  }\n}\n","export class CurrencyTransfer extends FormApplication {\n  constructor(\n    source = { actor: null, container: null, amount: {}, alt: false },\n    dest = { actor: null, container: null, amount: {}, alt: false },\n    options = {}\n  ) {\n    super(options);\n\n    if (source.actor) {\n      if (typeof source.actor === \"string\") source.actor = game.actors.get(source.actor);\n      if (source.actor.data.type == \"npc\") source.alt = false;\n    }\n    if (source.container) {\n      source.alt = false;\n      if (typeof source.container === \"string\")\n        source.container = source.actor ? source.actor.items.get(source.container) : game.items.get(source.container);\n    }\n    if (dest.actor) {\n      if (typeof dest.actor === \"string\") dest.actor = game.actors.get(dest.actor);\n      if (dest.actor.data.type == \"npc\") dest.alt = false;\n      else if (dest.actor === source.actor && !source.container && !dest.container) dest.alt = !source.alt;\n    }\n    if (dest.container) {\n      if (typeof dest.container === \"string\")\n        dest.container = dest.actor ? dest.actor.items.get(dest.container) : game.items.get(dest.container);\n    }\n\n    // Currency checks\n    if (source.container) {\n      source.amount = mergeObject(source.container.data.currency, source.amount ?? {});\n    } else if (source.actor) {\n      source.amount = mergeObject(\n        source.alt ? source.actor.data.altCurrency : source.actor.data.currency,\n        source.amount ?? {}\n      );\n    } else if (game.user.isGM) {\n      source.amount = mergeObject({ pgil: \"∞\", gil: \"∞\", sgil: \"∞\", cgil: \"∞\" }, source.amount ?? {});\n    } else {\n      ui.notification.warning(\"Cannot use Infinite currency transfer as non-gm.\");\n      return undefined;\n    }\n\n    if (!dest.actor && !dest.container) return undefined;\n\n    this.source = source;\n    this.dest = dest;\n  }\n\n  get title() {\n    let title;\n    if (!this.source.actor) {\n      if (this.source.container) title = this.source.container.name + \" \";\n      else title = \"∞ \";\n    } else {\n      title = this.source.actor.name + \" \";\n      if (this.source.container) title += `(${this.source.container.name}) `;\n    }\n    title += \"➤ \";\n    if (this.source.actor == this.dest.actor && (this.source.alt || this.dest.alt))\n      title += this.dest.alt ? game.i18n.localize(\"FFD20.WeightlessCurrency\") : game.i18n.localize(\"FFD20.Currency\");\n    else {\n      if (!this.dest.actor) title += this.dest.container.name;\n      else {\n        title += this.dest.actor.name;\n        if (this.dest.container) title += ` (${this.dest.container.name})`;\n      }\n    }\n    return title;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"currency-transfer\"],\n      template: \"systems/ffd20/templates/apps/currency-transfer.hbs\",\n      width: 380,\n      height: 235,\n    });\n  }\n\n  static get order() {\n    return [\"pgil\", \"gil\", \"sgil\", \"cgil\"]; // Object conversion ordering cannot be trusted in js\n  }\n\n  activateListeners(html) {\n    html.find('button[type=\"submit\"]').click(this._onSubmit.bind(this));\n\n    html.find(\"button.cur-range\").click(this._curRange.bind(this));\n\n    html.find(\"input\").on(\"input\", this._calcTotal.bind(this));\n    $(html.find(\"input\")[0]).trigger(\"input\");\n  }\n\n  _updateObject(event, formData) {\n    this.dest.amount = {\n      pgil: formData.pgil ?? 0,\n      gil: formData.gil ?? 0,\n      sgil: formData.sgil ?? 0,\n      cgil: formData.cgil ?? 0,\n    };\n    this.constructor.transfer(\n      this.source.container ? this.source.container : this.source.actor,\n      this.dest.container ? this.dest.container : this.dest.actor,\n      this.dest.amount,\n      this.source.alt,\n      this.dest.alt,\n      2\n    );\n  }\n\n  getData(_options = {}) {\n    return {\n      source: this.source,\n      dest: this.dest,\n      options: this.options,\n      title: this.title,\n      total:\n        this.source.amount.gil === \"∞\"\n          ? \"∞\"\n          : this.constructor.order.reduce((acc, c, idx) => acc + this.source.amount[c] * 10 ** (1 - idx), 0),\n    };\n  }\n\n  _curRange(ev) {\n    ev.preventDefault();\n    const button = ev.target.closest(\"button\");\n    const formField = button.closest(\".form-fields\");\n    const min = button.classList.contains(\"down\");\n    const input = formField.querySelector(\"input\");\n\n    if (min) input.value = \"\";\n    else input.value = formField.querySelector(\"span\").textContent;\n    $(input).trigger(\"input\");\n  }\n\n  _calcTotal(ev) {\n    const form = ev.target.closest(\".currency-transfer\");\n    const amounts = Object.fromEntries(\n      [...form.querySelectorAll(\"input\")].map((o) => [o.name, parseInt(o.value || 0)])\n    );\n    const value = this.constructor.order.reduce((acc, c, idx) => acc + amounts[c] * 10 ** (1 - idx), 0);\n\n    form.querySelector(\".currency-total .form-fields label\").textContent = Math.round(value * 100) / 100 + \" gil\";\n  }\n\n  async close(...args) {\n    super.close(...args);\n  }\n\n  static _failed(i18nKey) {\n    return ui.notifications.error(game.i18n.localize(\"FFD20.CurrencyFailed\") + game.i18n.localize(i18nKey));\n  }\n\n  static _directoryDrop(docDestId, event) {\n    event.preventDefault();\n\n    // try to extract the data\n    let data;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n      if (data.type !== \"Currency\") return;\n    } catch (err) {\n      return false;\n    }\n\n    const destDoc = event.currentTarget.classList.contains(\"item\")\n      ? game.items.get(docDestId)\n      : game.actors.get(docDestId);\n    const sourceActor = data.tokenId ? game.actors.tokens[data.tokenId] : data.actorId;\n\n    if (data.currency && sourceActor) {\n      return new CurrencyTransfer(\n        { actor: sourceActor, container: data.containerId, alt: data.alt },\n        {\n          actor: destDoc?.actor ?? destDoc,\n          container: destDoc.data.type === \"container\" ? destDoc.id : null,\n          amount: Object.fromEntries([[data.currency, parseInt(data.amount)]]),\n        }\n      ).render(true);\n    }\n  }\n\n  /**\n   * Transfer an amount of currency to a valid document\n   *\n   * @param {Document} sourceDoc ActorFFD20 or ItemFFD20 with currency\n   * @param {Document} destDoc ActorFFD20 or ItemFFD20 with currency\n   * @param {object|number} amount currency object containing transferred amount. Undefined keys will be assumed to be zero. Providing just a number will assume just gil\n   * @param {boolean} sourceAlt Use alt currency on source\n   * @param {boolean} destAlt Use alt currency on destination\n   * @param {number} [allowConversion=false] Attempts to make change with sourceDoc's currency limit\n   * @returns {boolean|object} false if failed, object containing amount transferred on success\n   */\n  static async transfer(sourceDoc, destDoc, amount, sourceAlt = false, destAlt = false, allowConversion = false) {\n    if ((!sourceDoc && !game.user.isGM) || !destDoc || !amount) return false;\n\n    if (typeof amount !== \"object\") amount = { gil: parseInt(amount) };\n\n    this.order.forEach((c) => (amount[c] = amount[c] ?? 0));\n    if (!Object.values(amount).find((a) => a > 0)) return this._failed(\"FFD20.CurrencyInsufficient\"), false;\n\n    let sourceCurrency = duplicate(sourceAlt ? sourceDoc?.data.altCurrency : sourceDoc?.data.currency);\n    const destCurrency = duplicate(destAlt ? destDoc.data.altCurrency : destDoc.data.currency);\n    if ((!sourceCurrency && !game.user.isGM) || !destCurrency) return false;\n    const originalSource = Object.assign(Object.fromEntries(this.order.map((o) => [o, Infinity])), sourceCurrency);\n\n    const totalAmount = this.order.reduce((acc, c, idx) => acc + amount[c] * 10 ** (1 - idx), 0);\n    const totalSource = this.order.reduce((acc, c, idx) => acc + sourceCurrency[c] * 10 ** (1 - idx), 0);\n\n    if (totalAmount > totalSource) return this._failed(\"FFD20.CurrencyInsufficient\"), false;\n\n    if (sourceCurrency) {\n      this.order.some((a) => {\n        const newSource = sourceCurrency[a] - amount[a];\n\n        if (newSource < 0 && allowConversion) {\n          amount = this.convert(originalSource, totalAmount, allowConversion);\n          sourceCurrency = Object.fromEntries(this.order.map((o) => [o, originalSource[o] - amount[o]]));\n          return true;\n        } else sourceCurrency[a] = newSource;\n      });\n    }\n\n    if (!amount || Object.values(sourceCurrency).find((c) => c < 0)) return false;\n\n    if (!sourceDoc.testUserPermission(game.user, 3) || !destDoc.testUserPermission(game.user, 3)) {\n      if (!game.users.find((o) => o.active && o.isGM)) return this._failed(\"FFD20.CurrencyGMRequired\"), false;\n      game.socket.emit(\"system.ffd20\", {\n        eventType: \"currencyTransfer\",\n        data: {\n          sourceActor: sourceDoc.actor?.uuid ?? sourceDoc.uuid,\n          destActor: destDoc.actor?.uuid ?? destDoc.uuid,\n          sourceContainer: sourceDoc.data.type === \"container\" ? sourceDoc.id : \"\",\n          destContainer: destDoc.data.type === \"container\" ? destDoc.id : \"\",\n          sourceAlt: sourceAlt,\n          destAlt: destAlt,\n          amount: amount,\n        },\n      });\n      return amount;\n    }\n\n    this.order.forEach((c) => (destCurrency[c] += amount[c]));\n    if (sourceDoc === destDoc)\n      return sourceDoc.update({\n        \"data.altCurrency\": sourceAlt ? sourceCurrency : destCurrency,\n        \"data.currency\": destAlt ? sourceCurrency : destCurrency,\n      });\n    if (sourceAlt) sourceDoc.update({ \"data.altCurrency\": sourceCurrency });\n    else sourceDoc.update({ \"data.currency\": sourceCurrency });\n    if (destAlt) destDoc.update({ \"data.altCurrency\": destCurrency });\n    else destDoc.update({ \"data.currency\": destCurrency });\n    return amount;\n  }\n\n  /**\n   * Convert totalAmount to a currency object containing\n   *\n   * @param {object} limit currency object containing max number of coins. Falsey values will assume infinity\n   * @param {number|object} totalAmount currency as gil pieces. If provided as a currency object, will convert to gil\n   * @returns {boolean|object} false if failed, currency object containing new amounts on conversion success\n   */\n  static convert(limit, totalAmount) {\n    if (!limit) limit = Object.fromEntries(this.order.map((o) => [o, Infinity]));\n    else limit = Object.assign({}, limit);\n    if (typeof totalAmount !== \"number\")\n      totalAmount = this.order.reduce((acc, cur, idx) => acc + totalAmount?.[cur] * 10 ** (1 - idx));\n    if (!totalAmount) return false;\n    const amount = {};\n    totalAmount =\n      this.order.reduce((acc, cur, idx) => {\n        const minRequired = Math.min(limit[cur], Math.floor((acc % 10000) / 10 ** (3 - idx))), //Start from left to allow clumping\n          inCopper = minRequired * 10 ** (3 - idx);\n        amount[cur] = minRequired;\n        limit[cur] -= minRequired;\n        return acc - inCopper;\n      }, totalAmount * 100) / 100; //Operate in copper pieces to avoid floating point errors\n    if (totalAmount < 0) return false;\n    return amount;\n  }\n}\n","import { ActorTraitSelector } from \"../trait-selector.mjs\";\nimport { ActorRestDialog } from \"./actor-rest.mjs\";\nimport {\n  createTag,\n  CR,\n  createConsumableSpellDialog,\n  adjustNumberByStringCommand,\n  splitCurrency,\n} from \"../../utils/lib.mjs\";\nimport { PointBuyCalculator } from \"../point-buy-calculator.mjs\";\nimport { Widget_ItemPicker } from \"../item-picker.mjs\";\nimport { getSkipActionPrompt } from \"../../documents/settings.mjs\";\nimport { ItemFFD20 } from \"../../documents/item/item-ffd20.mjs\";\nimport { dialogGetActor } from \"../../utils/dialog.mjs\";\nimport { applyAccessibilitySettings } from \"../../utils/chat.mjs\";\nimport { LevelUpForm } from \"../level-up.mjs\";\nimport { CurrencyTransfer } from \"../currency-transfer.mjs\";\nimport { getHighestChanges } from \"../../documents/actor/utils/apply-changes.mjs\";\nimport { FFD20 } from \"../../config.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\n\n/**\n * Extend the basic ActorSheet class to do all the FFD20 things!\n * This sheet is an Abstract layer which is not used.\n *\n * @type {ActorSheet}\n */\nexport class ActorSheetFFD20 extends ActorSheet {\n  constructor(...args) {\n    super(...args);\n\n    /**\n     * Track the set of item filters which are applied\n     *\n     * @type {Set}\n     */\n    this._filters = {\n      inventory: new Set(),\n      \"spellbook-primary\": new Set(),\n      \"spellbook-secondary\": new Set(),\n      \"spellbook-tertiary\": new Set(),\n      \"spellbook-quaternary\": new Set(),\n      \"spellbook-spelllike\": new Set(),\n      features: new Set(),\n      buffs: new Set(),\n      attacks: new Set(),\n      search: {\n        inventory: \"\",\n        attacks: \"\",\n        feats: \"\",\n        buffs: \"\",\n        \"spellbook-primary\": \"\",\n        \"spellbook-secondary\": \"\",\n        \"spellbook-tertiary\": \"\",\n        \"spellbook-quaternary\": \"\",\n        \"spellbook-spelllike\": \"\",\n      },\n    };\n\n    /** Item search */\n    this.searchCompositioning = false; // for IME\n    this.searchRefresh = true; // Lock out same term search unless sheet also refreshes\n    this.searchDelay = 250; // arbitrary ?ms for arbitrarily decent reactivity; MMke this configurable?\n    this.searchDelayEvent = null; // setTimeout id\n    this.effectiveSearch = {}; // prevent searching the same thing\n\n    /**\n     * Track item updates from the actor sheet.\n     *\n     * @property\n     * @private\n     * @type {object[]}\n     */\n    this._itemUpdates = [];\n\n    /**\n     * Track hidden elements of the sheet.\n     *\n     * @property\n     */\n    this._hiddenElems = {};\n\n    /**\n     * Whether a submit has been queued in any way.\n     *\n     * @property\n     */\n    this._submitQueued = false;\n\n    /**\n     * Whether inner part of this sheet has been rendered already.\n     *\n     * @property\n     */\n    this._renderedInner = false;\n\n    /**\n     * A dictionary of additional queued updates, to be added on top of the form's data (and cleared afterwards).\n     *\n     * @property\n     * @private\n     */\n    this._pendingUpdates = {};\n\n    /**\n     * @type {boolean} Whether the skills are currently locked.\n     * @property\n     * @private\n     */\n    this._skillsLocked = true;\n\n    /**\n     * @type {string[]} IDs of expanded items.\n     * @private\n     */\n    this._expandedItems = [];\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      scrollY: [\n        \".combat-attacks\",\n        \".inventory-list\",\n        \".skills-list\",\n        \".traits\",\n        \".actor-notes\",\n        \".editor-content[data-edit='system.details.biography.value']\",\n      ],\n      dragDrop: [\n        { dragSelector: \"li.item[data-item-id]\" },\n        { dragSelector: \"label.denomination\" },\n        { dragSelector: \".race-container.item[data-item-id]\" },\n        { dragSelector: \"li.skill[data-skill]\" },\n        { dragSelector: \"li.sub-skill[data-skill]\" },\n        { dragSelector: \"th.saving-throw[data-savingthrow]\" },\n        { dragSelector: \"th.attribute.cmb[data-attribute]\" },\n        { dragSelector: \"th.attribute.bab[data-attribute]\" },\n        { dragSelector: \"li.generic-defenses[data-drag]\" },\n        { dragSelector: \".spellcasting-concentration[data-drag]\" },\n        { dragSelector: \".spellcasting-cl\" },\n      ],\n      tabs: [\n        {\n          navSelector: \"nav.tabs[data-group='primary']\",\n          contentSelector: \"section.primary-body\",\n          initial: \"summary\",\n        },\n        {\n          navSelector: \"nav.tabs[data-group='skillset']\",\n          contentSelector: \"section.skillset-body\",\n          initial: \"adventure\",\n        },\n        {\n          navSelector: \"nav.tabs[data-group='spellbooks']\",\n          contentSelector: \"section.spellbooks-body\",\n          initial: \"primary\",\n        },\n      ],\n    });\n  }\n\n  /**\n   * Returns an object containing feature type specific data relevant to feature organization.\n   *\n   * @static\n   * @type {Object<string, any>}\n   */\n  static get featTypeData() {\n    return {\n      template: {\n        hasActions: false,\n      },\n    };\n  }\n\n  get currentPrimaryTab() {\n    const primaryElem = this.element.find('nav[data-group=\"primary\"] .item.active');\n    if (primaryElem.length !== 1) return null;\n    return primaryElem.attr(\"data-tab\");\n  }\n\n  get currentSpellbookKey() {\n    const elems = this.element.find(\"nav.spellbooks .item.active\");\n    if (elems.length === 1) return elems.attr(\"data-tab\");\n    else return \"primary\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add some extra data when rendering the sheet to reduce the amount of logic required within the template.\n   *\n   * @param options\n   */\n  async getData(options) {\n    const isOwner = this.document.isOwner;\n    const data = mergeObject(await super.getData(options), {\n      owner: isOwner,\n      limited: this.document.limited,\n      editable: this.isEditable,\n      cssClass: isOwner ? \"editable\" : \"locked\",\n      isCharacter: this.document.type === \"character\",\n      hasRace: false,\n      config: CONFIG.FFD20,\n      useBGSkills: game.settings.get(\"ffd20\", \"allowBackgroundSkills\"),\n      spellFailure: this.document.spellFailure,\n      isGM: game.user.isGM,\n      race: this.document.race != null ? this.document.race.toObject() : null,\n      usesAnySpellbook: this.document.system.attributes.spells.usedSpellbooks?.length > 0 ?? false,\n      sourceData: {},\n      skillsLocked: this._skillsLocked,\n    });\n    const rollData = this.document.getRollData();\n    data.rollData = rollData;\n    data.system = deepClone(this.document.system);\n\n    data.hasProficiencies = data.isCharacter || game.settings.get(\"ffd20\", \"npcProficiencies\");\n\n    // Show whether the item has currency\n    data.hasCurrency = Object.values(this.object.system.currency).some((o) => o > 0);\n    data.hasAltCurrency = Object.values(this.object.system.altCurrency).some((o) => o > 0);\n\n    // Enrich descriptions\n    data.biographyHTML = await TextEditor.enrichHTML(data.system.details.biography.value, {\n      secrets: isOwner,\n      rollData: data.rollData,\n      async: true,\n    });\n    data.notesHTML = await TextEditor.enrichHTML(data.system.details.notes.value, {\n      secrets: isOwner,\n      rollData: data.rollData,\n      async: true,\n    });\n\n    // The Actor and its Items\n    if (this.document.isToken) data.token = this.document.token.toObject();\n    else data.token = data.actor.token;\n    data.items = this.document.items.map((item) => {\n      const i = deepClone(item.system);\n      i.document = item;\n      i.type = item.type;\n      i.id = item.id;\n      i.img = item.img;\n      i.labels = item.labels;\n      i.hasAttack = item.firstAction?.hasAttack;\n      i.hasMultiAttack = item.firstAction?.hasMultiAttack;\n      i.hasDamage = item.firstAction?.hasDamage;\n      i.hasRange = item.firstAction?.hasRange;\n      i.hasEffect = item.firstAction?.hasEffect;\n      i.hasAction = item.hasAction || item.getScriptCalls(\"use\").length > 0;\n      i.range = mergeObject(\n        item.firstAction?.data?.range ?? {},\n        {\n          min: item.firstAction?.getRange({ type: \"min\" }),\n          max: item.firstAction?.getRange({ type: \"max\" }),\n        },\n        { inplace: false }\n      );\n      i.sort = item.sort;\n      i.showUnidentifiedData = item.showUnidentifiedData;\n      if (i.showUnidentifiedData)\n        i.name =\n          getProperty(item, \"system.unidentified.name\") || getProperty(item, \"system.identifiedName\") || item.name;\n      else i.name = getProperty(item, \"system.identifiedName\") || item.name;\n      return i;\n    });\n    data.items.sort((a, b) => (a.sort || 0) - (b.sort || 0));\n    data.labels = this.document.labels || {};\n    data.filters = this._filters;\n\n    // Set class info\n    data.classInfo = data.items\n      .filter((o) => o.type === \"class\")\n      .reduce((cur, o) => {\n        cur[o.tag] = o;\n        return cur;\n      }, {});\n\n    // Generic melee and ranged attack bonuses, only present for sheet.\n    const coreAttack = data.system.attributes.attack.shared + data.system.attributes.attack.general,\n      meleeAtkAbl = data.system.abilities[data.system.attributes.attack.meleeAbility]?.mod ?? 0,\n      rangedAtkAbl = data.system.abilities[data.system.attributes.attack.rangedAbility]?.mod ?? 0,\n      cmbAbl = data.system.abilities[data.system.attributes.cmbAbility]?.mod ?? 0;\n\n    const szMod = CONFIG.FFD20.sizeMods[data.system.traits.size],\n      szCMBMod = CONFIG.FFD20.sizeSpecialMods[data.system.traits.size];\n\n    data.system.attributes.attack.meleeAttackMod = meleeAtkAbl;\n    data.system.attributes.attack.rangedAttackMod = rangedAtkAbl;\n    data.meleeAttack = coreAttack + szMod + data.system.attributes.attack.melee + (meleeAtkAbl ?? 0);\n    data.rangedAttack = coreAttack + szMod + data.system.attributes.attack.ranged + (rangedAtkAbl ?? 0);\n    data.cmbAttack = coreAttack + szCMBMod + data.system.attributes.cmb.total + (cmbAbl ?? 0);\n\n    // Add inventory value\n    {\n      const cgilValue = this.calculateTotalItemValue({ inLowestDenomination: true });\n      const totalValue = splitCurrency(cgilValue);\n      data.labels.totalValue = game.i18n\n        .localize(\"FFD20.ItemContainerTotalItemValue\")\n        .format(totalValue.gil, totalValue.sgil, totalValue.cgil);\n    }\n\n    // Hit point sources\n    if (this.document.sourceDetails != null) data.sourceDetails = expandObject(this.document.sourceDetails);\n    else data.sourceDetails = null;\n\n    // Ability Scores\n    for (const [a, abl] of Object.entries(data.system.abilities)) {\n      abl.label = CONFIG.FFD20.abilities[a];\n      abl.totalLabel = abl.total == null ? \"-\" : abl.total;\n\n      abl.sourceDetails = [\n        ...(data.sourceDetails?.system?.abilities?.[a]?.total ?? []),\n        ...(data.sourceDetails?.system?.abilities?.[a]?.penalty ?? []),\n      ];\n    }\n\n    // Armor Class\n    for (const [a, ac] of Object.entries(data.system.attributes.ac)) {\n      ac.label = CONFIG.FFD20.ac[a];\n      ac.valueLabel = CONFIG.FFD20.acValueLabels[a];\n      ac.sourceDetails = data.sourceDetails != null ? data.sourceDetails.system.attributes.ac[a].total : [];\n    }\n\n    // Saving Throws\n    for (const [a, savingThrow] of Object.entries(data.system.attributes.savingThrows)) {\n      savingThrow.label = CONFIG.FFD20.savingThrows[a];\n      savingThrow.sourceDetails =\n        data.sourceDetails != null ? data.sourceDetails.system.attributes.savingThrows[a].total : [];\n    }\n\n    // Update skill labels\n    const acp = getProperty(this.document, \"system.attributes.acp.total\");\n    for (const [s, skl] of Object.entries(data.system.skills)) {\n      skl.label = CONFIG.FFD20.skills[s];\n      skl.arbitrary = CONFIG.FFD20.arbitrarySkills.includes(s);\n      skl.sourceDetails = [];\n      skl.compendiumEntry = CONFIG.FFD20.skillCompendiumEntries[s] ?? skl.journal ?? null;\n\n      // Add skill rank source\n      if (skl.rank > 0) {\n        skl.sourceDetails.push({ name: game.i18n.localize(\"FFD20.SkillRankPlural\"), value: skl.rank });\n\n        // Add class skill bonus source\n        if (skl.cs) {\n          skl.sourceDetails.push({ name: game.i18n.localize(\"FFD20.CSTooltip\"), value: 3 });\n        }\n      }\n\n      // Add ACP source\n      if (skl.acp && acp > 0) {\n        skl.sourceDetails.push({ name: game.i18n.localize(\"FFD20.ACPLong\"), value: -acp });\n      }\n\n      // Add ability modifier source\n      if (skl.ability) {\n        skl.sourceDetails.push({\n          name: CONFIG.FFD20.abilities[skl.ability],\n          value: data.rollData.abilities[skl.ability]?.mod ?? 0,\n        });\n      }\n\n      // Add misc skill bonus source\n      if (data.sourceDetails != null && data.sourceDetails.system.skills[s] != null) {\n        skl.sourceDetails = skl.sourceDetails.concat(data.sourceDetails.system.skills[s].changeBonus);\n      }\n\n      skl.untrained = skl.rt === true && skl.rank <= 0;\n      if (skl.subSkills != null) {\n        for (const [s2, skl2] of Object.entries(skl.subSkills)) {\n          skl2.compendiumEntry = skl2.journal ?? null;\n          skl2.sourceDetails = [];\n          if (skl2.rank > 0) {\n            skl2.sourceDetails.push({ name: game.i18n.localize(\"FFD20.SkillRankPlural\"), value: skl2.rank });\n            if (skl2.cs) {\n              skl2.sourceDetails.push({ name: game.i18n.localize(\"FFD20.CSTooltip\"), value: 3 });\n            }\n          }\n          skl2.sourceDetails.push({\n            name: CONFIG.FFD20.abilities[skl2.ability],\n            value: data.system.abilities[skl2.ability]?.mod ?? 0,\n          });\n          if (\n            data.sourceDetails != null &&\n            data.sourceDetails.system.skills[s] != null &&\n            data.sourceDetails.system.skills[s].subSkills != null &&\n            data.sourceDetails.system.skills[s].subSkills[s2] != null\n          ) {\n            skl2.sourceDetails = skl2.sourceDetails.concat(\n              data.sourceDetails.system.skills[s].subSkills[s2].changeBonus\n            );\n          }\n          skl2.untrained = skl2.rt === true && skl2.rank <= 0;\n        }\n      }\n    }\n\n    // Control items\n    data.items\n      .filter((obj) => {\n        return obj.type === \"spell\";\n      })\n      .forEach((obj) => {\n        obj.isPrepared = obj.preparation.mode === \"prepared\";\n      });\n\n    // Update traits\n    this._prepareTraits(data.system.traits);\n    data.senses = this._prepareSenses(data.system.traits.senses);\n\n    // Prepare owned items\n    this._prepareItems(data);\n\n    // Compute encumbrance\n    data.encumbrance = this._computeEncumbrance(data.system);\n\n    // Prepare skillsets\n    data.skillsets = this._prepareSkillsets(data.system.skills);\n\n    // Skill rank counting\n    const skillRanks = { allowed: 0, used: 0, bgAllowed: 0, bgUsed: 0, sentToBG: 0 };\n    // Count used skill ranks\n    for (const skl of Object.values(data.rollData.skills)) {\n      if (skl.subSkills != null) {\n        for (const subSkl of Object.values(skl.subSkills)) {\n          if (data.useBGSkills && skl.background) {\n            skillRanks.bgUsed += subSkl.rank;\n          } else {\n            skillRanks.used += subSkl.rank;\n          }\n        }\n      } else if (data.useBGSkills && skl.background) {\n        skillRanks.bgUsed += skl.rank;\n      } else {\n        skillRanks.used += skl.rank;\n      }\n    }\n    // Count allowed skill ranks\n    const sourceData = [];\n    setProperty(data.sourceData, \"skillRanks\", sourceData);\n    this.document.items\n      .filter((obj) => {\n        return obj.type === \"class\" && obj.system.classType !== \"mythic\";\n      })\n      .forEach((cls) => {\n        const clsLevel = cls.system.hitDice;\n        const clsSkillsPerLevel = cls.system.skillsPerLevel;\n        const fcSkills = cls.system.fc.skill.value;\n        skillRanks.allowed +=\n          Math.max(1, clsSkillsPerLevel + this.document.system.abilities.int.mod) * clsLevel + fcSkills;\n        if (data.useBGSkills && [\"base\", \"prestige\"].includes(cls.system.classType))\n          skillRanks.bgAllowed += clsLevel * 2;\n\n        sourceData.push({\n          name: game.i18n.format(\"FFD20.SourceInfoSkillRank_ClassBase\", { className: cls.name }),\n          value: clsSkillsPerLevel * clsLevel,\n        });\n        if (fcSkills > 0) {\n          sourceData.push({\n            name: game.i18n.format(\"FFD20.SourceInfoSkillRank_ClassFC\", { className: cls.name }),\n            value: fcSkills,\n          });\n        }\n      });\n    // Count from intelligence\n    if (getProperty(this.actor, \"system.abilities.int.mod\") !== 0) {\n      sourceData.push({\n        name: game.i18n.localize(\"FFD20.AbilityInt\"),\n        value:\n          getProperty(this.actor, \"system.abilities.int.mod\") * getProperty(this.actor, \"system.attributes.hd.total\"),\n      });\n    }\n    // Count from bonus skill rank formula\n    if (this.actor.system.details.bonusSkillRankFormula !== \"\") {\n      const roll = RollFFD20.safeRoll(this.actor.system.details.bonusSkillRankFormula, rollData);\n      if (roll.err) console.error(`An error occurred in the Bonus Skill Rank formula of actor ${this.actor.name}.`);\n      skillRanks.allowed += roll.total;\n      sourceData.push({\n        name: game.i18n.localize(\"FFD20.SkillBonusRankFormula\"),\n        value: roll.total,\n      });\n    }\n    // Calculate from changes\n    this.actor.changes\n      .filter((o) => o.subTarget === \"bonusSkillRanks\")\n      .forEach((o) => {\n        if (!o.value) return;\n\n        skillRanks.allowed += o.value;\n        sourceData.push({\n          name: o.parent ? o.parent.name : game.i18n.localize(\"FFD20.Change\"),\n          value: o.value,\n        });\n      });\n    // Calculate used background skills\n    if (data.useBGSkills) {\n      if (skillRanks.bgUsed > skillRanks.bgAllowed) {\n        skillRanks.sentToBG = skillRanks.bgUsed - skillRanks.bgAllowed;\n        skillRanks.allowed -= skillRanks.sentToBG;\n        skillRanks.bgAllowed += skillRanks.sentToBG;\n      }\n    }\n    data.skillRanks = skillRanks;\n\n    // Feat count\n    {\n      const sourceData = [];\n      setProperty(data.sourceData, \"bonusFeats\", sourceData);\n\n      // Feat count\n      // By level\n      data.featCount = {};\n      data.featCount.value = this.actor.items.filter(\n        (o) => o.type === \"feat\" && o.system.featType === \"feat\" && !o.system.disabled\n      ).length;\n      const totalLevels = this.document.items\n        .filter((o) => o.type === \"class\" && [\"base\", \"npc\", \"prestige\", \"racial\"].includes(o.system.classType))\n        .reduce((cur, o) => {\n          return cur + o.hitDice;\n        }, 0);\n      data.featCount.byLevel = Math.ceil(totalLevels / 2);\n      sourceData.push({\n        name: game.i18n.localize(\"FFD20.Level\"),\n        value: data.featCount.byLevel,\n      });\n\n      // Bonus feat formula\n      const featCountRoll = RollFFD20.safeRoll(this.document.system.details.bonusFeatFormula || \"0\", rollData);\n      const changes = this.document.changes.filter((c) => c.subTarget === \"bonusFeats\");\n      const changeBonus = getHighestChanges(\n        changes.filter((c) => {\n          c.applyChange(this.document);\n          if (c.parent || c.flavor) {\n            sourceData.push({\n              name: c.parent?.name ?? c.flavor,\n              value: c.value,\n            });\n          }\n          return ![\"set\", \"=\"].includes(c.operator);\n        }),\n        { ignoreTarget: true }\n      ).reduce((cur, c) => {\n        return cur + c.value;\n      }, 0);\n      data.featCount.byFormula = featCountRoll.total + changeBonus;\n      if (featCountRoll.err) {\n        const msg = game.i18n\n          .localize(\"FFD20.ErrorActorFormula\")\n          .format(game.i18n.localize(\"FFD20.BonusFeatFormula\"), this.document.name);\n        console.error(msg);\n        ui.notifications.error(msg);\n      }\n      if (featCountRoll.total !== 0) {\n        sourceData.push({\n          name: game.i18n.localize(\"FFD20.BonusFeatFormula\"),\n          value: featCountRoll.total,\n        });\n      }\n\n      // Count total\n      data.featCount.total = data.featCount.byLevel + data.featCount.byFormula;\n    }\n\n    // Fetch the game settings relevant to sheet rendering.\n    {\n      const actorType = { character: \"pc\", npc: \"npc\" }[this.document.type];\n      data.healthConfig = game.settings.get(\"ffd20\", \"healthConfig\");\n      data.useWoundsAndVigor = data.healthConfig.variants[actorType].useWoundsAndVigor;\n    }\n\n    // Determine hidden elements\n    this._prepareHiddenElements();\n    data.hiddenElems = this._hiddenElems;\n\n    // Create a table of magic items\n    {\n      const magicItems = this.document.items\n        .filter((o) => {\n          if (o.showUnidentifiedData) return false;\n          if (!o.system.carried) return false;\n\n          const school = getProperty(o, \"system.aura.school\");\n          const cl = getProperty(o, \"system.cl\");\n          return typeof school === \"string\" && school.length > 0 && typeof cl === \"number\" && cl > 0;\n        })\n        .map((o) => {\n          const data = {};\n\n          data.name = o.name;\n          data.img = o.img;\n          data.id = o.id;\n          data.cl = getProperty(o, \"system.cl\");\n          data.school = getProperty(o, \"system.aura.school\");\n          if (CONFIG.FFD20.spellSchools[data.school] != null) {\n            data.school = CONFIG.FFD20.spellSchools[data.school];\n          }\n          data.school = `${CONFIG.FFD20.auraStrengths[o.auraStrength]} <b>${data.school}</b>`;\n          data.identifyDC = 15 + data.cl;\n          {\n            const quantity = getProperty(o, \"system.quantity\") || 0;\n            if (quantity > 1) data.quantity = quantity;\n          }\n          data.identified = getProperty(o, \"system.identified\") === true;\n\n          return data;\n        });\n      if (magicItems.length > 0) {\n        data.table_magicItems = await renderTemplate(\"systems/ffd20/templates/internal/table_magic-items.hbs\", {\n          items: magicItems,\n          isGM: game.user.isGM,\n        });\n      }\n    }\n\n    // Prepare (interactive) labels\n    {\n      data.labels.firstClass = game.i18n\n        .localize(\"FFD20.Info_FirstClass\")\n        .format(\n          `<a data-action=\"compendium\" data-action-target=\"classes\" title=\"${game.i18n.localize(\n            \"FFD20.OpenCompendium\"\n          )}\">${game.i18n.localize(\"FFD20.Info_FirstClass_Compendium\")}</a>`\n        )\n        .replace(/[\\n\\r]+/, \"<br>\");\n    }\n\n    // Return data to the sheet\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  _prepareHiddenElements() {\n    // Hide spellbook info\n    const spellbooks = getProperty(this.document, \"system.attributes.spells.spellbooks\");\n    for (const k of Object.keys(spellbooks)) {\n      const key = `spellbook-info_${k}`;\n      if (this._hiddenElems[key] == null) this._hiddenElems[key] = true;\n    }\n  }\n\n  _prepareTraits(traits) {\n    const map = {\n      // \"dr\": CONFIG.FFD20.damageTypes,\n      di: CONFIG.FFD20.damageTypes,\n      dv: CONFIG.FFD20.damageTypes,\n      ci: CONFIG.FFD20.conditionTypes,\n      languages: CONFIG.FFD20.languages,\n      armorProf: CONFIG.FFD20.armorProficiencies,\n      weaponProf: CONFIG.FFD20.weaponProficiencies,\n    };\n    for (const [t, choices] of Object.entries(map)) {\n      const trait = traits[t];\n      if (!trait) continue;\n      let values = [];\n      // Prefer total over value for dynamically collected proficiencies\n      if ([\"armorProf\", \"weaponProf\", \"languages\"].includes(t)) {\n        values = trait.total ?? trait.value;\n      } else if (trait.value) {\n        values = trait.value instanceof Array ? trait.value : [trait.value];\n      }\n      trait.selected = values.reduce((obj, t) => {\n        obj[t] = choices[t];\n        return obj;\n      }, {});\n\n      // Prefer total over value for dynamically collected proficiencies\n      if (trait.customTotal) {\n        trait.customTotal\n          .split(CONFIG.FFD20.re.traitSeparator)\n          .forEach((c, i) => (trait.selected[`custom${i + 1}`] = c.trim()));\n      } else if (trait.custom) {\n        // Add custom entry\n        trait.custom\n          .split(CONFIG.FFD20.re.traitSeparator)\n          .forEach((c, i) => (trait.selected[`custom${i + 1}`] = c.trim()));\n      }\n      trait.cssClass = !foundry.utils.isEmpty(trait.selected) ? \"\" : \"inactive\";\n    }\n  }\n\n  _prepareSenses(senses) {\n    const result = {};\n\n    for (const [k, v] of Object.entries(senses)) {\n      if (k === \"ll\" && senses[k].enabled) {\n        result[k] = CONFIG.FFD20.senses[k];\n        continue;\n      }\n\n      if (k === \"custom\" && v.length) {\n        v.split(CONFIG.FFD20.re.traitSeparator).forEach((c, i) => {\n          result[`custom${i + 1}`] = c.trim();\n        });\n        continue;\n      }\n\n      if (typeof v === \"number\" && v > 0) {\n        const converted = ffd20.utils.convertDistance(v);\n        result[k] = `${CONFIG.FFD20.senses[k]} ${converted[0]} ${converted[1]}`;\n        continue;\n      }\n\n      if (v === true) {\n        result[k] = CONFIG.FFD20.senses[k];\n        continue;\n      }\n    }\n\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Insert a spell into the spellbook object when rendering the character sheet\n   *\n   * @param {object} data     The Actor data being prepared\n   * @param {Array} spells    The spell data being prepared\n   * @param {string} bookKey  The key of the spellbook being prepared\n   * @private\n   */\n  _prepareSpellbook(data, spells, bookKey) {\n    const owner = this.document.isOwner;\n    const book = this.document.system.attributes.spells.spellbooks[bookKey];\n\n    let min = 0;\n    let max = 9;\n    if (book.autoSpellLevelCalculation) {\n      min = book.hasCantrips ? 0 : 1;\n\n      const cl = book.cl.autoSpellLevelTotal;\n\n      const castsPerDay = CONFIG.FFD20.casterProgression.castsPerDay[book.spellPreparationMode][book.casterType][cl - 1];\n      // Check against undefined protects against bad CL modifications.\n      max = castsPerDay !== undefined ? castsPerDay.length - 1 : 0;\n    }\n\n    // Reduce spells to the nested spellbook structure\n    const spellbook = {};\n    for (let level = 0; level < 10; level++) {\n      const spellLevel = getProperty(book, `spells.spell${level}`);\n      if (!isNaN(spellLevel.max)) {\n        spellbook[level] = {\n          level: level,\n          usesSlots: true,\n          spontaneous: book.spontaneous,\n          canCreate: owner === true,\n          canPrepare: data.actor.type === \"character\",\n          label: CONFIG.FFD20.spellLevels[level],\n          items: [],\n          uses: spellLevel.value || 0,\n          baseSlots: spellLevel.base || 0,\n          slots: spellLevel.max || 0,\n          dataset: { type: \"spell\", level: level, spellbook: bookKey },\n          name: game.i18n.localize(`FFD20.SpellLevel${level}`),\n          spellMessage: spellLevel.spellMessage,\n          lowAbilityScore: spellLevel.lowAbilityScore,\n          known: spellLevel.known,\n          preparation: spellLevel.preparation,\n        };\n      }\n    }\n    spells.forEach((spell) => {\n      const lvl = spell.level ?? min;\n      spellbook[lvl]?.items.push(spell);\n    });\n\n    for (let a = 0; a < 10; a++) {\n      if (spellbook[a]?.items.length === 0 && (a > max || a < min)) delete spellbook[a];\n    }\n\n    return spellbook;\n  }\n\n  _prepareSkillsets(skillset) {\n    const result = {\n      all: { skills: {} },\n      adventure: { skills: {} },\n      background: { skills: {} },\n    };\n\n    // sort skills by label\n    const keys = Object.keys(skillset).sort(function (a, b) {\n      if (skillset[a].custom && !skillset[b].custom) return 1;\n      if (!skillset[a].custom && skillset[b].custom) return -1;\n      return (\"\" + skillset[a].label).localeCompare(skillset[b].label);\n    });\n\n    keys.forEach((a) => {\n      const skl = skillset[a];\n      result.all.skills[a] = skl;\n      if (skl.background) result.background.skills[a] = skl;\n      else result.adventure.skills[a] = skl;\n    });\n\n    return result;\n  }\n\n  /**\n   * Returns the amount of type filters currently active.\n   *\n   * @param filters\n   * @returns {number}\n   * @private\n   */\n  _typeFilterCount(filters) {\n    return Array.from(filters).filter((s) => s.startsWith(\"type-\")).length;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Determine whether an Owned Item will be shown based on the current set of filters\n   *\n   * @param items\n   * @param filters\n   * @returns {boolean}\n   * @private\n   */\n  _filterItems(items, filters) {\n    const hasTypeFilter = this._typeFilterCount(filters) > 0;\n\n    return items.filter((item) => {\n      if (item.type === \"feat\") {\n        if (hasTypeFilter && !filters.has(`type-${item.featType}`)) return false;\n      }\n\n      if (ItemFFD20.isInventoryItem(item.type)) {\n        if (hasTypeFilter && item.type !== \"loot\" && !filters.has(`type-${item.type}`)) return false;\n        else if (hasTypeFilter && item.type === \"loot\" && !filters.has(`type-${item.subType}`)) return false;\n      }\n\n      if (item.type === \"spell\") {\n        if (hasTypeFilter && !filters.has(`type-${item.level}`)) return false;\n      }\n\n      if (item.type === \"buff\") {\n        if (hasTypeFilter && !filters.has(`type-${item.buffType}`)) return false;\n      }\n\n      if (item.type === \"attack\") {\n        if (hasTypeFilter && !filters.has(`type-${item.attackType}`)) return false;\n      }\n\n      return true;\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Compute the level and percentage of encumbrance for an Actor.\n   *\n   * @param {object} actorData      The data object for the Actor being rendered\n   * @returns {object}               An object describing the character's encumbrance level\n   * @private\n   */\n  _computeEncumbrance(actorData) {\n    const carriedWeight = actorData.attributes.encumbrance.carriedWeight;\n    const load = {\n      light: actorData.attributes.encumbrance.levels.light,\n      medium: actorData.attributes.encumbrance.levels.medium,\n      heavy: actorData.attributes.encumbrance.levels.heavy,\n    };\n    let carryLabel;\n    let usystem = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n    if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n    switch (usystem) {\n      case \"metric\":\n        carryLabel = game.i18n.localize(\"FFD20.CarryLabelKg\").format(carriedWeight);\n        break;\n      default:\n        carryLabel = game.i18n.localize(\"FFD20.CarryLabel\").format(carriedWeight);\n        break;\n    }\n    const enc = {\n      pct: {\n        light: Math.max(0, Math.min((carriedWeight * 100) / load.light, 99.5)),\n        medium: Math.max(0, Math.min(((carriedWeight - load.light) * 100) / (load.medium - load.light), 99.5)),\n        heavy: Math.max(0, Math.min(((carriedWeight - load.medium) * 100) / (load.heavy - load.medium), 99.5)),\n      },\n      encumbered: {\n        light: actorData.attributes.encumbrance.level >= 1,\n        medium: actorData.attributes.encumbrance.level >= 2,\n        heavy: actorData.attributes.encumbrance.carriedWeight >= actorData.attributes.encumbrance.levels.heavy,\n      },\n      light: actorData.attributes.encumbrance.levels.light,\n      medium: actorData.attributes.encumbrance.levels.medium,\n      heavy: actorData.attributes.encumbrance.levels.heavy,\n      aboveHead: actorData.attributes.encumbrance.levels.heavy,\n      offGround: actorData.attributes.encumbrance.levels.heavy * 2,\n      dragPush: actorData.attributes.encumbrance.levels.heavy * 5,\n      value: actorData.attributes.encumbrance.carriedWeight,\n      carryLabel: carryLabel,\n    };\n\n    return enc;\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers\n  /* -------------------------------------------- */\n\n  /**\n   * Activate event listeners using the prepared sheet HTML\n   *\n   * @param html {HTML}   The prepared HTML object ready to be rendered into the DOM\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // Tooltips\n    html.mousemove((ev) => this._moveTooltips(ev));\n\n    // Activate Item Filters\n    const filterLists = html.find(\".filter-list\");\n    filterLists.each(this._initializeFilterItemList.bind(this));\n    filterLists.on(\"click\", \".filter-item\", this._onToggleFilter.bind(this));\n\n    // Search boxes\n    {\n      const sb = html.find(\".search-input\");\n      sb.on(\"keyup change\", this._searchFilterChange.bind(this));\n      sb.on(\"compositionstart compositionend\", this._searchFilterCompositioning.bind(this)); // for IME\n      this.searchRefresh = true;\n      // Filter tabs on followup refreshes\n      sb.each(function () {\n        if (this.value.length > 0) $(this).change();\n      });\n      html.find(\".clear-search\").on(\"click\", this._clearSearch.bind(this));\n    }\n\n    // Item summaries\n    html.find(\".item .item-name h4\").click((event) => this._onItemSummary(event));\n\n    // Allow opening items even if the sheet isn't editable.\n\n    // Race item\n    html.find(\".race\").each((i, el) => {\n      if (el.closest(\".item\").dataset?.itemId) el.addEventListener(\"contextmenu\", (ev) => this._onItemEdit(ev));\n    });\n    // General items\n    html.find(\".item-edit\").on(\"click\", this._onItemEdit.bind(this));\n    // General items (right click)\n    html.find(\".item .item-name h4\").contextmenu(this._onItemEdit.bind(this));\n    // Quick items (right click)\n    html.find(\".quick-actions li\").contextmenu(this._onItemEdit.bind(this));\n    // Race controls (editable limitations done internally)\n    html.find(\".race-container .item-control\").click(this._onRaceControl.bind(this));\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.options.editable) {\n      html.find(\"span.text-box\").addClass(\"readonly\");\n      return;\n    }\n\n    // Remove default change handler\n    html.off(\"change\");\n    // Add alternative change handler\n    html.find(\"input,select,textarea\").on(\"change\", this._onChangeInput.bind(this));\n\n    // Add general text box (span) handler\n    html.find(\"span.text-box.direct\").on(\"click\", (event) => {\n      this._onSpanTextInput(event, this._adjustActorPropertyBySpan.bind(this));\n    });\n\n    // Click to change text input\n    html.find('*[data-action=\"input-text\"]').click((event) => this._onInputText(event));\n    html\n      .find('*[data-action=\"input-text\"].wheel-change')\n      .on(\"wheel\", (event) => this._onInputText(event.originalEvent));\n\n    // Trigger form submission from textarea elements.\n    html.find(\"textarea\").change(this._onSubmit.bind(this));\n\n    // Show configureable fields\n    html.find(\".config .config-control\").click(this._onConfigControl.bind(this));\n\n    // Select the whole text on click\n    html.find(\".select-on-click\").click(this._selectOnClick.bind(this));\n\n    // Submit on blur\n    html.find(\".submit-on-blur\").on(\"blur\", async (ev) => {\n      await this._onSubmit(ev, { preventRender: true });\n      this.render();\n    });\n\n    /* -------------------------------------------- */\n    /*  Abilities, Skills, Defenses and Traits\n    /* -------------------------------------------- */\n\n    // Submit hit points\n    html.find('input[name=\"system.attributes.hp.value\"]').keypress(this._onSubmitElement.bind(this));\n\n    // Submit mana points\n    html.find('input[name=\"system.attributes.mp.value\"]').keypress(this._onSubmitElement.bind(this));\n\n    // Ability Checks\n    html.find(\".ability-name\").click(this._onRollAbilityTest.bind(this));\n\n    // BAB Check\n    html.find(\".attribute.bab .rollable\").click(this._onRollBAB.bind(this));\n\n    // CMB Check\n    html.find(\".attribute.cmb .rollable\").click(this._onRollCMB.bind(this));\n\n    // Attack check\n    html.find(\".attribute.attack.melee .rollable\").click(this._onRollMelee.bind(this));\n    html.find(\".attribute.attack.ranged .rollable\").click(this._onRollRanged.bind(this));\n\n    // Initiative Check\n    html.find(\".attribute.initiative .rollable\").click(this._onRollInitiative.bind(this));\n\n    // Saving Throw\n    html.find(\".saving-throw .rollable\").click(this._onRollSavingThrow.bind(this));\n\n    // Adjust skill rank\n    html.find(\"span.text-box.skill-rank\").on(\"click\", (event) => {\n      this._onSpanTextInput(event, this._adjustActorPropertyBySpan.bind(this));\n    });\n\n    // Add arbitrary skill\n    html.find(\".skill.arbitrary .skill-create\").click((ev) => this._onArbitrarySkillCreate(ev));\n\n    // Delete arbitrary skill\n    html.find(\".sub-skill > .skill-controls > .skill-delete\").click((ev) => this._onArbitrarySkillDelete(ev));\n\n    // Add custom skill\n    html.find(\".skill-controls.skills .skill-create\").click((ev) => this._onSkillCreate(ev));\n\n    // Edit skill\n    html.find(\".sub-skill > .skill-controls > .skill-edit\").on(\"click\", (ev) => this._onSkillEdit(ev));\n    html.find(\".skill > .skill-controls > .skill-edit\").on(\"click\", (ev) => this._onSkillEdit(ev));\n    // Delete custom skill\n    html.find(\".skill > .skill-controls > .skill-delete\").click((ev) => this._onSkillDelete(ev));\n\n    // Quick Item Action control\n    html.find(\".item-actions a\").mouseup((ev) => this._quickItemActionControl(ev));\n\n    // Roll Skill Checks\n    html.find(\".skill > .rollable\").click(this._onRollSkillCheck.bind(this));\n    html.find(\".sub-skill > .rollable\").click(this._onRollSubSkillCheck.bind(this));\n\n    // Open skill compendium entry\n    html.find(\"a.compendium-entry\").click(this._onOpenCompendiumEntry.bind(this));\n\n    // Trait Selector\n    html.find(\".trait-selector\").click(this._onTraitSelector.bind(this));\n\n    // Roll defenses\n    html.find(\".generic-defenses .rollable\").click((ev) => {\n      this.document.rollDefenses();\n    });\n\n    // Rest\n    html.find(\".rest\").click(this._onRest.bind(this));\n\n    // Point Buy Calculator\n    html.find(\"button.pointbuy-calculator\").click(this._onPointBuyCalculator.bind(this));\n\n    // Alignment\n    html.find(\".control.alignment\").click(this._onControlAlignment.bind(this));\n\n    // Edit senses\n    html.find(\".senses-selector\").on(\"click\", this._onSensesSelector.bind(this));\n\n    /* -------------------------------------------- */\n    /*  Inventory\n    /* -------------------------------------------- */\n\n    // Owned Item management\n    html.find(\".item-create\").on(\"click\", (ev) => this._onItemCreate(ev));\n    html.find(\".item-delete\").on(\"click\", this._onItemDelete.bind(this));\n    html.find(\".item-give\").on(\"click\", this._onItemGive.bind(this));\n    html.find(\".item-split:not(.disabled)\").on(\"click\", this._onItemSplit.bind(this));\n\n    // Item Rolling\n    html.find(\".item .item-image\").click((event) => this._onItemRoll(event));\n\n    // Quick add item quantity\n    html.find(\"a.item-control.item-quantity-add\").click((ev) => {\n      this._quickChangeItemQuantity(ev, 1);\n    });\n    // Quick subtract item quantity\n    html.find(\"a.item-control.item-quantity-subtract\").click((ev) => {\n      this._quickChangeItemQuantity(ev, -1);\n    });\n\n    // Quick (un)equip item\n    html.find(\"a.item-control.item-equip\").click((ev) => {\n      this._quickEquipItem(ev);\n    });\n\n    // Quick carry item\n    html.find(\"a.item-control.item-carry\").click((ev) => {\n      this._quickCarryItem(ev);\n    });\n\n    // Quick (un)identify item\n    html.find(\"a.item-control.item-identify\").click((ev) => {\n      this._quickIdentifyItem(ev);\n    });\n\n    // Quick toggle item property\n    html.find(\"a.item-control.item-toggle-data\").click(this._itemToggleData.bind(this));\n\n    // Duplicate item\n    html.find(\"a.item-control.item-duplicate\").click(this._duplicateItem.bind(this));\n\n    // Quick Action\n    html.find(\".quick-actions li\").click(this._quickAction.bind(this));\n\n    // Convert currency\n    html.find(\"a.convert-currency\").click(this._convertCurrency.bind(this));\n\n    // Set item charges\n    html\n      .find(\".inventory-body .item-uses span.text-box.value\")\n      .on(\"wheel\", this._setFeatUses.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._setFeatUses.bind(this));\n      });\n\n    // Set attack charges\n    html\n      .find(\".attacks-body .item-uses span.text-box.value\")\n      .on(\"wheel\", this._setFeatUses.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._setFeatUses.bind(this));\n      });\n\n    /* -------------------------------------------- */\n    /*  Feats\n    /* -------------------------------------------- */\n\n    html\n      .find(\".feats-body .item-uses span.text-box.value\")\n      .on(\"wheel\", this._setFeatUses.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._setFeatUses.bind(this));\n      });\n\n    /* -------------------------------------------- */\n    /*  Classes\n    /* -------------------------------------------- */\n\n    // Level Up\n    html.find(\".level-up\").click(this._onLevelUp.bind(this));\n\n    /* -------------------------------------------- */\n    /*  Spells\n    /* -------------------------------------------- */\n\n    // Set specific spell's (max) uses\n    html\n      .find(\".item-list .spell-uses span.text-box[data-type='amount']\")\n      .on(\"wheel\", this._setSpellUses.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._setSpellUses.bind(this));\n      });\n    html\n      .find(\".item-list .spell-uses span.text-box[data-type='max']\")\n      .on(\"wheel\", this._setMaxSpellUses.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._setMaxSpellUses.bind(this));\n      });\n\n    // Set spell level uses for spontaneous spellbooks\n    html\n      .find(\".spell-uses .spell-slots.spontaneous span.text-box\")\n      .on(\"wheel\", this._adjustActorPropertyBySpan.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._adjustActorPropertyBySpan.bind(this));\n      });\n    // Set base amount of spell uses for a given spell level\n    html.find(\".spell-uses .spell-max span.text-box\").on(\"click\", (event) => {\n      this._onSpanTextInput(event, this._onSubmit.bind(this));\n    });\n\n    // Set spell point amount\n    html\n      .find(\".spell-points-current .value span.text-box\")\n      .on(\"wheel\", this._adjustActorPropertyBySpan.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._adjustActorPropertyBySpan.bind(this));\n      });\n\n    html.find(\".spellcasting-concentration.rollable\").click(this._onRollConcentration.bind(this));\n\n    html.find(\".spellcasting-cl.rollable\").click(this._onRollCL.bind(this));\n\n    /* -------------------------------------------- */\n    /*  Buffs\n    /* -------------------------------------------- */\n\n    html\n      .find(\".item-detail.item-active input[type='checkbox']\")\n      .off(\"change\")\n      .on(\"change\", this._setItemActive.bind(this));\n\n    html\n      .find(\".item-detail.item-level span.text-box\")\n      .on(\"wheel\", this._setBuffLevel.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._setBuffLevel.bind(this));\n      });\n\n    html.find(\"a.hide-show\").click(this._hideShowElement.bind(this));\n\n    // Toggle condition\n    html.find(\".condition .checkbox\").click(this._onToggleCondition.bind(this));\n\n    /* -------------------------------------------- */\n    /*  Skills\n    /* -------------------------------------------- */\n\n    html.find(\".skill-lock-button\").on(\"click\", this._onToggleSkillLock.bind(this));\n\n    /* -------------------------------------------- */\n    /*  Links\n    /* -------------------------------------------- */\n\n    html.find('a[data-action=\"compendium\"]').click(this._onOpenCompendium.bind(this));\n  }\n\n  /* -------------------------------------------- */\n\n  _onSpanTextInput(event, callback = null) {\n    const el = event.currentTarget;\n    const parent = el.parentElement;\n\n    // Replace span element with an input (text) element\n    const newEl = document.createElement(`INPUT`);\n    newEl.type = \"text\";\n    if (el.dataset?.dtype) newEl.dataset.dtype = el.dataset.dtype;\n\n    // Set value of new input element\n    let prevValue = el.innerText;\n    if (el.classList.contains(\"placeholder\")) prevValue = \"\";\n\n    const noCap = el.classList.contains(\"no-value-cap\");\n\n    const name = el.getAttribute(\"name\");\n    let maxValue;\n    if (name) {\n      newEl.setAttribute(\"name\", name);\n      prevValue = getProperty(this.document, name) ?? \"\";\n      if (prevValue && typeof prevValue !== \"string\") prevValue = prevValue.toString();\n\n      if (name.endsWith(\".value\") && !noCap) {\n        const maxName = name.replace(/\\.value$/, \".max\");\n        maxValue = getProperty(this.document, maxName);\n      }\n    }\n    newEl.value = prevValue;\n\n    // Toggle classes\n    const forbiddenClasses = [\"placeholder\", \"direct\", \"allow-relative\"];\n    for (const cls of el.classList) {\n      if (!forbiddenClasses.includes(cls)) newEl.classList.add(cls);\n    }\n\n    // Replace span with input element\n    const allowRelative = el.classList.contains(\"allow-relative\"),\n      clearValue = parseFloat(el.dataset.clearValue || \"0\");\n    parent.replaceChild(newEl, el);\n    let changed = false;\n    newEl.addEventListener(\"keypress\", (event) => {\n      if (event.key !== \"Enter\") return;\n      changed = true;\n      if (allowRelative) {\n        const number = adjustNumberByStringCommand(parseFloat(prevValue), newEl.value, maxValue, clearValue);\n        newEl.value = number;\n      }\n\n      if (newEl.value.toString() === prevValue.toString()) {\n        this.render();\n      } else if (typeof callback === \"function\") {\n        callback.call(this, event);\n      }\n    });\n    newEl.addEventListener(\"focusout\", (event) => {\n      if (!changed) {\n        changed = true;\n        if (allowRelative && parseFloat(prevValue) !== parseFloat(newEl.value)) {\n          const number = adjustNumberByStringCommand(parseFloat(prevValue), newEl.value, maxValue, clearValue);\n          newEl.value = number;\n        }\n\n        if (newEl.value.toString() === prevValue.toString()) {\n          this.render();\n        } else if (typeof callback === \"function\") {\n          callback.call(this, event);\n        }\n      }\n    });\n\n    // Select text inside new element\n    newEl.focus();\n    newEl.select();\n  }\n\n  _moveTooltips(event) {\n    const elem = $(event.currentTarget);\n    const x = event.clientX;\n    const y = event.clientY + 24;\n    elem.find(\".tooltip:hover .tooltipcontent\").css(\"left\", `${x}px`).css(\"top\", `${y}px`);\n  }\n\n  _onDragSkillStart(event) {\n    const elem = event.currentTarget;\n    let skillElem = elem.closest(\".sub-skill\");\n    let mainSkill = null;\n    let subSkill = null;\n    let isSubSkill = true;\n    if (!skillElem) {\n      skillElem = elem.closest(\".skill\");\n      isSubSkill = false;\n    }\n    if (!skillElem) return;\n\n    if (isSubSkill) {\n      mainSkill = skillElem.dataset.mainSkill;\n      subSkill = skillElem.dataset.skill;\n    } else {\n      mainSkill = skillElem.dataset.skill;\n    }\n\n    const result = {\n      type: \"skill\",\n      actor: this.document.id,\n      skill: subSkill ? `${mainSkill}.subSkills.${subSkill}` : mainSkill,\n    };\n    if (this.document.isToken) {\n      result.sceneId = canvas.scene.id;\n      result.tokenId = this.document.token.id;\n    }\n\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(result));\n  }\n\n  _onDragMiscStart(event, type) {\n    const result = {\n      type: type,\n      actor: this.document.id,\n    };\n    if (this.document.isToken) {\n      result.sceneId = canvas.scene.id;\n      result.tokenId = this.document.token.id;\n    }\n\n    switch (type) {\n      case \"concentration\":\n      case \"cl\": {\n        const elem = event.currentTarget.closest(\".tab.spellbook-group\");\n        result.altType = elem.dataset.tab;\n        break;\n      }\n    }\n\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(result));\n  }\n\n  _onDragSaveStart(event, type) {\n    const result = {\n      type: \"save\",\n      altType: type,\n      actor: this.document.id,\n    };\n    if (this.document.isToken) {\n      result.sceneId = canvas.scene.id;\n      result.tokenId = this.document.token.id;\n    }\n\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(result));\n  }\n\n  /**\n   * Initialize Item list filters by activating the set of filters which are currently applied\n   *\n   * @param i\n   * @param ul\n   * @private\n   */\n  _initializeFilterItemList(i, ul) {\n    const set = this._filters[ul.dataset.filter];\n    const filters = ul.querySelectorAll(\".filter-item\");\n    for (const li of filters) {\n      if (set.has(li.dataset.filter)) li.classList.add(\"active\");\n    }\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  _onRest(event) {\n    event.preventDefault();\n    const app = Object.values(this.document.apps).find((o) => {\n      return o instanceof ActorRestDialog && o._element;\n    });\n    if (app) app.render(true, { focus: true });\n    else new ActorRestDialog(this.document).render(true);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle rolling of an item from the Actor sheet, obtaining the Item instance and dispatching to it's roll method\n   *\n   * @param event\n   * @private\n   */\n  _onItemRoll(event) {\n    event.preventDefault();\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    if (item == null) return;\n    return item.roll();\n  }\n\n  _mouseWheelAdd(event, el) {\n    const isInput = el.tagName.toUpperCase() === \"INPUT\";\n    const { originalEvent } = event;\n\n    if (originalEvent && originalEvent instanceof WheelEvent && originalEvent.ctrlKey) {\n      event.preventDefault();\n      const value = (isInput ? parseFloat(el.value) : parseFloat(el.innerText)) || 0;\n      if (Number.isNaN(value)) return;\n\n      const increase = -Math.sign(originalEvent.deltaY);\n      const amount = parseFloat(el.dataset.wheelStep) || 1;\n\n      if (isInput) {\n        el.value = value + amount * increase;\n      } else {\n        el.innerText = (value + amount * increase).toString();\n      }\n    }\n  }\n\n  _setFeatUses(event) {\n    if (!(event.originalEvent instanceof MouseEvent)) event.preventDefault();\n    const el = event.currentTarget;\n    const itemId = el.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    this._mouseWheelAdd(event, el);\n\n    const value = el.tagName.toUpperCase() === \"INPUT\" ? Number(el.value) : Number(el.innerText);\n    this.setItemUpdate(item.id, \"system.uses.value\", value);\n\n    // Update on lose focus\n    if (event.originalEvent instanceof MouseEvent) {\n      if (!this._submitQueued) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._updateItems();\n        });\n      }\n    } else this._updateItems();\n  }\n\n  _setSpellUses(event) {\n    if (!(event.originalEvent instanceof MouseEvent)) event.preventDefault();\n    const el = event.currentTarget;\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    this._mouseWheelAdd(event, el);\n\n    const prevValue = getProperty(item, \"system.preparation.preparedAmount\");\n    const value = el.tagName.toUpperCase() === \"INPUT\" ? Number(el.value) : Number(el.innerText);\n    this.setItemUpdate(item.id, \"system.preparation.preparedAmount\", value);\n    if (prevValue < value) {\n      const maxValue = item.system.preparation.maxAmount;\n      this.setItemUpdate(item.id, \"system.preparation.maxAmount\", Math.max(maxValue, value));\n    }\n\n    // Update on lose focus\n    if (event.originalEvent instanceof MouseEvent) {\n      if (!this._submitQueued) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._updateItems();\n        });\n      }\n    } else this._updateItems();\n  }\n  _setMaxSpellUses(event) {\n    if (!(event.originalEvent instanceof MouseEvent)) event.preventDefault();\n    const el = event.currentTarget;\n    const itemId = el.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    this._mouseWheelAdd(event, el);\n\n    const prevValue = getProperty(item, \"system.preparation.maxAmount\");\n    const value = el.tagName.toUpperCase() === \"INPUT\" ? Number(el.value) : Number(el.innerText);\n    this.setItemUpdate(item.id, \"system.preparation.maxAmount\", Math.max(0, value));\n    if (prevValue > value) {\n      const curValue = item.system.preparation.preparedAmount;\n      this.setItemUpdate(item.id, \"system.preparation.preparedAmount\", Math.min(curValue, value));\n    }\n    if (value < 0) {\n      el.tagName.toUpperCase() === \"INPUT\" ? (el.value = 0) : (el.innerText = 0);\n    }\n\n    // Update on lose focus\n    if (event.originalEvent instanceof MouseEvent) {\n      if (!this._submitQueued) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._updateItems();\n        });\n      }\n    } else this._updateItems();\n  }\n\n  _adjustActorPropertyBySpan(event) {\n    if (!(event.originalEvent instanceof MouseEvent)) event.preventDefault();\n    const el = event.currentTarget;\n    this._mouseWheelAdd(event, el);\n\n    // Get base value\n    const rawValue = el.tagName.toUpperCase() === \"INPUT\" ? el.value : el.innerText;\n    let value = el.dataset.dtype?.toUpperCase() === \"STRING\" ? rawValue : Number(rawValue);\n\n    // Adjust value if needed\n    const name = el.getAttribute(\"name\");\n    if (name.match(/^system\\.abilities\\.([a-zA-Z0-9]+)\\.value$/)) {\n      if (Number.isNaN(parseInt(value))) value = null;\n      else value = parseInt(value);\n    }\n\n    // Add pending update\n    if (name) {\n      this._pendingUpdates[name] = value;\n    }\n\n    // Update on lose focus\n    if (event.originalEvent instanceof MouseEvent) {\n      if (!this._submitQueued) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._onSubmit(event);\n        });\n      }\n    } else this._onSubmit(event);\n  }\n\n  _setBuffLevel(event) {\n    if (!(event.originalEvent instanceof MouseEvent)) event.preventDefault();\n    const el = event.currentTarget;\n    const itemId = el.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    this._mouseWheelAdd(event, el);\n    const value = el.tagName.toUpperCase() === \"INPUT\" ? Number(el.value) : Number(el.innerText);\n    const name = el.getAttribute(\"name\");\n    if (name) {\n      this._pendingUpdates[name] = value;\n    }\n\n    this.setItemUpdate(item.id, \"system.level\", value);\n    if (event.originalEvent instanceof MouseEvent) {\n      if (!this._submitQueued) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._updateItems();\n        });\n      }\n    } else this._updateItems();\n  }\n\n  _hideShowElement(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const target = this.element.find(`.${a.dataset.for}`);\n\n    if (target.hasClass(\"hidden\")) {\n      $(a).find(\"i\").removeClass(\"fa-arrow-circle-down\").addClass(\"fa-arrow-circle-up\");\n      target.removeClass(\"hidden\");\n      target.hide();\n      target.slideDown(200);\n\n      this._hiddenElems[a.dataset.for] = false;\n    } else {\n      $(a).find(\"i\").removeClass(\"fa-arrow-circle-up\").addClass(\"fa-arrow-circle-down\");\n      target.slideUp(200, () => target.addClass(\"hidden\"));\n\n      this._hiddenElems[a.dataset.for] = true;\n    }\n  }\n\n  _onToggleCondition(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const key = a.name;\n\n    // Delete the stored condition status if setting to false\n    const newStatus = !getProperty(this.actor, key);\n    const deleteKey = key.replace(/(\\w+)$/, (condition) => `-=${condition}`);\n    const updateData = newStatus ? { [key]: true } : { [deleteKey]: null };\n    this.actor.update(updateData);\n  }\n\n  _onToggleSkillLock(event) {\n    event.preventDefault();\n    this._skillsLocked = !this._skillsLocked;\n    return this.render();\n  }\n\n  _onOpenCompendium(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const target = a.dataset.actionTarget;\n\n    ffd20.applications.compendiums[target].render(true, { focus: true });\n  }\n\n  _onRollConcentration(event) {\n    event.preventDefault();\n\n    const spellbookKey = $(event.currentTarget).closest(\".spellbook-group\").data(\"tab\");\n    this.document.rollConcentration(spellbookKey, { skipDialog: getSkipActionPrompt() });\n  }\n\n  _onRollCL(event) {\n    event.preventDefault();\n\n    const spellbookKey = $(event.currentTarget).closest(\".spellbook-group\").data(\"tab\");\n    this.document.rollCL(spellbookKey, { skipDialog: getSkipActionPrompt() });\n  }\n\n  _setItemActive(event) {\n    event.preventDefault();\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    const value = $(event.currentTarget).prop(\"checked\");\n    this.setItemUpdate(item.id, \"system.active\", value);\n    this._updateItems();\n  }\n\n  _onLevelUp(event) {\n    event.preventDefault;\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.actor.items.get(itemId);\n\n    const app = Object.values(this.actor.apps).find((o) => {\n      return o instanceof LevelUpForm && o._element && o.object === item;\n    });\n    if (app) app.render(true, { focus: true });\n    else new LevelUpForm(item).render(true);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * @param {JQuery.ClickEvent<HTMLElement>} event - The click event on the item\n   * @private\n   */\n  _onItemSummary(event) {\n    event.preventDefault();\n    const li = $(event.currentTarget).parents(\".item\");\n    this.openItemSummary(li);\n  }\n\n  /**\n   * Toggle inline display of an item's summary/description by expanding or hiding info div\n   *\n   * @param {JQuery<HTMLElement>} elem - The element to open. Likely will have the `item` class in CSS.\n   * @param {boolean} [instant=false] - Whether to instantly show the expansion (true), or animate it (false)\n   */\n  openItemSummary(elem, { instant = false } = {}) {\n    // Check whether pseudo-item belongs to another collection\n    const collection = elem.attr(\"data-item-collection\") ?? \"items\";\n    const itemId = elem.attr(\"data-item-id\");\n    const item = this.document[collection].get(itemId);\n    const { description, properties } = item.getChatData();\n\n    // Toggle summary\n    this._expandedItems = this._expandedItems.filter((o) => o !== itemId);\n    if (elem.hasClass(\"expanded\")) {\n      const summary = elem.children(\".item-summary\");\n      if (instant) summary.remove();\n      else summary.slideUp(200, () => summary.remove());\n    } else {\n      const div = $(`<div class=\"item-summary\">${description}</div>`);\n      const props = $(`<div class=\"item-properties tag-list\"></div>`);\n      properties.forEach((p) => props.append(`<span class=\"tag\">${p}</span>`));\n      div.append(props);\n      if (instant) elem.append(div);\n      else {\n        elem.append(div.hide());\n        div.slideDown(200);\n      }\n      this._expandedItems.push(itemId);\n    }\n    elem.toggleClass(\"expanded\");\n  }\n\n  /**\n   * Makes a readonly text input editable, and focus it.\n   *\n   * @param event\n   * @private\n   */\n  _onInputText(event) {\n    event.preventDefault();\n    const forStr = event.currentTarget.dataset.for;\n    let elem;\n    if (forStr.match(/CHILD-([0-9]+)/)) {\n      const n = parseInt(RegExp.$1);\n      elem = $(event.currentTarget.children[n]);\n    } else {\n      elem = this.element.find(event.currentTarget.dataset.for);\n    }\n    if (!elem || (elem && elem.attr(\"disabled\"))) return;\n\n    elem.prop(\"readonly\", false);\n    elem.attr(\"name\", event.currentTarget.dataset.attrName);\n    const value = getProperty(this.document, event.currentTarget.dataset.attrName);\n    elem.attr(\"value\", value);\n\n    const wheelEvent = event && event instanceof WheelEvent;\n    if (wheelEvent) {\n      this._mouseWheelAdd(event, elem[0]);\n    } else {\n      elem.select();\n    }\n\n    const handler = (event) => {\n      if (wheelEvent) elem[0].removeEventListener(\"mouseout\", handler);\n      else {\n        elem[0].removeEventListener(\"focusout\", handler);\n        elem[0].removeEventListener(\"keydown\", keyHandler);\n      }\n      elem[0].removeEventListener(\"click\", handler);\n\n      if (\n        (typeof value === \"string\" && value !== elem[0].value) ||\n        (typeof value === \"number\" && value !== parseInt(elem[0].value))\n      ) {\n        changed = true;\n      }\n\n      if (changed) {\n        this._onSubmit(event);\n      } else {\n        this.render();\n      }\n    };\n    const keyHandler = (event) => {\n      if (event.key === \"Enter\") {\n        changed = true;\n        handler.call(this, event);\n      }\n    };\n\n    let changed = false;\n    if (wheelEvent) {\n      elem[0].addEventListener(\"mouseout\", handler);\n      changed = true;\n    } else {\n      elem[0].addEventListener(\"focusout\", handler);\n      elem[0].addEventListener(\"keydown\", keyHandler);\n    }\n    elem[0].addEventListener(\"click\", handler);\n  }\n\n  /* -------------------------------------------- */\n\n  async _onArbitrarySkillCreate(event) {\n    event.preventDefault();\n    const skillId = $(event.currentTarget).parents(\".skill\").attr(\"data-skill\");\n    const mainSkillData = this.document.system.skills[skillId];\n    const skillData = {\n      name: game.i18n.format(\"DOCUMENT.New\", { type: game.i18n.localize(\"FFD20.Skill\") }),\n      ability: mainSkillData.ability,\n      rank: 0,\n      mod: 0,\n      rt: mainSkillData.rt,\n      cs: mainSkillData.cs,\n      acp: mainSkillData.acp,\n    };\n\n    // Get tag\n    let count = 1;\n    let tag = `${skillId}${count}`;\n    while (mainSkillData.subSkills[tag] != null) {\n      count++;\n      tag = `${skillId}${count}`;\n    }\n\n    const updateData = {};\n    updateData[`system.skills.${skillId}.subSkills.${tag}`] = skillData;\n    if (this.document.testUserPermission(game.user, \"OWNER\")) await this.document.update(updateData);\n\n    return this._editSkill(skillId, tag);\n  }\n\n  async _onSkillCreate(event) {\n    event.preventDefault();\n    const isBackground = $(event.currentTarget).parents(\".skills-list\").attr(\"data-background\") === \"true\";\n    const skillData = {\n      name: game.i18n.format(\"DOCUMENT.New\", { type: game.i18n.localize(\"FFD20.Skill\") }),\n      ability: \"int\",\n      rank: 0,\n      mod: 0,\n      rt: false,\n      cs: false,\n      acp: false,\n      background: isBackground,\n      custom: true,\n    };\n\n    let tag = createTag(skillData.name || \"skill\");\n    let count = 1;\n    while (this.document.system.skills[tag] != null) {\n      count++;\n      tag = createTag(skillData.name || \"skill\") + count.toString();\n    }\n\n    const updateData = {};\n    updateData[`system.skills.${tag}`] = skillData;\n    if (this.document.testUserPermission(game.user, \"OWNER\")) await this.document.update(updateData);\n\n    return this._editSkill(tag);\n  }\n\n  /**\n   * Opens a dialog to edit a skill.\n   *\n   * @param {string} skillId - The id of the skill in question.\n   * @param {string} [subSkillId] - The id of the subskill, if appropriate.\n   * @returns {Promise.<void>}\n   */\n  _editSkill(skillId, subSkillId) {\n    return new Promise((resolve) => {\n      const app = new ffd20.applications.SkillEditor(this.document, skillId, subSkillId);\n      app.addCallback(resolve);\n      app.render(true);\n    });\n  }\n\n  _onSkillEdit(event) {\n    event.preventDefault();\n    const mainSkillId =\n      $(event.currentTarget).parents(\".sub-skill\").attr(\"data-main-skill\") ??\n      $(event.currentTarget).parents(\".skill\").attr(\"data-skill\");\n    const subSkillId = $(event.currentTarget).parents(\".sub-skill\").attr(\"data-skill\");\n\n    return this._editSkill(mainSkillId, subSkillId);\n  }\n\n  _onArbitrarySkillDelete(event) {\n    event.preventDefault();\n    const mainSkillId = $(event.currentTarget).parents(\".sub-skill\").attr(\"data-main-skill\");\n    const skill = this.document.system.skills[mainSkillId];\n    const subSkillId = $(event.currentTarget).parents(\".sub-skill\").attr(\"data-skill\");\n    const subSkill = skill?.subSkills?.[subSkillId];\n    const skillName = `${CONFIG.FFD20.skills[mainSkillId] ?? skill.name} (${subSkill.name})`;\n\n    const deleteSkill = () => {\n      const updateData = {};\n      updateData[`data.skills.${mainSkillId}.subSkills.-=${subSkillId}`] = null;\n      this.document.update(updateData);\n    };\n\n    if (getSkipActionPrompt()) {\n      deleteSkill();\n    } else {\n      const msg = `<p>${game.i18n.localize(\"FFD20.DeleteSkillConfirmation\")}</p>`;\n      Dialog.confirm({\n        title: game.i18n.localize(\"FFD20.DeleteSkillTitle\").format(skillName),\n        content: msg,\n        yes: () => {\n          deleteSkill();\n        },\n        rejectClose: true,\n      });\n    }\n  }\n\n  _onSkillDelete(event) {\n    event.preventDefault();\n    if (!this.document.testUserPermission(game.user, \"OWNER\")) return;\n    const skillId = $(event.currentTarget).parents(\".skill\").attr(\"data-skill\");\n    const skill = this.document.system.skills[skillId];\n    const skillName = CONFIG.FFD20.skills[skillId] ?? skill.name;\n\n    const deleteSkill = () => {\n      const updateData = {};\n      updateData[`data.skills.-=${skillId}`] = null;\n      this.document.update(updateData);\n    };\n\n    if (getSkipActionPrompt()) {\n      deleteSkill();\n    } else {\n      const msg = `<p>${game.i18n.localize(\"FFD20.DeleteSkillConfirmation\")}</p>`;\n      Dialog.confirm({\n        title: game.i18n.localize(\"FFD20.DeleteSkillTitle\").format(skillName),\n        content: msg,\n        yes: () => {\n          deleteSkill();\n        },\n        rejectClose: true,\n      });\n    }\n  }\n\n  async _onRaceControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Edit race (allow opening without edit rights)\n    if (a.classList.contains(\"edit\")) {\n      this._onItemEdit(event);\n    }\n    // Add race\n    else if (this.isEditable) {\n      if (a.classList.contains(\"add\")) {\n        const itemData = {\n          name: \"New Race\",\n          type: \"race\",\n        };\n        this.document.createEmbeddedDocuments(\"Item\", [itemData]);\n      }\n      // Delete race\n      else if (a.classList.contains(\"delete\")) {\n        this._onItemDelete(event);\n      }\n    }\n  }\n\n  async _onPointBuyCalculator(event) {\n    event.preventDefault();\n\n    const app = Object.values(this.document.apps).find((o) => {\n      return o instanceof PointBuyCalculator && o._element;\n    });\n    if (app) app.render(true, { focus: true });\n    else new PointBuyCalculator(this.document).render(true);\n  }\n\n  async _onSensesSelector(event) {\n    event.preventDefault();\n\n    const app = Object.values(this.document.apps).find((o) => {\n      return o instanceof ffd20.applications.SensesSelector && o._element;\n    });\n    if (app) app.render(true, { focus: true });\n    else new ffd20.applications.SensesSelector(this.document).render(true);\n  }\n\n  async _onControlAlignment(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    const items = Object.entries(CONFIG.FFD20.alignmentsShort).reduce((cur, o) => {\n      cur.push({ value: o[0], label: game.i18n.localize(o[1]) });\n      return cur;\n    }, []);\n    const w = new Widget_ItemPicker(\n      (alignment) => {\n        this.document.update({ \"system.details.alignment\": alignment });\n      },\n      { items: items, columns: 3 }\n    );\n    w.render($(a));\n  }\n\n  async _quickItemActionControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const itemId = $(event.currentTarget).parents(\".item\").attr(\"data-item-id\");\n    const item = this.document.items.get(itemId);\n\n    // Quick Attack\n    if (a.classList.contains(\"item-attack\")) {\n      await item.use({ ev: event, skipDialog: getSkipActionPrompt() });\n    }\n  }\n\n  async _quickChangeItemQuantity(event, add = 1) {\n    event.preventDefault();\n    const itemId = $(event.currentTarget).parents(\".item\").attr(\"data-item-id\");\n    const item = this.document.items.get(itemId);\n\n    const curQuantity = getProperty(item, \"system.quantity\") || 0;\n    let newQuantity = Math.max(0, curQuantity + add);\n\n    if (item.type === \"container\") newQuantity = Math.min(newQuantity, 1);\n\n    this.setItemUpdate(item.id, \"system.quantity\", newQuantity);\n    this._updateItems();\n  }\n\n  async _quickEquipItem(event) {\n    event.preventDefault();\n    const itemId = $(event.currentTarget).parents(\".item\").attr(\"data-item-id\");\n    const item = this.document.items.get(itemId);\n\n    if (hasProperty(item, \"system.equipped\")) {\n      this.setItemUpdate(item.id, \"system.equipped\", !item.system.equipped);\n      this._updateItems();\n    }\n  }\n\n  async _quickCarryItem(event) {\n    event.preventDefault();\n    const itemId = $(event.currentTarget).parents(\".item\").attr(\"data-item-id\");\n    const item = this.document.items.get(itemId);\n\n    if (hasProperty(item, \"system.carried\")) {\n      item.update({ \"system.carried\": !item.system.carried });\n    }\n  }\n\n  async _quickIdentifyItem(event) {\n    event.preventDefault();\n    if (!game.user.isGM) {\n      const msg = game.i18n.localize(\"FFD20.ErrorCantIdentify\");\n      console.error(msg);\n      return ui.notifications.error(msg);\n    }\n    // const itemId = $(event.currentTarget).parents(\".item\").attr(\"data-item-id\");\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    if (hasProperty(item, \"system.identified\")) {\n      item.update({ \"system.identified\": !item.system.identified });\n    }\n  }\n\n  async _itemToggleData(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    const itemId = $(a).parents(\".item\").attr(\"data-item-id\");\n    const item = this.document.items.get(itemId);\n    const property = $(a).attr(\"name\") || a.dataset.name;\n\n    const updateData = {};\n    updateData[property] = !getProperty(item, property);\n    item.update(updateData);\n  }\n\n  async _duplicateItem(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    const itemId = $(a).parents(\".item\").attr(\"data-item-id\");\n    const item = this.document.items.get(itemId);\n    const data = item.toObject();\n\n    delete data.id;\n    data.name = `${data.name} (Copy)`;\n    data.identifiedName = data.name;\n    if (data.links) data.links = {};\n\n    this.document.createEmbeddedDocuments(\"Item\", [data]);\n  }\n\n  _quickAction(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const itemId = a.dataset.itemId;\n    const item = this.document.items.get(itemId);\n    if (!item) return;\n\n    return item.use({ skipDialog: getSkipActionPrompt() });\n  }\n\n  _convertCurrency(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const currencyType = a.dataset.type;\n    const category = a.dataset.category;\n\n    this.document.convertCurrency(category, currencyType);\n  }\n\n  /**\n   * Handle creating a new Owned Item for the actor using initial data defined in the HTML dataset\n   *\n   * @param event\n   * @private\n   */\n  _onItemCreate(event) {\n    event.preventDefault();\n    const header = event.currentTarget;\n    const type = header.dataset.type;\n    const typeName = header.dataset.typeName || header.dataset.type;\n    const baseName = `New ${typeName.capitalize()}`;\n    const itemData = {\n      name: baseName,\n      type: type,\n      system: duplicate(header.dataset),\n    };\n    delete itemData.system[\"type\"];\n\n    // Convert some data to numbers\n    for (const [k, v] of Object.entries(itemData)) {\n      if (!Number.isNaN(parseFloat(v))) itemData[k] = parseFloat(v);\n    }\n\n    const getSubtype = (d) => getProperty(d, `system.${d.type}Type`);\n    const subtype = getSubtype(itemData);\n    const sameSubgroup = (oldItem) => {\n      if (subtype) return subtype === getSubtype(oldItem);\n      if (type === \"spell\") {\n        return itemData.spellbook === oldItem.system.spellbook && itemData.level === oldItem.system.level;\n      }\n      // Assume everything else is only categorized by main type\n      return true;\n    };\n\n    // Get old items of same general category\n    const oldItems = this.document.items\n      .filter((i) => i.type === type && sameSubgroup(i))\n      .sort((a, b) => a.sort - b.sort);\n\n    if (oldItems.length) {\n      // Ensure new item is at the bottom of the list instead of seemingly random position\n      itemData.sort = oldItems[0].sort - 10;\n\n      // Ensure no duplicate names occur\n      let i = 2;\n      while (oldItems.find((i) => i.name === itemData.name)) {\n        itemData.name = `${baseName} (${i++})`;\n      }\n    }\n\n    // Ensure variable type is correct\n    if (type === \"spell\") {\n      if (typeof itemData.system?.level === \"string\") itemData.system.level = parseInt(itemData.system.level);\n    }\n\n    return this.document.createEmbeddedDocuments(\"Item\", [itemData]);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle editing an existing Owned Item for the Actor\n   *\n   * @param {Event} event   The originating click event\n   * @private\n   */\n  _onItemEdit(event) {\n    event.preventDefault();\n    const li = event.currentTarget.closest(\".item\");\n    const item = this.document.items.get(li.dataset.itemId);\n\n    const app = Object.values(item.apps).find((o) => {\n      return o instanceof ItemSheet && o.document === item && o._element != null;\n    });\n    item.sheet.render(true, { focus: true });\n  }\n\n  /**\n   * Handle deleting an existing Owned Item for the Actor\n   *\n   * @param {Event} event   The originating click event\n   * @private\n   */\n  _onItemDelete(event) {\n    event.preventDefault();\n\n    const button = event.currentTarget;\n    if (button.disabled) return;\n\n    const li = event.currentTarget.closest(\".item\");\n    const item = this.document.items.get(li.dataset.itemId);\n\n    if (getSkipActionPrompt()) {\n      item.delete();\n    } else {\n      button.disabled = true;\n\n      const msg = `<p>${game.i18n.localize(\"FFD20.DeleteItemConfirmation\")}</p>`;\n      Dialog.confirm({\n        title: game.i18n.localize(\"FFD20.DeleteItemTitle\").format(item.name),\n        content: msg,\n        yes: () => {\n          item.delete();\n          button.disabled = false;\n        },\n        no: () => (button.disabled = false),\n        rejectClose: true,\n      }).then(null, () => (button.disabled = false));\n    }\n  }\n\n  async _onItemGive(event) {\n    event.preventDefault();\n\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    const targets = game.actors.contents.filter((o) => o.testUserPermission(game.user, \"OWNER\") && o !== this.document);\n    targets.push(...this.document.items.filter((o) => o.type === \"container\"));\n    targets.push(\n      ...game.items.contents.filter((o) => o.testUserPermission(game.user, \"OWNER\") && o.type === \"container\")\n    );\n    targets.push(\n      ...game.actors.contents.filter(\n        (o) => o.hasPlayerOwner && o !== this.document && !o.testUserPermission(game.user, \"OWNER\")\n      )\n    );\n    const targetData = await dialogGetActor(`Give item to actor`, targets);\n\n    if (!targetData) return;\n    let target;\n    if (targetData.type === \"actor\") {\n      target = game.actors.get(targetData.id);\n    } else if (targetData.type === \"item\") {\n      target = this.document.items.get(targetData.id);\n      if (!target) {\n        target = game.items.get(targetData.id);\n      }\n    }\n\n    if (target && target !== item) {\n      const itemData = item.toObject();\n      if (target instanceof Actor) {\n        if (target.testUserPermission(game.user, \"OWNER\")) {\n          await target.createEmbeddedDocuments(\"Item\", [itemData]);\n        } else {\n          game.socket.emit(\"system.ffd20\", {\n            eventType: \"giveItem\",\n            targetActor: target.uuid,\n            item: item.uuid,\n          });\n          // Deleting will be performed on the gm side as well to prevent race conditions\n          return;\n        }\n      } else if (target instanceof Item) {\n        await target.createContainerContent(itemData);\n      }\n      console.log({ sheet: this, document: this.document });\n      await this.document.deleteEmbeddedDocuments(\"Item\", [item.id]);\n    }\n  }\n\n  async _onItemSplit(event) {\n    event.preventDefault();\n\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.document.items.get(itemId);\n\n    new Dialog({\n      title: game.i18n.format(\"FFD20.Dialog.SplitItem.Title\", { 0: item.name }),\n      content: `<p>${game.i18n.format(\"FFD20.Dialog.SplitItem.Desc\")}</p><input type=\"text\" name=\"value\" value=\"1\" />`,\n      buttons: {\n        split: {\n          // icon: `<i class=\"fas fa-people-arrows></i>`,\n          label: game.i18n.localize(\"FFD20.Split\"),\n          callback: async (html) => {\n            let splitValue = parseInt(html.find(`[name=\"value\"]`).val());\n            splitValue = Math.min(item.system.quantity - 1, Math.max(0, splitValue));\n            if (splitValue > 0) {\n              await item.update({ \"system.quantity\": Math.max(0, item.system.quantity - splitValue) });\n              const data = item.toObject();\n              data.quantity = splitValue;\n              await CONFIG.Item.documentClass.createDocuments([data], { parent: this.document });\n            }\n          },\n        },\n      },\n      default: \"split\",\n    }).render(true);\n  }\n\n  _onSubmitElement(event) {\n    if (event.key === \"Enter\") {\n      const elem = event.currentTarget;\n      if (elem.name) {\n        const attr = getProperty(this.document.system, elem.name);\n        if (typeof attr === \"number\" && attr === parseFloat(elem.value)) {\n          this._onSubmit(event);\n        } else if (typeof attr === \"string\" && attr === elem.value) {\n          this._onSubmit(event);\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle rolling an Ability check, either a test or a saving throw\n   *\n   * @param {Event} event   The originating click event\n   * @private\n   */\n  _onRollAbilityTest(event) {\n    event.preventDefault();\n    const ability = event.currentTarget.closest(\".ability\").dataset.ability;\n    this.document.rollAbilityTest(ability, { skipDialog: getSkipActionPrompt() });\n  }\n\n  _onRollBAB(event) {\n    event.preventDefault();\n    this.document.rollBAB({ skipDialog: getSkipActionPrompt() });\n  }\n\n  _onRollMelee(event) {\n    event.preventDefault();\n    this.document.rollAttack({ melee: true, skipDialog: getSkipActionPrompt() });\n  }\n\n  _onRollRanged(event) {\n    event.preventDefault();\n    this.document.rollAttack({ melee: false, skipDialog: getSkipActionPrompt() });\n  }\n\n  _onRollCMB(event) {\n    event.preventDefault();\n    this.document.rollCMB({ skipDialog: getSkipActionPrompt() });\n  }\n\n  _onRollInitiative(event) {\n    event.preventDefault();\n    this.document.rollInitiative({\n      createCombatants: true,\n      rerollInitiative: game.user.isGM,\n      skipDialog: getSkipActionPrompt(),\n    });\n  }\n\n  _onRollSavingThrow(event) {\n    event.preventDefault();\n    const savingThrow = event.currentTarget.parentElement.dataset.savingthrow;\n    this.document.rollSavingThrow(savingThrow, { skipDialog: getSkipActionPrompt() });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Organize and classify Owned Items\n   *\n   * @param data\n   * @private\n   */\n  _prepareItems(data) {\n    // Categorize items as inventory, spellbook, features, and classes\n    const inventory = {\n      weapon: {\n        label: game.i18n.localize(\"FFD20.InventoryWeapons\"),\n        canCreate: true,\n        hasActions: true,\n        items: [],\n        canEquip: true,\n        dataset: { type: \"weapon\" },\n      },\n      equipment: {\n        label: game.i18n.localize(\"FFD20.InventoryArmorEquipment\"),\n        canCreate: true,\n        hasActions: true,\n        items: [],\n        canEquip: true,\n        dataset: { type: \"equipment\" },\n        hasSlots: true,\n      },\n      consumable: {\n        label: game.i18n.localize(\"FFD20.InventoryConsumables\"),\n        canCreate: true,\n        hasActions: true,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"consumable\" },\n      },\n      gear: {\n        label: CONFIG.FFD20.lootTypes[\"gear\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: true,\n        dataset: { type: \"loot\", \"type-name\": game.i18n.localize(\"FFD20.LootTypeGearSingle\"), \"sub-type\": \"gear\" },\n      },\n      ammo: {\n        label: CONFIG.FFD20.lootTypes[\"ammo\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"loot\", \"type-name\": game.i18n.localize(\"FFD20.LootTypeAmmoSingle\"), \"sub-type\": \"ammo\" },\n      },\n      misc: {\n        label: CONFIG.FFD20.lootTypes[\"misc\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"loot\", \"type-name\": game.i18n.localize(\"FFD20.Misc\"), \"sub-type\": \"misc\" },\n      },\n      tradeGoods: {\n        label: CONFIG.FFD20.lootTypes[\"tradeGoods\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: false,\n        dataset: {\n          type: \"loot\",\n          \"type-name\": game.i18n.localize(\"FFD20.LootTypeTradeGoodsSingle\"),\n          \"sub-type\": \"tradeGoods\",\n        },\n      },\n      container: {\n        label: game.i18n.localize(\"FFD20.InventoryContainers\"),\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        dataset: { type: \"container\" },\n      },\n    };\n\n    // Partition items by category\n    let [items, spells, feats, classes, attacks] = data.items.reduce(\n      (arr, item) => {\n        const document = item.document;\n        item.img = item.img || CONST.DEFAULT_TOKEN;\n        item.isStack = item.quantity ? item.quantity > 1 : false;\n        item.hasUses = item.uses && item.uses.max > 0;\n        item.isCharged = [\"day\", \"week\", \"charges\"].includes(item.uses?.per);\n        if (document) item.price = document.getValue({ recursive: false, sellValue: 1 });\n        else item.price = item.identified === false ? item.unidentified.price : item.price;\n\n        const itemQuantity = item.quantity != null ? item.quantity : 1;\n        const itemCharges = item.uses?.value != null ? item.uses.value : 1;\n        item.empty = itemQuantity <= 0 || (item.isCharged && itemCharges <= 0);\n        if (item.type === \"spell\") arr[1].push(item);\n        else if (item.type === \"feat\") arr[2].push(item);\n        else if (item.type === \"class\") arr[3].push(item);\n        else if (item.type === \"attack\") arr[4].push(item);\n        else if (ItemFFD20.isInventoryItem(item.type)) arr[0].push(item);\n        return arr;\n      },\n      [[], [], [], [], []]\n    );\n\n    // Apply active item filters\n    items = this._filterItems(items, this._filters.inventory, this._filters.search.inventory);\n    feats = this._filterItems(feats, this._filters.features);\n\n    // Organize Spellbook\n    const spellbookData = {};\n    const spellbooks = data.system.attributes.spells.spellbooks;\n    for (const [key, spellbook] of Object.entries(spellbooks)) {\n      let spellbookSpells = spells.filter((obj) => obj.spellbook === key);\n      spellbookSpells = this._filterItems(spellbookSpells, this._filters[`spellbook-${key}`]);\n      spellbookData[key] = {\n        data: this._prepareSpellbook(data, spellbookSpells, key),\n        prepared: spellbookSpells.filter((obj) => {\n          return obj.preparation.mode === \"prepared\" && obj.preparation.prepared;\n        }).length,\n        orig: spellbook,\n      };\n    }\n\n    // Organize Inventory\n    let usystem = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n    if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n\n    for (const i of items) {\n      const subType = i.type === \"loot\" ? i.subType || \"gear\" : i.subType;\n      i.quantity = i.quantity || 0;\n      i.totalWeight = Math.roundDecimals(i.weight.converted.total, 1);\n      i.units = usystem === \"metric\" ? game.i18n.localize(\"FFD20.Kgs\") : game.i18n.localize(\"FFD20.Lbs\");\n      if (inventory[i.type] != null) inventory[i.type].items.push(i);\n      if (subType != null && inventory[subType] != null) inventory[subType].items.push(i);\n    }\n\n    // Organize Features\n    const features = {};\n    const featureDefaults = { items: [], canCreate: true, hasActions: true };\n    const featData = this.constructor.featTypeData;\n    for (const [featKey, featValue] of Object.entries(FFD20.featTypes)) {\n      // Merge type specific data into common data template\n      features[featKey] = mergeObject(\n        featureDefaults,\n        {\n          // Fist generic data derived from the config object\n          label: FFD20.featTypesPlurals[featKey] ?? featValue,\n          dataset: { type: \"feat\", \"type-name\": game.i18n.localize(featValue), \"feat-type\": featKey },\n          // Then any specific data explicitly set to override defaults\n          ...featData[featKey],\n        },\n        { inplace: false }\n      );\n    }\n\n    for (const f of feats) {\n      const k = f.featType;\n      if (f.abilityType && f.abilityType !== \"none\") {\n        f.abilityTypeShort = CONFIG.FFD20.abilityTypes[f.abilityType].short;\n        f.abilityType = CONFIG.FFD20.abilityTypes[f.abilityType].long;\n      } else {\n        f.abilityTypeShort = \"\";\n        f.abilityType = \"\";\n      }\n      features[k]?.items?.push(f);\n    }\n    classes.sort((a, b) => b.level - a.level);\n    classes.forEach((item) => {\n      if (item.classType !== \"mythic\") item.canLevelUp = true;\n    });\n\n    // Buffs\n    let buffs = data.items.filter((obj) => {\n      return obj.type === \"buff\";\n    });\n    buffs = this._filterItems(buffs, this._filters.buffs);\n    const buffSections = {\n      temp: {\n        label: game.i18n.localize(\"FFD20.Temporary\"),\n        items: [],\n        hasActions: false,\n        dataset: { type: \"buff\", \"buff-type\": \"temp\" },\n      },\n      perm: {\n        label: game.i18n.localize(\"FFD20.Permanent\"),\n        items: [],\n        hasActions: false,\n        dataset: { type: \"buff\", \"buff-type\": \"perm\" },\n      },\n      item: {\n        label: game.i18n.localize(\"FFD20.Item\"),\n        items: [],\n        hasActions: false,\n        dataset: { type: \"buff\", \"buff-type\": \"item\" },\n      },\n      misc: {\n        label: game.i18n.localize(\"FFD20.Misc\"),\n        items: [],\n        hasActions: false,\n        dataset: { type: \"buff\", \"buff-type\": \"misc\" },\n      },\n    };\n\n    for (const b of buffs) {\n      const s = b.buffType;\n      if (!buffSections[s]) continue;\n      buffSections[s].items.push(b);\n    }\n\n    // Attacks\n    attacks = this._filterItems(attacks, this._filters.attacks);\n    const attackSections = {\n      weapon: {\n        label: game.i18n.localize(\"FFD20.AttackTypeWeaponPlural\"),\n        items: [],\n        canCreate: true,\n        initial: false,\n        showTypes: false,\n        dataset: { type: \"attack\", \"attack-type\": \"weapon\" },\n      },\n      natural: {\n        label: game.i18n.localize(\"FFD20.AttackTypeNaturalPlural\"),\n        items: [],\n        canCreate: true,\n        initial: false,\n        showTypes: false,\n        dataset: { type: \"attack\", \"attack-type\": \"natural\" },\n      },\n      ability: {\n        label: game.i18n.localize(\"FFD20.AttackTypeAbilityPlural\"),\n        items: [],\n        canCreate: true,\n        initial: false,\n        showTypes: false,\n        dataset: { type: \"attack\", \"attack-type\": \"ability\" },\n      },\n      racialAbility: {\n        label: game.i18n.localize(\"FFD20.AttackTypeRacialPlural\"),\n        items: [],\n        canCreate: true,\n        initial: false,\n        showTypes: false,\n        dataset: { type: \"attack\", \"attack-type\": \"racialAbility\" },\n      },\n      item: {\n        label: game.i18n.localize(\"FFD20.Items\"),\n        items: [],\n        canCreate: true,\n        initial: false,\n        showTypes: false,\n        dataset: { type: \"attack\", \"attack-type\": \"item\" },\n      },\n      misc: {\n        label: game.i18n.localize(\"FFD20.Misc\"),\n        items: [],\n        canCreate: true,\n        initial: false,\n        showTypes: false,\n        dataset: { type: \"attack\", \"attack-type\": \"misc\" },\n      },\n    };\n\n    for (const a of attacks) {\n      const s = a.attackType;\n      if (!attackSections[s]) continue;\n      attackSections[s].items.push(a);\n    }\n\n    // Apply type filters\n    {\n      const sections = [\n        { key: \"inventory\", section: inventory },\n        { key: \"features\", section: features },\n        { key: \"buffs\", section: buffSections },\n        { key: \"attacks\", section: attackSections },\n      ];\n      for (const [k, sb] of Object.entries(spellbookData)) {\n        sections.push({ key: `spellbook-${k}`, section: sb.data });\n      }\n\n      for (const section of sections) {\n        for (const [k, s] of Object.entries(section.section)) {\n          const typeFilterCount = this._typeFilterCount(this._filters[section.key]);\n          if (typeFilterCount > 0 && s.items.length === 0) {\n            s._hidden = true;\n          }\n          if (typeFilterCount === 1 && this._filters[section.key].has(`type-${k}`)) {\n            s._hidden = false;\n          }\n        }\n      }\n    }\n\n    // Assign and return\n    data.inventory = inventory;\n    data.spellbookData = spellbookData;\n    data.features = features;\n    data.buffs = buffSections;\n    data.attacks = attackSections;\n    data.classes = classes;\n    data.quickActions = this.document.getQuickActions();\n  }\n\n  /**\n   * Handle rolling a Skill check\n   *\n   * @param {Event} event   The originating click event\n   * @private\n   */\n  _onRollSkillCheck(event) {\n    event.preventDefault();\n    const skill = event.currentTarget.parentElement.dataset.skill;\n    this.document.rollSkill(skill, { skipDialog: getSkipActionPrompt() });\n  }\n\n  _onRollSubSkillCheck(event) {\n    event.preventDefault();\n    const mainSkill = event.currentTarget.parentElement.dataset.mainSkill;\n    const skill = event.currentTarget.parentElement.dataset.skill;\n    this.document.rollSkill(`${mainSkill}.subSkills.${skill}`, { skipDialog: getSkipActionPrompt() });\n  }\n\n  /**\n   * Handle opening a skill's compendium entry\n   *\n   * @param {Event} event   The originating click event\n   * @private\n   */\n  async _onOpenCompendiumEntry(event) {\n    const uuid = event.currentTarget.dataset.compendiumEntry;\n    const document = await fromUuid(uuid);\n\n    // Open document\n    if (document instanceof JournalEntryPage) {\n      document.parent.sheet.render(true, { pageId: document.id });\n    } else {\n      document.sheet.render(true);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle toggling of filters to display a different set of owned items\n   *\n   * @param {Event} event     The click event which triggered the toggle\n   * @private\n   */\n  _onToggleFilter(event) {\n    event.preventDefault();\n\n    const li = event.currentTarget;\n    const set = this._filters[li.parentElement.dataset.filter];\n    const filter = li.dataset.filter;\n    const typeFilterCount = this._typeFilterCount(set);\n\n    const tabLikeFilters = game.settings.get(\"ffd20\", \"invertSectionFilterShiftBehaviour\")\n      ? !event.shiftKey\n      : event.shiftKey;\n    if (tabLikeFilters) {\n      for (const f of Array.from(set)) {\n        if (f.startsWith(\"type-\") && (f !== filter || typeFilterCount > 1)) {\n          set.delete(f);\n        }\n      }\n    }\n\n    if (set.has(filter)) set.delete(filter);\n    else set.add(filter);\n    this.render();\n  }\n\n  _searchFilterCommit(event) {\n    const actor = this.actor;\n    const search = this._filters.search[event.target.dataset.category].toLowerCase();\n    const category = event.target.dataset.category;\n\n    // TODO: Do not refresh if same search term, unless the sheet has updated.\n    if (this.effectiveSearch[category] === search && !this.searchRefresh) return;\n    this.effectiveSearch[category] = search;\n    this.searchRefresh = false;\n\n    const matchSearch = (name) => name.toLowerCase().includes(search); // MKAhvi: Bad method for i18n support.\n\n    $(event.target)\n      .closest(\".tab\")\n      .find(\".item-list .item\")\n      .each(function () {\n        const jq = $(this);\n        if (search?.length > 0) {\n          const item = actor.items.get(this.dataset.itemId);\n          if (matchSearch(item.name)) jq.show();\n          else jq.hide();\n        } else jq.show();\n      });\n  }\n\n  _clearSearch(event) {\n    const sb = $(event.target).prev(\".search-input\");\n    this._filters.search[sb.get(0).dataset.category] = \"\";\n    sb.val(\"\").change();\n  }\n\n  // IME related\n  _searchFilterCompositioning(event) {\n    this.searchCompositioning = event.type === \"compositionstart\";\n  }\n\n  _searchFilterChange(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Accept input only while not compositioning\n\n    const search = event.target.value;\n    const category = event.target.dataset.category;\n    const changed = this._filters.search[category] !== search;\n\n    if (this.searchCompositioning || changed) clearTimeout(this.searchDelayEvent); // reset\n    if (this.searchCompositioning) return;\n\n    //if (unchanged) return; // nothing changed\n    this._filters.search[category] = search;\n\n    if (event.type === \"keyup\") {\n      // Delay search\n      if (changed) this.searchDelayEvent = setTimeout(() => this._searchFilterCommit(event), this.searchDelay);\n    } else {\n      this._searchFilterCommit(event);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle spawning the ActorTraitSelector application which allows a checkbox of multiple trait options\n   *\n   * @param {Event} event   The click event which originated the selection\n   * @private\n   */\n  _onTraitSelector(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const label = a.parentElement.querySelector(\"label\");\n    const options = {\n      name: label.getAttribute(\"for\"),\n      title: label.innerText,\n      subject: a.dataset.options,\n      choices: CONFIG.FFD20[a.dataset.options],\n    };\n\n    const app = Object.values(this.document.apps).find((o) => {\n      return o instanceof ActorTraitSelector && o.options.name === options.name && o._element;\n    });\n    if (app) app.render(true, { focus: true });\n    else new ActorTraitSelector(this.document, options).render(true);\n  }\n\n  setItemUpdate(id, key, value) {\n    let obj = this._itemUpdates.filter((o) => {\n      return o._id === id;\n    })[0];\n    if (obj == null) {\n      obj = { _id: id };\n      this._itemUpdates.push(obj);\n    }\n\n    obj[key] = value;\n  }\n\n  async _render(...args) {\n    // Trick to avoid error on elements with changing name\n    let focus = this.element.find(\":focus\");\n    focus = focus.length ? focus[0] : null;\n    if (focus?.name?.match(/^system\\.skills\\.(?:[a-zA-Z0-9]*)\\.name$/)) focus.blur();\n\n    const result = await super._render(...args);\n\n    // Create placeholders\n    this._createPlaceholders(this.element);\n\n    // Apply accessibility settings\n    applyAccessibilitySettings(this, this.element, {}, game.settings.get(\"ffd20\", \"accessibilityConfig\"));\n\n    return result;\n  }\n\n  async _renderInner(...args) {\n    const html = await super._renderInner(...args);\n\n    // Re-open item summaries\n    for (const itemId of this._expandedItems) {\n      // Only display summaries of items that are still present\n      if (this.object.items.has(itemId)) {\n        const elem = html.find(`[data-item-id=\"${itemId}\"]`);\n        if (elem) this.openItemSummary(elem, { instant: true });\n      } else {\n        // Delete itemIds belonging to items no longer found in the actor\n        this._expandedItems.findSplice((o) => o === itemId);\n      }\n    }\n\n    return html;\n  }\n\n  async _onSubmit(event, { updateData = null, preventClose = false, preventRender = false } = {}) {\n    event.preventDefault();\n\n    this._submitQueued = false;\n\n    await super._onSubmit(event, { updateData, preventClose, preventRender });\n\n    // Update items\n    await this._updateItems();\n  }\n\n  async _updateItems() {\n    const promises = [];\n\n    const updates = this._itemUpdates;\n    this._itemUpdates = [];\n\n    // Memorize variables in document\n    for (const d of updates) {\n      const item = this.document.items.get(d._id);\n      if (!item) {\n        console.error(\"Item update for non-existing item:\", d._id, d);\n        continue;\n      }\n      item.memorizeVariables();\n      delete d._id;\n      await item.update(d);\n    }\n  }\n\n  async _onDropCurrency(event, data) {\n    const sourceActor = data.tokenId ? game.actors.tokens[data.tokenId] : data.actorId,\n      dataType = \"currency\";\n    return new CurrencyTransfer(\n      { actor: sourceActor, container: data.containerId, alt: data.alt },\n      { actor: this.actor, amount: Object.fromEntries([[data.currency, parseInt(data.amount)]]) }\n    ).render(true);\n  }\n\n  /**\n   * @override\n   */\n  async _onDropItem(event, data) {\n    if (!this.actor.isOwner) return false;\n\n    const item = await ItemFFD20.implementation.fromDropData(data);\n    const itemData = item.toObject();\n\n    // Handle item sorting within the same actor\n    const sameActor = item.parent?.uuid === this.actor.uuid && !data.containerId;\n    if (sameActor) return this._onSortItem(event, itemData);\n\n    // Remove from container\n    if (data.containerId) {\n      const container = this.actor.allItems.find((o) => o.id === data.containerId);\n\n      if (container) container.deleteContainerContent(itemData._id);\n    }\n\n    // Create the owned item\n    this._alterDropItemData(itemData);\n    return this._onDropItemCreate(itemData);\n  }\n\n  _alterDropItemData(data) {\n    if (data.type === \"spell\") {\n      data.system.spellbook = this.currentSpellbookKey;\n    }\n  }\n\n  /**\n   * @override\n   */\n  _getSortSiblings(source) {\n    return this.document.items.filter((i) => {\n      if (ItemFFD20.isInventoryItem(source.data.type)) return ItemFFD20.isInventoryItem(i.data.type);\n      return i.data.type === source.data.type && i.data.id !== source.data.id;\n    });\n  }\n\n  async _onDropItemCreate(itemData) {\n    // Import spell as consumable\n    if (itemData.type === \"spell\" && this.currentPrimaryTab !== \"spellbook\") {\n      const resultData = await createConsumableSpellDialog(itemData);\n      if (resultData === \"spell\") {\n        // No action here.\n      } else if (resultData) return this.document.createEmbeddedDocuments(\"Item\", [resultData]);\n      else return false;\n    }\n    // Choose how to import class\n    if (\n      itemData.type === \"class\" &&\n      getProperty(itemData, \"system.classType\") !== \"mythic\" &&\n      !(event && event.shiftKey)\n    ) {\n      const doReturn = await new Promise((resolve) => {\n        new Dialog(\n          {\n            title: game.i18n.localize(\"FFD20.AddClass\"),\n            content: `<div class=\"ffd20\"><p>${game.i18n.localize(\n              \"FFD20.Info.AddClassDialog_Desc\"\n            )}</p><div class=\"help-text\"><i class=\"fas fa-info-circle\"></i> ${game.i18n.localize(\n              \"FFD20.Info.AddClassDialog\"\n            )}</div></div>`,\n            buttons: {\n              normal: {\n                icon: '<i class=\"fas fa-hat-wizard\"></i>',\n                label: game.i18n.localize(\"FFD20.Normal\"),\n                callback: () => {\n                  LevelUpForm.addClassWizard(this.actor, itemData).then(() => {\n                    resolve(true);\n                  });\n                },\n              },\n              raw: {\n                icon: '<i class=\"fas fa-file\"></i>',\n                label: game.i18n.localize(\"FFD20.Raw\"),\n                callback: () => {\n                  resolve(false);\n                },\n              },\n            },\n            close: () => {\n              resolve(true);\n            },\n          },\n          {\n            classes: [\"dialog\", \"ffd20\", \"add-character-class\"],\n          }\n        ).render(true);\n      });\n      if (doReturn) return false;\n    }\n\n    if (itemData.id) delete itemData.id;\n    const actorRef = this.document;\n    return this.document.createEmbeddedDocuments(\"Item\", [itemData]).then((createdItem) => {\n      const fullItem = actorRef.items.get(createdItem.id);\n      return fullItem;\n    });\n  }\n\n  _onDragStart(event) {\n    const elem = event.target;\n    if (elem.classList.contains(\"denomination\")) {\n      if (this.actor.permission < 3) return;\n      const dragData = {\n        actorId: this.actor.id,\n        sceneId: this.actor.isToken ? canvas.scene?.id : null,\n        tokenId: this.actor.isToken ? this.actor.token.id : null,\n        type: \"Currency\",\n        alt: elem.classList.contains(\"alt-currency\"),\n        currency: [...elem.classList].find((o) => /[pgsc]p/.test(o)),\n        amount: parseInt(elem.nextElementSibling.textContent || elem.nextElementSibling.value),\n      };\n      event.dataTransfer.setData(\"text/plain\", JSON.stringify(dragData));\n    } else if (elem.dataset?.skill) {\n      this._onDragSkillStart(event);\n    } else if (elem.dataset?.attribute) {\n      this._onDragMiscStart(event, elem.dataset.attribute);\n    } else if (elem.dataset?.drag) {\n      this._onDragMiscStart(event, elem.dataset.drag);\n    } else if (elem.dataset?.savingthrow) {\n      this._onDragSaveStart(event, elem.dataset.savingthrow);\n    } else super._onDragStart(event);\n  }\n\n  async _onConfigControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const f = $(a).attr(\"for\");\n    const html = this.element;\n\n    $(a).css(\"display\", \"none\");\n\n    // Show CR field\n    if (f === \"cr\") {\n      const elem = html.find('input[for=\"system.details.cr\"]');\n      elem.attr(\"value\", CR.fromNumber(this.document.system.details.cr.base));\n      elem.attr(\"name\", \"system.details.cr.base\");\n      elem.prop(\"disabled\", false);\n      elem.focus();\n      elem.select();\n    }\n\n    // Show base Spell Slots field\n    else if (f === \"spellSlots\") {\n      const elem = $(a).closest(\".spell-uses\").find(\".base\");\n      elem.css(\"display\", \"block\");\n      elem.focus();\n      elem.select();\n    }\n  }\n\n  _selectOnClick(event) {\n    event.preventDefault();\n    const el = event.currentTarget;\n    el.select();\n  }\n\n  _updateObject(event, formData) {\n    // Translate CR\n    const cr = formData[\"system.details.cr.base\"];\n    if (typeof cr === \"string\") formData[\"system.details.cr.base\"] = CR.fromString(cr);\n\n    // Update from elements with 'data-name'\n    {\n      const elems = this.element.find(\"*[data-name]\");\n      const changedData = {};\n      for (const el of elems) {\n        const name = el.dataset.name;\n        let value;\n        if (el.nodeName === \"INPUT\") value = el.value;\n        else if (el.nodeName === \"SELECT\") value = el.options[el.selectedIndex].value;\n\n        if (el.dataset.dtype === \"Number\") value = Number(value);\n        else if (el.dataset.dtype === \"Boolean\") value = Boolean(value);\n\n        if (getProperty(this.document.system, name) !== value) {\n          changedData[name] = value;\n        }\n      }\n\n      for (const [k, v] of Object.entries(changedData)) {\n        formData[k] = v;\n      }\n    }\n\n    // Add pending updates\n    for (const [k, v] of Object.entries(this._pendingUpdates)) {\n      formData[k] = v;\n    }\n    this._pendingUpdates = {};\n\n    this.searchRefresh = true;\n\n    return super._updateObject(event, formData);\n  }\n\n  calculateTotalItemValue({ inLowestDenomination = false } = {}) {\n    const items = this.document.items.filter((o) => o.system.price != null);\n    const total = items.reduce((cur, i) => {\n      return cur + i.getValue({ sellValue: 1, inLowestDenomination: true });\n    }, 0);\n    return inLowestDenomination ? total : total / 100;\n  }\n\n  calculateSellItemValue({ inLowestDenomination = false } = {}) {\n    const items = this.document.items.filter((o) => o.system.price != null);\n    const sellMultiplier = this.document.getFlag(\"ffd20\", \"sellMultiplier\") || 0.5;\n    const total = items.reduce((cur, i) => {\n      return cur + i.getValue({ sellValue: sellMultiplier, inLowestDenomination: true });\n    }, 0);\n    return inLowestDenomination ? total : total / 100;\n  }\n\n  _createPlaceholders(html) {\n    const elems = html.find(\"span[data-placeholder]\");\n    for (const el of elems) {\n      if (!el.innerText) {\n        el.classList.add(\"placeholder\");\n        el.innerText = el.dataset.placeholder;\n      }\n    }\n  }\n}\n","import { ActorSheetFFD20 } from \"./actor-sheet.mjs\";\nimport { LevelUpForm } from \"../level-up.mjs\";\n\n/**\n * An Actor sheet for player character type actors in the FFD20 system.\n * Extends the base ActorSheetFFD20 class.\n *\n * @type {ActorSheetFFD20}\n */\nexport class ActorSheetFFD20Character extends ActorSheetFFD20 {\n  /**\n   * Define default rendering options for the NPC sheet\n   *\n   * @returns {object}\n   */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"sheet\", \"actor\", \"character\"],\n      width: 800,\n      height: 840,\n    });\n  }\n\n  /* -------------------------------------------- */\n  /*  Rendering                                   */\n  /* -------------------------------------------- */\n\n  /**\n   * Get the correct HTML template path to use for rendering this particular sheet\n   *\n   * @type {string}\n   */\n  get template() {\n    if (!game.user.isGM && this.actor.limited) return \"systems/ffd20/templates/actors/limited-sheet.hbs\";\n    return \"systems/ffd20/templates/actors/character-sheet.hbs\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add some extra data when rendering the sheet to reduce the amount of logic required within the template.\n   */\n  async getData() {\n    const data = await super.getData();\n    const xpSettings = game.settings.get(\"ffd20\", \"experienceConfig\");\n\n    // Experience Tracking\n    data.disableExperience = xpSettings.disableExperienceTracking;\n    data.minimumExperience = this.actor.getLevelExp(Math.max(0, (this.actor.system.details.level.value ?? 0) - 1));\n\n    data.hasClasses = this.actor.items.filter((o) => o.type === \"class\").length > 0;\n\n    const hpSettings = game.settings.get(\"ffd20\", \"healthConfig\");\n    data.woundThresholds = hpSettings.variants.pc;\n\n    // BAB iteratives\n    const iteratives = game.settings.get(\"ffd20\", \"displayIteratives\");\n    const bab = data.rollData.attributes.bab.total;\n    if (iteratives) {\n      const iters = [bab];\n      for (let i = bab - 5; i > 0; i -= 5) iters.push(i);\n      data.iteratives = `+${iters.join(\" / +\")}`;\n    }\n\n    // Add level up buttons to classes\n    if (\n      this.actor.type === \"character\" &&\n      game.settings.get(\"ffd20\", \"experienceConfig\").disableExperienceTracking !== true &&\n      data.hasClasses\n    ) {\n      const xp = getProperty(this.actor, \"system.details.xp\");\n      if (xp && xp.value >= xp.max) {\n        data.levelUp = true;\n      }\n    } else {\n      data.levelUp = true;\n    }\n\n    // Return data for rendering\n    return data;\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers\n  /* -------------------------------------------- */\n\n  /**\n   * Activate event listeners using the prepared sheet HTML\n   *\n   * @param html {HTML}   The prepared HTML object ready to be rendered into the DOM\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    if (!this.options.editable) return;\n\n    // Inventory Functions\n    html.find(\".currency-convert\").click(this._onConvertCurrency.bind(this));\n\n    // Spell Preparation\n    html.find(\".toggle-prepared\").click(this._onPrepareItem.bind(this));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle toggling the prepared status of an Owned Item within the Actor\n   *\n   * @param {Event} event   The triggering click event\n   * @private\n   */\n  _onPrepareItem(event) {\n    event.preventDefault();\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.actor.items.get(itemId);\n    return item.update({ \"data.preparation.prepared\": !item.data.preparation.prepared });\n  }\n\n  _onLevelUp(event) {\n    event.preventDefault;\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.actor.items.get(itemId);\n\n    const app = Object.values(this.actor.apps).find((o) => {\n      return o instanceof LevelUpForm && o._element;\n    });\n    if (app) app.render(true, { focus: true });\n    else new LevelUpForm(item).render(true);\n  }\n\n  /* -------------------------------------------- */\n\n  async _onConvertCurrency(event) {\n    event.preventDefault();\n    const curr = duplicate(this.actor.data.currency);\n    const convert = {\n      cgil: { into: \"sgil\", each: 10 },\n      sgil: { into: \"gil\", each: 10 },\n      gil: { into: \"pgil\", each: 10 },\n    };\n    for (const [c, t] of Object.entries(convert)) {\n      const change = Math.floor(curr[c] / t.each);\n      curr[c] -= change * t.each;\n      curr[t.into] += change;\n    }\n    return this.actor.update({ \"data.currency\": curr });\n  }\n}\n","import { ActorSheetFFD20 } from \"./actor-sheet.mjs\";\nimport { CR } from \"../../utils/lib.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\n\n/**\n * An Actor sheet for NPC type characters in the game system.\n * Extends the base ActorSheetFFD20 class.\n *\n * @type {ActorSheetFFD20}\n */\nexport class ActorSheetFFD20NPC extends ActorSheetFFD20 {\n  /**\n   * Define default rendering options for the NPC sheet\n   *\n   * @returns {object}\n   */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"sheet\", \"actor\", \"npc\"],\n      width: 800,\n      height: 840,\n    });\n  }\n\n  /* -------------------------------------------- */\n  /*  Rendering                                   */\n  /* -------------------------------------------- */\n\n  /**\n   * Get the correct HTML template path to use for rendering this particular sheet\n   *\n   * @type {string}\n   */\n  get template() {\n    if (!game.user.isGM && this.actor.limited) return \"systems/ffd20/templates/actors/limited-sheet.hbs\";\n    return \"systems/ffd20/templates/actors/npc-sheet.hbs\";\n  }\n\n  // static get name() {\n  //   return game.i18n.localize(\"FFD20.ActorSheetFFD20NPC\");\n  // }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add some extra data when rendering the sheet to reduce the amount of logic required within the template.\n   */\n  async getData() {\n    const data = await super.getData();\n\n    // Challenge Rating\n    try {\n      data.labels.cr = CR.fromNumber(getProperty(this.actor, \"system.details.cr.total\"));\n    } catch (e) {\n      try {\n        data.labels.cr = CR.fromNumber(getProperty(this.actor, \"system.details.cr\"));\n      } catch (e) {\n        data.labels.cr = CR.fromNumber(1);\n      }\n    }\n\n    const hpSettings = game.settings.get(\"ffd20\", \"healthConfig\");\n    data[\"woundThresholds\"] = hpSettings.variants.npc;\n\n    data.levelUp = true;\n\n    return data;\n  }\n\n  /* -------------------------------------------- */\n  /*  Object Updates                              */\n  /* -------------------------------------------- */\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /**\n   * Activate event listeners using the prepared sheet HTML\n   *\n   * @param html {HTML}   The prepared HTML object ready to be rendered into the DOM\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // Adjust CR\n    html.find(\"span.text-box.cr-input\").on(\"click\", (event) => {\n      this._onSpanTextInput(event, this._adjustCR.bind(this));\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  _adjustCR(event) {\n    event.preventDefault();\n    const el = event.currentTarget;\n\n    const value = CR.fromString(el.tagName.toUpperCase() === \"INPUT\" ? el.value : el.innerText);\n    const name = el.getAttribute(\"name\");\n    if (name) {\n      this._pendingUpdates[name] = value;\n    }\n\n    // Update on lose focus\n    if (event.originalEvent instanceof MouseEvent) {\n      if (!this._submitQueued) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._onSubmit(event);\n        });\n      }\n    } else this._onSubmit(event);\n  }\n}\n","import { ActorSheetFFD20NPC } from \"./npc-sheet.mjs\";\n\nexport class ActorSheetFFD20NPCLite extends ActorSheetFFD20NPC {\n  /**\n   * Define default rendering options for the NPC sheet\n   *\n   * @returns {object}\n   */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"sheet\", \"actor\", \"npc\", \"lite\"],\n      width: 440,\n      height: 640,\n      tabs: [{ navSelector: \"nav.tabs\", contentSelector: \"section.primary-body\", initial: \"summary\" }],\n    });\n  }\n\n  get template() {\n    if (!game.user.isGM && this.actor.limited) return \"systems/ffd20/templates/actors/limited-sheet.hbs\";\n    return \"systems/ffd20/templates/actors/npc-sheet-lite.hbs\";\n  }\n\n  _prepareItems(data) {\n    const [attacks] = data.items.reduce(\n      (arr, item) => {\n        item.img = item.img || foundry.data.ItemData.DEFAULT_ICON;\n        item.hasUses = item.uses && item.uses.max > 0;\n        item.isCharged = [\"day\", \"week\", \"charges\"].includes(getProperty(item, \"uses.per\"));\n\n        const itemCharges = getProperty(item, \"uses.value\") != null ? getProperty(item, \"uses.value\") : 1;\n\n        if (item.type === \"attack\") arr[0].push(item);\n        return arr;\n      },\n      [[]]\n    );\n\n    const attackSections = {\n      all: {\n        label: game.i18n.localize(\"FFD20.ActionPlural\"),\n        items: [],\n        canCreate: true,\n        initial: true,\n        showTypes: true,\n        dataset: { type: \"attack\", \"attack-type\": \"weapon\" },\n      },\n    };\n\n    for (const a of attacks) {\n      attackSections.all.items.push(a);\n    }\n\n    data.attacks = attackSections;\n  }\n}\n","import { ActorSheetFFD20NPC } from \"./npc-sheet.mjs\";\nimport { splitCurrency } from \"../../utils/lib.mjs\";\n\nexport class ActorSheetFFD20NPCLoot extends ActorSheetFFD20NPC {\n  /**\n   * Define default rendering options for the NPC sheet\n   *\n   * @returns {object}\n   */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"sheet\", \"actor\", \"npc\", \"loot\"],\n      tabs: [{ navSelector: \"nav.tabs\", contentSelector: \"section.primary-body\", initial: \"inventory\" }],\n      width: 620,\n      height: 420,\n    });\n  }\n\n  get template() {\n    return \"systems/ffd20/templates/actors/npc-sheet-loot.hbs\";\n  }\n\n  get currentPrimaryTab() {\n    return \"inventory\";\n  }\n\n  async getData() {\n    const data = await super.getData();\n\n    data.isLootSheet = true;\n    data.sellMultiplier = this.actor.getFlag(\"ffd20\", \"sellMultiplier\");\n\n    // Get total value\n    const cgilValue =\n      this.calculateTotalItemValue({ inLowestDenomination: true }) +\n      this.actor.mergeCurrency({ inLowestDenomination: true });\n    const cgilSellValue =\n      this.calculateSellItemValue({ inLowestDenomination: true }) +\n      this.actor.mergeCurrency({ inLowestDenomination: true });\n\n    data.totalValue = splitCurrency(cgilValue);\n    data.sellValue = splitCurrency(cgilSellValue);\n\n    // Set labels\n    if (!data.labels) data.labels = {};\n    data.labels.totalValue = game.i18n\n      .localize(\"FFD20.ItemContainerTotalValue\")\n      .format(data.totalValue.gil, data.totalValue.sgil, data.totalValue.cgil);\n    data.labels.sellValue = game.i18n\n      .localize(\"FFD20.ItemContainerSellValue\")\n      .format(data.sellValue.gil, data.sellValue.sgil, data.sellValue.cgil);\n\n    // Alter inventory columns\n    for (const inv of Object.values(data.inventory)) {\n      inv.hasActions = false;\n      inv.canEquip = false;\n      inv.showValue = true;\n    }\n\n    return data;\n  }\n}\n","/**\n * Default dead sheet when no other exist.\n */\nexport class ActorSheetFFD20Basic extends ActorSheet {}\n","export class ActorSheetFlags extends DocumentSheet {\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    return mergeObject(options, {\n      id: \"actor-flags\",\n      classes: [\"ffd20\"],\n      template: \"systems/ffd20/templates/apps/actor-flags.hbs\",\n      width: 500,\n      closeOnSubmit: true,\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Configure the title of the special traits selection window to include the Actor name\n   *\n   * @type {string}\n   */\n  get title() {\n    return `${game.i18n.localize(\"FFD20.FlagsTitle\")}: ${this.object.name}`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare data used to render the special Actor traits selection UI\n   *\n   * @returns {object}\n   */\n  getData() {\n    const data = super.getData();\n    data.flags = this._getFlags();\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare an object of flags data which groups flags by section\n   * Add some additional data for rendering\n   *\n   * @returns {object}\n   */\n  _getFlags() {\n    const flags = {};\n    for (const [k, v] of Object.entries(CONFIG.FFD20.characterFlags)) {\n      if (!Object.prototype.hasOwnProperty.call(flags, v.section)) flags[v.section] = {};\n      const flag = duplicate(v);\n      flag.type = v.type.name;\n      flag.isCheckbox = v.type === Boolean;\n      flag.isSelect = Object.prototype.hasOwnProperty.call(v, \"choices\");\n      flag.value = this.document.getFlag(\"FFD20\", k);\n      flags[v.section][k] = flag;\n    }\n    return flags;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update the Actor using the configured flags\n   * Remove/unset any flags which are no longer configured\n   *\n   * @param event\n   * @param formData\n   */\n  _updateObject(event, formData) {\n    const actor = this.object;\n\n    // Iterate over the flags which may be configured\n    const updateData = {};\n    for (const [k, v] of Object.entries(CONFIG.ffd20.characterFlags)) {\n      if ([undefined, null, \"\", false].includes(formData[k])) updateData[`-=${k}`] = null;\n      else if (v.type === Number && formData[k] === 0) updateData[`-=${k}`] = null;\n      else updateData[k] = formData[k];\n    }\n\n    // Set the new flags in bulk\n    actor.update({ \"flags.ffd20\": updateData });\n  }\n}\n","export class SensesSelector extends DocumentSheet {\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    return mergeObject(options, {\n      classes: [\"ffd20\", \"senses-selector\"],\n      template: \"systems/ffd20/templates/apps/senses-selector.hbs\",\n      width: 500,\n      closeOnSubmit: true,\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Configure the title of the special traits selection window to include the Actor name\n   *\n   * @type {string}\n   */\n  get title() {\n    return `${game.i18n.localize(\"FFD20.Senses\")}: ${this.object.name}`;\n  }\n\n  /**\n   * Returns which keys to convert in distance or weight\n   */\n  get convertKeys() {\n    return {\n      \"system.traits.senses.dv\": \"distance\",\n      \"system.traits.senses.ts\": \"distance\",\n      \"system.traits.senses.bse\": \"distance\",\n      \"system.traits.senses.bs\": \"distance\",\n    };\n  }\n\n  async getData() {\n    const data = {\n      system: this.document.system,\n      converted: Object.entries(this.convertKeys).reduce((cur, o) => {\n        if (o[1] === \"distance\") setProperty(cur, o[0], ffd20.utils.convertDistance(getProperty(this.document, o[0]))[0]);\n        return cur;\n      }, {}),\n      gridUnits: game.settings.get(\"ffd20\", \"units\") === \"imperial\" ? \"ft\" : \"m\",\n    };\n    return data;\n  }\n\n  async _updateObject(event, formData) {\n    // Convert data back\n    Object.entries(this.convertKeys).forEach((o) => {\n      if (o[1] === \"distance\") formData[o[0]] = ffd20.utils.convertDistanceBack(formData[o[0]])[0];\n    });\n\n    // Update document\n    const result = await super._updateObject(event, formData);\n\n    // Refresh canvas perception\n    canvas.perception.update(\n      {\n        initializeLighting: true,\n        initializeVision: true,\n      },\n      true\n    );\n    game.socket.emit(\"system.ffd20\", { eventType: \"redrawCanvas\" });\n\n    return result;\n  }\n}\n","import { createTag } from \"../utils/lib.mjs\";\n\nexport class SkillEditor extends FormApplication {\n  constructor(actor, skillId, subSkillId, options = {}) {\n    super(actor, options);\n    this.skillId = skillId;\n    this.subSkillId = subSkillId;\n\n    this._callbacks = [];\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      width: 380,\n      template: \"systems/ffd20/templates/apps/skill-editor.hbs\",\n      closeOnSubmit: false,\n      dragDrop: [{ dragSelector: null, dropSelector: \"*\" }],\n    });\n  }\n  get title() {\n    return `${game.i18n.localize(\"FFD20.EditSkill\")}: ${this.skillName}`;\n  }\n\n  get actor() {\n    return this.object;\n  }\n\n  get isSubSkill() {\n    return this.subSkillId != null;\n  }\n  get isStaticSkill() {\n    return CONFIG.FFD20.skills[this.skillId] != null && !this.isSubSkill;\n  }\n\n  get skill() {\n    if (this.isSubSkill) return this.actor.system.skills[this.skillId]?.subSkills[this.subSkillId];\n    return this.actor.system.skills[this.skillId];\n  }\n  get skillName() {\n    return this.isStaticSkill ? CONFIG.FFD20.skills[this.skillId] : this.skill.name;\n  }\n  get skillTag() {\n    if (this.isStaticSkill) return this.skillId;\n    return this.isSubSkill ? this.subSkillId : this.skillId;\n  }\n\n  async getData(options) {\n    const data = await super.getData(options);\n\n    // Configuration\n    data.config = CONFIG.FFD20;\n\n    // Skill data\n    data.skill = mergeObject(\n      this.skill,\n      {\n        skillId: this.skillId,\n        subSkillId: this.subSkillId,\n        isSubSkill: this.isSubSkill,\n        name: this.skillName,\n        static: this.isStaticSkill,\n        tag: this.skillTag,\n      },\n      { inplace: false }\n    );\n\n    // Actor data\n    data.actorData = this.actor.toObject();\n\n    // Referenced documents\n    try {\n      const document = await fromUuid(data.skill.journal);\n      data.journal = document.toObject();\n      data.journal.uuid = data.skill.journal;\n      data.journal.documentType = document instanceof JournalEntryPage ? \"JournalEntryPage\" : \"JournalEntry\";\n    } catch (err) {\n      data.journal = null;\n    }\n\n    return data;\n  }\n\n  addCallback(fn) {\n    this._callbacks.push(fn);\n  }\n\n  async _updateObject(event, formData) {\n    event.preventDefault();\n\n    // Relocate skill data to what would fit within the actor's data structure\n    const data = expandObject(formData);\n    const skillData = mergeObject(this.skill, data.skill, { inplace: false });\n    delete data.skill;\n\n    // Change skill tag\n    let tag;\n    if (!this.isStaticSkill) {\n      tag = skillData.tag;\n      delete skillData.tag;\n      if (!tag) {\n        ui.notifications.warn(\"Skill tag can't be empty.\");\n        return;\n      }\n\n      if (this.isSubSkill && tag !== this.subSkillId)\n        setProperty(data, `system.skills.${this.skillId}.subSkills.-=${this.subSkillId}`, null);\n      else if (!this.isSubSkill && tag !== this.skillId) setProperty(data, `system.skills.-=${this.skillId}`, null);\n    }\n\n    // Update skill data\n    const tagOrId = tag || (this.isSubSkill ? this.subSkillId : this.skillId);\n    if (this.isSubSkill) setProperty(data, `system.skills.${this.skillId}.subSkills.${tagOrId}`, skillData);\n    else setProperty(data, `system.skills.${tagOrId}`, skillData);\n\n    // Change application's id by tag\n    if (tag) {\n      if (this.isSubSkill) this.subSkillId = tag;\n      else this.skillId = tag;\n    }\n\n    await this.object.update(data);\n  }\n\n  async close(...args) {\n    await super.close(...args);\n\n    this._callbacks.forEach((fn) => fn());\n  }\n\n  async _onDrop(event) {\n    event.preventDefault();\n\n    // Retrieve the dropped Journal Entry Page\n    const data = TextEditor.getDragEventData(event);\n    if (data.type !== \"JournalEntryPage\" && data.type !== \"JournalEntry\") return;\n    const document = await CONFIG[data.type].documentClass.implementation.fromDropData(data);\n    if (!document) return;\n\n    // Add Journal Entry Page reference\n    await this._onSubmit(event, { updateData: { \"skill.journal\": document.uuid } });\n    await this.render();\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // Open compendium page\n    html.find(\".compendium-page\").on(\"click\", this._openCompendiumEntry.bind(this));\n    html.find(\".compendium-controls a\").on(\"click\", this._onCompendiumControls.bind(this));\n\n    // Submit\n    html.find(`button[type=\"submit\"]`).on(\"click\", (event) => {\n      event.preventDefault();\n      this.close({ submit: true });\n    });\n  }\n\n  async _openCompendiumEntry(event) {\n    event.preventDefault();\n    const elem = event.currentTarget.closest(\".compendium-entry\");\n\n    // Gather data\n    const uuid = elem.dataset.compendiumEntry;\n    const document = await fromUuid(uuid);\n\n    // Open document\n    if (document instanceof JournalEntryPage) {\n      document.parent.sheet.render(true, { pageId: document.id });\n    } else {\n      document.sheet.render(true);\n    }\n  }\n\n  async _onCompendiumControls(event) {\n    event.preventDefault();\n    const elem = event.currentTarget;\n\n    if (elem.classList.contains(\"delete\")) {\n      await this._onSubmit(event, { updateData: { \"skill.journal\": null } });\n      await this.render();\n    }\n  }\n}\n","import { ActorFFD20 } from \"./actor/actor-ffd20.mjs\";\nimport { getSkipActionPrompt } from \"./settings.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\n\n/* -------------------------------------------- */\n\n/**\n * This function is used to hook into the Chat Log context menu to add additional options to each message\n * These options make it easy to conveniently apply damage to controlled tokens based on the value of a Roll\n *\n * @param {HTMLElement} html    The Chat Message being rendered\n * @param {Array} options       The Array of Context Menu options\n * @returns {Array}              The extended options Array including new context choices\n */\nexport const addChatMessageContextOptions = function (html, options) {\n  const canApply = (li) => canvas.tokens.controlled.length && li.find(\".damage-roll .dice-total\").length;\n  const canApplyCritical = (li) => canvas.tokens.controlled.length && li.find(\".crit-damage-roll .dice-total\").length;\n  options.push(\n    {\n      name: game.i18n.localize(\"FFD20.ApplyDamage\"),\n      icon: '<i class=\"fas fa-user-minus\"></i>',\n      condition: canApply,\n      callback: (li) => ActorFFD20.applyDamage(li, 1),\n    },\n    {\n      name: game.i18n.localize(\"FFD20.ApplyHealing\"),\n      icon: '<i class=\"fas fa-user-plus\"></i>',\n      condition: canApply,\n      callback: (li) => ActorFFD20.applyDamage(li, -1),\n    },\n    {\n      name: game.i18n.localize(\"FFD20.ApplyCriticalDamage\"),\n      icon: '<i class=\"fas fa-user-minus\"></i>',\n      condition: canApplyCritical,\n      callback: (li) => ActorFFD20.applyDamage(li, 1, true),\n    },\n    {\n      name: game.i18n.localize(\"FFD20.ApplyCriticalHealing\"),\n      icon: '<i class=\"fas fa-user-minus\"></i>',\n      condition: canApplyCritical,\n      callback: (li) => ActorFFD20.applyDamage(li, -1, true),\n    }\n  );\n  return options;\n};\n\nconst duplicateCombatantInitiativeDialog = function (combats, combatantId) {\n  const combat = combats.find((c) => c.combatants.get(combatantId) !== undefined);\n  if (!combat) {\n    ui.notifications.warn(game.i18n.localize(\"FFD20.WarningNoCombatantFound\"));\n    return;\n  }\n  const combatant = combat.combatants.filter((o) => o.id === combatantId)[0];\n  if (!combatant) {\n    ui.notifications.warn(game.i18n.localize(\"FFD20.WarningNoCombatantFound\"));\n    return;\n  }\n\n  new Dialog(\n    {\n      title: `${game.i18n.localize(\"FFD20.DuplicateInitiative\")}: ${combatant.actor.name}`,\n      content: `<div class=\"flexrow form-group\">\n      <label>${game.i18n.localize(\"FFD20.InitiativeOffset\")}</label>\n      <input type=\"number\" name=\"initiativeOffset\" value=\"0\"/>\n    </div>`,\n      buttons: {\n        confirm: {\n          label: game.i18n.localize(\"FFD20.Confirm\"),\n          callback: (html) => {\n            const offset = parseFloat(html.find('input[name=\"initiativeOffset\"]').val());\n            const prevInitiative = combatant.initiative != null ? combatant.initiative : 0;\n            const newInitiative = prevInitiative + offset;\n            duplicateCombatantInitiative(combat, combatant, newInitiative);\n          },\n        },\n        cancel: {\n          label: game.i18n.localize(\"Cancel\"),\n        },\n      },\n      default: \"confirm\",\n    },\n    {\n      classes: [\"dialog\", \"ffd20\", \"duplicate-initiative\"],\n    }\n  ).render(true);\n};\n\nexport const duplicateCombatantInitiative = function (combat, combatant, initiative) {\n  console.debug(\"Duplicating combatant:\", combatant);\n  combat.createEmbeddedDocuments(\"Combatant\", [\n    mergeObject(combatant.toObject(), { initiative: initiative }, { inplace: false }),\n  ]);\n};\n\nHooks.on(\"getCombatTrackerEntryContext\", function addCombatTrackerContextOptions(html, menuItems) {\n  menuItems.push({\n    name: \"FFD20.DuplicateInitiative\",\n    icon: '<i class=\"fas fa-dice-d20\"></i>',\n    callback: (li) => duplicateCombatantInitiativeDialog.call(game.combat, game.combats, li.data(\"combatant-id\")),\n  });\n});\n\nexport class CombatFFD20 extends Combat {\n  /**\n   * Override the default Initiative formula to customize special behaviors of the game system.\n   * Apply advantage, proficiency, or bonuses where appropriate\n   * Apply the dexterity score as a decimal tiebreaker if requested\n   * See Combat._getInitiativeFormula for more detail.\n   *\n   * @param {ActorFFD20} actor\n   * @param d20\n   */\n  _getInitiativeFormula(actor, d20) {\n    const defaultParts = [d20 || \"1d20\", `@attributes.init.total[${game.i18n.localize(\"FFD20.Initiative\")}]`];\n    if (actor && game.settings.get(\"ffd20\", \"initiativeTiebreaker\"))\n      defaultParts.push(`(@attributes.init.total / 100)[${game.i18n.localize(\"FFD20.Tiebreaker\")}]`);\n    const parts = CONFIG.Combat.initiative.formula ? CONFIG.Combat.initiative.formula.split(/\\s*\\+\\s*/) : defaultParts;\n    if (!actor) return parts[0] || \"0\";\n    return parts.filter((p) => p !== null).join(\" + \");\n  }\n\n  /**\n   * @override\n   */\n  async rollInitiative(ids, { formula = null, updateTurn = true, messageOptions = {}, skipDialog = null } = {}) {\n    if (skipDialog == null) skipDialog = getSkipActionPrompt();\n    // Structure input data\n    ids = typeof ids === \"string\" ? [ids] : ids;\n    const currentId = this.combatant?.id;\n    let chatRollMode = game.settings.get(\"core\", \"rollMode\");\n\n    let bonus = \"\",\n      stop = false,\n      d20;\n    // Show initiative dialog\n    if (!skipDialog) {\n      const dialogData = await Combat.implementation.showInitiativeDialog(formula);\n      chatRollMode = dialogData.rollMode;\n      bonus = dialogData.bonus || \"\";\n      stop = dialogData.stop || false;\n      if (dialogData.d20) d20 = dialogData.d20;\n    }\n    // Determine formula\n    if (!formula) formula = \"1d20\";\n\n    if (stop) return this;\n\n    // Iterate over Combatants, performing an initiative roll for each\n    const [updates, messages] = await ids.reduce(\n      async (results, id, i) => {\n        const result = await results;\n        const [updates, messages] = result;\n\n        // Get Combatant data (non-strictly)\n        const c = this.combatants.get(id);\n        if (!c || !c.isOwner) return results;\n\n        // Produce an initiative roll for the Combatant\n        const rollData = c.actor?.getRollData() ?? {};\n        formula = this._getInitiativeFormula(c.actor ? c.actor : null) || formula;\n        rollData.bonus = bonus;\n        if (bonus.length > 0 && i === 0) {\n          formula += \" + @bonus\";\n        }\n\n        // Produce an initiative roll for the Combatant\n        const isHidden = c.token?.hidden || c.hidden;\n        if (isHidden) chatRollMode = messageOptions.rollMode ?? \"gmroll\";\n        const roll = RollFFD20.safeRoll(formula, rollData);\n        delete rollData.bonus;\n        if (roll.err) ui.notifications.warn(roll.err.message);\n        updates.push({ _id: id, initiative: roll.total });\n\n        const [notes, notesHTML] = c.actor.getInitiativeContextNotes();\n\n        // Create card template data\n        const templateData = mergeObject(\n          {\n            user: game.user.id,\n            formula: roll.formula,\n            tooltip: await roll.getTooltip(),\n            total: roll.total,\n          },\n          notes.length > 0 ? { hasExtraText: true, extraText: notesHTML } : {}\n        );\n\n        // Create chat card data\n        const chatData = mergeObject(\n          {\n            user: game.user.id,\n            type: CONST.CHAT_MESSAGE_TYPES.CHAT,\n            rollMode: chatRollMode,\n            sound: CONFIG.sounds.dice,\n            speaker: {\n              scene: canvas.scene?.id,\n              actor: c.actor ? c.actor.id : null,\n              token: c.token?.id,\n              alias: c.token?.name,\n            },\n            flags: { ffd20: { subject: { core: \"init\" } } },\n            flavor: game.i18n.localize(\"FFD20.RollsForInitiative\").format(c.token?.name ?? c.actor.name),\n            roll: roll,\n            content: await renderTemplate(\"systems/ffd20/templates/chat/roll-ext.hbs\", templateData),\n          },\n          messageOptions\n        );\n\n        // Handle different roll modes\n        ChatMessage.applyRollMode(chatData, chatData.rollMode);\n\n        if (i > 0) chatData.sound = null; // Only play 1 sound for the whole set\n        messages.push(chatData);\n\n        // Return the Roll and the chat data\n        return results;\n      },\n      [[], []]\n    );\n    if (!updates.length) return this;\n\n    // Update multiple combatants\n    await this.updateEmbeddedDocuments(\"Combatant\", updates);\n\n    // Ensure the turn order remains with the same combatant\n    if (updateTurn && currentId) await this.update({ turn: this.turns.findIndex((t) => t.id === currentId) });\n\n    // Create multiple chat messages\n    const chatMessages = await ChatMessage.implementation.create(messages);\n    return { combat: this, messages: chatMessages };\n  }\n\n  static showInitiativeDialog = function (formula = null) {\n    let rollMode = game.settings.get(\"core\", \"rollMode\");\n    return new Promise((resolve) => {\n      const template = \"systems/ffd20/templates/chat/roll-dialog.hbs\";\n      const dialogData = {\n        formula: formula ? formula : \"\",\n        rollMode: rollMode,\n        rollModes: CONFIG.Dice.rollModes,\n      };\n      // Create buttons object\n      const buttons = {\n        normal: {\n          label: \"Roll\",\n          callback: (html) => {\n            rollMode = html.find('[name=\"rollMode\"]').val();\n            const bonus = html.find('[name=\"bonus\"]').val();\n            const d20 = html.find('[name=\"d20\"]').val();\n            resolve({ rollMode, bonus, d20 });\n          },\n        },\n      };\n      // Show dialog\n      renderTemplate(template, dialogData).then((dlg) => {\n        new Dialog(\n          {\n            title: game.i18n.localize(\"FFD20.InitiativeBonus\"),\n            content: dlg,\n            buttons: buttons,\n            default: \"normal\",\n            close: (html) => {\n              resolve({ stop: true });\n            },\n          },\n          {\n            classes: [\"dialog\", \"ffd20\", \"roll-initiative\"],\n          }\n        ).render(true);\n      });\n    });\n  };\n\n  /**\n   * Process current combatant: expire active effects & buffs.\n   */\n  async _processCurrentCombatant() {\n    try {\n      this.combatant?.actor?.expireActiveEffects();\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  /**\n   * @override\n   * @returns {Promise<Combat>}\n   */\n  async nextRound() {\n    const combat = await super.nextRound();\n    // TODO: Process skipped turns.\n    await this._processCurrentCombatant();\n    return combat;\n  }\n\n  /**\n   * @override\n   * @returns {Promise<Combat>}\n   */\n  async nextTurn() {\n    const combat = await super.nextTurn();\n    await this._processCurrentCombatant();\n    return combat;\n  }\n}\n","import { hasTokenVision } from \"../applications/vision-permission.mjs\";\n\nexport class TokenFFD20 extends Token {\n  async toggleEffect(effect, { active, overlay = false, midUpdate } = {}) {\n    let call;\n    if (typeof effect == \"string\") {\n      const buffItem = this.actor.items.get(effect);\n      if (buffItem) {\n        call = await buffItem.setActive(!buffItem.isActive);\n      } else call = await super.toggleEffect(effect, { active, overlay });\n    } else if (effect && !midUpdate && Object.keys(CONFIG.FFD20.conditions).includes(effect.id)) {\n      const updates = {};\n      updates[\"system.attributes.conditions.\" + effect.id] = !this.actor.system.attributes.conditions[effect.id];\n      call = await this.actor.update(updates);\n    } else if (effect) {\n      call = await super.toggleEffect(effect, { active, overlay });\n    }\n    if (this.hasActiveHUD) canvas.tokens.hud.refreshStatusIcons();\n    return call;\n  }\n\n  get actorVision() {\n    return {\n      lowLight: getProperty(this.actor, \"system.traits.senses.ll.enabled\"),\n      lowLightMultiplier: getProperty(this.actor, \"system.traits.senses.ll.multiplier.dim\"),\n      lowLightMultiplierBright: getProperty(this.actor, \"system.traits.senses.ll.multiplier.bright\"),\n    };\n  }\n\n  get disableLowLight() {\n    return getProperty(this, \"flags.ffd20.disableLowLight\") === true;\n  }\n\n  // Token#observer patch to make use of vision permission settings\n  get observer() {\n    return game.user.isGM || hasTokenVision(this);\n  }\n\n  _onUpdate(data, options, user) {\n    if (options.render === false) return;\n\n    if (hasProperty(data, \"flags.ffd20.customVisionRules\")) {\n      // Make sure this token's perception changes\n      data.sight ||= {};\n    }\n    return super._onUpdate(data, options, user);\n  }\n\n  updateVisionSource(...args) {\n    this.document.refreshDetectionModes();\n    super.updateVisionSource(...args);\n  }\n\n  /**\n   * @param {object} data         Resource data for this bar\n   * @returns {number|null}       The number to boost the bar by, if any.\n   * @protected\n   */\n  _getBarBoost(data) {\n    if (data.attribute === \"attributes.hp\") return { value: this.actor.system.attributes.hp.temp, color: 0xc0d6e4 };\n    if (data.attribute === \"attributes.vigor\")\n      return { value: this.actor.system.attributes.vigor.temp, color: 0xc0d6e4 };\n    return null;\n  }\n\n  _getBarUnderline(data) {\n    if (data.attribute === \"attributes.hp\")\n      return { value: this.actor.system.attributes.hp.nonlethal, color: 0x7d2828 };\n    return null;\n  }\n\n  /**\n   * Draw a single resource bar, given provided data.\n   *\n   * @param {number} number       The Bar number>\n   * @param {PIXI.Graphics} bar   The Bar container.\n   * @param {object} data         Resource data for this bar.\n   * @protected\n   */\n  _drawBar(number, bar, data) {\n    // Get boost value (such as temporary hit points\n    const boost = this._getBarBoost(data);\n    const underline = this._getBarUnderline(data);\n\n    const val = Number(data.value);\n    data.max = Math.max(data.max, (boost?.value ?? 0) + val);\n    const pct = Math.clamped(val, 0, data.max) / data.max;\n\n    // Determine sizing\n    let h = Math.max(canvas.dimensions.size / 12, 8);\n    const w = this.w;\n    const bs = Math.clamped(h / 8, 1, 2);\n    if (this.document.height >= 2) h *= 1.6; // Enlarge the bar for large tokens\n\n    // Determine the color to use\n    const blk = 0x000000;\n    let color;\n    if (number === 0) color = PIXI.utils.rgb2hex([1 - pct / 2, pct, 0]);\n    else color = PIXI.utils.rgb2hex([0.5 * pct, 0.7 * pct, 0.5 + pct / 2]);\n\n    // Draw the bar\n    bar.clear();\n    // Draw background of bar\n    bar.beginFill(blk, 0.5).lineStyle(bs, blk, 1.0).drawRoundedRect(0, 0, this.w, h, 3);\n    // Draw bar boost\n    if (boost?.value > 0) {\n      const pct = Math.clamped(val + boost.value, 0, data.max) / data.max;\n      bar\n        .beginFill(boost.color, 1.0)\n        .lineStyle(bs, blk, 1.0)\n        .drawRoundedRect(0, 0, pct * w, h, 2);\n    }\n    // Draw normal value\n    bar\n      .beginFill(color, 1.0)\n      .lineStyle(bs, blk, 1.0)\n      .drawRoundedRect(0, 0, pct * w, h, 2);\n    // Draw bar underline\n    if (underline?.value > 0) {\n      const pct = Math.clamped(underline.value, 0, data.max) / data.max;\n      bar\n        .beginFill(underline.color, 1.0)\n        .lineStyle(bs, blk, 1.0)\n        .drawRoundedRect(0, h / 2, pct * w, h / 2, 2);\n    }\n\n    // Set position\n    const posY = number === 0 ? this.h - h : 0;\n    bar.position.set(0, posY);\n  }\n}\n","export class TokenDocumentFFD20 extends TokenDocument {\n  // Todo: Declare this in TokenDocumentFFD20 when/ if TokenDocument.getData calls the constructor's method\n  getTrackedAttributes(data, path = []) {\n    const attr = super.getTrackedAttributes(data, path);\n    if (path.length === 0) attr.value.push([\"attributes\", \"hp\", \"temp\"], [\"attributes\", \"hp\", \"nonlethal\"]);\n    return attr;\n  }\n\n  /**\n   * Hijack Token health bar rendering to include temporary and temp-max health in the bar display\n   *\n   * @param barName\n   * @param root0\n   * @param root0.alternative\n   */\n  getBarAttribute(barName, { alternative = null } = {}) {\n    let data;\n    try {\n      data = super.getBarAttribute(barName, { alternative: alternative });\n    } catch (e) {\n      data = null;\n    }\n\n    // Make resources editable\n    if (data?.attribute.startsWith(\"resources.\")) data.editable = true;\n\n    return data;\n  }\n\n  /**\n   * Refresh sight and detection modes according to the actor's senses associated with this token.\n   */\n  refreshDetectionModes() {\n    if (![\"character\", \"npc\"].includes(this.actor?.type)) return;\n    if (this.getFlag(\"ffd20\", \"customVisionRules\")) return;\n\n    // Reset sight properties\n    this.sight.color = null;\n    this.sight.attenuation = 0;\n    this.sight.brightness = 0;\n    this.sight.contrast = 0;\n    this.sight.saturation = 0;\n    this.sight.enabled = true;\n    this.sight.visionMode = \"basic\";\n    this.sight.range = 0;\n\n    // Prepare sight\n    const darkvisionRange = this.actor?.system?.traits?.senses?.dv ?? 0;\n    if (darkvisionRange > 0) {\n      this.sight.range = ffd20.utils.convertDistance(darkvisionRange)[0];\n      this.sight.visionMode = \"darkvision\";\n      this.sight.saturation = -1;\n    }\n\n    // Set basic detection mode\n    const basicId = DetectionMode.BASIC_MODE_ID;\n    const basicMode = this.detectionModes.find((m) => m.id === basicId);\n    if (!basicMode) this.detectionModes.push({ id: basicId, enabled: true, range: this.sight.range });\n    else basicMode.range = this.sight.range;\n\n    // Set see invisibility detection mode\n    const seeInvId = \"seeInvisibility\";\n    const seeInvMode = this.detectionModes.find((m) => m.id === seeInvId);\n    if (!seeInvMode && (this.actor?.system?.traits?.senses?.si || this.actor?.system?.traits?.senses?.tr)) {\n      this.detectionModes.push({ id: seeInvId, enabled: true, range: this.sight.range });\n    } else if (seeInvMode != null) {\n      if (!(this.actor?.system?.traits?.senses?.si || this.actor?.system?.traits?.senses?.tr)) {\n        this.detectionModes.splice(this.detectionModes.indexOf(seeInvMode, 1));\n      } else {\n        seeInvMode.range = this.sight.range;\n      }\n    }\n\n    // Set blind sense detection mode\n    const blindSenseId = \"blindSense\";\n    const blindSenseMode = this.detectionModes.find((m) => m.id === blindSenseId);\n    if (!blindSenseMode && this.actor?.system?.traits?.senses?.bse) {\n      this.detectionModes.push({ id: blindSenseId, enabled: true, range: this.actor.system.traits.senses.bse });\n    } else if (blindSenseMode != null) {\n      if (!this.actor?.system?.traits?.senses?.bse) {\n        this.detectionModes.splice(this.detectionModes.indexOf(blindSenseMode, 1));\n      } else {\n        blindSenseMode.range = this.actor.system.traits.senses.bse;\n      }\n    }\n\n    // Set blind sight detection mode\n    const blindSightId = \"blindSight\";\n    const blindSightMode = this.detectionModes.find((m) => m.id === blindSightId);\n    if (!blindSightMode && this.actor?.system?.traits?.senses?.bs) {\n      this.detectionModes.push({ id: blindSightId, enabled: true, range: this.actor.system.traits.senses.bs });\n    } else if (blindSightMode != null) {\n      if (!this.actor?.system?.traits?.senses?.bs) {\n        this.detectionModes.splice(this.detectionModes.indexOf(blindSightMode, 1));\n      } else {\n        blindSightMode.range = this.actor.system.traits.senses.bs;\n      }\n    }\n\n    // Set tremor sense detection mode\n    const tremorSenseId = \"feelTremor\";\n    const tremorSenseMode = this.detectionModes.find((m) => m.id === tremorSenseId);\n    if (!blindSightMode && this.actor?.system?.traits?.senses?.ts) {\n      this.detectionModes.push({ id: tremorSenseId, enabled: true, range: this.actor.system.traits.senses.ts });\n    } else if (tremorSenseMode != null) {\n      if (!this.actor?.system?.traits?.senses?.ts) {\n        this.detectionModes.splice(this.detectionModes.indexOf(tremorSenseMode, 1));\n      } else {\n        tremorSenseMode.range = this.actor.system.traits.senses.ts;\n      }\n    }\n\n    // Sort detection modes\n    this.detectionModes.sort(this._sortDetectionModes.bind(this));\n  }\n\n  _sortDetectionModes(a, b) {\n    if (a.id === DetectionMode.BASIC_MODE_ID) return -1;\n    if (b.id === DetectionMode.BASIC_MODE_ID) return 1;\n\n    const src = { a: CONFIG.Canvas.detectionModes[a.id], b: CONFIG.Canvas.detectionModes[b.id] };\n    return (src.a.constructor.PRIORITY ?? 0) - (src.b.constructor.PRIORITY ?? 0);\n  }\n}\n","export class EntrySelector extends FormApplication {\n  constructor(...args) {\n    super(...args);\n\n    // Prepare data and convert it into format compatible with the editor\n    this.isFlag = this.options.flag === true;\n    this.isFlat = this.options.flat === true;\n    const data = deepClone(getProperty(this.object, this.attribute) ?? (this.isFlag ? {} : []));\n\n    this.originalEntries = data;\n    this.entries = this.isFlag ? (this.isFlat ? Object.keys(data).map((d) => [d]) : Object.entries(data)) : data;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      id: \"entry-selector\",\n      classes: [\"ffd20\", \"entry\"],\n      template: \"systems/ffd20/templates/apps/entry-selector.hbs\",\n      width: 320,\n      height: \"auto\",\n      closeOnSubmit: false,\n      submitOnClose: false,\n    });\n  }\n\n  get title() {\n    return game.i18n.localize(\"FFD20.Application.EntrySelector.Title\");\n  }\n\n  get attribute() {\n    return this.options.name;\n  }\n\n  get fields() {\n    return this.options.fields.split(\";\");\n  }\n\n  get dtypes() {\n    return this.options.dtypes.split(\";\");\n  }\n\n  get dataCount() {\n    return this.fields.length;\n  }\n\n  getData() {\n    const entries = this.entries.map((o) => {\n      return o.map((o2, a) => {\n        return [o2, this.dtypes[a]];\n      });\n    });\n\n    return {\n      entries: entries,\n      fields: this.fields,\n    };\n  }\n\n  activateListeners(html) {\n    html.find(\".entry-control\").click(this._onEntryControl.bind(this));\n\n    html.find('tr td input[type=\"text\"]').change(this._onEntryChange.bind(this));\n\n    html.find('button[type=\"submit\"]').click(this._submitAndClose.bind(this));\n  }\n\n  async _updateObject(event, formData) {\n    const updateData = {};\n\n    if (this.isFlag) {\n      // Convert editor data for flags\n      const newKeys = new Set(); // Needed for deletion detection\n      const entries = this.entries.forEach(([key, value]) => {\n        newKeys.add(key);\n        updateData[`${this.attribute}.${key}`] = this.isFlat ? true : value;\n      });\n      // Handle deletions\n      const oldKeys = Object.keys(this.originalEntries);\n      oldKeys.forEach((key) => {\n        if (!newKeys.has(key)) updateData[`${this.attribute}.-=${key}`] = null;\n      });\n    } else {\n      updateData[this.attribute] = this.entries;\n    }\n\n    return this.object.update(updateData);\n  }\n\n  async _onEntryControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    if (a.classList.contains(\"add-entry\")) {\n      const obj = [];\n      for (let a = 0; a < this.dataCount; a++) {\n        const dataType = this.dtypes[a];\n        if (dataType === \"Number\") obj.push(0);\n        else obj.push(\"\");\n      }\n      this.entries.push(obj);\n      return this.render();\n    }\n\n    if (a.classList.contains(\"delete-entry\")) {\n      const tr = a.closest(\"tr\");\n      const index = parseInt(tr.dataset.index);\n      this.entries.splice(index, 1);\n      return this.render();\n    }\n  }\n\n  async _onEntryChange(event) {\n    const a = event.currentTarget;\n\n    const tr = a.closest(\"tr.entry\");\n    const index = parseInt(tr.dataset.index);\n    const index2 = parseInt(a.dataset.index);\n    const value = a.value;\n\n    if (a.dataset.dtype === \"Number\") {\n      let v = parseFloat(value);\n      if (isNaN(v)) v = 0;\n      this.entries[index][index2] = Math.floor(v * 100) / 100;\n    } else this.entries[index][index2] = value;\n  }\n\n  async _submitAndClose(event) {\n    event.preventDefault();\n    await this._onSubmit(event);\n    this.close();\n  }\n}\n","export class ScriptEditor extends FormApplication {\n  constructor(options = {}) {\n    super(options);\n\n    this.command = options.command || \"\";\n    this.name = options.name || null;\n\n    this.parent = options.parent;\n\n    this.isScriptCall = options.scriptCall === true;\n\n    // Add editor title\n    if (this.name) this.options.title = this.parent ? `${this.parent.name}: ${this.name}` : this.name;\n    else this.options.title = this.parent?.name ?? game.i18n.localize(\"FFD20.Unknown\");\n\n    this._promises = {\n      submit: [],\n    };\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"script-editor\"],\n      template: \"systems/ffd20/templates/apps/script-editor.hbs\",\n      width: 640,\n      height: 560,\n    });\n  }\n\n  getData() {\n    const data = {};\n\n    data.command = this.command || \"\";\n    data.name = this.name;\n\n    data.isScriptCall = this.isScriptCall;\n\n    data.canEdit = {\n      name: this.isScriptCall,\n    };\n\n    return data;\n  }\n\n  awaitResult() {\n    let callback;\n    const promise = new Promise((resolve) => {\n      callback = resolve;\n    });\n    this._promises.submit.push({ callback, promise, resolved: false });\n    return promise;\n  }\n\n  activateListeners(html) {\n    html.find('button[type=\"submit\"]').click(this._onSubmit.bind(this));\n\n    // Open help browser\n    html.find(\"a.help-browser[data-url]\").click(this._openHelpBrowser.bind(this));\n  }\n\n  _openHelpBrowser(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    ffd20.applications.helpBrowser.openUrl(a.dataset.url);\n  }\n\n  _updateObject(event, formData) {\n    this.command = formData[\"command\"];\n    this.name = formData[\"name\"] || null;\n\n    const result = {\n      command: this.command,\n      name: this.name,\n    };\n\n    this.resolvePromises(\"submit\", result);\n  }\n\n  resolvePromises(type, result) {\n    for (const p of this._promises[type]) {\n      if (!p.resolved) {\n        p.callback(result);\n        p.resolved = true;\n      }\n    }\n  }\n\n  async close(...args) {\n    super.close(...args);\n\n    this.resolvePromises(\"submit\", null);\n  }\n}\n","import { CR, naturalSort } from \"../utils/lib.mjs\";\nimport { ItemFFD20 } from \"../documents/item/item-ffd20.mjs\";\nimport { SemanticVersion } from \"../utils/semver.mjs\";\n\nconst NEED_NEW_VERSION = {\n  spells: \"0.2.28\",\n  items: \"0.2.28\",\n  bestiary: \"0.2.28\",\n  feats: \"0.2.28\",\n  classes: \"0.2.28\",\n  races: \"0.2.28\",\n  buffs: \"0.2.28\",\n};\n\nexport const COMPENDIUM_TYPES = {\n  spells: \"Item\",\n  items: \"Item\",\n  bestiary: \"Actor\",\n  feats: \"Item\",\n  classes: \"Item\",\n  races: \"Item\",\n  buffs: \"Item\",\n};\n\n/**\n * An object containing the compendium browsers the system loads on init.\n *\n * @type {Record<keyof typeof COMPENDIUM_TYPES, CompendiumBrowser>}\n */\nexport const compendiums = {};\n\n/**\n * Initializes compendiums browsers, creating an instance for each type.\n */\nexport function initializeCompendiumBrowsers() {\n  for (const key of Object.keys(COMPENDIUM_TYPES)) {\n    compendiums[key] = new CompendiumBrowser({ type: key });\n  }\n}\n\nexport class CompendiumBrowser extends Application {\n  constructor(...args) {\n    super(...args);\n\n    this.items = [];\n\n    this.filters = [];\n\n    this.activeFilters = {};\n\n    this._data = {\n      loaded: false,\n      data: {},\n      promise: null,\n      progress: null,\n    };\n\n    /**\n     * The bottom scroll treshold (in pixels) at which the browser should start lazy loading some more items.\n     *\n     * @type {number}\n     * @property\n     */\n    this.lazyLoadTreshold = 80;\n    /**\n     * The maximum number of items initially visible in regards to lazy loading.\n     *\n     * @type {number}\n     * @property\n     */\n    this.lazyStart = 80;\n    /**\n     * The current amount of items visible in regards to lazy loading.\n     *\n     * @type {number}\n     * @property\n     */\n    this.lazyIndex = 0;\n    /**\n     * The amount of new items to lazy load when triggered.\n     *\n     * @type {number}\n     * @property\n     */\n    this.lazyAdd = 20;\n\n    /**\n     * A list of packs used, for filtering purposes.\n     *\n     * @type {Compendium{}}\n     * @property\n     */\n    this.packs = {};\n\n    /**\n     * The RegExp to filter item names by.\n     *\n     * @type {RegExp}\n     * @property\n     */\n    this.filterQuery = /.*/;\n    this.searchString = \"\";\n\n    /**\n     * Load cached items\n     */\n    {\n      this._savedItems = [];\n      const cacheVersions = game.settings.get(\"ffd20\", \"compendiumSaveVersions\");\n      const thisVersion = SemanticVersion.fromString(cacheVersions[this.type] || \"0.0.1\");\n      const needVersion = SemanticVersion.fromString(NEED_NEW_VERSION[this.type]);\n      if (needVersion.isHigherThan(thisVersion)) {\n        game.settings.set(\n          \"ffd20\",\n          \"compendiumSaveVersions\",\n          foundry.utils.mergeObject(cacheVersions, { [this.type]: game.system.version })\n        );\n      } else {\n        const settings = game.settings.get(\"ffd20\", \"compendiumItems\");\n        if (settings[this.type]) {\n          this._savedItems = settings[this.type];\n        }\n      }\n    }\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      template: \"systems/ffd20/templates/apps/compendium-browser.hbs\",\n      classes: [\"ffd20\", \"app\"],\n      width: 720,\n      height: window.innerHeight - 60,\n      top: 30,\n      left: 40,\n    });\n  }\n\n  shouldForceRefresh() {\n    let result = false;\n\n    if (!this._currentCompendiums) {\n      this.updateForceRefreshData();\n    }\n\n    const forceRefreshData = game.settings.get(\"ffd20\", \"compendiumForceRefresh\");\n    const diff = getProperty(forceRefreshData, `diff.${this.type}`);\n\n    // Determine difference in used compendiums\n    if (!diff) {\n      result = true;\n    } else {\n      const diffCompendiums = [];\n      for (const o of [...this._currentCompendiums, ...diff]) {\n        if (!diff.includes(o) || !this._currentCompendiums.includes(o)) diffCompendiums.push(o);\n      }\n      if (diffCompendiums.length > 0) result = true;\n    }\n\n    return result;\n  }\n\n  updateForceRefreshData(options = { save: false, refresh: true }) {\n    // Generate list of usable compendiums\n    if (options.refresh) {\n      this._currentCompendiums = game.packs\n        .filter((o) => {\n          if (o.metadata.type !== this.documentType) return false;\n\n          if (this.shouldSkip(o)) return false;\n\n          return true;\n        })\n        .map((o) => {\n          return `${o.metadata.package}.${o.metadata.name}`;\n        });\n    }\n\n    // Save results\n    if (options.save) {\n      const forceRefreshData = duplicate(game.settings.get(\"ffd20\", \"compendiumForceRefresh\"));\n      setProperty(forceRefreshData, `diff.${this.type}`, this._currentCompendiums);\n      return game.settings.set(\"ffd20\", \"compendiumForceRefresh\", forceRefreshData);\n    }\n  }\n\n  async _createInitialElements() {\n    const items = [];\n    for (let a = 0; items.length < this.lazyLoadTreshold && a < this.items.length; a++) {\n      const item = this.items[a];\n      if (this._passesFilters(item.item)) {\n        items.push(item);\n      }\n      this.lazyIndex = a + 1;\n    }\n\n    for (const item of items) {\n      await this._addEntryElement(item);\n    }\n  }\n  async _addEntryElement(item) {\n    const elem = $(await renderTemplate(\"systems/ffd20/templates/internal/compendium-browser_entry.hbs\", item));\n    const rootElem = this.element.find(\".directory-list\");\n    rootElem.append(elem);\n    this.activateEntryListeners(elem);\n\n    return elem;\n  }\n  _clearEntryElements() {\n    this.element.find(\".directory-list\").empty();\n  }\n\n  activateEntryListeners(elem) {\n    // Open sheet\n    elem.find(\".entry-name\").click((ev) => {\n      const li = ev.currentTarget.parentElement;\n      this._onEntry(li.getAttribute(\"data-collection\"), li.getAttribute(\"data-entry-id\"));\n    });\n\n    // Make compendium item draggable\n    elem[0].setAttribute(\"draggable\", true);\n    elem[0].addEventListener(\"dragstart\", this._onDragStart, false);\n  }\n\n  async _initLazyLoad() {\n    await this._createInitialElements();\n    const rootElem = this.element.find(\".directory-list\");\n\n    // Create function for lazy loading\n    const lazyLoad = async () => {\n      let createdItems = 0;\n      for (let a = this.lazyIndex; a < this.items.length && createdItems < this.lazyAdd; a++) {\n        const item = this.items[a];\n        if (this._passesFilters(item.item)) {\n          createdItems++;\n          const elem = await this._addEntryElement(item);\n          $(elem).fadeIn(500);\n        }\n        this.lazyIndex++;\n      }\n    };\n\n    // Create callback for lazy loading\n    $(rootElem).on(\"scroll\", () => {\n      const top = rootElem.scrollTop() + rootElem.height();\n      const bottom = rootElem[0].scrollHeight - this.lazyLoadTreshold;\n      if (top >= bottom) {\n        lazyLoad();\n      }\n    });\n  }\n\n  async loadData() {\n    return new Promise((resolve) => {\n      let promise = this._data.promise;\n      if (promise == null) {\n        promise = this._gatherData();\n        this._data.promise = promise;\n      }\n\n      promise.then(async () => {\n        this._data.loaded = true;\n        this._data.promise = null;\n        try {\n          await this.saveEntries();\n        } catch (err) {\n          console.error(err);\n          await this.clearEntries();\n        }\n        resolve(this._data);\n      });\n    });\n  }\n\n  async _gatherData() {\n    try {\n      await this._fetchMetadata();\n    } catch (err) {\n      console.warn(err);\n      this._savedItems = [];\n      await this._fetchMetadata();\n    }\n\n    this._data = {\n      filters: this.filters,\n      collection: this.items.reduce((cur, o) => {\n        cur[o.item._id] = o;\n        return cur;\n      }, {}),\n      labels: {\n        itemCount: game.i18n.localize(\"FFD20.TotalItems\").format(this.items.length),\n      },\n    };\n  }\n\n  get typeName() {\n    switch (this.type) {\n      case \"spells\":\n        return game.i18n.localize(\"FFD20.Spells\");\n      case \"items\":\n        return game.i18n.localize(\"FFD20.Items\");\n      case \"feats\":\n        return game.i18n.localize(\"FFD20.Features\");\n      case \"bestiary\":\n        return game.i18n.localize(\"FFD20.Creatures\");\n      case \"classes\":\n        return game.i18n.localize(\"FFD20.Classes\");\n      case \"races\":\n        return game.i18n.localize(\"FFD20.Races\");\n      case \"buffs\":\n        return game.i18n.localize(\"FFD20.Buffs\");\n    }\n    return this.type;\n  }\n\n  get type() {\n    return this.options.type;\n  }\n\n  get title() {\n    return [this.typeName, \"Browser\"].join(\" \");\n  }\n\n  get documentType() {\n    return COMPENDIUM_TYPES[this.type];\n  }\n\n  getBasicFilters() {\n    switch (this.type) {\n      case \"spells\":\n        return [{ type: \"spell\" }];\n      case \"items\":\n        return [\n          { type: \"equipment\" },\n          { type: \"weapon\" },\n          { type: \"consumable\" },\n          { type: \"loot\" },\n          { type: \"container\" },\n        ];\n      case \"feats\":\n        return [{ type: \"feat\" }];\n      case \"classes\":\n        return [{ type: \"class\" }];\n      case \"races\":\n        return [{ type: \"race\" }];\n      case \"buffs\":\n        return [{ type: \"buff\" }];\n    }\n    return [null];\n  }\n\n  /**\n   * @param {Compendium} p - The compendium in question.\n   * @returns {boolean} Whether the compendium should be skipped.\n   */\n  shouldSkip(p) {\n    // Check disabled status\n    const config = game.settings.get(\"core\", \"compendiumConfiguration\")[p.collection];\n    const disabled = getProperty(config, \"ffd20.disabled\") === true;\n    if (disabled) return true;\n\n    // Skip if set to private and the user is not a GM\n    if (p.private && !game.user.isGM) return true;\n\n    // Don't skip the compendium\n    return false;\n  }\n\n  _onProgress(progress) {\n    progress.loaded++;\n    progress.pct = Math.round((progress.loaded * 10) / progress.total) * 10;\n    SceneNavigation.displayProgressBar({ label: progress.message, pct: progress.pct });\n  }\n\n  async loadCompendium(p, filters = [null]) {\n    const progress = this._data.progress;\n\n    if (p.metadata.system != \"ffd20\") {\n      console.warn(p.metadata.label + \" is incompatible with this browser and has been skipped.\");\n      this._onProgress(progress);\n      return;\n    }\n\n    // Retrieve compendium contents\n    let items = [];\n    for (const filter of filters) {\n      items.push(...(await p.getDocuments(filter)));\n    }\n\n    if (p.translated) {\n      items = items.map((item) => p.translate(item));\n    }\n\n    // Flush full compendium contents from memory\n    p.clear();\n\n    for (const i of items) {\n      if (!this._filterItems(i)) continue;\n      this.packs[p.collection] = p;\n      this.items.push(this._mapEntry(p, i));\n    }\n    this._onProgress(progress);\n  }\n\n  async _fetchMetadata() {\n    this.items = [];\n\n    if (this.shouldForceRefresh() || this._savedItems.length === 0) {\n      // Initialize progress bar\n      const packs = [];\n      const progress = { pct: 0, message: game.i18n.localize(\"FFD20.LoadingCompendiumBrowser\"), loaded: -1, total: 0 };\n      for (const p of game.packs.values()) {\n        if (p.documentClass.documentName === this.documentType && !this.shouldSkip(p)) {\n          progress.total++;\n          packs.push(p);\n        } else {\n          if (Object.hasOwnProperty.call(this.packs, p.collection)) {\n            delete this.packs[p.collection];\n          }\n        }\n      }\n\n      // Clear filters without applicable packs\n      if (packs.length === 0) {\n        this.filters = [];\n        return;\n      }\n\n      this._data.progress = progress;\n      this._onProgress(progress);\n\n      // Load compendiums\n      for (const p of packs) {\n        await this.loadCompendium(p, this.getBasicFilters());\n      }\n\n      // Sort items\n      this.items = naturalSort(this.items, \"item.name\");\n\n      // Return if no appropriate items were found\n      if (this.items.length === 0) {\n        return;\n      }\n    } else {\n      for (const i of this._savedItems) {\n        const p = game.packs.get(i.collection._id);\n        if (p) {\n          this.items.push(this._mapEntry(p, i.item));\n          this.packs[i.collection._id] = p;\n        }\n      }\n      this._savedItems = [];\n    }\n\n    // Gather filter data\n    this._fetchGeneralFilters();\n    switch (this.type) {\n      case \"spells\":\n        this._fetchSpellFilters();\n        break;\n      case \"items\":\n        this._fetchItemFilters();\n        break;\n      case \"bestiary\":\n        this._fetchBestiaryFilters();\n        break;\n      case \"feats\":\n        this._fetchFeatFilters();\n        break;\n      case \"classes\":\n        this._fetchClassFilters();\n        break;\n      case \"races\":\n        this._fetchRaceFilters();\n        break;\n      case \"buffs\":\n        this._fetchBuffFilters();\n        break;\n    }\n\n    // Create an empty active filters object\n    this.activeFilters = this.filters.reduce((cur, f) => {\n      cur[f.path] = [];\n      return cur;\n    }, {});\n\n    // Merge active filters object with stored settings\n    const filterSettings =\n      getProperty(game.settings.get(\"ffd20\", \"compendiumFilters\") || {}, `${this.type}.activeFilters`) || {};\n    for (const [k, v] of Object.entries(filterSettings)) {\n      if (!this.activeFilters[k]) continue;\n      this.activeFilters[k] = v;\n    }\n\n    // Apply active filters to template\n    for (const k of Object.keys(this.activeFilters)) {\n      const filter = this.filters.find((o) => o.path === k);\n      if (!filter) continue;\n      for (const k2 of this.activeFilters[k]) {\n        filter.active = filter.active || {};\n        filter.active[k2] = true;\n      }\n    }\n  }\n\n  _filterItems(item) {\n    if (this.type === \"spells\" && item.type !== \"spell\") return false;\n    if (this.type === \"items\" && !ItemFFD20.isInventoryItem(item.type)) return false;\n    if (this.type === \"feats\" && item.type !== \"feat\") return false;\n    if (this.type === \"classes\" && item.type !== \"class\") return false;\n    if (this.type === \"races\" && item.type !== \"race\") return false;\n    if (this.type === \"buffs\" && item.type !== \"buff\") return false;\n    return true;\n  }\n\n  /* ------------------------------------- */\n  /*  Mapping Functions                    */\n  /* ------------------------------------- */\n  _mapFeats(result, item) {\n    this.extraFilters = this.extraFilters || {\n      tags: {},\n      associations: {\n        class: {},\n      },\n    };\n\n    result.item.tags = (item.system.tags || []).reduce((cur, o) => {\n      this.extraFilters.tags[o[0]] = true;\n      cur.push(o[0]);\n      return cur;\n    }, []);\n\n    result.item.assocations = {\n      class: (item.system.featType === \"classFeat\"\n        ? getProperty(item.system, \"associations.classes\") || []\n        : []\n      ).reduce((cur, o) => {\n        this.extraFilters.associations.class[o[0]] = true;\n        cur.push(o[0]);\n        return cur;\n      }, []),\n    };\n  }\n\n  _mapBestiary(result, item) {\n    this.extraFilters = this.extraFilters || {\n      \"system.details.cr.total\": {},\n      subTypes: {},\n    };\n    result.item.creatureType = \"\";\n    result.item.subTypes = [];\n\n    // Add CR filters\n    if (item.type === \"npc\") {\n      const cr = getProperty(item, \"system.details.cr.total\");\n      if (cr && !this.extraFilters[\"system.details.cr.total\"][cr])\n        this.extraFilters[\"system.details.cr.total\"][cr] = true;\n    }\n    // Get creature (sub)type\n    if (item.items) {\n      const race = item.items.filter((o) => o.type === \"race\")[0];\n      if (race != null) {\n        result.item.creatureType = race.system.creatureType;\n        result.item.subTypes = race.system.subTypes?.map((o) => {\n          this.extraFilters.subTypes[o[0]] = true;\n          return o[0];\n        });\n      }\n    } else {\n      item.subTypes?.forEach((o) => {\n        this.extraFilters.subTypes[o] = true;\n      });\n      result.item.creatureType = item.creatureType;\n      result.item.subTypes = item.subTypes;\n    }\n  }\n\n  _mapItems(result, item) {\n    this.extraFilters = this.extraFilters || {};\n\n    result.item.weaponProps = Object.entries(getProperty(item.system, \"system.properties\") || []).reduce((cur, o) => {\n      if (o[1]) cur.push(o[0]);\n      return cur;\n    }, []);\n  }\n\n  _mapSpells(result, item) {\n    this.extraFilters = this.extraFilters || {\n      \"learnedAt.class\": [],\n      \"learnedAt.domain\": [],\n      \"learnedAt.subDomain\": [],\n      \"learnedAt.elementalSchool\": [],\n      \"learnedAt.bloodline\": [],\n      \"system.subschool\": [],\n      spellTypes: [],\n    };\n\n    result.item.allSpellLevels = [];\n\n    // Add class/domain/etc filters\n    result.item.learnedAt = {\n      class: (getProperty(item, \"system.learnedAt.class\") || []).reduce((cur, o) => {\n        this.extraFilters[\"learnedAt.class\"][o[0]] = true;\n        if (!result.item.allSpellLevels.includes(o[1])) result.item.allSpellLevels.push(o[1]);\n        cur.push(o[0]);\n        return cur;\n      }, []),\n      domain: (getProperty(item, \"system.learnedAt.domain\") || []).reduce((cur, o) => {\n        this.extraFilters[\"learnedAt.domain\"][o[0]] = true;\n        if (!result.item.allSpellLevels.includes(o[1])) result.item.allSpellLevels.push(o[1]);\n        cur.push(o[0]);\n        return cur;\n      }, []),\n      subDomain: (getProperty(item, \"system.learnedAt.subDomain\") || []).reduce((cur, o) => {\n        this.extraFilters[\"learnedAt.subDomain\"][o[0]] = true;\n        if (!result.item.allSpellLevels.includes(o[1])) result.item.allSpellLevels.push(o[1]);\n        cur.push(o[0]);\n        return cur;\n      }, []),\n      elementalSchool: (getProperty(item, \"system.learnedAt.elementalSchool\") || []).reduce((cur, o) => {\n        this.extraFilters[\"learnedAt.elementalSchool\"][o[0]] = true;\n        if (!result.item.allSpellLevels.includes(o[1])) result.item.allSpellLevels.push(o[1]);\n        cur.push(o[0]);\n        return cur;\n      }, []),\n      bloodline: (getProperty(item, \"system.learnedAt.bloodline\") || []).reduce((cur, o) => {\n        this.extraFilters[\"learnedAt.bloodline\"][o[0]] = true;\n        if (!result.item.allSpellLevels.includes(o[1])) result.item.allSpellLevels.push(o[1]);\n        cur.push(o[0]);\n        return cur;\n      }, []),\n      spellLevel: {\n        class: (getProperty(item, \"system.learnedAt.class\") || []).reduce((cur, o) => {\n          cur[o[0]] = o[1];\n          return cur;\n        }, {}),\n        domain: (getProperty(item, \"system.learnedAt.domain\") || []).reduce((cur, o) => {\n          cur[o[0]] = o[1];\n          return cur;\n        }, {}),\n        subDomain: (getProperty(item, \"system.learnedAt.subDomain\") || []).reduce((cur, o) => {\n          cur[o[0]] = o[1];\n          return cur;\n        }, {}),\n        // \"elementalSchool\": (getProperty(item, \"system.learnedAt.elementalSchool\") || []).reduce((cur, o) => {\n        //   cur[o[0]] = o[1];\n        //   return cur;\n        // }, {}),\n        bloodline: (getProperty(item, \"system.learnedAt.bloodline\") || []).reduce((cur, o) => {\n          cur[o[0]] = o[1];\n          return cur;\n        }, {}),\n      },\n    };\n\n    // Add subschools\n    {\n      const subschool = item.system.subschool;\n      if (subschool) this.extraFilters[\"system.subschool\"][subschool] = true;\n    }\n    // Add spell types\n    {\n      const spellTypes = item.system.types ? item.system.types.split(CONFIG.FFD20.re.traitSeparator) : [];\n      result.item.spellTypes = spellTypes;\n      for (const st of spellTypes) {\n        this.extraFilters[\"spellTypes\"][st] = true;\n      }\n    }\n  }\n\n  _mapClasses(result, item) {\n    this.extraFilters = this.extraFilters || {\n      \"system.hd\": {},\n      \"system.skillsPerLevel\": {},\n      \"system.parentClass\": {},\n    };\n\n    // Add HD\n    {\n      const hd = item.system.hd;\n      if (hd) this.extraFilters[\"system.hd\"][hd] = true;\n    }\n    // Add skills per level\n    {\n      const s = item.system.skillsPerLevel;\n      if (s) this.extraFilters[\"system.skillsPerLevel\"][s] = true;\n    }\n    // Add parent classes\n    {\n      const s = item.system.parentClass;\n      if (s) this.extraFilters[\"system.parentClass\"][s] = true;\n    }\n  }\n\n  _mapRaces(result, item) {\n    this.extraFilters = this.extraFilters || {\n      subTypes: {},\n    };\n    result.item.subTypes = [];\n\n    // Get subtypes\n    result.item.subTypes = item.system.subTypes.map((o) => {\n      this.extraFilters.subTypes[o[0]] = true;\n      return o[0];\n    });\n  }\n\n  _mapBuffs(result, item) {\n    this.extraFilters = this.extraFilters || {\n      types: {},\n    };\n\n    // Get types\n    this.extraFilters.types[item.system.buffType] = true;\n  }\n\n  _mapEntry(pack, item) {\n    const result = {\n      collection: {\n        _id: pack.collection,\n        label: pack.metadata.label,\n      },\n      item: {\n        _id: item._id,\n        uuid: item.uuid,\n        name: item.name,\n        type: item.type,\n        img: item.img,\n        system: item.system,\n        pack: pack.collection,\n      },\n    };\n\n    switch (this.type) {\n      case \"feats\":\n        this._mapFeats(result, item);\n        break;\n      case \"bestiary\":\n        this._mapBestiary(result, item);\n        break;\n      case \"items\":\n        this._mapItems(result, item);\n        break;\n      case \"spells\":\n        this._mapSpells(result, item);\n        break;\n      case \"classes\":\n        this._mapClasses(result, item);\n        break;\n      case \"races\":\n        this._mapRaces(result, item);\n        break;\n      case \"buffs\":\n        this._mapBuffs(result, item);\n        break;\n    }\n\n    return result;\n  }\n\n  async getData() {\n    this.updateForceRefreshData();\n    if (this.shouldForceRefresh() || !this._data.loaded) await this.loadData();\n    await this.updateForceRefreshData({ save: true, refresh: false });\n\n    const data = duplicate(this._data);\n    data.searchString = this.searchString;\n\n    return data;\n  }\n\n  async refresh() {\n    await this.loadData();\n    this.render(false);\n  }\n\n  _fetchGeneralFilters() {\n    this.filters = [\n      {\n        path: \"pack\",\n        label: game.i18n.localize(\"FFD20.Compendium\"),\n        items: naturalSort(\n          Object.entries(this.packs).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1].metadata.label });\n            return cur;\n          }, []),\n          \"name\"\n        ),\n      },\n    ];\n  }\n\n  _fetchSpellFilters() {\n    this.filters.push(\n      ...[\n        {\n          path: \"system.school\",\n          label: game.i18n.localize(\"FFD20.SpellSchool\"),\n          items: naturalSort(\n            Object.entries(CONFIG.FFD20.spellSchools).reduce((cur, o) => {\n              cur.push({ key: o[0], name: o[1] });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"system.multischool\",\n          label: game.i18n.localize(\"FFD20.multiSchool\"),\n          items: naturalSort(\n            Object.entries(CONFIG.FFD20.multiSchools).reduce((cur, o) => {\n              cur.push({ key: o[0], name: o[1] });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"system.subschool\",\n          label: game.i18n.localize(\"FFD20.SubSchool\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"system.subschool\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"spellTypes\",\n          label: game.i18n.localize(\"FFD20.TypePlural\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"spellTypes\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"learnedAt.class\",\n          label: game.i18n.localize(\"FFD20.ClassPlural\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"learnedAt.class\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"learnedAt.domain\",\n          label: game.i18n.localize(\"FFD20.Domain\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"learnedAt.domain\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"learnedAt.subDomain\",\n          label: game.i18n.localize(\"FFD20.SubDomain\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"learnedAt.subDomain\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        // {\n        //   path: \"learnedAt.elementalSchool\",\n        //   label: game.i18n.localize(\"FFD20.ElementalSchool\"),\n        //   items: this.extraFilters[\"learnedAt.elementalSchool\"].reduce((cur, o) => {\n        //     cur.push({ key: o, name: o });\n        //     return cur;\n        //   }, []),\n        // },\n        {\n          path: \"learnedAt.bloodline\",\n          label: game.i18n.localize(\"FFD20.Bloodline\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"learnedAt.bloodline\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"_spellLevel\",\n          label: game.i18n.localize(\"FFD20.SpellLevel\"),\n          items: Object.entries(CONFIG.FFD20.spellLevels).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n      ]\n    );\n  }\n\n  _fetchItemFilters() {\n    this.filters.push(\n      ...[\n        {\n          path: \"type\",\n          label: game.i18n.localize(\"FFD20.Type\"),\n          items: [\n            { key: \"weapon\", name: game.i18n.localize(\"FFD20.ItemTypeWeapon\") },\n            { key: \"equipment\", name: game.i18n.localize(\"FFD20.ItemTypeEquipment\") },\n            { key: \"consumable\", name: game.i18n.localize(\"FFD20.ItemTypeConsumable\") },\n            { key: \"loot\", name: game.i18n.localize(\"FFD20.Misc\") },\n          ],\n        },\n        {\n          path: \"system.weaponType\",\n          label: game.i18n.localize(\"FFD20.WeaponType\"),\n          items: Object.entries(CONFIG.FFD20.weaponTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1]._label });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.weaponSubtype\",\n          label: game.i18n.localize(\"FFD20.WeaponSubtype\"),\n          items: Object.values(CONFIG.FFD20.weaponTypes).reduce((cur, o) => {\n            cur = cur.concat(\n              Object.entries(o)\n                .filter((i) => !i[0].startsWith(\"_\"))\n                .reduce((arr, i) => {\n                  if (!cur.filter((a) => a.key === i[0]).length) {\n                    arr.push({ key: i[0], name: i[1] });\n                  }\n                  return arr;\n                }, [])\n            );\n            return cur;\n          }, []),\n        },\n        {\n          path: \"weaponProps\",\n          label: game.i18n.localize(\"FFD20.WeaponProperties\"),\n          items: Object.entries(CONFIG.FFD20.weaponProperties).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.equipmentType\",\n          label: game.i18n.localize(\"FFD20.EquipmentType\"),\n          items: Object.entries(CONFIG.FFD20.equipmentTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1]._label });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.equipmentSubtype\",\n          label: game.i18n.localize(\"FFD20.EquipmentSubtype\"),\n          items: Object.values(CONFIG.FFD20.equipmentTypes).reduce((cur, o) => {\n            cur = cur.concat(\n              Object.entries(o)\n                .filter((i) => !i[0].startsWith(\"_\"))\n                .reduce((arr, i) => {\n                  if (!cur.filter((a) => a.key === i[0]).length) {\n                    arr.push({ key: i[0], name: i[1] });\n                  }\n                  return arr;\n                }, [])\n            );\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.slot\",\n          label: game.i18n.localize(\"FFD20.Slot\"),\n          items: Object.values(CONFIG.FFD20.equipmentSlots).reduce((cur, o) => {\n            cur = cur.concat(\n              Object.entries(o)\n                .filter((i) => !i[0].startsWith(\"_\"))\n                .reduce((arr, i) => {\n                  if (!cur.filter((a) => a.key === i[0]).length) {\n                    arr.push({ key: i[0], name: i[1] });\n                  }\n                  return arr;\n                }, [])\n            );\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.consumableType\",\n          label: game.i18n.localize(\"FFD20.ConsumableType\"),\n          items: Object.entries(CONFIG.FFD20.consumableTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.subType\",\n          label: game.i18n.localize(\"FFD20.Misc\"),\n          items: Object.entries(CONFIG.FFD20.lootTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n      ]\n    );\n  }\n\n  _fetchBestiaryFilters() {\n    this.filters.push(\n      ...[\n        {\n          path: \"system.details.cr.total\",\n          label: \"CR\",\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"system.details.cr.total\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: CR.fromNumber(o) });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"creatureType\",\n          label: game.i18n.localize(\"FFD20.CreatureType\"),\n          items: naturalSort(\n            Object.entries(CONFIG.FFD20.creatureTypes).reduce((cur, o) => {\n              cur.push({ key: o[0], name: o[1] });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"subTypes\",\n          label: game.i18n.localize(\"FFD20.RaceSubtypePlural\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"subTypes\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n      ]\n    );\n  }\n\n  _fetchFeatFilters() {\n    this.filters.push(\n      ...[\n        {\n          path: \"system.featType\",\n          label: game.i18n.localize(\"FFD20.Type\"),\n          items: Object.entries(CONFIG.FFD20.featTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"tags\",\n          label: game.i18n.localize(\"FFD20.Tags\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters.tags).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"assocations.class\",\n          label: game.i18n.localize(\"FFD20.ClassPlural\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters.associations[\"class\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n      ]\n    );\n  }\n\n  _fetchClassFilters() {\n    this.filters.push(\n      ...[\n        {\n          path: \"system.classType\",\n          label: game.i18n.localize(\"FFD20.ClassType\"),\n          items: Object.entries(CONFIG.FFD20.classTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        // TODO class catagory\n        {\n          path: \"system.classSubType\",\n          label: game.i18n.localize(\"FFD20.ClassSubType\"),\n          items: Object.entries(CONFIG.FFD20.classSubTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        // TODO Parent class\n        {\n          path: \"system.parentClass\",\n          label: game.i18n.localize(\"FFD20.ParentClass\"),\n          items: Object.keys(this.extraFilters[\"system.parentClass\"]).reduce((cur, o) => {\n            cur.push({ key: o.toString(), name: o.toString() });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.hd\",\n          label: game.i18n.localize(\"FFD20.HitDie\"),\n          items: Object.keys(this.extraFilters[\"system.hd\"]).reduce((cur, o) => {\n            cur.push({ key: o.toString(), name: o.toString() });\n            return cur;\n          }, []),\n        },\n        // TODO MP type\n        {\n          path: \"system.classBaseMPTypes\",\n          label: game.i18n.localize(\"FFD20.ClassMPType\"),\n          items: Object.entries(CONFIG.FFD20.classBaseMPTypes).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        //  TODO Casting stat\n        {\n          path: \"system.classCastingStat\",\n          label: game.i18n.localize(\"FFD20.SpellcastingAbility\"),\n          items: Object.entries(CONFIG.FFD20.classCastingStats).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.bab\",\n          label: game.i18n.localize(\"FFD20.BAB\"),\n          items: Object.entries(CONFIG.FFD20.classBAB).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.skillsPerLevel\",\n          label: game.i18n.localize(\"FFD20.SkillsPerLevel\"),\n          items: Object.keys(this.extraFilters[\"system.skillsPerLevel\"]).reduce((cur, o) => {\n            cur.push({ key: o.toString(), name: o.toString() });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.savingThrows.fort.value\",\n          label: game.i18n.localize(\"FFD20.SavingThrowFort\"),\n          items: Object.entries(CONFIG.FFD20.classSavingThrows).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.savingThrows.ref.value\",\n          label: game.i18n.localize(\"FFD20.SavingThrowRef\"),\n          items: Object.entries(CONFIG.FFD20.classSavingThrows).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n        {\n          path: \"system.savingThrows.will.value\",\n          label: game.i18n.localize(\"FFD20.SavingThrowWill\"),\n          items: Object.entries(CONFIG.FFD20.classSavingThrows).reduce((cur, o) => {\n            cur.push({ key: o[0], name: o[1] });\n            return cur;\n          }, []),\n        },\n      ]\n    );\n  }\n\n  _fetchRaceFilters() {\n    this.filters.push(\n      ...[\n        {\n          path: \"system.creatureType\",\n          label: game.i18n.localize(\"FFD20.CreatureType\"),\n          items: naturalSort(\n            Object.entries(CONFIG.FFD20.creatureTypes).reduce((cur, o) => {\n              cur.push({ key: o[0], name: o[1] });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n        {\n          path: \"subTypes\",\n          label: game.i18n.localize(\"FFD20.RaceSubtypePlural\"),\n          items: naturalSort(\n            Object.keys(this.extraFilters[\"subTypes\"]).reduce((cur, o) => {\n              cur.push({ key: o, name: o });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n      ]\n    );\n  }\n\n  _fetchBuffFilters() {\n    this.filters.push(\n      ...[\n        {\n          path: \"system.buffType\",\n          label: game.i18n.localize(\"FFD20.Type\"),\n          items: naturalSort(\n            Object.entries(CONFIG.FFD20.buffTypes).reduce((cur, o) => {\n              cur.push({ key: o[0], name: o[1] });\n              return cur;\n            }, []),\n            \"name\"\n          ),\n        },\n      ]\n    );\n  }\n\n  async _render(force, ...args) {\n    await super._render(force, ...args);\n\n    // Collapse filter displays\n    {\n      const elems = this.element.find(\".filter-content\");\n      for (const e of elems) {\n        const pE = e.closest(\".filter\");\n        const path = pE.dataset.path;\n        if (this.activeFilters[path].length === 0) {\n          $(e).css(\"display\", \"none\");\n        }\n      }\n    }\n\n    // Determine filtered item count\n    this._determineFilteredItemCount();\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.find('input[name=\"search\"]').keyup(this._onFilterResults.bind(this));\n\n    html.find('.filter input[type=\"checkbox\"]').change(this._onActivateBooleanFilter.bind(this));\n\n    html.find(\".filter h3\").click(this._toggleFilterVisibility.bind(this));\n\n    html.find(\"button.refresh\").click(this.refresh.bind(this));\n\n    // Lazy load\n    this._initLazyLoad();\n  }\n\n  /**\n   * Handle opening a single compendium entry by invoking the configured document class and its sheet\n   *\n   * @param collectionKey\n   * @param entryId\n   * @private\n   */\n  async _onEntry(collectionKey, entryId) {\n    const pack = game.packs.find((o) => o.collection === collectionKey);\n    const doc = await pack.getDocument(entryId);\n    doc.sheet.render(true, { focus: true });\n  }\n\n  /**\n   * Handle a new drag event from the compendium, create a placeholder token for dropping the item\n   *\n   * @param event\n   * @private\n   */\n  _onDragStart(event) {\n    const li = this,\n      packName = li.getAttribute(\"data-collection\"),\n      pack = game.packs.find((p) => p.collection === packName);\n\n    // Get the pack\n    if (!pack) {\n      event.preventDefault();\n      return false;\n    }\n\n    // Set the transfer data\n    event.dataTransfer.setData(\n      \"text/plain\",\n      JSON.stringify({\n        type: pack.documentClass.documentName,\n        uuid: li.getAttribute(\"data-uuid\"),\n      })\n    );\n  }\n\n  _toggleFilterVisibility(event) {\n    event.preventDefault();\n    const title = event.currentTarget;\n    const content = $(title).siblings(\".filter-content\")[0];\n\n    if (content.style.display === \"none\") content.style.display = \"block\";\n    else content.style.display = \"none\";\n  }\n\n  _onFilterResults(event) {\n    event.preventDefault();\n    const input = event.currentTarget;\n\n    // Define filtering function\n    const filter = async (query) => {\n      this.filterQuery = query;\n      await this._filterResults();\n    };\n\n    // Filter if we are done entering keys\n    const query = new RegExp(RegExp.escape(input.value), \"i\");\n    this.searchString = input.value;\n    if (this._filterTimeout) {\n      clearTimeout(this._filterTimeout);\n      this._filterTimeout = null;\n    }\n    this._filterTimeout = setTimeout(() => filter(query), 100);\n  }\n\n  _onActivateBooleanFilter(event) {\n    event.preventDefault();\n    const input = event.currentTarget;\n    const path = input.closest(\".filter\").dataset.path;\n    const key = input.name;\n    const value = input.checked;\n\n    const filter = this._data.filters.find((o) => o.path === path);\n    if (filter) {\n      if (!filter.active) filter.active = {};\n    }\n\n    if (value) {\n      const index = this.activeFilters[path].indexOf(key);\n      if (index < 0) {\n        this.activeFilters[path].push(key);\n        filter.active[key] = true;\n      }\n    } else {\n      const index = this.activeFilters[path].indexOf(key);\n      if (index >= 0) {\n        this.activeFilters[path].splice(index, 1);\n        if (filter.active[key] != null) delete filter.active[key];\n      }\n    }\n\n    // Save filter settings\n    {\n      const settings = game.settings.get(\"ffd20\", \"compendiumFilters\");\n      setProperty(settings, `${this.type}.activeFilters`, this.activeFilters);\n      game.settings.set(\"ffd20\", \"compendiumFilters\", settings);\n    }\n\n    return this._filterResults();\n  }\n\n  async _filterResults() {\n    this.lazyIndex = 0;\n    // Clear entry elements\n    this._clearEntryElements();\n\n    // Scroll up\n    const rootElem = this.element.find(\".directory-list\")[0];\n    rootElem.scrollTop = 0;\n\n    // Create new elements\n    await this._createInitialElements();\n\n    // Determine filtered item count\n    this._determineFilteredItemCount();\n  }\n\n  _determineFilteredItemCount() {\n    let itemCount = 0;\n    for (const item of this.items) {\n      if (this._passesFilters(item.item)) {\n        itemCount++;\n      }\n    }\n    this.element\n      .find('span[data-type=\"filterItemCount\"]')\n      .text(game.i18n.localize(\"FFD20.FilteredItems\").format(itemCount));\n  }\n\n  _passesFilters(item) {\n    if (!this.filterQuery.test(item.name)) return false;\n\n    for (let [path, filter] of Object.entries(this.activeFilters)) {\n      if (filter.length === 0) continue;\n\n      // Handle special cases\n      // Handle Spell Level\n      {\n        let result = null;\n        if (this.type === \"spells\" && path === \"_spellLevel\") {\n          result = false;\n          let hasActiveFilter = false;\n          const spellLevels = this.activeFilters[path];\n          const checks = [\n            { path: \"learnedAt.class\", type: \"class\" },\n            { path: \"learnedAt.domain\", type: \"domain\" },\n            { path: \"learnedAt.subDomain\", type: \"subDomain\" },\n            { path: \"learnedAt.elementalSchool\", type: \"elementalSchool\" },\n            { path: \"learnedAt.bloodline\", type: \"bloodline\" },\n          ];\n          for (const c of checks) {\n            const f = this.activeFilters[c.path];\n            if (!f || !f.length) continue;\n            hasActiveFilter = true;\n            for (const fi of f) {\n              const p = getProperty(item, `learnedAt.spellLevel.${c.type}`);\n              for (const sl of spellLevels) {\n                if (p[fi] === parseInt(sl)) result = true;\n              }\n            }\n          }\n          if (!hasActiveFilter) {\n            for (const sl of spellLevels) {\n              if (item.allSpellLevels.includes(parseInt(sl))) result = true;\n            }\n          }\n        }\n        if (result === false) return false;\n        else if (result === true) continue;\n      }\n\n      // Handle the rest\n      const prop = getProperty(item, path);\n      if (prop == null) return false;\n      if (typeof prop === \"number\") {\n        filter = filter.map((o) => parseFloat(o)).filter((o) => !isNaN(o));\n      }\n      if (prop instanceof Array) {\n        if (!filter.every((o) => prop.includes(o))) return false;\n        continue;\n      }\n      if (!filter.includes(prop)) return false;\n    }\n\n    return true;\n  }\n\n  getSaveEntries() {\n    const result = [];\n\n    const propKeys = [\"_id\", \"name\", \"img\", \"uuid\"];\n\n    switch (this.type) {\n      case \"spells\":\n        propKeys.push(\n          \"system.learnedAt.class\",\n          \"system.learnedAt.domain\",\n          \"system.learnedAt.subDomain\",\n          \"system.learnedAt.elementalSchool\",\n          \"system.learnedAt.bloodline\",\n          \"system.school\",\n          \"system.multischool\",\n          \"system.subschool\",\n          \"system.types\"\n        );\n        break;\n      case \"items\":\n        propKeys.push(\n          \"type\",\n          \"system.properties\",\n          \"system.weaponType\",\n          \"system.weaponSubtype\",\n          \"system.equipmentType\",\n          \"system.equipmentSubtype\",\n          \"system.slot\",\n          \"system.consumableType\",\n          \"system.subType\"\n        );\n        break;\n      case \"feats\":\n        propKeys.push(\"system.featType\", \"system.associations.classes\", \"system.tags\");\n        break;\n      case \"bestiary\":\n        propKeys.push(\"system.details.cr.total\");\n        break;\n      case \"classes\":\n        propKeys.push(\n          \"system.classType\",\n          \"system.classSubTypes\",\n          \"system.parentClass\",\n          \"system.bab\",\n          \"system.hd\",\n          \"system.classBaseMPTypes\",\n          \"system.classCastingStat\",\n          \"system.skillsPerLevel\",\n          \"system.savingThrows.fort.value\",\n          \"system.savingThrows.ref.value\",\n          \"system.savingThrows.will.value\"\n        );\n        break;\n      case \"races\":\n        propKeys.push(\"system.creatureType\", \"system.subTypes\");\n        break;\n    }\n\n    for (const i of this.items) {\n      const resultObj = {\n        collection: i.collection,\n        item: {},\n      };\n\n      // Copy parsed properties\n      for (const k of Object.keys(i.item)) {\n        if (k !== \"data\") {\n          resultObj.item[k] = i.item[k];\n        }\n      }\n\n      // Copy specific data properties\n      for (const k of propKeys) {\n        if (hasProperty(i.item, k)) {\n          setProperty(resultObj, `item.${k}`, getProperty(i.item, k));\n        }\n      }\n\n      result.push(resultObj);\n    }\n\n    return result;\n  }\n\n  saveEntries() {\n    const entries = this.getSaveEntries();\n\n    const settings = game.settings.get(\"ffd20\", \"compendiumItems\") || {};\n    settings[this.type] = entries;\n\n    return game.settings.set(\"ffd20\", \"compendiumItems\", settings);\n  }\n\n  clearEntries() {\n    const settings = game.settings.get(\"ffd20\", \"compendiumItems\") || {};\n    settings[this.type] = [];\n\n    return game.settings.set(\"ffd20\", \"compendiumItems\", settings);\n  }\n}\n","import { CompendiumBrowser } from \"./compendium-browser.mjs\";\n\nexport class SidebarFFD20 extends Sidebar {\n  constructor(...args) {\n    super(...args);\n\n    this.compendiums = {\n      spells: new CompendiumBrowser({ type: \"spells\", documentType: \"Item\" }),\n      items: new CompendiumBrowser({ type: \"items\", documentType: \"Item\" }),\n      bestiary: new CompendiumBrowser({ type: \"bestiary\", documentType: \"Actor\" }),\n    };\n  }\n\n  async _render(...args) {\n    await super._render(...args);\n\n    const parent = this.element.find(\"#compendium .directory-footer\");\n    const child = await renderTemplate(\"systems/ffd20/templates/sidebar/compendiums-footer.hbs\", {});\n    parent.append(child);\n    this.activateExtraListeners(parent);\n  }\n\n  activateExtraListeners(html) {\n    html.find(\".compendium-footer .compendium.spells\").click((e) => this._onBrowseCompendium(e, \"spells\"));\n    html.find(\".compendium-footer .compendium.items\").click((e) => this._onBrowseCompendium(e, \"items\"));\n    html.find(\".compendium-footer .compendium.bestiary\").click((e) => this._onBrowseCompendium(e, \"bestiary\"));\n  }\n\n  _onBrowseCompendium(event, type) {\n    event.preventDefault();\n\n    this.compendiums[type]._render(true);\n  }\n}\n","import { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\nexport class ExperienceDistributor extends FormApplication {\n  /**\n   * @constructs ExperienceDistributor\n   * @param {ActorFFD20[]} [actors] - Actors to add to this distributor.\n   * @param {object} [options] - Options for this application.\n   */\n  constructor(actors = [], options = {}) {\n    actors = actors\n      .map((o) => {\n        return ExperienceDistributor.getActorData(o);\n      })\n      .filter((o) => o != null);\n    super(actors, options);\n    this.bonusXP = 0;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"xp-distributor\"],\n      title: game.i18n.localize(\"FFD20.Application.XPDistributor.Title\"),\n      template: \"systems/ffd20/templates/apps/xp-distributor.hbs\",\n      width: 430,\n      height: 794,\n      resizable: true,\n      scrollY: [\".selectors\"],\n    });\n  }\n\n  getData() {\n    const result = super.getData();\n\n    // Add combatants\n    result.actors = {\n      characters: this.getCharacters(),\n      npcs: this.getNPCs(),\n    };\n\n    // Add labels\n    result.labels = {\n      xp: {\n        total: `+ ${this.getTotalExperience().toLocaleString()}`,\n        split: `+ ${this.getSplitExperience().toLocaleString()}`,\n      },\n    };\n\n    result.bonusXP = this.bonusXP;\n\n    return result;\n  }\n\n  getCharacters() {\n    return this.object.filter((o) => o.actor.type === \"character\");\n  }\n\n  getNPCs() {\n    return this.object.filter((o) => o.actor.type === \"npc\");\n  }\n\n  activateListeners(html) {\n    if (jQuery != null && html instanceof jQuery) html = html[0];\n    const addListener = (query, ev, callback) =>\n      html.querySelectorAll(query).forEach((elem) => elem.addEventListener(ev, callback));\n\n    addListener(\".character-selector .actor, .npc-selector .actor\", \"click\", this._onClickActor.bind(this));\n\n    addListener(\".bonus-xp input\", \"change\", (event) => {\n      event.preventDefault();\n\n      this.bonusXP = parseInt(event.currentTarget.value);\n      if (isNaN(this.bonusXP)) this.bonusXP = 0;\n\n      this.render();\n    });\n\n    // Allow dropping actors from the sidebar to add them to the list\n    html.addEventListener(\"drop\", this._onDrop.bind(this));\n\n    addListener('button[name=\"split-evenly\"], button[name=\"give-to-all\"]', \"click\", this._onSubmit.bind(this));\n    addListener('button[name=\"cancel\"]', \"click\", this._onCancel.bind(this));\n  }\n\n  async _onDrop(event) {\n    event.preventDefault();\n    const data = TextEditor.getDragEventData(event);\n\n    // Add actor\n    if (data.type === \"Actor\") {\n      const actor = await Actor.implementation.fromDropData(data);\n\n      // Prevent duplicate characters (not NPCs)\n      if (actor.type !== \"character\" || this.object.find((o) => o.actor === actor) == null) {\n        // Add actor to list\n        this.object.push(mergeObject(this.constructor.getActorData(actor), { toggled: true }));\n        this.render(true);\n      }\n    }\n  }\n\n  _onClickActor(event) {\n    event.preventDefault();\n\n    const a = event.currentTarget;\n    const actorID = event.currentTarget.dataset.id;\n    const actor = this.object.find((o) => o.id === actorID);\n\n    if (!actor) return;\n\n    if (actor.toggled) {\n      actor.toggled = false;\n      a.classList.remove(\"toggled\");\n    } else {\n      actor.toggled = true;\n      a.classList.add(\"toggled\");\n    }\n\n    this.render();\n  }\n\n  async _onSubmit(event) {\n    event.preventDefault();\n\n    const type = event.currentTarget.name;\n\n    const value = type === \"split-evenly\" ? this.getSplitExperience() : this.getTotalExperience();\n\n    if (value > 0) {\n      const characters = this.getCharacters().filter((o) => o.toggled);\n\n      for (const actorData of characters) {\n        const result = { value: value };\n        callOldNamespaceHookAll(\"ffd20.gainXp\", \"ffd20GainXp\", actorData.actor, result);\n        Hooks.callAll(\"ffd20GainXp\", actorData.actor, result);\n        actorData.value = result.value;\n      }\n\n      const updates = characters\n        .map((o) => {\n          if (o.value === 0 || !Number.isFinite(o.value)) return null;\n          return {\n            _id: o.actor.id,\n            \"system.details.xp.value\": o.actor.system.details.xp.value + Math.floor(o.value),\n          };\n        })\n        .filter((o) => o != null);\n      Actor.implementation.updateDocuments(updates);\n    }\n\n    this.close();\n  }\n\n  _onCancel(event) {\n    event.preventDefault();\n\n    this.close();\n  }\n\n  getTotalExperience() {\n    const npcs = this.getNPCs().filter((o) => o.toggled);\n\n    return npcs.reduce((cur, o) => {\n      return cur + o.xp;\n    }, this.bonusXP);\n  }\n\n  getSplitExperience() {\n    const characters = this.getCharacters().filter((o) => o.toggled);\n    const xp = this.getTotalExperience();\n\n    const hasAnyCharacters = characters.length > 0;\n\n    if (hasAnyCharacters) return Math.floor(xp / characters.length);\n    return 0;\n  }\n\n  static getActorData(actor) {\n    if (!(actor instanceof Actor)) return null;\n    const type = actor.type;\n    const xp = type === \"npc\" ? actor.system.details.xp.value ?? 0 : 0;\n\n    return {\n      id: randomID(16),\n      actor: actor,\n      toggled: this.shouldActorBeToggled(actor),\n      xp,\n      xpString: xp.toLocaleString(),\n    };\n  }\n\n  static shouldActorBeToggled(actor) {\n    const isPC = actor.type === \"character\";\n    const isDefeated = actor.system.attributes.hp.value < 0;\n\n    if (!isPC && !isDefeated) return false;\n\n    return true;\n  }\n}\n","export class DamageTypeSelector extends FormApplication {\n  constructor(object, dataPath, data, options = {}) {\n    super(object, options);\n    this._dataPath = dataPath;\n    this._data = deepClone(data);\n    if (!this._data) this._data = [];\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      width: 720,\n      height: 580,\n      template: \"systems/ffd20/templates/apps/damage-type-selector.hbs\",\n      closeOnSubmit: true,\n    });\n  }\n  get title() {\n    return game.i18n.localize(\"FFD20.DamageType\");\n  }\n  get id() {\n    return `action-${this.object.id}_${this._dataPath}`;\n  }\n\n  get damageCategorySortOrder() {\n    return [\"physical\", \"energy\", \"misc\"];\n  }\n\n  async getData(options) {\n    const data = await super.getData(options);\n\n    const damageTypes = ffd20.registry.damageTypes;\n    data.damageTypes = damageTypes.filter((o) => !o.isModifier).map((o) => o.toJSON());\n\n    // Add damage type categories\n    data.damageCategories = data.damageTypes.reduce((cur, o) => {\n      let categoryObj = cur.find((o2) => o2.key === o.category);\n      if (!categoryObj) {\n        categoryObj = { key: o.category, label: `FFD20.DamageTypeCategory.${o.category}`, data: [] };\n        cur.push(categoryObj);\n      }\n      categoryObj.data.push(o);\n      return cur;\n    }, []);\n    // Sort damage type categories\n    {\n      const sortOrder = this.damageCategorySortOrder;\n      data.damageCategories = data.damageCategories.sort((a, b) => {\n        const idxA = sortOrder.indexOf(a.key);\n        const idxB = sortOrder.indexOf(b.key);\n        if (idxA === -1 && idxB >= 0) return 1;\n        if (idxB === -1 && idxA >= 0) return -1;\n        if (idxA > idxB) return 1;\n        if (idxA < idxB) return -1;\n        return 0;\n      });\n    }\n\n    data.damageModifiers = damageTypes.filter((o) => o.isModifier).map((o) => o.toJSON());\n    data.data = this._data;\n\n    return data;\n  }\n\n  activateListeners(html) {\n    html.find(`.damage-type`).on(\"click\", this._toggleDamageType.bind(this));\n    html.find(`*[name]`).on(\"change\", this._onChangeData.bind(this));\n  }\n\n  _onChangeData(event) {\n    event.preventDefault();\n    const elem = event.currentTarget;\n    const dataPath = elem.name;\n\n    let value = elem.value;\n    if (elem.type === \"checkbox\") value = elem.checked;\n\n    switch (elem.dataset.dtype) {\n      case \"Boolean\":\n        value = Boolean(value);\n        break;\n      case \"Number\":\n        value = Number(value);\n        break;\n    }\n\n    setProperty(this._data, dataPath, value);\n  }\n\n  _toggleDamageType(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const dt = a.dataset.id;\n\n    if (this._data.values.includes(dt)) this._data.values.splice(this._data.values.indexOf(dt), 1);\n    else this._data.values.push(dt);\n    this.render();\n  }\n\n  async _updateObject(event, formData) {\n    formData = expandObject(formData);\n    const result = this._data;\n\n    return this.object.update({ [this._dataPath]: result });\n  }\n}\n","export class ActiveEffectFFD20 extends ActiveEffect {\n  async create(data, context = {}) {\n    const statusId = this.flags?.core?.statusId,\n      origin = this.origin,\n      updates = {};\n    if (statusId && this.parent?.system.attributes.conditions[statusId] === false) {\n      updates[`system.attributes.conditions.${statusId}`] = true;\n      await this.parent.update(updates);\n      const created = this.parent.effects.find((e) => e.getFlag(\"core\", \"statusId\") === statusId);\n      if (created) return created;\n    }\n    if (origin) {\n      const buffItem = this.parent.items.get(origin.split(\".\")[3]);\n      if (buffItem && !buffItem.system.active) await buffItem.setActive(true);\n    }\n    return super.create(data, context);\n  }\n\n  async delete(context = {}) {\n    const statusId = this.getFlag(\"core\", \"statusId\"),\n      re = this.origin?.match(/Item\\.(?<itemId>\\w+)/),\n      origin = re?.groups.itemId,\n      parentActor = this.parent,\n      secondaryContext = statusId || origin ? { render: false } : {},\n      returnVal = await super.delete(mergeObject(secondaryContext, context));\n    if (statusId && parentActor.system.attributes.conditions[statusId]) {\n      const updates = { [`system.attributes.conditions.${statusId}`]: false };\n      await parentActor.update(updates, context);\n    } else if (origin) {\n      const item = parentActor.items.get(origin);\n      if (!(context.type === \"delete\" && context.document === item)) {\n        item?.setActive(false, context);\n      }\n    }\n    return returnVal;\n  }\n\n  get isTemporary() {\n    const duration = this.duration.seconds ?? (this.duration.rounds || this.duration.turns) ?? 0;\n    return duration > 0 || this.getFlag(\"core\", \"statusId\") || this.getFlag(\"ffd20\", \"show\");\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\n\nexport class ItemAttackFFD20 extends ItemFFD20 {\n  getConditionalTargets() {\n    const result = super.getConditionalTargets();\n\n    result[\"size\"] = game.i18n.localize(CONFIG.FFD20.conditionalTargets.size._label);\n\n    return result;\n  }\n\n  prepareData() {\n    super.prepareData();\n\n    const weaponGroups = this.system.weaponGroups || { value: [], custom: \"\" };\n\n    weaponGroups.selected = weaponGroups.value.reduce((obj, t) => {\n      obj[t] = CONFIG.FFD20.weaponGroups[t];\n      return obj;\n    }, {});\n\n    // Add custom entry\n    if (weaponGroups.custom) {\n      weaponGroups.custom\n        .split(CONFIG.FFD20.re.traitSeparator)\n        .forEach((c, i) => (weaponGroups.selected[`custom${i + 1}`] = c.trim()));\n    }\n\n    weaponGroups.cssClass = foundry.utils.isEmpty(weaponGroups.selected) ? \"inactive\" : \"\";\n  }\n\n  get subType() {\n    return this.system.attackType;\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\n\nexport class ItemBuffFFD20 extends ItemFFD20 {\n  async _preUpdate(changed, options, userId) {\n    // Add activation time when not present\n    if (changed.system?.active && changed.system?.duration?.start === undefined) {\n      setProperty(changed, \"system.duration.start\", game.time.worldTime);\n    }\n\n    return super._preUpdate(changed, options, userId);\n  }\n\n  async _preDelete(options, user) {\n    // Delete associated effect\n    const effect = this.effect;\n    if (effect) {\n      await effect.delete({ type: \"delete\", document: this });\n    }\n\n    // Run script call(s)\n    if (user.id === game.user.id) {\n      if (this.isActive) {\n        this.executeScriptCalls(\"toggle\", { state: false });\n      }\n    }\n\n    return super._preDelete(options, user);\n  }\n\n  prepareData() {\n    const itemData = super.prepareData();\n    const data = itemData;\n    const labels = this.labels;\n    const C = CONFIG.FFD20;\n\n    labels.buffType = C.buffTypes[data.buffType];\n\n    if (this.system.duration) {\n      const dur = this.system.duration;\n      const unit = C.timePeriodsShort[dur.units];\n      if (unit && dur.value) {\n        const val = RollFFD20.safeTotal(dur.value, this.getRollData());\n        labels.duration = [val, unit].filterJoin(\" \");\n      } else {\n        labels.duration = null;\n      }\n    }\n  }\n\n  prepareDerivedItemData() {\n    super.prepareDerivedItemData();\n    const itemData = this.system;\n\n    // Add total duration in seconds\n    if (itemData.duration.value?.length) {\n      let seconds = 0;\n      const rollData = this.getRollData();\n      const duration = RollFFD20.safeRoll(itemData.duration.value || \"0\", rollData).total;\n      switch (itemData.duration.units) {\n        case \"hour\":\n          seconds = duration * 60 * 60;\n          break;\n        case \"minute\":\n          seconds = duration * 60;\n          break;\n        case \"round\":\n          seconds = duration * 6;\n          break;\n      }\n\n      itemData.duration.totalSeconds = seconds;\n    }\n  }\n\n  // Creates a simple ActiveEffect from a buff item. Returns the effect\n  async toEffect({ noCreate = false } = {}) {\n    if (!this.parent) return;\n\n    const existing = this.parent.effects.find((e) => e.data.origin == this.uuid);\n    if (existing || noCreate) return existing;\n\n    // Add a new effect\n    const createData = {\n      label: this.name,\n      icon: this.img,\n      origin: this.uuid,\n      disabled: !this.data.active,\n      flags: {\n        ffd20: {\n          show: !this.data.hideFromToken && !game.settings.get(\"ffd20\", \"hideTokenConditions\"),\n          origin: { item: this.id },\n        },\n      },\n    };\n    const effect = ActiveEffect.create(createData, { parent: this.parent });\n\n    return effect;\n  }\n\n  // Determines the starting data for an ActiveEffect based off this item\n  getRawEffectData() {\n    const createData = super.getRawEffectData();\n\n    const hideIcon = this.system.hideFromToken || game.settings.get(\"ffd20\", \"hideTokenConditions\");\n    createData[\"flags.ffd20.show\"] = !hideIcon;\n    if (hideIcon) createData.icon = null;\n\n    // Add buff durations\n    let durationValue = this.system.duration.value ?? null;\n    if (typeof durationValue == \"number\") durationValue += \"\";\n    if (durationValue) {\n      let seconds = 0;\n      switch (this.system.duration.units) {\n        case \"minute\":\n        case \"hour\": {\n          seconds = this.totalDurationSeconds;\n          break;\n        }\n        case \"turn\": {\n          const turns = RollFFD20.safeRoll(durationValue, this.getRollData()).total;\n          if (turns > 0) {\n            createData.duration.turns = turns;\n            seconds = turns * 6;\n          }\n          break;\n        }\n        case \"round\": {\n          const rounds = RollFFD20.safeRoll(durationValue, this.getRollData()).total;\n          if (rounds > 0) {\n            createData.duration.rounds = rounds;\n            seconds = rounds * 6;\n          }\n          break;\n        }\n      }\n      if (seconds > 0) createData.duration.seconds = seconds;\n    }\n\n    return createData;\n  }\n\n  getRollData() {\n    const result = super.getRollData();\n\n    result.item.level = this.system.level;\n\n    return result;\n  }\n\n  get isActive() {\n    return this.system.active;\n  }\n\n  get subType() {\n    return this.system.buffType;\n  }\n\n  get effect() {\n    return this.parentActor?.effects.find((o) => o.origin?.indexOf(`Item.${this.id}`) > 0);\n  }\n\n  /**\n   * @param {boolean} active\n   * @param {object} context Optional update context\n   * @returns {Promise} Update promise\n   * @override\n   */\n  async setActive(active, context) {\n    return this.update({ \"system.active\": active }, context);\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\nimport { createTag } from \"../../utils/lib.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\nimport { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\nexport class ItemClassFFD20 extends ItemFFD20 {\n  async _preUpdate(update, context, userId) {\n    await super._preUpdate(update, context, userId);\n\n    // Set level marker\n    if (hasProperty(update, \"system.level\")) {\n      this._prevLevel = this.system.level;\n    }\n  }\n\n  async update(data, context = {}) {\n    await super.update(data, context);\n\n    // Update class\n    const newLevel = data[\"system.level\"] || getProperty(data, \"system.level\");\n    if (newLevel !== undefined && this.parent) {\n      const prevLevel = this._prevLevel;\n      if (prevLevel !== undefined) {\n        delete this._prevLevel;\n        await this._onLevelChange(prevLevel, newLevel);\n      }\n    }\n  }\n\n  async delete(context = {}) {\n    await this._onLevelChange(this.system.level, 0);\n    return super.delete(context);\n  }\n\n  async _onLevelChange(curLevel, newLevel) {\n    if (!this.parent) return;\n    const actor = this.parentActor;\n\n    // Add items associated to this class\n    if (newLevel > curLevel) {\n      const classAssociations = (getProperty(this, \"system.links.classAssociations\") || []).filter((o, index) => {\n        o.__index = index;\n        return o.level > curLevel && o.level <= newLevel;\n      });\n\n      const newItems = [];\n      for (const co of classAssociations) {\n        const collection = co.id.split(\".\").slice(0, 2).join(\".\");\n        const itemId = co.id.split(\".\")[2];\n        const pack = game.packs.get(collection);\n        const item = await pack.getDocument(itemId);\n        if (!item) {\n          const msg = `Could not find class association: ${co.id}`;\n          console.warn(co.id, msg, this);\n          ui.notifications?.warn(msg);\n          continue;\n        }\n\n        // Apply Foundry's transformations for importing\n        // This adds flags.core.sourceId, removes extraneous permissions, resets sorting, etc.\n        const itemData = game.items.fromCompendium(item);\n\n        // Set temporary flag\n        setProperty(itemData, \"flags.ffd20.__co.level\", duplicate(co.level));\n\n        delete itemData._id;\n        newItems.push({ data: itemData, co: co });\n      }\n\n      if (newItems.length) {\n        const items = await actor.createEmbeddedDocuments(\n          \"Item\",\n          newItems.map((o) => o.data)\n        );\n\n        const updateData = [];\n        const classUpdateData = { _id: this.id };\n        updateData.push(classUpdateData);\n        for (const i of items) {\n          const co = i.getFlag(\"ffd20\", \"__co\");\n          // Set class association flags\n          classUpdateData[`flags.ffd20.links.classAssociations.${i.id}`] = co.level;\n          // Remove temporary flag\n          updateData.push({ _id: i.id, \"flags.ffd20.-=__co\": null });\n        }\n        if (updateData.length) {\n          await actor.updateEmbeddedDocuments(\"Item\", updateData);\n        }\n      }\n    }\n\n    // Remove items associated to this class\n    if (newLevel < curLevel) {\n      const associations = duplicate(this.getFlag(\"ffd20\", \"links.classAssociations\") || {});\n      const itemIds = [];\n      for (const [id, level] of Object.entries(associations)) {\n        const item = this.parent.items.get(id);\n        if (!item) {\n          delete associations[id];\n          continue;\n        }\n\n        if (level > newLevel) {\n          itemIds.push(item.id);\n          delete associations[id];\n        }\n      }\n      await this.setFlag(\"ffd20\", \"links.classAssociations\", associations);\n      await Item.implementation.deleteDocuments(itemIds, { parent: this.parent });\n    }\n\n    // Call level change hook\n    callOldNamespaceHookAll(\"ffd20.classLevelChange\", \"ffd20ClassLevelChange\", this.actor, this, curLevel, newLevel);\n    Hooks.callAll(\"ffd20ClassLevelChange\", this.actor, this, curLevel, newLevel);\n  }\n\n  prepareBaseData() {\n    super.prepareBaseData();\n    const itemData = this.system;\n    // Reset cached HD/MT\n    // Can't prepare here as the actor uses this info before item preparation is done.\n    itemData.hitDice = undefined;\n    itemData.mythicTier = undefined;\n  }\n\n  prepareDerivedData() {\n    super.prepareDerivedData();\n\n    const itemData = this.system;\n\n    const useFractional = game.settings.get(\"ffd20\", \"useFractionalBaseBonuses\");\n\n    // Prepare class base save\n    {\n      const saveFormulas = useFractional\n        ? CONFIG.FFD20.classFractionalSavingThrowFormulas\n        : CONFIG.FFD20.classSavingThrowFormulas;\n\n      for (const save of Object.keys(CONFIG.FFD20.savingThrows)) {\n        const classType = itemData.classType || \"base\";\n        let formula;\n        const saveData = itemData.savingThrows[save];\n        const saveType = saveData.value;\n        if (saveType === \"custom\") {\n          formula = saveData.custom || \"0\";\n        } else {\n          formula = saveFormulas[classType][saveType];\n        }\n        if (formula == null) formula = \"0\";\n        const total = RollFFD20.safeRoll(formula, { level: itemData.level, hitDice: this.hitDice }).total;\n        saveData.base = total;\n        if (useFractional) saveData.good = saveFormulas[classType].goodSave === true && saveType === \"high\";\n      }\n    }\n\n    // Prepare BAB\n    {\n      const babFormulas = useFractional ? CONFIG.FFD20.classFractionalBABFormulas : CONFIG.FFD20.classBABFormulas;\n\n      const babType = itemData.bab;\n      let formula;\n      if (babType === \"custom\") {\n        formula = itemData.babFormula || \"0\";\n      } else {\n        formula = babFormulas[babType] || \"0\";\n      }\n      itemData.babBase = RollFFD20.safeRoll(formula, { level: itemData.level, hitDice: this.hitDice }).total;\n    }\n\n    // Feed info back to actor\n    const actor = this.actor;\n    // Test against actor.data to avoid unlinked token weirdness\n    if (actor?.system) {\n      const actorData = actor.system,\n        classData = this.system;\n\n      let tag = classData.tag;\n      if (!tag) tag = createTag(this.name);\n\n      let healthConfig = game.settings.get(\"ffd20\", \"healthConfig\");\n      const hasPlayerOwner = this.hasPlayerOwner;\n      healthConfig =\n        classData.classType === \"racial\"\n          ? healthConfig.hitdice.Racial\n          : hasPlayerOwner\n          ? healthConfig.hitdice.PC\n          : healthConfig.hitdice.NPC;\n\n      if (!classData.classType) console.warn(`${this.name} lacks class type`, this);\n      const isBaseClass = (classData.classType || \"base\") === \"base\";\n      if (!this.actor.classes) return;\n      actor.classes[tag] = {\n        level: classData.level,\n        name: this.name,\n        hd: classData.hd,\n        hitDice: this.hitDice,\n        mythicTier: this.mythicTier,\n        bab: classData.bab,\n        hp: healthConfig.auto,\n        savingThrows: {\n          fort: classData.savingThrows.fort.base,\n          ref: classData.savingThrows.ref.base,\n          will: classData.savingThrows.will.base,\n        },\n        fc: {\n          hp: isBaseClass ? classData.fc.hp.value : 0,\n          skill: isBaseClass ? classData.fc.skill.value : 0,\n          alt: isBaseClass ? classData.fc.alt.value : 0,\n        },\n      };\n    }\n  }\n\n  get subType() {\n    return this.system.classType;\n  }\n\n  get hitDice() {\n    const itemData = this.system;\n    if (itemData.hitDice === undefined) {\n      if (itemData.customHD?.length > 0) {\n        const rollData = { item: { level: this.system.level } };\n        itemData.hitDice = RollFFD20.safeRoll(itemData.customHD, rollData).total;\n      } else {\n        itemData.hitDice = this.subType === \"mythic\" ? 0 : itemData.level;\n      }\n    }\n\n    return itemData.hitDice;\n  }\n\n  get mythicTier() {\n    const itemData = this.system;\n    if (itemData.mythicTier === undefined) {\n      itemData.mythicTier = this.subType === \"mythic\" ? itemData.level : 0;\n    }\n    return itemData.mythicTier;\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\n\nexport class ItemConsumableFFD20 extends ItemFFD20 {\n  get subType() {\n    return this.system.consumableType;\n  }\n\n  async _preDelete(options, user) {\n    if (user.id === game.user.id) {\n      if (this.system.quantity > 0) {\n        this.executeScriptCalls(\"changeQuantity\", { quantity: { previous: this.system.quantity, new: 0 } });\n      }\n    }\n\n    return super._preDelete(options, user);\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\n\nexport class ItemContainerFFD20 extends ItemFFD20 {\n  async _preDelete(options, user) {\n    if (user.id === game.user.id) {\n      if (this.system.quantity > 0) {\n        this.executeScriptCalls(\"changeQuantity\", { quantity: { previous: this.system.quantity, new: 0 } });\n      }\n    }\n\n    return super._preDelete(options, user);\n  }\n\n  /** @inheritdoc */\n  prepareBaseData() {\n    super.prepareBaseData();\n\n    // HACK: Migration shim\n    if (typeof this.system.weight !== \"object\") {\n      this.system.weight = {\n        value: this.system.weight,\n      };\n    }\n\n    // Set base weight to weight of coins, which can be calculated without knowing contained items\n    const weightReduction = (100 - (this.system.weightReduction ?? 0)) / 100;\n    this.system.weight.currency = this._calculateCoinWeight(this.system) * weightReduction;\n  }\n\n  /** @inheritDoc */\n  prepareWeight() {\n    super.prepareWeight();\n\n    /** @type {ItemWeightData} */\n    const weight = this.system.weight;\n    // Quantity can be ignored for containers\n    weight.contents = this.items.reduce(\n      (total, item) => total + item.system.weight.total,\n      this._calculateCoinWeight(this.system)\n    );\n    weight.converted.contents = ffd20.utils.convertWeight(weight.contents);\n  }\n\n  async createContainerContent(data, options = { raw: false }) {\n    const embeddedName = \"Item\";\n    const user = game.user;\n    const itemOptions = { temporary: false, renderSheet: false };\n\n    let inventory = duplicate(getProperty(this, \"system.inventoryItems\") || []);\n    // Iterate over data to create\n    data = data instanceof Array ? data : [data];\n    if (!(itemOptions.temporary || itemOptions.noHook)) {\n      for (const d of data) {\n        const allowed = Hooks.call(`preCreate${embeddedName}`, this, d, itemOptions, user.id);\n        if (allowed === false) {\n          console.debug(`${vtt} | ${embeddedName} creation prevented by preCreate hook`);\n          return null;\n        }\n\n        d._id = randomID(16);\n      }\n    }\n\n    // Add to updates\n    const items = data.map((o) => (options.raw ? o : new ItemFFD20(o).toObject()));\n    inventory.push(...items);\n\n    // Filter items with duplicate _id\n    {\n      const ids = [];\n      inventory = inventory.filter((i) => {\n        if (ids.includes(i._id)) return false;\n        ids.push(i._id);\n        return true;\n      });\n    }\n\n    await this.update({ \"system.inventoryItems\": inventory });\n  }\n\n  getContainerContent(itemId) {\n    return this.items.get(itemId);\n  }\n\n  async deleteContainerContent(data) {\n    const embeddedName = \"ContainerContent\";\n    const user = game.user;\n    const options = { noHook: false };\n\n    // Iterate over data to create\n    data = data instanceof Array ? data : [data];\n    const ids = new Set(data);\n\n    // Iterate over elements of the collection\n    const inventory = duplicate(getProperty(this, \"system.inventoryItems\") || []).filter((d) => {\n      if (!ids.has(d._id)) return true;\n\n      // Call pre-update hooks to ensure the update is allowed to proceed\n      if (!options.noHook) {\n        const allowed = Hooks.call(`preDelete${embeddedName}`, this, d, options, user.id);\n        if (allowed === false) {\n          console.debug(`${vtt} | ${embeddedName} update prevented by preUpdate hook`);\n          return true;\n        }\n      }\n\n      // Remove document from collection\n      return false;\n    }, []);\n\n    // Trigger the Socket workflow\n    await this.update({ \"system.inventoryItems\": inventory });\n  }\n\n  async updateContainerContents(data) {\n    const embeddedName = \"ContainerContent\";\n    const user = game.user;\n    const options = { diff: true };\n\n    // Structure the update data\n    const pending = new Map();\n    data = data instanceof Array ? data : [data];\n    for (const d of data) {\n      if (!d._id) throw new Error(\"You must provide an id for every Embedded Document in an update operation\");\n      pending.set(d._id, d);\n    }\n\n    // Difference each update against existing data\n    const updates = this.items.reduce((arr, d) => {\n      if (!pending.has(d.id)) return arr;\n      let update = pending.get(d.id);\n\n      // Diff the update against current data\n      if (options.diff) {\n        update = diffObject(d, expandObject(update));\n        if (foundry.utils.isEmpty(update)) return arr;\n        update[\"_id\"] = d.id;\n      }\n\n      // Call pre-update hooks to ensure the update is allowed to proceed\n      if (!options.noHook) {\n        const allowed = Hooks.call(`preUpdate${embeddedName}`, this, d, update, options, user.id);\n        if (allowed === false) {\n          console.debug(`${vtt} | ${embeddedName} update prevented by preUpdate hook`);\n          return arr;\n        }\n      }\n\n      // Stage the update\n      arr.push(update);\n      return arr;\n    }, []);\n    if (!updates.length) return [];\n    let inventory = duplicate(this.system.inventoryItems).map((o) => {\n      for (const u of updates) {\n        if (u._id === o._id) return mergeObject(o, u);\n      }\n      return o;\n    });\n\n    // Filter items with duplicate _id\n    {\n      const ids = [];\n      inventory = inventory.filter((i) => {\n        if (ids.includes(i._id)) return false;\n        ids.push(i._id);\n        return true;\n      });\n    }\n\n    await this.update({ \"system.inventoryItems\": inventory });\n  }\n\n  /** @inheritdoc */\n  getTotalCurrency({ inLowestDenomination = false } = {}) {\n    const currency = this.system.currency;\n    const total = currency.pgil * 1000 + currency.gil * 100 + currency.sgil * 10 + currency.cgil;\n    return inLowestDenomination ? total : total / 100;\n  }\n\n  /** @inheritdoc */\n  getValue({ recursive = true, sellValue = 0.5, inLowestDenomination = false, forceUnidentified = false } = {}) {\n    let result = super.getValue(...arguments);\n\n    if (!recursive) return result;\n\n    // Add item's content items' values\n    this.items.forEach((i) => {\n      result += i.getValue({ recursive: recursive, sellValue: sellValue, inLowestDenomination });\n    });\n\n    return result;\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\n\nexport class ItemEquipmentFFD20 extends ItemFFD20 {\n  async _preUpdate(update, context) {\n    // Set equipment subtype and slot\n    const type = getProperty(update, \"system.equipmentType\");\n    if (type !== undefined && type !== this.data.equipmentType) {\n      // Set subtype\n      const subtype = getProperty(update, \"system.equipmentSubtype\") ?? this.data.equipmentSubtype ?? \"\";\n      let keys = Object.keys(CONFIG.FFD20.equipmentTypes[type]).filter((o) => !o.startsWith(\"_\"));\n      if (!subtype || !keys.includes(subtype)) {\n        setProperty(update, \"system.equipmentSubtype\", keys[0]);\n      }\n\n      // Set slot\n      const slot = getProperty(update, \"system.slot\") ?? this.data.slot ?? \"\";\n      keys = Object.keys(CONFIG.FFD20.equipmentSlots[type]);\n      if (!slot || !keys.includes(slot)) {\n        setProperty(update, \"system.slot\", keys[0]);\n      }\n    }\n  }\n\n  async _preDelete(options, user) {\n    if (user.id === game.user.id) {\n      if (this.isActive) {\n        this.executeScriptCalls(\"equip\", { equipped: false });\n      }\n\n      if (this.system.quantity > 0) {\n        this.executeScriptCalls(\"changeQuantity\", { quantity: { previous: this.system.quantity, new: 0 } });\n      }\n    }\n\n    return super._preDelete(options, user);\n  }\n\n  get subType() {\n    return this.system.equipmentType;\n  }\n\n  prepareData() {\n    const itemData = super.prepareData();\n    const data = itemData;\n    const labels = this.labels;\n    const C = CONFIG.FFD20;\n\n    // Type and subtype labels\n    let eType = this.subType;\n    const typeKeys = Object.keys(C.equipmentTypes);\n    if (!typeKeys.includes(eType)) eType = typeKeys[0];\n\n    let eSubtype = this.system.equipmentSubtype;\n    const subtypeKeys = Object.keys(C.equipmentTypes[eType]).filter((o) => !o.startsWith(\"_\"));\n    if (!subtypeKeys.includes(eSubtype)) eSubtype = subtypeKeys[0];\n\n    labels.equipmentType = C.equipmentTypes[eType]._label;\n    labels.equipmentSubtype = C.equipmentTypes[eType][eSubtype];\n\n    // AC labels\n    const ac = this.showUnidentifiedData ? data.armor.value || 0 : (data.armor.value || 0) + (data.armor.enh || 0);\n    labels.armor = ac > 0 ? `${ac} AC` : \"\";\n    if (data.armor.dex === \"\") data.armor.dex = null;\n    else if (typeof data.armor.dex === \"string\" && /\\d+/.test(data.armor.dex)) {\n      data.armor.dex = parseInt(data.armor.dex);\n    }\n    // Add enhancement bonus\n    if (data.armor.enh == null) data.armor.enh = 0;\n\n    // Feed info back to actor\n    if (data.equipped === true) {\n      const actor = this.actor;\n      // Guard against weirdness with unlinked data (data is undefined at this state), and also basic test for if this item has actor.\n      if (!actor?.system || !actor?.equipment) return;\n\n      const actorData = actor.system;\n      switch (data.equipmentType) {\n        case \"shield\": {\n          const subtype = data.equipmentSubtype;\n          let shieldType = actor.equipment.shield.type;\n          if (subtype === \"other\" && shieldType < 1) shieldType = 1;\n          else if (subtype === \"lightShield\" && shieldType < 2) shieldType = 2;\n          else if (subtype === \"heavyShield\" && shieldType < 3) shieldType = 3;\n          else if (subtype === \"towerShield\" && shieldType < 4) shieldType = 4;\n          if (actor.equipment.shield.type !== shieldType) {\n            actor.equipment.shield.type = shieldType;\n            actor.equipment.shield.id = this.id;\n          }\n          break;\n        }\n        case \"armor\": {\n          const subtype = data.equipmentSubtype;\n          let armorType = actor.equipment.armor.type;\n          if (subtype === \"lightArmor\" && armorType < 1) armorType = 1;\n          else if (subtype === \"mediumArmor\" && armorType < 2) armorType = 2;\n          else if (subtype === \"heavyArmor\" && armorType < 3) armorType = 3;\n          if (armorType !== actor.equipment.armor.type) {\n            actor.equipment.armor.type = armorType;\n            actor.equipment.armor.id = this.id;\n          }\n          break;\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {boolean} active\n   * @param {object} context Optional update context\n   * @returns {Promise} Update promise\n   * @override\n   */\n  async setActive(active, context) {\n    return this.update({ \"system.equipped\": active }, context);\n  }\n\n  get isActive() {\n    return this.system.equipped;\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\nimport { FFD20 } from \"../../config.mjs\";\n\nexport class ItemFeatFFD20 extends ItemFFD20 {\n  async _preDelete(options, user) {\n    if (user.id === game.user.id) {\n      if (this.isActive) {\n        this.executeScriptCalls(\"toggle\", { state: false });\n      }\n    }\n\n    return super._preDelete(options, user);\n  }\n\n  /**\n   * @param {boolean} active\n   * @param {object} context Optional update context\n   * @returns {Promise} Update promise\n   * @override\n   */\n  async setActive(active, context) {\n    return this.update({ \"data.disabled\": !active }, context);\n  }\n\n  get isActive() {\n    return !this.system.disabled;\n  }\n\n  get subType() {\n    return this.system.featType;\n  }\n\n  /** @inheritdoc */\n  getLabels() {\n    const labels = super.getLabels();\n    const { featType, abilityType } = this.system;\n\n    labels.featType = FFD20.featTypes[featType];\n\n    // Ability type\n    if (abilityType && abilityType !== \"none\") {\n      labels.abilityType = FFD20.abilityTypes[abilityType].short;\n    } else if (labels.abilityType) {\n      delete labels.abilityType;\n    }\n\n    return labels;\n  }\n\n  /** @inheritDoc */\n  getTypeChatData(data, labels, props, rollData) {\n    super.getTypeChatData(data, labels, props, rollData);\n    // Add ability type label\n    if (labels.abilityType) {\n      props.push(labels.abilityType);\n    }\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\n\nexport class ItemLootFFD20 extends ItemFFD20 {\n  get subType() {\n    return this.system.subType;\n  }\n\n  get extraType() {\n    return this.system.extraType;\n  }\n\n  async _preUpdate(update, options, userId) {\n    await super._preUpdate(update, options, userId);\n\n    // Reset loot extra type when loot subtype is changed\n    if (\n      update.system?.subType !== undefined &&\n      update.system?.subType !== this.system.subType &&\n      update.system?.extraType === undefined\n    ) {\n      setProperty(update, \"system.extraType\", \"\");\n    }\n  }\n\n  async _preDelete(options, user) {\n    if (user.id === game.user.id) {\n      if (this.isActive) {\n        this.executeScriptCalls(\"equip\", { equipped: false });\n      }\n\n      if (this.system.quantity > 0) {\n        this.executeScriptCalls(\"changeQuantity\", { quantity: { previous: this.system.quantity, new: 0 } });\n      }\n    }\n\n    return super._preDelete(options, user);\n  }\n\n  /**\n   * @param {boolean} active\n   * @param {object} context Optional update context\n   * @returns {Promise} Update promise\n   * @override\n   */\n  async setActive(active, context) {\n    return this.update({ \"system.equipped\": active }, context);\n  }\n\n  get isActive() {\n    if (this.subType === \"gear\") return this.system.equipped;\n    return true;\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\n\nexport class ItemRaceFFD20 extends ItemFFD20 {\n  async _preCreate(data, options, user) {\n    const actor = this.parent instanceof Actor ? this.parent : null;\n\n    // Overwrite race\n    if (actor) {\n      const oldRace = actor.items.find((o) => o.type === \"race\" && o !== this);\n      if (oldRace) {\n        await oldRace.delete();\n\n        const context = {};\n        // Ensure actor size is updated to match the race, but only if it's same as old race\n        const actorSize = actor.system.traits.size;\n        if (actorSize !== this.system.size && oldRace.system.size === actorSize) context._ffd20SizeChanged = true;\n      }\n    }\n  }\n\n  async _preUpdate(update, context, user) {\n    await super._preUpdate(update, context, user);\n\n    if (this.parent?.type === \"basic\") return;\n\n    // Track size change\n    const newSize = getProperty(update, \"system.size\");\n    if (this.parent && newSize !== undefined) {\n      const oldSize = this.parent.system.traits.size;\n      if (this.system.size === oldSize && newSize !== oldSize) {\n        context._ffd20SizeChanged = true;\n      }\n    }\n  }\n\n  _onUpdate(data, context, userId) {\n    super._onUpdate(data, context, userId);\n\n    // Change actor size if the old size is same as old race size.\n    if (this.parent && context._ffd20SizeChanged) {\n      if (this.parent.type === \"basic\") return;\n      this.parent.update({ \"system.traits.size\": this.system.size });\n    }\n  }\n\n  _onDelete(data, context, userId) {\n    super._onDelete(data, context, userId);\n\n    if (this.parent?.race === this) this.parent._race = null;\n  }\n\n  /**\n   * @override\n   */\n  prepareBaseData() {\n    super.prepareBaseData();\n    const actor = this.actor;\n    // Self-register on actor\n    if (actor) actor._race = this;\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\n\nexport class ItemSpellFFD20 extends ItemFFD20 {\n  prepareData() {\n    const itemData = super.prepareData();\n    const data = itemData;\n    const labels = this.labels;\n    const C = CONFIG.FFD20;\n\n    // Spell Level,  School, and Components\n    if (itemData.type === \"spell\") {\n      labels.level = C.spellLevels[data.level];\n      labels.school = C.spellSchools[data.school];\n      labels.components = this.getSpellComponents()\n        .map((o) => o[0])\n        .join(\" \");\n    }\n  }\n\n  /**\n   * Returns the spell's effective spell level, after counting in offsets.\n   *\n   * @param {number} [bonus=0] - Another bonus to account for.\n   * @returns {number} The spell's effective spell level.\n   */\n  getEffectiveSpellLevel(bonus = 0) {\n    const slOffset = this.system.slOffset ?? 0;\n    const spellLevel = this.system.level;\n    return Math.max(0, spellLevel + slOffset + bonus);\n  }\n\n  /**\n   * Returns the spell's effective caster level, after counting in offsets.\n   *\n   * @param {number} [bonus=0] - Another bonus to account for.\n   * @returns {number} The spell's effective caster level.\n   */\n  getEffectiveCasterLevel(bonus = 0) {\n    const clOffset = this.system.clOffset ?? 0;\n    const casterLevel = this.spellbook?.cl.total ?? 0;\n    return Math.max(0, casterLevel + clOffset + bonus);\n  }\n\n  prepareDerivedItemData() {\n    super.prepareDerivedItemData();\n\n    // Update description\n    this._updateSpellDescription();\n  }\n\n  preCreateData(data, options, user) {\n    const updates = super.preCreateData(data, options, user);\n\n    const actor = this.parentActor;\n    if (actor) {\n      // Swap non-psychic components for psychic ones\n      if (this.spellbook?.psychic === true) {\n        if (this.data.components?.verbal === true) {\n          updates[\"system.components.verbal\"] = false;\n          updates[\"system.components.thought\"] = true;\n        }\n        if (this.data.components?.somatic === true) {\n          updates[\"system.components.somatic\"] = false;\n          updates[\"system.components.emotion\"] = true;\n        }\n      }\n    }\n\n    return updates;\n  }\n\n  getRollData() {\n    const result = super.getRollData();\n\n    if (this.parent != null) {\n      const spellbook = this.spellbook;\n      if (spellbook != null) {\n        const spellAbility = spellbook.ability;\n        let ablMod = \"\";\n        if (spellAbility !== \"\") ablMod = getProperty(this.parent, `system.abilities.${spellAbility}.mod`);\n\n        result.cl = this.casterLevel || 0;\n        result.sl = this.spellLevel || 0;\n        result.classLevel =\n          spellbook.class === \"_hd\"\n            ? result.attributes.hd?.total ?? result.details.level.value\n            : spellbook.class?.length > 0\n            ? getProperty(result, `classes.${spellbook.class}.level`) || 0 // `\n            : 0;\n        result.ablMod = ablMod;\n      }\n    }\n\n    return result;\n  }\n\n  getConditionalSubTargets(target) {\n    const result = super.getConditionalSubTargets(target);\n\n    // Add subtargets affecting effects\n    if (target === \"effect\") {\n      result[\"cl\"] = game.i18n.localize(\"FFD20.CasterLevel\");\n    }\n\n    // Add misc subtargets\n    if (target === \"misc\") {\n      // Add charges subTarget with specific label\n      if (this.type === \"spell\" && this.useSpellPoints()) result[\"charges\"] = game.i18n.localize(\"FFD20.SpellPointsCost\");\n    }\n\n    return result;\n  }\n\n  /** @inheritDoc */\n  getTypeChatData(data, labels, props, rollData) {\n    if (rollData.item.sr) {\n      props.push(game.i18n.localize(\"FFD20.SpellResistance\"));\n    }\n\n    // Add charges\n    if (this.isCharged && !this.system.atWill) {\n      if (this.useSpellPoints()) {\n        props.push(`${game.i18n.localize(\"FFD20.SpellPoints\")}: ${this.charges}/${this.maxCharges}`);\n      } else {\n        props.push(`${game.i18n.localize(\"FFD20.ChargePlural\")}: ${this.charges}/${this.maxCharges}`);\n      }\n    }\n  }\n\n  async addUses(value, data = null) {\n    if (!this.parent) return;\n    if (this.system.atWill) return;\n\n    const spellbook = this.spellbook;\n    if (!spellbook) return;\n    const isSpontaneous = spellbook.spontaneous,\n      spellbookKey = getProperty(this, \"system.spellbook\") || \"primary\",\n      spellLevel = getProperty(this, \"system.level\");\n\n    if (this.useSpellPoints()) {\n      const curUses = this.getSpellUses();\n      const updateData = {};\n      const tempMP = getProperty(this.parent, \"system.attributes.mp.temp\");\n      const curMP = getProperty(this.parent, \"system.attributes.mp.value\");\n\n      // check for temp mp\n      if(tempMP === 0){\n        // if temp mp is 0 do normal\n        updateData[\"system.attributes.mp.value\"] = curUses + value;\n        return this.parent.update(updateData);\n        } else {\n          // else check if temp mp is greater then spell cost\n          // if so deduct from temp and then from normal\n          if(tempMP >= (value * -1)){\n          // else deduct from temp\n          updateData[\"system.attributes.mp.temp\"] = tempMP + value;\n            return this.parent.update(updateData);\n            } else {\n            let leftMP = tempMP + value;\n          updateData[\"system.attributes.mp.temp\"] = 0;\n          updateData[\"system.attributes.mp.value\"] = curMP + leftMP;\n          return this.parent.update(updateData);}\n        }\n    } else {\n      const newCharges = isSpontaneous\n        ? Math.max(0, (getProperty(spellbook, `spells.spell${spellLevel}.value`) || 0) + value)\n        : Math.max(0, (getProperty(this, \"system.preparation.preparedAmount\") || 0) + value);\n\n      if (!isSpontaneous) {\n        const key = \"system.preparation.preparedAmount\";\n        if (data == null) {\n          data = {};\n          data[key] = newCharges;\n          return this.update(data);\n        } else {\n          data[key] = newCharges;\n        }\n      } else {\n        const key = `system.attributes.spells.spellbooks.${spellbookKey}.spells.spell${spellLevel}.value`;\n        const actorUpdateData = {};\n        actorUpdateData[key] = newCharges;\n        return this.parent.update(actorUpdateData);\n      }\n    }\n\n    return null;\n  }\n\n  async addCharges(value) {\n    return this.addUses(value);\n  }\n\n  get isCharged() {\n    if (this.system.atWill) return false;\n    return true;\n  }\n\n  get charges() {\n    return this.getSpellUses();\n  }\n\n  get maxCharges() {\n    return this.getSpellUses(true);\n  }\n\n  get spellLevel() {\n    return this.system.level + (this.system.slOffset || 0);\n  }\n\n  get casterLevel() {\n    const spellbook = this.spellbook;\n    if (!spellbook) return null;\n\n    return spellbook.cl.total + (this.system.clOffset || 0);\n  }\n\n  get spellbook() {\n    const bookId = this.system.spellbook;\n    return this.parent?.system?.attributes?.spells.spellbooks[bookId];\n  }\n\n  getDC(rollData = null) {\n    // No actor? No DC!\n    if (!this.parent) return 0;\n\n    const spellbook = this.spellbook;\n    if (spellbook) {\n      let formula = spellbook.baseDCFormula;\n\n      rollData = rollData ?? this.getRollData();\n      const data = rollData.item;\n      if (data.save.dc.length > 0) formula += ` + ${data.save.dc}`;\n\n      // Get conditional save DC bonus\n      const dcBonus = rollData[\"dcBonus\"] ?? 0;\n\n      return RollFFD20.safeRoll(formula, rollData).total + dcBonus;\n    }\n    return 10;\n  }\n\n  getSpellUses(max = false) {\n    if (!this.parent) return 0;\n    const itemData = this.system;\n    if (itemData.atWill) return Number.POSITIVE_INFINITY;\n\n    const spellbook = this.spellbook;\n    if (!spellbook) return 0;\n\n    const isSpontaneous = spellbook.spontaneous,\n      spellLevel = itemData.level;\n\n      // added for temp mp\n    if (this.useSpellPoints()) {\n      if (max) return this.parent.system.attributes.mp.max;\n      return this.parent.system.attributes.mp.value + this.parent.system.attributes.mp.temp;\n    } else {\n      if (isSpontaneous) {\n        if (itemData.preparation.spontaneousPrepared === true) {\n          if (max) return getProperty(spellbook, `spells.spell${spellLevel}.max`) || 0;\n          return getProperty(spellbook, `spells.spell${spellLevel}.value`) || 0;\n        }\n      } else {\n        if (max) return itemData.preparation?.maxAmount ?? 0;\n        return itemData.preparation?.preparedAmount ?? 0;\n      }\n    }\n\n    return 0;\n  }\n\n  useSpellPoints() {\n    if (!this.parent) return false;\n\n    return this.spellbook?.spellPoints?.useSystem ?? false;\n  }\n\n  getSpellComponents(srcData) {\n    if (!srcData) srcData = duplicate(this.system);\n    const reSplit = CONFIG.FFD20.re.traitSeparator;\n\n    let components = [];\n    const compKeys = {\n      V: game.i18n.localize(\"FFD20.SpellComponentKeys.Verbal\"),\n      S: game.i18n.localize(\"FFD20.SpellComponentKeys.Somatic\"),\n      T: game.i18n.localize(\"FFD20.SpellComponentKeys.Thought\"),\n      E: game.i18n.localize(\"FFD20.SpellComponentKeys.Emotion\"),\n      M: game.i18n.localize(\"FFD20.SpellComponentKeys.Material\"),\n      F: game.i18n.localize(\"FFD20.SpellComponentKeys.Focus\"),\n      DF: game.i18n.localize(\"FFD20.SpellComponentKeys.DivineFocus\"),\n    };\n    for (const [key, value] of Object.entries(srcData.components ?? {})) {\n      if (key === \"value\" && value.length > 0) components.push(...value.split(reSplit));\n      else if (key === \"verbal\" && value) components.push(compKeys.V);\n      else if (key === \"somatic\" && value) components.push(compKeys.S);\n      else if (key === \"thought\" && value) components.push(compKeys.T);\n      else if (key === \"emotion\" && value) components.push(compKeys.E);\n      else if (key === \"material\" && value) components.push(compKeys.M);\n      else if (key === \"focus\" && value) components.push(compKeys.F);\n    }\n    if (getProperty(srcData, \"components.divineFocus\") === 1) components.push(compKeys.DF);\n    const df = getProperty(srcData, \"components.divineFocus\");\n    // Sort components\n    const componentsOrder = [compKeys.V, compKeys.S, compKeys.T, compKeys.E, compKeys.M, compKeys.F, compKeys.DF];\n    components.sort((a, b) => {\n      const index = [componentsOrder.indexOf(a), components.indexOf(b)];\n      if (index[0] === -1 && index[1] === -1) return 0;\n      if (index[0] === -1 && index[1] >= 0) return 1;\n      if (index[0] >= 0 && index[1] === -1) return -1;\n      return index[0] - index[1];\n    });\n    components = components.map((o) => {\n      if (o === compKeys.M) {\n        if (df === 2) o = `${compKeys.M}/${compKeys.DF}`;\n        if (getProperty(srcData, \"system.materials.value\"))\n          o = `${o} (${getProperty(srcData, \"system.materials.value\")})`;\n      }\n      if (o === compKeys.F) {\n        if (df === 3) o = `${compKeys.F}/${compKeys.DF}`;\n        if (getProperty(srcData, \"system.materials.focus\"))\n          o = `${o} (${getProperty(srcData, \"system.materials.focus\")})`;\n      }\n      return o;\n    });\n    return components;\n  }\n\n  /**\n   * @param {object} itemData - A spell item's data.\n   * @returns {number[]} An array containing the spell level and caster level.\n   */\n  static getMinimumCasterLevelBySpellData(itemData) {\n    const learnedAt = getProperty(itemData, \"system.learnedAt.class\").reduce((cur, o) => {\n      const classes = o[0].split(\"/\");\n      for (const cls of classes) cur.push([cls, o[1]]);\n      return cur;\n    }, []);\n    const result = [9, 20];\n    for (const o of learnedAt) {\n      result[0] = Math.min(result[0], o[1]);\n\n      const tc = CONFIG.FFD20.classCasterType[o[0]] || \"high\";\n      if (tc === \"high\") {\n        result[1] = Math.min(result[1], 1 + Math.max(0, o[1] - 1) * 2);\n      } else if (tc === \"med\") {\n        result[1] = Math.min(result[1], 1 + Math.max(0, o[1] - 1) * 3);\n      } else if (tc === \"low\") {\n        result[1] = Math.min(result[1], 1 + Math.max(0, o[1] - 1) * 3);\n      }\n    }\n\n    return result;\n  }\n\n  static _replaceConsumableConversionString(string, rollData) {\n    string = string.replace(/@sl/g, rollData.sl);\n    string = string.replace(/@cl/g, \"@item.cl\");\n    return string;\n  }\n\n  static async toConsumable(origData, type) {\n    const actionData = origData.system.actions?.[0] ?? {};\n    const data = {\n      type: \"consumable\",\n      name: origData.name,\n    };\n    const action = ffd20.components.ItemAction.defaultData;\n\n    const slcl = this.getMinimumCasterLevelBySpellData(origData);\n    if (origData.sl == null) origData.sl = slcl[0];\n    if (origData.cl == null) origData.cl = slcl[1];\n    const materialPrice = origData.materials?.gilValue ?? 0;\n\n    // Set consumable type\n    data[\"system.consumableType\"] = type;\n\n    // Set name\n    if (type === \"wand\") {\n      data.name = game.i18n.localize(\"FFD20.CreateItemWandOf\").format(origData.name);\n      data.img = \"systems/ffd20/icons/items/inventory/wand-star.jpg\";\n      data[\"system.price\"] = 0;\n      data[\"system.uses.pricePerUse\"] =\n        Math.floor(((Math.max(0.5, origData.sl) * origData.cl * 750 + materialPrice) / 50) * 100) / 100;\n      data[\"system.hardness\"] = 5;\n      data[\"system.hp.max\"] = 5;\n      data[\"system.hp.value\"] = 5;\n      action.name = game.i18n.localize(\"FFD20.Use\");\n      action.img = data.img;\n    } else if (type === \"potion\") {\n      data.name = game.i18n.localize(\"FFD20.CreateItemPotionOf\").format(origData.name);\n      data.img = \"systems/ffd20/icons/items/potions/minor-blue.jpg\";\n      data[\"system.price\"] = Math.max(0.5, origData.sl) * origData.cl * 50 + materialPrice;\n      data[\"system.hardness\"] = 1;\n      data[\"system.hp.max\"] = 1;\n      data[\"system.hp.value\"] = 1;\n      action.range = {\n        value: 0,\n        units: \"personal\",\n      };\n      action.name = game.i18n.localize(\"FFD20.Drink\");\n      action.img = data.img;\n    } else if (type === \"scroll\") {\n      data.name = game.i18n.localize(\"FFD20.CreateItemScrollOf\").format(origData.name);\n      data.img = \"systems/ffd20/icons/items/inventory/scroll-magic.jpg\";\n      data[\"system.price\"] = Math.max(0.5, origData.sl) * origData.cl * 25 + materialPrice;\n      data[\"system.hardness\"] = 0;\n      data[\"system.hp.max\"] = 1;\n      data[\"system.hp.value\"] = 1;\n      action.name = game.i18n.localize(\"FFD20.Use\");\n      action.img = data.img;\n    }\n\n    // Set charges\n    if (type === \"wand\") {\n      data[\"system.uses.maxFormula\"] = \"50\";\n      data[\"system.uses.value\"] = 50;\n      data[\"system.uses.max\"] = 50;\n      data[\"system.uses.per\"] = \"charges\";\n    } else {\n      data[\"system.uses.per\"] = \"single\";\n    }\n    // Set activation method\n    action.activation.type = \"standard\";\n    // Set activation for unchained action economy\n    action.unchainedAction.activation.type = \"action\";\n    action.unchainedAction.activation.cost = 2;\n\n    // Set measure template and range\n    if (type !== \"potion\") {\n      action.measureTemplate = actionData.measureTemplate;\n      if ([\"close\", \"medium\", \"long\"].includes(actionData.range.units)) {\n        action.range = {\n          units: \"ft\",\n          value: RollFFD20.safeTotal(CONFIG.FFD20.spellRangeFormulas[actionData.range.units], origData).toString(),\n        };\n      } else {\n        action.range = actionData.range;\n      }\n    }\n\n    // Set damage formula\n    action.actionType = origData.actionType;\n    for (const d of actionData.damage?.parts ?? []) {\n      action.damage.parts.push([this._replaceConsumableConversionString(d[0], origData), d[1]]);\n    }\n\n    // Set saves\n    if (actionData.save) {\n      action.save.description = actionData.save.description;\n      action.save.type = actionData.save.type;\n      action.save.dc = `10 + ${origData.sl}[${game.i18n.localize(\"FFD20.SpellLevel\")}] + ${Math.floor(\n        origData.sl / 2\n      )}[${game.i18n.localize(\"FFD20.SpellcastingAbility\")}]`;\n    }\n\n    // Copy variables\n    action.actionType = actionData.actionType;\n    action.attackNotes = actionData.attackNotes;\n    action.effectNotes = actionData.effectNotes;\n    action.attackBonus = actionData.attackBonus;\n    action.critConfirmBonus = actionData.critConfirmBonus;\n    data[\"system.aura.school\"] = origData.school;\n\n    // Replace attack and effect formula data\n    for (const arrKey of [\"attackNotes\", \"effectNotes\"]) {\n      const arr = getProperty(action, arrKey);\n      if (!arr) continue;\n      for (let a = 0; a < arr.length; a++) {\n        const note = arr[a];\n        arr[a] = this._replaceConsumableConversionString(note, origData);\n      }\n    }\n\n    // Set Caster Level\n    data[\"system.cl\"] = origData.cl;\n\n    // Set description\n    data[\"system.description.value\"] = this._replaceConsumableConversionString(\n      await renderTemplate(\"systems/ffd20/templates/internal/consumable-description.hbs\", {\n        origData: origData,\n        data: data,\n        isWand: type === \"wand\",\n        isPotion: type === \"potion\",\n        isScroll: type === \"scroll\",\n        sl: origData.sl,\n        cl: origData.cl,\n        config: CONFIG.FFD20,\n      }),\n      origData\n    );\n\n    // Create and return synthetic item data\n    data[\"system.actions\"] = [action];\n    return new ItemFFD20(expandObject(data)).toObject();\n  }\n\n  /**\n   * Updates the spell's description.\n   *\n   * @param data\n   */\n  async _updateSpellDescription(data) {\n    this.system.description.value = await renderTemplate(\n      \"systems/ffd20/templates/internal/spell-description.hbs\",\n      mergeObject(data ?? {}, this.spellDescriptionData)\n    );\n  }\n\n  /**\n   * @returns true if the spell is prepared to cast in any manner.\n   */\n  get canCast() {\n    if (this.system.atWill) return true;\n    const charges = this.charges; // Cache\n    return (\n      (this.isCharged && charges > 0) ||\n      (this.spellbook?.spontaneous && this.system.preparation.spontaneousPrepared && charges > 0)\n    );\n  }\n\n  get fullDescription() {\n    return super.fullDescription + this.system.shortDescription;\n  }\n\n  get spellDescriptionData() {\n    const reSplit = CONFIG.FFD20.re.traitSeparator;\n    const srcData = this.system;\n    const firstAction = this.firstAction;\n    const actionData = firstAction?.data ?? {};\n\n    const label = {\n      school: (CONFIG.FFD20.spellSchools[getProperty(srcData, \"school\")] || \"\").toLowerCase(),\n      multi: getProperty(srcData, \"multi\"),\n      multischool: (CONFIG.FFD20.multiSchools[getProperty(srcData, \"multischool\")] || \"\").toLowerCase(),\n      subschool: getProperty(srcData, \"subschool\") || \"\",\n      types: \"\",\n    };\n    const data = {\n      data: mergeObject(this.system, srcData, { inplace: false }),\n      label: label,\n    };\n\n    // Set subschool and types label\n    const types = getProperty(srcData, \"types\");\n    if (typeof types === \"string\" && types.length > 0) {\n      label.types = types.split(reSplit).join(\", \");\n    }\n    // Set information about when the spell is learned\n    data.learnedAt = {};\n    data.learnedAt.class = (getProperty(srcData, \"learnedAt.class\") || [])\n      .map((o) => {\n        return `${o[0]} ${o[1]}`;\n      })\n      .sort()\n      .join(\", \");\n    data.learnedAt.domain = (getProperty(srcData, \"learnedAt.domain\") || [])\n      .map((o) => {\n        return `${o[0]} ${o[1]}`;\n      })\n      .sort()\n      .join(\", \");\n    data.learnedAt.subDomain = (getProperty(srcData, \"learnedAt.subDomain\") || [])\n      .map((o) => {\n        return `${o[0]} ${o[1]}`;\n      })\n      .sort()\n      .join(\", \");\n    data.learnedAt.elementalSchool = (getProperty(srcData, \"learnedAt.elementalSchool\") || [])\n      .map((o) => {\n        return `${o[0]} ${o[1]}`;\n      })\n      .sort()\n      .join(\", \");\n    data.learnedAt.bloodline = (getProperty(srcData, \"learnedAt.bloodline\") || [])\n      .map((o) => {\n        return `${o[0]} ${o[1]}`;\n      })\n      .sort()\n      .join(\", \");\n\n    // Set casting time label\n    const act = game.settings.get(\"ffd20\", \"unchainedActionEconomy\")\n      ? getProperty(firstAction, \"system.unchainedAction.activation\")\n      : getProperty(firstAction, \"system.activation\");\n    if (act != null) {\n      const activationCost = act.cost;\n      const activationType = act.type;\n      const activationTypes = game.settings.get(\"ffd20\", \"unchainedActionEconomy\")\n        ? CONFIG.FFD20.abilityActivationTypes_unchained\n        : CONFIG.FFD20.abilityActivationTypes;\n      const activationTypesPlurals = game.settings.get(\"ffd20\", \"unchainedActionEconomy\")\n        ? CONFIG.FFD20.abilityActivationTypesPlurals_unchained\n        : CONFIG.FFD20.abilityActivationTypesPlurals;\n\n      if (activationType) {\n        if (activationTypesPlurals[activationType] != null) {\n          if (activationCost === 1) label.castingTime = `${activationTypes[activationType]}`;\n          else label.castingTime = `${activationTypesPlurals[activationType]}`;\n        } else label.castingTime = `${activationTypes[activationType]}`;\n      }\n      if (!Number.isNaN(activationCost) && label.castingTime != null)\n        label.castingTime = `${activationCost} ${label.castingTime}`;\n      if (label.castingTime) label.castingTime = label.castingTime.toLowerCase();\n    }\n\n    // Set components label\n    label.components = this.getSpellComponents(srcData).join(\", \");\n\n    // Set duration label\n    {\n      const duration = actionData.duration?.value;\n      if (duration) label.duration = duration;\n    }\n    // Set effect label\n    {\n      const effect = actionData.spellEffect;\n      if (effect) label.effect = effect;\n    }\n    // Set targets label\n    {\n      const targets = actionData.target?.value;\n      if (targets) label.targets = targets;\n    }\n    // Set range label\n    {\n      const rangeUnit = actionData.range?.units;\n      const rangeValue = actionData.range?.value;\n\n      if (rangeUnit != null && rangeUnit !== \"none\") {\n        label.range = (CONFIG.FFD20.distanceUnits[rangeUnit] || \"\").toLowerCase();\n        let units = game.settings.get(\"ffd20\", \"distanceUnits\"); // override\n        if (units === \"default\") units = game.settings.get(\"ffd20\", \"units\");\n        if (rangeUnit === \"close\")\n          label.range = `${label.range} ${game.i18n.localize(\n            units == \"metric\" ? \"FFD20.SpellRangeShortMetric\" : \"FFD20.SpellRangeShort\"\n          )}`;\n        else if (rangeUnit === \"medium\")\n          label.range = `${label.range} ${game.i18n.localize(\n            units == \"metric\" ? \"FFD20.SpellRangeMediumMetric\" : \"FFD20.SpellRangeMedium\"\n          )}`;\n        else if (rangeUnit === \"long\")\n          label.range = `${label.range} ${game.i18n.localize(\n            units == \"metric\" ? \"FFD20.SpellRangeLongMetric\" : \"FFD20.SpellRangeLong\"\n          )}`;\n        else if ([\"ft\", \"mi\"].includes(rangeUnit)) {\n          if (!rangeValue) label.range = \"\";\n          else label.range = `${rangeValue} ${label.range}`;\n        }\n      }\n    }\n    // Set area label\n    {\n      const area = actionData.spellArea;\n\n      if (area) label.area = area;\n    }\n\n    // Set DC and SR\n    {\n      const savingThrowDescription = actionData.save?.description;\n      if (savingThrowDescription) label.savingThrow = savingThrowDescription;\n      else label.savingThrow = \"none\";\n\n      const sr = srcData.sr;\n      label.sr = (sr === true ? game.i18n.localize(\"FFD20.Yes\") : game.i18n.localize(\"FFD20.No\")).toLowerCase();\n\n      if (actionData.range?.units !== \"personal\") data.useDCandSR = true;\n    }\n    return data;\n  }\n}\n","import { ItemFFD20 } from \"./item-ffd20.mjs\";\n\nexport class ItemWeaponFFD20 extends ItemFFD20 {\n  async _preUpdate(update, context) {\n    // Set weapon subtype if not present\n    const newWeaponType = getProperty(update, \"system.weaponType\");\n    if (newWeaponType != null && newWeaponType !== this.data.weaponType) {\n      const subtype = getProperty(update, \"system.weaponSubtype\") ?? this.data.weaponSubtype ?? \"\";\n      const keys = Object.keys(CONFIG.FFD20.weaponTypes[newWeaponType]).filter((o) => !o.startsWith(\"_\"));\n      if (!subtype || !keys.includes(subtype)) {\n        setProperty(update, \"system.weaponSubtype\", keys[0]);\n      }\n    }\n  }\n\n  async _preDelete(options, user) {\n    if (user.id === game.user.id) {\n      if (this.isActive) {\n        this.executeScriptCalls(\"equip\", { equipped: false });\n      }\n\n      if (this.system.quantity > 0) {\n        this.executeScriptCalls(\"changeQuantity\", { quantity: { previous: this.system.quantity, new: 0 } });\n      }\n    }\n\n    return super._preDelete(options, user);\n  }\n\n  prepareData() {\n    super.prepareData();\n    const labels = this.labels;\n    const { weaponTypes } = CONFIG.FFD20;\n\n    // Type and subtype labels\n    let wType = this.system.weaponType;\n    const typeKeys = Object.keys(weaponTypes);\n    if (!typeKeys.includes(wType)) wType = typeKeys[0];\n\n    let wSubtype = this.system.weaponSubtype;\n    const subtypeKeys = Object.keys(weaponTypes[wType]).filter((o) => !o.startsWith(\"_\"));\n    if (!subtypeKeys.includes(wSubtype)) wSubtype = subtypeKeys[0];\n\n    labels.weaponType = weaponTypes[wType]._label;\n    labels.weaponSubtype = weaponTypes[wType][wSubtype];\n\n    this._prepareWeaponGroups();\n  }\n\n  /**\n   * @param {boolean} active\n   * @param {object} context Optional update context\n   * @returns {Promise} Update promise\n   * @override\n   */\n  async setActive(active, context) {\n    return this.update({ \"system.equipped\": active }, context);\n  }\n\n  get isActive() {\n    return this.system.equipped;\n  }\n\n  _prepareWeaponGroups() {\n    const weaponGroups = this.system.weaponGroups || { value: [], custom: \"\" };\n\n    weaponGroups.selected = weaponGroups.value.reduce((obj, t) => {\n      obj[t] = CONFIG.FFD20.weaponGroups[t];\n      return obj;\n    }, {});\n\n    // Add custom entry\n    if (weaponGroups.custom) {\n      weaponGroups.custom\n        .split(CONFIG.FFD20.re.traitSeparator)\n        .forEach((c, i) => (weaponGroups.selected[`custom${i + 1}`] = c.trim()));\n    }\n\n    weaponGroups.cssClass = foundry.utils.isEmpty(weaponGroups.selected) ? \"inactive\" : \"\";\n  }\n}\n","import { DiceFFD20, formulaHasDice } from \"../../dice/dice.mjs\";\nimport { ItemBaseFFD20 } from \"./item-base.mjs\";\nimport { createCustomChatMessage } from \"../../utils/chat.mjs\";\nimport {\n  createTag,\n  linkData,\n  convertDistance,\n  calculateRange,\n  keepUpdateArray,\n  diffObjectAndArray,\n} from \"../../utils/lib.mjs\";\nimport { ItemChange } from \"../../components/change.mjs\";\nimport { ItemAction } from \"../../components/action.mjs\";\nimport { getHighestChanges } from \"../actor/utils/apply-changes.mjs\";\nimport { RollFFD20 } from \"../../dice/roll.mjs\";\nimport { ActionUse } from \"@actionUse/action-use.mjs\";\nimport { callOldNamespaceHook, callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n/**\n * Override and extend the basic :class:`Item` implementation\n */\nexport class ItemFFD20 extends ItemBaseFFD20 {\n  constructor(...args) {\n    super(...args);\n\n    if (this.links === undefined)\n      /**\n       * An object containing links to other items.\n       *\n       * @type {object}\n       */\n      this.links = {};\n\n    if (this._rollData === undefined)\n      /**\n       * Cached {@link ItemFFD20.getRollData}\n       *\n       * @type {null|object}\n       * @private\n       */\n      this._rollData = null;\n\n    if (this.actions === undefined && this.actions instanceof Array)\n      /**\n       * A {@link Collection} of {@link ItemAction}s.\n       *\n       * @type {Collection<ItemAction>}\n       */\n      this.actions = new Collection();\n  }\n\n  static isInventoryItem(type) {\n    return [\"weapon\", \"equipment\", \"consumable\", \"loot\", \"container\"].includes(type);\n  }\n\n  _preCreate(data, options, user) {\n    super._preCreate(data, options, user);\n\n    // Ensure unique Change IDs\n    const actor = this.parentActor;\n    if (actor && data?.changes?.length > 0) {\n      const changes = data.changes;\n      let updated = false;\n      for (const c of changes) {\n        let i = 0;\n        // Forcibly seek unused ID.\n        while (actor.changes.get(c._id) !== undefined || !c._id) {\n          updated = true;\n          // Revert to default ID generation if too many iterations have passed. Just let it break if even more has passed.\n          if (i > 10_000) break;\n          else if (i++ > 1_000) c._id = foundry.utils.randomID();\n          else c._id = ItemChange.defaultData._id;\n        }\n      }\n      if (updated) this.system.update({ \"system.changes\": changes });\n    }\n\n    let updates = {};\n    if (typeof this.preCreateData === \"function\") {\n      updates = this.preCreateData(data, options, user);\n    }\n\n    if (Object.keys(updates).length) return this.system.update(updates);\n  }\n\n  /**\n   * Meant to be overridden.\n   *\n   * @param data\n   * @param options\n   * @param user\n   * @returns {object} Update data to replace with.\n   */\n  preCreateData(data, options, user) {\n    return {};\n  }\n\n  /**\n   * @returns {string[]} The keys of data variables to memorize between updates, for e.g. determining the difference in update.\n   */\n  get memoryVariables() {\n    return [\"system.quantity\", \"system.level\", \"system.inventoryItems\"];\n  }\n\n  get isPhysical() {\n    return this.constructor.isInventoryItem(this.type);\n  }\n\n  get firstAction() {\n    if (!this.system.actions?.length) return undefined;\n    return this.actions.get(this.system.actions[0]._id);\n  }\n\n  /**\n   * Returns `true` if any of this item's actions have an attack, see {@link ItemAction#hasAttack}.\n   *\n   * @type {boolean}\n   */\n  get hasAttack() {\n    return this.actions?.some((o) => o.hasAttack) ?? false;\n  }\n\n  /**\n   * Returns `true` if any of this item's actions have a damage roll, see {@link ItemAction#hasDamage}.\n   *\n   * @type {boolean}\n   */\n  get hasDamage() {\n    return this.actions?.some((o) => o.hasDamage) ?? false;\n  }\n\n  /* -------------------------------------------- */\n  /*  Item Properties                             */\n  /* -------------------------------------------- */\n\n  get isOwned() {\n    return super.isOwned || this.parentItem != null;\n  }\n\n  // Overriden by more specific implementations where necessary\n  get isActive() {\n    return true;\n  }\n\n  get hasAction() {\n    return this.system.actions?.length > 0;\n  }\n\n  get isSingleUse() {\n    return this.system.uses?.per === \"single\" || (this.isPhysical && !this.hasAction);\n  }\n\n  get isCharged() {\n    return this.isSingleUse || [\"day\", \"week\", \"charges\"].includes(this.system.uses?.per);\n  }\n\n  get charges() {\n    // No actor? No charges!\n    if (!this.parentActor) return 0;\n\n    // Get linked charges\n    const link = this.links?.charges;\n    if (link) return link.charges;\n\n    // Get own charges\n    if (this.isSingleUse) return this.system.quantity;\n    return this.system.uses?.value ?? 0;\n  }\n\n  get maxCharges() {\n    // No actor? No charges!\n    if (!this.parentActor) return 0;\n\n    // Get linked charges\n    const link = this.links?.charges;\n    if (link) return link.maxCharges;\n\n    // Get own charges\n    if (this.isSingleUse) return this.system.quantity;\n    return this.system.uses?.max ?? 0;\n  }\n\n  /**\n   * Returns total duration in seconds or null.\n   *\n   * @returns {number|null} Seconds or null.\n   */\n  get totalDurationSeconds() {\n    return this.system.duration?.totalSeconds ?? null;\n  }\n\n  get auraStrength() {\n    const cl = getProperty(this, \"system.cl\") || 0;\n    if (cl < 1) {\n      return 0;\n    } else if (cl < 6) {\n      return 1;\n    } else if (cl < 12) {\n      return 2;\n    } else if (cl < 21) {\n      return 3;\n    }\n    return 4;\n  }\n\n  get parentActor() {\n    if (this.parent) return this.parent;\n\n    let actor = null;\n    let p = this.parentItem;\n    while (!actor && p) {\n      actor = p.actor;\n      p = p.parentItem;\n    }\n    return actor;\n  }\n\n  get limited() {\n    if (this.parentItem) return this.parentItem.limited;\n    return super.limited;\n  }\n\n  getName(forcePlayerPerspective = false) {\n    if (game.user.isGM && !forcePlayerPerspective) return this.name;\n    if (getProperty(this, \"system.identified\") === false && getProperty(this, \"system.unidentified.name\"))\n      return getProperty(this, \"system.unidentified.name\");\n    return this.name;\n  }\n\n  testUserPermission(user, permission, { exact = false } = {}) {\n    if (this.parentActor) return this.parentActor.testUserPermission(user, permission, { exact });\n    if (this.parentItem) return this.parentItem.testUserPermission(user, permission, { exact });\n    return super.testUserPermission(user, permission, { exact });\n  }\n\n  get permission() {\n    if (this.parentActor) return this.parentActor.permission;\n    return super.permission;\n  }\n\n  get fullDescription() {\n    return this.system.description.value;\n  }\n\n  /**\n   * @returns {ActiveEffect} An active effect associated with this item.\n   */\n  get effect() {\n    return this.actor.effects.find((o) => {\n      const origin = o.data.origin.split(\".\");\n      if (origin[2] === \"Item\" && origin[3] === this.id) return true;\n      return false;\n    });\n  }\n\n  /**\n   * @param {string} type - The item type (such as \"attack\" or \"equipment\")\n   * @param {number} colorType - 0 for the primary color, 1 for the secondary color\n   * @returns {string} A color hex, in the format \"#RRGGBB\"\n   */\n  static getTypeColor(type, colorType) {\n    switch (colorType) {\n      case 0:\n        switch (type) {\n          case \"feat\":\n            return \"#8900EA\";\n          case \"spell\":\n            return \"#5C37FF\";\n          case \"class\":\n            return \"#85B1D2\";\n          case \"race\":\n            return \"#00BD29\";\n          case \"attack\":\n            return \"#F21B1B\";\n          case \"weapon\":\n          case \"equipment\":\n          case \"consumable\":\n          case \"loot\":\n            return \"#E5E5E5\";\n          case \"buff\":\n            return \"#FDF767\";\n          default:\n            return \"#FFFFFF\";\n        }\n      case 1:\n        switch (type) {\n          case \"feat\":\n            return \"#5F00A3\";\n          case \"spell\":\n            return \"#4026B2\";\n          case \"class\":\n            return \"#6A8DA8\";\n          case \"race\":\n            return \"#00841C\";\n          case \"attack\":\n            return \"#A91212\";\n          case \"weapon\":\n          case \"equipment\":\n          case \"consumable\":\n          case \"loot\":\n            return \"#B7B7B7\";\n          case \"buff\":\n            return \"#FDF203\";\n          default:\n            return \"#C1C1C1\";\n        }\n    }\n\n    return \"#FFFFFF\";\n  }\n\n  get typeColor() {\n    return this.constructor.getTypeColor(this.type, 0);\n  }\n\n  get typeColor2() {\n    return this.constructor.getTypeColor(this.type, 1);\n  }\n\n  /**\n   * An array containing all action types from this item's actions.\n   *\n   * @see {@link config.itemActionTypes}\n   * @type {string[]}\n   */\n  get actionTypes() {\n    const actionTypes = this.actions?.map((action) => action.data.actionType).filter(Boolean) ?? [];\n    return [...new Set(actionTypes)];\n  }\n\n  static get defaultContextNote() {\n    return {\n      text: \"\",\n      subTarget: \"\",\n    };\n  }\n\n  /**\n   * Generic charge addition (or subtraction) function that either adds charges\n   * or quantity, based on item data.\n   *\n   * @param {number} value       - The amount of charges to add.\n   * @returns {Promise}\n   */\n  async addCharges(value) {\n    // Add link charges\n    const link = getProperty(this, \"links.charges\");\n    if (link) return link.addCharges(value);\n\n    // Add own charges\n    if (getProperty(this, \"system.uses.per\") === \"single\" && getProperty(this, \"system.quantity\") == null) return;\n\n    const prevValue = this.isSingleUse ? getProperty(this, \"system.quantity\") : getProperty(this, \"system.uses.value\");\n\n    if (this.isSingleUse) await this.update({ \"system.quantity\": prevValue + value });\n    else await this.update({ \"system.uses.value\": prevValue + value });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Should the item show unidentified data\n   *\n   * @type {boolean}\n   */\n  get showUnidentifiedData() {\n    return !game.user.isGM && getProperty(this, \"system.identified\") === false;\n  }\n\n  /* -------------------------------------------- */\n  /*\tData Preparation\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\n  /* -------------------------------------------- */\n\n  /**\n   * Augment the basic Item data model with additional dynamic data.\n   */\n  prepareData() {\n    super.prepareData();\n    const itemData = this.system;\n    const data = itemData;\n    const C = CONFIG.FFD20;\n    const labels = {};\n\n    this.prepareLinks();\n\n    // Update changes\n    if (this.system.changes instanceof Array) {\n      this.changes = this._prepareChanges(this.system.changes);\n    }\n\n    // Update actions\n    if (this.system.actions instanceof Array) {\n      this.actions = this._prepareActions(this.system.actions);\n    }\n\n    // Update script calls\n    if (this.system.scriptCalls instanceof Array) {\n      this.scriptCalls = this._prepareScriptCalls(this.system.scriptCalls);\n    }\n\n    // Update contained items\n    if (this.system.inventoryItems instanceof Array) {\n      this.items = this._prepareInventory(this.system.inventoryItems);\n    }\n    this.prepareWeight();\n\n    // Prepare labels\n    this.labels = this.prepareLabels();\n\n    if (!this.actor) {\n      this.prepareDerivedItemData();\n    }\n\n    return itemData;\n  }\n\n  /**\n   * Prepare this item's {@link ItemWeightData}\n   */\n  prepareWeight() {\n    const itemData = this.system;\n\n    // HACK: Migration shim. Allows unmigrated items to have their weight correct.\n    {\n      const weight = itemData.weight;\n      if (weight === undefined || Number.isFinite(weight)) {\n        const sourceData = this._source.system,\n          sourceWeight = sourceData.baseWeight ?? sourceData.weight ?? 0;\n        itemData.weight = { value: sourceWeight };\n      }\n    }\n\n    const weight = itemData.weight;\n\n    // Make sure there is a weight value\n    weight.value ??= 0;\n    weight.total ??= 0;\n\n    // Determine actual item weight, including sub-items\n    const weightReduction = (100 - (itemData.weightReduction ?? 0)) / 100;\n    weight.total = (this.items ?? []).reduce((cur, o) => {\n      return cur + o.system.weight.total * weightReduction;\n    }, weight.value * itemData.quantity);\n\n    // Add contained currency (mainly containers)\n    weight.currency ??= 0;\n    weight.total += weight.currency;\n\n    // Convert weight according metric system (lb vs kg)\n    let usystem = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n    if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n    weight.converted = {\n      value: ffd20.utils.convertWeight(weight.value),\n      total: ffd20.utils.convertWeight(weight.total),\n    };\n    weight.units = usystem === \"metric\" ? game.i18n.localize(\"FFD20.Kgs\") : game.i18n.localize(\"FFD20.Lbs\");\n    itemData.priceUnits = game.i18n.localize(\"FFD20.CurrencyGil\").toLowerCase();\n  }\n\n  prepareDerivedData() {\n    super.prepareDerivedData();\n\n    // Physical items\n    if (this.isPhysical) {\n      // Sync name\n      if (this.system.identifiedName === undefined) this.system.identifiedName = this.name;\n      if (this.showUnidentifiedData) {\n        // Set unidentified name for players\n        const unidentifiedName = this.system.unidentified.name;\n        if (unidentifiedName) this.system.name = unidentifiedName;\n        // Set unidentified description for players\n        this.system.description.value = this.system.description.unidentified;\n      }\n    }\n  }\n\n  prepareBaseData() {\n    const itemData = this.system;\n\n    // Initialize tag for items that have tagged template\n    const itemTemplate = game.system.template.Item;\n    const taggedTypes = itemTemplate.types.filter((t) => itemTemplate[t].templates?.includes(\"tagged\"));\n    if (itemData.useCustomTag !== true && taggedTypes.includes(this.type)) {\n      itemData.tag = createTag(this.name);\n    }\n  }\n\n  prepareDerivedItemData() {\n    // Update maximum uses\n    this._updateMaxUses();\n  }\n\n  /**\n   * Returns this item's default labels, using the item's data and the first action's data, if one is present.\n   *\n   * @returns {Record<string, string>} This item's labels\n   */\n  prepareLabels() {\n    const action = this.firstAction;\n    return { ...this.getLabels(), ...(action?.getLabels() ?? {}) };\n  }\n\n  /**\n   * Returns labels for this item\n   *\n   * @returns {Record<string, string>} This item's labels\n   */\n  getLabels() {\n    const labels = {};\n    const itemData = this.system;\n\n    // Equipped label\n    const checkYes = '<i class=\"fas fa-check\"></i>';\n    const checkNo = '<i class=\"fas fa-times\"></i>';\n    labels.equipped = \"\";\n    if (itemData.equipped === true) labels.equipped = checkYes;\n    else labels.equipped = checkNo;\n\n    // Carried label\n    labels.carried = \"\";\n    if (itemData.carried === true) labels.carried = checkYes;\n    else labels.carried = checkNo;\n\n    // Identified label\n    labels.identified = \"\";\n    if (itemData.identified === true) labels.identified = checkYes;\n    else labels.identified = checkNo;\n\n    // Slot label\n    if (itemData.slot) {\n      // Add equipment slot\n      const equipmentType = this.system.equipmentType || null;\n      if (equipmentType != null) {\n        const equipmentSlot = this.system.slot || null;\n        labels.slot = equipmentSlot == null ? null : CONFIG.FFD20.equipmentSlots[equipmentType]?.[equipmentSlot];\n      } else labels.slot = null;\n    }\n\n    return labels;\n  }\n\n  prepareLinks() {\n    if (!this.links) return;\n\n    for (const [k, i] of Object.entries(this.links)) {\n      switch (k) {\n        case \"charges\": {\n          const uses = i.system.uses;\n          if (!uses) break;\n          for (const [k, v] of Object.entries(uses)) {\n            if ([\"autoDeductCharges\", \"autoDeductChargesCost\"].includes(k)) continue;\n            this.system.uses[k] = v;\n          }\n          break;\n        }\n      }\n    }\n  }\n\n  _prepareChanges(changes) {\n    const prior = this.changes;\n    const collection = new Collection();\n    for (const c of changes) {\n      let change = null;\n      if (prior && prior.has(c._id)) {\n        change = prior.get(c._id);\n        change.data = c;\n        change.prepareData();\n      } else change = new ffd20.components.ItemChange(c, this);\n      collection.set(c._id || change.data._id, change);\n    }\n    return collection;\n  }\n\n  _prepareActions(actions) {\n    const prior = this.actions;\n    const collection = new Collection();\n    for (const o of actions) {\n      let action = null;\n      if (prior && prior.has(o._id)) {\n        action = prior.get(o._id);\n        action.data = o;\n        action.prepareData();\n      } else action = new ffd20.components.ItemAction(o, this);\n      collection.set(o._id || action.data._id, action);\n    }\n    return collection;\n  }\n\n  _prepareScriptCalls(scriptCalls) {\n    const prior = this.scriptCalls;\n    const collection = new Collection();\n    for (const s of scriptCalls) {\n      let scriptCall = null;\n      if (prior && prior.has(s.id)) {\n        scriptCall = prior.get(s.id);\n        scriptCall.data = s;\n      } else scriptCall = new ffd20.components.ItemScriptCall(s, this);\n      collection.set(s._id || scriptCall.data._id, scriptCall);\n    }\n    return collection;\n  }\n\n  _prepareInventory(inventory) {\n    const prior = this.items;\n    const collection = new Collection();\n    for (const o of inventory) {\n      let item = null;\n      if (prior && prior.has(o._id)) {\n        item = prior.get(o._id);\n        item.updateSource(o);\n        item.reset();\n      } else {\n        item = new CONFIG.Item.documentClass(o);\n        item.parentItem = this;\n      }\n\n      collection.set(o._id || item.id, item);\n    }\n    return collection;\n  }\n\n  /**\n   * Executes all script calls on this item of a specified category.\n   *\n   * @param {string} category - The category of script calls to call.\n   * @param {Object<string, object>} [extraParams={}] - A dictionary of extra parameters to pass as variables for use in the script.\n   * @returns {Promise.<object>} The shared object between calls which may have been given data.\n   */\n  async executeScriptCalls(category, extraParams = {}) {\n    const scripts = this.scriptCalls?.filter((o) => o.category === category) ?? [];\n    const shared = {};\n    if (extraParams.attackData) {\n      shared.attackData = extraParams.attackData;\n      delete extraParams.attackData;\n    }\n\n    for (const s of scripts) {\n      await s.execute(shared, extraParams);\n    }\n\n    return shared;\n  }\n\n  async update(data, context = {}) {\n    // Avoid regular update flow for explicitly non-recursive update calls\n    if (context.recursive === false) {\n      return super.update(data, context);\n    }\n    const baseData = this.toObject();\n    const srcData = mergeObject(baseData, data, { inplace: false });\n\n    // Make sure stuff remains an array\n    {\n      const keepPaths = [\n        \"system.attackNotes\",\n        \"system.effectNotes\",\n        \"system.contextNotes\",\n        \"system.scriptCalls\",\n        \"system.actions\",\n        \"system.inventoryItems\",\n        \"system.changes\",\n      ];\n\n      for (const path of keepPaths) {\n        keepUpdateArray(this, data, path);\n        linkData(srcData, data, path, data[path]);\n      }\n    }\n\n    // Update price from base price\n    if (data[\"system.basePrice\"] != null) {\n      linkData(srcData, data, \"system.price\", getProperty(srcData, \"system.basePrice\") || 0);\n    }\n    if (data[\"system.unidentified.basePrice\"] != null) {\n      linkData(srcData, data, \"system.unidentified.price\", getProperty(srcData, \"system.unidentified.basePrice\") || 0);\n    }\n\n    // Update name\n    if (data[\"system.identifiedName\"]) linkData(srcData, data, \"name\", data[\"system.identifiedName\"]);\n    else if (data[\"name\"]) linkData(srcData, data, \"system.identifiedName\", data[\"name\"]);\n\n    // Make sure charges doesn't exceed max charges, and vice versa\n    if (this.isCharged) {\n      let charges = 0;\n      let maxCharges = 0;\n      let target = \"value\";\n\n      if (this.type === \"spell\") {\n        if (data[\"system.preparation.maxAmount\"] != null) target = \"max\";\n        charges = data[\"system.preparation.preparedAmount\"] ?? this.charges;\n        maxCharges = data[\"system.preparation.maxAmount\"] ?? this.maxCharges;\n      } else {\n        if (data[\"system.uses.max\"] != null) target = \"max\";\n        charges = data[\"system.uses.value\"] ?? this.charges;\n        maxCharges = data[\"system.uses.max\"] ?? this.maxCharges;\n      }\n\n      if (target === \"value\" && charges > maxCharges) maxCharges = charges;\n      else if (target === \"max\" && maxCharges < charges) charges = maxCharges;\n\n      const link = getProperty(this, \"links.charges\");\n      if (!link) {\n        if (this.type === \"spell\") {\n          if (charges !== undefined) linkData(srcData, data, \"system.preparation.preparedAmount\", charges);\n          if (maxCharges !== undefined) linkData(srcData, data, \"system.preparation.maxAmount\", maxCharges);\n        } else {\n          if (charges !== undefined) linkData(srcData, data, \"system.uses.value\", charges);\n          if (maxCharges !== undefined) linkData(srcData, data, \"system.uses.max\", maxCharges);\n        }\n      } else {\n        // Update charges for linked items\n        if (data[\"system.uses.value\"] != null) {\n          if (link && getProperty(link, \"links.charges\") == null) {\n            await link.update({ \"system.uses.value\": data[\"system.uses.value\"] });\n          }\n        }\n      }\n    }\n\n    this.memorizeVariables();\n\n    const diff = diffObject(flattenObject(this.toObject()), data);\n    // Filter diff for undefined values. Single value depth with speed as priority\n    for (const [k, v] of Object.entries(diff)) {\n      if (v === undefined) delete diff[k];\n    }\n    // Filter diff for arrays that haven't changed. Single level depth with speed as priority\n    for (const d of Object.keys(diff)) {\n      if (!Array.isArray(diff[d])) continue;\n      const origData = getProperty(this._source, d) || [];\n      if (diff[d].length !== origData?.length) continue;\n      const anyDiff = diff[d].some((obj, idx) => {\n        // Bidirectional diff is required or else it will not detect some changes (e.g. empty attack note being filled).\n        // First is additions, second is deletions.\n        if (\n          !foundry.utils.isEmpty(diffObjectAndArray(origData[idx], obj)) ||\n          !foundry.utils.isEmpty(diffObjectAndArray(obj, origData[idx]))\n        )\n          return true;\n      });\n      if (!anyDiff) delete diff[d];\n    }\n\n    if (Object.keys(diff).length && !context.skipUpdate) {\n      if (this.parentItem == null) {\n        await super.update(diff, context);\n      } else {\n        // Determine item index to update in parent\n        const parentInventory = this.parentItem.system.inventoryItems || [];\n        const parentItem = parentInventory.find((o) => o._id === this.id);\n        const idx = parentInventory.indexOf(parentItem);\n\n        if (idx >= 0) {\n          // Replace keys to suit parent item\n          for (const [k, v] of Object.entries(diff)) {\n            delete diff[k];\n            diff[`system.inventoryItems.${idx}.${k}`] = v;\n          }\n\n          // Update parent item\n          await this.parentItem.update(diff);\n        }\n      }\n    } else if (context.skipUpdate) {\n      diff[\"_id\"] = this.id;\n    }\n\n    // Update tokens and the actor using this item\n    const actor = this.parent;\n    if (actor) {\n      // Update tokens\n      const promises = [];\n      const tokens = canvas?.tokens?.placeables?.filter((token) => token.actor?.id === actor.id) ?? [];\n      for (const token of tokens) {\n        const tokenUpdateData = {};\n\n        // Update tokens with this item as a resource bar\n        if (diff[\"system.uses.value\"] != null) {\n          for (const barKey of [\"bar1\", \"bar2\"]) {\n            const bar = token.document.getBarAttribute(barKey);\n            if (bar && bar.attribute === `resources.${this.system.tag}`) {\n              tokenUpdateData[`${barKey}.value`] = diff[\"system.uses.value\"];\n            }\n          }\n        }\n\n        if (!foundry.utils.isEmpty(tokenUpdateData)) {\n          promises.push(token.document.update(tokenUpdateData));\n        }\n      }\n      if (promises.length) await Promise.all(promises);\n    }\n  }\n\n  memorizeVariables() {\n    if (this._memoryVariables != null) return;\n\n    const memKeys = this.memoryVariables;\n    this._memoryVariables = {};\n    for (const k of memKeys) {\n      if (hasProperty(this, k)) {\n        this._memoryVariables[k] = deepClone(getProperty(this, k));\n      }\n    }\n\n    // Memorize variables recursively on container items\n    for (const item of this.items ?? []) {\n      item.memorizeVariables();\n    }\n  }\n\n  _onUpdate(changed, options, userId) {\n    super._onUpdate(changed, options, userId);\n\n    if (userId === game.user.id) {\n      // Call 'toggle' script calls\n      {\n        let state = null;\n        if (this.type === \"buff\") state = getProperty(changed, \"system.active\");\n        if (this.type === \"feat\" && hasProperty(changed, \"system.disabled\"))\n          state = getProperty(changed, \"system.disabled\") === true ? false : true;\n        if (state != null) {\n          this.executeScriptCalls(\"toggle\", { state });\n        }\n      }\n\n      // Call 'equip' script calls\n      {\n        const equipped = getProperty(changed, \"system.equipped\");\n        if (equipped != null) {\n          this.executeScriptCalls(\"equip\", { equipped });\n        }\n      }\n\n      // Call 'changeQuantity' script calls\n      if (this._memoryVariables?.[\"system.quantity\"] !== undefined) {\n        const quantity = {\n          previous: this._memoryVariables[\"system.quantity\"],\n          new: getProperty(this, \"system.quantity\"),\n        };\n        if (quantity.new != null && quantity.new !== quantity.previous) {\n          this.executeScriptCalls(\"changeQuantity\", { quantity });\n        }\n      }\n\n      // Call 'changeLevel' script calls\n      if (this._memoryVariables?.[\"system.level\"] !== undefined) {\n        const level = {\n          previous: parseInt(this._memoryVariables[\"system.level\"]),\n          new: parseInt(getProperty(this, \"system.level\")),\n        };\n        for (const [k, v] of Object.entries(level)) {\n          if (Number.isNaN(v)) level[k] = null;\n        }\n        if (level.new !== undefined && level.new !== level.previous) {\n          this.executeScriptCalls(\"changeLevel\", { level });\n        }\n      }\n    }\n\n    // Call _onUpdate for changed items\n    for (let a = 0; a < (changed.system?.inventoryItems ?? []).length; a++) {\n      const itemUpdateData = changed.system?.inventoryItems[a];\n      const memoryItemData = this._memoryVariables?.[\"system.inventoryItems\"]?.[a];\n      if (!memoryItemData) continue;\n\n      const diffData = diffObjectAndArray(memoryItemData, itemUpdateData, { keepLength: true });\n      if (!foundry.utils.isEmpty(diffData)) {\n        const item = this.items.get(memoryItemData._id);\n        item._onUpdate(diffData, options, userId);\n      }\n    }\n\n    // Forget memory variables\n    this._memoryVariables = null;\n  }\n\n  _updateMaxUses() {\n    // No actor? No charges!\n    if (!this.parentActor) return;\n\n    // No charges? No charges!\n    if (![\"day\", \"week\", \"charges\"].includes(getProperty(this, \"system.uses.per\"))) return;\n\n    const rollData = this.getRollData();\n\n    if (hasProperty(this, \"system.uses.maxFormula\")) {\n      const maxFormula = getProperty(this, \"system.uses.maxFormula\");\n      if (maxFormula !== \"\" && !formulaHasDice(maxFormula)) {\n        const roll = RollFFD20.safeRoll(maxFormula, rollData);\n        setProperty(this, \"system.uses.max\", roll.total);\n      } else if (formulaHasDice(maxFormula)) {\n        const msg = game.i18n\n          .localize(\"FFD20.WarningNoDiceAllowedInFormula\")\n          .format(game.i18n.localize(\"FFD20.ChargePlural\"), this.name);\n        console.warn(msg);\n        ui.notifications.warn(msg);\n      }\n    }\n  }\n\n  // Determines the starting data for an ActiveEffect based off this item\n  getRawEffectData() {\n    return {\n      label: this.name,\n      icon: this.img,\n      origin: this.uuid,\n      flags: { ffd20: { origin: { item: this.id } } },\n      disabled: !this.isActive,\n      duration: {},\n    };\n  }\n\n  // Fetches all this item's script calls of a specified category\n  getScriptCalls(category) {\n    return this.scriptCalls?.filter((s) => s.category === category) ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Display the chat card for an Item as a message in chat\n   *\n   * @deprecated Use {@link displayCard} instead.\n   * @param {object} [altChatData={}] - Optional data that will be merged into the chat data object.\n   * @returns {Promise<ChatMessage | void>}\n   */\n  async roll(altChatData = {}) {\n    foundry.utils.logCompatibilityWarning(`ActorFFD20#roll has been deprecated in favor of ActorFFD20#displayCard`, {\n      since: \"FFD20 0.82.0\",\n      until: \"FFD20 0.83.0\",\n    });\n    return this.displayCard(altChatData);\n  }\n\n  /**\n   * Display the chat card for an Item as a message in chat\n   *\n   * @param {object} [altChatData={}] - Optional data that will be merged into the chat data object.\n   * @returns {Promise<ChatMessage | void>}\n   */\n  async displayCard(altChatData = {}) {\n    const actor = this.parent;\n    if (actor && !actor.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(actor.name);\n      console.warn(msg);\n      return ui.notifications.warn(msg);\n    }\n\n    // Basic template rendering data\n    const token = this.parentActor.token;\n    const rollData = this.getRollData();\n    const itemChatData = this.getChatData({ rollData });\n    const identified = Boolean(rollData.item?.identified ?? true);\n\n    const templateData = {\n      actor: this.parent,\n      tokenId: token ? token.uuid : null,\n      item: this.toObject(),\n      labels: this.labels,\n      hasAttack: this.hasAttack,\n      hasMultiAttack: this.hasMultiAttack,\n      hasAction: this.hasAction,\n      isVersatile: this.isVersatile,\n      isSpell: this.type === \"spell\",\n      name: (identified ? rollData.identifiedName : rollData.item.unidentified?.name) || this.name,\n      description: identified ? this.fullDescription : itemChatData.unidentifiedDescription,\n      rollData: rollData,\n      hasExtraProperties: false,\n      extraProperties: [],\n    };\n\n    const ffd20Flags = {};\n\n    // If the item is unidentified, store data for GM info box containing identified info\n    if (identified === false) {\n      ffd20Flags.identifiedInfo = {\n        identified,\n        name: rollData.identifiedName || this.name,\n        description: itemChatData.identifiedDescription,\n      };\n    }\n\n    // Add combat info\n    if (game.combat) {\n      const combatProps = [];\n      // Add round info\n      combatProps.push(game.i18n.localize(\"FFD20.CombatInfo_Round\").format(game.combat.round));\n\n      if (combatProps.length > 0) {\n        templateData.extraProperties.push({ header: game.i18n.localize(\"FFD20.CombatInfo_Header\"), value: combatProps });\n        templateData.hasExtraProperties = true;\n      }\n    }\n\n    // Roll spell failure chance\n    if (templateData.isSpell && this.parent != null && this.parent.spellFailure > 0 && this.system.components.somatic) {\n      const spellbook = getProperty(this.parent, `system.attributes.spells.spellbooks.${this.system.spellbook}`);\n      if (spellbook && spellbook.arcaneSpellFailure) {\n        templateData.spellFailure = RollFFD20.safeRoll(\"1d100\").total;\n        templateData.spellFailureSuccess = templateData.spellFailure > this.parentActor.spellFailure;\n      }\n    }\n\n    // Render the chat card template\n    const templateType = [\"consumable\"].includes(this.type) ? this.type : \"item\";\n    const template = `systems/ffd20/templates/chat/${templateType}-card.hbs`;\n\n    // Determine metadata\n    ffd20Flags.metadata = {};\n    ffd20Flags.metadata.item = this.id;\n\n    // Basic chat message data\n    const chatData = flattenObject(\n      mergeObject(\n        {\n          user: game.user.id,\n          type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n          speaker: ChatMessage.getSpeaker({ actor: this.parent }),\n          flags: {\n            core: {\n              canPopout: true,\n            },\n            ffd20: ffd20Flags,\n          },\n        },\n        altChatData\n      )\n    );\n\n    if (Hooks.call(\"ffd20DisplayCard\", this, { template, templateData, chatData }) === false) return;\n\n    // Create the chat message\n    return createCustomChatMessage(template, templateData, chatData);\n  }\n\n  /* -------------------------------------------- */\n  /*  Chat Cards\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\n  /* -------------------------------------------- */\n\n  /**\n   * Generates {@link ChatData} for this item, either in a default configuration or for a specific action.\n   *\n   * @param {EnrichmentOptions} [enrichOptions] - Options affecting how descriptions are enriched.\n   *                                              `rollData` defaults to {@link ItemAction#getRollData}/{@link ItemFFD20#getRollData}.\n   *                                              `secrets` defaults to {@link Item#isOwner}.\n   * @param {object} [options] - Additional options affecting the chat data generation\n   * @param {string} [options.actionId] - The ID of an action on this item to generate chat data for,\n   *                                      defaults to {@link ItemFFD20.firstAction}\n   * @returns {ChatData} The chat data for this item (+action)\n   */\n  getChatData(enrichOptions = {}, options = {}) {\n    /** @type {ChatData} */\n    const data = {};\n    const { actionId = null } = options;\n    const action = actionId ? this.actions.get(actionId) : this.firstAction;\n    const labels = { ...this.getLabels(), ...(action?.getLabels() ?? {}) };\n\n    enrichOptions.rollData ??= action ? action.getRollData() : this.getRollData();\n    enrichOptions.secrets ??= this.isOwner;\n    enrichOptions.async = false; // @TODO: Work on making this async, somehow\n\n    const itemData = enrichOptions.rollData?.item ?? this.system;\n    const actionData = enrichOptions.rollData?.action ?? action?.data ?? {};\n\n    // Rich text descriptions\n    data.identifiedDescription = TextEditor.enrichHTML(itemData.description.value, enrichOptions);\n    if (itemData.shortDescription) {\n      data.identifiedDescription = `${data.identifiedDescription}${TextEditor.enrichHTML(\n        itemData.shortDescription,\n        enrichOptions\n      )}`;\n    }\n    data.unidentifiedDescription = TextEditor.enrichHTML(itemData.description.unidentified, enrichOptions);\n    data.description = this.showUnidentifiedData ? data.unidentifiedDescription : data.identifiedDescription;\n    data.actionDescription = TextEditor.enrichHTML(actionData.description, enrichOptions);\n\n    // General equipment properties\n    const props = [];\n    if (Object.prototype.hasOwnProperty.call(itemData, \"equipped\") && [\"weapon\", \"equipment\"].includes(this.type)) {\n      props.push(itemData.equipped ? game.i18n.localize(\"FFD20.Equipped\") : game.i18n.localize(\"FFD20.NotEquipped\"));\n    }\n\n    if (!this.showUnidentifiedData) {\n      // Gather dynamic labels\n      const dynamicLabels = {};\n      dynamicLabels.range = labels.range || \"\";\n      dynamicLabels.level = labels.sl || \"\";\n      // Range\n      if (actionData.range != null) {\n        const range = action.getRange({ type: \"max\" }),\n          units = actionData.range.units === \"mi\" ? \"mi\" : \"ft\";\n        const distanceValues = convertDistance(range, units);\n        dynamicLabels.range =\n          range > 0 ? game.i18n.format(\"FFD20.RangeNote\", { 0: `${range} ${distanceValues[1]}` }) : null;\n      }\n\n      // Add Difficulty Modifier (DC) label\n      props.push(labels.save);\n      const saveDesc = actionData.save?.description;\n      if (saveDesc?.length > 0) props.push(saveDesc);\n\n      // Duration\n      if (actionData.duration != null) {\n        if (![\"inst\", \"perm\"].includes(actionData.duration.units) && typeof actionData.duration.value === \"string\") {\n          const duration = RollFFD20.safeRoll(actionData.duration.value || \"0\", enrichOptions.rollData).total;\n          dynamicLabels.duration = [duration, CONFIG.FFD20.timePeriods[actionData.duration.units]].filterJoin(\" \");\n        }\n      }\n\n      // Ability activation properties\n      if (actionData.activation?.type) {\n        props.push(labels.target, labels.activation, dynamicLabels.range, dynamicLabels.duration);\n      }\n    }\n\n    // Get per item type chat data\n    this.getTypeChatData(data, labels, props, enrichOptions.rollData);\n\n    // Filter properties and return\n    data.properties = props.filter((p) => !!p);\n    return data;\n  }\n\n  /**\n   * Per item type chat data.\n   *\n   * @param {ChatData} data - A partial of a chat data object that can be modified to add per item type data.\n   * @param {Object<string, string>} labels - The labels for this item.\n   * @param {string[]} props - Additional property strings\n   * @param {object} rollData - A rollData object to be used for checks\n   */\n  getTypeChatData(data, labels, props, rollData) {\n    // Charges as used by most item types, except spells\n    if (this.isCharged) {\n      props.push(`${game.i18n.localize(\"FFD20.ChargePlural\")}: ${this.charges}/${this.maxCharges}`);\n    }\n  }\n\n  /* -------------------------------------------- */\n  /*  Item Rolls - Attack, Damage, Saves, Checks  */\n  /* -------------------------------------------- */\n\n  /**\n   * @deprecated Use {@link use ItemFFD20#use} instead.\n   * @param options\n   * @returns {Promise<*>}\n   */\n  useAttack(options) {\n    foundry.utils.logCompatibilityWarning(\"ItemFFD20#useAttack has been deprecated in favor of ItemFFD20#use\", {\n      since: \"FFD20 0.82.0\",\n      until: \"FFD20 0.83.0\",\n    });\n    return this.use(options);\n  }\n\n  /**\n   * Use an attack, using {@link SharedActionData}\n   *\n   * @see {@link SharedActionData}\n   * @param {string} [actionID=\"\"] - The ID of the action to use, defaults to the first action\n   * @param {Event | null} [ev=null] - The event that triggered the use, if any\n   * @param {boolean} [skipDialog=false] - Whether to skip the dialog for this action\n   * @param {boolean} [chatMessage=true] - Whether to send a chat message for this action\n   * @param {string} [dice=\"1d20\"] - The base dice to roll for this action\n   * @param {string} [rollMode] - The roll mode to use for the chat message\n   * @returns {Promise<SharedActionData | void | ChatMessage | *>}\n   */\n  async use({ actionID = \"\", ev = null, skipDialog = false, chatMessage = true, dice = \"1d20\", rollMode } = {}) {\n    // Old use method\n    if (!this.hasAction) {\n      // Use\n      const useScriptCalls = this.scriptCalls.filter((o) => o.category === \"use\");\n      let shared;\n      if (useScriptCalls.length > 0) {\n        shared = await this.executeScriptCalls(\"use\", {\n          attackData: { event: ev, skipDialog, chatMessage, rollMode },\n        });\n        if (shared.reject) return shared;\n        if (shared.hideChat !== true) await this.displayCard();\n      }\n      // Show a chat card if this item doesn't have 'use' type script call(s)\n      else {\n        if (chatMessage) return this.displayCard({ rollMode });\n        else return { descriptionOnly: true }; // nothing to show for printing description\n      }\n\n      // Deduct charges\n      if (this.isCharged) {\n        if (this.charges < this.chargeCost) {\n          if (this.isSingleUse) {\n            const msg = game.i18n.localize(\"FFD20.ErrorNoQuantity\");\n            console.warn(msg);\n            return ui.notifications.warn(msg);\n          }\n          const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(this.name);\n          console.warn(msg);\n          return ui.notifications.warn(msg);\n        }\n        if (this.autoDeductCharges) {\n          await this.addCharges(-this.chargeCost);\n        }\n      }\n\n      return shared;\n    }\n\n    if (ev && ev.originalEvent) ev = ev.originalEvent;\n\n    /** @type {ItemAction | undefined} */\n    let action;\n    if (!actionID && this.system.actions.length > 1 && skipDialog === false) {\n      const app = new ffd20.applications.ActionChooser(this);\n      app.render(true);\n      return;\n    } else if (actionID || this.system.actions.length === 1 || skipDialog) {\n      action = this.actions.get(actionID || this.system.actions[0]._id);\n    } else {\n      console.error(\"This item does not have an action associated with it.\");\n      return;\n    }\n\n    // Prepare variables\n    /** @type {SharedActionData} */\n    const shared = {\n      event: ev,\n      rollData: {},\n      skipDialog,\n      chatMessage,\n      dice,\n      fullAttack: true,\n      attackBonus: [],\n      damageBonus: [],\n      attacks: [],\n      chatAttacks: [],\n      rollMode: game.settings.get(\"core\", \"rollMode\"),\n      useMeasureTemplate: action.hasTemplate && game.settings.get(\"ffd20\", \"placeMeasureTemplateOnQuickRolls\"),\n      conditionals: null,\n      conditionalPartsCommon: {},\n      casterLevelCheck: false,\n      concentrationCheck: false,\n      scriptData: {},\n    };\n\n    // Prevent reassigning the ActionUse's item and action\n    Object.defineProperties(shared, {\n      action: { value: action, writable: false, enumerable: true },\n      item: { value: this, writable: false, enumerable: true },\n    });\n\n    const actionUse = new ActionUse(shared);\n\n    // Check requirements for item\n    let reqErr = await actionUse.checkRequirements();\n    if (reqErr > 0) return { err: ffd20.actionUse.ERR_REQUIREMENT, code: reqErr };\n\n    // Get new roll data\n    shared.rollData = await actionUse.getRollData();\n\n    // Show attack dialog, if appropriate\n    if (!skipDialog) {\n      const result = await actionUse.createAttackDialog();\n\n      // Stop if result is a boolean (i.e. when closed is clicked on the dialog)\n      if (typeof result !== \"object\") return;\n\n      // Alter roll data\n      shared.fullAttack = result.fullAttack;\n      shared.attacks = result.attacks;\n      await actionUse.alterRollData(result.html);\n    } else {\n      shared.attacks = await actionUse.generateAttacks();\n      await actionUse.alterRollData();\n    }\n\n    // Filter out attacks without ammo usage\n    if (shared.action.data.usesAmmo) {\n      shared.attacks = shared.attacks.filter((o) => o.ammo != null);\n      if (shared.attacks.length === 0) {\n        ui.notifications.error(game.i18n.localize(\"FFD20.AmmoDepleted\"));\n        return;\n      }\n    }\n\n    // Limit attacks to 1 if not full rounding\n    if (!shared.fullAttack) shared.attacks = shared.attacks.slice(0, 1);\n    // Handle conditionals\n    await actionUse.handleConditionals();\n\n    // Check attack requirements, post-dialog\n    reqErr = await actionUse.checkAttackRequirements();\n    if (reqErr > 0) return { err: ffd20.actionUse.ERR_REQUIREMENT, code: reqErr };\n\n    // Generate chat attacks\n    await actionUse.generateChatAttacks();\n\n    // Prompt measure template\n    let measureResult;\n    if (shared.useMeasureTemplate && canvas.scene) {\n      measureResult = await actionUse.promptMeasureTemplate();\n      if (!measureResult.result) return;\n    }\n\n    // Override roll mode if present.\n    if (rollMode) shared.rollMode = rollMode;\n\n    // Call itemUse hook and determine whether the item can be used based off that\n    let allowed = Hooks.call(\"ffd20PreActionUse\", actionUse);\n    allowed = callOldNamespaceHook(\"itemUse\", \"ffd20PreUseAttack\", allowed, this, \"attack\", {\n      ev,\n      skipDialog,\n      dice,\n      shared,\n    });\n    if (allowed === false) {\n      await measureResult?.delete();\n      return;\n    }\n\n    // Call script calls\n    await actionUse.executeScriptCalls();\n    if (shared.scriptData?.reject) {\n      await measureResult?.delete();\n      return;\n    }\n\n    // Handle Dice So Nice\n    await actionUse.handleDiceSoNice();\n\n    // Subtract uses\n    await actionUse.subtractAmmo();\n    if (shared.rollData.chargeCost < 0 || shared.rollData.chargeCost > 0)\n      await this.addCharges(-shared.rollData.chargeCost);\n    if (shared.action.isSelfCharged)\n      await shared.action.update({ \"uses.self.value\": shared.action.data.uses.self.value - 1 });\n\n    // Retrieve message data\n    await actionUse.getMessageData();\n\n    // Post message\n    let result;\n    if (shared.scriptData?.hideChat !== true) {\n      result = await actionUse.postMessage();\n    } else return;\n\n    // Deselect targets\n    if (game.settings.get(\"ffd20\", \"clearTargetsAfterAttack\")) {\n      for (const t of game.user.targets) {\n        t.setTarget(false);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Finds, filters and alters changes relevant to a context, and returns the result (as an array)\n   *\n   * @param {string} [context=\"mattack\"] - The given context. Either \"mattack\", \"rattack\", \"wdamage\", \"sdamage\".\n   * @returns {ItemChange[]} The resulting changes.\n   */\n  getContextChanges(context = \"attack\") {\n    let result = this.parentActor.changes;\n\n    switch (context) {\n      case \"mattack\":\n      case \"rattack\": {\n        const subTargetList = [\"attack\", context];\n        result = result.filter((c) => {\n          if (!subTargetList.includes(c.subTarget)) return false;\n          return true;\n        });\n        break;\n      }\n      case \"wdamage\":\n      case \"sdamage\": {\n        const subTargetList = [\"damage\", context];\n        result = result.filter((c) => {\n          if (!subTargetList.includes(c.subTarget)) return false;\n          return true;\n        });\n        break;\n      }\n      case \"damage\": {\n        result = result.filter((c) => c.subTarget === \"damage\");\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * @returns {object} An object with data to be used in rolls in relation to this item.\n   */\n  getRollData() {\n    const parentActor = this.parentActor;\n    const result = parentActor ? parentActor.getRollData() : {};\n\n    result.item = deepClone(this.system);\n\n    // Add dictionary flag\n    if (this.system.tag) {\n      result.item.dFlags = getProperty(result, `dFlags.${this.system.tag}`);\n    }\n\n    // Set aura strength\n    setProperty(result, \"item.auraStrength\", this.auraStrength);\n\n    result.dc = this.hasSave ? this.getDC(result) : 0;\n\n    this._rollData = result.item;\n\n    if (Hooks.events[\"ffd20GetRollData\"]?.length > 0) Hooks.callAll(\"ffd20GetRollData\", this, result);\n    callOldNamespaceHookAll(\"ffd20.getRollData\", \"ffd20GetRollData\", this, result, true);\n\n    return result;\n  }\n\n  /* -------------------------------------------- */\n\n  static chatListeners(html) {\n    html.on(\"click\", \".card-buttons button, .inline-action\", this._onChatCardButton.bind(this));\n    html.on(\"click\", \".item-name\", this._onChatCardToggleContent.bind(this));\n  }\n\n  /* -------------------------------------------- */\n\n  static async _onChatCardButton(event) {\n    event.preventDefault();\n\n    // Extract card data\n    const button = event.currentTarget;\n    button.disabled = true;\n    const card = button.closest(\".chat-card\");\n    const messageId = card.closest(\".message\").dataset.messageId;\n    const message = game.messages.get(messageId);\n    const action = button.dataset.action;\n\n    // Validate permission to proceed with the roll\n    const isTargetted = [\"save\", \"applyDamage\"].includes(action);\n    if (!(isTargetted || game.user.isGM || message.isAuthor)) return;\n\n    // Get the Actor from a synthetic Token\n    const actor = await this._getChatCardActor(card);\n    if (!actor) {\n      if (action === \"applyDamage\") {\n        await this._onChatCardAction(action, { button: button });\n        button.disabled = false;\n      }\n      return;\n    }\n\n    // Get the Item\n    const item = actor.items.get(card.dataset.itemId);\n\n    // Perform action\n    if (!(await this._onChatCardAction(action, { button: button, item: item }))) {\n      button.disabled = false;\n    }\n  }\n\n  static async _onChatCardAction(action, { button = null, item = null } = {}) {\n    // Get card targets\n    // const targets = isTargetted ? this._getChatCardTargets(card) : [];\n\n    // Apply damage\n    if (action === \"applyDamage\") {\n      let asNonlethal = [...(button.closest(\".chat-message\")?.querySelectorAll(\".tag\") ?? [])]\n        .map((o) => o.innerText)\n        .includes(game.i18n.localize(\"FFD20.Nonlethal\"));\n      if (button.dataset.tags?.split(\" \").includes(\"nonlethal\")) asNonlethal = true;\n\n      const value = button.dataset.value;\n      if (!isNaN(parseInt(value))) CONFIG.Actor.documentClasses.default.applyDamage(parseInt(value), { asNonlethal });\n    }\n    // Recover ammunition\n    else if ([\"recoverAmmo\", \"forceRecoverAmmo\"].includes(action)) {\n      if (!item) return;\n      if (!item.isOwner) return;\n\n      // Check for recovery state\n      const attackIndex = button.closest(\".chat-attack\").dataset.index;\n      const card = game.messages.get(button.closest(\".chat-message\").dataset.messageId);\n      const ammoId = button.closest(\".ammo\")?.dataset.ammoId || button.dataset.ammoId;\n      const recoveryData = card.getFlag(\"ffd20\", \"ammoRecovery\");\n      const ammoRecovery = recoveryData?.[attackIndex]?.[ammoId];\n      if (ammoRecovery?.failed || ammoRecovery?.recovered) return;\n\n      let recovered = false;\n      let failed = false;\n      const promises = [];\n\n      // Find ammo item\n      const ammoItem = item.actor.items.get(ammoId);\n      if (!ammoItem) return;\n      let chance = 100;\n      if (action === \"recoverAmmo\") {\n        chance = 50; // @TODO: Allow user to set chance to something else, somehow\n      }\n\n      // (Try to) recover ammo\n      if (chance >= Math.random() * 100) {\n        recovered = true;\n        promises.push(ammoItem.addCharges(1));\n      } else {\n        failed = true;\n      }\n\n      // Update chat card\n      if (recovered || failed) {\n        if (attackIndex) {\n          promises.push(card.setFlag(\"ffd20\", \"ammoRecovery\", { [attackIndex]: { [ammoId]: { failed, recovered } } }));\n        }\n      }\n\n      await Promise.all(promises);\n\n      return true;\n    } else if (action === \"concentration\") {\n      item.parentActor.rollConcentration(item.system.spellbook);\n    } else if (action === \"caster-level-check\") {\n      item.parentActor.rollCL(item.system.spellbook);\n    }\n\n    return false;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle toggling the visibility of chat card content when the name is clicked\n   *\n   * @param {Event} event   The originating click event\n   * @private\n   */\n  static _onChatCardToggleContent(event) {\n    event.preventDefault();\n    const header = event.currentTarget;\n    const card = header.closest(\".chat-card\");\n    const content = card.querySelector(\".card-content\");\n    content.style.display = content.style.display === \"none\" ? \"block\" : \"none\";\n\n    // Update chat popout size\n    const popout = header.closest(\".chat-popout\");\n    if (popout) {\n      popout.style.height = \"auto\";\n    }\n  }\n\n  /**\n   * Get the Actor which is the author of a chat card\n   *\n   * @param {HTMLElement} card    The chat card being used\n   * @returns {Actor|null}         The Actor Document or null\n   * @private\n   */\n  static async _getChatCardActor(card) {\n    // Case 1 - a synthetic actor from a Token\n    const tokenUuid = card.dataset.tokenId;\n    if (tokenUuid) {\n      return (await fromUuid(tokenUuid))?.actor;\n    }\n\n    // Case 2 - use Actor ID directory\n    const actorId = card.dataset.actorId;\n    return game.actors.get(actorId) || null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the Actor which is the author of a chat card\n   *\n   * @param {HTMLElement} card    The chat card being used\n   * @returns {Array.<Actor>}      The Actor Document or null\n   * @private\n   */\n  static _getChatCardTargets(card) {\n    const character = game.user.character;\n    const controlled = canvas.tokens.controlled;\n    const targets = controlled.reduce((arr, t) => (t.actor ? arr.concat([t.actor]) : arr), []);\n    if (character && controlled.length === 0) targets.push(character);\n    if (!targets.length) throw new Error(`You must designate a specific Token as the roll target`);\n    return targets;\n  }\n\n  /**\n   * @param {string} linkType - The type of link.\n   * @param {string} dataType - Either \"compendium\", \"data\" or \"world\".\n   * @param {object} targetItem - The target item to link to.\n   * @param {string} itemLink - The link identifier for the item.\n   * @returns {boolean} Whether a link to the item is possible here.\n   */\n  canCreateItemLink(linkType, dataType, targetItem, itemLink) {\n    const actor = this.parent;\n    const sameActor = actor && targetItem.actor && targetItem.actor.id === actor.id;\n\n    // Don't create link to self\n    const itemId = itemLink.split(\".\").slice(-1)[0];\n    if (itemId === this.id) return false;\n\n    // Don't create existing links\n    const links = getProperty(this, `system.links.${linkType}`) || [];\n    if (links.filter((o) => o.id === itemLink).length) return false;\n\n    const targetLinks = getProperty(targetItem, `system.links.${linkType}`);\n    if ([\"children\", \"charges\", \"ammunition\"].includes(linkType) && sameActor) {\n      if (linkType === \"charges\") {\n        // Prevent the closing of charge link loops\n        if (targetLinks.length > 0) {\n          ui.notifications.warn(\n            game.i18n.localize(\"FFD20.WarningCannotCreateChargeLink\").format(this.name, targetItem.name)\n          );\n          return false;\n        } else if (targetItem.links.charges != null) {\n          // Prevent the linking of one item to multiple resource pools\n          ui.notifications.warn(\n            game.i18n\n              .localize(\"FFD20.WarningCannotCreateChargeLink2\")\n              .format(this.name, targetItem.name, targetItem.links.charges.name)\n          );\n          return false;\n        }\n      }\n      return true;\n    }\n\n    if (linkType === \"classAssociations\" && dataType === \"compendium\") return true;\n\n    return false;\n  }\n\n  /**\n   * @param {string} linkType - The type of link.\n   * @param {string} dataType - Either \"compendium\", \"data\" or \"world\".\n   * @param {object} targetItem - The target item to link to.\n   * @param {string} itemLink - The link identifier for the item.\n   * @returns {Array} An array to insert into this item's link data.\n   */\n  generateInitialLinkData(linkType, dataType, targetItem, itemLink) {\n    const result = {\n      id: itemLink,\n      dataType: dataType,\n      name: targetItem.name,\n      img: targetItem.img,\n    };\n\n    if (linkType === \"classAssociations\") {\n      result.level = 1;\n    }\n\n    if (linkType === \"ammunition\") {\n      result.recoverChance = 50;\n    }\n\n    return result;\n  }\n\n  /**\n   * Creates a link to another item.\n   *\n   * @param {string} linkType - The type of link.\n   * e.g. \"children\", \"charges\", \"classAssociations\" or \"ammunition\".\n   * @param {string} dataType - Either \"compendium\", \"data\" or \"world\".\n   * @param {object} targetItem - The target item to link to.\n   * @param {string} itemLink - The link identifier for the item.\n   * e.g. \"world.NExqvEMCMbDuDxv5\" (world item), \"ffd20.feats.NExqvEMCMbDuDxv5\" (compendium item) or\n   * \"NExqvEMCMbDuDxv5\" (item on same actor)\n   * @returns {boolean} Whether a link was created.\n   */\n  async createItemLink(linkType, dataType, targetItem, itemLink) {\n    if (this.canCreateItemLink(linkType, dataType, targetItem, itemLink)) {\n      const updateData = {};\n      const _links = duplicate(getProperty(this, `system.links.${linkType}`) || []);\n      const link = this.generateInitialLinkData(linkType, dataType, targetItem, itemLink);\n      _links.push(link);\n      updateData[`system.links.${linkType}`] = _links;\n\n      // Call link creation hook\n      await this.update(updateData);\n      callOldNamespaceHookAll(\"createItemLink\", \"ffd20CreateItemLink\", this, link, linkType);\n      Hooks.callAll(\"ffd20CreateItemLink\", this, link, linkType);\n\n      /**\n       * @TODO This is a really shitty way of re-rendering the actor sheet, so I should change this method at some point,\n       * but the premise is that the actor sheet should show data for newly linked items, and it won't do it immediately for some reason\n       */\n      window.setTimeout(() => {\n        if (this.parent) this.parent.sheet.render();\n      }, 50);\n\n      return true;\n    } else if (linkType === \"children\" && dataType !== \"data\") {\n      const itemData = targetItem.toObject();\n      delete itemData._id;\n\n      // Default to spell-like tab until a selector is designed in the Links tab or elsewhere\n      if (getProperty(itemData, \"type\") === \"spell\") setProperty(itemData, \"system.spellbook\", \"spelllike\");\n\n      const newItemData = await this.parent.createEmbeddedDocuments(\"Item\", [itemData]);\n      const newItem = this.parent.items.get(newItemData._id);\n\n      await this.createItemLink(\"children\", \"data\", newItem, newItem._id);\n    }\n\n    return false;\n  }\n\n  async getLinkedItems(type, extraData = false) {\n    const items = getProperty(this, `system..links.${type}`);\n    if (!items) return [];\n\n    const result = [];\n    for (const l of items) {\n      const item = await this.getLinkItem(l, extraData);\n      if (item) result.push(item);\n    }\n\n    return result;\n  }\n\n  async getAllLinkedItems() {\n    const result = [];\n\n    for (const items of Object.values(getProperty(this, \"system.links\"))) {\n      for (const l of items) {\n        const item = await this.getLinkItem(l);\n        if (item) result.push(item);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Removes all link references to an item.\n   *\n   * @param {string} id - The id of the item to remove links to.\n   */\n  async removeItemLink(id) {\n    const updateData = {};\n    for (const [k, linkItems] of Object.entries(getProperty(this, \"system.links\") || {})) {\n      const items = duplicate(linkItems);\n      for (let a = 0; a < items.length; a++) {\n        const item = items[a];\n        if (item.id === id) {\n          items.splice(a, 1);\n          a--;\n        }\n      }\n\n      if (linkItems.length > items.length) {\n        updateData[`data.links.${k}`] = items;\n      }\n    }\n\n    if (Object.keys(updateData).length) {\n      return this.update(updateData);\n    }\n  }\n\n  async getLinkItem(l, extraData = false) {\n    const id = l.id.split(\".\");\n    let item;\n\n    // Compendium entry\n    if (l.dataType === \"compendium\") {\n      const pack = game.packs.get(id.slice(0, 2).join(\".\"));\n      if (!pack) return null;\n      item = await pack.getDocument(id[2]);\n    }\n    // World entry\n    else if (l.dataType === \"world\") {\n      item = game.items.get(id[1]);\n    }\n    // Same actor's item\n    else if (this.parent != null && this.parent.items != null) {\n      item = this.parent.items.get(id[0]);\n    }\n\n    // Package extra data\n    if (extraData) {\n      item = { item: item, linkData: l };\n    }\n\n    return item;\n  }\n\n  async updateLinkItems() {\n    // Update link items\n    const linkGroups = getProperty(this, \"system.links\") || {};\n    for (const links of Object.values(linkGroups)) {\n      for (const l of links) {\n        const i = await this.getLinkItem(l);\n        if (i == null) {\n          l.name = l.name + (l.name?.indexOf(\"[x]\") > -1 ? \"\" : \" [x]\");\n          l.img = CONST.DEFAULT_TOKEN;\n          continue;\n        }\n        l.name = i.name;\n        l.img = i.img;\n      }\n    }\n  }\n\n  _cleanLink(oldLink, linkType) {\n    if (!this.parent) return;\n\n    const otherItem = this.parent.items.get(oldLink.id);\n    if (linkType === \"charges\" && otherItem && hasProperty(otherItem, \"links.charges\")) {\n      delete otherItem.links.charges;\n    }\n  }\n\n  /**\n   * Generates lists of change subtargets this item can have.\n   *\n   * @param {string} target - The target key, as defined in CONFIG.FFD20.buffTargets.\n   * @returns {Object<string, string>} A list of changes\n   */\n  getChangeSubTargets(target) {\n    const result = {};\n    // Add specific skills\n    if (target === \"skill\") {\n      if (this.parent == null) {\n        for (const [s, skl] of Object.entries(CONFIG.FFD20.skills)) {\n          result[`skill.${s}`] = skl;\n        }\n      } else {\n        const actorSkills = mergeObject(duplicate(CONFIG.FFD20.skills), this.parent.data.skills);\n        for (const [s, skl] of Object.entries(actorSkills)) {\n          if (!skl.subSkills) {\n            if (skl.custom) result[`skill.${s}`] = skl.name;\n            else result[`skill.${s}`] = CONFIG.FFD20.skills[s];\n          } else {\n            for (const [s2, skl2] of Object.entries(skl.subSkills)) {\n              result[`skill.${s}.subSkills.${s2}`] = `${CONFIG.FFD20.skills[s]} (${skl2.name})`;\n            }\n          }\n        }\n      }\n    }\n    // Add static subtargets\n    else if (hasProperty(CONFIG.FFD20.buffTargets, target)) {\n      for (const [k, v] of Object.entries(CONFIG.FFD20.buffTargets[target])) {\n        if (!k.startsWith(\"_\") && !k.startsWith(\"~\")) result[k] = v;\n      }\n    }\n\n    return result;\n  }\n\n  async addChange() {\n    const change = new ItemChange({}, this);\n    return change;\n  }\n\n  /**\n   * Returns the currency this item contains\n   *\n   * @param {object} [options] - Additional options affecting how the value is returned\n   * @param {boolean} [options.inLowestDenomination=false] - Whether to return the value in copper, or in gil (default)\n   * @returns {number} The total amount of currency this item contains, in gil pieces\n   */\n  getTotalCurrency({ inLowestDenomination = false } = {}) {\n    return 0;\n  }\n\n  /**\n   * Returns the displayed value of an item according to multiple options\n   *\n   * @param {object} [options] - Various optional parameters affecting value calculations\n   * @param {boolean} [options.recursive=true] - Whether the value of contained items should be included\n   * @param {number} [options.sellValue=0.5] - The sell value multiplier\n   * @param {boolean} [options.inLowestDenomination=false] - Whether the value should be returned in the lowest denomination\n   * @param {boolean} [options.forceUnidentified=false] - Override whether the value should use the unidentified price\n   * @returns {number} The item's value\n   */\n  getValue({ recursive = true, sellValue = 0.5, inLowestDenomination = false, forceUnidentified = false } = {}) {\n    let result = 0;\n\n    const getActualValue = (identified = true) => {\n      let value = 0;\n      if (identified) value = this.system.price;\n      else value = this.system.unidentified.price;\n\n      // Add charge price\n      if (identified) value += (this.system.uses?.pricePerUse ?? 0) * (this.system.uses?.value ?? 0);\n\n      if (inLowestDenomination) value *= 100;\n      if (this.system.broken) value *= 0.75; // TODO: Make broken value configurable\n      return value;\n    };\n\n    const quantity = getProperty(this, \"system.quantity\") || 0;\n\n    // Add item's price\n    result += getActualValue(forceUnidentified ? false : !this.showUnidentifiedData) * quantity;\n\n    // Modify sell value\n    if (!(this.type === \"loot\" && this.system.subType === \"tradeGoods\")) result *= sellValue;\n\n    // Add item's contained currencies at full value\n    result += this.getTotalCurrency({ inLowestDenomination });\n\n    return result;\n  }\n\n  /**\n   * Converts currencies of the given category to the given currency type\n   *\n   * @param {string} type - Either 'pgil', 'gil', 'sgil' or 'cgil'. Converts as much currency as possible to this type.\n   */\n  convertCurrency(type = \"pgil\") {\n    const totalValue = this.getTotalCurrency();\n    const values = [0, 0, 0, 0];\n    switch (type) {\n      case \"pgil\":\n        values[0] = Math.floor(totalValue / 10);\n        values[1] = Math.max(0, Math.floor(totalValue) - values[0] * 10);\n        values[2] = Math.max(0, Math.floor(totalValue * 10) - values[0] * 100 - values[1] * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[0] * 1000 - values[1] * 100 - values[2] * 10);\n        break;\n      case \"gil\":\n        values[1] = Math.floor(totalValue);\n        values[2] = Math.max(0, Math.floor(totalValue * 10) - values[1] * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[1] * 100 - values[2] * 10);\n        break;\n      case \"sgil\":\n        values[2] = Math.floor(totalValue * 10);\n        values[3] = Math.max(0, Math.floor(totalValue * 100) - values[2] * 10);\n        break;\n      case \"cgil\":\n        values[3] = Math.floor(totalValue * 100);\n        break;\n    }\n\n    const updateData = {};\n    updateData[`data.currency.pgil`] = values[0];\n    updateData[`data.currency.gil`] = values[1];\n    updateData[`data.currency.sgil`] = values[2];\n    updateData[`data.currency.cgil`] = values[3];\n    return this.update(updateData);\n  }\n\n  _calculateCoinWeight(data) {\n    const coinWeightDivisor = game.settings.get(\"ffd20\", \"coinWeight\");\n    if (!coinWeightDivisor) return 0;\n    return (\n      Object.values(getProperty(data, \"currency\") || {}).reduce((cur, amount) => {\n        return cur + amount;\n      }, 0) / coinWeightDivisor\n    );\n  }\n\n  /**\n   * Sets a boolean flag on this item.\n   *\n   * @param {string} flagName - The name/key of the flag to set.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async addItemBooleanFlag(flagName, context = {}) {\n    flagName = String(flagName);\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n\n    if (Array.isArray(flags)) throw new Error(`${this.name} [${this.id}] requires migration.`);\n\n    if (flags[flagName] === undefined) {\n      await this.update({ [`data.flags.boolean.${flagName}`]: true }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Removes a boolean flag from this item.\n   *\n   * @param {string} flagName - The name/key of the flag to remove.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async removeItemBooleanFlag(flagName, context = {}) {\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n\n    if (flags[flagName] !== undefined) {\n      await this.update({ [`data.flags.boolean.-=${flagName}`]: null }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * @param {string} flagName - The name/key of the flag on this item.\n   * @returns {boolean} Whether the flag was found on this item.\n   */\n  hasItemBooleanFlag(flagName) {\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n    return flags[flagName] === true;\n  }\n\n  /**\n   * Get all item boolean flags as array.\n   *\n   * @returns {string[]}\n   */\n  getItemBooleanFlags() {\n    const flags = getProperty(this, \"system.flags.boolean\") ?? {};\n    return Object.keys(flags);\n  }\n\n  /**\n   * Sets a dictionary flag value on this item.\n   *\n   * @param {string} flagName - The name/key of the flag to set.\n   * @param {number|string} value - The flag's new value.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async setItemDictionaryFlag(flagName, value, context = {}) {\n    flagName = String(flagName);\n    const flags = duplicate(getProperty(this, \"system.flags.dictionary\") ?? {});\n\n    if (flags[flagName] !== value) {\n      await this.update({ [`data.flags.dictionary.${flagName}`]: value }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Removes a dictionary flag from this item.\n   *\n   * @param {string} flagName - The name/key of the flag to remove.\n   * @param {object} context Update context\n   * @returns {Promise<boolean>} Whether something was changed.\n   */\n  async removeItemDictionaryFlag(flagName, context = {}) {\n    const flags = getProperty(this, \"system.flags.dictionary\") ?? {};\n\n    if (flags[flagName] !== undefined) {\n      await this.update({ [`data.flags.dictionary.-=${flagName}`]: null }, context);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * @param {string} flagName - The name/key of the flag to get.\n   * @returns {object} The value stored in the flag.\n   */\n  getItemDictionaryFlag(flagName) {\n    const flags = getProperty(this, \"system.flags.dictionary\") || {};\n    return flags[flagName];\n  }\n\n  /**\n   * Get all item dictionary flags as array of objects.\n   *\n   * @returns {object[]}\n   */\n  getItemDictionaryFlags() {\n    const flags = getProperty(this, \"system.flags.dictionary\") || {};\n    return flags;\n  }\n\n  /**\n   * Get attack array for specific action.\n   *\n   * @param {string} actionId Action identifier.\n   * @returns {number[]} Simple array describing the individual guaranteed attacks.\n   */\n  getAttackArray(actionId) {\n    const action = this.actions.get(actionId),\n      actionData = action?.data,\n      rollData = action?.getRollData(),\n      attacks = [0];\n    if (!actionData) return attacks;\n\n    const appendAttack = (formula) => {\n      const bonus = RollFFD20.safeRoll(formula, rollData).total;\n      if (Number.isFinite(bonus)) attacks.push(bonus);\n    };\n\n    // Static extra attacks\n    const extraAttacks = actionData.attackParts.map((n) => n[0]?.toString().trim()).filter((n) => n?.length > 0);\n    for (const formula of extraAttacks) appendAttack(formula);\n\n    // Formula-based extra attacks\n    const fmAtk = actionData.formulaicAttacks?.count?.formula?.trim();\n    if (fmAtk?.length > 0) {\n      const fmAtkBonus = actionData.formulaicAttacks?.bonus?.formula?.trim() || \"0\";\n      const count = RollFFD20.safeRoll(fmAtk, rollData);\n      for (let i = 0; i < count.total; i++) {\n        rollData.formulaicAttack = i + 1;\n        appendAttack(fmAtkBonus);\n      }\n      delete rollData.formulaicAttack;\n    }\n\n    // Conditional modifiers\n    const condBonuses = new Array(attacks.length).fill(0);\n    actionData.conditionals\n      .filter((c) => c.default && c.modifiers.find((sc) => sc.target === \"attack\"))\n      .forEach((c) => {\n        c.modifiers.forEach((cc) => {\n          const bonusRoll = RollFFD20.safeRoll(cc.formula, rollData);\n          if (bonusRoll.total == 0) return;\n          if (cc.subTarget?.match(/^attack\\.(\\d+)$/)) {\n            const atk = parseInt(RegExp.$1, 10);\n            if (atk in condBonuses) condBonuses[atk] += bonusRoll.total;\n          }\n        });\n      });\n\n    const sources = this.getAttackSources(actionId);\n    const totalBonus = sources.reduce((f, s) => f + s.value, 0);\n\n    return attacks.map((a, i) => a + totalBonus + condBonuses[i]);\n  }\n\n  /**\n   * Get default action's attack array.\n   *\n   * @returns {number[]} Simple array describing the individual guaranteed attacks.\n   */\n  get attackArray() {\n    return this.getAttackArray(this.firstAction.id);\n  }\n\n  /**\n   * Attack sources for a specific action.\n   *\n   * @param actionId\n   * @returns {object[]} Array of value and label pairs for attack bonus sources on the main attack.\n   */\n  getAttackSources(actionId) {\n    const action = this.actions.get(actionId);\n    if (!action) return;\n\n    const sources = [];\n\n    const actorData = this.parentActor?.system,\n      itemData = this.system,\n      actionData = action.data;\n\n    if (!actorData || !actionData) return sources;\n    const rollData = action.getRollData();\n\n    // Attack type identification\n    const isMelee =\n      [\"mwak\", \"msak\", \"mcman\"].includes(actionData.actionType) || [\"melee\", \"reach\"].includes(actionData.range.units);\n    const isRanged =\n      [\"rwak\", \"rsak\", \"rcman\"].includes(actionData.actionType) || this.system.weaponSubtype === \"ranged\";\n    const isManeuver = [\"mcman\", \"rcman\"].includes(actionData.actionType);\n\n    const describePart = (value, label, sort = 0) => {\n      sources.push({ value, label, sort });\n    };\n\n    // BAB is last for some reason, array is reversed to try make it the first.\n    const srcDetails = (s) => s?.reverse().forEach((d) => describePart(d.value, d.name, -10));\n\n    // Unreliable melee/ranged identification\n    const sizeBonus = !isManeuver\n      ? CONFIG.FFD20.sizeMods[rollData.traits.size]\n      : CONFIG.FFD20.sizeSpecialMods[rollData.traits.size];\n\n    // Add size bonus\n    if (sizeBonus != 0) describePart(sizeBonus, game.i18n.localize(\"FFD20.Size\"), -20);\n\n    srcDetails(this.parentActor.sourceDetails[\"system.attributes.attack.shared\"]);\n    if (isManeuver) srcDetails(this.parentActor.sourceDetails[\"system.attributes.cmb.bonus\"]);\n    srcDetails(this.parentActor.sourceDetails[\"system.attributes.attack.general\"]);\n\n    const changeSources = [];\n    if (isRanged) changeSources.push(\"rattack\");\n    if (isMelee) changeSources.push(\"mattack\");\n    const effectiveChanges = getHighestChanges(\n      this.parentActor.changes.filter((c) => changeSources.includes(c.subTarget)),\n      { ignoreTarget: true }\n    );\n    effectiveChanges.forEach((ic) => describePart(ic.value, ic.flavor, -800));\n\n    if (actionData.ability.attack) {\n      const ablMod = getProperty(actorData, `abilities.${actionData.ability.attack}.mod`) ?? 0;\n      describePart(ablMod, CONFIG.FFD20.abilities[actionData.ability.attack], -50);\n    }\n\n    // Attack bonus formula\n    const bonusRoll = RollFFD20.safeRoll(actionData.attackBonus || \"0\", rollData);\n    if (bonusRoll.total != 0)\n      describePart(bonusRoll.total, bonusRoll.flavor ?? game.i18n.localize(\"FFD20.AttackRollBonus\"), -100);\n\n    // Masterwork or enhancement bonus\n    // Only add them if there's no larger enhancement bonus from some other source\n    const virtualEnh = action.enhancementBonus ?? (itemData.masterwork ? 1 : 0);\n    if (!effectiveChanges.find((i) => i.modifier === \"enh\" && i.value > virtualEnh)) {\n      if (Number.isFinite(action.enhancementBonus) && action.enhancementBonus !== 0) {\n        describePart(action.enhancementBonus, game.i18n.localize(\"FFD20.EnhancementBonus\"), -300);\n      } else if (itemData.masterwork) {\n        describePart(1, game.i18n.localize(\"FFD20.Masterwork\"), -300);\n      }\n    }\n\n    // Add proficiency penalty\n    if (!itemData.proficient) {\n      describePart(-4, game.i18n.localize(\"FFD20.ProficiencyPenalty\"), -500);\n    }\n\n    // Broken condition\n    if (itemData.broken) {\n      describePart(-2, game.i18n.localize(\"FFD20.Broken\"), -500);\n    }\n\n    // Add secondary natural attack penalty\n    if (actionData.naturalAttack.primaryAttack !== true && itemData.attackType === \"natural\") {\n      const attackBonus = actionData.naturalAttack?.secondary?.attackBonus || \"-5\";\n      const secondaryModifier = RollFFD20.safeTotal(`${attackBonus}`, rollData);\n      describePart(secondaryModifier, game.i18n.localize(\"FFD20.SecondaryAttack\"), -400);\n    }\n\n    // Conditional modifiers\n    actionData.conditionals\n      .filter((c) => c.default && c.modifiers.find((sc) => sc.target === \"attack\"))\n      .forEach((c) => {\n        c.modifiers.forEach((cc) => {\n          if (cc.subTarget === \"allAttack\") {\n            const bonusRoll = RollFFD20.safeRoll(cc.formula, rollData);\n            if (bonusRoll.total == 0) return;\n            describePart(bonusRoll.total, c.name, -5000);\n          }\n        });\n      });\n\n    return sources.sort((a, b) => b.sort - a.sort);\n  }\n\n  /**\n   * Return attack sources for default action.\n   *\n   * @returns {object[]} Array of value and label pairs for attack bonus sources on the main attack.\n   */\n  get attackSources() {\n    return this.getAttackSources(this.firstAction.id);\n  }\n\n  /**\n   * Generic damage source retrieval\n   *\n   * @deprecated\n   */\n  get damageSources() {\n    foundry.utils.logCompatibilityWarning(\"ItemFFD20.damageSources is deprecated, use ItemAction.damageSources instead\", {\n      since: \"FFD20 0.82.2\",\n      until: \"FFD20 0.83.0\",\n    });\n    return this.firstAction?.damageSources ?? [];\n  }\n\n  getAllDamageSources(actionId) {\n    const action = this.actions.get(actionId);\n    if (!action) return;\n\n    const conds = action.data.conditionals\n      .filter((c) => c.default)\n      .filter((c) => c.modifiers.find((m) => m.target === \"damage\"));\n    const rollData = action.getRollData();\n\n    if (!rollData) return [];\n\n    const mods = Object.keys(CONFIG.FFD20.bonusModifiers);\n\n    // Turn relevant conditionals into structure accepted by getHighestChanges\n    const fakeCondChanges = [];\n    for (const c of conds) {\n      for (const m of c.modifiers) {\n        if (m.target !== \"damage\") continue;\n        const roll = RollFFD20.safeRoll(m.formula, rollData);\n        if (roll.err) continue;\n        const isModifier = mods.includes(m.type);\n        fakeCondChanges.push({\n          flavor: c.name,\n          value: roll.total,\n          modifier: isModifier ? m.type : \"untyped\", // Turn unrecognized types to untyped\n          type: isModifier ? undefined : m.type, // Preserve damage type if present\n          formula: m.formula,\n        });\n      }\n    }\n\n    const allChanges = [...action.damageSources, ...fakeCondChanges];\n\n    // Add enhancement bonus\n    if (action.enhancementBonus) {\n      allChanges.push({\n        flavor: game.i18n.localize(\"FFD20.EnhancementBonus\"),\n        value: action.enhancementBonus,\n        modifier: \"enh\",\n        formula: action.enhancementBonus.toString(),\n      });\n    }\n\n    // Add special cases specific to the item\n    // Broken\n    if (this.system.broken) {\n      allChanges.push({\n        flavor: game.i18n.localize(\"FFD20.Broken\"),\n        value: -2,\n        modifier: \"untyped\",\n        formula: \"-2\",\n      });\n    }\n\n    return getHighestChanges(allChanges, { ignoreTarget: true });\n  }\n\n  /**\n   * Generic damage source retrieval, includes default conditionals and other item specific modifiers.\n   */\n  get allDamageSources() {\n    return this.getAllDamageSources(this.firstAction.id);\n  }\n\n  /**\n   * @param {boolean} active\n   * @param {object} context Optional update context\n   * @returns Update promise if item type supports the operation.\n   */\n  setActive(active, context) {\n    throw new Error(`Item type ${this.type} does not support ItemFFD20#setActive`);\n  }\n}\n\n/**\n * @typedef {object} ItemWeightData\n * An item's `weight` data. The only property to be stored is `value`, from which all other values are derived.\n * @see {@link ItemFFD20.prepareWeight} for generation\n * @remarks A weight property is considered \"effective\" if it is the value that is added to its parent's weight.\n *          An item with a weight of 10 lbs in a container with 50% weight reduction would increase\n *          the container's effective `weight.total` by 5 lbs, but increases the container's `weight.contents` weight by 10 lbs.\n * @property {number} value - The weight of a single item instance, in lbs\n * @property {number} total - The effective total weight of the item (including quantity and contents), in lbs\n * @property {number} [currency] - Effective weight of contained currency for containers, in lbs\n * @property {number} [contents] - Weight of contained items and currency, in lbs\n * @property {object} converted - Weight of this item, converted to the current unit system\n * @property {number} converted.value - The weight of a single item instance, in world units\n * @property {number} converted.total - The effective total weight of the item (including quantity and contents), in world units\n * @property {number} [converted.contents] - Weight of contained items and currency, in world units\n */\n\n/**\n * @typedef {object} ChatData\n * Data required to render an item's summary or chat card, including descriptions and properties/tags/labels\n * @property {string} description - The item's enriched description as appropriate for the current user\n * @property {string} identifiedDescription - The item's full enriched description when identified\n * @property {string} unidentifiedDescription - The item's enriched description when unidentified\n * @property {string} [actionDescription] - The enriched description of a specific action\n * @property {string[]} properties - Additional properties/labels for the item and the action\n */\n\n/**\n * @typedef {object} SharedActionData\n * A common data object used to store and share data between stages of an action's usage.\n * @property {Event | null} event - The event that triggered the action. Defaults to `null`.\n * @property {object} rollData - The singular rollData object used for all rolls in the action\n * @property {boolean} skipDialog - Whether the user-facing dialog should get skipped. Defaults to `false`.\n * @property {boolean} chatMessage - Whether a chat message should be created at the end of the action's usage. Defaults to `true`.\n * @property {string} dice - The base dice used for the action's attack rolls. Defaults to `\"1d20\"`.\n * @property {boolean} fullAttack - Whether the action is a full attack. Defaults to `true`.\n * @property {string[]} attackBonus - Bonus values to be added to the attack roll formula\n * @property {string[]} damageBonus - Bonus values to be added to the damage roll formula\n * @property {object[]} attacks - Array of attacks\n * @property {import(\"@actionUse/chat-attack.mjs\").ChatAttack[]} chatAttacks - Array of chat attacks for this action's use\n * @property {string} rollMode - The roll mode to be used for the creation of the chat message. Defaults to the `core.rollMode` setting.\n * @property {boolean} useMeasureTemplate - Whether to use a measure template\n * @property {object[] | null} conditionals\n * @property {object} conditionalPartsCommon\n * @property {boolean} casterLevelCheck\n * @property {boolean} concentrationCheck\n * @property {object} scriptData\n * @property {ItemAction} action - The {@link ItemAction} this use is based on\n * @property {ItemFFD20} item - The {@link ItemFFD20} this use is based on\n * @property {object} chatData - Data to be passed to {@link ChatMessage.create}, excluding `content` rendered using {@link templateData} and {@link template}.\n * @property {string} [chatTemplate] - The template to be used for the creation of the chat message.\n * @property {object} templateData - Data used to render the chat card, passed to {@link foundry.utils.renderTemplate}.\n */\n","/**\n * @typedef {object} Widget_CategorizedItemPicker~Item\n * @property {string} key - The key of the item.\n * @property {string} [label] - The label of the item.\n * @property {string} [icon] - The icon of the item.\n */\n\n/**\n * @typedef {object} Widget_CategorizedItemPicker~Category\n * @property {string} key - The key of the category.\n * @property {string} label - The label of the category.\n * @property {Widget_CategorizedItemPicker~Item[]} items - All the items associated with this category.\n */\n\n/**\n * Item picker widget.\n */\nexport class Widget_CategorizedItemPicker extends Application {\n  constructor(options, categories, callback, selected) {\n    super(options);\n\n    /**\n     * Objects containing category and item data.\n     *\n     * @type {Widget_CategorizedItemPicker~Category[]}\n     */\n    this.categories = categories;\n\n    /**\n     * Previously selected category and item\n     *\n     * @type {object}\n     * @property {string} category Selected category.\n     * @property {string} item Selected item in that category.\n     */\n    this.selected = selected;\n\n    /**\n     * Callback fired when an item has been selected.\n     *\n     * @type {Function}\n     */\n    this.callback = callback;\n\n    /**\n     * Track hidden elements of the sheet.\n     *\n     * @property\n     * @type {Object<string, string>}\n     */\n    this._hiddenElems = {};\n  }\n\n  get template() {\n    return \"systems/ffd20/templates/widgets/categorized-item-picker.hbs\";\n  }\n\n  getData(options) {\n    const data = super.getData(options);\n\n    data.categories = [];\n    data.items = [];\n\n    for (const cat of this.categories) {\n      data.categories.push({\n        key: cat.key,\n        label: cat.label,\n      });\n\n      for (const item of cat.items) {\n        data.items.push(\n          mergeObject(\n            {\n              category: cat.key,\n            },\n            item\n          )\n        );\n      }\n    }\n\n    return data;\n  }\n\n  activateListeners(html) {\n    // Click an item\n    html.find(\".item\").click(this._onClickItem.bind(this));\n\n    // Expand/minimize category\n    html.find(\".category a\").click(this._onClickCategory.bind(this));\n\n    // Pre-select old category\n    if (this.selected?.category) {\n      html.find(`.category a[data-category=\"${this.selected.category}\"]`).click();\n      if (this.selected?.item) {\n        html\n          .find(`.item[data-category=\"${this.selected.category}\"][data-value=\"${this.selected.item}\"]`)\n          .first()\n          .addClass(\"pre-select\");\n      }\n    }\n\n    // Cancel widget\n    window.setTimeout(() => {\n      if (this._cancelCallback) document.removeEventListener(\"click\", this._cancelCallback);\n      this._cancelCallback = this._onCancel.bind(this);\n      document.addEventListener(\"click\", this._cancelCallback);\n    }, 10);\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      width: 480,\n      height: 480,\n    });\n  }\n\n  _onClickItem(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    const result = a.dataset.value;\n    this.callback(result);\n    this.close();\n  }\n\n  _onClickCategory(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const html = $(this.element);\n\n    // Deactivate all categories\n    html.find(\".item-picker-categories\").children().removeClass(\"active\");\n\n    // Activate clicked category\n    $(a).closest(\".category\").addClass(\"active\");\n\n    // Hide all items\n    html.find(\".item-picker-items\").children().hide();\n\n    // Show items\n    html.find(`.item-picker-items .item[data-category=\"${a.dataset.category}\"]`).show();\n  }\n\n  _onCancel(event) {\n    event.preventDefault();\n\n    // Don't cancel if this widget was clicked\n    let node = event.target;\n    if (node === this.element[0]) return;\n    while (node.parentNode) {\n      if (node === this.element[0]) return;\n      node = node.parentNode;\n    }\n\n    this.close();\n  }\n\n  async close(...args) {\n    document.removeEventListener(\"click\", this._cancelCallback);\n    return super.close(...args);\n  }\n}\n\nHooks.on(\"renderWidget_CategorizedItemPicker\", (app, html, data) => {\n  html.find(\".pre-select\")[0]?.scrollIntoView({ block: \"nearest\" });\n});\n","import { adjustNumberByStringCommand, getBuffTargetDictionary, getBuffTargets } from \"@utils\";\nimport { ItemFFD20 } from \"@item/item-ffd20.mjs\";\nimport { ScriptEditor } from \"../script-editor.mjs\";\nimport { ActorTraitSelector } from \"../trait-selector.mjs\";\nimport { Widget_CategorizedItemPicker } from \"../categorized-item-picker.mjs\";\nimport { getSkipActionPrompt } from \"../../documents/settings.mjs\";\nimport { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n/**\n * Override and extend the core ItemSheet implementation to handle game system specific item types\n *\n * @type {ItemSheet}\n */\nexport class ItemSheetFFD20 extends ItemSheet {\n  constructor(...args) {\n    super(...args);\n\n    this.items = [];\n\n    /**\n     * Tracks the application IDs associated with this sheet.\n     *\n     * @type {Application[]}\n     */\n    this._openApplications = [];\n\n    /**\n     * Track action updates from the item sheet.\n     *\n     * @property\n     * @private\n     * @type {object[]}\n     */\n    this._actionUpdates = [];\n  }\n\n  /* -------------------------------------------- */\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      width: 580,\n      classes: [\"ffd20\", \"sheet\", \"item\"],\n      scrollY: [\".tab\", \".buff-flags\", \".editor-content\"],\n      dragDrop: [\n        {\n          dragSelector: \"li.action-part\",\n          dropSelector: \".tab.details\",\n        },\n      ],\n      tabs: [\n        {\n          navSelector: \"nav.tabs[data-group='primary']\",\n          contentSelector: \"section.primary-body\",\n          initial: \"description\",\n        },\n        { navSelector: \"nav.tabs[data-group='links']\", contentSelector: \"section.links-body\", initial: \"children\" },\n        {\n          navSelector: \"nav.tabs[data-group='description']\",\n          contentSelector: \"section.description-body\",\n          initial: \"identified\",\n        },\n      ],\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Return a dynamic reference to the HTML template path used to render this Item Sheet\n   *\n   * @returns {string}\n   */\n  get template() {\n    const path = \"systems/ffd20/templates/items\";\n    return `${path}/${this.item.type}.hbs`;\n  }\n\n  get actor() {\n    let actor = this.item.actor;\n    let p = this.parentItem;\n    while (!actor && p) {\n      actor = p.actor;\n      p = p.parentItem;\n    }\n\n    return actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare item sheet data\n   * Start with the base item data and extending with additional properties for rendering.\n   */\n  async getData() {\n    const data = await super.getData();\n    data.system = data.item.system;\n    data.flags = { flags: data.flags };\n    const rollData = this.item.getRollData();\n    data.labels = this.item.labels;\n\n    // Include sub-items\n    data.items = [];\n    if (this.item.items != null) {\n      data.items = this.item.items.map((i) => {\n        return i.toObject();\n      });\n    }\n\n    // Include CONFIG values\n    data.config = CONFIG.FFD20;\n\n    // Item Type, Status, and Details\n    data.itemType = this._getItemType(data.item);\n    data.itemStatus = this._getItemStatus(data.item);\n    data.itemProperties = this._getItemProperties();\n    data.itemName = data.item.name;\n    data.isCharged = [\"day\", \"week\", \"charges\"].includes(data.item.system.uses?.per);\n    data.isPhysical = data.item.system.quantity !== undefined;\n    data.isNaturalAttack = data.item.system.attackType === \"natural\";\n    data.isSpell = this.item.type === \"spell\";\n    data.owned = this.item.actor != null;\n    data.parentOwned = this.actor != null;\n    data.owner = this.item.isOwner;\n    data.isGM = game.user.isGM;\n    data.hasAction = this.item.hasAction;\n    data.showIdentifyDescription = data.isGM && data.isPhysical;\n    data.isMateria = data.item.data.data.equipmentType === \"materia\";\n    data.showUnidentifiedData = this.item.showUnidentifiedData;\n    data.unchainedActionEconomy = game.settings.get(\"ffd20\", \"unchainedActionEconomy\");\n    if (rollData.item.auraStrength != null) {\n      const auraStrength = rollData.item.auraStrength;\n      data.auraStrength = auraStrength;\n\n      if (CONFIG.FFD20.auraStrengths[auraStrength] != null) {\n        data.auraStrength_name = CONFIG.FFD20.auraStrengths[auraStrength];\n\n        data.labels.identify = game.i18n.localize(\"FFD20.IdentifyDCNumber\").format(15 + rollData.item.cl);\n      }\n    }\n\n    // Add descriptions\n    data.descriptionHTML = {\n      identified: await TextEditor.enrichHTML(data.system.description.value, {\n        secrets: data.owned,\n        rollData: rollData,\n        async: true,\n      }),\n      unidentified: await TextEditor.enrichHTML(data.system.description.unidentified, {\n        secrets: data.owned,\n        rollData: rollData,\n        async: true,\n      }),\n    };\n\n    // Unidentified data\n    if (this.item.showUnidentifiedData) {\n      data.itemName = this.item.system.unidentified.name || this.item.system.identifiedName || this.item.name;\n    } else {\n      data.itemName = this.item.system.identifiedName || this.item.name;\n    }\n\n    // Override description attributes\n    if (data.isPhysical) {\n      /** @type {DescriptionAttribute[]} */\n      data.descriptionAttributes = [];\n\n      // Add quantity\n      data.descriptionAttributes.push({\n        isNumber: true,\n        name: \"system.quantity\",\n        label: game.i18n.localize(\"FFD20.Quantity\"),\n        value: data.item.system.quantity,\n        decimals: 0,\n        id: \"data-quantity\",\n      });\n\n      // Add weight\n      data.descriptionAttributes.push({\n        isNumber: true,\n        name: \"system.weight.value\",\n        fakeName: true,\n        label: game.i18n.localize(\"FFD20.Weight\"),\n        value: data.item.system.weight.converted.total,\n        inputValue: data.item.system.weight.converted.value,\n        decimals: 2,\n        id: \"data-weight-value\",\n      });\n\n      // Add price\n      if (data.showIdentifyDescription) {\n        data.descriptionAttributes.push(\n          {\n            isNumber: true,\n            name: \"system.price\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.Price\"),\n            value: this.item.getValue({ sellValue: 1 }),\n            decimals: 2,\n            id: \"data-price\",\n          },\n          {\n            isNumber: true,\n            name: \"system.unidentified.price\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.UnidentifiedPriceShort\"),\n            value: this.item.getValue({ sellValue: 1, forceUnidentified: true }),\n            decimals: 2,\n            id: \"data-unidentifiedBasePrice\",\n          }\n        );\n      } else {\n        if (data.showUnidentifiedData) {\n          data.descriptionAttributes.push({\n            isNumber: true,\n            name: \"system.unidentified.price\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.Price\"),\n            value: this.item.getValue({ sellValue: 1 }),\n            decimals: 2,\n            id: \"data-price\",\n          });\n        } else {\n          data.descriptionAttributes.push({\n            isNumber: true,\n            name: \"system.price\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.Price\"),\n            value: this.item.getValue({ sellValue: 1 }),\n            decimals: 2,\n            id: \"data-price\",\n          });\n        }\n      }\n\n      // Add hit points\n      data.descriptionAttributes.push({\n        isRange: true,\n        label: game.i18n.localize(\"FFD20.HPShort\"),\n        value: {\n          name: \"system.hp.value\",\n          value: data.item.system.hp.value,\n        },\n        max: {\n          name: \"system.hp.max\",\n          value: data.item.system.hp.max,\n        },\n      });\n\n      // Add hardness\n      data.descriptionAttributes.push({\n        isNumber: true,\n        label: game.i18n.localize(\"FFD20.Hardness\"),\n        name: \"system.hardness\",\n        decimals: 0,\n        value: data.item.system.hardness,\n      });\n\n      // Add carried flag\n      data.descriptionAttributes.push({\n        isBoolean: true,\n        name: \"system.carried\",\n        label: game.i18n.localize(\"FFD20.Carried\"),\n        value: data.item.system.carried,\n      });\n    }\n\n    // Prepare feat specific stuff\n    if (data.item.type === \"feat\") {\n      data.isClassFeature = getProperty(this.item, \"system.featType\") === \"classFeat\";\n      data.isTemplate = getProperty(this.item, \"system.featType\") === \"template\";\n    }\n\n    if ([\"class\", \"feat\", \"race\"].includes(data.item.type)) {\n      // Add skill list\n      if (!this.actor) {\n        data.skills = Object.entries(CONFIG.FFD20.skills).reduce((cur, o) => {\n          cur[o[0]] = { name: o[1], classSkill: getProperty(this.item, `system.classSkills.${o[0]}`) === true };\n          return cur;\n        }, {});\n      } else {\n        // Get sorted skill list from config, custom skills get appended to bottom of list\n        const skills = mergeObject(deepClone(CONFIG.FFD20.skills), this.actor.system.skills);\n        data.skills = Object.entries(skills).reduce((cur, o) => {\n          const key = o[0];\n          const name = CONFIG.FFD20.skills[key] != null ? CONFIG.FFD20.skills[key] : o[1].name;\n          cur[o[0]] = { name: name, classSkill: getProperty(this.item, `system.classSkills.${o[0]}`) === true };\n          return cur;\n        }, {});\n      }\n    }\n\n    // Prepare weapon specific stuff\n    if (data.item.type === \"weapon\") {\n      data.isRanged = data.item.system.weaponSubtype === \"ranged\" || data.item.system.properties[\"thr\"] === true;\n\n      // Prepare categories for weapons\n      data.weaponCategories = { types: {}, subTypes: {} };\n      for (const [k, v] of Object.entries(CONFIG.FFD20.weaponTypes)) {\n        if (typeof v === \"object\") data.weaponCategories.types[k] = v._label;\n      }\n      const type = data.item.system.weaponType;\n      if (hasProperty(CONFIG.FFD20.weaponTypes, type)) {\n        for (const [k, v] of Object.entries(CONFIG.FFD20.weaponTypes[type])) {\n          // Add static targets\n          if (!k.startsWith(\"_\")) data.weaponCategories.subTypes[k] = v;\n        }\n      }\n    }\n\n    // Prepare equipment specific stuff\n    if (data.item.type === \"equipment\") {\n      // Prepare categories for equipment\n      data.equipmentCategories = { types: {}, subTypes: {} };\n      for (const [k, v] of Object.entries(CONFIG.FFD20.equipmentTypes)) {\n        if (typeof v === \"object\") data.equipmentCategories.types[k] = v._label;\n      }\n      const type = data.item.system.equipmentType;\n      if (hasProperty(CONFIG.FFD20.equipmentTypes, type)) {\n        for (const [k, v] of Object.entries(CONFIG.FFD20.equipmentTypes[type])) {\n          // Add static targets\n          if (!k.startsWith(\"_\")) data.equipmentCategories.subTypes[k] = v;\n        }\n      }\n\n      // Prepare slots for equipment\n      data.equipmentSlots = CONFIG.FFD20.equipmentSlots[type];\n\n      // Whether the equipment should show armor data\n      data.showArmorData = [\"armor\", \"shield\"].includes(type);\n\n      // Whether the current equipment type has multiple slots\n      data.hasMultipleSlots = Object.keys(data.equipmentSlots).length > 1;\n    }\n\n    // Prepare spell specific stuff\n    if (data.item.type === \"spell\") {\n      let spellbook = null;\n      if (this.actor != null) {\n        spellbook = getProperty(this.actor, `system.attributes.spells.spellbooks.${this.item.system.spellbook}`);\n      }\n\n      data.isPreparedSpell = spellbook != null ? !spellbook.spontaneous && !spellbook.spellPoints?.useSystem : false;\n      data.usesSpellpoints = spellbook != null ? spellbook.spellPoints?.useSystem ?? false : false;\n      data.isAtWill = data.item.system.atWill;\n      data.spellbooks = deepClone(this.actor?.system.attributes?.spells?.spellbooks ?? {});\n\n      const desc = await renderTemplate(\n        \"systems/ffd20/templates/internal/spell-description.hbs\",\n        this.document.spellDescriptionData\n      );\n      const firstAction = this.item.firstAction;\n      data.topDescription = await TextEditor.enrichHTML(desc, {\n        rollData: firstAction?.getRollData() ?? rollData,\n        async: true,\n      });\n\n      // Enrich description\n      if (data.system.shortDescription != null) {\n        data.shortDescription = await TextEditor.enrichHTML(data.system.shortDescription, {\n          rollData: firstAction?.getRollData() ?? rollData,\n          secrets: data.owner,\n          async: true,\n        });\n      }\n    }\n\n    // Prepare class specific stuff\n    if (data.item.type === \"class\") {\n      data.isMythicPath = data.system.classType === \"mythic\";\n\n      for (const [a, s] of Object.entries(data.system.savingThrows)) {\n        s.label = CONFIG.FFD20.savingThrows[a];\n      }\n      for (const [a, s] of Object.entries(data.system.fc)) {\n        s.label = CONFIG.FFD20.favouredClassBonuses[a];\n      }\n\n      data.isBaseClass = data.system.classType === \"base\";\n      data.isRacialHD = data.system.classType === \"racial\";\n\n      if (this.actor != null) {\n        const healthConfig = game.settings.get(\"ffd20\", \"healthConfig\");\n        data.healthConfig = data.isRacialHD\n          ? healthConfig.hitdice.Racial\n          : this.actor.type === \"character\"\n          ? healthConfig.hitdice.PC\n          : healthConfig.hitdice.NPC;\n      } else data.healthConfig = { auto: false };\n\n      // Add skill list\n      if (!this.actor) {\n        data.skills = Object.entries(CONFIG.FFD20.skills).reduce((cur, o) => {\n          cur[o[0]] = { name: o[1], classSkill: getProperty(data, `system.classSkills.${o[0]}`) === true };\n          return cur;\n        }, {});\n      } else {\n        // Get sorted skill list from config, custom skills get appended to bottom of list\n        const skills = mergeObject(deepClone(CONFIG.FFD20.skills), this.actor.system.skills);\n        data.skills = Object.entries(skills).reduce((cur, o) => {\n          const key = o[0];\n          const name = CONFIG.FFD20.skills[key] != null ? CONFIG.FFD20.skills[key] : o[1].name;\n          cur[o[0]] = { name: name, classSkill: getProperty(data, `system.classSkills.${o[0]}`) === true };\n          return cur;\n        }, {});\n      }\n    }\n\n    // Prepare proficiencies & languages\n    const profs = {\n      armorProf: CONFIG.FFD20.armorProficiencies,\n      weaponProf: CONFIG.FFD20.weaponProficiencies,\n      languages: CONFIG.FFD20.languages,\n    };\n    for (const [t, choices] of Object.entries(profs)) {\n      if (hasProperty(data.item.system, t)) {\n        const trait = data[t];\n        if (!trait) continue;\n        let values = [];\n        if (trait.value) {\n          values = trait.value instanceof Array ? trait.value : [trait.value];\n        }\n        trait.selected = values.reduce((obj, t) => {\n          obj[t] = choices[t];\n          return obj;\n        }, {});\n\n        // Add custom entry\n        if (trait.custom) {\n          trait.custom\n            .split(CONFIG.FFD20.re.traitSeparator)\n            .forEach((c, i) => (trait.selected[`custom${i + 1}`] = c.trim()));\n        }\n        trait.cssClass = !isObjectEmpty(trait.selected) ? \"\" : \"inactive\";\n      }\n    }\n\n    // Prepare stuff for active effects on items\n    if (this.item.changes) {\n      data.changeGlobals = {\n        targets: {},\n        modifiers: CONFIG.FFD20.bonusModifiers,\n      };\n      for (const [k, v] of Object.entries(CONFIG.FFD20.buffTargets)) {\n        if (typeof v === \"object\") data.changeGlobals.targets[k] = v._label;\n      }\n\n      const buffTargets = getBuffTargets(this.item.actor);\n      data.changes = data.item.system.changes.reduce((cur, o) => {\n        const obj = { data: o };\n\n        obj.subTargetLabel = buffTargets[o.subTarget]?.label;\n        obj.isScript = obj.data.operator === \"script\";\n\n        cur.push(obj);\n        return cur;\n      }, []);\n    }\n\n    // Prepare stuff for items with context notes\n    if (data.item.system.contextNotes) {\n      data.contextNotes = deepClone(data.item.system.contextNotes);\n      const noteTargets = getBuffTargets(this.item.actor, \"contextNotes\");\n      data.contextNotes.forEach((o) => {\n        o.label = noteTargets[o.subTarget]?.label;\n      });\n    }\n\n    // Add distance units\n    data.distanceUnits = deepClone(CONFIG.FFD20.distanceUnits);\n    if (this.item.type !== \"spell\") {\n      for (const d of [\"close\", \"medium\", \"long\"]) {\n        delete data.distanceUnits[d];\n      }\n    }\n\n    // Parse notes\n    if (data.item.system.attackNotes) {\n      const value = data.item.system.attackNotes;\n      setProperty(data, \"notes.attack\", value);\n    }\n\n    // Add item flags\n    this._prepareItemFlags(data);\n\n    // Add script calls\n    await this._prepareScriptCalls(data);\n\n    // Add links\n    await this._prepareLinks(data);\n\n    // Add actions\n    this._prepareActions(data);\n\n    return data;\n  }\n\n  async _prepareLinks(data) {\n    data.links = {\n      list: [],\n    };\n\n    // Add children link type\n    data.links.list.push({\n      id: \"children\",\n      label: game.i18n.localize(\"FFD20.LinkTypeChildren\"),\n      help: game.i18n.localize(\"FFD20.LinkHelpChildren\"),\n      items: [],\n    });\n\n    // Add charges link type\n    if ([\"feat\", \"consumable\", \"attack\", \"equipment\"].includes(this.item.type)) {\n      data.links.list.push({\n        id: \"charges\",\n        label: game.i18n.localize(\"FFD20.LinkTypeCharges\"),\n        help: game.i18n.localize(\"FFD20.LinkHelpCharges\"),\n        items: [],\n      });\n    }\n\n    // Add class associations\n    if (this.item.type === \"class\") {\n      data.links.list.push({\n        id: \"classAssociations\",\n        label: game.i18n.localize(\"FFD20.LinkTypeClassAssociations\"),\n        help: game.i18n.localize(\"FFD20.LinkHelpClassAssociations\"),\n        fields: {\n          level: {\n            type: \"Number\",\n            label: game.i18n.localize(\"FFD20.Level\"),\n          },\n        },\n        items: [],\n      });\n    }\n\n    // Post process data\n    for (const l of data.links.list) {\n      const items = getProperty(this.item, `system.links.${l.id}`) || [];\n      for (let a = 0; a < items.length; a++) {\n        const i = items[a];\n        i._index = a;\n\n        // Add item to stack\n        l.items.push(i);\n      }\n\n      // Sort items\n      if (l.id === \"classAssociations\") {\n        l.items = l.items.sort((a, b) => {\n          return a.level - b.level;\n        });\n      }\n    }\n\n    await this.item.updateLinkItems();\n  }\n\n  _prepareActions(data) {\n    if (!data.system.actions) return [];\n    const result = [];\n\n    for (const d of data.system.actions) {\n      const doc = this.object.actions.get(d._id);\n      const obj = {\n        data: d,\n        isSelfCharged: doc.isSelfCharged,\n      };\n\n      result.push(obj);\n    }\n\n    data.actions = result;\n  }\n\n  _prepareItemFlags(data) {\n    setProperty(data, \"flags.boolean\", getProperty(data.item, \"system.flags.boolean\") ?? {});\n    setProperty(data, \"flags.dictionary\", getProperty(data.item, \"system.flags.dictionary\") ?? {});\n  }\n\n  async _prepareScriptCalls(data) {\n    const categories = ffd20.registry.scriptCalls.filter((o) => {\n      if (!o.data.itemTypes.includes(this.document.type)) return false;\n      return !(o.hidden === true && !game.user.isGM);\n    });\n    // Don't show the Script Calls section if there are no categories for this item type\n    if (!categories.length) {\n      data.scriptCalls = null;\n      return;\n    }\n    // Don't show the Script Calls section if players are not allowed to edit script macros\n    if (!game.user.can(\"MACRO_SCRIPT\")) {\n      data.scriptCalls = null;\n      return;\n    }\n\n    data.scriptCalls = {};\n\n    // Prepare data to add\n    const checkYes = '<i class=\"fas fa-check\"></i>';\n    const checkNo = '<i class=\"fas fa-times\"></i>';\n\n    // Iterate over all script calls, and adjust data\n    const scriptCalls = Object.hasOwnProperty.call(this.document, \"scriptCalls\")\n      ? deepClone(Array.from(this.document.scriptCalls).map((o) => o.data))\n      : [];\n    {\n      const promises = [];\n      for (const o of scriptCalls) {\n        promises.push(\n          (async () => {\n            // Obtain macro info\n            if (o.type === \"macro\") {\n              const m = await fromUuid(o.value);\n              if (m == null) {\n                o.name = `${game.i18n.localize(\"FFD20.Unknown\")} (${game.i18n.localize(\"DOCUMENT.Macro\")})`;\n                o.img = \"icons/svg/hazard.svg\";\n              } else {\n                o.name = m.data.name;\n                o.img = m.data.img;\n              }\n            }\n\n            // Add data\n            o.hiddenIcon = o.hidden ? checkYes : checkNo;\n            o.hide = o.hidden && !game.user.isGM;\n          })()\n        );\n      }\n      await Promise.all(promises);\n    }\n\n    // Create categories, and assign items to them\n    for (const c of categories) {\n      data.scriptCalls[c.id] = {\n        name: game.i18n.localize(c.name),\n        info: c.info ? game.i18n.localize(c.info) : null,\n        items: scriptCalls.filter((o) => o.category === c.id),\n        dataset: {\n          category: c.id,\n        },\n      };\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the text item type which is shown in the top-right corner of the sheet\n   *\n   * @param item\n   * @returns {string}\n   * @private\n   */\n  _getItemType(item) {\n    const typeKeys = Object.keys(CONFIG.FFD20.itemTypes);\n    let itemType = item.type;\n    if (!typeKeys.includes(itemType)) itemType = typeKeys[0];\n    return game.i18n.localize(CONFIG.FFD20.itemTypes[itemType]);\n  }\n\n  /**\n   * Get the text item status which is shown beneath the Item type in the top-right corner of the sheet\n   *\n   * @param item\n   * @returns {string}\n   * @private\n   */\n  _getItemStatus(item) {\n    const itemData = item.system;\n    if (item.type === \"spell\") {\n      const spellbook = this.item.spellbook;\n      if (itemData.preparation.mode === \"prepared\") {\n        if (spellbook?.spellPreparationMode === \"spontaneous\") {\n          if (itemData.preparation.spontaneousPrepared) return game.i18n.localize(\"FFD20.SpellPrepPrepared\");\n          else return game.i18n.localize(\"FFD20.Unprepared\");\n        } else if (itemData.preparation.preparedAmount > 0)\n          return game.i18n.localize(\"FFD20.AmountPrepared\").format(itemData.preparation.preparedAmount);\n        else return game.i18n.localize(\"FFD20.Unprepared\");\n      } else if (itemData.preparation.mode) {\n        return itemData.preparation.mode.titleCase();\n      }\n    } else if (itemData.equipped !== undefined) {\n      return itemData.equipped ? game.i18n.localize(\"FFD20.Equipped\") : game.i18n.localize(\"FFD20.NotEquipped\");\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get an array of item properties which are used in the small sidebar of the description tab\n   *\n   * @returns {string[]}\n   * @private\n   */\n  _getItemProperties() {\n    const props = [];\n    const item = this.item;\n    const labels = this.item.labels;\n\n    if (item.type === \"weapon\") {\n      props.push(\n        ...Object.entries(item.system.properties)\n          .filter((e) => e[1] === true)\n          .map((e) => CONFIG.FFD20.weaponProperties[e[0]])\n      );\n    } else if (item.type === \"spell\") {\n      props.push(labels.components, labels.materials);\n    } else if (item.type === \"equipment\") {\n      // Obfuscate wondrous item as clothing or other, if unidentified\n      if (!item.showUnidentifiedData || item.system.equipmentType !== \"misc\") {\n        props.push(CONFIG.FFD20.equipmentTypes[item.system.equipmentType][item.system.equipmentSubtype]);\n      } else {\n        if (item.system.slot === \"slotless\") {\n          props.push(CONFIG.FFD20.equipmentTypes[item.system.equipmentType][\"other\"]);\n        } else {\n          props.push(CONFIG.FFD20.equipmentTypes[item.system.equipmentType][\"clothing\"]);\n        }\n      }\n      // Add AC\n      props.push(labels.armor);\n    } else if (item.type === \"feat\") {\n      props.push(labels.featType);\n    }\n\n    // Action type\n    const itemActionTypes = item.actionTypes;\n    if (itemActionTypes) {\n      props.push(...itemActionTypes.map((o) => CONFIG.FFD20.itemActionTypes[o]));\n    }\n\n    // Action usage\n    if (item.type !== \"weapon\" && item.system.activation && !foundry.utils.isEmpty(item.system.activation)) {\n      props.push(labels.activation, labels.range, labels.target, labels.duration);\n    }\n\n    // Tags\n    if (getProperty(item.system, \"system.tags\") != null) {\n      props.push(\n        ...getProperty(item.system, \"system.tags\").map((o) => {\n          return o[0];\n        })\n      );\n    }\n\n    return props.filter((p) => !!p);\n  }\n\n  /* -------------------------------------------- */\n\n  /* -------------------------------------------- */\n  /*  Form Submission                             */\n  /* -------------------------------------------- */\n\n  /**\n   * Extend the parent class _updateObject method to ensure that damage ends up in an Array\n   *\n   * @param event\n   * @param formData\n   * @private\n   */\n  async _updateObject(event, formData) {\n    // Handle links arrays\n    const links = Object.entries(formData).filter((e) => e[0].startsWith(\"system.links\"));\n    for (const e of links) {\n      const path = e[0].split(\".\");\n      const linkType = path[2];\n      const index = path[3];\n      const subPath = path.slice(4).join(\".\");\n      const value = e[1];\n\n      // Non-indexed formData is presumed to have been handled already\n      if (index == null) continue;\n\n      delete formData[e[0]];\n\n      if (!formData[`system.links.${linkType}`])\n        formData[`system.links.${linkType}`] = deepClone(getProperty(this.item, `system.links.${linkType}`));\n\n      setProperty(formData[`system.links.${linkType}`][index], subPath, value);\n    }\n\n    // Handle weight to ensure `weight.value` is in lbs\n    if (formData[\"system.weight.value\"]) {\n      formData[\"system.weight.value\"] = ffd20.utils.convertWeightBack(formData[\"system.weight.value\"]);\n    }\n\n    // Change relative values\n    const relativeKeys = [\"system.currency.pp\", \"system.currency.gp\", \"system.currency.sp\", \"system.currency.cp\"];\n    for (const [k, v] of Object.entries(formData)) {\n      if (typeof v !== \"string\") continue;\n      // Add or subtract values\n      if (relativeKeys.includes(k)) {\n        const originalValue = getProperty(this.item.system, k);\n        let max = null;\n        const maxKey = k.replace(/\\.value$/, \".max\");\n        if (maxKey !== k) {\n          max = getProperty(this.item.system, maxKey);\n        }\n\n        if (v.match(/(\\+|--?)([0-9]+)/)) {\n          const operator = RegExp.$1;\n          let value = parseInt(RegExp.$2);\n          if (operator === \"--\") {\n            formData[k] = -value;\n          } else {\n            if (operator === \"-\") value = -value;\n            formData[k] = originalValue + value;\n            if (max) formData[k] = Math.min(formData[k], max);\n          }\n        } else if (v.match(/^[0-9]+$/)) {\n          formData[k] = parseInt(v);\n          if (max) formData[k] = Math.min(formData[k], max);\n        } else if (v === \"\") {\n          formData[k] = 0;\n        } else formData[k] = 0; // @TODO: definition?\n      }\n    }\n\n    // Update the Item\n    return super._updateObject(event, formData);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Activate listeners for interactive item sheet events\n   *\n   * @param html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // Tooltips\n    html.mousemove((ev) => this._moveTooltips(ev));\n\n    // Edit action\n    html.find(\".actions .items-list .item\").on(\"contextmenu\", this._onActionEdit.bind(this));\n\n    // Item summaries\n    html.find(\".item .item-name h4\").on(\"click\", (event) => this._onItemSummary(event));\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.isEditable) {\n      html.find(\"span.text-box\").addClass(\"readonly\");\n      return;\n    }\n\n    // Trigger form submission from textarea elements.\n    html.find(\"textarea\").change(this._onSubmit.bind(this));\n\n    // Add drop handler to textareas\n    html.find(\"textarea, .notes input[type='text']\").on(\"drop\", this._onTextAreaDrop.bind(this));\n\n    // Open help browser\n    html.find(\"a.help-browser[data-url]\").click(this._openHelpBrowser.bind(this));\n\n    // Modify buff changes\n    html.find(\".change-control\").click(this._onBuffControl.bind(this));\n    html.find(\".change .change-target\").click(this._onChangeTargetControl.bind(this));\n\n    // Modify note changes\n    html.find(\".context-note-control\").click(this._onNoteControl.bind(this));\n    html.find(\".context-note .context-note-target\").click(this._onNoteTargetControl.bind(this));\n\n    // Create attack\n    if ([\"weapon\"].includes(this.item.type)) {\n      html.find(\"button[name='create-attack']\").click(this._createAttack.bind(this));\n    }\n\n    // Listen to field entries\n    html.find(\".entry-selector\").click(this._onEntrySelector.bind(this));\n    html.find(\".entry-control a\").click(this._onEntryControl.bind(this));\n\n    // Add drop handler to link tabs\n    html.find('div[data-group=\"links\"],a.item[data-tab=\"links\"]').on(\"drop\", this._onLinksDrop.bind(this));\n\n    html.find(\".link-control\").click(this._onLinkControl.bind(this));\n\n    // Handle alternative file picker\n    html.find(\".file-picker-alt\").click(this._onFilePickerAlt.bind(this));\n\n    // Click to change text input\n    html.find('*[data-action=\"input-text\"]').click((event) => this._onInputText(event));\n\n    // Select the whole text on click\n    html.find(\".select-on-click\").click(this._selectOnClick.bind(this));\n\n    // Edit change script contents\n    html.find(\".edit-change-contents\").on(\"click\", this._onEditChangeScriptContents.bind(this));\n\n    // Trait Selector\n    html.find(\".trait-selector\").click(this._onTraitSelector.bind(this));\n\n    // Linked item clicks\n    html\n      .find(\".tab[data-tab='links'] .links-item[data-link] .links-item-name\")\n      .on(\"click\", this._openLinkedItem.bind(this));\n\n    /* -------------------------------------------- */\n    /*  Actions\n    /* -------------------------------------------- */\n\n    // Action control\n    html.find(\".action-controls a\").on(\"click\", this._onActionControl.bind(this));\n\n    // Modify action charges\n    html\n      .find(\".action-parts .item-uses span.text-box.value\")\n      .on(\"wheel\", this._setActionUses.bind(this))\n      .on(\"click\", (event) => {\n        this._onSpanTextInput(event, this._setActionUses.bind(this));\n      });\n\n    /* -------------------------------------------- */\n    /*  Links\n    /* -------------------------------------------- */\n\n    html.find('a[data-action=\"compendium\"]').click(this._onOpenCompendium.bind(this));\n\n    /* -------------------------------------------- */\n    /*  Script Calls\n    /* -------------------------------------------- */\n\n    html.find(\".script-calls .item-control\").click(this._onScriptCallControl.bind(this));\n\n    html.find(\".script-calls .items-list .item\").contextmenu(this._onScriptCallEdit.bind(this));\n\n    html.find(\".script-calls .inventory-list[data-category]\").on(\"drop\", this._onScriptCallDrop.bind(this));\n  }\n\n  _onSpanTextInput(event, callback = null) {\n    const el = event.currentTarget;\n    const parent = el.parentElement;\n\n    // Replace span element with an input (text) element\n    const newEl = document.createElement(`INPUT`);\n    newEl.type = \"text\";\n    if (el.dataset?.dtype) newEl.dataset.dtype = el.dataset.dtype;\n\n    // Set value of new input element\n    let prevValue = el.innerText;\n    if (el.classList.contains(\"placeholder\")) prevValue = \"\";\n\n    const noCap = el.classList.contains(\"no-value-cap\");\n\n    const name = el.getAttribute(\"name\");\n    let maxValue;\n    if (name) {\n      newEl.setAttribute(\"name\", name);\n      prevValue = getProperty(this.document, name) ?? \"\";\n      if (prevValue && typeof prevValue !== \"string\") prevValue = prevValue.toString();\n\n      if (name.endsWith(\".value\") && !noCap) {\n        const maxName = name.replace(/\\.value$/, \".max\");\n        maxValue = getProperty(this.document, maxName);\n      }\n    }\n    newEl.value = prevValue;\n\n    // Toggle classes\n    const forbiddenClasses = [\"placeholder\", \"direct\", \"allow-relative\"];\n    for (const cls of el.classList) {\n      if (!forbiddenClasses.includes(cls)) newEl.classList.add(cls);\n    }\n\n    // Replace span with input element\n    const allowRelative = el.classList.contains(\"allow-relative\"),\n      clearValue = parseFloat(el.dataset.clearValue || \"0\");\n    parent.replaceChild(newEl, el);\n    let changed = false;\n    newEl.addEventListener(\"keypress\", (event) => {\n      if (event.key !== \"Enter\") return;\n      changed = true;\n      if (allowRelative) {\n        const number = adjustNumberByStringCommand(parseFloat(prevValue), newEl.value, maxValue, clearValue);\n        newEl.value = number;\n      }\n\n      if (newEl.value.toString() === prevValue.toString()) {\n        this.render();\n      } else if (typeof callback === \"function\") {\n        callback.call(this, event);\n      }\n    });\n    newEl.addEventListener(\"focusout\", (event) => {\n      if (!changed) {\n        changed = true;\n        if (allowRelative && parseFloat(prevValue) !== parseFloat(newEl.value)) {\n          const number = adjustNumberByStringCommand(parseFloat(prevValue), newEl.value, maxValue, clearValue);\n          newEl.value = number;\n        }\n\n        if (newEl.value.toString() === prevValue.toString()) {\n          this.render();\n        } else if (typeof callback === \"function\") {\n          callback.call(this, event);\n        }\n      }\n    });\n\n    // Select text inside new element\n    newEl.focus();\n    newEl.select();\n  }\n\n  _mouseWheelAdd(event, el) {\n    const isInput = el.tagName.toUpperCase() === \"INPUT\";\n    const { originalEvent } = event;\n\n    if (originalEvent && originalEvent instanceof WheelEvent && originalEvent.ctrlKey) {\n      event.preventDefault();\n      const value = (isInput ? parseFloat(el.value) : parseFloat(el.innerText)) || 0;\n      if (Number.isNaN(value)) return;\n\n      const increase = -Math.sign(originalEvent.deltaY);\n      const amount = parseFloat(el.dataset.wheelStep) || 1;\n\n      if (isInput) {\n        el.value = value + amount * increase;\n      } else {\n        el.innerText = (value + amount * increase).toString();\n      }\n    }\n  }\n\n  _setActionUses(event) {\n    if (!(event.originalEvent instanceof MouseEvent)) event.preventDefault();\n    const el = event.currentTarget;\n    const actionId = el.closest(\".item\").dataset.itemId;\n    const action = this.document.actions.get(actionId);\n\n    this._mouseWheelAdd(event, el);\n\n    const value = el.tagName.toUpperCase() === \"INPUT\" ? Number(el.value) : Number(el.innerText);\n    this.setActionUpdate(action.id, \"uses.self.value\", value);\n\n    // Update on lose focus\n    if (event.originalEvent instanceof MouseEvent) {\n      const hasEvent = ($._data(el, \"events\")?.mouseout?.length ?? 0) > 0;\n      if (!hasEvent) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._updateActions();\n        });\n      }\n    } else this._updateActions();\n  }\n\n  setActionUpdate(id, key, value) {\n    let obj = this._actionUpdates.filter((o) => {\n      return o._id === id;\n    })[0];\n    if (obj == null) {\n      obj = { _id: id };\n      this._actionUpdates.push(obj);\n    }\n\n    obj[key] = value;\n  }\n\n  async _updateActions() {\n    const promises = [];\n\n    const updates = this._actionUpdates;\n    this._actionUpdates = [];\n\n    // Memorize variables in document\n    for (const d of updates) {\n      const action = this.document.actions.get(d._id);\n      if (!action) {\n        console.error(\"Item update for non-existing item:\", d._id, d);\n        continue;\n      }\n      await action.update(d);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  _onOpenCompendium(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const target = a.dataset.actionTarget;\n\n    ffd20.applications.compendiums[target].render(true, { focus: true });\n  }\n\n  async _onScriptCallControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const item = this.document.scriptCalls ? this.document.scriptCalls.get(a.closest(\".item\")?.dataset.itemId) : null;\n    const group = a.closest(\".inventory-list\");\n    const category = group.dataset.category;\n\n    // Create item\n    if (a.classList.contains(\"item-create\")) {\n      await this._onSubmit(event);\n      return ffd20.components.ItemScriptCall.create([{ category, type: \"script\" }], { parent: this.item });\n    }\n    // Delete item\n    else if (item && a.classList.contains(\"item-delete\")) {\n      const list = (this.document.system.scriptCalls || []).filter((o) => o._id !== item.id);\n      return this._onSubmit(event, { updateData: { \"system.scriptCalls\": list } });\n    }\n    // Edit item\n    else if (item && a.classList.contains(\"item-edit\")) {\n      item.edit();\n    }\n    // Toggle hidden\n    else if (item && a.classList.contains(\"item-hide\")) {\n      item.update({\n        hidden: !item.system.hidden,\n      });\n    }\n  }\n\n  _onScriptCallEdit(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const item = this.document.scriptCalls ? this.document.scriptCalls.get(a.dataset.itemId) : null;\n\n    if (item) {\n      item.edit();\n    }\n  }\n\n  _moveTooltips(event) {\n    const elem = $(event.currentTarget);\n    const x = event.clientX;\n    const y = event.clientY + 24;\n    elem.find(\".tooltip:hover .tooltipcontent\").css(\"left\", `${x}px`).css(\"top\", `${y}px`);\n  }\n\n  async _onTextAreaDrop(event) {\n    event.preventDefault();\n    const data = JSON.parse(event.originalEvent.dataTransfer.getData(\"text/plain\"));\n    if (!data) return;\n\n    const elem = event.currentTarget;\n    let link;\n\n    // Case 1 - Document from Compendium Pack\n    if (data.pack) {\n      const pack = game.packs.get(data.pack);\n      if (!pack) return;\n      const doc = await pack.getDocument(data.id);\n      link = `@Compendium[${data.pack}.${data.id}]{${doc.name}}`;\n    }\n\n    // Case 2 - Document from World\n    else {\n      const config = CONFIG[data.type];\n      if (!config) return false;\n      const doc = config.collection.instance.get(data.id);\n      if (!doc) return false;\n      link = `@${data.type}[${doc._id}]{${doc.name}}`;\n    }\n\n    // Insert link\n    if (link) {\n      elem.value = !elem.value ? link : elem.value + \"\\n\" + link;\n    }\n    return this._onSubmit(event);\n  }\n\n  async _onScriptCallDrop(event) {\n    event.preventDefault();\n    const data = JSON.parse(event.originalEvent.dataTransfer.getData(\"text/plain\"));\n    if (!data) return;\n\n    const elem = event.currentTarget;\n    const category = elem.dataset.category;\n\n    if (data.type === \"Macro\") {\n      let uuid;\n      // Get from compendium\n      if (data.pack) {\n        const pack = game.packs.get(data.pack);\n        const document = await pack.getDocument(data.id);\n        uuid = document.uuid;\n      }\n      // Get from world\n      else if (data.id) {\n        const document = game.macros.get(data.id);\n        uuid = document.uuid;\n      }\n\n      // Submit data\n      if (uuid) {\n        const list = this.document.system.scriptCalls ?? [];\n        await this._onSubmit(event);\n        return ffd20.components.ItemScriptCall.create([{ type: \"macro\", value: uuid, category }], {\n          parent: this.item,\n        });\n      }\n    }\n  }\n\n  _openHelpBrowser(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    ffd20.applications.helpBrowser.openUrl(a.dataset.url);\n  }\n\n  async _onLinksDrop(event) {\n    const elem = event.currentTarget;\n    let linkType = elem.dataset.tab;\n\n    // Default selection for dropping on tab instead of body\n    if (linkType === \"links\") linkType = \"children\";\n\n    // Try to extract the data\n    const data = TextEditor.getDragEventData(event.originalEvent);\n    if (!data.type) return;\n\n    const targetItem = await fromUuid(data.uuid);\n    if (!targetItem) return;\n\n    let dataType, itemLink;\n    // Case 1 - Import from a Compendium pack\n    if (targetItem.pack) {\n      dataType = \"compendium\";\n      itemLink = `${targetItem.pack}.${targetItem.id}`;\n    }\n\n    // Case 2 - Import from same actor\n    else if (targetItem.parent instanceof Actor && targetItem.parent === this.document.parentActor) {\n      dataType = \"data\";\n      itemLink = targetItem.id;\n    }\n\n    // Case 3 - Import from World Document\n    else {\n      dataType = \"world\";\n      itemLink = `world.${targetItem.id}`;\n    }\n\n    await this.item.createItemLink(linkType, dataType, targetItem, itemLink);\n  }\n\n  /**\n   * By default, returns true only for GM\n   *\n   * @override\n   */\n  _canDragStart(selector) {\n    return true;\n  }\n\n  _onDragStart(event) {\n    const elem = event.currentTarget;\n\n    // Drag action\n    if (elem.dataset?.itemId) {\n      const action = this.object.actions.get(elem.dataset.itemId);\n      const obj = { type: \"action\", source: this.object.uuid, data: action.data };\n      event.dataTransfer.setData(\"text/plain\", JSON.stringify(obj));\n    }\n  }\n\n  async _onDrop(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    let data, type;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n      // Surface-level check for action\n      if (data.type === \"action\" && data.source) type = \"action\";\n    } catch (e) {\n      return false;\n    }\n\n    const item = this.object;\n\n    // Handle actions\n    if (type === \"action\") {\n      const srcItem = await fromUuid(data.source);\n\n      // Re-order\n      if (srcItem === item) {\n        const targetActionID = event.target?.closest(\"li.action-part\")?.dataset?.itemId;\n        const prevActions = deepClone(item.system.actions);\n\n        let targetIdx;\n        if (!targetActionID) targetIdx = prevActions.length - 1;\n        else targetIdx = prevActions.indexOf(prevActions.find((o) => o._id === targetActionID));\n        const srcIdx = prevActions.indexOf(prevActions.find((o) => o._id === data.data._id));\n\n        prevActions.splice(srcIdx, 1);\n        prevActions.splice(targetIdx, 0, data.data);\n        await this.object.update({ \"system.actions\": prevActions });\n      }\n\n      // Add to another item\n      else {\n        const prevActions = deepClone(this.object.system.actions ?? []);\n        data._id = randomID(16);\n        prevActions.splice(prevActions.length, 0, data.data);\n        await this.object.update({ \"system.actions\": prevActions });\n      }\n    }\n  }\n\n  async _onEditChangeScriptContents(event) {\n    const elem = event.currentTarget;\n    const changeID = elem.closest(\".change\").dataset.change;\n    const change = this.item.changes.find((o) => o._id === changeID);\n\n    if (!change) return;\n\n    const scriptEditor = new ScriptEditor({ command: change.formula, parent: this.object }).render(true);\n    const result = await scriptEditor.awaitResult();\n    if (typeof result?.command === \"string\") {\n      return change.update({ formula: result.command });\n    }\n  }\n\n  /**\n   * Handle spawning the ActorTraitSelector application which allows a checkbox of multiple trait options\n   *\n   * @param {Event} event   The click event which originated the selection\n   * @private\n   */\n  _onTraitSelector(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const label = a.parentElement.querySelector(\"label\");\n    const options = {\n      name: label.getAttribute(\"for\"),\n      title: label.innerText,\n      subject: a.dataset.options,\n      choices: CONFIG.FFD20[a.dataset.options],\n    };\n    new ActorTraitSelector(this.object, options).render(true);\n  }\n\n  /**\n   * Toggle inline display of an item's summary/description by expanding or hiding info div\n   *\n   * @param {JQuery.ClickEvent<HTMLElement>} event - The click event on the item\n   * @private\n   */\n  _onItemSummary(event) {\n    event.preventDefault();\n    const li = $(event.currentTarget).closest(\".item:not(.sheet)\");\n    // Check whether pseudo-item belongs to another collection\n    const collection = li.attr(\"data-item-collection\") ?? \"items\";\n    const item = this.document[collection].get(li.attr(\"data-item-id\"));\n    // For actions (embedded into a parent item), show only the action's summary instead of a complete one\n    const isAction = collection === \"actions\";\n    const { description, actionDescription, properties } = item.getChatData();\n\n    // Toggle summary\n    if (li.hasClass(\"expanded\")) {\n      const summary = li.children(\".item-summary\");\n      summary.slideUp(200, () => summary.remove());\n    } else {\n      const div = $(`<div class=\"item-summary\">${isAction ? actionDescription : description}</div>`);\n      const props = $(`<div class=\"item-properties tag-list\"></div>`);\n      // Transform properties into a tag list containing HTML, and append to div\n      properties?.forEach((p) => props.append(`<span class=\"tag\">${p}</span>`));\n      div.append(props);\n      li.append(div.hide());\n      div.slideDown(200);\n    }\n    li.toggleClass(\"expanded\");\n  }\n\n  /**\n   * Open linked item sheet.\n   *\n   * @param {Event} event\n   */\n  _openLinkedItem(event) {\n    event.preventDefault();\n    const el = event.target.closest(\"[data-link]\"),\n      link = el.dataset.link,\n      parts = link.split(\".\"),\n      packId = parts.length === 3 ? parts.slice(0, 2).join(\".\") : null,\n      itemId = parts.pop();\n\n    if (packId) {\n      game.packs\n        .get(packId)\n        .getDocument(itemId)\n        .then((d) => d.sheet.render(true, { focus: true }));\n    } else {\n      this.actor.items.get(itemId).sheet.render(true, { focus: true });\n    }\n  }\n\n  /**\n   * @param {string} linkType - The type of link.\n   * @param {string} dataType - Either \"compendium\", \"data\" or \"world\".\n   * @param {object} itemData - The (new) item's data.\n   * @param {string} itemLink - The link identifier for the item.\n   * @param {object} [data] - The raw data from a drop event.\n   * @returns {Array} An array to insert into this item's link data.\n   */\n  generateInitialLinkData(linkType, dataType, itemData, itemLink, data = null) {\n    const result = {\n      id: itemLink,\n      dataType: dataType,\n      name: itemData.name,\n      img: itemData.img,\n    };\n\n    if (linkType === \"classAssociations\") {\n      result.level = 1;\n    }\n\n    if (linkType === \"ammunition\") {\n      result.recoverChance = 50;\n    }\n\n    return result;\n  }\n\n  async _onActionControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Add action\n    if (a.classList.contains(\"add-action\")) {\n      const newActionData = {\n        img: this.item.img,\n        name: [\"weapon\", \"attack\"].includes(this.item.type)\n          ? game.i18n.localize(\"FFD20.Attack\")\n          : game.i18n.localize(\"FFD20.Use\"),\n      };\n      await this._onSubmit(event);\n      return ffd20.components.ItemAction.create([newActionData], { parent: this.item });\n    }\n\n    // Edit action\n    if (a.classList.contains(\"edit-action\")) {\n      return this._onActionEdit(event);\n    }\n\n    // Remove action\n    if (a.classList.contains(\"delete-action\")) {\n      const li = a.closest(\".action-part\");\n      const action = this.item.actions.get(li.dataset.itemId);\n\n      const deleteItem = async () => {\n        return action.delete();\n      };\n\n      if (getSkipActionPrompt()) {\n        deleteItem();\n      } else {\n        const msg = `<p>${game.i18n.localize(\"FFD20.DeleteItemConfirmation\")}</p>`;\n        Dialog.confirm({\n          title: game.i18n.localize(\"FFD20.DeleteItemTitle\").format(action.name),\n          content: msg,\n          yes: () => {\n            deleteItem();\n          },\n          rejectClose: true,\n        });\n      }\n    }\n\n    // Duplicate action\n    if (a.classList.contains(\"duplicate-action\")) {\n      const li = a.closest(\".action-part\");\n      const action = deepClone(this.item.actions.get(li.dataset.itemId).data);\n      action.name = `${action.name} (${game.i18n.localize(\"FFD20.Copy\")})`;\n      action._id = randomID(16);\n      const actionParts = deepClone(this.item.system.actions ?? []);\n      return this._onSubmit(event, { updateData: { \"system.actions\": actionParts.concat(action) } });\n    }\n  }\n\n  async _onActionEdit(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const li = a.closest(\".action-part\");\n    const action = this.item.actions.get(li.dataset.itemId);\n\n    // Find existing window\n    for (const app of Object.values(this.item.apps)) {\n      if (app.object === action) {\n        app.render(true, { focus: true, editable: !this.isEditable });\n        return;\n      }\n    }\n\n    // Open new window\n    const app = new ffd20.applications.component.ItemActionSheet(action);\n    app.render(true);\n  }\n\n  async _onBuffControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Add new change\n    if (a.classList.contains(\"add-change\")) {\n      await this._onSubmit(event);\n      return ffd20.components.ItemChange.create([{}], { parent: this.item });\n    }\n\n    // Remove a change\n    if (a.classList.contains(\"delete-change\")) {\n      const li = a.closest(\".change\");\n      const changes = deepClone(this.item.system.changes);\n      const change = changes.find((o) => o._id === li.dataset.change);\n      changes.splice(changes.indexOf(change), 1);\n      return this._onSubmit(event, { updateData: { \"system.changes\": changes } });\n    }\n  }\n  _onChangeTargetControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Prepare categories and changes to display\n    const change = this.item.changes.get(a.closest(\".change\").dataset.change);\n    const categories = getBuffTargetDictionary(this.item.actor);\n\n    const part1 = change?.subTarget?.split(\".\")[0];\n    const category = CONFIG.FFD20.buffTargets[part1]?.category ?? part1;\n\n    // Show widget\n    const w = new Widget_CategorizedItemPicker(\n      { title: \"FFD20.Application.ChangeTargetSelector.Title\" },\n      categories,\n      (key) => {\n        if (key) {\n          change.update({ subTarget: key });\n        }\n      },\n      { category, item: change?.subTarget }\n    );\n    this._openApplications.push(w.appId);\n    w.render(true);\n  }\n\n  async _onNoteControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Add new note\n    if (a.classList.contains(\"add-note\")) {\n      const contextNotes = this.item.system.contextNotes || [];\n      await this._onSubmit(event, {\n        updateData: { \"system.contextNotes\": contextNotes.concat([ItemFFD20.defaultContextNote]) },\n      });\n    }\n\n    // Remove a note\n    if (a.classList.contains(\"delete-note\")) {\n      const li = a.closest(\".context-note\");\n      const contextNotes = duplicate(this.item.system.contextNotes);\n      contextNotes.splice(Number(li.dataset.note), 1);\n      await this._onSubmit(event, {\n        updateData: { \"system.contextNotes\": contextNotes },\n      });\n    }\n  }\n\n  _onNoteTargetControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Prepare categories and changes to display\n    const li = a.closest(\".context-note\");\n    const noteIndex = Number(li.dataset.note);\n    const note = this.item.system.contextNotes[noteIndex];\n    const categories = getBuffTargetDictionary(this.item.actor, \"contextNotes\");\n\n    const part1 = note?.subTarget?.split(\".\")[0];\n    const category = CONFIG.FFD20.contextNoteTargets[part1]?.category ?? part1;\n\n    // Show widget\n    const w = new Widget_CategorizedItemPicker(\n      { title: \"FFD20.Application.ContextNoteTargetSelector.Title\" },\n      categories,\n      (key) => {\n        if (key) {\n          const updateData = {};\n          updateData[`system.contextNotes.${noteIndex}.subTarget`] = key;\n          this.item.update(updateData);\n        }\n      },\n      { category, item: note?.subTarget }\n    );\n    this._openApplications.push(w.appId);\n    w.render(true);\n  }\n\n  async _onLinkControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Delete link\n    if (a.classList.contains(\"delete-link\")) {\n      const li = a.closest(\".links-item\");\n      const group = a.closest('div[data-group=\"links\"]');\n      let links = duplicate(getProperty(this.item, `system.links.${group.dataset.tab}`) || []);\n      const link = links.find((o) => o.id === li.dataset.link);\n      links = links.filter((o) => o !== link);\n\n      const updateData = {};\n      updateData[`system.links.${group.dataset.tab}`] = links;\n\n      // Call hook for deleting a link\n      callOldNamespaceHookAll(\"deleteItemLink\", \"ffd20DeleteItemLink\", this.item, link, group.dataset.tab);\n      Hooks.callAll(\"ffd20DeleteItemLink\", this.item, link, group.dataset.tab);\n\n      await this._onSubmit(event, { updateData });\n\n      // Clean link\n      this.item._cleanLink(link, group.dataset.tab);\n      game.socket.emit(\"system.ffd20\", {\n        eventType: \"cleanItemLink\",\n        actorUUID: this.item.actor?.uuid,\n        itemUUID: this.item.uuid,\n        link: link,\n        linkType: group.dataset.tab,\n      });\n    }\n  }\n\n  async _onFilePickerAlt(event) {\n    const button = event.currentTarget;\n    const attr = button.dataset.for;\n    const current = getProperty(this.item.system, attr);\n    const form = button.form;\n    const targetField = form[attr];\n    if (!targetField) return;\n\n    const fp = new FilePicker({\n      type: button.dataset.type,\n      current: current,\n      callback: (path) => {\n        targetField.value = path;\n        if (this.options.submitOnChange) {\n          this._onSubmit(event);\n        }\n      },\n      top: this.position.top + 40,\n      left: this.position.left + 10,\n    });\n    fp.browse(current);\n  }\n\n  /**\n   * Makes a readonly text input editable, and focus it.\n   *\n   * @param event\n   * @private\n   */\n  _onInputText(event) {\n    event.preventDefault();\n    const elem = this.element.find(event.currentTarget.dataset.for);\n\n    elem.removeAttr(\"readonly\");\n    elem.attr(\"name\", event.currentTarget.dataset.attrName);\n    const { inputValue } = event.currentTarget.dataset;\n    let value = inputValue ?? getProperty(this.item, event.currentTarget.dataset.attrName);\n    elem.attr(\"value\", value);\n    elem.select();\n\n    elem.focusout((event) => {\n      if (typeof value === \"number\") value = value.toString();\n      if (value !== elem.attr(\"value\")) {\n        this._onSubmit(event);\n      } else {\n        this.render();\n      }\n    });\n  }\n\n  async _createAttack(event) {\n    if (this.item.actor == null) throw new Error(game.i18n.localize(\"FFD20.ErrorItemNoOwner\"));\n\n    await this._onSubmit(event);\n\n    await this.item.actor.createAttackFromWeapon(this.item);\n  }\n\n  _onEntrySelector(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const options = {\n      name: a.getAttribute(\"for\"),\n      title: a.innerText,\n      flag: a.dataset.flag === \"true\",\n      flat: a.dataset.flat === \"true\",\n      fields: a.dataset.fields,\n      dtypes: a.dataset.dtypes,\n    };\n    new ffd20.applications.EntrySelector(this.item, options).render(true);\n  }\n\n  _onEntryControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const key = a.closest(\".notes\").dataset.name;\n\n    if (a.classList.contains(\"add-entry\")) {\n      const notes = getProperty(this.document, key) ?? [];\n      const updateData = {};\n      updateData[key] = notes.concat(\"\");\n      return this._onSubmit(event, { updateData });\n    } else if (a.classList.contains(\"delete-entry\")) {\n      const index = a.closest(\".entry\").dataset.index;\n      const notes = duplicate(getProperty(this.document, key));\n      notes.splice(index, 1);\n\n      const updateData = {};\n      updateData[key] = notes;\n      return this._onSubmit(event, { updateData });\n    }\n  }\n\n  _selectOnClick(event) {\n    event.preventDefault();\n    const el = event.currentTarget;\n    el.select();\n  }\n}\n\n/**\n * @typedef {object} DescriptionAttribute\n * @property {string} name - Data path to which the input will be written\n * @property {boolean} [fakeName] - Whether to show a value different from the one the `name` points to\n * @property {string} id\n * @property {boolean} [isNumber] - Whether the input is a number (text input)\n * @property {boolean} [isBoolean] - Whether the input is a boolean (checkbox)\n * @property {boolean} [isRange] - Whether this is a dual input for a value and a maximum value\n * @property {string} label - The label for the input\n * @property {string | boolean | number | {value: string | number, name: string}} value - The value that is show in the sidebar.\n *   Ranges require an object with `value` and `name` properties.\n * @property {{value: string | number, name: string}} [max] - Maximum value for a range input\n * @property {number} [decimals] - Number of decimals to display for `number`s\n * @property {string} [inputValue] - Value that will appear in the input field when it is edited,\n *                                   overriding the default value retrieved from the item data\n *                                   using {@link DescriptionAttribute#name}\n */\n","import { ItemSheetFFD20 } from \"./item-sheet.mjs\";\nimport { ItemFFD20 } from \"../../documents/item/item-ffd20.mjs\";\nimport { splitCurrency } from \"../../utils/lib.mjs\";\nimport { getSkipActionPrompt } from \"../../documents/settings.mjs\";\nimport { createConsumableSpellDialog } from \"../../utils/lib.mjs\";\nimport { CurrencyTransfer } from \"../currency-transfer.mjs\";\nimport { callOldNamespaceHook } from \"@utils/hooks.mjs\";\n\nexport class ItemSheetFFD20_Container extends ItemSheetFFD20 {\n  constructor(...args) {\n    super(...args);\n\n    /**\n     * Track the set of item filters which are applied\n     *\n     * @type {Set}\n     */\n    this._filters = {\n      search: { container: \"\" },\n    };\n\n    /** Item search */\n    this.searchCompositioning = false; // for IME\n    this.searchRefresh = true; // Lock out same term search unless sheet also refreshes\n    this.searchDelay = 250; // arbitrary ?ms for arbitrarily decent reactivity; MMke this configurable?\n    this.searchDelayEvent = null; // setTimeout id\n    this.effectiveSearch = \"\"; // prevent searching the same thing\n\n    /**\n     * Track item updates from the actor sheet.\n     *\n     * @type {object[]}\n     */\n    this._itemUpdates = [];\n\n    /**\n     * Override item sheet initial tab.\n     * Assumes first tab definitionis the main tab.\n     */\n    this.options.tabs[0].initial = \"contents\"; // Doesn't actually do anything\n    this._tabs[0].active = \"contents\"; // Actual override\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      width: 800,\n      classes: [\"ffd20\", \"sheet\", \"item\"],\n      scrollY: [\"section.inventory-body\"],\n      dragDrop: [\n        { dragSelector: \"li.item[data-item-id]\", dropSelector: '.tab[data-tab=\"contents\"]' },\n        { dragSelector: \"label.denomination\" },\n      ],\n    });\n  }\n\n  /**\n   * Return a dynamic reference to the HTML template path used to render this Item Sheet\n   *\n   * @returns {string}\n   */\n  get template() {\n    return \"systems/ffd20/templates/items/container.hbs\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare item sheet data\n   * Start with the base item data and extending with additional properties for rendering.\n   */\n  async getData() {\n    const data = await super.getData();\n\n    // Add filters\n    data.filters = this._filters;\n\n    // The item's items\n    data.items = this.item.items.reduce((cur, i) => {\n      const data = i.toObject();\n      cur.push(data);\n      data.document = i;\n      data.labels = i.labels;\n      data.hasAttack = i.hasAttack;\n      data.hasMultiAttack = i.hasMultiAttack;\n      data.hasDamage = i.hasDamage;\n      data.hasRange = i.hasRange;\n      data.hasEffect = i.hasEffect;\n      data.hasAction = i.hasAction || i.isCharged;\n      data.showUnidentifiedData = i.showUnidentifiedData;\n      if (i.showUnidentifiedData)\n        data.name = getProperty(i, \"system.unidentified.name\") || getProperty(i, \"system.identifiedName\") || i.name;\n      else data.name = getProperty(i, \"system.identifiedName\") || i.name;\n      return cur;\n    }, []);\n    data.items.sort((a, b) => (a.sort || 0) - (b.sort || 0));\n\n    // Show whether the item has currency\n    data.hasCurrency = Object.values(this.object.system.currency).some((o) => o > 0);\n\n    // Prepare inventory\n    this._prepareContents(data);\n\n    // Override description attributes\n    {\n      data.descriptionAttributes = [];\n\n      // Add weight\n      data.descriptionAttributes.push({\n        isNumber: true,\n        name: \"system.weight.value\",\n        fakeName: true,\n        label: game.i18n.localize(\"FFD20.Weight\"),\n        value: data.item.system.weight.converted.total,\n        inputValue: data.item.system.weight.converted.value,\n        decimals: 2,\n        id: \"data-weight-value\",\n      });\n\n      // Add price\n      if (data.showIdentifyDescription) {\n        data.descriptionAttributes.push(\n          {\n            isNumber: true,\n            name: \"system.basePrice\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.Price\"),\n            value: data.item.system.price,\n            id: \"data-basePrice\",\n          },\n          {\n            isNumber: true,\n            name: \"data.unidentified.basePrice\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.UnidentifiedPriceShort\"),\n            value: getProperty(data.item, \"system.unidentified.price\"),\n            id: \"data-unidentifiedBasePrice\",\n          }\n        );\n      } else {\n        if (data.showUnidentifiedData) {\n          data.descriptionAttributes.push({\n            isNumber: true,\n            name: \"system.unidentified.basePrice\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.Price\"),\n            value: getProperty(data.item, \"system.unidentified.price\"),\n            id: \"data-basePrice\",\n          });\n        } else {\n          data.descriptionAttributes.push({\n            isNumber: true,\n            name: \"system.basePrice\",\n            fakeName: true,\n            label: game.i18n.localize(\"FFD20.Price\"),\n            value: data.item.system.price,\n            id: \"data-basePrice\",\n          });\n        }\n      }\n\n      // Add hit points\n      data.descriptionAttributes.push({\n        isRange: true,\n        label: game.i18n.localize(\"FFD20.HPShort\"),\n        value: {\n          name: \"system.hp.value\",\n          value: getProperty(data.item, \"system.hp.value\"),\n        },\n        max: {\n          name: \"system.hp.max\",\n          value: getProperty(data.item, \"system.hp.max\"),\n        },\n      });\n\n      // Add hardness\n      data.descriptionAttributes.push({\n        isNumber: true,\n        label: game.i18n.localize(\"FFD20.Hardness\"),\n        name: \"system.hardness\",\n        value: getProperty(data.item, \"system.hardness\"),\n      });\n\n      // Add carried flag\n      data.descriptionAttributes.push({\n        isBoolean: true,\n        name: \"system.carried\",\n        label: game.i18n.localize(\"FFD20.Carried\"),\n        value: data.item.system.carried,\n      });\n    }\n\n    // Get contents weight\n    let usystem = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n    if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n    data.weight = {\n      contents: this.item.system.weight.converted.contents,\n      units: usystem === \"metric\" ? game.i18n.localize(\"FFD20.Kgs\") : game.i18n.localize(\"FFD20.Lbs\"),\n    };\n\n    // Get contents value\n    const cgilValue =\n      this.item.getValue({ sellValue: 1, inLowestDenomination: true }) -\n      this.item.getValue({ recursive: false, sellValue: 1, inLowestDenomination: true });\n    const cgilSellValue =\n      this.item.getValue({ inLowestDenomination: true }) -\n      this.item.getValue({ recursive: false, inLowestDenomination: true });\n\n    data.totalValue = splitCurrency(cgilValue);\n    data.sellValue = splitCurrency(cgilSellValue);\n\n    // Set labels\n    if (!data.labels) data.labels = {};\n    data.labels.totalValue = game.i18n\n      .localize(\"FFD20.ItemContainerTotalValue\")\n      .format(data.totalValue.gil, data.totalValue.sgil, data.totalValue.cgil);\n    data.labels.sellValue = game.i18n\n      .localize(\"FFD20.ItemContainerSellValue\")\n      .format(data.sellValue.gil, data.sellValue.sgil, data.sellValue.cgil);\n\n    return data;\n  }\n\n  _prepareContents(data) {\n    // Categorize items as inventory, spellbook, features, and classes\n    const inventory = {\n      weapon: {\n        label: game.i18n.localize(\"FFD20.InventoryWeapons\"),\n        canCreate: true,\n        hasActions: true,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"weapon\" },\n      },\n      equipment: {\n        label: game.i18n.localize(\"FFD20.InventoryArmorEquipment\"),\n        canCreate: true,\n        hasActions: true,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"equipment\" },\n        hasSlots: true,\n      },\n      consumable: {\n        label: game.i18n.localize(\"FFD20.InventoryConsumables\"),\n        canCreate: true,\n        hasActions: true,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"consumable\" },\n      },\n      gear: {\n        label: CONFIG.FFD20.lootTypes[\"gear\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"loot\", \"type-name\": game.i18n.localize(\"FFD20.LootTypeGearSingle\"), \"sub-type\": \"gear\" },\n      },\n      ammo: {\n        label: CONFIG.FFD20.lootTypes[\"ammo\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"loot\", \"type-name\": game.i18n.localize(\"FFD20.LootTypeAmmoSingle\"), \"sub-type\": \"ammo\" },\n      },\n      misc: {\n        label: CONFIG.FFD20.lootTypes[\"misc\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: false,\n        dataset: { type: \"loot\", \"type-name\": game.i18n.localize(\"FFD20.Misc\"), \"sub-type\": \"misc\" },\n      },\n      tradeGoods: {\n        label: CONFIG.FFD20.lootTypes[\"tradeGoods\"],\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        canEquip: false,\n        dataset: {\n          type: \"loot\",\n          \"type-name\": game.i18n.localize(\"FFD20.LootTypeTradeGoodsSingle\"),\n          \"sub-type\": \"tradeGoods\",\n        },\n      },\n      container: {\n        label: game.i18n.localize(\"FFD20.InventoryContainers\"),\n        canCreate: true,\n        hasActions: false,\n        items: [],\n        dataset: { type: \"container\" },\n      },\n    };\n\n    // Partition items by category\n    const items = data.items.reduce((arr, item) => {\n      item.img = item.img || DEFAULT_TOKEN;\n      item.isStack = item.system.quantity ? item.system.quantity > 1 : false;\n      item.hasUses = item.system.uses && item.system.uses.max > 0;\n      item.isCharged = [\"day\", \"week\", \"charges\"].includes(getProperty(item, \"system.uses.per\"));\n      item.price = item.system.identified === false ? item.system.unidentified.price : item.system.price;\n\n      const itemQuantity = getProperty(item, \"system.quantity\") ?? 1;\n      const itemCharges = getProperty(item, \"system.uses.value\") ?? 1;\n      item.empty = itemQuantity <= 0 || (item.isCharged && itemCharges <= 0);\n      arr.push(item);\n      return arr;\n    }, []);\n\n    // Organize Inventory\n    for (const i of items) {\n      const subType = i.type === \"loot\" ? i.system.subType || \"gear\" : i.system.subType;\n      i.system.quantity = i.system.quantity || 0;\n      i.totalWeight = Math.roundDecimals(i.document.system.weight.converted.total, 2);\n      let usystem = game.settings.get(\"ffd20\", \"weightUnits\"); // override\n      if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n      i.units = usystem === \"metric\" ? game.i18n.localize(\"FFD20.Kgs\") : game.i18n.localize(\"FFD20.Lbs\");\n      if (inventory[i.type] != null) inventory[i.type].items.push(i);\n      if (subType != null && inventory[subType] != null) inventory[subType].items.push(i);\n    }\n\n    data.inventory = Object.values(inventory);\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    /* -------------------------------------------- */\n    /*  Inventory\n    /* -------------------------------------------- */\n\n    // Owned Item management\n    html.find(`.tab[data-tab=\"contents\"] .item-create`).click((ev) => this._onItemCreate(ev));\n    html.find(`.tab[data-tab=\"contents\"] .item-edit`).click(this._onItemEdit.bind(this));\n    html.find(`.tab[data-tab=\"contents\"] .item-delete`).click(this._onItemDelete.bind(this));\n    html.find(`.tab[data-tab=\"contents\"] .item-take`).click(this._onItemTake.bind(this));\n\n    // Quick edit item\n    html.find(\".item .item-name h4\").contextmenu(this._onItemEdit.bind(this));\n\n    // Quick (un)identify item\n    html.find(\"a.item-control.item-identify\").click((ev) => {\n      this._quickIdentifyItem(ev);\n    });\n\n    // Duplicate item\n    html.find(\"a.item-control.item-duplicate\").click(this._duplicateItem.bind(this));\n\n    // Quick add item quantity\n    html.find(\"a.item-control.item-quantity-add\").click((ev) => {\n      this._quickChangeItemQuantity(ev, 1);\n    });\n    // Quick subtract item quantity\n    html.find(\"a.item-control.item-quantity-subtract\").click((ev) => {\n      this._quickChangeItemQuantity(ev, -1);\n    });\n\n    // Quick Item Action control\n    html.find(\".item-actions a\").click((ev) => this._quickItemActionControl(ev));\n\n    // Set item uses\n    html\n      .find(\".item-detail.item-uses input[type='text']:not(:disabled)\")\n      .off(\"change\")\n      .change(this._setItemUses.bind(this))\n      .on(\"wheel\", this._setItemUses.bind(this));\n\n    // Convert currency\n    html.find(\"a.convert-currency\").click(this._convertCurrency.bind(this));\n\n    // Item Rolling\n    html.find(\".item .item-image\").click((event) => this._onItemRoll(event));\n\n    // Search box\n    const sb = html.find(\".search-input\");\n    sb.on(\"keyup change\", this._searchFilterChange.bind(this));\n    sb.on(\"compositionstart compositionend\", this._searchFilterCompositioning.bind(this)); // for IME\n    this.searchRefresh = true;\n    // Filter following refresh\n    sb.each(function () {\n      if (this.value.length > 0) $(this).change();\n    });\n    html.find(\".clear-search\").on(\"click\", this._clearSearch.bind(this));\n  }\n\n  _onItemCreate(event) {\n    event.preventDefault();\n    const header = event.currentTarget;\n    const type = header.dataset.type;\n    const typeName = header.dataset.typeName || header.dataset.type;\n    const itemData = {\n      name: `New ${typeName.capitalize()}`,\n      type: type,\n      system: duplicate(header.dataset),\n    };\n    delete itemData[\"system.type\"];\n    return this.item.createContainerContent(itemData);\n  }\n\n  _onItemEdit(event) {\n    event.preventDefault();\n    const li = event.currentTarget.closest(\".item\");\n    const item = this.item.getContainerContent(li.dataset.itemId);\n\n    item.sheet.render(true, { focus: true });\n  }\n\n  _onItemDelete(event) {\n    event.preventDefault();\n\n    const button = event.currentTarget;\n    if (button.disabled) return;\n\n    const li = event.currentTarget.closest(\".item\");\n    if (getSkipActionPrompt()) {\n      this.item.deleteContainerContent(li.dataset.itemId);\n    } else {\n      button.disabled = true;\n\n      const item = this.document.items.get(li.dataset.itemId);\n\n      const msg = `<p>${game.i18n.localize(\"FFD20.DeleteItemConfirmation\")}</p>`;\n      Dialog.confirm({\n        title: game.i18n.localize(\"FFD20.DeleteItemTitle\").format(item.name),\n        content: msg,\n        yes: () => {\n          this.item.deleteContainerContent(li.dataset.itemId);\n          button.disabled = false;\n        },\n        no: () => (button.disabled = false),\n        rejectClose: true,\n      }).then(null, () => (button.disabled = false));\n    }\n  }\n\n  async _onItemTake(event) {\n    event.preventDefault();\n\n    const li = event.currentTarget.closest(\".item\");\n    const item = this.item.getContainerContent(li.dataset.itemId);\n\n    if (this.actor) {\n      await this.actor.createEmbeddedDocuments(\"Item\", [item.toObject()]);\n      await this.item.deleteContainerContent(item._id);\n    }\n  }\n\n  _onDragStart(event) {\n    // Skip document links, since they should be handled differently\n    if (event.target.classList.contains(\"entity-link\")) return;\n\n    // Create drag data for an owned item\n    const elem = event.currentTarget;\n    let dragData;\n    if (elem.classList.contains(\"denomination\")) {\n      if (!this.item.testUserPermission(game.user, 3)) return;\n      dragData = {\n        type: \"Currency\",\n        alt: elem.classList.contains(\"alt-currency\"),\n        currency: [...elem.classList].find((o) => /[pgsc]p/.test(o)),\n        containerId: this.item.id,\n        amount: parseInt(elem.nextElementSibling.textContent || elem.nextElementSibling.value),\n      };\n    } else {\n      const item = this.item.getContainerContent(elem.dataset.itemId);\n      dragData = {\n        type: \"Item\",\n        data: item.toObject(),\n        containerId: this.item.id,\n      };\n    }\n\n    // Add actor to drag data\n    const actor = this.item.parentActor;\n    if (actor) {\n      dragData.actorId = actor.id;\n      dragData.sceneId = actor.isToken ? canvas.scene?.id : null;\n      dragData.tokenId = actor.isToken ? actor.token.id : null;\n    }\n\n    // Set data transfer\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(dragData));\n  }\n\n  _onDrop(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Try to extract the data\n    let data;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n    } catch (err) {\n      return false;\n    }\n    const item = this.item;\n\n    // Handle the drop with a Hooked function\n    let allowed = Hooks.call(\"ffd20DropContainerSheetData\", item, this, data);\n    allowed = callOldNamespaceHook(\"dropContainerSheetData\", \"ffd20DropContainerSheetData\", allowed, item, this, data);\n    if (allowed === false) return;\n\n    // Handle different data types\n    switch (data.type) {\n      case \"Item\":\n        return this._onDropItem(event, data);\n      case \"Currency\": {\n        return this._onDropCurrency(event, data);\n      }\n    }\n  }\n\n  async _onDropCurrency(event, data) {\n    const sourceActor = data.tokenId ? game.actors.tokens[data.tokenId] : data.actorId;\n    return new CurrencyTransfer(\n      { actor: sourceActor, container: data.containerId, alt: data.alt },\n      {\n        actor: this.actor,\n        container: this.item.id,\n        amount: Object.fromEntries([[data.currency, parseInt(data.amount)]]),\n      }\n    ).render(true);\n  }\n\n  async _onDropItem(event, data) {\n    if (!this.item.isOwner) return false;\n\n    const item = await ItemFFD20.fromDropData(data);\n    const actor = item.parentActor;\n    const itemData = item.toObject();\n\n    // Sort item\n    if (data.containerId === this.item.id) return this._onSortItem(event, itemData);\n\n    // Create consumable from spell\n    if (itemData.type === \"spell\") {\n      const resultData = await createConsumableSpellDialog(itemData, { allowSpell: false });\n      if (resultData) return this.item.createContainerContent(resultData);\n      else return false;\n    }\n\n    // Create or transfer item\n    if (ItemFFD20.isInventoryItem(item.type)) {\n      await this.item.createContainerContent(itemData);\n\n      if (actor && actor === this.item.parentActor) {\n        if (actor.items.get(item.id)) {\n          await actor.deleteEmbeddedDocuments(\"Item\", [item.id]);\n        } else {\n          const containerItem = actor.containerItems.find((i) => i.id === item.id);\n          if (containerItem) {\n            await containerItem.parentItem.deleteContainerContent(item.id);\n          }\n        }\n      }\n    }\n  }\n\n  async _quickIdentifyItem(event) {\n    event.preventDefault();\n    if (!game.user.isGM) {\n      const msg = game.i18n.localize(\"FFD20.ErrorCantIdentify\");\n      console.error(msg);\n      return ui.notifications.error(msg);\n    }\n    const itemId = $(event.currentTarget).parents(\".item\").attr(\"data-item-id\");\n    const item = this.item.getContainerContent(itemId);\n\n    if (hasProperty(item.data, \"data.identified\")) {\n      return item.update({ \"data.identified\": !item.data.identified });\n    }\n  }\n\n  async _duplicateItem(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    const itemId = $(a).parents(\".item\").attr(\"data-item-id\");\n    const item = this.item.getContainerContent(itemId);\n    const data = duplicate(item.data);\n\n    delete data._id;\n    data.name = `${data.name} (${game.i18n.localize(\"FFD20.Copy\")})`;\n    data.identifiedName = `${item.data.identifiedName} (${game.i18n.localize(\"FFD20.Copy\")})`;\n    if (data.links) data.links = {};\n\n    return this.item.createContainerContent(data);\n  }\n\n  async _quickChangeItemQuantity(event, add = 1) {\n    event.preventDefault();\n    const itemId = $(event.currentTarget).parents(\".item\").attr(\"data-item-id\");\n    const item = this.item.getContainerContent(itemId);\n\n    const curQuantity = getProperty(item, \"system.quantity\") || 0;\n    const newQuantity = Math.max(0, curQuantity + add);\n    return item.update({ \"system.quantity\": newQuantity });\n  }\n\n  async _quickItemActionControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const itemId = $(event.currentTarget).closest(\".item\").attr(\"data-item-id\");\n    const item = this.item.getContainerContent(itemId);\n\n    // Quick Attack\n    if (a.classList.contains(\"item-attack\")) {\n      await item.use({ ev: event, skipDialog: getSkipActionPrompt() });\n    }\n  }\n\n  async _setItemUses(event) {\n    event.preventDefault();\n    const el = event.currentTarget;\n    const itemId = el.closest(\".item\").dataset.itemId;\n    const item = this.item.getContainerContent(itemId);\n\n    this._mouseWheelAdd(event.originalEvent, el);\n\n    const value = Number(el.value);\n    this.setItemUpdate(item._id, \"data.uses.value\", value);\n\n    // Update on lose focus\n    if (event.originalEvent instanceof MouseEvent) {\n      if (!this._submitQueued) {\n        $(el).one(\"mouseleave\", (event) => {\n          this._updateItems();\n        });\n      }\n    } else this._updateItems();\n  }\n\n  async _updateItems() {\n    const promises = [];\n\n    const updates = duplicate(this._itemUpdates);\n    this._itemUpdates = [];\n\n    for (const data of updates) {\n      const item = this.item.items.filter((o) => {\n        return o._id === data._id;\n      })[0];\n      if (item == null) continue;\n\n      delete data._id;\n      if (item.testUserPermission(game.user, \"OWNER\")) promises.push(item.update(data));\n    }\n\n    return Promise.all(promises);\n  }\n\n  setItemUpdate(id, key, value) {\n    let obj = this._itemUpdates.filter((o) => {\n      return o._id === id;\n    })[0];\n    if (obj == null) {\n      obj = { _id: id };\n      this._itemUpdates.push(obj);\n    }\n\n    obj[key] = value;\n  }\n\n  _mouseWheelAdd(event, el) {\n    if (event && event instanceof WheelEvent) {\n      const value = parseFloat(el.value);\n      if (Number.isNaN(value)) return;\n\n      const increase = -Math.sign(event.deltaY);\n      const amount = parseFloat(el.dataset.wheelStep) || 1;\n      el.value = value + amount * increase;\n    }\n  }\n\n  _convertCurrency(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const currencyType = a.dataset.type;\n\n    this.item.convertCurrency(currencyType);\n  }\n\n  /**\n   * @override\n   */\n  _onSortItem(event, itemData) {\n    // Get the drag source and its siblings\n    const source = this.item.getContainerContent(itemData._id);\n    const siblings = this._getSortSiblings(source);\n\n    // Get the drop target\n    const dropTarget = event.target.closest(\".item\");\n    const targetId = dropTarget ? dropTarget.dataset.itemId : null;\n    const target = siblings.find((s) => s._id === targetId);\n\n    // Perform the sort\n    const sortUpdates = SortingHelpers.performIntegerSort(source, { target: target, siblings });\n    const updateData = sortUpdates.map((u) => {\n      const update = u.update;\n      update._id = u.target._id;\n      return update;\n    });\n\n    // Perform the update\n    return this.item.updateContainerContents(updateData);\n  }\n\n  /**\n   * @override\n   */\n  _getSortSiblings(source) {\n    return this.item.items.filter((i) => {\n      if (ItemFFD20.isInventoryItem(source.type)) return ItemFFD20.isInventoryItem(i.type);\n      return i.type === source.type && i.data._id !== source._id;\n    });\n  }\n\n  /**\n   * Handle rolling of an item from the Actor sheet, obtaining the Item instance and dispatching to it's roll method\n   *\n   * @param event\n   * @private\n   */\n  _onItemRoll(event) {\n    event.preventDefault();\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\n    const item = this.item.getContainerContent(itemId);\n\n    if (item == null) return;\n    return item.roll();\n  }\n\n  /** Item Search */\n\n  _searchFilterCommit(event) {\n    const container = this.item;\n    const search = this._filters.search.container.toLowerCase();\n\n    // TODO: Do not refresh if same search term, unless the sheet has updated.\n    if (this.effectiveSearch === search && !this.searchRefresh) return;\n\n    this.effectiveSearch = search;\n    this.searchRefresh = false;\n\n    const matchSearch = (name) => name.toLowerCase().includes(search); // MKAhvi: Bad method for i18n support.\n\n    $(event.target)\n      .closest(\".tab\")\n      .find(\".item-list .item\")\n      .each(function () {\n        const jq = $(this);\n        if (search?.length > 0) {\n          const item = container.items.get(this.dataset.itemId);\n          if (matchSearch(item.name)) jq.show();\n          else jq.hide();\n        } else jq.show();\n      });\n  }\n\n  _clearSearch(event) {\n    this._filters.search.container = \"\";\n    $(event.target).prev(\".search-input\").val(\"\").change();\n  }\n\n  // IME related\n  _searchFilterCompositioning(event) {\n    this.searchCompositioning = event.type === \"compositionstart\";\n  }\n\n  _searchFilterChange(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    //this._onSubmit(event, { preventRender: true }); // prevent sheet refresh\n\n    // Accept input only while not compositioning\n\n    const search = event.target.value;\n    const changed = this._filters.search.container !== search;\n\n    if (this.searchCompositioning || changed) clearTimeout(this.searchDelayEvent); // reset\n    if (this.searchCompositioning) return;\n\n    this._filters.search.container = search;\n\n    if (event.type === \"keyup\") {\n      // Delay search\n      if (changed) this.searchDelayEvent = setTimeout(() => this._searchFilterCommit(event), this.searchDelay);\n    } else this._searchFilterCommit(event);\n  }\n}\n","import { CompendiumBrowser } from \"./applications/compendium-browser.mjs\";\n\nexport class CompendiumDirectoryFFD20 extends CompendiumDirectory {\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      template: \"systems/ffd20/templates/sidebar/compendium.hbs\",\n    });\n  }\n\n  async getData(options) {\n    const data = await super.getData(options);\n\n    for (const p of Object.values(data.packs)) {\n      for (const pack of p.packs) {\n        const config = game.settings.get(\"core\", \"compendiumConfiguration\")[pack.collection];\n        const disabled = getProperty(config, \"ffd20.disabled\") === true;\n        setProperty(pack, \"ffd20.disabled\", disabled);\n      }\n    }\n\n    return data;\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.find(\".compendium-footer .compendium.spells\").click((e) => this._onBrowseCompendium(e, \"spells\"));\n    html.find(\".compendium-footer .compendium.items\").click((e) => this._onBrowseCompendium(e, \"items\"));\n    html.find(\".compendium-footer .compendium.bestiary\").click((e) => this._onBrowseCompendium(e, \"bestiary\"));\n    html.find(\".compendium-footer .compendium.feats\").click((e) => this._onBrowseCompendium(e, \"feats\"));\n    html.find(\".compendium-footer .compendium.classes\").click((e) => this._onBrowseCompendium(e, \"classes\"));\n    html.find(\".compendium-footer .compendium.races\").click((e) => this._onBrowseCompendium(e, \"races\"));\n    html.find(\".compendium-footer .compendium.buffs\").click((e) => this._onBrowseCompendium(e, \"buffs\"));\n  }\n\n  _onBrowseCompendium(event, type) {\n    event.preventDefault();\n\n    if (ffd20.migrations.isMigrating) return ui.notifications.warn(game.i18n.localize(\"FFD20.Migration.Ongoing\"));\n\n    ffd20.applications.compendiums[type]._render(true);\n  }\n}\n","/**\n * Add a checkbox to enable/disable low-light vision effects to a light's configuration\n *\n * @param {FormApplication} app - The LightConfig app\n * @param {jQuery} html - The jQuery of the inner html\n */\nexport const addLowLightVisionToLightConfig = function (app, html) {\n  const obj = app.object;\n\n  // Create checkbox HTML element\n  let checkboxStr = `<div class=\"form-group\"><label>${game.i18n.localize(\"FFD20.DisableLightLowLightVision\")}</label>`;\n  checkboxStr += '<input type=\"checkbox\" name=\"flags.ffd20.disableLowLight\" data-dtype=\"Boolean\"';\n  if (getProperty(obj, \"flags.ffd20.disableLowLight\")) checkboxStr += \" checked\";\n  checkboxStr += \"/></div>\";\n  const checkbox = $(checkboxStr);\n\n  // Insert new checkbox\n  html.find('div.tab[data-tab=\"basic\"]').append(checkbox);\n};\n\n/**\n * Add a checkbox to enable/disable low-light vision to a token's configuration\n *\n * @param {FormApplication} app - The TokenConfig app\n * @param {jQuery} html - The jQuery of the inner html\n */\nexport const addLowLightVisionToTokenConfig = function (app, html) {\n  const obj = app.object;\n\n  // Create checkbox HTML element\n  let checkboxStr = `<div class=\"form-group\"><label>${game.i18n.localize(\"FFD20.DisableLightLowLightVision\")}</label>`;\n  checkboxStr += '<input type=\"checkbox\" name=\"flags.ffd20.disableLowLight\" data-dtype=\"Boolean\"';\n  if (getProperty(obj, \"flags.ffd20.disableLowLight\")) checkboxStr += \" checked\";\n  checkboxStr += \"/></div>\";\n  const checkbox = $(checkboxStr);\n\n  // Insert new checkbox\n  html.find('.tab[data-group=\"light\"][data-tab=\"basic\"]').append(checkbox);\n};\n\nexport const patchCore = function () {\n  const LightSource_initialize = LightSource.prototype.initialize;\n  LightSource.prototype.initialize = function (data = {}) {\n    // Initialize new input data\n    const changes = this._initializeData(data);\n    this._initializeFlags();\n\n    // Record the requested animation configuration\n    const seed = this.animation.seed ?? data.seed ?? Math.floor(Math.random() * 100000);\n    const animationConfig = foundry.utils.deepClone(CONFIG.Canvas.lightAnimations[this.data.animation.type] || {});\n    this.animation = Object.assign(animationConfig, this.data.animation, { seed });\n\n    // Compute dim and bright radius\n    const { dim, bright } = this.getRadius();\n\n    // Compute data attributes\n    this.colorRGB = Color.from(this.data.color)?.rgb;\n    this.radius = Math.max(Math.abs(dim), Math.abs(bright));\n    this.ratio = Math.clamped(Math.abs(this.data.bright) / this.radius, 0, 1);\n    this.isDarkness = this.data.luminosity < 0;\n\n    // Compute the source polygon\n    this.los = this._createPolygon();\n    this._flags.renderSoftEdges =\n      canvas.performance.lightSoftEdges && (!!this.los.rays?.length || this.data.angle < 360);\n\n    // Initialize or update meshes with the los points array\n    this._initializeMeshes(this.los);\n\n    // Update shaders if the animation type or the constrained wall option changed\n    const updateShaders = \"animation.type\" in changes || \"walls\" in changes;\n    if (updateShaders) this._initializeShaders();\n    else if (this.constructor._appearanceKeys.some((k) => k in changes)) {\n      // Record status flags\n      for (const k of Object.keys(this._resetUniforms)) {\n        this._resetUniforms[k] = true;\n      }\n    }\n\n    // Initialize blend modes and sorting\n    this._initializeBlending();\n    return this;\n  };\n\n  LightSource.prototype.getRadius = function () {\n    const result = { dim: this.data.dim, bright: this.data.bright };\n    const multiplier = { dim: 1, bright: 1 };\n\n    const relevantTokens = canvas.tokens.placeables.filter((o) => {\n      return o.actor?.testUserPermission(game.user, \"OBSERVER\");\n    });\n    const lowLightTokens = relevantTokens.filter((o) => o.actorVision.lowLight === true);\n\n    if (game.user.isGM || game.settings.get(\"ffd20\", \"lowLightVisionMode\")) {\n      for (const t of lowLightTokens.filter((o) => o.controlled)) {\n        const tokenVision = t.actorVision;\n        multiplier.dim = Math.max(multiplier.dim, tokenVision.lowLightMultiplier);\n        multiplier.bright = Math.max(multiplier.bright, tokenVision.lowLightMultiplierBright);\n      }\n    } else {\n      const hasControlledTokens = relevantTokens.filter((o) => o.controlled).length > 0;\n      const hasControlledLowLightTokens = lowLightTokens.filter((o) => o.controlled).length > 0;\n      const hasLowLightTokens = lowLightTokens.length > 0;\n      if ((!hasControlledTokens && hasLowLightTokens) || hasControlledLowLightTokens) {\n        for (const t of lowLightTokens) {\n          const tokenVision = t.actorVision;\n          multiplier.dim = Math.max(multiplier.dim, tokenVision.lowLightMultiplier);\n          multiplier.bright = Math.max(multiplier.bright, tokenVision.lowLightMultiplierBright);\n        }\n      }\n    }\n\n    result.dim *= multiplier.dim;\n    result.bright *= multiplier.bright;\n\n    return result;\n  };\n};\n","import { customRolls } from \"./documents/chat-message.mjs\";\nimport { sortArrayByName } from \"./utils/lib.mjs\";\nimport { parseRollStringVariable } from \"./dice/roll.mjs\";\nimport { RollFFD20 } from \"./dice/roll.mjs\";\nimport { patchCore as patchLowLightVision } from \"./canvas/low-light-vision.mjs\";\n\n/**\n *\n */\n// Add inline support for extra /commands\n{\n  const origParse = ChatLog.parse;\n  ChatLog.parse = function (message) {\n    const match = message.match(/^\\/(\\w+)(?: +([^#]+))(?:#(.+))?/),\n      type = match?.[1];\n    if ([\"HEAL\", \"H\", \"DAMAGE\", \"D\"].includes(type?.toUpperCase())) {\n      match[2] = match[0].slice(1);\n      return [\"custom\", match];\n    } else return origParse.call(this, message);\n  };\n\n  const origClick = TextEditor._onClickInlineRoll;\n  TextEditor._onClickInlineRoll = function (event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    if (!a.classList.contains(\"custom\")) return origClick.call(this, event);\n\n    const chatMessage = `/${a.dataset.formula}`;\n    const cMsg = CONFIG.ChatMessage.documentClass;\n    const speaker = cMsg.getSpeaker();\n    const actor = cMsg.getSpeakerActor(speaker);\n    let rollData = actor ? actor.getRollData() : {};\n\n    const sheet = a.closest(\".sheet\");\n    if (sheet) {\n      const app = ui.windows[sheet.dataset.appid];\n      if ([\"Actor\", \"Item\"].includes(app?.document.documentName)) rollData = app.object.getRollData();\n    }\n    return customRolls(chatMessage, speaker, rollData);\n  };\n\n  // Fix for race condition\n  if ($._data($(\"body\").get(0), \"events\")?.click?.find((o) => o.selector === \"a.inline-roll\")) {\n    $(\"body\").off(\"click\", \"a.inline-roll\", origClick);\n    $(\"body\").on(\"click\", \"a.inline-roll\", TextEditor._onClickInlineRoll);\n  }\n}\n\n// Change tooltip showing on alt\n{\n  const fn = KeyboardManager.prototype._onAlt;\n  KeyboardManager.prototype._onAlt = function (event, up, modifiers) {\n    if (!ffd20.tooltip) return;\n    if (!up) ffd20.tooltip.lock.new = true;\n    fn.call(this, event, up, modifiers);\n    if (!up) ffd20.tooltip.lock.new = false;\n  };\n}\n\n// Patch StringTerm\nStringTerm.prototype.evaluate = function (options = {}) {\n  const result = parseRollStringVariable(this.term);\n  if (typeof result === \"string\") {\n    const src = `with (sandbox) { return ${this.term}; }`;\n    try {\n      const evalFn = new Function(\"sandbox\", src);\n      this._total = evalFn(RollFFD20.MATH_PROXY);\n    } catch (err) {\n      err.message = `Failed to evaluate: '${this.term}'\\n${err.message}`;\n      throw err;\n    }\n  } else {\n    this._total = result;\n  }\n};\n\n// Patch NumericTerm\nNumericTerm.prototype.getTooltipData = function () {\n  return {\n    formula: this.expression,\n    total: this.total,\n    flavor: this.flavor,\n  };\n};\n\n// Patch ParentheticalTerm and allowed operators\nParentheticalTerm.CLOSE_REGEXP = new RegExp(`\\\\)${RollTerm.FLAVOR_REGEXP_STRING}?`, \"g\");\nOperatorTerm.REGEXP = /(?:&&|\\|\\||\\*\\*|\\+|-|\\*|\\/|\\\\%|\\||:|\\?)|(?<![a-z])[!=<>]+/g;\nOperatorTerm.OPERATORS.push(\"\\\\%\", \"!\", \"?\", \":\", \"=\", \"<\", \">\", \"==\", \"===\", \"<=\", \">=\", \"??\", \"||\", \"&&\", \"**\");\n\n// Add secondary indexing to compendium collections\n{\n  const origFunc = CompendiumCollection.prototype.getIndex;\n  CompendiumCollection.prototype.getIndex = async function ({ fields } = {}) {\n    const index = await origFunc.call(this, { fields });\n    this.fuzzyIndex = sortArrayByName([...index]);\n    return this.index;\n  };\n}\n\n// Document link attribute stuffing\n{\n  const origFunc = TextEditor._createContentLink;\n  TextEditor._createContentLink = function (match, type, target, name) {\n    const a = origFunc.call(this, match, type, target, name);\n    if (name?.indexOf(\"::\") > -1) {\n      const args = name.split(\"::\"),\n        label = args.pop();\n      if (args.length) {\n        args.forEach((o) => {\n          let [key, value] = o.split(/(?<!\\\\):/);\n          if (!(key && value)) {\n            value = key;\n            key = \"extra\";\n          }\n          switch (key) {\n            case \"icon\":\n              a.firstChild.className = \"fas fa-\" + value;\n              break;\n            case \"class\":\n              a.classList.add(...value.split(\" \"));\n              break;\n            default:\n              a.setAttribute(\"data-\" + key, value);\n          }\n        });\n        a.lastChild.textContent = label;\n      }\n    }\n    return a;\n  };\n}\n\n// Remove warnings for conflicting uneditable system bindings\n{\n  const origFunc = KeybindingsConfig.prototype._detectConflictingActions;\n  KeybindingsConfig.prototype._detectConflictingActions = function (actionId, action, binding) {\n    // Uneditable System bindings are never wrong, they can never conflict with something\n    if (actionId.startsWith(\"ffd20.\") && action.uneditable.includes(binding)) return [];\n\n    return origFunc.call(this, actionId, action, binding);\n  };\n}\n\n{\n  const origFunc = Combatant.prototype.updateResource;\n  Combatant.prototype.updateResource = function () {\n    if (!this.actor) return (this.resource = null);\n    return (this.resource = foundry.utils.getProperty(this.actor.system, this.parent.settings.resource) ?? null);\n  };\n}\n\n// Patch the `fromData` method used by Foundry to allow rolls from builds with a renamed roll class\n// to still be created from JSON for tooltips etc.\n// Introduced in v0.81.1 for Foundry v9.269\n{\n  const origFunc = Roll.fromData;\n  Roll.fromData = function (data, ...args) {\n    if (data.class === \"RollFFD20$1\") data.class = \"RollFFD20\";\n    return origFunc.call(this, data, ...args);\n  };\n}\n\n// Call patch functions\npatchLowLightVision();\n","import { MeasuredTemplateFFD20 } from \"./measure.mjs\";\n\n/**\n * A helper class for building MeasuredTemplates for FFD20 spells and abilities\n *\n * @augments {MeasuredTemplate}\n */\nexport class AbilityTemplate extends MeasuredTemplateFFD20 {\n  /**\n   * A factory method to create an AbilityTemplate instance using provided data\n   *\n   * @param {string} type -             The type of template (\"cone\", \"circle\", \"rect\" or \"ray\")\n   * @param {number} distance -         The distance/size of the template\n   * @param options\n   * @returns {AbilityTemplate|null}     The template object, or null if the data does not produce a template\n   */\n  static fromData(options) {\n    const type = options.type;\n    const distance = options.distance;\n    if (!type) return null;\n    if (!distance) return null;\n    if (!canvas.scene) return null;\n    if (![\"cone\", \"circle\", \"rect\", \"ray\"].includes(type)) return null;\n\n    // Prepare template data\n    const templateData = {\n      t: type,\n      user: game.user.id,\n      distance: distance || 5,\n      direction: 0,\n      x: 0,\n      y: 0,\n      fillColor: options.color ? options.color : game.user.color,\n      texture: options.texture ? options.texture : null,\n      _id: randomID(16),\n    };\n\n    // Additional type-specific data\n    switch (type) {\n      case \"cone\":\n        if (game.settings.get(\"ffd20\", \"measureStyle\") === true) templateData.angle = 90;\n        else templateData.angle = 53.13;\n        break;\n      case \"rect\":\n        templateData.distance = Math.sqrt(Math.pow(distance, 2) + Math.pow(distance, 2));\n        templateData.direction = 45;\n        break;\n      case \"ray\":\n        templateData.width = 5;\n        break;\n      default:\n        break;\n    }\n\n    // Return the template constructed from the item data\n    const cls = CONFIG.MeasuredTemplate.documentClass;\n    const template = new cls(templateData, { parent: canvas.scene });\n    const object = new this(template);\n    return object;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Creates a preview of the spell template\n   *\n   * @param {Event} event   The initiating click event\n   */\n  async drawPreview(event) {\n    const initialLayer = canvas.activeLayer;\n    await this.draw();\n    this.active = true;\n    this.layer.activate();\n    this.layer.preview.addChild(this);\n    return this.activatePreviewListeners(initialLayer);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Activate listeners for the template preview\n   *\n   * @param {CanvasLayer} initialLayer  The initially active CanvasLayer to re-activate after the workflow is complete\n   * @returns {Promise<boolean>} Returns true if placed, or false if cancelled\n   */\n  activatePreviewListeners(initialLayer) {\n    return new Promise((resolve) => {\n      const handlers = {};\n      let moveTime = 0;\n\n      const ffd20Style = game.settings.get(\"ffd20\", \"measureStyle\") === true;\n\n      const _clear = () => {\n        if (this.destroyed) return;\n        this.destroy();\n      };\n\n      // Update placement (mouse-move)\n      handlers.mm = (event) => {\n        event.stopPropagation();\n        const now = Date.now(); // Apply a 20ms throttle\n        if (now - moveTime <= 20) return;\n        const center = event.data.getLocalPosition(this.layer);\n        const pos = canvas.grid.getSnappedPosition(center.x, center.y, 2);\n        this.document.x = pos.x;\n        this.document.y = pos.y;\n        this.refresh();\n        canvas.app.render();\n        moveTime = now;\n      };\n\n      // Cancel the workflow (right-click)\n      handlers.rc = (event, canResolve = true) => {\n        this.layer.preview.removeChildren();\n        canvas.stage.off(\"mousemove\", handlers.mm);\n        canvas.stage.off(\"mousedown\", handlers.lc);\n        canvas.app.view.oncontextmenu = null;\n        canvas.app.view.onwheel = null;\n        // Clear highlight\n        this.active = false;\n        const hl = canvas.grid.getHighlightLayer(this.highlightId);\n        hl.clear();\n        _clear();\n\n        initialLayer.activate();\n        if (canResolve)\n          resolve({\n            result: false,\n          });\n      };\n\n      // Confirm the workflow (left-click)\n      handlers.lc = async (event) => {\n        handlers.rc(event, false);\n\n        // Create the template\n        const result = {\n          result: true,\n          place: async () => {\n            const doc = (\n              await canvas.scene.createEmbeddedDocuments(\"MeasuredTemplate\", [this.document.toObject(false)])\n            )[0];\n            this.document = doc;\n            return doc;\n          },\n          delete: () => {\n            return this.document.delete();\n          },\n        };\n        _clear();\n        resolve(result);\n      };\n\n      // Rotate the template by 3 degree increments (mouse-wheel)\n      handlers.mw = (event) => {\n        if (event.ctrlKey) event.preventDefault(); // Avoid zooming the browser window\n        event.stopPropagation();\n        let delta, snap;\n        if (event.ctrlKey) {\n          if (this.document.t === \"rect\") {\n            delta = Math.sqrt(canvas.dimensions.distance * canvas.dimensions.distance);\n          } else {\n            delta = canvas.dimensions.distance;\n          }\n          this.data.distance += delta * -Math.sign(event.deltaY);\n        } else {\n          if (ffd20Style && this.document.t === \"cone\") {\n            delta = 90;\n            snap = event.shiftKey ? delta : 45;\n          } else {\n            delta = canvas.grid.type > CONST.GRID_TYPES.SQUARE ? 30 : 15;\n            snap = event.shiftKey ? delta : 5;\n          }\n          if (this.document.t === \"rect\") {\n            snap = Math.sqrt(Math.pow(5, 2) + Math.pow(5, 2));\n            this.document.distance += snap * -Math.sign(event.deltaY);\n          } else {\n            this.document.direction += snap * Math.sign(event.deltaY);\n          }\n        }\n        this.refresh();\n      };\n\n      // Activate listeners\n      if (this.controlIcon) this.controlIcon.removeAllListeners();\n      canvas.stage.on(\"mousemove\", handlers.mm);\n      canvas.stage.on(\"mousedown\", handlers.lc);\n      canvas.app.view.oncontextmenu = handlers.rc;\n      canvas.app.view.onwheel = handlers.mw;\n      this.hitArea = new PIXI.Polygon([]);\n    });\n  }\n\n  refresh() {\n    if (!this.template) return;\n    if (!canvas.scene) return;\n\n    super.refresh();\n\n    if (this.active) {\n      this.highlightGrid();\n    }\n\n    return this;\n  }\n}\n","import { createTag, convertDistance } from \"@utils\";\nimport { ChatAttack } from \"./chat-attack.mjs\";\nimport { createCustomChatMessage } from \"@utils/chat.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\nimport { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n// Documentation/type imports\n/** @typedef {import(\"@item/item-ffd20.mjs\").SharedActionData} SharedActionData */\n/** @typedef {import(\"@item/item-ffd20.mjs\").ItemFFD20} ItemFFD20 */\n/** @typedef {import(\"@actor/actor-ffd20.mjs\").ActorFFD20} ActorFFD20 */\n/** @typedef {import(\"@component/action.mjs\").ItemAction} ItemAction */\n\n/**\n * Error states for when an item does not meet the requirements for an attack.\n *\n * @enum {number}\n * @readonly\n */\nexport const ERR_REQUIREMENT = Object.freeze({\n  NO_ACTOR_PERM: 1,\n  DISABLED: 2,\n  INSUFFICIENT_QUANTITY: 3,\n  INSUFFICIENT_CHARGES: 4,\n  MISSING_AMMO: 5,\n  INSUFFICIENT_AMMO: 6,\n});\n\n/**\n *\n */\nexport class ActionUse {\n  /**\n   * The actor this action use is based on.\n   *\n   * @type {ActorFFD20}\n   */\n  actor;\n  /**\n   * The item this action use is based on.\n   *\n   * @type {ItemFFD20}\n   */\n  item;\n  /**\n   * The action this action use is based on.\n   *\n   * @type {ItemAction}\n   */\n  action;\n  /**\n   * The shared data object holding all relevant data for this action use.\n   *\n   * @type {SharedActionData}\n   */\n  shared;\n\n  /**\n   * @param {Partial<SharedActionData>} [shared={}] - The shared context for this action use\n   */\n  constructor(shared = {}) {\n    Object.defineProperties(this, {\n      shared: { value: shared },\n      item: { value: shared.item },\n      action: { value: shared.action },\n      actor: { value: shared.item.parentActor },\n    });\n  }\n\n  /**\n   * @returns {Promise<number>} - 0 when successful, otherwise one of the ERR_REQUIREMENT constants.\n   */\n  checkRequirements() {\n    const actor = this.item.parentActor;\n    if (actor && !actor.isOwner) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermissionAlt\").format(actor.name);\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.NO_ACTOR_PERM;\n    }\n\n    if (this.item.type === \"feat\" && this.item.system.disabled) {\n      const msg = game.i18n.localize(\"FFD20.ErrorFeatDisabled\");\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.DISABLED;\n    }\n\n    const itemQuantity = getProperty(this, \"system.quantity\");\n    if (itemQuantity != null && itemQuantity <= 0) {\n      const msg = game.i18n.localize(\"FFD20.ErrorNoQuantity\");\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.INSUFFICIENT_QUANTITY;\n    }\n\n    if (this.item.isCharged && this.item.charges < this.shared.chargeCost) {\n      const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(this.item.name);\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.INSUFFICIENT_CHARGES;\n    }\n\n    if (this.action.isSelfCharged && this.action.data.uses.self?.value < 1) {\n      const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(`${this.item.name}: ${this.action.name}`);\n      console.warn(msg);\n      ui.notifications.warn(msg);\n      return ERR_REQUIREMENT.INSUFFICIENT_CHARGES;\n    }\n\n    return 0;\n  }\n\n  /**\n   * @returns {object} The roll data object for this attack.\n   */\n  getRollData() {\n    const rollData = duplicate(this.shared.action.getRollData());\n    rollData.d20 = this.shared.dice !== \"1d20\" ? this.shared.dice : \"\";\n\n    return rollData;\n  }\n\n  /**\n   * Creates and renders an attack roll dialog, and returns a result.\n   *\n   * @returns {ItemAttack_Dialog_Result|boolean}\n   */\n  createAttackDialog() {\n    const dialog = new ffd20.applications.AttackDialog(this.shared.action, this.shared.rollData);\n    return dialog.show();\n  }\n\n  /**\n   * Alters roll (and shared) data based on user input during the attack's dialog.\n   *\n   * @param {JQuery | object} form - The attack dialog's jQuery form data or FormData object\n   */\n  alterRollData(form = {}) {\n    let formData;\n    if (form instanceof jQuery) formData = new FormDataExtended(form[0].querySelector(\"form\")).object;\n    else formData = form;\n    if (formData[\"d20\"]) this.shared.rollData.d20 = formData[\"d20\"];\n    const atkBonus = formData[\"attack-bonus\"];\n    if (atkBonus) {\n      this.shared.attackBonus.push(atkBonus);\n    }\n    const dmgBonus = formData[\"damage-bonus\"];\n    if (dmgBonus) {\n      this.shared.damageBonus.push(dmgBonus);\n    }\n    this.shared.rollMode = formData[\"rollMode\"] ?? game.settings.get(\"core\", \"rollMode\");\n\n    // Point-Blank Shot\n    if (formData[\"point-blank-shot\"]) {\n      this.shared.attackBonus.push(`1[${game.i18n.localize(\"FFD20.PointBlankShot\")}]`);\n      this.shared.damageBonus.push(`1[${game.i18n.localize(\"FFD20.PointBlankShot\")}]`);\n      this.shared.pointBlankShot = true;\n    }\n\n    // Many-shot\n    if (this.shared.fullAttack && formData[\"manyshot\"]) {\n      this.shared.manyShot = true;\n    }\n\n    // Rapid Shot\n    if (this.shared.fullAttack && formData[\"rapid-shot\"]) {\n      this.shared.attackBonus.push(`-2[${game.i18n.localize(\"FFD20.RapidShot\")}]`);\n    }\n\n    // Primary attack\n    if (formData[\"primary-attack\"] != null)\n      setProperty(this.shared.rollData, \"action.naturalAttack.primaryAttack\", formData[\"primary-attack\"]);\n\n    // Use measure template\n    if (formData[\"measure-template\"] != null) this.shared.useMeasureTemplate = formData[\"measure-template\"];\n\n    // Set held type\n    setProperty(this.shared.rollData, \"item.held\", formData[\"held\"] ?? \"normal\");\n\n    // Damage multiplier\n    if (formData[\"damage-ability-multiplier\"] != null)\n      this.shared.rollData.action.ability.damageMult = formData[\"damage-ability-multiplier\"];\n\n    // Power Attack\n    if (formData[\"power-attack\"]) {\n      const basePowerAttackBonus = this.shared.rollData.action?.powerAttack?.damageBonus ?? 2;\n      let powerAttackBonus = (1 + Math.floor(this.shared.rollData.attributes.bab.total / 4)) * basePowerAttackBonus;\n\n      // Get multiplier\n      let powerAttackMultiplier = this.shared.rollData.item?.powerAttack?.multiplier;\n      if (!powerAttackMultiplier) {\n        powerAttackMultiplier = 1;\n        if (this.item.system.attackType === \"natural\") {\n          if (this.shared.rollData.action?.naturalAttack.primaryAttack)\n            powerAttackMultiplier = this.shared.rollData.action.ability?.damageMult;\n          else {\n            powerAttackMultiplier = this.shared.rollData.action.naturalAttack?.secondary?.damageMult ?? 0.5;\n          }\n        } else {\n          if (this.shared.rollData?.item?.held === \"2h\") powerAttackMultiplier = 1.5;\n          else if (this.shared.rollData?.item?.held === \"oh\") powerAttackMultiplier = 0.5;\n        }\n      } else {\n        powerAttackMultiplier = parseFloat(powerAttackMultiplier);\n      }\n\n      // Apply multiplier\n      powerAttackBonus = Math.floor(powerAttackBonus * powerAttackMultiplier);\n\n      // Get label\n      const label = [\"rwak\", \"rsak\"].includes(this.action.data.actionType)\n        ? game.i18n.localize(\"FFD20.DeadlyAim\")\n        : game.i18n.localize(\"FFD20.PowerAttack\");\n\n      // Get penalty\n      const powerAttackPenalty = -(1 + Math.floor(getProperty(this.shared.rollData, \"attributes.bab.total\") / 4));\n\n      // Add bonuses\n      this.shared.rollData.powerAttackPenalty = powerAttackPenalty;\n      this.shared.attackBonus.push(`${powerAttackPenalty}[${label}]`);\n      this.shared.powerAttack = true;\n      this.shared.rollData.powerAttackBonus = powerAttackBonus;\n      this.shared.rollData.powerAttackPenalty = powerAttackPenalty;\n    } else {\n      this.shared.rollData.powerAttackBonus = 0;\n      this.shared.rollData.powerAttackPenalty = 0;\n    }\n\n    // Conditionals\n    Object.keys(formData).forEach((f) => {\n      const idx = f.match(/conditional\\.(\\d+)/)?.[1];\n      if (idx && formData[f]) {\n        if (!this.shared.conditionals) this.shared.conditionals = [parseInt(idx)];\n        else this.shared.conditionals.push(parseInt(idx));\n      }\n    });\n\n    // Apply secondary attack penalties\n    if (\n      this.shared.rollData.item.attackType === \"natural\" &&\n      this.shared.rollData.action?.naturalAttack.primaryAttack === false\n    ) {\n      const attackBonus = this.shared.rollData.action.naturalAttack?.secondary?.attackBonus || \"-5\";\n      const damageMult = this.shared.rollData.action.naturalAttack?.secondary?.damageMult ?? 0.5;\n      this.shared.attackBonus.push(`(${attackBonus})[${game.i18n.localize(\"FFD20.SecondaryAttack\")}]`);\n      this.shared.rollData.action.ability.damageMult = damageMult;\n    }\n\n    // CL check enabled\n    this.shared.casterLevelCheck = formData[\"cl-check\"];\n\n    // Concentration enabled\n    this.shared.concentrationCheck = formData[\"concentration\"];\n\n    // Conditional defaults for fast-forwarding\n    if (!this.shared.conditionals && foundry.utils.isEmpty(formData)) {\n      this.shared.conditionals = this.shared.action.data.conditionals?.reduce((arr, con, i) => {\n        if (con.default) arr.push(i);\n        return arr;\n      }, []);\n    }\n  }\n\n  /**\n   * @typedef {object} ItemAttack_AttackData\n   * @property {string} label - The attack's name\n   * @property {number|string|undefined} [attackBonus] - An attack bonus specific to this attack\n   * @property {number|string|undefined} [damageBonus] - A damage bonus specific to this attack\n   * @property {string|null} [ammo] - The ID of the ammo item used\n   */\n  /**\n   * Generates attacks for an item's action.\n   *\n   * @param {boolean} [forceFullAttack=false] - Generate full attack data, e.g. as base data for an {@link AttackDialog}\n   * @returns {Promise<ItemAttack_AttackData[]> | ItemAttack_AttackData[]} The generated default attacks.\n   */\n  generateAttacks(forceFullAttack = false) {\n    const rollData = this.shared.rollData;\n    const action = rollData.action;\n\n    /**\n     * Counter for unnamed or other numbered attacks, to be incremented with each usage.\n     * Starts at 1 to account for the base attack.\n     */\n    let unnamedAttackIndex = 1;\n\n    const attackName = action.attackName || game.i18n.format(\"FFD20.FormulaAttack\", { 0: unnamedAttackIndex });\n    // Use either natural fullAttack state, or force generation of all attacks via override\n    const fullAttack = forceFullAttack || this.shared.fullAttack;\n\n    const allAttacks = fullAttack\n      ? action.attackParts.reduce(\n          (cur, r) => {\n            cur.push({\n              attackBonus: r[0],\n              // Use defined label, or fall back to continuously numbered default attack name\n              label: r[1] || game.i18n.format(\"FFD20.FormulaAttack\", { 0: (unnamedAttackIndex += 1) }),\n            });\n            return cur;\n          },\n          [{ attackBonus: \"\", label: attackName }]\n        )\n      : [{ attackBonus: \"\", label: attackName }];\n\n    // Formulaic extra attacks\n    if (fullAttack) {\n      const exAtkCountFormula = action.formulaicAttacks?.count?.formula,\n        exAtkCount = RollFFD20.safeRoll(exAtkCountFormula, rollData)?.total ?? 0,\n        exAtkBonusFormula = action.formulaicAttacks?.bonus?.formula || \"0\";\n      if (exAtkCount > 0) {\n        try {\n          for (let i = 0; i < exAtkCount; i++) {\n            rollData[\"formulaicAttack\"] = i + 1; // Add and update attack counter\n            const bonus = RollFFD20.safeRoll(exAtkBonusFormula, rollData).total;\n            allAttacks.push({\n              attackBonus: `(${bonus})[${game.i18n.localize(\"FFD20.Iterative\")}]`,\n              // If formulaic attacks have a non-default name, number them with their own counter; otherwise, continue unnamed attack numbering\n              label: action.formulaicAttacks.label\n                ? action.formulaicAttacks.label.format(i + 1)\n                : game.i18n.format(\"FFD20.FormulaAttack\", { 0: (unnamedAttackIndex += 1) }),\n            });\n          }\n        } catch (err) {\n          console.error(err);\n        }\n      }\n    }\n\n    // Set ammo usage\n    if (action.usesAmmo) {\n      const ammoId = this.item.getFlag(\"ffd20\", \"defaultAmmo\");\n      const item = this.item.actor.items.get(ammoId);\n      const quantity = item?.system.quantity ?? 0;\n      const abundant = item?.flags.ffd20?.abundant;\n      for (let a = 0; a < allAttacks.length; a++) {\n        const atk = allAttacks[a];\n        if (abundant || quantity >= a + 1) atk.ammo = ammoId;\n        else atk.ammo = null;\n      }\n    }\n\n    return allAttacks;\n  }\n\n  /**\n   * Subtracts ammo for this attack.\n   *\n   * @param {number} [value=1] - How much ammo to subtract.\n   * @returns {Promise}\n   */\n  async subtractAmmo(value = 1) {\n    if (!this.shared.action.data.usesAmmo) return;\n\n    const ammoUsage = {};\n    for (const atk of this.shared.attacks) {\n      if (atk.ammo) {\n        const item = this.item.actor.items.get(atk.ammo);\n        // Don't remove abundant ammunition\n        if (item.flags?.ffd20?.abundant) continue;\n\n        if (!ammoUsage[atk.ammo]) ammoUsage[atk.ammo] = 1;\n        else ammoUsage[atk.ammo]++;\n      }\n    }\n\n    if (!foundry.utils.isEmpty(ammoUsage)) {\n      const updateData = Object.entries(ammoUsage).reduce((cur, o) => {\n        const currentValue = this.item.actor.items.get(o[0]).system.quantity;\n        const obj = {\n          _id: o[0],\n          \"system.quantity\": currentValue - o[1],\n        };\n\n        cur.push(obj);\n        return cur;\n      }, []);\n\n      return this.item.actor.updateEmbeddedDocuments(\"Item\", updateData);\n    }\n  }\n\n  /**\n   */\n  handleConditionals() {\n    if (this.shared.conditionals) {\n      const conditionalData = {};\n      for (const i of this.shared.conditionals) {\n        const conditional = this.shared.action.data.conditionals[i];\n        const tag = createTag(conditional.name);\n        for (const [i, modifier] of conditional.modifiers.entries()) {\n          // Adds a formula's result to rollData to allow referencing it.\n          // Due to being its own roll, this will only correctly work for static formulae.\n          const conditionalRoll = RollFFD20.safeRoll(modifier.formula, this.shared.rollData);\n          if (conditionalRoll.err) {\n            const msg = game.i18n.format(\"FFD20.WarningConditionalRoll\", { number: i + 1, name: conditional.name });\n            console.warn(msg);\n            ui.notifications.warn(msg);\n            // Skip modifier to avoid multiple errors from one non-evaluating entry\n            continue;\n          } else conditionalData[[tag, i].join(\".\")] = RollFFD20.safeRoll(modifier.formula, this.shared.rollData).total;\n\n          // Create a key string for the formula array\n          const partString = `${modifier.target}.${modifier.subTarget}${\n            modifier.critical ? \".\" + modifier.critical : \"\"\n          }`;\n          // Add formula in simple format\n          if ([\"attack\", \"effect\", \"misc\"].includes(modifier.target)) {\n            const hasFlavor = /\\[.*\\]/.test(modifier.formula);\n            const flavoredFormula = hasFlavor ? modifier.formula : `(${modifier.formula})[${conditional.name}]`;\n            this.shared.conditionalPartsCommon[partString] = [\n              ...(this.shared.conditionalPartsCommon[partString] ?? []),\n              flavoredFormula,\n            ];\n          }\n          // Add formula as array for damage\n          else if (modifier.target === \"damage\") {\n            this.shared.conditionalPartsCommon[partString] = [\n              ...(this.shared.conditionalPartsCommon[partString] ?? []),\n              [modifier.formula, modifier.damageType, false],\n            ];\n          }\n          // Add formula to the size property\n          else if (modifier.target === \"size\") {\n            this.shared.rollData.size += conditionalRoll.total;\n          }\n        }\n      }\n      // Expand data into rollData to enable referencing in formulae\n      this.shared.rollData.conditionals = expandObject(conditionalData, 5);\n\n      // Add specific pre-rolled rollData entries\n      for (const target of [\"effect.cl\", \"effect.dc\", \"misc.charges\"]) {\n        if (this.shared.conditionalPartsCommon[target] != null) {\n          const formula = this.shared.conditionalPartsCommon[target].join(\"+\");\n          const roll = RollFFD20.safeRoll(formula, this.shared.rollData, [target, formula]).total;\n          switch (target) {\n            case \"effect.cl\":\n              this.shared.rollData.cl += roll;\n              break;\n            case \"effect.dc\":\n              this.shared.rollData.dcBonus = roll;\n              break;\n            case \"misc.charges\":\n              this.shared.rollData.chargeCostBonus = roll;\n              break;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Checks all requirements to make the attack. This is after the attack dialog's data has been parsed.\n   *\n   * @returns {Promise<number> | number} 0 if successful, otherwise one of the ERR_REQUIREMENT constants.\n   */\n  checkAttackRequirements() {\n    // Enforce zero charge cost on cantrips/orisons, but make sure they have at least 1 charge\n    if (\n      this.item.type === \"spell\" &&\n      !this.item.useSpellPoints() &&\n      this.shared.rollData.item?.level === 0 &&\n      this.shared.rollData.item?.preparation?.preparedAmount > 0\n    ) {\n      this.shared.rollData.chargeCost = 0;\n      return 0;\n    }\n\n    // Determine charge cost\n    let cost = 0;\n    if (this.shared.action.isCharged) {\n      cost = this.shared.action.getChargeCost({ rollData: this.shared.rollData });\n      let uses = this.item.charges;\n      if (this.item.type === \"spell\") {\n        if (this.item.useSpellPoints()) {\n          uses = this.item.getSpellUses();\n        }\n      }\n      // Add charge cost from conditional modifiers\n      cost += this.shared.rollData[\"chargeCostBonus\"] ?? 0;\n\n      // Cancel usage on insufficient charges\n      if (cost > uses) {\n        const msg = game.i18n.localize(\"FFD20.ErrorInsufficientCharges\").format(this.item.name);\n        console.warn(msg);\n        ui.notifications.warn(msg);\n        return ERR_REQUIREMENT.INSUFFICIENT_CHARGES;\n      }\n    }\n\n    // Save chargeCost as rollData entry for following formulae\n    this.shared.rollData.chargeCost = cost;\n\n    return 0;\n  }\n\n  /**\n   * Generates ChatAttack entries based off the attack type.\n   */\n  async generateChatAttacks() {\n    // Normal attack(s)\n    if (this.shared.action.hasAttack) await this.addAttacks();\n    // Damage only\n    else if (this.shared.action.hasDamage) await this.addDamage();\n    // Effect notes only\n    else await this.addEffectNotes();\n\n    // Add attack cards\n    this.shared.attacks.forEach((attack) => {\n      if (!attack.ammo) return;\n      const atk = attack.chatAttack;\n      if (atk) atk.setAmmo(attack.ammo);\n    });\n\n    // Add save info\n    this.shared.save = this.shared.action.data.save.type;\n    this.shared.saveDC = this.shared.action.getDC(this.shared.rollData);\n  }\n\n  /**\n   * Determines conditional parts used in a specific attack.\n   *\n   * @param {object} atk - The attack used.\n   * @param {number} [index=0] - The index of the attack, in order of enabled attacks.\n   * @returns {object} The conditional parts used.\n   */\n  _getConditionalParts(atk, { index = 0 }) {\n    const result = {};\n\n    const conditionalTemplates = {\n      \"attack.normal\": \"attack.;id;.normal\",\n      \"attack.crit\": \"attack.;id;.crit\",\n      \"damage.normal\": \"damage.;id;.normal\",\n      \"damage.crit\": \"damage.;id;.crit\",\n      \"damage.nonCrit\": \"damage.;id;.nonCrit\",\n    };\n    const addPart = (id) => {\n      for (const [templateKey, templateStr] of Object.entries(conditionalTemplates)) {\n        if (!result[templateKey]) result[templateKey] = [];\n\n        const parsedStr = templateStr.replace(\";id;\", id);\n        result[templateKey].push(...(this.shared.conditionalPartsCommon[parsedStr] ?? []));\n      }\n    };\n\n    addPart(`attack_${index}`);\n    addPart(\"allAttack\");\n    addPart(\"allDamage\");\n\n    if (atk.id === \"rapid-shot\") {\n      addPart(\"rapidShotAttack\");\n      addPart(\"rapidShotDamage\");\n    } else if (atk.id === \"haste-attack\") {\n      addPart(\"hasteAttack\");\n      addPart(\"hasteDamage\");\n    }\n\n    return result;\n  }\n\n  /**\n   * Adds ChatAttack entries to an attack's shared context.\n   */\n  async addAttacks() {\n    for (let a = 0; a < this.shared.attacks.length; a++) {\n      const atk = this.shared.attacks[a];\n\n      // Combine conditional modifiers for attack and damage\n      const conditionalParts = this._getConditionalParts(atk, { index: a });\n\n      this.shared.rollData.attackCount = a;\n\n      // Create attack object\n      const attack = new ChatAttack(this.shared.action, {\n        label: atk.label,\n        rollData: this.shared.rollData,\n        targets: game.user.targets,\n      });\n\n      if (atk.id !== \"manyshot\") {\n        // Add attack roll\n        await attack.addAttack({\n          extraParts: duplicate(this.shared.attackBonus).concat([atk.attackBonus]),\n          conditionalParts,\n        });\n      }\n\n      // Add damage\n      if (this.shared.action.hasDamage) {\n        const extraParts = duplicate(this.shared.damageBonus);\n        const nonCritParts = [];\n        const critParts = [];\n\n        // Add power attack bonus\n        if (this.shared.rollData.powerAttackBonus > 0) {\n          // Get label\n          const label = [\"rwak\", \"rsak\"].includes(this.shared.action.data.actionType)\n            ? game.i18n.localize(\"FFD20.DeadlyAim\")\n            : game.i18n.localize(\"FFD20.PowerAttack\");\n\n          const powerAttackBonus = this.shared.rollData.powerAttackBonus;\n          const powerAttackCritBonus = powerAttackBonus * (this.shared.rollData.item?.powerAttack?.critMultiplier ?? 1);\n          nonCritParts.push(`${powerAttackBonus}[${label}]`);\n          critParts.push(`${powerAttackCritBonus}[${label}]`);\n        }\n\n        // Add damage\n        let flavor = null;\n        if (atk.id === \"manyshot\") flavor = game.i18n.localize(\"FFD20.Manyshot\");\n        await attack.addDamage({\n          flavor,\n          extraParts: [...extraParts, ...nonCritParts],\n          critical: false,\n          conditionalParts,\n        });\n\n        // Add critical hit damage\n        if (attack.hasCritConfirm) {\n          await attack.addDamage({ extraParts: [...extraParts, ...critParts], critical: true, conditionalParts });\n        }\n      }\n\n      // Add attack notes\n      if (a === 0) attack.addAttackNotes();\n\n      // Add effect notes\n      if (atk.id !== \"manyshot\") {\n        attack.addEffectNotes();\n      }\n\n      // Add to list\n      this.shared.chatAttacks.push(attack);\n\n      // Add a reference to the attack that created this chat attack\n      atk.chatAttack = attack;\n    }\n\n    // Cleanup rollData\n    delete this.shared.rollData.attackCount;\n  }\n\n  /**\n   * Adds a ChatAttack entry for damage to an attack's shared context.\n   */\n  async addDamage() {\n    // Set conditional modifiers\n    this.shared.conditionalParts = {\n      \"damage.normal\": this.shared.conditionalPartsCommon[\"damage.allDamage.normal\"] ?? [],\n    };\n\n    const attack = new ChatAttack(this.shared.action, {\n      rollData: this.shared.rollData,\n      primaryAttack: this.shared.primaryAttack,\n    });\n    // Add damage\n    await attack.addDamage({\n      extraParts: duplicate(this.shared.damageBonus),\n      critical: false,\n      conditionalParts: this.shared.conditionalParts,\n    });\n\n    // Add effect notes\n    attack.addEffectNotes();\n\n    // Add to list\n    this.shared.chatAttacks.push(attack);\n  }\n\n  /**\n   * Adds a ChatAttack entry for effect notes to an attack's shared context.\n   */\n  addEffectNotes() {\n    const attack = new ChatAttack(this.shared.action, {\n      rollData: this.shared.rollData,\n      primaryAttack: this.shared.primaryAttack,\n    });\n\n    // Add effect notes\n    attack.addEffectNotes();\n\n    // Add to list\n    this.shared.chatAttacks.push(attack);\n  }\n\n  /**\n   * @typedef {object} Attack_MeasureTemplateResult\n   * @property {boolean} result - Whether an area was selected.\n   * @property {Function} [place] - Function to place the template, if an area was selected.\n   * @property {Function} [delete] - Function to delete the template, if it has been placed.\n   */\n  /**\n   * Prompts the user for an area, based on the attack's measure template.\n   *\n   * @returns {Promise.<Attack_MeasureTemplateResult>} Whether an area was selected.\n   */\n  async promptMeasureTemplate() {\n    // Determine size\n    let dist = this.shared.action.data.measureTemplate.size;\n    if (typeof dist === \"string\") {\n      dist = RollFFD20.safeRoll(this.shared.action.data.measureTemplate.size, this.shared.rollData).total;\n    }\n    dist = convertDistance(dist)[0];\n\n    // Create data object\n    const templateOptions = {\n      type: this.shared.action.data.measureTemplate.type,\n      distance: dist,\n    };\n    if (this.shared.action.data.measureTemplate.overrideColor) {\n      templateOptions.color = this.shared.action.data.measureTemplate.customColor;\n    }\n    if (this.shared.action.data.measureTemplate.overrideTexture) {\n      templateOptions.texture = this.shared.action.data.measureTemplate.customTexture;\n    }\n\n    // Create template\n    this.shared.template = null;\n    const template = ffd20.canvas.AbilityTemplate.fromData(templateOptions);\n    let result;\n    if (template) {\n      const sheetRendered = this.item.parent?.sheet?._element != null;\n      if (sheetRendered) this.item.parent.sheet.minimize();\n      result = await template.drawPreview(this.shared.event);\n      if (!result.result) {\n        if (sheetRendered) this.item.parent.sheet.maximize();\n        return result;\n      }\n    }\n\n    this.shared.template = await result.place();\n    return result;\n  }\n\n  /**\n   * Handles Dice So Nice integration.\n   */\n  async handleDiceSoNice() {\n    if (game.dice3d != null && game.dice3d.isEnabled()) {\n      // Use try to make sure a chat card is rendered even if DsN fails\n      try {\n        // Define common visibility options for whole attack\n        const chatData = {};\n        ChatMessage.applyRollMode(chatData, this.shared.rollMode);\n\n        const mergeRolls = game.settings.get(\"dice-so-nice\", \"enabledSimultaneousRolls\");\n        const skipRolls = game.settings.get(\"dice-so-nice\", \"immediatelyDisplayChatMessages\");\n\n        /**\n         * Visually roll dice\n         *\n         * @async\n         * @param {PoolTerm[]} pools - An array of PoolTerms to be rolled together\n         * @returns {Promise} A Promise that is resolved when all rolls have been displayed\n         */\n        const showRoll = async (pools) => {\n          const whisper = chatData.whisper?.length ? chatData.whisper : undefined; // DSN does not like empty array for whisper\n          if (mergeRolls) {\n            return Promise.all(\n              pools.map((pool) => game.dice3d.showForRoll(pool, game.user, true, whisper, chatData.blind))\n            );\n          } else {\n            for (const pool of pools) {\n              await game.dice3d.showForRoll(pool, game.user, true, whisper, chatData.blind);\n            }\n          }\n        };\n\n        /** @type {PoolTerm[]} */\n        const pools = [];\n\n        for (const atk of this.shared.chatAttacks) {\n          // Create PoolTerm for attack and damage rolls\n          const attackPool = new PoolTerm();\n          if (atk.attack.roll) attackPool.rolls.push(atk.attack.roll);\n          attackPool.rolls.push(...(atk.damage?.rolls?.map((dmgRoll) => dmgRoll.roll) ?? []));\n\n          // Create PoolTerm for crit confirmation and crit damage rolls\n          const critPool = new PoolTerm();\n          if (atk.hasCritConfirm) critPool.rolls.push(atk.critConfirm.roll);\n          critPool.rolls.push(...(atk.critDamage?.rolls?.map((dmgRoll) => dmgRoll.roll) ?? []));\n\n          // Add non-empty pools to the array of rolls to be displayed\n          if (attackPool.rolls.length) pools.push(attackPool);\n          if (critPool.rolls.length) pools.push(critPool);\n        }\n\n        if (pools.length) {\n          // Chat card is to be shown immediately\n          if (skipRolls) showRoll(pools);\n          // Wait for rolls to finish before showing the chat card\n          else await showRoll(pools);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }\n\n  /**\n   * Adds an attack's chat card data to the shared object.\n   */\n  getMessageData() {\n    if (this.shared.chatAttacks.length === 0) return;\n\n    // Create chat template data\n    this.shared.templateData = {\n      action: this.shared.action,\n      name: this.item.name,\n      type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n      rollMode: this.shared.rollMode,\n      attacks: this.shared.chatAttacks.map((o) => o.finalize()),\n    };\n\n    // Set chat data\n    this.shared.chatData = {\n      speaker: ChatMessage.getSpeaker({ actor: this.item.parent }),\n      rollMode: this.shared.rollMode,\n    };\n\n    // Set attack sound\n    if (this.shared.action.data.soundEffect) this.shared.chatData.sound = this.shared.action.data.soundEffect;\n    // Set dice sound if neither attack sound nor Dice so Nice are available\n    else if (game.dice3d == null || !game.dice3d.isEnabled()) this.shared.chatData.sound = CONFIG.sounds.dice;\n\n    // Get extra text\n    const props = [];\n    let extraText = \"\";\n    if (this.shared.templateData.attacks.length > 0) extraText = this.shared.templateData.attacks[0].attackNotesHTML;\n\n    const itemChatData = this.item.getChatData({ rollData: this.shared.rollData }, { actionId: this.shared.action.id });\n\n    // Get properties\n    const properties = [...itemChatData.properties, ...this.addGenericPropertyLabels()];\n    if (properties.length > 0) props.push({ header: game.i18n.localize(\"FFD20.InfoShort\"), value: properties });\n\n    // Get combat properties\n    if (game.combat) {\n      const combatProps = this.addCombatPropertyLabels();\n\n      if (combatProps.length > 0) {\n        props.push({ header: game.i18n.localize(\"FFD20.CombatInfo_Header\"), value: combatProps });\n      }\n    }\n\n    // Add CL notes\n    if (this.item.type === \"spell\" && this.item.parent) {\n      const clNotes = this.item.parent.getContextNotesParsed(`spell.cl.${this.item.system.spellbook}`);\n\n      if (clNotes.length) {\n        props.push({\n          header: game.i18n.localize(\"FFD20.CLNotes\"),\n          value: clNotes,\n        });\n      }\n    }\n\n    // Parse template data\n    const token =\n      this.item.parentActor?.token ??\n      canvas.tokens?.placeables.find((t) => t.actor && t.actor.id === this.item.parentActor?.id);\n    const identified = Boolean(this.shared.rollData.item?.identified ?? true);\n    const name = identified\n      ? `${this.shared.rollData.item.identifiedName || this.item.name} (${this.shared.action.name})`\n      : this.shared.rollData.item.unidentified?.name || this.item.name;\n    this.shared.templateData = mergeObject(\n      this.shared.templateData,\n      {\n        tokenUuid: token ? token.document?.uuid ?? token.uuid : null,\n        actionId: this.shared.action?.id,\n        extraText: extraText,\n        identified: identified,\n        name: name,\n        description: identified ? this.item.fullDescription : itemChatData.unidentifiedDescription,\n        actionDescription: itemChatData.actionDescription,\n        hasExtraText: extraText.length > 0,\n        properties: props,\n        hasProperties: props.length > 0,\n        item: this.item.toObject(),\n        actor: this.item.parentActor,\n        hasSave: this.shared.action.hasSave,\n        rollData: this.shared.rollData,\n        save: {\n          dc: this.shared.saveDC,\n          type: this.shared.save,\n          label: game.i18n.format(\"FFD20.SavingThrowButtonLabel\", {\n            0: CONFIG.FFD20.savingThrows[this.shared.save],\n            1: this.shared.saveDC.toString(),\n          }),\n          gmSensitiveLabel: game.i18n.format(\"FFD20.SavingThrowButtonLabelGMSensitive\", {\n            save: CONFIG.FFD20.savingThrows[this.shared.save],\n          }),\n        },\n      },\n      { inplace: false }\n    );\n\n    // Add range info\n    {\n      const range = this.shared.action.getRange({ type: \"max\", rollData: this.shared.rollData });\n      if (range != null) {\n        this.shared.templateData.range = range;\n        let usystem = game.settings.get(\"ffd20\", \"distanceUnits\"); // override\n        if (usystem === \"default\") usystem = game.settings.get(\"ffd20\", \"units\");\n        this.shared.templateData.rangeLabel = usystem === \"metric\" ? `${range} m` : `${range} ft.`;\n\n        const rangeUnits = this.shared.action.data.range.units;\n        if ([\"melee\", \"touch\", \"reach\", \"close\", \"medium\", \"long\"].includes(rangeUnits)) {\n          this.shared.templateData.rangeLabel = CONFIG.FFD20.distanceUnits[rangeUnits];\n        }\n      }\n    }\n\n    // Add spell info\n    if (this.item.type === \"spell\" && this.item.parent != null) {\n      // Spell failure\n      if (this.item.parent.spellFailure > 0 && this.item.system.components.somatic) {\n        const spellbook = getProperty(\n          this.item.parentActor,\n          `system.attributes.spells.spellbooks.${this.item.system.spellbook}`\n        );\n        if (spellbook && spellbook.arcaneSpellFailure) {\n          const roll = RollFFD20.safeRoll(\"1d100\");\n          this.shared.templateData.spellFailure = roll.total;\n          this.shared.templateData.spellFailureRoll = roll;\n          this.shared.templateData.spellFailureSuccess =\n            this.shared.templateData.spellFailure > this.item.parentActor.spellFailure;\n        }\n      }\n      // Caster Level Check\n      this.shared.templateData.casterLevelCheck = this.shared.casterLevelCheck;\n      // Concentration check\n      this.shared.templateData.concentrationCheck = this.shared.concentrationCheck;\n    }\n\n    // Generate metadata\n    const metadata = this.generateChatMetadata();\n\n    // Get target info\n    if (!game.settings.get(\"ffd20\", \"disableAttackCardTargets\")) {\n      const targets = metadata.targets?.length\n        ? metadata.targets.map((o) => canvas.tokens.get(o)).filter((o) => o != null)\n        : [];\n      if (targets.length) {\n        this.shared.templateData.targets = targets.map((o) => {\n          return {\n            actorData: o.actor?.toObject(false),\n            tokenData: o.document?.toObject(false),\n            uuid: o.document.uuid,\n          };\n        });\n      }\n    }\n\n    this.shared.chatData[\"flags.ffd20.metadata\"] = metadata;\n    this.shared.chatData[\"flags.core.canPopout\"] = true;\n    if (!identified)\n      this.shared.chatData[\"flags.ffd20.identifiedInfo\"] = {\n        identified,\n        name: this.item.name,\n        description: itemChatData.identifiedDescription,\n        actionName: this.shared.action.name,\n        actionDescription: itemChatData.actionDescription,\n      };\n  }\n\n  /**\n   * Adds generic property labels to an attack's chat card.\n   *\n   * @returns {string[]} The resulting property labels.\n   */\n  addGenericPropertyLabels() {\n    const properties = [];\n\n    // Add actual cost\n    const cost = this.shared.rollData.chargeCost;\n    if (cost && !this.item.system.atWill) {\n      if (this.item.type === \"spell\" && this.item.useSpellPoints()) {\n        properties.push(`${game.i18n.localize(\"FFD20.SpellPointsCost\")}: ${cost}`);\n      } else {\n        properties.push(`${game.i18n.localize(\"FFD20.ChargeCost\")}: ${cost}`);\n      }\n    }\n\n    // Add info for broken state\n    if (this.item.system.broken) {\n      properties.push(game.i18n.localize(\"FFD20.Broken\"));\n    }\n\n    // Nonlethal\n    if (this.item.system.nonlethal) properties.push(game.i18n.localize(\"FFD20.Nonlethal\"));\n\n    // Add info for Power Attack to melee, Deadly Aim to ranged attacks\n    if (this.shared.powerAttack) {\n      if (this.action.data.actionType === \"rwak\") properties.push(game.i18n.localize(\"FFD20.DeadlyAim\"));\n      if (this.action.data.actionType === \"mwak\") properties.push(game.i18n.localize(\"FFD20.PowerAttack\"));\n    }\n\n    // Add info for Point-Blank shot\n    if (this.shared.pointBlankShot) properties.push(game.i18n.localize(\"FFD20.PointBlankShot\"));\n\n    // Add info for Rapid Shot\n    if (this.shared.attacks.find((o) => o.id === \"rapid-shot\")) properties.push(game.i18n.localize(\"FFD20.RapidShot\"));\n\n    if (this.shared.manyShot) properties.push(game.i18n.localize(\"FFD20.Manyshot\"));\n\n    // Add Armor Check Penalty's application to attack rolls info\n    if (this.item.hasAttack && this.shared.rollData.attributes.acp.attackPenalty > 0)\n      properties.push(game.i18n.localize(\"FFD20.ArmorCheckPenalty\"));\n\n    // Add conditionals info\n    if (this.shared.conditionals?.length) {\n      this.shared.conditionals.forEach((c) => {\n        properties.push(this.shared.action.data.conditionals[c].name);\n      });\n    }\n\n    // Add Wound Thresholds info\n    if (this.shared.rollData.attributes.woundThresholds.level > 0)\n      properties.push(\n        game.i18n.localize(CONFIG.FFD20.woundThresholdConditions[this.shared.rollData.attributes.woundThresholds.level])\n      );\n\n    return properties;\n  }\n\n  /**\n   * Adds combat property labels to an attack's chat card.\n   *\n   * @returns {string[]} The resulting property labels.\n   */\n  addCombatPropertyLabels() {\n    const properties = [];\n\n    // Add round info\n    properties.push(game.i18n.localize(\"FFD20.CombatInfo_Round\").format(game.combat.round));\n\n    return properties;\n  }\n\n  /**\n   * Generates metadata for this attack for the chat card to store.\n   *\n   * @returns {object} The resulting metadata object.\n   */\n  generateChatMetadata() {\n    const metadata = {};\n\n    metadata.item = this.item.id;\n    metadata.template = this.shared.template ? this.shared.template.id : null;\n    metadata.rolls = {\n      attacks: {},\n    };\n\n    // Get template for later variables\n    const template = canvas.scene ? canvas.templates.get(metadata.template) : null;\n\n    // Add targets\n    if (template != null) {\n      metadata.targets = template.getTokensWithin().map((o) => o.id);\n    } else {\n      metadata.targets = Array.from(game.user.targets).map((o) => o.id);\n    }\n\n    // Add attack rolls\n    for (let a = 0; a < this.shared.chatAttacks.length; a++) {\n      const atk = this.shared.chatAttacks[a];\n      const attackRolls = { attack: null, damage: {}, critConfirm: null, critDamage: {} };\n      // Add attack roll\n      if (atk.attack.roll) attackRolls.attack = atk.attack.roll.toJSON();\n      // Add damage rolls\n      if (atk.damage.rolls.length) {\n        for (let b = 0; b < atk.damage.rolls.length; b++) {\n          const r = atk.damage.rolls[b];\n          attackRolls.damage[b] = {\n            damageType: r.damageType,\n            roll: r.roll.toJSON(),\n          };\n        }\n      }\n      // Add critical confirmation roll\n      if (atk.critConfirm.roll) attackRolls.critConfirm = atk.critConfirm.roll.toJSON();\n      // Add critical damage rolls\n      if (atk.critDamage.rolls.length) {\n        for (let b = 0; b < atk.critDamage.rolls.length; b++) {\n          const r = atk.critDamage.rolls[b];\n          attackRolls.critDamage[b] = {\n            damageType: r.damageType,\n            roll: r.roll.toJSON(),\n          };\n        }\n      }\n\n      metadata.rolls.attacks[a] = attackRolls;\n    }\n\n    // Add miscellaneous metadata\n    if (this.shared.saveDC) metadata.save = { dc: this.shared.saveDC, type: this.shared.save };\n    if (this.item.type === \"spell\") metadata.spell = { cl: this.shared.rollData.cl, sl: this.shared.rollData.sl };\n\n    return metadata;\n  }\n\n  /**\n   * Executes the item's script calls.\n   *\n   * @returns {object} The resulting data from the script calls.\n   */\n  async executeScriptCalls() {\n    // Execute script call\n    this.shared.scriptData = await this.item.executeScriptCalls(\"use\", {\n      attackData: this.shared,\n    });\n  }\n\n  /**\n   * Posts the attack's chat card.\n   */\n  async postMessage() {\n    // Old hook data + callAll\n    const hookData = {\n      ev: this.shared.event,\n      skipDialog: this.shared.skipDialog,\n      chatData: this.shared.chatData,\n      templateData: this.shared.templateData,\n      shared: this.shared,\n    };\n    callOldNamespaceHookAll(\"itemUse\", \"ffd20PreDisplayActionUse\", this.item, \"postAttack\", hookData);\n\n    this.shared.chatTemplate ||= \"systems/ffd20/templates/chat/attack-roll.hbs\";\n    this.shared.templateData.damageTypes = ffd20.registry.damageTypes.toRecord();\n    if (Hooks.call(\"ffd20PreDisplayActionUse\", this) === false) return;\n\n    // Show chat message\n    let result;\n    if (this.shared.chatAttacks.length > 0) {\n      if (this.shared.chatMessage && this.shared.scriptData.hideChat !== true)\n        result = await createCustomChatMessage(\n          this.shared.chatTemplate,\n          this.shared.templateData,\n          this.shared.chatData\n        );\n      else result = this.shared;\n    } else {\n      if (this.shared.chatMessage && this.shared.scriptData.hideChat !== true) result = this.item.roll();\n      else result = { descriptionOnly: true };\n    }\n\n    return result;\n  }\n}\n\n/**\n * @typedef {object} ItemAttack_Dialog_Result\n * @property {boolean} fullAttack - Whether it's a full attack (true) or a single attack (false)\n * @property {JQuery} html - The html containing user input and selections.\n */\n","import { ActionUse } from \"../action-use/action-use.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\n\nexport class AttackDialog extends Application {\n  constructor(object, rollData = null, options = {}) {\n    super(options);\n\n    this.object = object;\n\n    this.rollData = rollData ? rollData : this.object.getRollData();\n\n    this.initAmmoUsage();\n    this.initAttacks();\n\n    this.base = {\n      cl: this.rollData.cl ?? 0,\n      sl: this.rollData.sl ?? 0,\n    };\n    this.flags = {\n      \"primary-attack\": this.object.data.naturalAttack.primaryAttack === true,\n      \"cl-check\": this.object.clCheck === true,\n      \"measure-template\": true,\n    };\n    this.attributes = {\n      d20: this.rollData.d20 ?? \"\",\n      \"attack-bonus\": \"\",\n      \"damage-bonus\": \"\",\n      \"cl-offset\": \"0\",\n      \"sl-offset\": \"0\",\n      rollMode: game.settings.get(\"core\", \"rollMode\"),\n      \"damage-ability-multiplier\": this.rollData.action?.ability?.damageMult ?? 1,\n      held: this.rollData.item?.held ?? \"normal\",\n    };\n    this.conditionals = {};\n    for (const [idx, cData] of Object.entries(this.object.conditionals ?? {})) {\n      this.conditionals[`conditional.${idx}`] = cData.default === true;\n    }\n\n    // Callback for AttackDialog.show()\n    this._callbacks = {\n      resolve: null,\n      reject: null,\n    };\n  }\n\n  get title() {\n    return `Use: ${this.object.name}`;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      template: \"systems/ffd20/templates/apps/attack-roll-dialog.hbs\",\n      classes: [\"ffd20\", \"attack-dialog\"],\n      width: 440,\n      height: \"auto\",\n      closeOnSubmit: true,\n      sheetConfig: false,\n      submitOnChange: false,\n      submitOnClose: false,\n    });\n  }\n\n  static get defaultAttack() {\n    return {\n      label: \"\",\n      attackBonus: 0,\n      attackBonusTotal: 0,\n      ammo: null,\n    };\n  }\n\n  getData() {\n    return {\n      data: this.rollData,\n      item: this.object.data,\n      config: CONFIG.FFD20,\n      rollMode: game.settings.get(\"core\", \"rollMode\"),\n      rollModes: CONFIG.Dice.rollModes,\n      hasAttack: this.object.hasAttack,\n      hasDamage: this.object.hasDamage,\n      hasDamageAbility: this.object.data.ability?.damage ?? \"\" !== \"\",\n      isNaturalAttack: this.object.item.system.attackType === \"natural\",\n      isWeaponAttack: this.object.item.system.attackType === \"weapon\",\n      isMeleeWeaponAttackAction: this.object.data.actionType === \"mwak\",\n      isRangedWeaponAttackAction: this.object.data.actionType === \"rwak\",\n      isAttack: this.object.item.type === \"attack\",\n      isWeapon: this.object.item.type === \"weapon\",\n      isSpell: this.object.item.type === \"spell\",\n      isFeat: this.object.item.type === \"feat\",\n      hasTemplate: this.object.hasTemplate,\n      attacks: this.attacks,\n      flags: this.flags,\n      attributes: this.attributes,\n      conditionals: this.conditionals,\n      usesAmmo: this.object.data.usesAmmo,\n      ammo: this.getAmmo(),\n    };\n  }\n\n  getAmmo() {\n    const actor = this.object.actor;\n    const ammo = actor.items.filter(this._filterAmmo.bind(this));\n\n    return ammo.map((o) => {\n      return {\n        data: o.toObject(),\n        isDefault: this.object.item.getFlag(\"ffd20\", \"defaultAmmo\") === o.id,\n      };\n    });\n  }\n\n  _filterAmmo(item) {\n    if (!(item.type === \"loot\" && item.system.subType === \"ammo\")) return false;\n    if (item.system.quantity <= 0) return false;\n\n    const weaponAmmoType = this.object.data.ammoType;\n    const ammoType = item.extraType;\n    if (!ammoType) return true;\n    if (weaponAmmoType === ammoType) return true;\n  }\n\n  activateListeners(html) {\n    // Form changing\n    html.find(`.flags input[type=\"checkbox\"]`).on(\"change\", this._onToggleFlag.bind(this));\n    html.find(`input.attribute`).on(\"change\", this._onChangeAttribute.bind(this));\n    html.find(`input[type=\"checkbox\"][name=\"concentration\"]`).on(\"change\", this._onToggleFlag.bind(this));\n    html.find(`input[type=\"checkbox\"][name=\"cl-check\"]`).on(\"change\", this._onToggleFlag.bind(this));\n    html.find(`input[type=\"checkbox\"][name=\"measure-template\"]`).on(\"change\", this._onToggleFlag.bind(this));\n    html.find(`select`).on(\"change\", this._onSelectChange.bind(this));\n    html.find(`.conditionals input[type=\"checkbox\"]`).on(\"change\", this._onToggleConditional.bind(this));\n\n    // Dropdown menu\n    html.find(\".ammo-select\").on(\"click\", this._onAmmoSelectClick.bind(this));\n    html.find(\".ammo-select .ammo-item .controls a\").on(\"click\", this._onAmmoControlClick.bind(this));\n    html.find(\".ammo-select .ammo-item\").on(\"click\", this._onAmmoClick.bind(this));\n    html.on(\"click\", this._unfocusElements.bind(this));\n\n    // Button hover\n    html.find(`button[name=\"attack_single\"]`).on(\"mouseenter\", this._hideExtraAttacks.bind(this));\n    html.find(`button[name=\"attack_single\"]`).on(\"mouseleave\", this._showExtraAttacks.bind(this));\n\n    // Button press\n    html.find(`button[name=\"attack_single\"]`).on(\"click\", this._onAttackSingle.bind(this));\n    html.find(`button[name=\"attack_full\"]`).on(\"click\", this._onAttackFull.bind(this));\n  }\n\n  _onSelectChange(event) {\n    event.preventDefault();\n\n    const elem = event.currentTarget;\n    this.attributes[elem.name] = elem.options[elem.selectedIndex].value;\n    this.render();\n  }\n\n  _hideExtraAttacks(event) {\n    const elems = this.element.find(\".attacks .attack\").filter((index, elem) => parseInt(elem.dataset.index) > 0);\n    elems.addClass(\"disabled\");\n  }\n\n  _showExtraAttacks(event) {\n    this.element.find(\".attacks .attack\").removeClass(\"disabled\");\n  }\n\n  _onToggleFlag(event) {\n    event.preventDefault();\n\n    const elem = event.currentTarget;\n    this.flags[elem.name] = elem.checked === true;\n\n    // Add or remove haste, rapid-shot or manyshot attack\n    if ([\"haste-attack\", \"rapid-shot\", \"manyshot\"].includes(elem.name)) {\n      if (elem.checked) {\n        const translationString = {\n          \"haste-attack\": \"FFD20.Haste\",\n          \"rapid-shot\": \"FFD20.RapidShot\",\n          manyshot: \"FFD20.Manyshot\",\n        };\n\n        // Correlate manyshot with the first attack, add the others at the end\n        const place = elem.name === \"manyshot\" ? 1 : this.attacks.length;\n\n        this.attacks.splice(\n          place,\n          0,\n          mergeObject(this.constructor.defaultAttack, {\n            id: elem.name,\n            label: game.i18n.localize(translationString[elem.name]),\n            attackBonusTotal: \"\", // Don't show anything in the mod field, as the data is not updated live\n          })\n        );\n        this.setAttackAmmo(place, this.object.item.getFlag(\"ffd20\", \"defaultAmmo\"));\n      } else {\n        this.attacks = this.attacks.filter((o) => o.id !== elem.name);\n      }\n    }\n\n    this.render();\n  }\n\n  _onToggleConditional(event) {\n    event.preventDefault();\n\n    const elem = event.currentTarget;\n    this.conditionals[elem.name] = elem.checked === true;\n    this.render();\n  }\n\n  _onAmmoSelectClick(event) {\n    event.preventDefault();\n\n    const elem = event.currentTarget;\n    const listElem = elem.querySelector(\"ul\");\n\n    // Filter to NOT act when clicking on the list child element\n    if (!event.target.closest(\"ul\")) {\n      // Set classes for CSS\n      listElem.classList.toggle(\"open\");\n      const isOpen = listElem.classList.contains(\"open\");\n      if (isOpen) elem.classList.add(\"focus\");\n      else elem.classList.remove(\"focus\");\n    }\n  }\n\n  _onAmmoClick(event) {\n    const elem = event.target;\n    // Don't do anything if this click was actually on its controls\n    if (elem.closest(\".controls\") && !elem.classList.contains(\"controls\")) return;\n\n    event.preventDefault();\n    const ammoId = elem.closest(\".ammo-item\").dataset.id;\n    const attackIndex = parseInt(elem.closest(\".attack\").dataset.index);\n\n    // Set ammo\n    this.setAttackAmmo(attackIndex, ammoId === \"null\" ? null : ammoId);\n    this.render();\n  }\n\n  async _onAmmoControlClick(event) {\n    event.preventDefault();\n\n    const elem = event.currentTarget;\n    const ammoId = elem.closest(\".ammo-item\").dataset.id;\n    switch (elem.dataset.type) {\n      case \"set-default\":\n        if (ammoId === \"null\") await this.object.item.unsetFlag(\"ffd20\", \"defaultAmmo\");\n        else await this.object.item.setFlag(\"ffd20\", \"defaultAmmo\", ammoId);\n        // Apply CSS class, since we can't do a render in here and keep the dropdown menu open\n        elem\n          .closest(\"ul\")\n          .querySelectorAll(\".ammo-item\")\n          .forEach((o) => o.classList.remove(\"default\"));\n        if (ammoId !== \"null\") elem.closest(\".ammo-item\").classList.add(\"default\");\n        break;\n      case \"set-all\":\n        for (let a = 0; a < this.attacks.length; a++) {\n          this.setAttackAmmo(a, ammoId);\n        }\n        this.render();\n    }\n  }\n\n  _unfocusElements(event) {\n    // Close ammo select\n    if (this.element[0].querySelector(\".ammo-select\") != null && !event.target.closest(\".ammo-select\")) {\n      const elem = this.element[0].querySelector(\".ammo-select\");\n      elem.classList.remove(\"focus\");\n      elem.querySelector(\"ul\").classList.remove(\"open\");\n    }\n  }\n\n  _onChangeAttribute(event) {\n    event.preventDefault();\n\n    const elem = event.currentTarget;\n    this.attributes[elem.name] = elem.value;\n\n    // Also change roll data, if appropriate\n    switch (elem.name) {\n      case \"cl-offset\":\n        this.rollData.cl = this.base.cl + parseInt(elem.value);\n        break;\n      case \"sl-offset\":\n        this.rollData.sl = this.base.sl + parseInt(elem.value);\n        break;\n      case \"damage-ability-multiplier\":\n        setProperty(this.rollData, \"item.ability.damageMult\", elem.value);\n        break;\n      case \"held\":\n        setProperty(this.rollData, \"item.held\", elem.value);\n        break;\n    }\n\n    this.render();\n  }\n\n  initAttacks() {\n    this.attacks = new ActionUse({ rollData: this.rollData, item: this.object.item })\n      .generateAttacks(true)\n      .map(({ label, attackBonus }) => ({\n        label: label,\n        attackBonus: attackBonus,\n        // Reduce formula to a single number for easier display\n        attackBonusTotal: RollFFD20.safeTotal(attackBonus, this.rollData),\n        // Ammo data is discarded in favour of specialised handling via setAttackAmmo\n        ammo: null,\n      }));\n\n    // Set ammo usage\n    const ammoId = this.object.item.getFlag(\"ffd20\", \"defaultAmmo\");\n    if (ammoId != null) {\n      for (let a = 0; a < this.attacks.length; a++) {\n        this.setAttackAmmo(a, ammoId);\n      }\n    }\n  }\n\n  // Initializes ammo usage, which help avoid being able to overuse ammo\n  initAmmoUsage() {\n    this.ammoUsage = this.getAmmo().reduce((cur, o) => {\n      cur[o.data._id] = {\n        quantity: o.data.system.quantity,\n        used: 0,\n      };\n\n      return cur;\n    }, {});\n  }\n\n  getFormAttacks() {\n    return this.attacks.map((o) => {\n      return {\n        id: o.id,\n        label: o.label,\n        attackBonus: o.attackBonus,\n        ammo: o.ammo?.data._id,\n      };\n    });\n  }\n\n  setAttackAmmo(attackIndex, ammoId = null) {\n    if (!this.object.data.usesAmmo) return;\n\n    const atk = this.attacks[attackIndex];\n    const curAmmo = atk.ammo?.data._id;\n    const ammoItem = ammoId ? this.object.actor.items.get(ammoId) : null;\n    const abundant = ammoItem?.flags?.ffd20?.abundant ?? false;\n\n    // Check if ammo exists\n    if (ammoId && this.ammoUsage[ammoId] == null) ammoId = null;\n\n    if (!ammoId) {\n      atk.ammo = null;\n      // Remove from ammo usage tracker\n      if (curAmmo != null) {\n        this.ammoUsage[curAmmo].used--;\n      }\n      return;\n    }\n\n    // Don't allow overusage\n    if (!abundant && this.ammoUsage[ammoId].used >= this.ammoUsage[ammoId].quantity) return;\n\n    atk.ammo = this.getAmmo().find((o) => o.data._id === ammoId);\n    // Add to ammo usage tracker\n    if (curAmmo != null) {\n      this.ammoUsage[curAmmo].used--;\n    }\n    this.ammoUsage[ammoId].used++;\n  }\n\n  _onAttackSingle(event) {\n    event.preventDefault();\n\n    const attacks = this.getFormAttacks();\n    return this.doAttack(attacks.slice(0, 1), false);\n  }\n\n  _onAttackFull(event) {\n    event.preventDefault();\n\n    const attacks = this.getFormAttacks();\n    return this.doAttack(attacks, true);\n  }\n\n  doAttack(attacks, fullAttack = true) {\n    this._callbacks.resolve({ fullAttack, attacks, html: this.element });\n    this._callbacks.resolve = null;\n    this.close();\n  }\n\n  async close(options = {}) {\n    if (this._callbacks.resolve != null) this._callbacks.resolve();\n    return super.close(options);\n  }\n\n  show() {\n    return new Promise((resolve, reject) => {\n      this.render(true);\n\n      this._callbacks.resolve = (...args) => {\n        resolve(...args);\n      };\n      this._callbacks.reject = (...args) => {\n        reject(...args);\n      };\n    });\n  }\n}\n","import Color from \"color\";\nimport { colorToInt, convertDistance, measureDistance } from \"../utils/lib.mjs\";\nimport { RollFFD20 } from \"../dice/roll.mjs\";\n\nconst rangeColor = {\n  fill: Color(\"#ff0000\"),\n  border: Color(\"#ff0000\").darken(0.1),\n};\nconst reachColor = {\n  fill: Color(\"#ffff00\"),\n  border: Color(\"#ffff00\").darken(0.1),\n};\n\nexport class SquareHighlight {\n  constructor(origin, fillColor = 0x00ff00, borderColor = 0x000000) {\n    this.origin = origin;\n    this.borderColor = borderColor;\n    this.fillColor = fillColor;\n    this._squares = [];\n\n    this._id = randomID();\n\n    canvas.grid.addHighlightLayer(`AttackHighlight.${this._id}`);\n  }\n\n  addSquare(x, y) {\n    this._squares.push({ x: x, y: y });\n  }\n\n  clear(permanent = false) {\n    const hl = canvas.grid.getHighlightLayer(`AttackHighlight.${this._id}`);\n    if (!hl) return;\n    hl.clear();\n\n    if (permanent) canvas.grid.destroyHighlightLayer(`AttackHighlight.${this._id}`);\n  }\n\n  render() {\n    const grid = canvas.grid;\n    const gridSize = grid.size;\n    const hl = canvas.grid.getHighlightLayer(`AttackHighlight.${this._id}`);\n\n    this.clear();\n\n    // Highlight squares\n    for (const s of this._squares) {\n      const x = Math.floor(this.origin.x - s.x) * gridSize;\n      const y = Math.floor(this.origin.y - s.y) * gridSize;\n      grid.grid.highlightGridPosition(hl, { x: x, y: y, border: this.borderColor, color: this.fillColor });\n    }\n  }\n}\n\n/**\n * @typedef {object} AttackReachHighlight\n * An object containing highlights belonging to a specific attack\n * @property {SquareHighlight} normal - Highlight for normal range\n * @property {SquareHighlight} reach - Highlight for reach range\n * @property {SquareHighlight[]} extra - Additional highlights\n */\n\n/** @type {AttackReachHighlight|undefined} */\nlet currentHighlight;\n\n/**\n * Calculates the {@link AttackReachHighlight} for a token's attack.\n *\n * @param {Token} token - The token to calculate the attack reach for\n * @param {import(\"../documents/item/item-ffd20.mjs\").ItemFFD20} attack - The attack to calculate the reach for\n * @param {import(\"../components/action.mjs\").ItemAction} action - The action to calculate the reach for\n * @returns {AttackReachHighlight | undefined} Highlights for this attack, if any\n */\nconst getAttackReach = function (token, attack, action) {\n  const grid = canvas.grid;\n  const gridSize = grid.size;\n  const tw = token.document.width;\n  const th = token.document.height;\n  const origin = {\n    x: Math.floor((token.x + tw * gridSize - 0.5 * gridSize) / gridSize),\n    y: Math.floor((token.y + th * gridSize - 0.5 * gridSize) / gridSize),\n  };\n\n  if (!action) return;\n  const rollData = action.getRollData();\n\n  // Determine whether reach\n  const rangeKey = action.data.range.units;\n  if (![\"melee\", \"touch\", \"reach\", \"ft\", \"close\", \"medium\"].includes(rangeKey)) return;\n  const isReach = rangeKey === \"reach\";\n  const range = rollData.range;\n\n  // Determine minimum range\n  const minRangeKey = action.data.range.minUnits;\n  let minRange = null;\n  if ([\"melee\", \"touch\"].includes(minRangeKey)) minRange = range.melee;\n  if (minRangeKey === \"reach\") minRange = range.reach;\n  if (minRangeKey === \"ft\") {\n    minRange = RollFFD20.safeRoll(action.data.range.minValue || \"0\", rollData).total;\n  }\n\n  const squares = {\n    normal: [],\n    reach: [],\n    extra: [],\n  };\n  const useReachRule = game.settings.get(\"ffd20\", \"alternativeReachCornerRule\") !== true;\n\n  if ([\"melee\", \"touch\", \"reach\"].includes(rangeKey)) {\n    squares.normal = getReachSquares(token, range.melee, minRange, null, { useReachRule });\n    squares.reach = getReachSquares(token, range.reach, range.melee, null, { useReachRule });\n  } else if (rangeKey === \"ft\") {\n    const r = RollFFD20.safeRoll(action.data.range.value || \"0\", rollData).total;\n    squares.normal = getReachSquares(token, r, minRange, null, { useReachRule: true });\n\n    // Add range increments\n    const maxSquareRange = Math.min(\n      60, // arbitrary limit to enhance performance on large canvases\n      Math.max(\n        (canvas.dimensions.width / canvas.dimensions.size) * canvas.dimensions.distance,\n        (canvas.dimensions.height / canvas.dimensions.size) * canvas.dimensions.distance\n      ) + convertDistance(r)[0]\n    );\n    const rangeIncrements = action.data.range.maxIncrements;\n    for (let a = 1; a < rangeIncrements; a++) {\n      if ((a + 1) * convertDistance(r)[0] <= maxSquareRange) {\n        squares.extra.push(getReachSquares(token, (a + 1) * r, a * r, null, { useReachRule }));\n      }\n    }\n  } else if ([\"close\", \"medium\"].includes(rangeKey) && attack.type === \"spell\") {\n    let r;\n    switch (rangeKey) {\n      case \"close\":\n        r = RollFFD20.safeRoll(\"25 + floor(@cl / 2) * 5\", rollData).total;\n        break;\n      case \"medium\":\n        r = RollFFD20.safeRoll(\"100 + @cl * 10\", rollData).total;\n        break;\n    }\n    squares.normal = getReachSquares(token, r, minRange, null, { useReachRule });\n  }\n\n  const result = {\n    normal: new SquareHighlight(origin, colorToInt(rangeColor.fill), colorToInt(rangeColor.border)),\n    reach: new SquareHighlight(origin, colorToInt(reachColor.fill), colorToInt(reachColor.border)),\n    extra: [],\n  };\n  for (const s of squares.normal) {\n    result.normal.addSquare(s[0], s[1]);\n  }\n  if (isReach) {\n    for (const s of squares.reach) {\n      result.reach.addSquare(s[0], s[1]);\n    }\n  }\n\n  // Add extra range squares\n  {\n    for (let a = 0; a < squares.extra.length; a++) {\n      const squaresExtra = squares.extra[a];\n\n      const color = {\n        fill: a % 2 === 1 ? rangeColor.fill : reachColor.fill,\n        border: a % 2 === 1 ? rangeColor.border : reachColor.border,\n      };\n\n      const hl = new SquareHighlight(origin, colorToInt(color.fill), colorToInt(color.border));\n      for (const s of squaresExtra) {\n        hl.addSquare(s[0], s[1]);\n      }\n      result.extra.push(hl);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Calculates and renders the {@link AttackReachHighlight} for a token's attack.\n * If a highlight already exists, it will be removed.\n *\n * @param {Token} token - The token to calculate the attack reach for\n * @param {import(\"../documents/item/item-ffd20.mjs\").ItemFFD20} attack - The attack to calculate the reach for\n * @param {import(\"../components/action.mjs\").ItemAction} action - The action to calculate the reach for\n */\nexport const showAttackReach = function (token, attack, action) {\n  // Clear previous highlight\n  clearHighlight();\n\n  const highlight = getAttackReach(token, attack, action);\n\n  // If a highlight could be created, make it the current highlight and render it\n  if (!highlight) return;\n  currentHighlight = highlight;\n  renderHighlight();\n};\n\nexport const clearHighlight = function () {\n  if (currentHighlight) {\n    currentHighlight.normal.clear();\n    currentHighlight.reach.clear();\n    for (const h of currentHighlight.extra) {\n      h.clear();\n    }\n    currentHighlight = undefined;\n  }\n};\n\nconst renderHighlight = function () {\n  if (currentHighlight) {\n    currentHighlight.normal.render();\n    currentHighlight.reach.render();\n    for (const h of currentHighlight.extra) {\n      h.render();\n    }\n  }\n};\n\n/**\n * Returns a token belonging to either an actor's UUID or a token's UUID\n *\n * @async\n * @param {string} uuid - UUID of an actor or token\n * @returns {Promise<Token|null>} A Token, if one can be found\n */\nconst _getTokenByUuid = async function (uuid) {\n  if (!uuid) return;\n  /** @type {TokenDocument | Actor} */\n  const actor = await fromUuid(uuid);\n  if (actor instanceof TokenDocument) return actor.object;\n  return actor?.token ?? (actor != null ? canvas.tokens.placeables.find((o) => o.actor === actor) : null);\n};\n\n/**\n * Add listeners on the {@link ChatLog}'s HTML element, checking for hover events involving\n * chat cards' range element using event delegation.\n *\n * @param {JQuery<HTMLElement>} html - The chat log\n */\nexport function addReachListeners(html) {\n  html.on(\"mouseenter\", \".card-range\", onMouseEnterReach);\n  html.on(\"mouseleave\", \".card-range\", onMouseLeaveReach);\n}\n\n/**\n * Handle display of reach when a chat card's reach element is hovered\n *\n * @param {JQuery.MouseEnterEvent<HTMLElement>} event - A `mouseEnter` event\n */\nconst onMouseEnterReach = (event) => {\n  event.preventDefault();\n\n  const reachElement = event.currentTarget;\n  const card = reachElement.closest(\".chat-card\");\n  const { tokenUuid, actionId, itemId } = card.dataset;\n  if (!(itemId && actionId && tokenUuid)) return;\n\n  _getTokenByUuid(tokenUuid).then((token) => {\n    if (!token) return;\n    const item = token.actor.allItems.find((item) => item.id === itemId);\n    if (!item) return;\n    if (!game.settings.get(\"ffd20\", \"hideReachMeasurements\")) showAttackReach(token, item, item.actions.get(actionId));\n  });\n};\n\n/**\n * Handle clearing of reach highlights created by {@link onMouseEnterReach}\n *\n * @param {JQuery.MouseLeaveEvent} event - A `mouseLeave` event\n */\nconst onMouseLeaveReach = (event) => {\n  event.preventDefault();\n  clearHighlight();\n};\n\nconst getReachSquares = function (token, range, minRange = 0, addSquareFunction = null, options) {\n  range = convertDistance(range)[0];\n  if (typeof minRange === \"number\") minRange = convertDistance(minRange)[0];\n\n  const result = [];\n\n  if (canvas.grid.type !== CONST.GRID_TYPES.SQUARE) return result;\n  if (!addSquareFunction) addSquareFunction = shouldAddReachSquare;\n\n  // Initialize variables\n  const gridDist = canvas.scene.grid.distance;\n  const gridSize = canvas.grid.size;\n\n  // Determine token squares\n  const tokenSquares = [];\n  for (let a = 0; a < Math.floor(token.w / gridSize); a++) {\n    for (let b = 0; b < Math.floor(token.h / gridSize); b++) {\n      const x = Math.floor((token.x + gridSize * 0.5) / gridSize + a);\n      const y = Math.floor((token.y + gridSize * 0.5) / gridSize + b);\n      tokenSquares.push([x, y]);\n    }\n  }\n\n  // Determine token-based variables\n  const tokenRect = [\n    Math.floor((token.x + gridSize * 0.5) / gridSize),\n    Math.floor((token.y + gridSize * 0.5) / gridSize),\n    Math.floor(token.w / gridSize),\n    Math.floor(token.h / gridSize),\n  ];\n\n  // Create function to determine closest token square\n  const getClosestTokenSquare = function (pos) {\n    const lowest = { square: null, dist: null };\n    for (const s of tokenSquares) {\n      const dist = Math.sqrt((s[0] - pos[0]) ** 2 + (s[1] - pos[1]) ** 2);\n      if (lowest.dist == null || dist < lowest.dist) {\n        lowest.square = s;\n        lowest.dist = dist;\n      }\n    }\n\n    return lowest.square;\n  };\n\n  // Gather potential squares\n  const squareRange = Math.round(range / gridDist);\n  const wMax = squareRange * 2 + tokenRect[2];\n  const hMax = squareRange * 2 + tokenRect[3];\n  const tl = [tokenRect[0] - squareRange, tokenRect[1] - squareRange];\n  for (let a = tl[0]; a < tl[0] + wMax; a++) {\n    for (let b = tl[1]; b < tl[1] + hMax; b++) {\n      const closestSquare = getClosestTokenSquare([a, b]);\n\n      const offset = [a - tokenRect[0], b - tokenRect[1]];\n      if (\n        !(\n          a >= tokenRect[0] &&\n          a < tokenRect[0] + tokenRect[2] &&\n          b >= tokenRect[1] &&\n          b < tokenRect[1] + tokenRect[2] &&\n          minRange != null\n        )\n      ) {\n        if (addSquareFunction(token, [a, b], closestSquare, range, minRange, tokenRect, options)) {\n          result.push(offset);\n        }\n      }\n    }\n  }\n\n  return result;\n};\n\nconst shouldAddReachSquare = function (\n  token,\n  pos,\n  closestTokenSquare,\n  range,\n  minRange,\n  tokenRect,\n  options = { useReachRule: false }\n) {\n  const gridDist = canvas.scene.grid.distance;\n  const gridSize = canvas.grid.size;\n  const p0 = { x: closestTokenSquare[0] * gridSize, y: closestTokenSquare[1] * gridSize };\n  const p1 = { x: pos[0] * gridSize, y: pos[1] * gridSize };\n\n  const dist = measureDistance(p0, p1);\n  const dist2 = options.useReachRule ? measureDistance(p0, p1, { diagonalRule: \"555\" }) : null;\n  const reachRuleRange = convertDistance(10)[0];\n  if (dist > range) {\n    // Special rule for 10-ft. reach\n    if (!(options.useReachRule && range === reachRuleRange)) {\n      return false;\n    }\n  }\n\n  if (minRange != null && dist <= minRange) {\n    return false;\n  }\n\n  // Special rule for minimum ranges >= 10-ft.\n  if (options.useReachRule && minRange >= reachRuleRange && dist2 <= reachRuleRange) {\n    return false;\n  }\n\n  return true;\n};\n","import { clearHighlight, showAttackReach } from \"./attack-reach.mjs\";\nimport { getSkipActionPrompt } from \"../documents/settings.mjs\";\n\nexport class TokenQuickActions {\n  static async addTop3Attacks(app, html, data) {\n    const token = canvas.tokens.get(data._id);\n    const actor = token.actor;\n\n    if (actor == null) return;\n    if (!actor.getQuickActions) return;\n\n    const actualChargeCost = (i) => Math.floor(i.charges / i.chargeCost),\n      actualMaxCharge = (i) => Math.floor(i.maxCharges / i.chargeCost);\n    const chargeDisplay = (item) => {\n      let r = \"<charges>\";\n      const max = item.isCharged ? actualMaxCharge(item) : 0;\n      const recharging = item.isCharged && item.chargeCost < 0;\n      const uses = item.isCharged ? (!recharging ? actualChargeCost(item) : -item.chargeCost) : 0;\n      if (!recharging) r += `<span class='remaining'>${uses}</span >`;\n      else r += `<span class='recharge'>+${uses}</span>`;\n      if (!recharging && max !== 0) r += `<span class='delimiter' >/</span ><span class='max'>${max}</span>`;\n      r += \"</charges>\";\n      return r;\n    };\n\n    let quickActions = '<div class=\"col actions\"><div class=\"below\">';\n    const items = actor.getQuickActions();\n    items.forEach(function (i) {\n      const item = i.item;\n      const icon = item.img ?? CONST.DEFAULT_TOKEN;\n      let title = \"\";\n      if (item.type === \"attack\") title = game.i18n.localize(\"FFD20.AttackWith\").format(item.name);\n      else if (item.type === \"spell\") title = game.i18n.localize(\"FFD20.AttackWithSpell\").format(item.name);\n      else if (item.type === \"feat\") title = game.i18n.localize(\"FFD20.AttackWithFeat\").format(item.name);\n      const type = item.type;\n      quickActions +=\n        `<div id=\"${type}-${item.id}\" class=\"control-icon token-quick-action\" style=\"border: 2px solid ${i.color1};\">` +\n        `<img src=\"${icon}\" width=\"36\" height=\"36\" title=\"${title}\">`;\n      quickActions += \"</div >\";\n    });\n\n    html.find(\".col.middle\").after(quickActions + \"</div></div>\");\n\n    items.forEach(function (i) {\n      const item = actor.items.get(i.item.id);\n      const type = item.type;\n      const elem = html.find(`#${type}-${item.id}`);\n      const firstAction = item.firstAction;\n      if (!firstAction) return;\n\n      // Add click handler\n      elem.on(\"click\", (event) => {\n        if (!event.ctrlKey) {\n          return item.use({ ev: event, skipDialog: getSkipActionPrompt() });\n        }\n        return item.roll();\n      });\n\n      elem.on(\"contextmenu\", () => {\n        item.sheet.render(true, { focus: true });\n      });\n\n      // Add mouse enter handler\n      elem.on(\"mouseenter\", (event) => {\n        if (!game.settings.get(\"ffd20\", \"hideReachMeasurements\")) showAttackReach(token, item, firstAction);\n      });\n\n      // Add mouse leave callback\n      elem.on(\"mouseleave\", (event) => {\n        clearHighlight();\n      });\n    });\n  }\n}\n","import { getFirstActiveGM, refreshActors } from \"./utils/lib.mjs\";\n\n/**\n *\n */\nexport function initializeSocket() {\n  game.socket.on(\"system.ffd20\", runSocketFunction);\n}\n\nconst runSocketFunction = async function (args, senderId) {\n  const isFirstGM = game.user === getFirstActiveGM();\n  const sender = game.users.get(senderId);\n  try {\n    switch (args.eventType) {\n      case \"cleanItemLink\": {\n        // Get actor\n        const actor = await fromUuid(args.actorUUID);\n        // Get item\n        const parentItemData = await fromUuid(args.itemUUID);\n        const parentItem = actor.items.get(parentItemData._id);\n        // Get link data\n        const link = args.link;\n        const linkType = args.linkType;\n        // Clean item links\n        parentItem._cleanLink(link, linkType);\n        break;\n      }\n      case \"redrawCanvas\":\n        canvas.perception.update(\n          {\n            initializeLighting: true,\n            initializeVision: true,\n          },\n          true\n        );\n        break;\n      case \"currencyTransfer\": {\n        if (!isFirstGM) return;\n        let source = await fromUuid(args.data.sourceActor);\n        let dest = await fromUuid(args.data.destActor);\n\n        if (args.data.sourceContainer) source = source.items.get(args.data.sourceContainer);\n        if (args.data.destContainer) dest = dest.items.get(args.data.destContainer);\n        const amount = args.data.amount;\n\n        ffd20.applications.CurrencyTransfer.transfer(source, dest, amount, args.data.sourceAlt, args.data.destAlt, false);\n        break;\n      }\n      case \"alterChatTargetAttribute\":\n        if (isFirstGM) alterChatTargetAttribute(args);\n        break;\n      case \"giveItem\": {\n        if (!isFirstGM) return;\n        const item = await fromUuid(args.item);\n        const sourceActor = item.parent;\n        if (!sourceActor.testUserPermission(sender, \"OWNER\")) return;\n        const targetActor = await fromUuid(args.targetActor);\n        const itemData = item.toObject();\n        await targetActor.createEmbeddedDocuments(\"Item\", [itemData]);\n        await sourceActor.deleteEmbeddedDocuments(\"Item\", [item.id]);\n        break;\n      }\n      case \"refreshActorSheets\":\n        ffd20.utils.refreshActors({ renderOnly: true });\n        break;\n    }\n  } catch (err) {\n    console.log(\"FFD20 | Socket Error: \", err);\n  }\n};\n\nexport const alterChatTargetAttribute = function (args) {\n  const message = game.messages.get(args.message);\n  const contentHTML = $(message.data.content);\n\n  // Alter saving throw\n  if (args.save != null) {\n    const targetElem = contentHTML.find(\n      `div.attack-targets .target[data-uuid=\"${args.targetUuid}\"] .saving-throws .${args.save}`\n    );\n    const valueElem = targetElem.find(\".value\");\n    valueElem.html(`${args.value}`);\n\n    // Add classes based off extra data\n    if (args.isFailure) valueElem.addClass(\"failure\");\n    else valueElem.removeClass(\"failure\");\n    if (args.isSuccess) valueElem.addClass(\"success\");\n    else valueElem.removeClass(\"success\");\n\n    return message.update({\n      content: contentHTML.prop(\"outerHTML\"),\n    });\n  }\n};\n","// HTML5 entities map: { name -> utf16string }\n//\n'use strict';\n\n/*eslint quotes:0*/\nmodule.exports = require('entities/lib/maps/entities.json');\n","module.exports=/[!-#%-\\*,-\\/:;\\?@\\[-\\]_\\{\\}\\xA1\\xA7\\xAB\\xB6\\xB7\\xBB\\xBF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u09FD\\u0A76\\u0AF0\\u0C84\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2308-\\u230B\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E4E\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA8FC\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]|\\uD800[\\uDD00-\\uDD02\\uDF9F\\uDFD0]|\\uD801\\uDD6F|\\uD802[\\uDC57\\uDD1F\\uDD3F\\uDE50-\\uDE58\\uDE7F\\uDEF0-\\uDEF6\\uDF39-\\uDF3F\\uDF99-\\uDF9C]|\\uD803[\\uDF55-\\uDF59]|\\uD804[\\uDC47-\\uDC4D\\uDCBB\\uDCBC\\uDCBE-\\uDCC1\\uDD40-\\uDD43\\uDD74\\uDD75\\uDDC5-\\uDDC8\\uDDCD\\uDDDB\\uDDDD-\\uDDDF\\uDE38-\\uDE3D\\uDEA9]|\\uD805[\\uDC4B-\\uDC4F\\uDC5B\\uDC5D\\uDCC6\\uDDC1-\\uDDD7\\uDE41-\\uDE43\\uDE60-\\uDE6C\\uDF3C-\\uDF3E]|\\uD806[\\uDC3B\\uDE3F-\\uDE46\\uDE9A-\\uDE9C\\uDE9E-\\uDEA2]|\\uD807[\\uDC41-\\uDC45\\uDC70\\uDC71\\uDEF7\\uDEF8]|\\uD809[\\uDC70-\\uDC74]|\\uD81A[\\uDE6E\\uDE6F\\uDEF5\\uDF37-\\uDF3B\\uDF44]|\\uD81B[\\uDE97-\\uDE9A]|\\uD82F\\uDC9F|\\uD836[\\uDE87-\\uDE8B]|\\uD83A[\\uDD5E\\uDD5F]/","\n'use strict';\n\n\nvar encodeCache = {};\n\n\n// Create a lookup array where anything but characters in `chars` string\n// and alphanumeric chars is percent-encoded.\n//\nfunction getEncodeCache(exclude) {\n  var i, ch, cache = encodeCache[exclude];\n  if (cache) { return cache; }\n\n  cache = encodeCache[exclude] = [];\n\n  for (i = 0; i < 128; i++) {\n    ch = String.fromCharCode(i);\n\n    if (/^[0-9a-z]$/i.test(ch)) {\n      // always allow unencoded alphanumeric characters\n      cache.push(ch);\n    } else {\n      cache.push('%' + ('0' + i.toString(16).toUpperCase()).slice(-2));\n    }\n  }\n\n  for (i = 0; i < exclude.length; i++) {\n    cache[exclude.charCodeAt(i)] = exclude[i];\n  }\n\n  return cache;\n}\n\n\n// Encode unsafe characters with percent-encoding, skipping already\n// encoded sequences.\n//\n//  - string       - string to encode\n//  - exclude      - list of characters to ignore (in addition to a-zA-Z0-9)\n//  - keepEscaped  - don't encode '%' in a correct escape sequence (default: true)\n//\nfunction encode(string, exclude, keepEscaped) {\n  var i, l, code, nextCode, cache,\n      result = '';\n\n  if (typeof exclude !== 'string') {\n    // encode(string, keepEscaped)\n    keepEscaped  = exclude;\n    exclude = encode.defaultChars;\n  }\n\n  if (typeof keepEscaped === 'undefined') {\n    keepEscaped = true;\n  }\n\n  cache = getEncodeCache(exclude);\n\n  for (i = 0, l = string.length; i < l; i++) {\n    code = string.charCodeAt(i);\n\n    if (keepEscaped && code === 0x25 /* % */ && i + 2 < l) {\n      if (/^[0-9a-f]{2}$/i.test(string.slice(i + 1, i + 3))) {\n        result += string.slice(i, i + 3);\n        i += 2;\n        continue;\n      }\n    }\n\n    if (code < 128) {\n      result += cache[code];\n      continue;\n    }\n\n    if (code >= 0xD800 && code <= 0xDFFF) {\n      if (code >= 0xD800 && code <= 0xDBFF && i + 1 < l) {\n        nextCode = string.charCodeAt(i + 1);\n        if (nextCode >= 0xDC00 && nextCode <= 0xDFFF) {\n          result += encodeURIComponent(string[i] + string[i + 1]);\n          i++;\n          continue;\n        }\n      }\n      result += '%EF%BF%BD';\n      continue;\n    }\n\n    result += encodeURIComponent(string[i]);\n  }\n\n  return result;\n}\n\nencode.defaultChars   = \";/?:@&=+$,-_.!~*'()#\";\nencode.componentChars = \"-_.!~*'()\";\n\n\nmodule.exports = encode;\n","\n'use strict';\n\n\n/* eslint-disable no-bitwise */\n\nvar decodeCache = {};\n\nfunction getDecodeCache(exclude) {\n  var i, ch, cache = decodeCache[exclude];\n  if (cache) { return cache; }\n\n  cache = decodeCache[exclude] = [];\n\n  for (i = 0; i < 128; i++) {\n    ch = String.fromCharCode(i);\n    cache.push(ch);\n  }\n\n  for (i = 0; i < exclude.length; i++) {\n    ch = exclude.charCodeAt(i);\n    cache[ch] = '%' + ('0' + ch.toString(16).toUpperCase()).slice(-2);\n  }\n\n  return cache;\n}\n\n\n// Decode percent-encoded string.\n//\nfunction decode(string, exclude) {\n  var cache;\n\n  if (typeof exclude !== 'string') {\n    exclude = decode.defaultChars;\n  }\n\n  cache = getDecodeCache(exclude);\n\n  return string.replace(/(%[a-f0-9]{2})+/gi, function(seq) {\n    var i, l, b1, b2, b3, b4, chr,\n        result = '';\n\n    for (i = 0, l = seq.length; i < l; i += 3) {\n      b1 = parseInt(seq.slice(i + 1, i + 3), 16);\n\n      if (b1 < 0x80) {\n        result += cache[b1];\n        continue;\n      }\n\n      if ((b1 & 0xE0) === 0xC0 && (i + 3 < l)) {\n        // 110xxxxx 10xxxxxx\n        b2 = parseInt(seq.slice(i + 4, i + 6), 16);\n\n        if ((b2 & 0xC0) === 0x80) {\n          chr = ((b1 << 6) & 0x7C0) | (b2 & 0x3F);\n\n          if (chr < 0x80) {\n            result += '\\ufffd\\ufffd';\n          } else {\n            result += String.fromCharCode(chr);\n          }\n\n          i += 3;\n          continue;\n        }\n      }\n\n      if ((b1 & 0xF0) === 0xE0 && (i + 6 < l)) {\n        // 1110xxxx 10xxxxxx 10xxxxxx\n        b2 = parseInt(seq.slice(i + 4, i + 6), 16);\n        b3 = parseInt(seq.slice(i + 7, i + 9), 16);\n\n        if ((b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n          chr = ((b1 << 12) & 0xF000) | ((b2 << 6) & 0xFC0) | (b3 & 0x3F);\n\n          if (chr < 0x800 || (chr >= 0xD800 && chr <= 0xDFFF)) {\n            result += '\\ufffd\\ufffd\\ufffd';\n          } else {\n            result += String.fromCharCode(chr);\n          }\n\n          i += 6;\n          continue;\n        }\n      }\n\n      if ((b1 & 0xF8) === 0xF0 && (i + 9 < l)) {\n        // 111110xx 10xxxxxx 10xxxxxx 10xxxxxx\n        b2 = parseInt(seq.slice(i + 4, i + 6), 16);\n        b3 = parseInt(seq.slice(i + 7, i + 9), 16);\n        b4 = parseInt(seq.slice(i + 10, i + 12), 16);\n\n        if ((b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80 && (b4 & 0xC0) === 0x80) {\n          chr = ((b1 << 18) & 0x1C0000) | ((b2 << 12) & 0x3F000) | ((b3 << 6) & 0xFC0) | (b4 & 0x3F);\n\n          if (chr < 0x10000 || chr > 0x10FFFF) {\n            result += '\\ufffd\\ufffd\\ufffd\\ufffd';\n          } else {\n            chr -= 0x10000;\n            result += String.fromCharCode(0xD800 + (chr >> 10), 0xDC00 + (chr & 0x3FF));\n          }\n\n          i += 9;\n          continue;\n        }\n      }\n\n      result += '\\ufffd';\n    }\n\n    return result;\n  });\n}\n\n\ndecode.defaultChars   = ';/?:@&=+$,#';\ndecode.componentChars = '';\n\n\nmodule.exports = decode;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n//\n// Changes from joyent/node:\n//\n// 1. No leading slash in paths,\n//    e.g. in `url.parse('http://foo?bar')` pathname is ``, not `/`\n//\n// 2. Backslashes are not replaced with slashes,\n//    so `http:\\\\example.org\\` is treated like a relative path\n//\n// 3. Trailing colon is treated like a part of the path,\n//    i.e. in `http://example.org:foo` pathname is `:foo`\n//\n// 4. Nothing is URL-encoded in the resulting object,\n//    (in joyent/node some chars in auth and paths are encoded)\n//\n// 5. `url.parse()` does not have `parseQueryString` argument\n//\n// 6. Removed extraneous result properties: `host`, `path`, `query`, etc.,\n//    which can be constructed using other parts of the url.\n//\n\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.pathname = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = [ '<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t' ],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = [ '{', '}', '|', '\\\\', '^', '`' ].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = [ '\\'' ].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = [ '%', '/', '?', ';', '#' ].concat(autoEscape),\n    hostEndingChars = [ '/', '?', '#' ],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    /* eslint-disable no-script-url */\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    };\n    /* eslint-enable no-script-url */\n\nfunction urlParse(url, slashesDenoteHost) {\n  if (url && url instanceof Url) { return url; }\n\n  var u = new Url();\n  u.parse(url, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, slashesDenoteHost) {\n  var i, l, lowerProto, hec, slashes,\n      rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    lowerProto = proto.toLowerCase();\n    this.protocol = proto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (i = 0; i < hostEndingChars.length; i++) {\n      hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd)) {\n        hostEnd = hec;\n      }\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = auth;\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (i = 0; i < nonHostChars.length; i++) {\n      hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd)) {\n        hostEnd = hec;\n      }\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1) {\n      hostEnd = rest.length;\n    }\n\n    if (rest[hostEnd - 1] === ':') { hostEnd--; }\n    var host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost(host);\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) { continue; }\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    }\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n    }\n  }\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    rest = rest.slice(0, qm);\n  }\n  if (rest) { this.pathname = rest; }\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '';\n  }\n\n  return this;\n};\n\nUrl.prototype.parseHost = function(host) {\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) { this.hostname = host; }\n};\n\nmodule.exports = urlParse;\n","'use strict';\n\n\nmodule.exports.encode = require('./encode');\nmodule.exports.decode = require('./decode');\nmodule.exports.format = require('./format');\nmodule.exports.parse  = require('./parse');\n","\n'use strict';\n\n\nmodule.exports = function format(url) {\n  var result = '';\n\n  result += url.protocol || '';\n  result += url.slashes ? '//' : '';\n  result += url.auth ? url.auth + '@' : '';\n\n  if (url.hostname && url.hostname.indexOf(':') !== -1) {\n    // ipv6 address\n    result += '[' + url.hostname + ']';\n  } else {\n    result += url.hostname || '';\n  }\n\n  result += url.port ? ':' + url.port : '';\n  result += url.pathname || '';\n  result += url.search || '';\n  result += url.hash || '';\n\n  return result;\n};\n","module.exports=/[\\0-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF]/","module.exports=/[\\0-\\x1F\\x7F-\\x9F]/","module.exports=/[ \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000]/","'use strict';\n\nexports.Any = require('./properties/Any/regex');\nexports.Cc  = require('./categories/Cc/regex');\nexports.Cf  = require('./categories/Cf/regex');\nexports.P   = require('./categories/P/regex');\nexports.Z   = require('./categories/Z/regex');\n","module.exports=/[\\xAD\\u0600-\\u0605\\u061C\\u06DD\\u070F\\u08E2\\u180E\\u200B-\\u200F\\u202A-\\u202E\\u2060-\\u2064\\u2066-\\u206F\\uFEFF\\uFFF9-\\uFFFB]|\\uD804[\\uDCBD\\uDCCD]|\\uD82F[\\uDCA0-\\uDCA3]|\\uD834[\\uDD73-\\uDD7A]|\\uDB40[\\uDC01\\uDC20-\\uDC7F]/","// Utilities\n//\n'use strict';\n\n\nfunction _class(obj) { return Object.prototype.toString.call(obj); }\n\nfunction isString(obj) { return _class(obj) === '[object String]'; }\n\nvar _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction has(object, key) {\n  return _hasOwnProperty.call(object, key);\n}\n\n// Merge objects\n//\nfunction assign(obj /*from1, from2, from3, ...*/) {\n  var sources = Array.prototype.slice.call(arguments, 1);\n\n  sources.forEach(function (source) {\n    if (!source) { return; }\n\n    if (typeof source !== 'object') {\n      throw new TypeError(source + 'must be object');\n    }\n\n    Object.keys(source).forEach(function (key) {\n      obj[key] = source[key];\n    });\n  });\n\n  return obj;\n}\n\n// Remove element from array and put another array at those position.\n// Useful for some operations with tokens\nfunction arrayReplaceAt(src, pos, newElements) {\n  return [].concat(src.slice(0, pos), newElements, src.slice(pos + 1));\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\nfunction isValidEntityCode(c) {\n  /*eslint no-bitwise:0*/\n  // broken sequence\n  if (c >= 0xD800 && c <= 0xDFFF) { return false; }\n  // never used\n  if (c >= 0xFDD0 && c <= 0xFDEF) { return false; }\n  if ((c & 0xFFFF) === 0xFFFF || (c & 0xFFFF) === 0xFFFE) { return false; }\n  // control codes\n  if (c >= 0x00 && c <= 0x08) { return false; }\n  if (c === 0x0B) { return false; }\n  if (c >= 0x0E && c <= 0x1F) { return false; }\n  if (c >= 0x7F && c <= 0x9F) { return false; }\n  // out of range\n  if (c > 0x10FFFF) { return false; }\n  return true;\n}\n\nfunction fromCodePoint(c) {\n  /*eslint no-bitwise:0*/\n  if (c > 0xffff) {\n    c -= 0x10000;\n    var surrogate1 = 0xd800 + (c >> 10),\n        surrogate2 = 0xdc00 + (c & 0x3ff);\n\n    return String.fromCharCode(surrogate1, surrogate2);\n  }\n  return String.fromCharCode(c);\n}\n\n\nvar UNESCAPE_MD_RE  = /\\\\([!\"#$%&'()*+,\\-.\\/:;<=>?@[\\\\\\]^_`{|}~])/g;\nvar ENTITY_RE       = /&([a-z#][a-z0-9]{1,31});/gi;\nvar UNESCAPE_ALL_RE = new RegExp(UNESCAPE_MD_RE.source + '|' + ENTITY_RE.source, 'gi');\n\nvar DIGITAL_ENTITY_TEST_RE = /^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;\n\nvar entities = require('./entities');\n\nfunction replaceEntityPattern(match, name) {\n  var code = 0;\n\n  if (has(entities, name)) {\n    return entities[name];\n  }\n\n  if (name.charCodeAt(0) === 0x23/* # */ && DIGITAL_ENTITY_TEST_RE.test(name)) {\n    code = name[1].toLowerCase() === 'x' ?\n      parseInt(name.slice(2), 16) : parseInt(name.slice(1), 10);\n\n    if (isValidEntityCode(code)) {\n      return fromCodePoint(code);\n    }\n  }\n\n  return match;\n}\n\n/*function replaceEntities(str) {\n  if (str.indexOf('&') < 0) { return str; }\n\n  return str.replace(ENTITY_RE, replaceEntityPattern);\n}*/\n\nfunction unescapeMd(str) {\n  if (str.indexOf('\\\\') < 0) { return str; }\n  return str.replace(UNESCAPE_MD_RE, '$1');\n}\n\nfunction unescapeAll(str) {\n  if (str.indexOf('\\\\') < 0 && str.indexOf('&') < 0) { return str; }\n\n  return str.replace(UNESCAPE_ALL_RE, function (match, escaped, entity) {\n    if (escaped) { return escaped; }\n    return replaceEntityPattern(match, entity);\n  });\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\nvar HTML_ESCAPE_TEST_RE = /[&<>\"]/;\nvar HTML_ESCAPE_REPLACE_RE = /[&<>\"]/g;\nvar HTML_REPLACEMENTS = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;'\n};\n\nfunction replaceUnsafeChar(ch) {\n  return HTML_REPLACEMENTS[ch];\n}\n\nfunction escapeHtml(str) {\n  if (HTML_ESCAPE_TEST_RE.test(str)) {\n    return str.replace(HTML_ESCAPE_REPLACE_RE, replaceUnsafeChar);\n  }\n  return str;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\nvar REGEXP_ESCAPE_RE = /[.?*+^$[\\]\\\\(){}|-]/g;\n\nfunction escapeRE(str) {\n  return str.replace(REGEXP_ESCAPE_RE, '\\\\$&');\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\nfunction isSpace(code) {\n  switch (code) {\n    case 0x09:\n    case 0x20:\n      return true;\n  }\n  return false;\n}\n\n// Zs (unicode class) || [\\t\\f\\v\\r\\n]\nfunction isWhiteSpace(code) {\n  if (code >= 0x2000 && code <= 0x200A) { return true; }\n  switch (code) {\n    case 0x09: // \\t\n    case 0x0A: // \\n\n    case 0x0B: // \\v\n    case 0x0C: // \\f\n    case 0x0D: // \\r\n    case 0x20:\n    case 0xA0:\n    case 0x1680:\n    case 0x202F:\n    case 0x205F:\n    case 0x3000:\n      return true;\n  }\n  return false;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/*eslint-disable max-len*/\nvar UNICODE_PUNCT_RE = require('uc.micro/categories/P/regex');\n\n// Currently without astral characters support.\nfunction isPunctChar(ch) {\n  return UNICODE_PUNCT_RE.test(ch);\n}\n\n\n// Markdown ASCII punctuation characters.\n//\n// !, \", #, $, %, &, ', (, ), *, +, ,, -, ., /, :, ;, <, =, >, ?, @, [, \\, ], ^, _, `, {, |, }, or ~\n// http://spec.commonmark.org/0.15/#ascii-punctuation-character\n//\n// Don't confuse with unicode punctuation !!! It lacks some chars in ascii range.\n//\nfunction isMdAsciiPunct(ch) {\n  switch (ch) {\n    case 0x21/* ! */:\n    case 0x22/* \" */:\n    case 0x23/* # */:\n    case 0x24/* $ */:\n    case 0x25/* % */:\n    case 0x26/* & */:\n    case 0x27/* ' */:\n    case 0x28/* ( */:\n    case 0x29/* ) */:\n    case 0x2A/* * */:\n    case 0x2B/* + */:\n    case 0x2C/* , */:\n    case 0x2D/* - */:\n    case 0x2E/* . */:\n    case 0x2F/* / */:\n    case 0x3A/* : */:\n    case 0x3B/* ; */:\n    case 0x3C/* < */:\n    case 0x3D/* = */:\n    case 0x3E/* > */:\n    case 0x3F/* ? */:\n    case 0x40/* @ */:\n    case 0x5B/* [ */:\n    case 0x5C/* \\ */:\n    case 0x5D/* ] */:\n    case 0x5E/* ^ */:\n    case 0x5F/* _ */:\n    case 0x60/* ` */:\n    case 0x7B/* { */:\n    case 0x7C/* | */:\n    case 0x7D/* } */:\n    case 0x7E/* ~ */:\n      return true;\n    default:\n      return false;\n  }\n}\n\n// Hepler to unify [reference labels].\n//\nfunction normalizeReference(str) {\n  // Trim and collapse whitespace\n  //\n  str = str.trim().replace(/\\s+/g, ' ');\n\n  // In node v10 'ẞ'.toLowerCase() === 'Ṿ', which is presumed to be a bug\n  // fixed in v12 (couldn't find any details).\n  //\n  // So treat this one as a special case\n  // (remove this when node v10 is no longer supported).\n  //\n  if ('ẞ'.toLowerCase() === 'Ṿ') {\n    str = str.replace(/ẞ/g, 'ß');\n  }\n\n  // .toLowerCase().toUpperCase() should get rid of all differences\n  // between letter variants.\n  //\n  // Simple .toLowerCase() doesn't normalize 125 code points correctly,\n  // and .toUpperCase doesn't normalize 6 of them (list of exceptions:\n  // İ, ϴ, ẞ, Ω, K, Å - those are already uppercased, but have differently\n  // uppercased versions).\n  //\n  // Here's an example showing how it happens. Lets take greek letter omega:\n  // uppercase U+0398 (Θ), U+03f4 (ϴ) and lowercase U+03b8 (θ), U+03d1 (ϑ)\n  //\n  // Unicode entries:\n  // 0398;GREEK CAPITAL LETTER THETA;Lu;0;L;;;;;N;;;;03B8;\n  // 03B8;GREEK SMALL LETTER THETA;Ll;0;L;;;;;N;;;0398;;0398\n  // 03D1;GREEK THETA SYMBOL;Ll;0;L;<compat> 03B8;;;;N;GREEK SMALL LETTER SCRIPT THETA;;0398;;0398\n  // 03F4;GREEK CAPITAL THETA SYMBOL;Lu;0;L;<compat> 0398;;;;N;;;;03B8;\n  //\n  // Case-insensitive comparison should treat all of them as equivalent.\n  //\n  // But .toLowerCase() doesn't change ϑ (it's already lowercase),\n  // and .toUpperCase() doesn't change ϴ (already uppercase).\n  //\n  // Applying first lower then upper case normalizes any character:\n  // '\\u0398\\u03f4\\u03b8\\u03d1'.toLowerCase().toUpperCase() === '\\u0398\\u0398\\u0398\\u0398'\n  //\n  // Note: this is equivalent to unicode case folding; unicode normalization\n  // is a different step that is not required here.\n  //\n  // Final result should be uppercased, because it's later stored in an object\n  // (this avoid a conflict with Object.prototype members,\n  // most notably, `__proto__`)\n  //\n  return str.toLowerCase().toUpperCase();\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n// Re-export libraries commonly used in both markdown-it and its plugins,\n// so plugins won't have to depend on them explicitly, which reduces their\n// bundled size (e.g. a browser build).\n//\nexports.lib                 = {};\nexports.lib.mdurl           = require('mdurl');\nexports.lib.ucmicro         = require('uc.micro');\n\nexports.assign              = assign;\nexports.isString            = isString;\nexports.has                 = has;\nexports.unescapeMd          = unescapeMd;\nexports.unescapeAll         = unescapeAll;\nexports.isValidEntityCode   = isValidEntityCode;\nexports.fromCodePoint       = fromCodePoint;\n// exports.replaceEntities     = replaceEntities;\nexports.escapeHtml          = escapeHtml;\nexports.arrayReplaceAt      = arrayReplaceAt;\nexports.isSpace             = isSpace;\nexports.isWhiteSpace        = isWhiteSpace;\nexports.isMdAsciiPunct      = isMdAsciiPunct;\nexports.isPunctChar         = isPunctChar;\nexports.escapeRE            = escapeRE;\nexports.normalizeReference  = normalizeReference;\n","// Parse link destination\n//\n'use strict';\n\n\nvar unescapeAll = require('../common/utils').unescapeAll;\n\n\nmodule.exports = function parseLinkDestination(str, pos, max) {\n  var code, level,\n      lines = 0,\n      start = pos,\n      result = {\n        ok: false,\n        pos: 0,\n        lines: 0,\n        str: ''\n      };\n\n  if (str.charCodeAt(pos) === 0x3C /* < */) {\n    pos++;\n    while (pos < max) {\n      code = str.charCodeAt(pos);\n      if (code === 0x0A /* \\n */) { return result; }\n      if (code === 0x3C /* < */) { return result; }\n      if (code === 0x3E /* > */) {\n        result.pos = pos + 1;\n        result.str = unescapeAll(str.slice(start + 1, pos));\n        result.ok = true;\n        return result;\n      }\n      if (code === 0x5C /* \\ */ && pos + 1 < max) {\n        pos += 2;\n        continue;\n      }\n\n      pos++;\n    }\n\n    // no closing '>'\n    return result;\n  }\n\n  // this should be ... } else { ... branch\n\n  level = 0;\n  while (pos < max) {\n    code = str.charCodeAt(pos);\n\n    if (code === 0x20) { break; }\n\n    // ascii control characters\n    if (code < 0x20 || code === 0x7F) { break; }\n\n    if (code === 0x5C /* \\ */ && pos + 1 < max) {\n      if (str.charCodeAt(pos + 1) === 0x20) { break; }\n      pos += 2;\n      continue;\n    }\n\n    if (code === 0x28 /* ( */) {\n      level++;\n      if (level > 32) { return result; }\n    }\n\n    if (code === 0x29 /* ) */) {\n      if (level === 0) { break; }\n      level--;\n    }\n\n    pos++;\n  }\n\n  if (start === pos) { return result; }\n  if (level !== 0) { return result; }\n\n  result.str = unescapeAll(str.slice(start, pos));\n  result.lines = lines;\n  result.pos = pos;\n  result.ok = true;\n  return result;\n};\n","// Parse link title\n//\n'use strict';\n\n\nvar unescapeAll = require('../common/utils').unescapeAll;\n\n\nmodule.exports = function parseLinkTitle(str, pos, max) {\n  var code,\n      marker,\n      lines = 0,\n      start = pos,\n      result = {\n        ok: false,\n        pos: 0,\n        lines: 0,\n        str: ''\n      };\n\n  if (pos >= max) { return result; }\n\n  marker = str.charCodeAt(pos);\n\n  if (marker !== 0x22 /* \" */ && marker !== 0x27 /* ' */ && marker !== 0x28 /* ( */) { return result; }\n\n  pos++;\n\n  // if opening marker is \"(\", switch it to closing marker \")\"\n  if (marker === 0x28) { marker = 0x29; }\n\n  while (pos < max) {\n    code = str.charCodeAt(pos);\n    if (code === marker) {\n      result.pos = pos + 1;\n      result.lines = lines;\n      result.str = unescapeAll(str.slice(start + 1, pos));\n      result.ok = true;\n      return result;\n    } else if (code === 0x28 /* ( */ && marker === 0x29 /* ) */) {\n      return result;\n    } else if (code === 0x0A) {\n      lines++;\n    } else if (code === 0x5C /* \\ */ && pos + 1 < max) {\n      pos++;\n      if (str.charCodeAt(pos) === 0x0A) {\n        lines++;\n      }\n    }\n\n    pos++;\n  }\n\n  return result;\n};\n","// Just a shortcut for bulk export\n'use strict';\n\n\nexports.parseLinkLabel       = require('./parse_link_label');\nexports.parseLinkDestination = require('./parse_link_destination');\nexports.parseLinkTitle       = require('./parse_link_title');\n","// Parse link label\n//\n// this function assumes that first character (\"[\") already matches;\n// returns the end of the label\n//\n'use strict';\n\nmodule.exports = function parseLinkLabel(state, start, disableNested) {\n  var level, found, marker, prevPos,\n      labelEnd = -1,\n      max = state.posMax,\n      oldPos = state.pos;\n\n  state.pos = start + 1;\n  level = 1;\n\n  while (state.pos < max) {\n    marker = state.src.charCodeAt(state.pos);\n    if (marker === 0x5D /* ] */) {\n      level--;\n      if (level === 0) {\n        found = true;\n        break;\n      }\n    }\n\n    prevPos = state.pos;\n    state.md.inline.skipToken(state);\n    if (marker === 0x5B /* [ */) {\n      if (prevPos === state.pos - 1) {\n        // increase level if we find text `[`, which is not a part of any token\n        level++;\n      } else if (disableNested) {\n        state.pos = oldPos;\n        return -1;\n      }\n    }\n  }\n\n  if (found) {\n    labelEnd = state.pos;\n  }\n\n  // restore old state\n  state.pos = oldPos;\n\n  return labelEnd;\n};\n","/**\n * class Renderer\n *\n * Generates HTML from parsed token stream. Each instance has independent\n * copy of rules. Those can be rewritten with ease. Also, you can add new\n * rules if you create plugin and adds new token types.\n **/\n'use strict';\n\n\nvar assign          = require('./common/utils').assign;\nvar unescapeAll     = require('./common/utils').unescapeAll;\nvar escapeHtml      = require('./common/utils').escapeHtml;\n\n\n////////////////////////////////////////////////////////////////////////////////\n\nvar default_rules = {};\n\n\ndefault_rules.code_inline = function (tokens, idx, options, env, slf) {\n  var token = tokens[idx];\n\n  return  '<code' + slf.renderAttrs(token) + '>' +\n          escapeHtml(tokens[idx].content) +\n          '</code>';\n};\n\n\ndefault_rules.code_block = function (tokens, idx, options, env, slf) {\n  var token = tokens[idx];\n\n  return  '<pre' + slf.renderAttrs(token) + '><code>' +\n          escapeHtml(tokens[idx].content) +\n          '</code></pre>\\n';\n};\n\n\ndefault_rules.fence = function (tokens, idx, options, env, slf) {\n  var token = tokens[idx],\n      info = token.info ? unescapeAll(token.info).trim() : '',\n      langName = '',\n      langAttrs = '',\n      highlighted, i, arr, tmpAttrs, tmpToken;\n\n  if (info) {\n    arr = info.split(/(\\s+)/g);\n    langName = arr[0];\n    langAttrs = arr.slice(2).join('');\n  }\n\n  if (options.highlight) {\n    highlighted = options.highlight(token.content, langName, langAttrs) || escapeHtml(token.content);\n  } else {\n    highlighted = escapeHtml(token.content);\n  }\n\n  if (highlighted.indexOf('<pre') === 0) {\n    return highlighted + '\\n';\n  }\n\n  // If language exists, inject class gently, without modifying original token.\n  // May be, one day we will add .deepClone() for token and simplify this part, but\n  // now we prefer to keep things local.\n  if (info) {\n    i        = token.attrIndex('class');\n    tmpAttrs = token.attrs ? token.attrs.slice() : [];\n\n    if (i < 0) {\n      tmpAttrs.push([ 'class', options.langPrefix + langName ]);\n    } else {\n      tmpAttrs[i] = tmpAttrs[i].slice();\n      tmpAttrs[i][1] += ' ' + options.langPrefix + langName;\n    }\n\n    // Fake token just to render attributes\n    tmpToken = {\n      attrs: tmpAttrs\n    };\n\n    return  '<pre><code' + slf.renderAttrs(tmpToken) + '>'\n          + highlighted\n          + '</code></pre>\\n';\n  }\n\n\n  return  '<pre><code' + slf.renderAttrs(token) + '>'\n        + highlighted\n        + '</code></pre>\\n';\n};\n\n\ndefault_rules.image = function (tokens, idx, options, env, slf) {\n  var token = tokens[idx];\n\n  // \"alt\" attr MUST be set, even if empty. Because it's mandatory and\n  // should be placed on proper position for tests.\n  //\n  // Replace content with actual value\n\n  token.attrs[token.attrIndex('alt')][1] =\n    slf.renderInlineAsText(token.children, options, env);\n\n  return slf.renderToken(tokens, idx, options);\n};\n\n\ndefault_rules.hardbreak = function (tokens, idx, options /*, env */) {\n  return options.xhtmlOut ? '<br />\\n' : '<br>\\n';\n};\ndefault_rules.softbreak = function (tokens, idx, options /*, env */) {\n  return options.breaks ? (options.xhtmlOut ? '<br />\\n' : '<br>\\n') : '\\n';\n};\n\n\ndefault_rules.text = function (tokens, idx /*, options, env */) {\n  return escapeHtml(tokens[idx].content);\n};\n\n\ndefault_rules.html_block = function (tokens, idx /*, options, env */) {\n  return tokens[idx].content;\n};\ndefault_rules.html_inline = function (tokens, idx /*, options, env */) {\n  return tokens[idx].content;\n};\n\n\n/**\n * new Renderer()\n *\n * Creates new [[Renderer]] instance and fill [[Renderer#rules]] with defaults.\n **/\nfunction Renderer() {\n\n  /**\n   * Renderer#rules -> Object\n   *\n   * Contains render rules for tokens. Can be updated and extended.\n   *\n   * ##### Example\n   *\n   * ```javascript\n   * var md = require('markdown-it')();\n   *\n   * md.renderer.rules.strong_open  = function () { return '<b>'; };\n   * md.renderer.rules.strong_close = function () { return '</b>'; };\n   *\n   * var result = md.renderInline(...);\n   * ```\n   *\n   * Each rule is called as independent static function with fixed signature:\n   *\n   * ```javascript\n   * function my_token_render(tokens, idx, options, env, renderer) {\n   *   // ...\n   *   return renderedHTML;\n   * }\n   * ```\n   *\n   * See [source code](https://github.com/markdown-it/markdown-it/blob/master/lib/renderer.js)\n   * for more details and examples.\n   **/\n  this.rules = assign({}, default_rules);\n}\n\n\n/**\n * Renderer.renderAttrs(token) -> String\n *\n * Render token attributes to string.\n **/\nRenderer.prototype.renderAttrs = function renderAttrs(token) {\n  var i, l, result;\n\n  if (!token.attrs) { return ''; }\n\n  result = '';\n\n  for (i = 0, l = token.attrs.length; i < l; i++) {\n    result += ' ' + escapeHtml(token.attrs[i][0]) + '=\"' + escapeHtml(token.attrs[i][1]) + '\"';\n  }\n\n  return result;\n};\n\n\n/**\n * Renderer.renderToken(tokens, idx, options) -> String\n * - tokens (Array): list of tokens\n * - idx (Numbed): token index to render\n * - options (Object): params of parser instance\n *\n * Default token renderer. Can be overriden by custom function\n * in [[Renderer#rules]].\n **/\nRenderer.prototype.renderToken = function renderToken(tokens, idx, options) {\n  var nextToken,\n      result = '',\n      needLf = false,\n      token = tokens[idx];\n\n  // Tight list paragraphs\n  if (token.hidden) {\n    return '';\n  }\n\n  // Insert a newline between hidden paragraph and subsequent opening\n  // block-level tag.\n  //\n  // For example, here we should insert a newline before blockquote:\n  //  - a\n  //    >\n  //\n  if (token.block && token.nesting !== -1 && idx && tokens[idx - 1].hidden) {\n    result += '\\n';\n  }\n\n  // Add token name, e.g. `<img`\n  result += (token.nesting === -1 ? '</' : '<') + token.tag;\n\n  // Encode attributes, e.g. `<img src=\"foo\"`\n  result += this.renderAttrs(token);\n\n  // Add a slash for self-closing tags, e.g. `<img src=\"foo\" /`\n  if (token.nesting === 0 && options.xhtmlOut) {\n    result += ' /';\n  }\n\n  // Check if we need to add a newline after this tag\n  if (token.block) {\n    needLf = true;\n\n    if (token.nesting === 1) {\n      if (idx + 1 < tokens.length) {\n        nextToken = tokens[idx + 1];\n\n        if (nextToken.type === 'inline' || nextToken.hidden) {\n          // Block-level tag containing an inline tag.\n          //\n          needLf = false;\n\n        } else if (nextToken.nesting === -1 && nextToken.tag === token.tag) {\n          // Opening tag + closing tag of the same type. E.g. `<li></li>`.\n          //\n          needLf = false;\n        }\n      }\n    }\n  }\n\n  result += needLf ? '>\\n' : '>';\n\n  return result;\n};\n\n\n/**\n * Renderer.renderInline(tokens, options, env) -> String\n * - tokens (Array): list on block tokens to render\n * - options (Object): params of parser instance\n * - env (Object): additional data from parsed input (references, for example)\n *\n * The same as [[Renderer.render]], but for single token of `inline` type.\n **/\nRenderer.prototype.renderInline = function (tokens, options, env) {\n  var type,\n      result = '',\n      rules = this.rules;\n\n  for (var i = 0, len = tokens.length; i < len; i++) {\n    type = tokens[i].type;\n\n    if (typeof rules[type] !== 'undefined') {\n      result += rules[type](tokens, i, options, env, this);\n    } else {\n      result += this.renderToken(tokens, i, options);\n    }\n  }\n\n  return result;\n};\n\n\n/** internal\n * Renderer.renderInlineAsText(tokens, options, env) -> String\n * - tokens (Array): list on block tokens to render\n * - options (Object): params of parser instance\n * - env (Object): additional data from parsed input (references, for example)\n *\n * Special kludge for image `alt` attributes to conform CommonMark spec.\n * Don't try to use it! Spec requires to show `alt` content with stripped markup,\n * instead of simple escaping.\n **/\nRenderer.prototype.renderInlineAsText = function (tokens, options, env) {\n  var result = '';\n\n  for (var i = 0, len = tokens.length; i < len; i++) {\n    if (tokens[i].type === 'text') {\n      result += tokens[i].content;\n    } else if (tokens[i].type === 'image') {\n      result += this.renderInlineAsText(tokens[i].children, options, env);\n    } else if (tokens[i].type === 'softbreak') {\n      result += '\\n';\n    }\n  }\n\n  return result;\n};\n\n\n/**\n * Renderer.render(tokens, options, env) -> String\n * - tokens (Array): list on block tokens to render\n * - options (Object): params of parser instance\n * - env (Object): additional data from parsed input (references, for example)\n *\n * Takes token stream and generates HTML. Probably, you will never need to call\n * this method directly.\n **/\nRenderer.prototype.render = function (tokens, options, env) {\n  var i, len, type,\n      result = '',\n      rules = this.rules;\n\n  for (i = 0, len = tokens.length; i < len; i++) {\n    type = tokens[i].type;\n\n    if (type === 'inline') {\n      result += this.renderInline(tokens[i].children, options, env);\n    } else if (typeof rules[type] !== 'undefined') {\n      result += rules[tokens[i].type](tokens, i, options, env, this);\n    } else {\n      result += this.renderToken(tokens, i, options, env);\n    }\n  }\n\n  return result;\n};\n\nmodule.exports = Renderer;\n","/**\n * class Ruler\n *\n * Helper class, used by [[MarkdownIt#core]], [[MarkdownIt#block]] and\n * [[MarkdownIt#inline]] to manage sequences of functions (rules):\n *\n * - keep rules in defined order\n * - assign the name to each rule\n * - enable/disable rules\n * - add/replace rules\n * - allow assign rules to additional named chains (in the same)\n * - cacheing lists of active rules\n *\n * You will not need use this class directly until write plugins. For simple\n * rules control use [[MarkdownIt.disable]], [[MarkdownIt.enable]] and\n * [[MarkdownIt.use]].\n **/\n'use strict';\n\n\n/**\n * new Ruler()\n **/\nfunction Ruler() {\n  // List of added rules. Each element is:\n  //\n  // {\n  //   name: XXX,\n  //   enabled: Boolean,\n  //   fn: Function(),\n  //   alt: [ name2, name3 ]\n  // }\n  //\n  this.__rules__ = [];\n\n  // Cached rule chains.\n  //\n  // First level - chain name, '' for default.\n  // Second level - diginal anchor for fast filtering by charcodes.\n  //\n  this.__cache__ = null;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Helper methods, should not be used directly\n\n\n// Find rule index by name\n//\nRuler.prototype.__find__ = function (name) {\n  for (var i = 0; i < this.__rules__.length; i++) {\n    if (this.__rules__[i].name === name) {\n      return i;\n    }\n  }\n  return -1;\n};\n\n\n// Build rules lookup cache\n//\nRuler.prototype.__compile__ = function () {\n  var self = this;\n  var chains = [ '' ];\n\n  // collect unique names\n  self.__rules__.forEach(function (rule) {\n    if (!rule.enabled) { return; }\n\n    rule.alt.forEach(function (altName) {\n      if (chains.indexOf(altName) < 0) {\n        chains.push(altName);\n      }\n    });\n  });\n\n  self.__cache__ = {};\n\n  chains.forEach(function (chain) {\n    self.__cache__[chain] = [];\n    self.__rules__.forEach(function (rule) {\n      if (!rule.enabled) { return; }\n\n      if (chain && rule.alt.indexOf(chain) < 0) { return; }\n\n      self.__cache__[chain].push(rule.fn);\n    });\n  });\n};\n\n\n/**\n * Ruler.at(name, fn [, options])\n * - name (String): rule name to replace.\n * - fn (Function): new rule function.\n * - options (Object): new rule options (not mandatory).\n *\n * Replace rule by name with new function & options. Throws error if name not\n * found.\n *\n * ##### Options:\n *\n * - __alt__ - array with names of \"alternate\" chains.\n *\n * ##### Example\n *\n * Replace existing typographer replacement rule with new one:\n *\n * ```javascript\n * var md = require('markdown-it')();\n *\n * md.core.ruler.at('replacements', function replace(state) {\n *   //...\n * });\n * ```\n **/\nRuler.prototype.at = function (name, fn, options) {\n  var index = this.__find__(name);\n  var opt = options || {};\n\n  if (index === -1) { throw new Error('Parser rule not found: ' + name); }\n\n  this.__rules__[index].fn = fn;\n  this.__rules__[index].alt = opt.alt || [];\n  this.__cache__ = null;\n};\n\n\n/**\n * Ruler.before(beforeName, ruleName, fn [, options])\n * - beforeName (String): new rule will be added before this one.\n * - ruleName (String): name of added rule.\n * - fn (Function): rule function.\n * - options (Object): rule options (not mandatory).\n *\n * Add new rule to chain before one with given name. See also\n * [[Ruler.after]], [[Ruler.push]].\n *\n * ##### Options:\n *\n * - __alt__ - array with names of \"alternate\" chains.\n *\n * ##### Example\n *\n * ```javascript\n * var md = require('markdown-it')();\n *\n * md.block.ruler.before('paragraph', 'my_rule', function replace(state) {\n *   //...\n * });\n * ```\n **/\nRuler.prototype.before = function (beforeName, ruleName, fn, options) {\n  var index = this.__find__(beforeName);\n  var opt = options || {};\n\n  if (index === -1) { throw new Error('Parser rule not found: ' + beforeName); }\n\n  this.__rules__.splice(index, 0, {\n    name: ruleName,\n    enabled: true,\n    fn: fn,\n    alt: opt.alt || []\n  });\n\n  this.__cache__ = null;\n};\n\n\n/**\n * Ruler.after(afterName, ruleName, fn [, options])\n * - afterName (String): new rule will be added after this one.\n * - ruleName (String): name of added rule.\n * - fn (Function): rule function.\n * - options (Object): rule options (not mandatory).\n *\n * Add new rule to chain after one with given name. See also\n * [[Ruler.before]], [[Ruler.push]].\n *\n * ##### Options:\n *\n * - __alt__ - array with names of \"alternate\" chains.\n *\n * ##### Example\n *\n * ```javascript\n * var md = require('markdown-it')();\n *\n * md.inline.ruler.after('text', 'my_rule', function replace(state) {\n *   //...\n * });\n * ```\n **/\nRuler.prototype.after = function (afterName, ruleName, fn, options) {\n  var index = this.__find__(afterName);\n  var opt = options || {};\n\n  if (index === -1) { throw new Error('Parser rule not found: ' + afterName); }\n\n  this.__rules__.splice(index + 1, 0, {\n    name: ruleName,\n    enabled: true,\n    fn: fn,\n    alt: opt.alt || []\n  });\n\n  this.__cache__ = null;\n};\n\n/**\n * Ruler.push(ruleName, fn [, options])\n * - ruleName (String): name of added rule.\n * - fn (Function): rule function.\n * - options (Object): rule options (not mandatory).\n *\n * Push new rule to the end of chain. See also\n * [[Ruler.before]], [[Ruler.after]].\n *\n * ##### Options:\n *\n * - __alt__ - array with names of \"alternate\" chains.\n *\n * ##### Example\n *\n * ```javascript\n * var md = require('markdown-it')();\n *\n * md.core.ruler.push('my_rule', function replace(state) {\n *   //...\n * });\n * ```\n **/\nRuler.prototype.push = function (ruleName, fn, options) {\n  var opt = options || {};\n\n  this.__rules__.push({\n    name: ruleName,\n    enabled: true,\n    fn: fn,\n    alt: opt.alt || []\n  });\n\n  this.__cache__ = null;\n};\n\n\n/**\n * Ruler.enable(list [, ignoreInvalid]) -> Array\n * - list (String|Array): list of rule names to enable.\n * - ignoreInvalid (Boolean): set `true` to ignore errors when rule not found.\n *\n * Enable rules with given names. If any rule name not found - throw Error.\n * Errors can be disabled by second param.\n *\n * Returns list of found rule names (if no exception happened).\n *\n * See also [[Ruler.disable]], [[Ruler.enableOnly]].\n **/\nRuler.prototype.enable = function (list, ignoreInvalid) {\n  if (!Array.isArray(list)) { list = [ list ]; }\n\n  var result = [];\n\n  // Search by name and enable\n  list.forEach(function (name) {\n    var idx = this.__find__(name);\n\n    if (idx < 0) {\n      if (ignoreInvalid) { return; }\n      throw new Error('Rules manager: invalid rule name ' + name);\n    }\n    this.__rules__[idx].enabled = true;\n    result.push(name);\n  }, this);\n\n  this.__cache__ = null;\n  return result;\n};\n\n\n/**\n * Ruler.enableOnly(list [, ignoreInvalid])\n * - list (String|Array): list of rule names to enable (whitelist).\n * - ignoreInvalid (Boolean): set `true` to ignore errors when rule not found.\n *\n * Enable rules with given names, and disable everything else. If any rule name\n * not found - throw Error. Errors can be disabled by second param.\n *\n * See also [[Ruler.disable]], [[Ruler.enable]].\n **/\nRuler.prototype.enableOnly = function (list, ignoreInvalid) {\n  if (!Array.isArray(list)) { list = [ list ]; }\n\n  this.__rules__.forEach(function (rule) { rule.enabled = false; });\n\n  this.enable(list, ignoreInvalid);\n};\n\n\n/**\n * Ruler.disable(list [, ignoreInvalid]) -> Array\n * - list (String|Array): list of rule names to disable.\n * - ignoreInvalid (Boolean): set `true` to ignore errors when rule not found.\n *\n * Disable rules with given names. If any rule name not found - throw Error.\n * Errors can be disabled by second param.\n *\n * Returns list of found rule names (if no exception happened).\n *\n * See also [[Ruler.enable]], [[Ruler.enableOnly]].\n **/\nRuler.prototype.disable = function (list, ignoreInvalid) {\n  if (!Array.isArray(list)) { list = [ list ]; }\n\n  var result = [];\n\n  // Search by name and disable\n  list.forEach(function (name) {\n    var idx = this.__find__(name);\n\n    if (idx < 0) {\n      if (ignoreInvalid) { return; }\n      throw new Error('Rules manager: invalid rule name ' + name);\n    }\n    this.__rules__[idx].enabled = false;\n    result.push(name);\n  }, this);\n\n  this.__cache__ = null;\n  return result;\n};\n\n\n/**\n * Ruler.getRules(chainName) -> Array\n *\n * Return array of active functions (rules) for given chain name. It analyzes\n * rules configuration, compiles caches if not exists and returns result.\n *\n * Default chain name is `''` (empty string). It can't be skipped. That's\n * done intentionally, to keep signature monomorphic for high speed.\n **/\nRuler.prototype.getRules = function (chainName) {\n  if (this.__cache__ === null) {\n    this.__compile__();\n  }\n\n  // Chain can be empty, if rules disabled. But we still have to return Array.\n  return this.__cache__[chainName] || [];\n};\n\nmodule.exports = Ruler;\n","// Normalize input string\n\n'use strict';\n\n\n// https://spec.commonmark.org/0.29/#line-ending\nvar NEWLINES_RE  = /\\r\\n?|\\n/g;\nvar NULL_RE      = /\\0/g;\n\n\nmodule.exports = function normalize(state) {\n  var str;\n\n  // Normalize newlines\n  str = state.src.replace(NEWLINES_RE, '\\n');\n\n  // Replace NULL characters\n  str = str.replace(NULL_RE, '\\uFFFD');\n\n  state.src = str;\n};\n","// Replace link-like texts with link nodes.\n//\n// Currently restricted by `md.validateLink()` to http/https/ftp\n//\n'use strict';\n\n\nvar arrayReplaceAt = require('../common/utils').arrayReplaceAt;\n\n\nfunction isLinkOpen(str) {\n  return /^<a[>\\s]/i.test(str);\n}\nfunction isLinkClose(str) {\n  return /^<\\/a\\s*>/i.test(str);\n}\n\n\nmodule.exports = function linkify(state) {\n  var i, j, l, tokens, token, currentToken, nodes, ln, text, pos, lastPos,\n      level, htmlLinkLevel, url, fullUrl, urlText,\n      blockTokens = state.tokens,\n      links;\n\n  if (!state.md.options.linkify) { return; }\n\n  for (j = 0, l = blockTokens.length; j < l; j++) {\n    if (blockTokens[j].type !== 'inline' ||\n        !state.md.linkify.pretest(blockTokens[j].content)) {\n      continue;\n    }\n\n    tokens = blockTokens[j].children;\n\n    htmlLinkLevel = 0;\n\n    // We scan from the end, to keep position when new tags added.\n    // Use reversed logic in links start/end match\n    for (i = tokens.length - 1; i >= 0; i--) {\n      currentToken = tokens[i];\n\n      // Skip content of markdown links\n      if (currentToken.type === 'link_close') {\n        i--;\n        while (tokens[i].level !== currentToken.level && tokens[i].type !== 'link_open') {\n          i--;\n        }\n        continue;\n      }\n\n      // Skip content of html tag links\n      if (currentToken.type === 'html_inline') {\n        if (isLinkOpen(currentToken.content) && htmlLinkLevel > 0) {\n          htmlLinkLevel--;\n        }\n        if (isLinkClose(currentToken.content)) {\n          htmlLinkLevel++;\n        }\n      }\n      if (htmlLinkLevel > 0) { continue; }\n\n      if (currentToken.type === 'text' && state.md.linkify.test(currentToken.content)) {\n\n        text = currentToken.content;\n        links = state.md.linkify.match(text);\n\n        // Now split string to nodes\n        nodes = [];\n        level = currentToken.level;\n        lastPos = 0;\n\n        // forbid escape sequence at the start of the string,\n        // this avoids http\\://example.com/ from being linkified as\n        // http:<a href=\"//example.com/\">//example.com/</a>\n        if (links.length > 0 &&\n            links[0].index === 0 &&\n            i > 0 &&\n            tokens[i - 1].type === 'text_special') {\n          links = links.slice(1);\n        }\n\n        for (ln = 0; ln < links.length; ln++) {\n          url = links[ln].url;\n          fullUrl = state.md.normalizeLink(url);\n          if (!state.md.validateLink(fullUrl)) { continue; }\n\n          urlText = links[ln].text;\n\n          // Linkifier might send raw hostnames like \"example.com\", where url\n          // starts with domain name. So we prepend http:// in those cases,\n          // and remove it afterwards.\n          //\n          if (!links[ln].schema) {\n            urlText = state.md.normalizeLinkText('http://' + urlText).replace(/^http:\\/\\//, '');\n          } else if (links[ln].schema === 'mailto:' && !/^mailto:/i.test(urlText)) {\n            urlText = state.md.normalizeLinkText('mailto:' + urlText).replace(/^mailto:/, '');\n          } else {\n            urlText = state.md.normalizeLinkText(urlText);\n          }\n\n          pos = links[ln].index;\n\n          if (pos > lastPos) {\n            token         = new state.Token('text', '', 0);\n            token.content = text.slice(lastPos, pos);\n            token.level   = level;\n            nodes.push(token);\n          }\n\n          token         = new state.Token('link_open', 'a', 1);\n          token.attrs   = [ [ 'href', fullUrl ] ];\n          token.level   = level++;\n          token.markup  = 'linkify';\n          token.info    = 'auto';\n          nodes.push(token);\n\n          token         = new state.Token('text', '', 0);\n          token.content = urlText;\n          token.level   = level;\n          nodes.push(token);\n\n          token         = new state.Token('link_close', 'a', -1);\n          token.level   = --level;\n          token.markup  = 'linkify';\n          token.info    = 'auto';\n          nodes.push(token);\n\n          lastPos = links[ln].lastIndex;\n        }\n        if (lastPos < text.length) {\n          token         = new state.Token('text', '', 0);\n          token.content = text.slice(lastPos);\n          token.level   = level;\n          nodes.push(token);\n        }\n\n        // replace current node\n        blockTokens[j].children = tokens = arrayReplaceAt(tokens, i, nodes);\n      }\n    }\n  }\n};\n","// Simple typographic replacements\n//\n// (c) (C) → ©\n// (tm) (TM) → ™\n// (r) (R) → ®\n// +- → ±\n// (p) (P) -> §\n// ... → … (also ?.... → ?.., !.... → !..)\n// ???????? → ???, !!!!! → !!!, `,,` → `,`\n// -- → &ndash;, --- → &mdash;\n//\n'use strict';\n\n// TODO:\n// - fractionals 1/2, 1/4, 3/4 -> ½, ¼, ¾\n// - multiplications 2 x 4 -> 2 × 4\n\nvar RARE_RE = /\\+-|\\.\\.|\\?\\?\\?\\?|!!!!|,,|--/;\n\n// Workaround for phantomjs - need regex without /g flag,\n// or root check will fail every second time\nvar SCOPED_ABBR_TEST_RE = /\\((c|tm|r)\\)/i;\n\nvar SCOPED_ABBR_RE = /\\((c|tm|r)\\)/ig;\nvar SCOPED_ABBR = {\n  c: '©',\n  r: '®',\n  tm: '™'\n};\n\nfunction replaceFn(match, name) {\n  return SCOPED_ABBR[name.toLowerCase()];\n}\n\nfunction replace_scoped(inlineTokens) {\n  var i, token, inside_autolink = 0;\n\n  for (i = inlineTokens.length - 1; i >= 0; i--) {\n    token = inlineTokens[i];\n\n    if (token.type === 'text' && !inside_autolink) {\n      token.content = token.content.replace(SCOPED_ABBR_RE, replaceFn);\n    }\n\n    if (token.type === 'link_open' && token.info === 'auto') {\n      inside_autolink--;\n    }\n\n    if (token.type === 'link_close' && token.info === 'auto') {\n      inside_autolink++;\n    }\n  }\n}\n\nfunction replace_rare(inlineTokens) {\n  var i, token, inside_autolink = 0;\n\n  for (i = inlineTokens.length - 1; i >= 0; i--) {\n    token = inlineTokens[i];\n\n    if (token.type === 'text' && !inside_autolink) {\n      if (RARE_RE.test(token.content)) {\n        token.content = token.content\n          .replace(/\\+-/g, '±')\n          // .., ..., ....... -> …\n          // but ?..... & !..... -> ?.. & !..\n          .replace(/\\.{2,}/g, '…').replace(/([?!])…/g, '$1..')\n          .replace(/([?!]){4,}/g, '$1$1$1').replace(/,{2,}/g, ',')\n          // em-dash\n          .replace(/(^|[^-])---(?=[^-]|$)/mg, '$1\\u2014')\n          // en-dash\n          .replace(/(^|\\s)--(?=\\s|$)/mg, '$1\\u2013')\n          .replace(/(^|[^-\\s])--(?=[^-\\s]|$)/mg, '$1\\u2013');\n      }\n    }\n\n    if (token.type === 'link_open' && token.info === 'auto') {\n      inside_autolink--;\n    }\n\n    if (token.type === 'link_close' && token.info === 'auto') {\n      inside_autolink++;\n    }\n  }\n}\n\n\nmodule.exports = function replace(state) {\n  var blkIdx;\n\n  if (!state.md.options.typographer) { return; }\n\n  for (blkIdx = state.tokens.length - 1; blkIdx >= 0; blkIdx--) {\n\n    if (state.tokens[blkIdx].type !== 'inline') { continue; }\n\n    if (SCOPED_ABBR_TEST_RE.test(state.tokens[blkIdx].content)) {\n      replace_scoped(state.tokens[blkIdx].children);\n    }\n\n    if (RARE_RE.test(state.tokens[blkIdx].content)) {\n      replace_rare(state.tokens[blkIdx].children);\n    }\n\n  }\n};\n","// Convert straight quotation marks to typographic ones\n//\n'use strict';\n\n\nvar isWhiteSpace   = require('../common/utils').isWhiteSpace;\nvar isPunctChar    = require('../common/utils').isPunctChar;\nvar isMdAsciiPunct = require('../common/utils').isMdAsciiPunct;\n\nvar QUOTE_TEST_RE = /['\"]/;\nvar QUOTE_RE = /['\"]/g;\nvar APOSTROPHE = '\\u2019'; /* ’ */\n\n\nfunction replaceAt(str, index, ch) {\n  return str.slice(0, index) + ch + str.slice(index + 1);\n}\n\nfunction process_inlines(tokens, state) {\n  var i, token, text, t, pos, max, thisLevel, item, lastChar, nextChar,\n      isLastPunctChar, isNextPunctChar, isLastWhiteSpace, isNextWhiteSpace,\n      canOpen, canClose, j, isSingle, stack, openQuote, closeQuote;\n\n  stack = [];\n\n  for (i = 0; i < tokens.length; i++) {\n    token = tokens[i];\n\n    thisLevel = tokens[i].level;\n\n    for (j = stack.length - 1; j >= 0; j--) {\n      if (stack[j].level <= thisLevel) { break; }\n    }\n    stack.length = j + 1;\n\n    if (token.type !== 'text') { continue; }\n\n    text = token.content;\n    pos = 0;\n    max = text.length;\n\n    /*eslint no-labels:0,block-scoped-var:0*/\n    OUTER:\n    while (pos < max) {\n      QUOTE_RE.lastIndex = pos;\n      t = QUOTE_RE.exec(text);\n      if (!t) { break; }\n\n      canOpen = canClose = true;\n      pos = t.index + 1;\n      isSingle = (t[0] === \"'\");\n\n      // Find previous character,\n      // default to space if it's the beginning of the line\n      //\n      lastChar = 0x20;\n\n      if (t.index - 1 >= 0) {\n        lastChar = text.charCodeAt(t.index - 1);\n      } else {\n        for (j = i - 1; j >= 0; j--) {\n          if (tokens[j].type === 'softbreak' || tokens[j].type === 'hardbreak') break; // lastChar defaults to 0x20\n          if (!tokens[j].content) continue; // should skip all tokens except 'text', 'html_inline' or 'code_inline'\n\n          lastChar = tokens[j].content.charCodeAt(tokens[j].content.length - 1);\n          break;\n        }\n      }\n\n      // Find next character,\n      // default to space if it's the end of the line\n      //\n      nextChar = 0x20;\n\n      if (pos < max) {\n        nextChar = text.charCodeAt(pos);\n      } else {\n        for (j = i + 1; j < tokens.length; j++) {\n          if (tokens[j].type === 'softbreak' || tokens[j].type === 'hardbreak') break; // nextChar defaults to 0x20\n          if (!tokens[j].content) continue; // should skip all tokens except 'text', 'html_inline' or 'code_inline'\n\n          nextChar = tokens[j].content.charCodeAt(0);\n          break;\n        }\n      }\n\n      isLastPunctChar = isMdAsciiPunct(lastChar) || isPunctChar(String.fromCharCode(lastChar));\n      isNextPunctChar = isMdAsciiPunct(nextChar) || isPunctChar(String.fromCharCode(nextChar));\n\n      isLastWhiteSpace = isWhiteSpace(lastChar);\n      isNextWhiteSpace = isWhiteSpace(nextChar);\n\n      if (isNextWhiteSpace) {\n        canOpen = false;\n      } else if (isNextPunctChar) {\n        if (!(isLastWhiteSpace || isLastPunctChar)) {\n          canOpen = false;\n        }\n      }\n\n      if (isLastWhiteSpace) {\n        canClose = false;\n      } else if (isLastPunctChar) {\n        if (!(isNextWhiteSpace || isNextPunctChar)) {\n          canClose = false;\n        }\n      }\n\n      if (nextChar === 0x22 /* \" */ && t[0] === '\"') {\n        if (lastChar >= 0x30 /* 0 */ && lastChar <= 0x39 /* 9 */) {\n          // special case: 1\"\" - count first quote as an inch\n          canClose = canOpen = false;\n        }\n      }\n\n      if (canOpen && canClose) {\n        // Replace quotes in the middle of punctuation sequence, but not\n        // in the middle of the words, i.e.:\n        //\n        // 1. foo \" bar \" baz - not replaced\n        // 2. foo-\"-bar-\"-baz - replaced\n        // 3. foo\"bar\"baz     - not replaced\n        //\n        canOpen = isLastPunctChar;\n        canClose = isNextPunctChar;\n      }\n\n      if (!canOpen && !canClose) {\n        // middle of word\n        if (isSingle) {\n          token.content = replaceAt(token.content, t.index, APOSTROPHE);\n        }\n        continue;\n      }\n\n      if (canClose) {\n        // this could be a closing quote, rewind the stack to get a match\n        for (j = stack.length - 1; j >= 0; j--) {\n          item = stack[j];\n          if (stack[j].level < thisLevel) { break; }\n          if (item.single === isSingle && stack[j].level === thisLevel) {\n            item = stack[j];\n\n            if (isSingle) {\n              openQuote = state.md.options.quotes[2];\n              closeQuote = state.md.options.quotes[3];\n            } else {\n              openQuote = state.md.options.quotes[0];\n              closeQuote = state.md.options.quotes[1];\n            }\n\n            // replace token.content *before* tokens[item.token].content,\n            // because, if they are pointing at the same token, replaceAt\n            // could mess up indices when quote length != 1\n            token.content = replaceAt(token.content, t.index, closeQuote);\n            tokens[item.token].content = replaceAt(\n              tokens[item.token].content, item.pos, openQuote);\n\n            pos += closeQuote.length - 1;\n            if (item.token === i) { pos += openQuote.length - 1; }\n\n            text = token.content;\n            max = text.length;\n\n            stack.length = j;\n            continue OUTER;\n          }\n        }\n      }\n\n      if (canOpen) {\n        stack.push({\n          token: i,\n          pos: t.index,\n          single: isSingle,\n          level: thisLevel\n        });\n      } else if (canClose && isSingle) {\n        token.content = replaceAt(token.content, t.index, APOSTROPHE);\n      }\n    }\n  }\n}\n\n\nmodule.exports = function smartquotes(state) {\n  /*eslint max-depth:0*/\n  var blkIdx;\n\n  if (!state.md.options.typographer) { return; }\n\n  for (blkIdx = state.tokens.length - 1; blkIdx >= 0; blkIdx--) {\n\n    if (state.tokens[blkIdx].type !== 'inline' ||\n        !QUOTE_TEST_RE.test(state.tokens[blkIdx].content)) {\n      continue;\n    }\n\n    process_inlines(state.tokens[blkIdx].children, state);\n  }\n};\n","// Token class\n\n'use strict';\n\n\n/**\n * class Token\n **/\n\n/**\n * new Token(type, tag, nesting)\n *\n * Create new token and fill passed properties.\n **/\nfunction Token(type, tag, nesting) {\n  /**\n   * Token#type -> String\n   *\n   * Type of the token (string, e.g. \"paragraph_open\")\n   **/\n  this.type     = type;\n\n  /**\n   * Token#tag -> String\n   *\n   * html tag name, e.g. \"p\"\n   **/\n  this.tag      = tag;\n\n  /**\n   * Token#attrs -> Array\n   *\n   * Html attributes. Format: `[ [ name1, value1 ], [ name2, value2 ] ]`\n   **/\n  this.attrs    = null;\n\n  /**\n   * Token#map -> Array\n   *\n   * Source map info. Format: `[ line_begin, line_end ]`\n   **/\n  this.map      = null;\n\n  /**\n   * Token#nesting -> Number\n   *\n   * Level change (number in {-1, 0, 1} set), where:\n   *\n   * -  `1` means the tag is opening\n   * -  `0` means the tag is self-closing\n   * - `-1` means the tag is closing\n   **/\n  this.nesting  = nesting;\n\n  /**\n   * Token#level -> Number\n   *\n   * nesting level, the same as `state.level`\n   **/\n  this.level    = 0;\n\n  /**\n   * Token#children -> Array\n   *\n   * An array of child nodes (inline and img tokens)\n   **/\n  this.children = null;\n\n  /**\n   * Token#content -> String\n   *\n   * In a case of self-closing tag (code, html, fence, etc.),\n   * it has contents of this tag.\n   **/\n  this.content  = '';\n\n  /**\n   * Token#markup -> String\n   *\n   * '*' or '_' for emphasis, fence string for fence, etc.\n   **/\n  this.markup   = '';\n\n  /**\n   * Token#info -> String\n   *\n   * Additional information:\n   *\n   * - Info string for \"fence\" tokens\n   * - The value \"auto\" for autolink \"link_open\" and \"link_close\" tokens\n   * - The string value of the item marker for ordered-list \"list_item_open\" tokens\n   **/\n  this.info     = '';\n\n  /**\n   * Token#meta -> Object\n   *\n   * A place for plugins to store an arbitrary data\n   **/\n  this.meta     = null;\n\n  /**\n   * Token#block -> Boolean\n   *\n   * True for block-level tokens, false for inline tokens.\n   * Used in renderer to calculate line breaks\n   **/\n  this.block    = false;\n\n  /**\n   * Token#hidden -> Boolean\n   *\n   * If it's true, ignore this element when rendering. Used for tight lists\n   * to hide paragraphs.\n   **/\n  this.hidden   = false;\n}\n\n\n/**\n * Token.attrIndex(name) -> Number\n *\n * Search attribute index by name.\n **/\nToken.prototype.attrIndex = function attrIndex(name) {\n  var attrs, i, len;\n\n  if (!this.attrs) { return -1; }\n\n  attrs = this.attrs;\n\n  for (i = 0, len = attrs.length; i < len; i++) {\n    if (attrs[i][0] === name) { return i; }\n  }\n  return -1;\n};\n\n\n/**\n * Token.attrPush(attrData)\n *\n * Add `[ name, value ]` attribute to list. Init attrs if necessary\n **/\nToken.prototype.attrPush = function attrPush(attrData) {\n  if (this.attrs) {\n    this.attrs.push(attrData);\n  } else {\n    this.attrs = [ attrData ];\n  }\n};\n\n\n/**\n * Token.attrSet(name, value)\n *\n * Set `name` attribute to `value`. Override old value if exists.\n **/\nToken.prototype.attrSet = function attrSet(name, value) {\n  var idx = this.attrIndex(name),\n      attrData = [ name, value ];\n\n  if (idx < 0) {\n    this.attrPush(attrData);\n  } else {\n    this.attrs[idx] = attrData;\n  }\n};\n\n\n/**\n * Token.attrGet(name)\n *\n * Get the value of attribute `name`, or null if it does not exist.\n **/\nToken.prototype.attrGet = function attrGet(name) {\n  var idx = this.attrIndex(name), value = null;\n  if (idx >= 0) {\n    value = this.attrs[idx][1];\n  }\n  return value;\n};\n\n\n/**\n * Token.attrJoin(name, value)\n *\n * Join value to existing attribute via space. Or create new attribute if not\n * exists. Useful to operate with token classes.\n **/\nToken.prototype.attrJoin = function attrJoin(name, value) {\n  var idx = this.attrIndex(name);\n\n  if (idx < 0) {\n    this.attrPush([ name, value ]);\n  } else {\n    this.attrs[idx][1] = this.attrs[idx][1] + ' ' + value;\n  }\n};\n\n\nmodule.exports = Token;\n","// Core state object\n//\n'use strict';\n\nvar Token = require('../token');\n\n\nfunction StateCore(src, md, env) {\n  this.src = src;\n  this.env = env;\n  this.tokens = [];\n  this.inlineMode = false;\n  this.md = md; // link to parser instance\n}\n\n// re-export Token class to use in core rules\nStateCore.prototype.Token = Token;\n\n\nmodule.exports = StateCore;\n","/** internal\n * class Core\n *\n * Top-level rules executor. Glues block/inline parsers and does intermediate\n * transformations.\n **/\n'use strict';\n\n\nvar Ruler  = require('./ruler');\n\n\nvar _rules = [\n  [ 'normalize',      require('./rules_core/normalize')      ],\n  [ 'block',          require('./rules_core/block')          ],\n  [ 'inline',         require('./rules_core/inline')         ],\n  [ 'linkify',        require('./rules_core/linkify')        ],\n  [ 'replacements',   require('./rules_core/replacements')   ],\n  [ 'smartquotes',    require('./rules_core/smartquotes')    ],\n  // `text_join` finds `text_special` tokens (for escape sequences)\n  // and joins them with the rest of the text\n  [ 'text_join',      require('./rules_core/text_join')      ]\n];\n\n\n/**\n * new Core()\n **/\nfunction Core() {\n  /**\n   * Core#ruler -> Ruler\n   *\n   * [[Ruler]] instance. Keep configuration of core rules.\n   **/\n  this.ruler = new Ruler();\n\n  for (var i = 0; i < _rules.length; i++) {\n    this.ruler.push(_rules[i][0], _rules[i][1]);\n  }\n}\n\n\n/**\n * Core.process(state)\n *\n * Executes core chain rules.\n **/\nCore.prototype.process = function (state) {\n  var i, l, rules;\n\n  rules = this.ruler.getRules('');\n\n  for (i = 0, l = rules.length; i < l; i++) {\n    rules[i](state);\n  }\n};\n\nCore.prototype.State = require('./rules_core/state_core');\n\n\nmodule.exports = Core;\n","'use strict';\n\n\nmodule.exports = function block(state) {\n  var token;\n\n  if (state.inlineMode) {\n    token          = new state.Token('inline', '', 0);\n    token.content  = state.src;\n    token.map      = [ 0, 1 ];\n    token.children = [];\n    state.tokens.push(token);\n  } else {\n    state.md.block.parse(state.src, state.md, state.env, state.tokens);\n  }\n};\n","'use strict';\n\nmodule.exports = function inline(state) {\n  var tokens = state.tokens, tok, i, l;\n\n  // Parse inlines\n  for (i = 0, l = tokens.length; i < l; i++) {\n    tok = tokens[i];\n    if (tok.type === 'inline') {\n      state.md.inline.parse(tok.content, state.md, state.env, tok.children);\n    }\n  }\n};\n","// Join raw text tokens with the rest of the text\n//\n// This is set as a separate rule to provide an opportunity for plugins\n// to run text replacements after text join, but before escape join.\n//\n// For example, `\\:)` shouldn't be replaced with an emoji.\n//\n'use strict';\n\n\nmodule.exports = function text_join(state) {\n  var j, l, tokens, curr, max, last,\n      blockTokens = state.tokens;\n\n  for (j = 0, l = blockTokens.length; j < l; j++) {\n    if (blockTokens[j].type !== 'inline') continue;\n\n    tokens = blockTokens[j].children;\n    max = tokens.length;\n\n    for (curr = 0; curr < max; curr++) {\n      if (tokens[curr].type === 'text_special') {\n        tokens[curr].type = 'text';\n      }\n    }\n\n    for (curr = last = 0; curr < max; curr++) {\n      if (tokens[curr].type === 'text' &&\n          curr + 1 < max &&\n          tokens[curr + 1].type === 'text') {\n\n        // collapse two adjacent text nodes\n        tokens[curr + 1].content = tokens[curr].content + tokens[curr + 1].content;\n      } else {\n        if (curr !== last) { tokens[last] = tokens[curr]; }\n\n        last++;\n      }\n    }\n\n    if (curr !== last) {\n      tokens.length = last;\n    }\n  }\n};\n","// GFM table, https://github.github.com/gfm/#tables-extension-\n\n'use strict';\n\nvar isSpace = require('../common/utils').isSpace;\n\n\nfunction getLine(state, line) {\n  var pos = state.bMarks[line] + state.tShift[line],\n      max = state.eMarks[line];\n\n  return state.src.slice(pos, max);\n}\n\nfunction escapedSplit(str) {\n  var result = [],\n      pos = 0,\n      max = str.length,\n      ch,\n      isEscaped = false,\n      lastPos = 0,\n      current = '';\n\n  ch  = str.charCodeAt(pos);\n\n  while (pos < max) {\n    if (ch === 0x7c/* | */) {\n      if (!isEscaped) {\n        // pipe separating cells, '|'\n        result.push(current + str.substring(lastPos, pos));\n        current = '';\n        lastPos = pos + 1;\n      } else {\n        // escaped pipe, '\\|'\n        current += str.substring(lastPos, pos - 1);\n        lastPos = pos;\n      }\n    }\n\n    isEscaped = (ch === 0x5c/* \\ */);\n    pos++;\n\n    ch = str.charCodeAt(pos);\n  }\n\n  result.push(current + str.substring(lastPos));\n\n  return result;\n}\n\n\nmodule.exports = function table(state, startLine, endLine, silent) {\n  var ch, lineText, pos, i, l, nextLine, columns, columnCount, token,\n      aligns, t, tableLines, tbodyLines, oldParentType, terminate,\n      terminatorRules, firstCh, secondCh;\n\n  // should have at least two lines\n  if (startLine + 2 > endLine) { return false; }\n\n  nextLine = startLine + 1;\n\n  if (state.sCount[nextLine] < state.blkIndent) { return false; }\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[nextLine] - state.blkIndent >= 4) { return false; }\n\n  // first character of the second line should be '|', '-', ':',\n  // and no other characters are allowed but spaces;\n  // basically, this is the equivalent of /^[-:|][-:|\\s]*$/ regexp\n\n  pos = state.bMarks[nextLine] + state.tShift[nextLine];\n  if (pos >= state.eMarks[nextLine]) { return false; }\n\n  firstCh = state.src.charCodeAt(pos++);\n  if (firstCh !== 0x7C/* | */ && firstCh !== 0x2D/* - */ && firstCh !== 0x3A/* : */) { return false; }\n\n  if (pos >= state.eMarks[nextLine]) { return false; }\n\n  secondCh = state.src.charCodeAt(pos++);\n  if (secondCh !== 0x7C/* | */ && secondCh !== 0x2D/* - */ && secondCh !== 0x3A/* : */ && !isSpace(secondCh)) {\n    return false;\n  }\n\n  // if first character is '-', then second character must not be a space\n  // (due to parsing ambiguity with list)\n  if (firstCh === 0x2D/* - */ && isSpace(secondCh)) { return false; }\n\n  while (pos < state.eMarks[nextLine]) {\n    ch = state.src.charCodeAt(pos);\n\n    if (ch !== 0x7C/* | */ && ch !== 0x2D/* - */ && ch !== 0x3A/* : */ && !isSpace(ch)) { return false; }\n\n    pos++;\n  }\n\n  lineText = getLine(state, startLine + 1);\n\n  columns = lineText.split('|');\n  aligns = [];\n  for (i = 0; i < columns.length; i++) {\n    t = columns[i].trim();\n    if (!t) {\n      // allow empty columns before and after table, but not in between columns;\n      // e.g. allow ` |---| `, disallow ` ---||--- `\n      if (i === 0 || i === columns.length - 1) {\n        continue;\n      } else {\n        return false;\n      }\n    }\n\n    if (!/^:?-+:?$/.test(t)) { return false; }\n    if (t.charCodeAt(t.length - 1) === 0x3A/* : */) {\n      aligns.push(t.charCodeAt(0) === 0x3A/* : */ ? 'center' : 'right');\n    } else if (t.charCodeAt(0) === 0x3A/* : */) {\n      aligns.push('left');\n    } else {\n      aligns.push('');\n    }\n  }\n\n  lineText = getLine(state, startLine).trim();\n  if (lineText.indexOf('|') === -1) { return false; }\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n  columns = escapedSplit(lineText);\n  if (columns.length && columns[0] === '') columns.shift();\n  if (columns.length && columns[columns.length - 1] === '') columns.pop();\n\n  // header row will define an amount of columns in the entire table,\n  // and align row should be exactly the same (the rest of the rows can differ)\n  columnCount = columns.length;\n  if (columnCount === 0 || columnCount !== aligns.length) { return false; }\n\n  if (silent) { return true; }\n\n  oldParentType = state.parentType;\n  state.parentType = 'table';\n\n  // use 'blockquote' lists for termination because it's\n  // the most similar to tables\n  terminatorRules = state.md.block.ruler.getRules('blockquote');\n\n  token     = state.push('table_open', 'table', 1);\n  token.map = tableLines = [ startLine, 0 ];\n\n  token     = state.push('thead_open', 'thead', 1);\n  token.map = [ startLine, startLine + 1 ];\n\n  token     = state.push('tr_open', 'tr', 1);\n  token.map = [ startLine, startLine + 1 ];\n\n  for (i = 0; i < columns.length; i++) {\n    token          = state.push('th_open', 'th', 1);\n    if (aligns[i]) {\n      token.attrs  = [ [ 'style', 'text-align:' + aligns[i] ] ];\n    }\n\n    token          = state.push('inline', '', 0);\n    token.content  = columns[i].trim();\n    token.children = [];\n\n    token          = state.push('th_close', 'th', -1);\n  }\n\n  token     = state.push('tr_close', 'tr', -1);\n  token     = state.push('thead_close', 'thead', -1);\n\n  for (nextLine = startLine + 2; nextLine < endLine; nextLine++) {\n    if (state.sCount[nextLine] < state.blkIndent) { break; }\n\n    terminate = false;\n    for (i = 0, l = terminatorRules.length; i < l; i++) {\n      if (terminatorRules[i](state, nextLine, endLine, true)) {\n        terminate = true;\n        break;\n      }\n    }\n\n    if (terminate) { break; }\n    lineText = getLine(state, nextLine).trim();\n    if (!lineText) { break; }\n    if (state.sCount[nextLine] - state.blkIndent >= 4) { break; }\n    columns = escapedSplit(lineText);\n    if (columns.length && columns[0] === '') columns.shift();\n    if (columns.length && columns[columns.length - 1] === '') columns.pop();\n\n    if (nextLine === startLine + 2) {\n      token     = state.push('tbody_open', 'tbody', 1);\n      token.map = tbodyLines = [ startLine + 2, 0 ];\n    }\n\n    token     = state.push('tr_open', 'tr', 1);\n    token.map = [ nextLine, nextLine + 1 ];\n\n    for (i = 0; i < columnCount; i++) {\n      token          = state.push('td_open', 'td', 1);\n      if (aligns[i]) {\n        token.attrs  = [ [ 'style', 'text-align:' + aligns[i] ] ];\n      }\n\n      token          = state.push('inline', '', 0);\n      token.content  = columns[i] ? columns[i].trim() : '';\n      token.children = [];\n\n      token          = state.push('td_close', 'td', -1);\n    }\n    token = state.push('tr_close', 'tr', -1);\n  }\n\n  if (tbodyLines) {\n    token = state.push('tbody_close', 'tbody', -1);\n    tbodyLines[1] = nextLine;\n  }\n\n  token = state.push('table_close', 'table', -1);\n  tableLines[1] = nextLine;\n\n  state.parentType = oldParentType;\n  state.line = nextLine;\n  return true;\n};\n","// Block quotes\n\n'use strict';\n\nvar isSpace = require('../common/utils').isSpace;\n\n\nmodule.exports = function blockquote(state, startLine, endLine, silent) {\n  var adjustTab,\n      ch,\n      i,\n      initial,\n      l,\n      lastLineEmpty,\n      lines,\n      nextLine,\n      offset,\n      oldBMarks,\n      oldBSCount,\n      oldIndent,\n      oldParentType,\n      oldSCount,\n      oldTShift,\n      spaceAfterMarker,\n      terminate,\n      terminatorRules,\n      token,\n      isOutdented,\n      oldLineMax = state.lineMax,\n      pos = state.bMarks[startLine] + state.tShift[startLine],\n      max = state.eMarks[startLine];\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  // check the block quote marker\n  if (state.src.charCodeAt(pos++) !== 0x3E/* > */) { return false; }\n\n  // we know that it's going to be a valid blockquote,\n  // so no point trying to find the end of it in silent mode\n  if (silent) { return true; }\n\n  // set offset past spaces and \">\"\n  initial = offset = state.sCount[startLine] + 1;\n\n  // skip one optional space after '>'\n  if (state.src.charCodeAt(pos) === 0x20 /* space */) {\n    // ' >   test '\n    //     ^ -- position start of line here:\n    pos++;\n    initial++;\n    offset++;\n    adjustTab = false;\n    spaceAfterMarker = true;\n  } else if (state.src.charCodeAt(pos) === 0x09 /* tab */) {\n    spaceAfterMarker = true;\n\n    if ((state.bsCount[startLine] + offset) % 4 === 3) {\n      // '  >\\t  test '\n      //       ^ -- position start of line here (tab has width===1)\n      pos++;\n      initial++;\n      offset++;\n      adjustTab = false;\n    } else {\n      // ' >\\t  test '\n      //    ^ -- position start of line here + shift bsCount slightly\n      //         to make extra space appear\n      adjustTab = true;\n    }\n  } else {\n    spaceAfterMarker = false;\n  }\n\n  oldBMarks = [ state.bMarks[startLine] ];\n  state.bMarks[startLine] = pos;\n\n  while (pos < max) {\n    ch = state.src.charCodeAt(pos);\n\n    if (isSpace(ch)) {\n      if (ch === 0x09) {\n        offset += 4 - (offset + state.bsCount[startLine] + (adjustTab ? 1 : 0)) % 4;\n      } else {\n        offset++;\n      }\n    } else {\n      break;\n    }\n\n    pos++;\n  }\n\n  oldBSCount = [ state.bsCount[startLine] ];\n  state.bsCount[startLine] = state.sCount[startLine] + 1 + (spaceAfterMarker ? 1 : 0);\n\n  lastLineEmpty = pos >= max;\n\n  oldSCount = [ state.sCount[startLine] ];\n  state.sCount[startLine] = offset - initial;\n\n  oldTShift = [ state.tShift[startLine] ];\n  state.tShift[startLine] = pos - state.bMarks[startLine];\n\n  terminatorRules = state.md.block.ruler.getRules('blockquote');\n\n  oldParentType = state.parentType;\n  state.parentType = 'blockquote';\n\n  // Search the end of the block\n  //\n  // Block ends with either:\n  //  1. an empty line outside:\n  //     ```\n  //     > test\n  //\n  //     ```\n  //  2. an empty line inside:\n  //     ```\n  //     >\n  //     test\n  //     ```\n  //  3. another tag:\n  //     ```\n  //     > test\n  //      - - -\n  //     ```\n  for (nextLine = startLine + 1; nextLine < endLine; nextLine++) {\n    // check if it's outdented, i.e. it's inside list item and indented\n    // less than said list item:\n    //\n    // ```\n    // 1. anything\n    //    > current blockquote\n    // 2. checking this line\n    // ```\n    isOutdented = state.sCount[nextLine] < state.blkIndent;\n\n    pos = state.bMarks[nextLine] + state.tShift[nextLine];\n    max = state.eMarks[nextLine];\n\n    if (pos >= max) {\n      // Case 1: line is not inside the blockquote, and this line is empty.\n      break;\n    }\n\n    if (state.src.charCodeAt(pos++) === 0x3E/* > */ && !isOutdented) {\n      // This line is inside the blockquote.\n\n      // set offset past spaces and \">\"\n      initial = offset = state.sCount[nextLine] + 1;\n\n      // skip one optional space after '>'\n      if (state.src.charCodeAt(pos) === 0x20 /* space */) {\n        // ' >   test '\n        //     ^ -- position start of line here:\n        pos++;\n        initial++;\n        offset++;\n        adjustTab = false;\n        spaceAfterMarker = true;\n      } else if (state.src.charCodeAt(pos) === 0x09 /* tab */) {\n        spaceAfterMarker = true;\n\n        if ((state.bsCount[nextLine] + offset) % 4 === 3) {\n          // '  >\\t  test '\n          //       ^ -- position start of line here (tab has width===1)\n          pos++;\n          initial++;\n          offset++;\n          adjustTab = false;\n        } else {\n          // ' >\\t  test '\n          //    ^ -- position start of line here + shift bsCount slightly\n          //         to make extra space appear\n          adjustTab = true;\n        }\n      } else {\n        spaceAfterMarker = false;\n      }\n\n      oldBMarks.push(state.bMarks[nextLine]);\n      state.bMarks[nextLine] = pos;\n\n      while (pos < max) {\n        ch = state.src.charCodeAt(pos);\n\n        if (isSpace(ch)) {\n          if (ch === 0x09) {\n            offset += 4 - (offset + state.bsCount[nextLine] + (adjustTab ? 1 : 0)) % 4;\n          } else {\n            offset++;\n          }\n        } else {\n          break;\n        }\n\n        pos++;\n      }\n\n      lastLineEmpty = pos >= max;\n\n      oldBSCount.push(state.bsCount[nextLine]);\n      state.bsCount[nextLine] = state.sCount[nextLine] + 1 + (spaceAfterMarker ? 1 : 0);\n\n      oldSCount.push(state.sCount[nextLine]);\n      state.sCount[nextLine] = offset - initial;\n\n      oldTShift.push(state.tShift[nextLine]);\n      state.tShift[nextLine] = pos - state.bMarks[nextLine];\n      continue;\n    }\n\n    // Case 2: line is not inside the blockquote, and the last line was empty.\n    if (lastLineEmpty) { break; }\n\n    // Case 3: another tag found.\n    terminate = false;\n    for (i = 0, l = terminatorRules.length; i < l; i++) {\n      if (terminatorRules[i](state, nextLine, endLine, true)) {\n        terminate = true;\n        break;\n      }\n    }\n\n    if (terminate) {\n      // Quirk to enforce \"hard termination mode\" for paragraphs;\n      // normally if you call `tokenize(state, startLine, nextLine)`,\n      // paragraphs will look below nextLine for paragraph continuation,\n      // but if blockquote is terminated by another tag, they shouldn't\n      state.lineMax = nextLine;\n\n      if (state.blkIndent !== 0) {\n        // state.blkIndent was non-zero, we now set it to zero,\n        // so we need to re-calculate all offsets to appear as\n        // if indent wasn't changed\n        oldBMarks.push(state.bMarks[nextLine]);\n        oldBSCount.push(state.bsCount[nextLine]);\n        oldTShift.push(state.tShift[nextLine]);\n        oldSCount.push(state.sCount[nextLine]);\n        state.sCount[nextLine] -= state.blkIndent;\n      }\n\n      break;\n    }\n\n    oldBMarks.push(state.bMarks[nextLine]);\n    oldBSCount.push(state.bsCount[nextLine]);\n    oldTShift.push(state.tShift[nextLine]);\n    oldSCount.push(state.sCount[nextLine]);\n\n    // A negative indentation means that this is a paragraph continuation\n    //\n    state.sCount[nextLine] = -1;\n  }\n\n  oldIndent = state.blkIndent;\n  state.blkIndent = 0;\n\n  token        = state.push('blockquote_open', 'blockquote', 1);\n  token.markup = '>';\n  token.map    = lines = [ startLine, 0 ];\n\n  state.md.block.tokenize(state, startLine, nextLine);\n\n  token        = state.push('blockquote_close', 'blockquote', -1);\n  token.markup = '>';\n\n  state.lineMax = oldLineMax;\n  state.parentType = oldParentType;\n  lines[1] = state.line;\n\n  // Restore original tShift; this might not be necessary since the parser\n  // has already been here, but just to make sure we can do that.\n  for (i = 0; i < oldTShift.length; i++) {\n    state.bMarks[i + startLine] = oldBMarks[i];\n    state.tShift[i + startLine] = oldTShift[i];\n    state.sCount[i + startLine] = oldSCount[i];\n    state.bsCount[i + startLine] = oldBSCount[i];\n  }\n  state.blkIndent = oldIndent;\n\n  return true;\n};\n","// Horizontal rule\n\n'use strict';\n\nvar isSpace = require('../common/utils').isSpace;\n\n\nmodule.exports = function hr(state, startLine, endLine, silent) {\n  var marker, cnt, ch, token,\n      pos = state.bMarks[startLine] + state.tShift[startLine],\n      max = state.eMarks[startLine];\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  marker = state.src.charCodeAt(pos++);\n\n  // Check hr marker\n  if (marker !== 0x2A/* * */ &&\n      marker !== 0x2D/* - */ &&\n      marker !== 0x5F/* _ */) {\n    return false;\n  }\n\n  // markers can be mixed with spaces, but there should be at least 3 of them\n\n  cnt = 1;\n  while (pos < max) {\n    ch = state.src.charCodeAt(pos++);\n    if (ch !== marker && !isSpace(ch)) { return false; }\n    if (ch === marker) { cnt++; }\n  }\n\n  if (cnt < 3) { return false; }\n\n  if (silent) { return true; }\n\n  state.line = startLine + 1;\n\n  token        = state.push('hr', 'hr', 0);\n  token.map    = [ startLine, state.line ];\n  token.markup = Array(cnt + 1).join(String.fromCharCode(marker));\n\n  return true;\n};\n","// Lists\n\n'use strict';\n\nvar isSpace = require('../common/utils').isSpace;\n\n\n// Search `[-+*][\\n ]`, returns next pos after marker on success\n// or -1 on fail.\nfunction skipBulletListMarker(state, startLine) {\n  var marker, pos, max, ch;\n\n  pos = state.bMarks[startLine] + state.tShift[startLine];\n  max = state.eMarks[startLine];\n\n  marker = state.src.charCodeAt(pos++);\n  // Check bullet\n  if (marker !== 0x2A/* * */ &&\n      marker !== 0x2D/* - */ &&\n      marker !== 0x2B/* + */) {\n    return -1;\n  }\n\n  if (pos < max) {\n    ch = state.src.charCodeAt(pos);\n\n    if (!isSpace(ch)) {\n      // \" -test \" - is not a list item\n      return -1;\n    }\n  }\n\n  return pos;\n}\n\n// Search `\\d+[.)][\\n ]`, returns next pos after marker on success\n// or -1 on fail.\nfunction skipOrderedListMarker(state, startLine) {\n  var ch,\n      start = state.bMarks[startLine] + state.tShift[startLine],\n      pos = start,\n      max = state.eMarks[startLine];\n\n  // List marker should have at least 2 chars (digit + dot)\n  if (pos + 1 >= max) { return -1; }\n\n  ch = state.src.charCodeAt(pos++);\n\n  if (ch < 0x30/* 0 */ || ch > 0x39/* 9 */) { return -1; }\n\n  for (;;) {\n    // EOL -> fail\n    if (pos >= max) { return -1; }\n\n    ch = state.src.charCodeAt(pos++);\n\n    if (ch >= 0x30/* 0 */ && ch <= 0x39/* 9 */) {\n\n      // List marker should have no more than 9 digits\n      // (prevents integer overflow in browsers)\n      if (pos - start >= 10) { return -1; }\n\n      continue;\n    }\n\n    // found valid marker\n    if (ch === 0x29/* ) */ || ch === 0x2e/* . */) {\n      break;\n    }\n\n    return -1;\n  }\n\n\n  if (pos < max) {\n    ch = state.src.charCodeAt(pos);\n\n    if (!isSpace(ch)) {\n      // \" 1.test \" - is not a list item\n      return -1;\n    }\n  }\n  return pos;\n}\n\nfunction markTightParagraphs(state, idx) {\n  var i, l,\n      level = state.level + 2;\n\n  for (i = idx + 2, l = state.tokens.length - 2; i < l; i++) {\n    if (state.tokens[i].level === level && state.tokens[i].type === 'paragraph_open') {\n      state.tokens[i + 2].hidden = true;\n      state.tokens[i].hidden = true;\n      i += 2;\n    }\n  }\n}\n\n\nmodule.exports = function list(state, startLine, endLine, silent) {\n  var ch,\n      contentStart,\n      i,\n      indent,\n      indentAfterMarker,\n      initial,\n      isOrdered,\n      itemLines,\n      l,\n      listLines,\n      listTokIdx,\n      markerCharCode,\n      markerValue,\n      max,\n      nextLine,\n      offset,\n      oldListIndent,\n      oldParentType,\n      oldSCount,\n      oldTShift,\n      oldTight,\n      pos,\n      posAfterMarker,\n      prevEmptyEnd,\n      start,\n      terminate,\n      terminatorRules,\n      token,\n      isTerminatingParagraph = false,\n      tight = true;\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  // Special case:\n  //  - item 1\n  //   - item 2\n  //    - item 3\n  //     - item 4\n  //      - this one is a paragraph continuation\n  if (state.listIndent >= 0 &&\n      state.sCount[startLine] - state.listIndent >= 4 &&\n      state.sCount[startLine] < state.blkIndent) {\n    return false;\n  }\n\n  // limit conditions when list can interrupt\n  // a paragraph (validation mode only)\n  if (silent && state.parentType === 'paragraph') {\n    // Next list item should still terminate previous list item;\n    //\n    // This code can fail if plugins use blkIndent as well as lists,\n    // but I hope the spec gets fixed long before that happens.\n    //\n    if (state.sCount[startLine] >= state.blkIndent) {\n      isTerminatingParagraph = true;\n    }\n  }\n\n  // Detect list type and position after marker\n  if ((posAfterMarker = skipOrderedListMarker(state, startLine)) >= 0) {\n    isOrdered = true;\n    start = state.bMarks[startLine] + state.tShift[startLine];\n    markerValue = Number(state.src.slice(start, posAfterMarker - 1));\n\n    // If we're starting a new ordered list right after\n    // a paragraph, it should start with 1.\n    if (isTerminatingParagraph && markerValue !== 1) return false;\n\n  } else if ((posAfterMarker = skipBulletListMarker(state, startLine)) >= 0) {\n    isOrdered = false;\n\n  } else {\n    return false;\n  }\n\n  // If we're starting a new unordered list right after\n  // a paragraph, first line should not be empty.\n  if (isTerminatingParagraph) {\n    if (state.skipSpaces(posAfterMarker) >= state.eMarks[startLine]) return false;\n  }\n\n  // We should terminate list on style change. Remember first one to compare.\n  markerCharCode = state.src.charCodeAt(posAfterMarker - 1);\n\n  // For validation mode we can terminate immediately\n  if (silent) { return true; }\n\n  // Start list\n  listTokIdx = state.tokens.length;\n\n  if (isOrdered) {\n    token       = state.push('ordered_list_open', 'ol', 1);\n    if (markerValue !== 1) {\n      token.attrs = [ [ 'start', markerValue ] ];\n    }\n\n  } else {\n    token       = state.push('bullet_list_open', 'ul', 1);\n  }\n\n  token.map    = listLines = [ startLine, 0 ];\n  token.markup = String.fromCharCode(markerCharCode);\n\n  //\n  // Iterate list items\n  //\n\n  nextLine = startLine;\n  prevEmptyEnd = false;\n  terminatorRules = state.md.block.ruler.getRules('list');\n\n  oldParentType = state.parentType;\n  state.parentType = 'list';\n\n  while (nextLine < endLine) {\n    pos = posAfterMarker;\n    max = state.eMarks[nextLine];\n\n    initial = offset = state.sCount[nextLine] + posAfterMarker - (state.bMarks[startLine] + state.tShift[startLine]);\n\n    while (pos < max) {\n      ch = state.src.charCodeAt(pos);\n\n      if (ch === 0x09) {\n        offset += 4 - (offset + state.bsCount[nextLine]) % 4;\n      } else if (ch === 0x20) {\n        offset++;\n      } else {\n        break;\n      }\n\n      pos++;\n    }\n\n    contentStart = pos;\n\n    if (contentStart >= max) {\n      // trimming space in \"-    \\n  3\" case, indent is 1 here\n      indentAfterMarker = 1;\n    } else {\n      indentAfterMarker = offset - initial;\n    }\n\n    // If we have more than 4 spaces, the indent is 1\n    // (the rest is just indented code block)\n    if (indentAfterMarker > 4) { indentAfterMarker = 1; }\n\n    // \"  -  test\"\n    //  ^^^^^ - calculating total length of this thing\n    indent = initial + indentAfterMarker;\n\n    // Run subparser & write tokens\n    token        = state.push('list_item_open', 'li', 1);\n    token.markup = String.fromCharCode(markerCharCode);\n    token.map    = itemLines = [ startLine, 0 ];\n    if (isOrdered) {\n      token.info = state.src.slice(start, posAfterMarker - 1);\n    }\n\n    // change current state, then restore it after parser subcall\n    oldTight = state.tight;\n    oldTShift = state.tShift[startLine];\n    oldSCount = state.sCount[startLine];\n\n    //  - example list\n    // ^ listIndent position will be here\n    //   ^ blkIndent position will be here\n    //\n    oldListIndent = state.listIndent;\n    state.listIndent = state.blkIndent;\n    state.blkIndent = indent;\n\n    state.tight = true;\n    state.tShift[startLine] = contentStart - state.bMarks[startLine];\n    state.sCount[startLine] = offset;\n\n    if (contentStart >= max && state.isEmpty(startLine + 1)) {\n      // workaround for this case\n      // (list item is empty, list terminates before \"foo\"):\n      // ~~~~~~~~\n      //   -\n      //\n      //     foo\n      // ~~~~~~~~\n      state.line = Math.min(state.line + 2, endLine);\n    } else {\n      state.md.block.tokenize(state, startLine, endLine, true);\n    }\n\n    // If any of list item is tight, mark list as tight\n    if (!state.tight || prevEmptyEnd) {\n      tight = false;\n    }\n    // Item become loose if finish with empty line,\n    // but we should filter last element, because it means list finish\n    prevEmptyEnd = (state.line - startLine) > 1 && state.isEmpty(state.line - 1);\n\n    state.blkIndent = state.listIndent;\n    state.listIndent = oldListIndent;\n    state.tShift[startLine] = oldTShift;\n    state.sCount[startLine] = oldSCount;\n    state.tight = oldTight;\n\n    token        = state.push('list_item_close', 'li', -1);\n    token.markup = String.fromCharCode(markerCharCode);\n\n    nextLine = startLine = state.line;\n    itemLines[1] = nextLine;\n    contentStart = state.bMarks[startLine];\n\n    if (nextLine >= endLine) { break; }\n\n    //\n    // Try to check if list is terminated or continued.\n    //\n    if (state.sCount[nextLine] < state.blkIndent) { break; }\n\n    // if it's indented more than 3 spaces, it should be a code block\n    if (state.sCount[startLine] - state.blkIndent >= 4) { break; }\n\n    // fail if terminating block found\n    terminate = false;\n    for (i = 0, l = terminatorRules.length; i < l; i++) {\n      if (terminatorRules[i](state, nextLine, endLine, true)) {\n        terminate = true;\n        break;\n      }\n    }\n    if (terminate) { break; }\n\n    // fail if list has another type\n    if (isOrdered) {\n      posAfterMarker = skipOrderedListMarker(state, nextLine);\n      if (posAfterMarker < 0) { break; }\n      start = state.bMarks[nextLine] + state.tShift[nextLine];\n    } else {\n      posAfterMarker = skipBulletListMarker(state, nextLine);\n      if (posAfterMarker < 0) { break; }\n    }\n\n    if (markerCharCode !== state.src.charCodeAt(posAfterMarker - 1)) { break; }\n  }\n\n  // Finalize list\n  if (isOrdered) {\n    token = state.push('ordered_list_close', 'ol', -1);\n  } else {\n    token = state.push('bullet_list_close', 'ul', -1);\n  }\n  token.markup = String.fromCharCode(markerCharCode);\n\n  listLines[1] = nextLine;\n  state.line = nextLine;\n\n  state.parentType = oldParentType;\n\n  // mark paragraphs tight if needed\n  if (tight) {\n    markTightParagraphs(state, listTokIdx);\n  }\n\n  return true;\n};\n","'use strict';\n\n\nvar normalizeReference   = require('../common/utils').normalizeReference;\nvar isSpace              = require('../common/utils').isSpace;\n\n\nmodule.exports = function reference(state, startLine, _endLine, silent) {\n  var ch,\n      destEndPos,\n      destEndLineNo,\n      endLine,\n      href,\n      i,\n      l,\n      label,\n      labelEnd,\n      oldParentType,\n      res,\n      start,\n      str,\n      terminate,\n      terminatorRules,\n      title,\n      lines = 0,\n      pos = state.bMarks[startLine] + state.tShift[startLine],\n      max = state.eMarks[startLine],\n      nextLine = startLine + 1;\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  if (state.src.charCodeAt(pos) !== 0x5B/* [ */) { return false; }\n\n  // Simple check to quickly interrupt scan on [link](url) at the start of line.\n  // Can be useful on practice: https://github.com/markdown-it/markdown-it/issues/54\n  while (++pos < max) {\n    if (state.src.charCodeAt(pos) === 0x5D /* ] */ &&\n        state.src.charCodeAt(pos - 1) !== 0x5C/* \\ */) {\n      if (pos + 1 === max) { return false; }\n      if (state.src.charCodeAt(pos + 1) !== 0x3A/* : */) { return false; }\n      break;\n    }\n  }\n\n  endLine = state.lineMax;\n\n  // jump line-by-line until empty one or EOF\n  terminatorRules = state.md.block.ruler.getRules('reference');\n\n  oldParentType = state.parentType;\n  state.parentType = 'reference';\n\n  for (; nextLine < endLine && !state.isEmpty(nextLine); nextLine++) {\n    // this would be a code block normally, but after paragraph\n    // it's considered a lazy continuation regardless of what's there\n    if (state.sCount[nextLine] - state.blkIndent > 3) { continue; }\n\n    // quirk for blockquotes, this line should already be checked by that rule\n    if (state.sCount[nextLine] < 0) { continue; }\n\n    // Some tags can terminate paragraph without empty line.\n    terminate = false;\n    for (i = 0, l = terminatorRules.length; i < l; i++) {\n      if (terminatorRules[i](state, nextLine, endLine, true)) {\n        terminate = true;\n        break;\n      }\n    }\n    if (terminate) { break; }\n  }\n\n  str = state.getLines(startLine, nextLine, state.blkIndent, false).trim();\n  max = str.length;\n\n  for (pos = 1; pos < max; pos++) {\n    ch = str.charCodeAt(pos);\n    if (ch === 0x5B /* [ */) {\n      return false;\n    } else if (ch === 0x5D /* ] */) {\n      labelEnd = pos;\n      break;\n    } else if (ch === 0x0A /* \\n */) {\n      lines++;\n    } else if (ch === 0x5C /* \\ */) {\n      pos++;\n      if (pos < max && str.charCodeAt(pos) === 0x0A) {\n        lines++;\n      }\n    }\n  }\n\n  if (labelEnd < 0 || str.charCodeAt(labelEnd + 1) !== 0x3A/* : */) { return false; }\n\n  // [label]:   destination   'title'\n  //         ^^^ skip optional whitespace here\n  for (pos = labelEnd + 2; pos < max; pos++) {\n    ch = str.charCodeAt(pos);\n    if (ch === 0x0A) {\n      lines++;\n    } else if (isSpace(ch)) {\n      /*eslint no-empty:0*/\n    } else {\n      break;\n    }\n  }\n\n  // [label]:   destination   'title'\n  //            ^^^^^^^^^^^ parse this\n  res = state.md.helpers.parseLinkDestination(str, pos, max);\n  if (!res.ok) { return false; }\n\n  href = state.md.normalizeLink(res.str);\n  if (!state.md.validateLink(href)) { return false; }\n\n  pos = res.pos;\n  lines += res.lines;\n\n  // save cursor state, we could require to rollback later\n  destEndPos = pos;\n  destEndLineNo = lines;\n\n  // [label]:   destination   'title'\n  //                       ^^^ skipping those spaces\n  start = pos;\n  for (; pos < max; pos++) {\n    ch = str.charCodeAt(pos);\n    if (ch === 0x0A) {\n      lines++;\n    } else if (isSpace(ch)) {\n      /*eslint no-empty:0*/\n    } else {\n      break;\n    }\n  }\n\n  // [label]:   destination   'title'\n  //                          ^^^^^^^ parse this\n  res = state.md.helpers.parseLinkTitle(str, pos, max);\n  if (pos < max && start !== pos && res.ok) {\n    title = res.str;\n    pos = res.pos;\n    lines += res.lines;\n  } else {\n    title = '';\n    pos = destEndPos;\n    lines = destEndLineNo;\n  }\n\n  // skip trailing spaces until the rest of the line\n  while (pos < max) {\n    ch = str.charCodeAt(pos);\n    if (!isSpace(ch)) { break; }\n    pos++;\n  }\n\n  if (pos < max && str.charCodeAt(pos) !== 0x0A) {\n    if (title) {\n      // garbage at the end of the line after title,\n      // but it could still be a valid reference if we roll back\n      title = '';\n      pos = destEndPos;\n      lines = destEndLineNo;\n      while (pos < max) {\n        ch = str.charCodeAt(pos);\n        if (!isSpace(ch)) { break; }\n        pos++;\n      }\n    }\n  }\n\n  if (pos < max && str.charCodeAt(pos) !== 0x0A) {\n    // garbage at the end of the line\n    return false;\n  }\n\n  label = normalizeReference(str.slice(1, labelEnd));\n  if (!label) {\n    // CommonMark 0.20 disallows empty labels\n    return false;\n  }\n\n  // Reference can not terminate anything. This check is for safety only.\n  /*istanbul ignore if*/\n  if (silent) { return true; }\n\n  if (typeof state.env.references === 'undefined') {\n    state.env.references = {};\n  }\n  if (typeof state.env.references[label] === 'undefined') {\n    state.env.references[label] = { title: title, href: href };\n  }\n\n  state.parentType = oldParentType;\n\n  state.line = startLine + lines + 1;\n  return true;\n};\n","// Regexps to match html elements\n\n'use strict';\n\nvar attr_name     = '[a-zA-Z_:][a-zA-Z0-9:._-]*';\n\nvar unquoted      = '[^\"\\'=<>`\\\\x00-\\\\x20]+';\nvar single_quoted = \"'[^']*'\";\nvar double_quoted = '\"[^\"]*\"';\n\nvar attr_value  = '(?:' + unquoted + '|' + single_quoted + '|' + double_quoted + ')';\n\nvar attribute   = '(?:\\\\s+' + attr_name + '(?:\\\\s*=\\\\s*' + attr_value + ')?)';\n\nvar open_tag    = '<[A-Za-z][A-Za-z0-9\\\\-]*' + attribute + '*\\\\s*\\\\/?>';\n\nvar close_tag   = '<\\\\/[A-Za-z][A-Za-z0-9\\\\-]*\\\\s*>';\nvar comment     = '<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->';\nvar processing  = '<[?][\\\\s\\\\S]*?[?]>';\nvar declaration = '<![A-Z]+\\\\s+[^>]*>';\nvar cdata       = '<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>';\n\nvar HTML_TAG_RE = new RegExp('^(?:' + open_tag + '|' + close_tag + '|' + comment +\n                        '|' + processing + '|' + declaration + '|' + cdata + ')');\nvar HTML_OPEN_CLOSE_TAG_RE = new RegExp('^(?:' + open_tag + '|' + close_tag + ')');\n\nmodule.exports.HTML_TAG_RE = HTML_TAG_RE;\nmodule.exports.HTML_OPEN_CLOSE_TAG_RE = HTML_OPEN_CLOSE_TAG_RE;\n","// HTML block\n\n'use strict';\n\n\nvar block_names = require('../common/html_blocks');\nvar HTML_OPEN_CLOSE_TAG_RE = require('../common/html_re').HTML_OPEN_CLOSE_TAG_RE;\n\n// An array of opening and corresponding closing sequences for html tags,\n// last argument defines whether it can terminate a paragraph or not\n//\nvar HTML_SEQUENCES = [\n  [ /^<(script|pre|style|textarea)(?=(\\s|>|$))/i, /<\\/(script|pre|style|textarea)>/i, true ],\n  [ /^<!--/,        /-->/,   true ],\n  [ /^<\\?/,         /\\?>/,   true ],\n  [ /^<![A-Z]/,     />/,     true ],\n  [ /^<!\\[CDATA\\[/, /\\]\\]>/, true ],\n  [ new RegExp('^</?(' + block_names.join('|') + ')(?=(\\\\s|/?>|$))', 'i'), /^$/, true ],\n  [ new RegExp(HTML_OPEN_CLOSE_TAG_RE.source + '\\\\s*$'),  /^$/, false ]\n];\n\n\nmodule.exports = function html_block(state, startLine, endLine, silent) {\n  var i, nextLine, token, lineText,\n      pos = state.bMarks[startLine] + state.tShift[startLine],\n      max = state.eMarks[startLine];\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  if (!state.md.options.html) { return false; }\n\n  if (state.src.charCodeAt(pos) !== 0x3C/* < */) { return false; }\n\n  lineText = state.src.slice(pos, max);\n\n  for (i = 0; i < HTML_SEQUENCES.length; i++) {\n    if (HTML_SEQUENCES[i][0].test(lineText)) { break; }\n  }\n\n  if (i === HTML_SEQUENCES.length) { return false; }\n\n  if (silent) {\n    // true if this sequence can be a terminator, false otherwise\n    return HTML_SEQUENCES[i][2];\n  }\n\n  nextLine = startLine + 1;\n\n  // If we are here - we detected HTML block.\n  // Let's roll down till block end.\n  if (!HTML_SEQUENCES[i][1].test(lineText)) {\n    for (; nextLine < endLine; nextLine++) {\n      if (state.sCount[nextLine] < state.blkIndent) { break; }\n\n      pos = state.bMarks[nextLine] + state.tShift[nextLine];\n      max = state.eMarks[nextLine];\n      lineText = state.src.slice(pos, max);\n\n      if (HTML_SEQUENCES[i][1].test(lineText)) {\n        if (lineText.length !== 0) { nextLine++; }\n        break;\n      }\n    }\n  }\n\n  state.line = nextLine;\n\n  token         = state.push('html_block', '', 0);\n  token.map     = [ startLine, nextLine ];\n  token.content = state.getLines(startLine, nextLine, state.blkIndent, true);\n\n  return true;\n};\n","// List of valid html blocks names, accorting to commonmark spec\n// http://jgm.github.io/CommonMark/spec.html#html-blocks\n\n'use strict';\n\n\nmodule.exports = [\n  'address',\n  'article',\n  'aside',\n  'base',\n  'basefont',\n  'blockquote',\n  'body',\n  'caption',\n  'center',\n  'col',\n  'colgroup',\n  'dd',\n  'details',\n  'dialog',\n  'dir',\n  'div',\n  'dl',\n  'dt',\n  'fieldset',\n  'figcaption',\n  'figure',\n  'footer',\n  'form',\n  'frame',\n  'frameset',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'head',\n  'header',\n  'hr',\n  'html',\n  'iframe',\n  'legend',\n  'li',\n  'link',\n  'main',\n  'menu',\n  'menuitem',\n  'nav',\n  'noframes',\n  'ol',\n  'optgroup',\n  'option',\n  'p',\n  'param',\n  'section',\n  'source',\n  'summary',\n  'table',\n  'tbody',\n  'td',\n  'tfoot',\n  'th',\n  'thead',\n  'title',\n  'tr',\n  'track',\n  'ul'\n];\n","// heading (#, ##, ...)\n\n'use strict';\n\nvar isSpace = require('../common/utils').isSpace;\n\n\nmodule.exports = function heading(state, startLine, endLine, silent) {\n  var ch, level, tmp, token,\n      pos = state.bMarks[startLine] + state.tShift[startLine],\n      max = state.eMarks[startLine];\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  ch  = state.src.charCodeAt(pos);\n\n  if (ch !== 0x23/* # */ || pos >= max) { return false; }\n\n  // count heading level\n  level = 1;\n  ch = state.src.charCodeAt(++pos);\n  while (ch === 0x23/* # */ && pos < max && level <= 6) {\n    level++;\n    ch = state.src.charCodeAt(++pos);\n  }\n\n  if (level > 6 || (pos < max && !isSpace(ch))) { return false; }\n\n  if (silent) { return true; }\n\n  // Let's cut tails like '    ###  ' from the end of string\n\n  max = state.skipSpacesBack(max, pos);\n  tmp = state.skipCharsBack(max, 0x23, pos); // #\n  if (tmp > pos && isSpace(state.src.charCodeAt(tmp - 1))) {\n    max = tmp;\n  }\n\n  state.line = startLine + 1;\n\n  token        = state.push('heading_open', 'h' + String(level), 1);\n  token.markup = '########'.slice(0, level);\n  token.map    = [ startLine, state.line ];\n\n  token          = state.push('inline', '', 0);\n  token.content  = state.src.slice(pos, max).trim();\n  token.map      = [ startLine, state.line ];\n  token.children = [];\n\n  token        = state.push('heading_close', 'h' + String(level), -1);\n  token.markup = '########'.slice(0, level);\n\n  return true;\n};\n","// Parser state class\n\n'use strict';\n\nvar Token = require('../token');\nvar isSpace = require('../common/utils').isSpace;\n\n\nfunction StateBlock(src, md, env, tokens) {\n  var ch, s, start, pos, len, indent, offset, indent_found;\n\n  this.src = src;\n\n  // link to parser instance\n  this.md     = md;\n\n  this.env = env;\n\n  //\n  // Internal state vartiables\n  //\n\n  this.tokens = tokens;\n\n  this.bMarks = [];  // line begin offsets for fast jumps\n  this.eMarks = [];  // line end offsets for fast jumps\n  this.tShift = [];  // offsets of the first non-space characters (tabs not expanded)\n  this.sCount = [];  // indents for each line (tabs expanded)\n\n  // An amount of virtual spaces (tabs expanded) between beginning\n  // of each line (bMarks) and real beginning of that line.\n  //\n  // It exists only as a hack because blockquotes override bMarks\n  // losing information in the process.\n  //\n  // It's used only when expanding tabs, you can think about it as\n  // an initial tab length, e.g. bsCount=21 applied to string `\\t123`\n  // means first tab should be expanded to 4-21%4 === 3 spaces.\n  //\n  this.bsCount = [];\n\n  // block parser variables\n  this.blkIndent  = 0; // required block content indent (for example, if we are\n                       // inside a list, it would be positioned after list marker)\n  this.line       = 0; // line index in src\n  this.lineMax    = 0; // lines count\n  this.tight      = false;  // loose/tight mode for lists\n  this.ddIndent   = -1; // indent of the current dd block (-1 if there isn't any)\n  this.listIndent = -1; // indent of the current list block (-1 if there isn't any)\n\n  // can be 'blockquote', 'list', 'root', 'paragraph' or 'reference'\n  // used in lists to determine if they interrupt a paragraph\n  this.parentType = 'root';\n\n  this.level = 0;\n\n  // renderer\n  this.result = '';\n\n  // Create caches\n  // Generate markers.\n  s = this.src;\n  indent_found = false;\n\n  for (start = pos = indent = offset = 0, len = s.length; pos < len; pos++) {\n    ch = s.charCodeAt(pos);\n\n    if (!indent_found) {\n      if (isSpace(ch)) {\n        indent++;\n\n        if (ch === 0x09) {\n          offset += 4 - offset % 4;\n        } else {\n          offset++;\n        }\n        continue;\n      } else {\n        indent_found = true;\n      }\n    }\n\n    if (ch === 0x0A || pos === len - 1) {\n      if (ch !== 0x0A) { pos++; }\n      this.bMarks.push(start);\n      this.eMarks.push(pos);\n      this.tShift.push(indent);\n      this.sCount.push(offset);\n      this.bsCount.push(0);\n\n      indent_found = false;\n      indent = 0;\n      offset = 0;\n      start = pos + 1;\n    }\n  }\n\n  // Push fake entry to simplify cache bounds checks\n  this.bMarks.push(s.length);\n  this.eMarks.push(s.length);\n  this.tShift.push(0);\n  this.sCount.push(0);\n  this.bsCount.push(0);\n\n  this.lineMax = this.bMarks.length - 1; // don't count last fake line\n}\n\n// Push new token to \"stream\".\n//\nStateBlock.prototype.push = function (type, tag, nesting) {\n  var token = new Token(type, tag, nesting);\n  token.block = true;\n\n  if (nesting < 0) this.level--; // closing tag\n  token.level = this.level;\n  if (nesting > 0) this.level++; // opening tag\n\n  this.tokens.push(token);\n  return token;\n};\n\nStateBlock.prototype.isEmpty = function isEmpty(line) {\n  return this.bMarks[line] + this.tShift[line] >= this.eMarks[line];\n};\n\nStateBlock.prototype.skipEmptyLines = function skipEmptyLines(from) {\n  for (var max = this.lineMax; from < max; from++) {\n    if (this.bMarks[from] + this.tShift[from] < this.eMarks[from]) {\n      break;\n    }\n  }\n  return from;\n};\n\n// Skip spaces from given position.\nStateBlock.prototype.skipSpaces = function skipSpaces(pos) {\n  var ch;\n\n  for (var max = this.src.length; pos < max; pos++) {\n    ch = this.src.charCodeAt(pos);\n    if (!isSpace(ch)) { break; }\n  }\n  return pos;\n};\n\n// Skip spaces from given position in reverse.\nStateBlock.prototype.skipSpacesBack = function skipSpacesBack(pos, min) {\n  if (pos <= min) { return pos; }\n\n  while (pos > min) {\n    if (!isSpace(this.src.charCodeAt(--pos))) { return pos + 1; }\n  }\n  return pos;\n};\n\n// Skip char codes from given position\nStateBlock.prototype.skipChars = function skipChars(pos, code) {\n  for (var max = this.src.length; pos < max; pos++) {\n    if (this.src.charCodeAt(pos) !== code) { break; }\n  }\n  return pos;\n};\n\n// Skip char codes reverse from given position - 1\nStateBlock.prototype.skipCharsBack = function skipCharsBack(pos, code, min) {\n  if (pos <= min) { return pos; }\n\n  while (pos > min) {\n    if (code !== this.src.charCodeAt(--pos)) { return pos + 1; }\n  }\n  return pos;\n};\n\n// cut lines range from source.\nStateBlock.prototype.getLines = function getLines(begin, end, indent, keepLastLF) {\n  var i, lineIndent, ch, first, last, queue, lineStart,\n      line = begin;\n\n  if (begin >= end) {\n    return '';\n  }\n\n  queue = new Array(end - begin);\n\n  for (i = 0; line < end; line++, i++) {\n    lineIndent = 0;\n    lineStart = first = this.bMarks[line];\n\n    if (line + 1 < end || keepLastLF) {\n      // No need for bounds check because we have fake entry on tail.\n      last = this.eMarks[line] + 1;\n    } else {\n      last = this.eMarks[line];\n    }\n\n    while (first < last && lineIndent < indent) {\n      ch = this.src.charCodeAt(first);\n\n      if (isSpace(ch)) {\n        if (ch === 0x09) {\n          lineIndent += 4 - (lineIndent + this.bsCount[line]) % 4;\n        } else {\n          lineIndent++;\n        }\n      } else if (first - lineStart < this.tShift[line]) {\n        // patched tShift masked characters to look like spaces (blockquotes, list markers)\n        lineIndent++;\n      } else {\n        break;\n      }\n\n      first++;\n    }\n\n    if (lineIndent > indent) {\n      // partially expanding tabs in code blocks, e.g '\\t\\tfoobar'\n      // with indent=2 becomes '  \\tfoobar'\n      queue[i] = new Array(lineIndent - indent + 1).join(' ') + this.src.slice(first, last);\n    } else {\n      queue[i] = this.src.slice(first, last);\n    }\n  }\n\n  return queue.join('');\n};\n\n// re-export Token class to use in block rules\nStateBlock.prototype.Token = Token;\n\n\nmodule.exports = StateBlock;\n","/** internal\n * class ParserBlock\n *\n * Block-level tokenizer.\n **/\n'use strict';\n\n\nvar Ruler           = require('./ruler');\n\n\nvar _rules = [\n  // First 2 params - rule name & source. Secondary array - list of rules,\n  // which can be terminated by this one.\n  [ 'table',      require('./rules_block/table'),      [ 'paragraph', 'reference' ] ],\n  [ 'code',       require('./rules_block/code') ],\n  [ 'fence',      require('./rules_block/fence'),      [ 'paragraph', 'reference', 'blockquote', 'list' ] ],\n  [ 'blockquote', require('./rules_block/blockquote'), [ 'paragraph', 'reference', 'blockquote', 'list' ] ],\n  [ 'hr',         require('./rules_block/hr'),         [ 'paragraph', 'reference', 'blockquote', 'list' ] ],\n  [ 'list',       require('./rules_block/list'),       [ 'paragraph', 'reference', 'blockquote' ] ],\n  [ 'reference',  require('./rules_block/reference') ],\n  [ 'html_block', require('./rules_block/html_block'), [ 'paragraph', 'reference', 'blockquote' ] ],\n  [ 'heading',    require('./rules_block/heading'),    [ 'paragraph', 'reference', 'blockquote' ] ],\n  [ 'lheading',   require('./rules_block/lheading') ],\n  [ 'paragraph',  require('./rules_block/paragraph') ]\n];\n\n\n/**\n * new ParserBlock()\n **/\nfunction ParserBlock() {\n  /**\n   * ParserBlock#ruler -> Ruler\n   *\n   * [[Ruler]] instance. Keep configuration of block rules.\n   **/\n  this.ruler = new Ruler();\n\n  for (var i = 0; i < _rules.length; i++) {\n    this.ruler.push(_rules[i][0], _rules[i][1], { alt: (_rules[i][2] || []).slice() });\n  }\n}\n\n\n// Generate tokens for input range\n//\nParserBlock.prototype.tokenize = function (state, startLine, endLine) {\n  var ok, i,\n      rules = this.ruler.getRules(''),\n      len = rules.length,\n      line = startLine,\n      hasEmptyLines = false,\n      maxNesting = state.md.options.maxNesting;\n\n  while (line < endLine) {\n    state.line = line = state.skipEmptyLines(line);\n    if (line >= endLine) { break; }\n\n    // Termination condition for nested calls.\n    // Nested calls currently used for blockquotes & lists\n    if (state.sCount[line] < state.blkIndent) { break; }\n\n    // If nesting level exceeded - skip tail to the end. That's not ordinary\n    // situation and we should not care about content.\n    if (state.level >= maxNesting) {\n      state.line = endLine;\n      break;\n    }\n\n    // Try all possible rules.\n    // On success, rule should:\n    //\n    // - update `state.line`\n    // - update `state.tokens`\n    // - return true\n\n    for (i = 0; i < len; i++) {\n      ok = rules[i](state, line, endLine, false);\n      if (ok) { break; }\n    }\n\n    // set state.tight if we had an empty line before current tag\n    // i.e. latest empty line should not count\n    state.tight = !hasEmptyLines;\n\n    // paragraph might \"eat\" one newline after it in nested lists\n    if (state.isEmpty(state.line - 1)) {\n      hasEmptyLines = true;\n    }\n\n    line = state.line;\n\n    if (line < endLine && state.isEmpty(line)) {\n      hasEmptyLines = true;\n      line++;\n      state.line = line;\n    }\n  }\n};\n\n\n/**\n * ParserBlock.parse(str, md, env, outTokens)\n *\n * Process input string and push block tokens into `outTokens`\n **/\nParserBlock.prototype.parse = function (src, md, env, outTokens) {\n  var state;\n\n  if (!src) { return; }\n\n  state = new this.State(src, md, env, outTokens);\n\n  this.tokenize(state, state.line, state.lineMax);\n};\n\n\nParserBlock.prototype.State = require('./rules_block/state_block');\n\n\nmodule.exports = ParserBlock;\n","// Code block (4 spaces padded)\n\n'use strict';\n\n\nmodule.exports = function code(state, startLine, endLine/*, silent*/) {\n  var nextLine, last, token;\n\n  if (state.sCount[startLine] - state.blkIndent < 4) { return false; }\n\n  last = nextLine = startLine + 1;\n\n  while (nextLine < endLine) {\n    if (state.isEmpty(nextLine)) {\n      nextLine++;\n      continue;\n    }\n\n    if (state.sCount[nextLine] - state.blkIndent >= 4) {\n      nextLine++;\n      last = nextLine;\n      continue;\n    }\n    break;\n  }\n\n  state.line = last;\n\n  token         = state.push('code_block', 'code', 0);\n  token.content = state.getLines(startLine, last, 4 + state.blkIndent, false) + '\\n';\n  token.map     = [ startLine, state.line ];\n\n  return true;\n};\n","// fences (``` lang, ~~~ lang)\n\n'use strict';\n\n\nmodule.exports = function fence(state, startLine, endLine, silent) {\n  var marker, len, params, nextLine, mem, token, markup,\n      haveEndMarker = false,\n      pos = state.bMarks[startLine] + state.tShift[startLine],\n      max = state.eMarks[startLine];\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  if (pos + 3 > max) { return false; }\n\n  marker = state.src.charCodeAt(pos);\n\n  if (marker !== 0x7E/* ~ */ && marker !== 0x60 /* ` */) {\n    return false;\n  }\n\n  // scan marker length\n  mem = pos;\n  pos = state.skipChars(pos, marker);\n\n  len = pos - mem;\n\n  if (len < 3) { return false; }\n\n  markup = state.src.slice(mem, pos);\n  params = state.src.slice(pos, max);\n\n  if (marker === 0x60 /* ` */) {\n    if (params.indexOf(String.fromCharCode(marker)) >= 0) {\n      return false;\n    }\n  }\n\n  // Since start is found, we can report success here in validation mode\n  if (silent) { return true; }\n\n  // search end of block\n  nextLine = startLine;\n\n  for (;;) {\n    nextLine++;\n    if (nextLine >= endLine) {\n      // unclosed block should be autoclosed by end of document.\n      // also block seems to be autoclosed by end of parent\n      break;\n    }\n\n    pos = mem = state.bMarks[nextLine] + state.tShift[nextLine];\n    max = state.eMarks[nextLine];\n\n    if (pos < max && state.sCount[nextLine] < state.blkIndent) {\n      // non-empty line with negative indent should stop the list:\n      // - ```\n      //  test\n      break;\n    }\n\n    if (state.src.charCodeAt(pos) !== marker) { continue; }\n\n    if (state.sCount[nextLine] - state.blkIndent >= 4) {\n      // closing fence should be indented less than 4 spaces\n      continue;\n    }\n\n    pos = state.skipChars(pos, marker);\n\n    // closing code fence must be at least as long as the opening one\n    if (pos - mem < len) { continue; }\n\n    // make sure tail has spaces only\n    pos = state.skipSpaces(pos);\n\n    if (pos < max) { continue; }\n\n    haveEndMarker = true;\n    // found!\n    break;\n  }\n\n  // If a fence has heading spaces, they should be removed from its inner block\n  len = state.sCount[startLine];\n\n  state.line = nextLine + (haveEndMarker ? 1 : 0);\n\n  token         = state.push('fence', 'code', 0);\n  token.info    = params;\n  token.content = state.getLines(startLine + 1, nextLine, len, true);\n  token.markup  = markup;\n  token.map     = [ startLine, state.line ];\n\n  return true;\n};\n","// lheading (---, ===)\n\n'use strict';\n\n\nmodule.exports = function lheading(state, startLine, endLine/*, silent*/) {\n  var content, terminate, i, l, token, pos, max, level, marker,\n      nextLine = startLine + 1, oldParentType,\n      terminatorRules = state.md.block.ruler.getRules('paragraph');\n\n  // if it's indented more than 3 spaces, it should be a code block\n  if (state.sCount[startLine] - state.blkIndent >= 4) { return false; }\n\n  oldParentType = state.parentType;\n  state.parentType = 'paragraph'; // use paragraph to match terminatorRules\n\n  // jump line-by-line until empty one or EOF\n  for (; nextLine < endLine && !state.isEmpty(nextLine); nextLine++) {\n    // this would be a code block normally, but after paragraph\n    // it's considered a lazy continuation regardless of what's there\n    if (state.sCount[nextLine] - state.blkIndent > 3) { continue; }\n\n    //\n    // Check for underline in setext header\n    //\n    if (state.sCount[nextLine] >= state.blkIndent) {\n      pos = state.bMarks[nextLine] + state.tShift[nextLine];\n      max = state.eMarks[nextLine];\n\n      if (pos < max) {\n        marker = state.src.charCodeAt(pos);\n\n        if (marker === 0x2D/* - */ || marker === 0x3D/* = */) {\n          pos = state.skipChars(pos, marker);\n          pos = state.skipSpaces(pos);\n\n          if (pos >= max) {\n            level = (marker === 0x3D/* = */ ? 1 : 2);\n            break;\n          }\n        }\n      }\n    }\n\n    // quirk for blockquotes, this line should already be checked by that rule\n    if (state.sCount[nextLine] < 0) { continue; }\n\n    // Some tags can terminate paragraph without empty line.\n    terminate = false;\n    for (i = 0, l = terminatorRules.length; i < l; i++) {\n      if (terminatorRules[i](state, nextLine, endLine, true)) {\n        terminate = true;\n        break;\n      }\n    }\n    if (terminate) { break; }\n  }\n\n  if (!level) {\n    // Didn't find valid underline\n    return false;\n  }\n\n  content = state.getLines(startLine, nextLine, state.blkIndent, false).trim();\n\n  state.line = nextLine + 1;\n\n  token          = state.push('heading_open', 'h' + String(level), 1);\n  token.markup   = String.fromCharCode(marker);\n  token.map      = [ startLine, state.line ];\n\n  token          = state.push('inline', '', 0);\n  token.content  = content;\n  token.map      = [ startLine, state.line - 1 ];\n  token.children = [];\n\n  token          = state.push('heading_close', 'h' + String(level), -1);\n  token.markup   = String.fromCharCode(marker);\n\n  state.parentType = oldParentType;\n\n  return true;\n};\n","// Paragraph\n\n'use strict';\n\n\nmodule.exports = function paragraph(state, startLine/*, endLine*/) {\n  var content, terminate, i, l, token, oldParentType,\n      nextLine = startLine + 1,\n      terminatorRules = state.md.block.ruler.getRules('paragraph'),\n      endLine = state.lineMax;\n\n  oldParentType = state.parentType;\n  state.parentType = 'paragraph';\n\n  // jump line-by-line until empty one or EOF\n  for (; nextLine < endLine && !state.isEmpty(nextLine); nextLine++) {\n    // this would be a code block normally, but after paragraph\n    // it's considered a lazy continuation regardless of what's there\n    if (state.sCount[nextLine] - state.blkIndent > 3) { continue; }\n\n    // quirk for blockquotes, this line should already be checked by that rule\n    if (state.sCount[nextLine] < 0) { continue; }\n\n    // Some tags can terminate paragraph without empty line.\n    terminate = false;\n    for (i = 0, l = terminatorRules.length; i < l; i++) {\n      if (terminatorRules[i](state, nextLine, endLine, true)) {\n        terminate = true;\n        break;\n      }\n    }\n    if (terminate) { break; }\n  }\n\n  content = state.getLines(startLine, nextLine, state.blkIndent, false).trim();\n\n  state.line = nextLine;\n\n  token          = state.push('paragraph_open', 'p', 1);\n  token.map      = [ startLine, state.line ];\n\n  token          = state.push('inline', '', 0);\n  token.content  = content;\n  token.map      = [ startLine, state.line ];\n  token.children = [];\n\n  token          = state.push('paragraph_close', 'p', -1);\n\n  state.parentType = oldParentType;\n\n  return true;\n};\n","// Skip text characters for text token, place those to pending buffer\n// and increment current pos\n\n'use strict';\n\n\n// Rule to skip pure text\n// '{}$%@~+=:' reserved for extentions\n\n// !, \", #, $, %, &, ', (, ), *, +, ,, -, ., /, :, ;, <, =, >, ?, @, [, \\, ], ^, _, `, {, |, }, or ~\n\n// !!!! Don't confuse with \"Markdown ASCII Punctuation\" chars\n// http://spec.commonmark.org/0.15/#ascii-punctuation-character\nfunction isTerminatorChar(ch) {\n  switch (ch) {\n    case 0x0A/* \\n */:\n    case 0x21/* ! */:\n    case 0x23/* # */:\n    case 0x24/* $ */:\n    case 0x25/* % */:\n    case 0x26/* & */:\n    case 0x2A/* * */:\n    case 0x2B/* + */:\n    case 0x2D/* - */:\n    case 0x3A/* : */:\n    case 0x3C/* < */:\n    case 0x3D/* = */:\n    case 0x3E/* > */:\n    case 0x40/* @ */:\n    case 0x5B/* [ */:\n    case 0x5C/* \\ */:\n    case 0x5D/* ] */:\n    case 0x5E/* ^ */:\n    case 0x5F/* _ */:\n    case 0x60/* ` */:\n    case 0x7B/* { */:\n    case 0x7D/* } */:\n    case 0x7E/* ~ */:\n      return true;\n    default:\n      return false;\n  }\n}\n\nmodule.exports = function text(state, silent) {\n  var pos = state.pos;\n\n  while (pos < state.posMax && !isTerminatorChar(state.src.charCodeAt(pos))) {\n    pos++;\n  }\n\n  if (pos === state.pos) { return false; }\n\n  if (!silent) { state.pending += state.src.slice(state.pos, pos); }\n\n  state.pos = pos;\n\n  return true;\n};\n\n// Alternative implementation, for memory.\n//\n// It costs 10% of performance, but allows extend terminators list, if place it\n// to `ParcerInline` property. Probably, will switch to it sometime, such\n// flexibility required.\n\n/*\nvar TERMINATOR_RE = /[\\n!#$%&*+\\-:<=>@[\\\\\\]^_`{}~]/;\n\nmodule.exports = function text(state, silent) {\n  var pos = state.pos,\n      idx = state.src.slice(pos).search(TERMINATOR_RE);\n\n  // first char is terminator -> empty text\n  if (idx === 0) { return false; }\n\n  // no terminator -> text till end of string\n  if (idx < 0) {\n    if (!silent) { state.pending += state.src.slice(pos); }\n    state.pos = state.src.length;\n    return true;\n  }\n\n  if (!silent) { state.pending += state.src.slice(pos, pos + idx); }\n\n  state.pos += idx;\n\n  return true;\n};*/\n","// Process escaped chars and hardbreaks\n\n'use strict';\n\nvar isSpace = require('../common/utils').isSpace;\n\nvar ESCAPED = [];\n\nfor (var i = 0; i < 256; i++) { ESCAPED.push(0); }\n\n'\\\\!\"#$%&\\'()*+,./:;<=>?@[]^_`{|}~-'\n  .split('').forEach(function (ch) { ESCAPED[ch.charCodeAt(0)] = 1; });\n\n\nmodule.exports = function escape(state, silent) {\n  var ch1, ch2, origStr, escapedStr, token, pos = state.pos, max = state.posMax;\n\n  if (state.src.charCodeAt(pos) !== 0x5C/* \\ */) return false;\n  pos++;\n\n  // '\\' at the end of the inline block\n  if (pos >= max) return false;\n\n  ch1 = state.src.charCodeAt(pos);\n\n  if (ch1 === 0x0A) {\n    if (!silent) {\n      state.push('hardbreak', 'br', 0);\n    }\n\n    pos++;\n    // skip leading whitespaces from next line\n    while (pos < max) {\n      ch1 = state.src.charCodeAt(pos);\n      if (!isSpace(ch1)) break;\n      pos++;\n    }\n\n    state.pos = pos;\n    return true;\n  }\n\n  escapedStr = state.src[pos];\n\n  if (ch1 >= 0xD800 && ch1 <= 0xDBFF && pos + 1 < max) {\n    ch2 = state.src.charCodeAt(pos + 1);\n\n    if (ch2 >= 0xDC00 && ch2 <= 0xDFFF) {\n      escapedStr += state.src[pos + 1];\n      pos++;\n    }\n  }\n\n  origStr = '\\\\' + escapedStr;\n\n  if (!silent) {\n    token = state.push('text_special', '', 0);\n\n    if (ch1 < 256 && ESCAPED[ch1] !== 0) {\n      token.content = escapedStr;\n    } else {\n      token.content = origStr;\n    }\n\n    token.markup = origStr;\n    token.info   = 'escape';\n  }\n\n  state.pos = pos + 1;\n  return true;\n};\n","// Process links like https://example.org/\n\n'use strict';\n\n\n// RFC3986: scheme = ALPHA *( ALPHA / DIGIT / \"+\" / \"-\" / \".\" )\nvar SCHEME_RE = /(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;\n\n\nmodule.exports = function linkify(state, silent) {\n  var pos, max, match, proto, link, url, fullUrl, token;\n\n  if (!state.md.options.linkify) return false;\n  if (state.linkLevel > 0) return false;\n\n  pos = state.pos;\n  max = state.posMax;\n\n  if (pos + 3 > max) return false;\n  if (state.src.charCodeAt(pos) !== 0x3A/* : */) return false;\n  if (state.src.charCodeAt(pos + 1) !== 0x2F/* / */) return false;\n  if (state.src.charCodeAt(pos + 2) !== 0x2F/* / */) return false;\n\n  match = state.pending.match(SCHEME_RE);\n  if (!match) return false;\n\n  proto = match[1];\n\n  link = state.md.linkify.matchAtStart(state.src.slice(pos - proto.length));\n  if (!link) return false;\n\n  url = link.url;\n\n  // disallow '*' at the end of the link (conflicts with emphasis)\n  url = url.replace(/\\*+$/, '');\n\n  fullUrl = state.md.normalizeLink(url);\n  if (!state.md.validateLink(fullUrl)) return false;\n\n  if (!silent) {\n    state.pending = state.pending.slice(0, -proto.length);\n\n    token         = state.push('link_open', 'a', 1);\n    token.attrs   = [ [ 'href', fullUrl ] ];\n    token.markup  = 'linkify';\n    token.info    = 'auto';\n\n    token         = state.push('text', '', 0);\n    token.content = state.md.normalizeLinkText(url);\n\n    token         = state.push('link_close', 'a', -1);\n    token.markup  = 'linkify';\n    token.info    = 'auto';\n  }\n\n  state.pos += url.length - proto.length;\n  return true;\n};\n","// Proceess '\\n'\n\n'use strict';\n\nvar isSpace = require('../common/utils').isSpace;\n\n\nmodule.exports = function newline(state, silent) {\n  var pmax, max, ws, pos = state.pos;\n\n  if (state.src.charCodeAt(pos) !== 0x0A/* \\n */) { return false; }\n\n  pmax = state.pending.length - 1;\n  max = state.posMax;\n\n  // '  \\n' -> hardbreak\n  // Lookup in pending chars is bad practice! Don't copy to other rules!\n  // Pending string is stored in concat mode, indexed lookups will cause\n  // convertion to flat mode.\n  if (!silent) {\n    if (pmax >= 0 && state.pending.charCodeAt(pmax) === 0x20) {\n      if (pmax >= 1 && state.pending.charCodeAt(pmax - 1) === 0x20) {\n        // Find whitespaces tail of pending chars.\n        ws = pmax - 1;\n        while (ws >= 1 && state.pending.charCodeAt(ws - 1) === 0x20) ws--;\n\n        state.pending = state.pending.slice(0, ws);\n        state.push('hardbreak', 'br', 0);\n      } else {\n        state.pending = state.pending.slice(0, -1);\n        state.push('softbreak', 'br', 0);\n      }\n\n    } else {\n      state.push('softbreak', 'br', 0);\n    }\n  }\n\n  pos++;\n\n  // skip heading spaces for next line\n  while (pos < max && isSpace(state.src.charCodeAt(pos))) { pos++; }\n\n  state.pos = pos;\n  return true;\n};\n","// ~~strike through~~\n//\n'use strict';\n\n\n// Insert each marker as a separate text token, and add it to delimiter list\n//\nmodule.exports.tokenize = function strikethrough(state, silent) {\n  var i, scanned, token, len, ch,\n      start = state.pos,\n      marker = state.src.charCodeAt(start);\n\n  if (silent) { return false; }\n\n  if (marker !== 0x7E/* ~ */) { return false; }\n\n  scanned = state.scanDelims(state.pos, true);\n  len = scanned.length;\n  ch = String.fromCharCode(marker);\n\n  if (len < 2) { return false; }\n\n  if (len % 2) {\n    token         = state.push('text', '', 0);\n    token.content = ch;\n    len--;\n  }\n\n  for (i = 0; i < len; i += 2) {\n    token         = state.push('text', '', 0);\n    token.content = ch + ch;\n\n    state.delimiters.push({\n      marker: marker,\n      length: 0,     // disable \"rule of 3\" length checks meant for emphasis\n      token:  state.tokens.length - 1,\n      end:    -1,\n      open:   scanned.can_open,\n      close:  scanned.can_close\n    });\n  }\n\n  state.pos += scanned.length;\n\n  return true;\n};\n\n\nfunction postProcess(state, delimiters) {\n  var i, j,\n      startDelim,\n      endDelim,\n      token,\n      loneMarkers = [],\n      max = delimiters.length;\n\n  for (i = 0; i < max; i++) {\n    startDelim = delimiters[i];\n\n    if (startDelim.marker !== 0x7E/* ~ */) {\n      continue;\n    }\n\n    if (startDelim.end === -1) {\n      continue;\n    }\n\n    endDelim = delimiters[startDelim.end];\n\n    token         = state.tokens[startDelim.token];\n    token.type    = 's_open';\n    token.tag     = 's';\n    token.nesting = 1;\n    token.markup  = '~~';\n    token.content = '';\n\n    token         = state.tokens[endDelim.token];\n    token.type    = 's_close';\n    token.tag     = 's';\n    token.nesting = -1;\n    token.markup  = '~~';\n    token.content = '';\n\n    if (state.tokens[endDelim.token - 1].type === 'text' &&\n        state.tokens[endDelim.token - 1].content === '~') {\n\n      loneMarkers.push(endDelim.token - 1);\n    }\n  }\n\n  // If a marker sequence has an odd number of characters, it's splitted\n  // like this: `~~~~~` -> `~` + `~~` + `~~`, leaving one marker at the\n  // start of the sequence.\n  //\n  // So, we have to move all those markers after subsequent s_close tags.\n  //\n  while (loneMarkers.length) {\n    i = loneMarkers.pop();\n    j = i + 1;\n\n    while (j < state.tokens.length && state.tokens[j].type === 's_close') {\n      j++;\n    }\n\n    j--;\n\n    if (i !== j) {\n      token = state.tokens[j];\n      state.tokens[j] = state.tokens[i];\n      state.tokens[i] = token;\n    }\n  }\n}\n\n\n// Walk through delimiter list and replace text tokens with tags\n//\nmodule.exports.postProcess = function strikethrough(state) {\n  var curr,\n      tokens_meta = state.tokens_meta,\n      max = state.tokens_meta.length;\n\n  postProcess(state, state.delimiters);\n\n  for (curr = 0; curr < max; curr++) {\n    if (tokens_meta[curr] && tokens_meta[curr].delimiters) {\n      postProcess(state, tokens_meta[curr].delimiters);\n    }\n  }\n};\n","// Process *this* and _that_\n//\n'use strict';\n\n\n// Insert each marker as a separate text token, and add it to delimiter list\n//\nmodule.exports.tokenize = function emphasis(state, silent) {\n  var i, scanned, token,\n      start = state.pos,\n      marker = state.src.charCodeAt(start);\n\n  if (silent) { return false; }\n\n  if (marker !== 0x5F /* _ */ && marker !== 0x2A /* * */) { return false; }\n\n  scanned = state.scanDelims(state.pos, marker === 0x2A);\n\n  for (i = 0; i < scanned.length; i++) {\n    token         = state.push('text', '', 0);\n    token.content = String.fromCharCode(marker);\n\n    state.delimiters.push({\n      // Char code of the starting marker (number).\n      //\n      marker: marker,\n\n      // Total length of these series of delimiters.\n      //\n      length: scanned.length,\n\n      // A position of the token this delimiter corresponds to.\n      //\n      token:  state.tokens.length - 1,\n\n      // If this delimiter is matched as a valid opener, `end` will be\n      // equal to its position, otherwise it's `-1`.\n      //\n      end:    -1,\n\n      // Boolean flags that determine if this delimiter could open or close\n      // an emphasis.\n      //\n      open:   scanned.can_open,\n      close:  scanned.can_close\n    });\n  }\n\n  state.pos += scanned.length;\n\n  return true;\n};\n\n\nfunction postProcess(state, delimiters) {\n  var i,\n      startDelim,\n      endDelim,\n      token,\n      ch,\n      isStrong,\n      max = delimiters.length;\n\n  for (i = max - 1; i >= 0; i--) {\n    startDelim = delimiters[i];\n\n    if (startDelim.marker !== 0x5F/* _ */ && startDelim.marker !== 0x2A/* * */) {\n      continue;\n    }\n\n    // Process only opening markers\n    if (startDelim.end === -1) {\n      continue;\n    }\n\n    endDelim = delimiters[startDelim.end];\n\n    // If the previous delimiter has the same marker and is adjacent to this one,\n    // merge those into one strong delimiter.\n    //\n    // `<em><em>whatever</em></em>` -> `<strong>whatever</strong>`\n    //\n    isStrong = i > 0 &&\n               delimiters[i - 1].end === startDelim.end + 1 &&\n               // check that first two markers match and adjacent\n               delimiters[i - 1].marker === startDelim.marker &&\n               delimiters[i - 1].token === startDelim.token - 1 &&\n               // check that last two markers are adjacent (we can safely assume they match)\n               delimiters[startDelim.end + 1].token === endDelim.token + 1;\n\n    ch = String.fromCharCode(startDelim.marker);\n\n    token         = state.tokens[startDelim.token];\n    token.type    = isStrong ? 'strong_open' : 'em_open';\n    token.tag     = isStrong ? 'strong' : 'em';\n    token.nesting = 1;\n    token.markup  = isStrong ? ch + ch : ch;\n    token.content = '';\n\n    token         = state.tokens[endDelim.token];\n    token.type    = isStrong ? 'strong_close' : 'em_close';\n    token.tag     = isStrong ? 'strong' : 'em';\n    token.nesting = -1;\n    token.markup  = isStrong ? ch + ch : ch;\n    token.content = '';\n\n    if (isStrong) {\n      state.tokens[delimiters[i - 1].token].content = '';\n      state.tokens[delimiters[startDelim.end + 1].token].content = '';\n      i--;\n    }\n  }\n}\n\n\n// Walk through delimiter list and replace text tokens with tags\n//\nmodule.exports.postProcess = function emphasis(state) {\n  var curr,\n      tokens_meta = state.tokens_meta,\n      max = state.tokens_meta.length;\n\n  postProcess(state, state.delimiters);\n\n  for (curr = 0; curr < max; curr++) {\n    if (tokens_meta[curr] && tokens_meta[curr].delimiters) {\n      postProcess(state, tokens_meta[curr].delimiters);\n    }\n  }\n};\n","// Process [link](<to> \"stuff\")\n\n'use strict';\n\nvar normalizeReference   = require('../common/utils').normalizeReference;\nvar isSpace              = require('../common/utils').isSpace;\n\n\nmodule.exports = function link(state, silent) {\n  var attrs,\n      code,\n      label,\n      labelEnd,\n      labelStart,\n      pos,\n      res,\n      ref,\n      token,\n      href = '',\n      title = '',\n      oldPos = state.pos,\n      max = state.posMax,\n      start = state.pos,\n      parseReference = true;\n\n  if (state.src.charCodeAt(state.pos) !== 0x5B/* [ */) { return false; }\n\n  labelStart = state.pos + 1;\n  labelEnd = state.md.helpers.parseLinkLabel(state, state.pos, true);\n\n  // parser failed to find ']', so it's not a valid link\n  if (labelEnd < 0) { return false; }\n\n  pos = labelEnd + 1;\n  if (pos < max && state.src.charCodeAt(pos) === 0x28/* ( */) {\n    //\n    // Inline link\n    //\n\n    // might have found a valid shortcut link, disable reference parsing\n    parseReference = false;\n\n    // [link](  <href>  \"title\"  )\n    //        ^^ skipping these spaces\n    pos++;\n    for (; pos < max; pos++) {\n      code = state.src.charCodeAt(pos);\n      if (!isSpace(code) && code !== 0x0A) { break; }\n    }\n    if (pos >= max) { return false; }\n\n    // [link](  <href>  \"title\"  )\n    //          ^^^^^^ parsing link destination\n    start = pos;\n    res = state.md.helpers.parseLinkDestination(state.src, pos, state.posMax);\n    if (res.ok) {\n      href = state.md.normalizeLink(res.str);\n      if (state.md.validateLink(href)) {\n        pos = res.pos;\n      } else {\n        href = '';\n      }\n\n      // [link](  <href>  \"title\"  )\n      //                ^^ skipping these spaces\n      start = pos;\n      for (; pos < max; pos++) {\n        code = state.src.charCodeAt(pos);\n        if (!isSpace(code) && code !== 0x0A) { break; }\n      }\n\n      // [link](  <href>  \"title\"  )\n      //                  ^^^^^^^ parsing link title\n      res = state.md.helpers.parseLinkTitle(state.src, pos, state.posMax);\n      if (pos < max && start !== pos && res.ok) {\n        title = res.str;\n        pos = res.pos;\n\n        // [link](  <href>  \"title\"  )\n        //                         ^^ skipping these spaces\n        for (; pos < max; pos++) {\n          code = state.src.charCodeAt(pos);\n          if (!isSpace(code) && code !== 0x0A) { break; }\n        }\n      }\n    }\n\n    if (pos >= max || state.src.charCodeAt(pos) !== 0x29/* ) */) {\n      // parsing a valid shortcut link failed, fallback to reference\n      parseReference = true;\n    }\n    pos++;\n  }\n\n  if (parseReference) {\n    //\n    // Link reference\n    //\n    if (typeof state.env.references === 'undefined') { return false; }\n\n    if (pos < max && state.src.charCodeAt(pos) === 0x5B/* [ */) {\n      start = pos + 1;\n      pos = state.md.helpers.parseLinkLabel(state, pos);\n      if (pos >= 0) {\n        label = state.src.slice(start, pos++);\n      } else {\n        pos = labelEnd + 1;\n      }\n    } else {\n      pos = labelEnd + 1;\n    }\n\n    // covers label === '' and label === undefined\n    // (collapsed reference link and shortcut reference link respectively)\n    if (!label) { label = state.src.slice(labelStart, labelEnd); }\n\n    ref = state.env.references[normalizeReference(label)];\n    if (!ref) {\n      state.pos = oldPos;\n      return false;\n    }\n    href = ref.href;\n    title = ref.title;\n  }\n\n  //\n  // We found the end of the link, and know for a fact it's a valid link;\n  // so all that's left to do is to call tokenizer.\n  //\n  if (!silent) {\n    state.pos = labelStart;\n    state.posMax = labelEnd;\n\n    token        = state.push('link_open', 'a', 1);\n    token.attrs  = attrs = [ [ 'href', href ] ];\n    if (title) {\n      attrs.push([ 'title', title ]);\n    }\n\n    state.linkLevel++;\n    state.md.inline.tokenize(state);\n    state.linkLevel--;\n\n    token        = state.push('link_close', 'a', -1);\n  }\n\n  state.pos = pos;\n  state.posMax = max;\n  return true;\n};\n","// Process ![image](<src> \"title\")\n\n'use strict';\n\nvar normalizeReference   = require('../common/utils').normalizeReference;\nvar isSpace              = require('../common/utils').isSpace;\n\n\nmodule.exports = function image(state, silent) {\n  var attrs,\n      code,\n      content,\n      label,\n      labelEnd,\n      labelStart,\n      pos,\n      ref,\n      res,\n      title,\n      token,\n      tokens,\n      start,\n      href = '',\n      oldPos = state.pos,\n      max = state.posMax;\n\n  if (state.src.charCodeAt(state.pos) !== 0x21/* ! */) { return false; }\n  if (state.src.charCodeAt(state.pos + 1) !== 0x5B/* [ */) { return false; }\n\n  labelStart = state.pos + 2;\n  labelEnd = state.md.helpers.parseLinkLabel(state, state.pos + 1, false);\n\n  // parser failed to find ']', so it's not a valid link\n  if (labelEnd < 0) { return false; }\n\n  pos = labelEnd + 1;\n  if (pos < max && state.src.charCodeAt(pos) === 0x28/* ( */) {\n    //\n    // Inline link\n    //\n\n    // [link](  <href>  \"title\"  )\n    //        ^^ skipping these spaces\n    pos++;\n    for (; pos < max; pos++) {\n      code = state.src.charCodeAt(pos);\n      if (!isSpace(code) && code !== 0x0A) { break; }\n    }\n    if (pos >= max) { return false; }\n\n    // [link](  <href>  \"title\"  )\n    //          ^^^^^^ parsing link destination\n    start = pos;\n    res = state.md.helpers.parseLinkDestination(state.src, pos, state.posMax);\n    if (res.ok) {\n      href = state.md.normalizeLink(res.str);\n      if (state.md.validateLink(href)) {\n        pos = res.pos;\n      } else {\n        href = '';\n      }\n    }\n\n    // [link](  <href>  \"title\"  )\n    //                ^^ skipping these spaces\n    start = pos;\n    for (; pos < max; pos++) {\n      code = state.src.charCodeAt(pos);\n      if (!isSpace(code) && code !== 0x0A) { break; }\n    }\n\n    // [link](  <href>  \"title\"  )\n    //                  ^^^^^^^ parsing link title\n    res = state.md.helpers.parseLinkTitle(state.src, pos, state.posMax);\n    if (pos < max && start !== pos && res.ok) {\n      title = res.str;\n      pos = res.pos;\n\n      // [link](  <href>  \"title\"  )\n      //                         ^^ skipping these spaces\n      for (; pos < max; pos++) {\n        code = state.src.charCodeAt(pos);\n        if (!isSpace(code) && code !== 0x0A) { break; }\n      }\n    } else {\n      title = '';\n    }\n\n    if (pos >= max || state.src.charCodeAt(pos) !== 0x29/* ) */) {\n      state.pos = oldPos;\n      return false;\n    }\n    pos++;\n  } else {\n    //\n    // Link reference\n    //\n    if (typeof state.env.references === 'undefined') { return false; }\n\n    if (pos < max && state.src.charCodeAt(pos) === 0x5B/* [ */) {\n      start = pos + 1;\n      pos = state.md.helpers.parseLinkLabel(state, pos);\n      if (pos >= 0) {\n        label = state.src.slice(start, pos++);\n      } else {\n        pos = labelEnd + 1;\n      }\n    } else {\n      pos = labelEnd + 1;\n    }\n\n    // covers label === '' and label === undefined\n    // (collapsed reference link and shortcut reference link respectively)\n    if (!label) { label = state.src.slice(labelStart, labelEnd); }\n\n    ref = state.env.references[normalizeReference(label)];\n    if (!ref) {\n      state.pos = oldPos;\n      return false;\n    }\n    href = ref.href;\n    title = ref.title;\n  }\n\n  //\n  // We found the end of the link, and know for a fact it's a valid link;\n  // so all that's left to do is to call tokenizer.\n  //\n  if (!silent) {\n    content = state.src.slice(labelStart, labelEnd);\n\n    state.md.inline.parse(\n      content,\n      state.md,\n      state.env,\n      tokens = []\n    );\n\n    token          = state.push('image', 'img', 0);\n    token.attrs    = attrs = [ [ 'src', href ], [ 'alt', '' ] ];\n    token.children = tokens;\n    token.content  = content;\n\n    if (title) {\n      attrs.push([ 'title', title ]);\n    }\n  }\n\n  state.pos = pos;\n  state.posMax = max;\n  return true;\n};\n","// Process autolinks '<protocol:...>'\n\n'use strict';\n\n\n/*eslint max-len:0*/\nvar EMAIL_RE    = /^([a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/;\nvar AUTOLINK_RE = /^([a-zA-Z][a-zA-Z0-9+.\\-]{1,31}):([^<>\\x00-\\x20]*)$/;\n\n\nmodule.exports = function autolink(state, silent) {\n  var url, fullUrl, token, ch, start, max,\n      pos = state.pos;\n\n  if (state.src.charCodeAt(pos) !== 0x3C/* < */) { return false; }\n\n  start = state.pos;\n  max = state.posMax;\n\n  for (;;) {\n    if (++pos >= max) return false;\n\n    ch = state.src.charCodeAt(pos);\n\n    if (ch === 0x3C /* < */) return false;\n    if (ch === 0x3E /* > */) break;\n  }\n\n  url = state.src.slice(start + 1, pos);\n\n  if (AUTOLINK_RE.test(url)) {\n    fullUrl = state.md.normalizeLink(url);\n    if (!state.md.validateLink(fullUrl)) { return false; }\n\n    if (!silent) {\n      token         = state.push('link_open', 'a', 1);\n      token.attrs   = [ [ 'href', fullUrl ] ];\n      token.markup  = 'autolink';\n      token.info    = 'auto';\n\n      token         = state.push('text', '', 0);\n      token.content = state.md.normalizeLinkText(url);\n\n      token         = state.push('link_close', 'a', -1);\n      token.markup  = 'autolink';\n      token.info    = 'auto';\n    }\n\n    state.pos += url.length + 2;\n    return true;\n  }\n\n  if (EMAIL_RE.test(url)) {\n    fullUrl = state.md.normalizeLink('mailto:' + url);\n    if (!state.md.validateLink(fullUrl)) { return false; }\n\n    if (!silent) {\n      token         = state.push('link_open', 'a', 1);\n      token.attrs   = [ [ 'href', fullUrl ] ];\n      token.markup  = 'autolink';\n      token.info    = 'auto';\n\n      token         = state.push('text', '', 0);\n      token.content = state.md.normalizeLinkText(url);\n\n      token         = state.push('link_close', 'a', -1);\n      token.markup  = 'autolink';\n      token.info    = 'auto';\n    }\n\n    state.pos += url.length + 2;\n    return true;\n  }\n\n  return false;\n};\n","// Process html tags\n\n'use strict';\n\n\nvar HTML_TAG_RE = require('../common/html_re').HTML_TAG_RE;\n\n\nfunction isLinkOpen(str) {\n  return /^<a[>\\s]/i.test(str);\n}\nfunction isLinkClose(str) {\n  return /^<\\/a\\s*>/i.test(str);\n}\n\n\nfunction isLetter(ch) {\n  /*eslint no-bitwise:0*/\n  var lc = ch | 0x20; // to lower case\n  return (lc >= 0x61/* a */) && (lc <= 0x7a/* z */);\n}\n\n\nmodule.exports = function html_inline(state, silent) {\n  var ch, match, max, token,\n      pos = state.pos;\n\n  if (!state.md.options.html) { return false; }\n\n  // Check start\n  max = state.posMax;\n  if (state.src.charCodeAt(pos) !== 0x3C/* < */ ||\n      pos + 2 >= max) {\n    return false;\n  }\n\n  // Quick fail on second char\n  ch = state.src.charCodeAt(pos + 1);\n  if (ch !== 0x21/* ! */ &&\n      ch !== 0x3F/* ? */ &&\n      ch !== 0x2F/* / */ &&\n      !isLetter(ch)) {\n    return false;\n  }\n\n  match = state.src.slice(pos).match(HTML_TAG_RE);\n  if (!match) { return false; }\n\n  if (!silent) {\n    token         = state.push('html_inline', '', 0);\n    token.content = state.src.slice(pos, pos + match[0].length);\n\n    if (isLinkOpen(token.content))  state.linkLevel++;\n    if (isLinkClose(token.content)) state.linkLevel--;\n  }\n  state.pos += match[0].length;\n  return true;\n};\n","// Process html entity - &#123;, &#xAF;, &quot;, ...\n\n'use strict';\n\nvar entities          = require('../common/entities');\nvar has               = require('../common/utils').has;\nvar isValidEntityCode = require('../common/utils').isValidEntityCode;\nvar fromCodePoint     = require('../common/utils').fromCodePoint;\n\n\nvar DIGITAL_RE = /^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i;\nvar NAMED_RE   = /^&([a-z][a-z0-9]{1,31});/i;\n\n\nmodule.exports = function entity(state, silent) {\n  var ch, code, match, token, pos = state.pos, max = state.posMax;\n\n  if (state.src.charCodeAt(pos) !== 0x26/* & */) return false;\n\n  if (pos + 1 >= max) return false;\n\n  ch = state.src.charCodeAt(pos + 1);\n\n  if (ch === 0x23 /* # */) {\n    match = state.src.slice(pos).match(DIGITAL_RE);\n    if (match) {\n      if (!silent) {\n        code = match[1][0].toLowerCase() === 'x' ? parseInt(match[1].slice(1), 16) : parseInt(match[1], 10);\n\n        token         = state.push('text_special', '', 0);\n        token.content = isValidEntityCode(code) ? fromCodePoint(code) : fromCodePoint(0xFFFD);\n        token.markup  = match[0];\n        token.info    = 'entity';\n      }\n      state.pos += match[0].length;\n      return true;\n    }\n  } else {\n    match = state.src.slice(pos).match(NAMED_RE);\n    if (match) {\n      if (has(entities, match[1])) {\n        if (!silent) {\n          token         = state.push('text_special', '', 0);\n          token.content = entities[match[1]];\n          token.markup  = match[0];\n          token.info    = 'entity';\n        }\n        state.pos += match[0].length;\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\n","// For each opening emphasis-like marker find a matching closing one\n//\n'use strict';\n\n\nfunction processDelimiters(state, delimiters) {\n  var closerIdx, openerIdx, closer, opener, minOpenerIdx, newMinOpenerIdx,\n      isOddMatch, lastJump,\n      openersBottom = {},\n      max = delimiters.length;\n\n  if (!max) return;\n\n  // headerIdx is the first delimiter of the current (where closer is) delimiter run\n  var headerIdx = 0;\n  var lastTokenIdx = -2; // needs any value lower than -1\n  var jumps = [];\n\n  for (closerIdx = 0; closerIdx < max; closerIdx++) {\n    closer = delimiters[closerIdx];\n\n    jumps.push(0);\n\n    // markers belong to same delimiter run if:\n    //  - they have adjacent tokens\n    //  - AND markers are the same\n    //\n    if (delimiters[headerIdx].marker !== closer.marker || lastTokenIdx !== closer.token - 1) {\n      headerIdx = closerIdx;\n    }\n\n    lastTokenIdx = closer.token;\n\n    // Length is only used for emphasis-specific \"rule of 3\",\n    // if it's not defined (in strikethrough or 3rd party plugins),\n    // we can default it to 0 to disable those checks.\n    //\n    closer.length = closer.length || 0;\n\n    if (!closer.close) continue;\n\n    // Previously calculated lower bounds (previous fails)\n    // for each marker, each delimiter length modulo 3,\n    // and for whether this closer can be an opener;\n    // https://github.com/commonmark/cmark/commit/34250e12ccebdc6372b8b49c44fab57c72443460\n    if (!openersBottom.hasOwnProperty(closer.marker)) {\n      openersBottom[closer.marker] = [ -1, -1, -1, -1, -1, -1 ];\n    }\n\n    minOpenerIdx = openersBottom[closer.marker][(closer.open ? 3 : 0) + (closer.length % 3)];\n\n    openerIdx = headerIdx - jumps[headerIdx] - 1;\n\n    newMinOpenerIdx = openerIdx;\n\n    for (; openerIdx > minOpenerIdx; openerIdx -= jumps[openerIdx] + 1) {\n      opener = delimiters[openerIdx];\n\n      if (opener.marker !== closer.marker) continue;\n\n      if (opener.open && opener.end < 0) {\n\n        isOddMatch = false;\n\n        // from spec:\n        //\n        // If one of the delimiters can both open and close emphasis, then the\n        // sum of the lengths of the delimiter runs containing the opening and\n        // closing delimiters must not be a multiple of 3 unless both lengths\n        // are multiples of 3.\n        //\n        if (opener.close || closer.open) {\n          if ((opener.length + closer.length) % 3 === 0) {\n            if (opener.length % 3 !== 0 || closer.length % 3 !== 0) {\n              isOddMatch = true;\n            }\n          }\n        }\n\n        if (!isOddMatch) {\n          // If previous delimiter cannot be an opener, we can safely skip\n          // the entire sequence in future checks. This is required to make\n          // sure algorithm has linear complexity (see *_*_*_*_*_... case).\n          //\n          lastJump = openerIdx > 0 && !delimiters[openerIdx - 1].open ?\n            jumps[openerIdx - 1] + 1 :\n            0;\n\n          jumps[closerIdx] = closerIdx - openerIdx + lastJump;\n          jumps[openerIdx] = lastJump;\n\n          closer.open  = false;\n          opener.end   = closerIdx;\n          opener.close = false;\n          newMinOpenerIdx = -1;\n          // treat next token as start of run,\n          // it optimizes skips in **<...>**a**<...>** pathological case\n          lastTokenIdx = -2;\n          break;\n        }\n      }\n    }\n\n    if (newMinOpenerIdx !== -1) {\n      // If match for this delimiter run failed, we want to set lower bound for\n      // future lookups. This is required to make sure algorithm has linear\n      // complexity.\n      //\n      // See details here:\n      // https://github.com/commonmark/cmark/issues/178#issuecomment-270417442\n      //\n      openersBottom[closer.marker][(closer.open ? 3 : 0) + ((closer.length || 0) % 3)] = newMinOpenerIdx;\n    }\n  }\n}\n\n\nmodule.exports = function link_pairs(state) {\n  var curr,\n      tokens_meta = state.tokens_meta,\n      max = state.tokens_meta.length;\n\n  processDelimiters(state, state.delimiters);\n\n  for (curr = 0; curr < max; curr++) {\n    if (tokens_meta[curr] && tokens_meta[curr].delimiters) {\n      processDelimiters(state, tokens_meta[curr].delimiters);\n    }\n  }\n};\n","// Inline parser state\n\n'use strict';\n\n\nvar Token          = require('../token');\nvar isWhiteSpace   = require('../common/utils').isWhiteSpace;\nvar isPunctChar    = require('../common/utils').isPunctChar;\nvar isMdAsciiPunct = require('../common/utils').isMdAsciiPunct;\n\n\nfunction StateInline(src, md, env, outTokens) {\n  this.src = src;\n  this.env = env;\n  this.md = md;\n  this.tokens = outTokens;\n  this.tokens_meta = Array(outTokens.length);\n\n  this.pos = 0;\n  this.posMax = this.src.length;\n  this.level = 0;\n  this.pending = '';\n  this.pendingLevel = 0;\n\n  // Stores { start: end } pairs. Useful for backtrack\n  // optimization of pairs parse (emphasis, strikes).\n  this.cache = {};\n\n  // List of emphasis-like delimiters for current tag\n  this.delimiters = [];\n\n  // Stack of delimiter lists for upper level tags\n  this._prev_delimiters = [];\n\n  // backtick length => last seen position\n  this.backticks = {};\n  this.backticksScanned = false;\n\n  // Counter used to disable inline linkify-it execution\n  // inside <a> and markdown links\n  this.linkLevel = 0;\n}\n\n\n// Flush pending text\n//\nStateInline.prototype.pushPending = function () {\n  var token = new Token('text', '', 0);\n  token.content = this.pending;\n  token.level = this.pendingLevel;\n  this.tokens.push(token);\n  this.pending = '';\n  return token;\n};\n\n\n// Push new token to \"stream\".\n// If pending text exists - flush it as text token\n//\nStateInline.prototype.push = function (type, tag, nesting) {\n  if (this.pending) {\n    this.pushPending();\n  }\n\n  var token = new Token(type, tag, nesting);\n  var token_meta = null;\n\n  if (nesting < 0) {\n    // closing tag\n    this.level--;\n    this.delimiters = this._prev_delimiters.pop();\n  }\n\n  token.level = this.level;\n\n  if (nesting > 0) {\n    // opening tag\n    this.level++;\n    this._prev_delimiters.push(this.delimiters);\n    this.delimiters = [];\n    token_meta = { delimiters: this.delimiters };\n  }\n\n  this.pendingLevel = this.level;\n  this.tokens.push(token);\n  this.tokens_meta.push(token_meta);\n  return token;\n};\n\n\n// Scan a sequence of emphasis-like markers, and determine whether\n// it can start an emphasis sequence or end an emphasis sequence.\n//\n//  - start - position to scan from (it should point at a valid marker);\n//  - canSplitWord - determine if these markers can be found inside a word\n//\nStateInline.prototype.scanDelims = function (start, canSplitWord) {\n  var pos = start, lastChar, nextChar, count, can_open, can_close,\n      isLastWhiteSpace, isLastPunctChar,\n      isNextWhiteSpace, isNextPunctChar,\n      left_flanking = true,\n      right_flanking = true,\n      max = this.posMax,\n      marker = this.src.charCodeAt(start);\n\n  // treat beginning of the line as a whitespace\n  lastChar = start > 0 ? this.src.charCodeAt(start - 1) : 0x20;\n\n  while (pos < max && this.src.charCodeAt(pos) === marker) { pos++; }\n\n  count = pos - start;\n\n  // treat end of the line as a whitespace\n  nextChar = pos < max ? this.src.charCodeAt(pos) : 0x20;\n\n  isLastPunctChar = isMdAsciiPunct(lastChar) || isPunctChar(String.fromCharCode(lastChar));\n  isNextPunctChar = isMdAsciiPunct(nextChar) || isPunctChar(String.fromCharCode(nextChar));\n\n  isLastWhiteSpace = isWhiteSpace(lastChar);\n  isNextWhiteSpace = isWhiteSpace(nextChar);\n\n  if (isNextWhiteSpace) {\n    left_flanking = false;\n  } else if (isNextPunctChar) {\n    if (!(isLastWhiteSpace || isLastPunctChar)) {\n      left_flanking = false;\n    }\n  }\n\n  if (isLastWhiteSpace) {\n    right_flanking = false;\n  } else if (isLastPunctChar) {\n    if (!(isNextWhiteSpace || isNextPunctChar)) {\n      right_flanking = false;\n    }\n  }\n\n  if (!canSplitWord) {\n    can_open  = left_flanking  && (!right_flanking || isLastPunctChar);\n    can_close = right_flanking && (!left_flanking  || isNextPunctChar);\n  } else {\n    can_open  = left_flanking;\n    can_close = right_flanking;\n  }\n\n  return {\n    can_open:  can_open,\n    can_close: can_close,\n    length:    count\n  };\n};\n\n\n// re-export Token class to use in block rules\nStateInline.prototype.Token = Token;\n\n\nmodule.exports = StateInline;\n","/** internal\n * class ParserInline\n *\n * Tokenizes paragraph content.\n **/\n'use strict';\n\n\nvar Ruler           = require('./ruler');\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Parser rules\n\nvar _rules = [\n  [ 'text',            require('./rules_inline/text') ],\n  [ 'linkify',         require('./rules_inline/linkify') ],\n  [ 'newline',         require('./rules_inline/newline') ],\n  [ 'escape',          require('./rules_inline/escape') ],\n  [ 'backticks',       require('./rules_inline/backticks') ],\n  [ 'strikethrough',   require('./rules_inline/strikethrough').tokenize ],\n  [ 'emphasis',        require('./rules_inline/emphasis').tokenize ],\n  [ 'link',            require('./rules_inline/link') ],\n  [ 'image',           require('./rules_inline/image') ],\n  [ 'autolink',        require('./rules_inline/autolink') ],\n  [ 'html_inline',     require('./rules_inline/html_inline') ],\n  [ 'entity',          require('./rules_inline/entity') ]\n];\n\n// `rule2` ruleset was created specifically for emphasis/strikethrough\n// post-processing and may be changed in the future.\n//\n// Don't use this for anything except pairs (plugins working with `balance_pairs`).\n//\nvar _rules2 = [\n  [ 'balance_pairs',   require('./rules_inline/balance_pairs') ],\n  [ 'strikethrough',   require('./rules_inline/strikethrough').postProcess ],\n  [ 'emphasis',        require('./rules_inline/emphasis').postProcess ],\n  // rules for pairs separate '**' into its own text tokens, which may be left unused,\n  // rule below merges unused segments back with the rest of the text\n  [ 'fragments_join',  require('./rules_inline/fragments_join') ]\n];\n\n\n/**\n * new ParserInline()\n **/\nfunction ParserInline() {\n  var i;\n\n  /**\n   * ParserInline#ruler -> Ruler\n   *\n   * [[Ruler]] instance. Keep configuration of inline rules.\n   **/\n  this.ruler = new Ruler();\n\n  for (i = 0; i < _rules.length; i++) {\n    this.ruler.push(_rules[i][0], _rules[i][1]);\n  }\n\n  /**\n   * ParserInline#ruler2 -> Ruler\n   *\n   * [[Ruler]] instance. Second ruler used for post-processing\n   * (e.g. in emphasis-like rules).\n   **/\n  this.ruler2 = new Ruler();\n\n  for (i = 0; i < _rules2.length; i++) {\n    this.ruler2.push(_rules2[i][0], _rules2[i][1]);\n  }\n}\n\n\n// Skip single token by running all rules in validation mode;\n// returns `true` if any rule reported success\n//\nParserInline.prototype.skipToken = function (state) {\n  var ok, i, pos = state.pos,\n      rules = this.ruler.getRules(''),\n      len = rules.length,\n      maxNesting = state.md.options.maxNesting,\n      cache = state.cache;\n\n\n  if (typeof cache[pos] !== 'undefined') {\n    state.pos = cache[pos];\n    return;\n  }\n\n  if (state.level < maxNesting) {\n    for (i = 0; i < len; i++) {\n      // Increment state.level and decrement it later to limit recursion.\n      // It's harmless to do here, because no tokens are created. But ideally,\n      // we'd need a separate private state variable for this purpose.\n      //\n      state.level++;\n      ok = rules[i](state, true);\n      state.level--;\n\n      if (ok) { break; }\n    }\n  } else {\n    // Too much nesting, just skip until the end of the paragraph.\n    //\n    // NOTE: this will cause links to behave incorrectly in the following case,\n    //       when an amount of `[` is exactly equal to `maxNesting + 1`:\n    //\n    //       [[[[[[[[[[[[[[[[[[[[[foo]()\n    //\n    // TODO: remove this workaround when CM standard will allow nested links\n    //       (we can replace it by preventing links from being parsed in\n    //       validation mode)\n    //\n    state.pos = state.posMax;\n  }\n\n  if (!ok) { state.pos++; }\n  cache[pos] = state.pos;\n};\n\n\n// Generate tokens for input range\n//\nParserInline.prototype.tokenize = function (state) {\n  var ok, i,\n      rules = this.ruler.getRules(''),\n      len = rules.length,\n      end = state.posMax,\n      maxNesting = state.md.options.maxNesting;\n\n  while (state.pos < end) {\n    // Try all possible rules.\n    // On success, rule should:\n    //\n    // - update `state.pos`\n    // - update `state.tokens`\n    // - return true\n\n    if (state.level < maxNesting) {\n      for (i = 0; i < len; i++) {\n        ok = rules[i](state, false);\n        if (ok) { break; }\n      }\n    }\n\n    if (ok) {\n      if (state.pos >= end) { break; }\n      continue;\n    }\n\n    state.pending += state.src[state.pos++];\n  }\n\n  if (state.pending) {\n    state.pushPending();\n  }\n};\n\n\n/**\n * ParserInline.parse(str, md, env, outTokens)\n *\n * Process input string and push inline tokens into `outTokens`\n **/\nParserInline.prototype.parse = function (str, md, env, outTokens) {\n  var i, rules, len;\n  var state = new this.State(str, md, env, outTokens);\n\n  this.tokenize(state);\n\n  rules = this.ruler2.getRules('');\n  len = rules.length;\n\n  for (i = 0; i < len; i++) {\n    rules[i](state);\n  }\n};\n\n\nParserInline.prototype.State = require('./rules_inline/state_inline');\n\n\nmodule.exports = ParserInline;\n","// Parse backticks\n\n'use strict';\n\n\nmodule.exports = function backtick(state, silent) {\n  var start, max, marker, token, matchStart, matchEnd, openerLength, closerLength,\n      pos = state.pos,\n      ch = state.src.charCodeAt(pos);\n\n  if (ch !== 0x60/* ` */) { return false; }\n\n  start = pos;\n  pos++;\n  max = state.posMax;\n\n  // scan marker length\n  while (pos < max && state.src.charCodeAt(pos) === 0x60/* ` */) { pos++; }\n\n  marker = state.src.slice(start, pos);\n  openerLength = marker.length;\n\n  if (state.backticksScanned && (state.backticks[openerLength] || 0) <= start) {\n    if (!silent) state.pending += marker;\n    state.pos += openerLength;\n    return true;\n  }\n\n  matchStart = matchEnd = pos;\n\n  // Nothing found in the cache, scan until the end of the line (or until marker is found)\n  while ((matchStart = state.src.indexOf('`', matchEnd)) !== -1) {\n    matchEnd = matchStart + 1;\n\n    // scan marker length\n    while (matchEnd < max && state.src.charCodeAt(matchEnd) === 0x60/* ` */) { matchEnd++; }\n\n    closerLength = matchEnd - matchStart;\n\n    if (closerLength === openerLength) {\n      // Found matching closer length.\n      if (!silent) {\n        token     = state.push('code_inline', 'code', 0);\n        token.markup  = marker;\n        token.content = state.src.slice(pos, matchStart)\n          .replace(/\\n/g, ' ')\n          .replace(/^ (.+) $/, '$1');\n      }\n      state.pos = matchEnd;\n      return true;\n    }\n\n    // Some different length found, put it in cache as upper limit of where closer can be found\n    state.backticks[closerLength] = matchStart;\n  }\n\n  // Scanned through the end, didn't find anything\n  state.backticksScanned = true;\n\n  if (!silent) state.pending += marker;\n  state.pos += openerLength;\n  return true;\n};\n","// Clean up tokens after emphasis and strikethrough postprocessing:\n// merge adjacent text nodes into one and re-calculate all token levels\n//\n// This is necessary because initially emphasis delimiter markers (*, _, ~)\n// are treated as their own separate text tokens. Then emphasis rule either\n// leaves them as text (needed to merge with adjacent text) or turns them\n// into opening/closing tags (which messes up levels inside).\n//\n'use strict';\n\n\nmodule.exports = function fragments_join(state) {\n  var curr, last,\n      level = 0,\n      tokens = state.tokens,\n      max = state.tokens.length;\n\n  for (curr = last = 0; curr < max; curr++) {\n    // re-calculate levels after emphasis/strikethrough turns some text nodes\n    // into opening/closing tags\n    if (tokens[curr].nesting < 0) level--; // closing tag\n    tokens[curr].level = level;\n    if (tokens[curr].nesting > 0) level++; // opening tag\n\n    if (tokens[curr].type === 'text' &&\n        curr + 1 < max &&\n        tokens[curr + 1].type === 'text') {\n\n      // collapse two adjacent text nodes\n      tokens[curr + 1].content = tokens[curr].content + tokens[curr + 1].content;\n    } else {\n      if (curr !== last) { tokens[last] = tokens[curr]; }\n\n      last++;\n    }\n  }\n\n  if (curr !== last) {\n    tokens.length = last;\n  }\n};\n","'use strict';\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Helpers\n\n// Merge objects\n//\nfunction assign(obj /*from1, from2, from3, ...*/) {\n  var sources = Array.prototype.slice.call(arguments, 1);\n\n  sources.forEach(function (source) {\n    if (!source) { return; }\n\n    Object.keys(source).forEach(function (key) {\n      obj[key] = source[key];\n    });\n  });\n\n  return obj;\n}\n\nfunction _class(obj) { return Object.prototype.toString.call(obj); }\nfunction isString(obj) { return _class(obj) === '[object String]'; }\nfunction isObject(obj) { return _class(obj) === '[object Object]'; }\nfunction isRegExp(obj) { return _class(obj) === '[object RegExp]'; }\nfunction isFunction(obj) { return _class(obj) === '[object Function]'; }\n\n\nfunction escapeRE(str) { return str.replace(/[.?*+^$[\\]\\\\(){}|-]/g, '\\\\$&'); }\n\n////////////////////////////////////////////////////////////////////////////////\n\n\nvar defaultOptions = {\n  fuzzyLink: true,\n  fuzzyEmail: true,\n  fuzzyIP: false\n};\n\n\nfunction isOptionsObj(obj) {\n  return Object.keys(obj || {}).reduce(function (acc, k) {\n    return acc || defaultOptions.hasOwnProperty(k);\n  }, false);\n}\n\n\nvar defaultSchemas = {\n  'http:': {\n    validate: function (text, pos, self) {\n      var tail = text.slice(pos);\n\n      if (!self.re.http) {\n        // compile lazily, because \"host\"-containing variables can change on tlds update.\n        self.re.http =  new RegExp(\n          '^\\\\/\\\\/' + self.re.src_auth + self.re.src_host_port_strict + self.re.src_path, 'i'\n        );\n      }\n      if (self.re.http.test(tail)) {\n        return tail.match(self.re.http)[0].length;\n      }\n      return 0;\n    }\n  },\n  'https:':  'http:',\n  'ftp:':    'http:',\n  '//':      {\n    validate: function (text, pos, self) {\n      var tail = text.slice(pos);\n\n      if (!self.re.no_http) {\n      // compile lazily, because \"host\"-containing variables can change on tlds update.\n        self.re.no_http =  new RegExp(\n          '^' +\n          self.re.src_auth +\n          // Don't allow single-level domains, because of false positives like '//test'\n          // with code comments\n          '(?:localhost|(?:(?:' + self.re.src_domain + ')\\\\.)+' + self.re.src_domain_root + ')' +\n          self.re.src_port +\n          self.re.src_host_terminator +\n          self.re.src_path,\n\n          'i'\n        );\n      }\n\n      if (self.re.no_http.test(tail)) {\n        // should not be `://` & `///`, that protects from errors in protocol name\n        if (pos >= 3 && text[pos - 3] === ':') { return 0; }\n        if (pos >= 3 && text[pos - 3] === '/') { return 0; }\n        return tail.match(self.re.no_http)[0].length;\n      }\n      return 0;\n    }\n  },\n  'mailto:': {\n    validate: function (text, pos, self) {\n      var tail = text.slice(pos);\n\n      if (!self.re.mailto) {\n        self.re.mailto =  new RegExp(\n          '^' + self.re.src_email_name + '@' + self.re.src_host_strict, 'i'\n        );\n      }\n      if (self.re.mailto.test(tail)) {\n        return tail.match(self.re.mailto)[0].length;\n      }\n      return 0;\n    }\n  }\n};\n\n/*eslint-disable max-len*/\n\n// RE pattern for 2-character tlds (autogenerated by ./support/tlds_2char_gen.js)\nvar tlds_2ch_src_re = 'a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]';\n\n// DON'T try to make PRs with changes. Extend TLDs with LinkifyIt.tlds() instead\nvar tlds_default = 'biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф'.split('|');\n\n/*eslint-enable max-len*/\n\n////////////////////////////////////////////////////////////////////////////////\n\nfunction resetScanCache(self) {\n  self.__index__ = -1;\n  self.__text_cache__   = '';\n}\n\nfunction createValidator(re) {\n  return function (text, pos) {\n    var tail = text.slice(pos);\n\n    if (re.test(tail)) {\n      return tail.match(re)[0].length;\n    }\n    return 0;\n  };\n}\n\nfunction createNormalizer() {\n  return function (match, self) {\n    self.normalize(match);\n  };\n}\n\n// Schemas compiler. Build regexps.\n//\nfunction compile(self) {\n\n  // Load & clone RE patterns.\n  var re = self.re = require('./lib/re')(self.__opts__);\n\n  // Define dynamic patterns\n  var tlds = self.__tlds__.slice();\n\n  self.onCompile();\n\n  if (!self.__tlds_replaced__) {\n    tlds.push(tlds_2ch_src_re);\n  }\n  tlds.push(re.src_xn);\n\n  re.src_tlds = tlds.join('|');\n\n  function untpl(tpl) { return tpl.replace('%TLDS%', re.src_tlds); }\n\n  re.email_fuzzy      = RegExp(untpl(re.tpl_email_fuzzy), 'i');\n  re.link_fuzzy       = RegExp(untpl(re.tpl_link_fuzzy), 'i');\n  re.link_no_ip_fuzzy = RegExp(untpl(re.tpl_link_no_ip_fuzzy), 'i');\n  re.host_fuzzy_test  = RegExp(untpl(re.tpl_host_fuzzy_test), 'i');\n\n  //\n  // Compile each schema\n  //\n\n  var aliases = [];\n\n  self.__compiled__ = {}; // Reset compiled data\n\n  function schemaError(name, val) {\n    throw new Error('(LinkifyIt) Invalid schema \"' + name + '\": ' + val);\n  }\n\n  Object.keys(self.__schemas__).forEach(function (name) {\n    var val = self.__schemas__[name];\n\n    // skip disabled methods\n    if (val === null) { return; }\n\n    var compiled = { validate: null, link: null };\n\n    self.__compiled__[name] = compiled;\n\n    if (isObject(val)) {\n      if (isRegExp(val.validate)) {\n        compiled.validate = createValidator(val.validate);\n      } else if (isFunction(val.validate)) {\n        compiled.validate = val.validate;\n      } else {\n        schemaError(name, val);\n      }\n\n      if (isFunction(val.normalize)) {\n        compiled.normalize = val.normalize;\n      } else if (!val.normalize) {\n        compiled.normalize = createNormalizer();\n      } else {\n        schemaError(name, val);\n      }\n\n      return;\n    }\n\n    if (isString(val)) {\n      aliases.push(name);\n      return;\n    }\n\n    schemaError(name, val);\n  });\n\n  //\n  // Compile postponed aliases\n  //\n\n  aliases.forEach(function (alias) {\n    if (!self.__compiled__[self.__schemas__[alias]]) {\n      // Silently fail on missed schemas to avoid errons on disable.\n      // schemaError(alias, self.__schemas__[alias]);\n      return;\n    }\n\n    self.__compiled__[alias].validate =\n      self.__compiled__[self.__schemas__[alias]].validate;\n    self.__compiled__[alias].normalize =\n      self.__compiled__[self.__schemas__[alias]].normalize;\n  });\n\n  //\n  // Fake record for guessed links\n  //\n  self.__compiled__[''] = { validate: null, normalize: createNormalizer() };\n\n  //\n  // Build schema condition\n  //\n  var slist = Object.keys(self.__compiled__)\n                      .filter(function (name) {\n                        // Filter disabled & fake schemas\n                        return name.length > 0 && self.__compiled__[name];\n                      })\n                      .map(escapeRE)\n                      .join('|');\n  // (?!_) cause 1.5x slowdown\n  self.re.schema_test     = RegExp('(^|(?!_)(?:[><\\uff5c]|' + re.src_ZPCc + '))(' + slist + ')', 'i');\n  self.re.schema_search   = RegExp('(^|(?!_)(?:[><\\uff5c]|' + re.src_ZPCc + '))(' + slist + ')', 'ig');\n  self.re.schema_at_start = RegExp('^' + self.re.schema_search.source, 'i');\n\n  self.re.pretest = RegExp(\n    '(' + self.re.schema_test.source + ')|(' + self.re.host_fuzzy_test.source + ')|@',\n    'i'\n  );\n\n  //\n  // Cleanup\n  //\n\n  resetScanCache(self);\n}\n\n/**\n * class Match\n *\n * Match result. Single element of array, returned by [[LinkifyIt#match]]\n **/\nfunction Match(self, shift) {\n  var start = self.__index__,\n      end   = self.__last_index__,\n      text  = self.__text_cache__.slice(start, end);\n\n  /**\n   * Match#schema -> String\n   *\n   * Prefix (protocol) for matched string.\n   **/\n  this.schema    = self.__schema__.toLowerCase();\n  /**\n   * Match#index -> Number\n   *\n   * First position of matched string.\n   **/\n  this.index     = start + shift;\n  /**\n   * Match#lastIndex -> Number\n   *\n   * Next position after matched string.\n   **/\n  this.lastIndex = end + shift;\n  /**\n   * Match#raw -> String\n   *\n   * Matched string.\n   **/\n  this.raw       = text;\n  /**\n   * Match#text -> String\n   *\n   * Notmalized text of matched string.\n   **/\n  this.text      = text;\n  /**\n   * Match#url -> String\n   *\n   * Normalized url of matched string.\n   **/\n  this.url       = text;\n}\n\nfunction createMatch(self, shift) {\n  var match = new Match(self, shift);\n\n  self.__compiled__[match.schema].normalize(match, self);\n\n  return match;\n}\n\n\n/**\n * class LinkifyIt\n **/\n\n/**\n * new LinkifyIt(schemas, options)\n * - schemas (Object): Optional. Additional schemas to validate (prefix/validator)\n * - options (Object): { fuzzyLink|fuzzyEmail|fuzzyIP: true|false }\n *\n * Creates new linkifier instance with optional additional schemas.\n * Can be called without `new` keyword for convenience.\n *\n * By default understands:\n *\n * - `http(s)://...` , `ftp://...`, `mailto:...` & `//...` links\n * - \"fuzzy\" links and emails (example.com, foo@bar.com).\n *\n * `schemas` is an object, where each key/value describes protocol/rule:\n *\n * - __key__ - link prefix (usually, protocol name with `:` at the end, `skype:`\n *   for example). `linkify-it` makes shure that prefix is not preceeded with\n *   alphanumeric char and symbols. Only whitespaces and punctuation allowed.\n * - __value__ - rule to check tail after link prefix\n *   - _String_ - just alias to existing rule\n *   - _Object_\n *     - _validate_ - validator function (should return matched length on success),\n *       or `RegExp`.\n *     - _normalize_ - optional function to normalize text & url of matched result\n *       (for example, for @twitter mentions).\n *\n * `options`:\n *\n * - __fuzzyLink__ - recognige URL-s without `http(s):` prefix. Default `true`.\n * - __fuzzyIP__ - allow IPs in fuzzy links above. Can conflict with some texts\n *   like version numbers. Default `false`.\n * - __fuzzyEmail__ - recognize emails without `mailto:` prefix.\n *\n **/\nfunction LinkifyIt(schemas, options) {\n  if (!(this instanceof LinkifyIt)) {\n    return new LinkifyIt(schemas, options);\n  }\n\n  if (!options) {\n    if (isOptionsObj(schemas)) {\n      options = schemas;\n      schemas = {};\n    }\n  }\n\n  this.__opts__           = assign({}, defaultOptions, options);\n\n  // Cache last tested result. Used to skip repeating steps on next `match` call.\n  this.__index__          = -1;\n  this.__last_index__     = -1; // Next scan position\n  this.__schema__         = '';\n  this.__text_cache__     = '';\n\n  this.__schemas__        = assign({}, defaultSchemas, schemas);\n  this.__compiled__       = {};\n\n  this.__tlds__           = tlds_default;\n  this.__tlds_replaced__  = false;\n\n  this.re = {};\n\n  compile(this);\n}\n\n\n/** chainable\n * LinkifyIt#add(schema, definition)\n * - schema (String): rule name (fixed pattern prefix)\n * - definition (String|RegExp|Object): schema definition\n *\n * Add new rule definition. See constructor description for details.\n **/\nLinkifyIt.prototype.add = function add(schema, definition) {\n  this.__schemas__[schema] = definition;\n  compile(this);\n  return this;\n};\n\n\n/** chainable\n * LinkifyIt#set(options)\n * - options (Object): { fuzzyLink|fuzzyEmail|fuzzyIP: true|false }\n *\n * Set recognition options for links without schema.\n **/\nLinkifyIt.prototype.set = function set(options) {\n  this.__opts__ = assign(this.__opts__, options);\n  return this;\n};\n\n\n/**\n * LinkifyIt#test(text) -> Boolean\n *\n * Searches linkifiable pattern and returns `true` on success or `false` on fail.\n **/\nLinkifyIt.prototype.test = function test(text) {\n  // Reset scan cache\n  this.__text_cache__ = text;\n  this.__index__      = -1;\n\n  if (!text.length) { return false; }\n\n  var m, ml, me, len, shift, next, re, tld_pos, at_pos;\n\n  // try to scan for link with schema - that's the most simple rule\n  if (this.re.schema_test.test(text)) {\n    re = this.re.schema_search;\n    re.lastIndex = 0;\n    while ((m = re.exec(text)) !== null) {\n      len = this.testSchemaAt(text, m[2], re.lastIndex);\n      if (len) {\n        this.__schema__     = m[2];\n        this.__index__      = m.index + m[1].length;\n        this.__last_index__ = m.index + m[0].length + len;\n        break;\n      }\n    }\n  }\n\n  if (this.__opts__.fuzzyLink && this.__compiled__['http:']) {\n    // guess schemaless links\n    tld_pos = text.search(this.re.host_fuzzy_test);\n    if (tld_pos >= 0) {\n      // if tld is located after found link - no need to check fuzzy pattern\n      if (this.__index__ < 0 || tld_pos < this.__index__) {\n        if ((ml = text.match(this.__opts__.fuzzyIP ? this.re.link_fuzzy : this.re.link_no_ip_fuzzy)) !== null) {\n\n          shift = ml.index + ml[1].length;\n\n          if (this.__index__ < 0 || shift < this.__index__) {\n            this.__schema__     = '';\n            this.__index__      = shift;\n            this.__last_index__ = ml.index + ml[0].length;\n          }\n        }\n      }\n    }\n  }\n\n  if (this.__opts__.fuzzyEmail && this.__compiled__['mailto:']) {\n    // guess schemaless emails\n    at_pos = text.indexOf('@');\n    if (at_pos >= 0) {\n      // We can't skip this check, because this cases are possible:\n      // 192.168.1.1@gmail.com, my.in@example.com\n      if ((me = text.match(this.re.email_fuzzy)) !== null) {\n\n        shift = me.index + me[1].length;\n        next  = me.index + me[0].length;\n\n        if (this.__index__ < 0 || shift < this.__index__ ||\n            (shift === this.__index__ && next > this.__last_index__)) {\n          this.__schema__     = 'mailto:';\n          this.__index__      = shift;\n          this.__last_index__ = next;\n        }\n      }\n    }\n  }\n\n  return this.__index__ >= 0;\n};\n\n\n/**\n * LinkifyIt#pretest(text) -> Boolean\n *\n * Very quick check, that can give false positives. Returns true if link MAY BE\n * can exists. Can be used for speed optimization, when you need to check that\n * link NOT exists.\n **/\nLinkifyIt.prototype.pretest = function pretest(text) {\n  return this.re.pretest.test(text);\n};\n\n\n/**\n * LinkifyIt#testSchemaAt(text, name, position) -> Number\n * - text (String): text to scan\n * - name (String): rule (schema) name\n * - position (Number): text offset to check from\n *\n * Similar to [[LinkifyIt#test]] but checks only specific protocol tail exactly\n * at given position. Returns length of found pattern (0 on fail).\n **/\nLinkifyIt.prototype.testSchemaAt = function testSchemaAt(text, schema, pos) {\n  // If not supported schema check requested - terminate\n  if (!this.__compiled__[schema.toLowerCase()]) {\n    return 0;\n  }\n  return this.__compiled__[schema.toLowerCase()].validate(text, pos, this);\n};\n\n\n/**\n * LinkifyIt#match(text) -> Array|null\n *\n * Returns array of found link descriptions or `null` on fail. We strongly\n * recommend to use [[LinkifyIt#test]] first, for best speed.\n *\n * ##### Result match description\n *\n * - __schema__ - link schema, can be empty for fuzzy links, or `//` for\n *   protocol-neutral  links.\n * - __index__ - offset of matched text\n * - __lastIndex__ - index of next char after mathch end\n * - __raw__ - matched text\n * - __text__ - normalized text\n * - __url__ - link, generated from matched text\n **/\nLinkifyIt.prototype.match = function match(text) {\n  var shift = 0, result = [];\n\n  // Try to take previous element from cache, if .test() called before\n  if (this.__index__ >= 0 && this.__text_cache__ === text) {\n    result.push(createMatch(this, shift));\n    shift = this.__last_index__;\n  }\n\n  // Cut head if cache was used\n  var tail = shift ? text.slice(shift) : text;\n\n  // Scan string until end reached\n  while (this.test(tail)) {\n    result.push(createMatch(this, shift));\n\n    tail = tail.slice(this.__last_index__);\n    shift += this.__last_index__;\n  }\n\n  if (result.length) {\n    return result;\n  }\n\n  return null;\n};\n\n\n/**\n * LinkifyIt#matchAtStart(text) -> Match|null\n *\n * Returns fully-formed (not fuzzy) link if it starts at the beginning\n * of the string, and null otherwise.\n **/\nLinkifyIt.prototype.matchAtStart = function matchAtStart(text) {\n  // Reset scan cache\n  this.__text_cache__ = text;\n  this.__index__      = -1;\n\n  if (!text.length) return null;\n\n  var m = this.re.schema_at_start.exec(text);\n  if (!m) return null;\n\n  var len = this.testSchemaAt(text, m[2], m[0].length);\n  if (!len) return null;\n\n  this.__schema__     = m[2];\n  this.__index__      = m.index + m[1].length;\n  this.__last_index__ = m.index + m[0].length + len;\n\n  return createMatch(this, 0);\n};\n\n\n/** chainable\n * LinkifyIt#tlds(list [, keepOld]) -> this\n * - list (Array): list of tlds\n * - keepOld (Boolean): merge with current list if `true` (`false` by default)\n *\n * Load (or merge) new tlds list. Those are user for fuzzy links (without prefix)\n * to avoid false positives. By default this algorythm used:\n *\n * - hostname with any 2-letter root zones are ok.\n * - biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф\n *   are ok.\n * - encoded (`xn--...`) root zones are ok.\n *\n * If list is replaced, then exact match for 2-chars root zones will be checked.\n **/\nLinkifyIt.prototype.tlds = function tlds(list, keepOld) {\n  list = Array.isArray(list) ? list : [ list ];\n\n  if (!keepOld) {\n    this.__tlds__ = list.slice();\n    this.__tlds_replaced__ = true;\n    compile(this);\n    return this;\n  }\n\n  this.__tlds__ = this.__tlds__.concat(list)\n                                  .sort()\n                                  .filter(function (el, idx, arr) {\n                                    return el !== arr[idx - 1];\n                                  })\n                                  .reverse();\n\n  compile(this);\n  return this;\n};\n\n/**\n * LinkifyIt#normalize(match)\n *\n * Default normalizer (if schema does not define it's own).\n **/\nLinkifyIt.prototype.normalize = function normalize(match) {\n\n  // Do minimal possible changes by default. Need to collect feedback prior\n  // to move forward https://github.com/markdown-it/linkify-it/issues/1\n\n  if (!match.schema) { match.url = 'http://' + match.url; }\n\n  if (match.schema === 'mailto:' && !/^mailto:/i.test(match.url)) {\n    match.url = 'mailto:' + match.url;\n  }\n};\n\n\n/**\n * LinkifyIt#onCompile()\n *\n * Override to modify basic RegExp-s.\n **/\nLinkifyIt.prototype.onCompile = function onCompile() {\n};\n\n\nmodule.exports = LinkifyIt;\n","'use strict';\n\n\nmodule.exports = function (opts) {\n  var re = {};\n  opts = opts || {};\n\n  // Use direct extract instead of `regenerate` to reduse browserified size\n  re.src_Any = require('uc.micro/properties/Any/regex').source;\n  re.src_Cc  = require('uc.micro/categories/Cc/regex').source;\n  re.src_Z   = require('uc.micro/categories/Z/regex').source;\n  re.src_P   = require('uc.micro/categories/P/regex').source;\n\n  // \\p{\\Z\\P\\Cc\\CF} (white spaces + control + format + punctuation)\n  re.src_ZPCc = [ re.src_Z, re.src_P, re.src_Cc ].join('|');\n\n  // \\p{\\Z\\Cc} (white spaces + control)\n  re.src_ZCc = [ re.src_Z, re.src_Cc ].join('|');\n\n  // Experimental. List of chars, completely prohibited in links\n  // because can separate it from other part of text\n  var text_separators = '[><\\uff5c]';\n\n  // All possible word characters (everything without punctuation, spaces & controls)\n  // Defined via punctuation & spaces to save space\n  // Should be something like \\p{\\L\\N\\S\\M} (\\w but without `_`)\n  re.src_pseudo_letter       = '(?:(?!' + text_separators + '|' + re.src_ZPCc + ')' + re.src_Any + ')';\n  // The same as abothe but without [0-9]\n  // var src_pseudo_letter_non_d = '(?:(?![0-9]|' + src_ZPCc + ')' + src_Any + ')';\n\n  ////////////////////////////////////////////////////////////////////////////////\n\n  re.src_ip4 =\n\n    '(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)';\n\n  // Prohibit any of \"@/[]()\" in user/pass to avoid wrong domain fetch.\n  re.src_auth    = '(?:(?:(?!' + re.src_ZCc + '|[@/\\\\[\\\\]()]).)+@)?';\n\n  re.src_port =\n\n    '(?::(?:6(?:[0-4]\\\\d{3}|5(?:[0-4]\\\\d{2}|5(?:[0-2]\\\\d|3[0-5])))|[1-5]?\\\\d{1,4}))?';\n\n  re.src_host_terminator =\n\n    '(?=$|' + text_separators + '|' + re.src_ZPCc + ')' +\n    '(?!' + (opts['---'] ? '-(?!--)|' : '-|') + '_|:\\\\d|\\\\.-|\\\\.(?!$|' + re.src_ZPCc + '))';\n\n  re.src_path =\n\n    '(?:' +\n      '[/?#]' +\n        '(?:' +\n          '(?!' + re.src_ZCc + '|' + text_separators + '|[()[\\\\]{}.,\"\\'?!\\\\-;]).|' +\n          '\\\\[(?:(?!' + re.src_ZCc + '|\\\\]).)*\\\\]|' +\n          '\\\\((?:(?!' + re.src_ZCc + '|[)]).)*\\\\)|' +\n          '\\\\{(?:(?!' + re.src_ZCc + '|[}]).)*\\\\}|' +\n          '\\\\\"(?:(?!' + re.src_ZCc + '|[\"]).)+\\\\\"|' +\n          \"\\\\'(?:(?!\" + re.src_ZCc + \"|[']).)+\\\\'|\" +\n          \"\\\\'(?=\" + re.src_pseudo_letter + '|[-])|' +  // allow `I'm_king` if no pair found\n          '\\\\.{2,}[a-zA-Z0-9%/&]|' + // google has many dots in \"google search\" links (#66, #81).\n                                     // github has ... in commit range links,\n                                     // Restrict to\n                                     // - english\n                                     // - percent-encoded\n                                     // - parts of file path\n                                     // - params separator\n                                     // until more examples found.\n          '\\\\.(?!' + re.src_ZCc + '|[.]|$)|' +\n          (opts['---'] ?\n            '\\\\-(?!--(?:[^-]|$))(?:-*)|' // `---` => long dash, terminate\n            :\n            '\\\\-+|'\n          ) +\n          ',(?!' + re.src_ZCc + '|$)|' +       // allow `,,,` in paths\n          ';(?!' + re.src_ZCc + '|$)|' +       // allow `;` if not followed by space-like char\n          '\\\\!+(?!' + re.src_ZCc + '|[!]|$)|' +  // allow `!!!` in paths, but not at the end\n          '\\\\?(?!' + re.src_ZCc + '|[?]|$)' +\n        ')+' +\n      '|\\\\/' +\n    ')?';\n\n  // Allow anything in markdown spec, forbid quote (\") at the first position\n  // because emails enclosed in quotes are far more common\n  re.src_email_name =\n\n    '[\\\\-;:&=\\\\+\\\\$,\\\\.a-zA-Z0-9_][\\\\-;:&=\\\\+\\\\$,\\\\\"\\\\.a-zA-Z0-9_]*';\n\n  re.src_xn =\n\n    'xn--[a-z0-9\\\\-]{1,59}';\n\n  // More to read about domain names\n  // http://serverfault.com/questions/638260/\n\n  re.src_domain_root =\n\n    // Allow letters & digits (http://test1)\n    '(?:' +\n      re.src_xn +\n      '|' +\n      re.src_pseudo_letter + '{1,63}' +\n    ')';\n\n  re.src_domain =\n\n    '(?:' +\n      re.src_xn +\n      '|' +\n      '(?:' + re.src_pseudo_letter + ')' +\n      '|' +\n      '(?:' + re.src_pseudo_letter + '(?:-|' + re.src_pseudo_letter + '){0,61}' + re.src_pseudo_letter + ')' +\n    ')';\n\n  re.src_host =\n\n    '(?:' +\n    // Don't need IP check, because digits are already allowed in normal domain names\n    //   src_ip4 +\n    // '|' +\n      '(?:(?:(?:' + re.src_domain + ')\\\\.)*' + re.src_domain/*_root*/ + ')' +\n    ')';\n\n  re.tpl_host_fuzzy =\n\n    '(?:' +\n      re.src_ip4 +\n    '|' +\n      '(?:(?:(?:' + re.src_domain + ')\\\\.)+(?:%TLDS%))' +\n    ')';\n\n  re.tpl_host_no_ip_fuzzy =\n\n    '(?:(?:(?:' + re.src_domain + ')\\\\.)+(?:%TLDS%))';\n\n  re.src_host_strict =\n\n    re.src_host + re.src_host_terminator;\n\n  re.tpl_host_fuzzy_strict =\n\n    re.tpl_host_fuzzy + re.src_host_terminator;\n\n  re.src_host_port_strict =\n\n    re.src_host + re.src_port + re.src_host_terminator;\n\n  re.tpl_host_port_fuzzy_strict =\n\n    re.tpl_host_fuzzy + re.src_port + re.src_host_terminator;\n\n  re.tpl_host_port_no_ip_fuzzy_strict =\n\n    re.tpl_host_no_ip_fuzzy + re.src_port + re.src_host_terminator;\n\n\n  ////////////////////////////////////////////////////////////////////////////////\n  // Main rules\n\n  // Rude test fuzzy links by host, for quick deny\n  re.tpl_host_fuzzy_test =\n\n    'localhost|www\\\\.|\\\\.\\\\d{1,3}\\\\.|(?:\\\\.(?:%TLDS%)(?:' + re.src_ZPCc + '|>|$))';\n\n  re.tpl_email_fuzzy =\n\n      '(^|' + text_separators + '|\"|\\\\(|' + re.src_ZCc + ')' +\n      '(' + re.src_email_name + '@' + re.tpl_host_fuzzy_strict + ')';\n\n  re.tpl_link_fuzzy =\n      // Fuzzy link can't be prepended with .:/\\- and non punctuation.\n      // but can start with > (markdown blockquote)\n      '(^|(?![.:/\\\\-_@])(?:[$+<=>^`|\\uff5c]|' + re.src_ZPCc + '))' +\n      '((?![$+<=>^`|\\uff5c])' + re.tpl_host_port_fuzzy_strict + re.src_path + ')';\n\n  re.tpl_link_no_ip_fuzzy =\n      // Fuzzy link can't be prepended with .:/\\- and non punctuation.\n      // but can start with > (markdown blockquote)\n      '(^|(?![.:/\\\\-_@])(?:[$+<=>^`|\\uff5c]|' + re.src_ZPCc + '))' +\n      '((?![$+<=>^`|\\uff5c])' + re.tpl_host_port_no_ip_fuzzy_strict + re.src_path + ')';\n\n  return re;\n};\n","'use strict';\n\n/** Highest positive signed 32-bit float value */\nconst maxInt = 2147483647; // aka. 0x7FFFFFFF or 2^31-1\n\n/** Bootstring parameters */\nconst base = 36;\nconst tMin = 1;\nconst tMax = 26;\nconst skew = 38;\nconst damp = 700;\nconst initialBias = 72;\nconst initialN = 128; // 0x80\nconst delimiter = '-'; // '\\x2D'\n\n/** Regular expressions */\nconst regexPunycode = /^xn--/;\nconst regexNonASCII = /[^\\0-\\x7E]/; // non-ASCII chars\nconst regexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g; // RFC 3490 separators\n\n/** Error messages */\nconst errors = {\n\t'overflow': 'Overflow: input needs wider integers to process',\n\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t'invalid-input': 'Invalid input'\n};\n\n/** Convenience shortcuts */\nconst baseMinusTMin = base - tMin;\nconst floor = Math.floor;\nconst stringFromCharCode = String.fromCharCode;\n\n/*--------------------------------------------------------------------------*/\n\n/**\n * A generic error utility function.\n * @private\n * @param {String} type The error type.\n * @returns {Error} Throws a `RangeError` with the applicable error message.\n */\nfunction error(type) {\n\tthrow new RangeError(errors[type]);\n}\n\n/**\n * A generic `Array#map` utility function.\n * @private\n * @param {Array} array The array to iterate over.\n * @param {Function} callback The function that gets called for every array\n * item.\n * @returns {Array} A new array of values returned by the callback function.\n */\nfunction map(array, fn) {\n\tconst result = [];\n\tlet length = array.length;\n\twhile (length--) {\n\t\tresult[length] = fn(array[length]);\n\t}\n\treturn result;\n}\n\n/**\n * A simple `Array#map`-like wrapper to work with domain name strings or email\n * addresses.\n * @private\n * @param {String} domain The domain name or email address.\n * @param {Function} callback The function that gets called for every\n * character.\n * @returns {Array} A new string of characters returned by the callback\n * function.\n */\nfunction mapDomain(string, fn) {\n\tconst parts = string.split('@');\n\tlet result = '';\n\tif (parts.length > 1) {\n\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t// the local part (i.e. everything up to `@`) intact.\n\t\tresult = parts[0] + '@';\n\t\tstring = parts[1];\n\t}\n\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\tstring = string.replace(regexSeparators, '\\x2E');\n\tconst labels = string.split('.');\n\tconst encoded = map(labels, fn).join('.');\n\treturn result + encoded;\n}\n\n/**\n * Creates an array containing the numeric code points of each Unicode\n * character in the string. While JavaScript uses UCS-2 internally,\n * this function will convert a pair of surrogate halves (each of which\n * UCS-2 exposes as separate characters) into a single code point,\n * matching UTF-16.\n * @see `punycode.ucs2.encode`\n * @see <https://mathiasbynens.be/notes/javascript-encoding>\n * @memberOf punycode.ucs2\n * @name decode\n * @param {String} string The Unicode input string (UCS-2).\n * @returns {Array} The new array of code points.\n */\nfunction ucs2decode(string) {\n\tconst output = [];\n\tlet counter = 0;\n\tconst length = string.length;\n\twhile (counter < length) {\n\t\tconst value = string.charCodeAt(counter++);\n\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t// It's a high surrogate, and there is a next character.\n\t\t\tconst extra = string.charCodeAt(counter++);\n\t\t\tif ((extra & 0xFC00) == 0xDC00) { // Low surrogate.\n\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t} else {\n\t\t\t\t// It's an unmatched surrogate; only append this code unit, in case the\n\t\t\t\t// next code unit is the high surrogate of a surrogate pair.\n\t\t\t\toutput.push(value);\n\t\t\t\tcounter--;\n\t\t\t}\n\t\t} else {\n\t\t\toutput.push(value);\n\t\t}\n\t}\n\treturn output;\n}\n\n/**\n * Creates a string based on an array of numeric code points.\n * @see `punycode.ucs2.decode`\n * @memberOf punycode.ucs2\n * @name encode\n * @param {Array} codePoints The array of numeric code points.\n * @returns {String} The new Unicode string (UCS-2).\n */\nconst ucs2encode = array => String.fromCodePoint(...array);\n\n/**\n * Converts a basic code point into a digit/integer.\n * @see `digitToBasic()`\n * @private\n * @param {Number} codePoint The basic numeric code point value.\n * @returns {Number} The numeric value of a basic code point (for use in\n * representing integers) in the range `0` to `base - 1`, or `base` if\n * the code point does not represent a value.\n */\nconst basicToDigit = function(codePoint) {\n\tif (codePoint - 0x30 < 0x0A) {\n\t\treturn codePoint - 0x16;\n\t}\n\tif (codePoint - 0x41 < 0x1A) {\n\t\treturn codePoint - 0x41;\n\t}\n\tif (codePoint - 0x61 < 0x1A) {\n\t\treturn codePoint - 0x61;\n\t}\n\treturn base;\n};\n\n/**\n * Converts a digit/integer into a basic code point.\n * @see `basicToDigit()`\n * @private\n * @param {Number} digit The numeric value of a basic code point.\n * @returns {Number} The basic code point whose value (when used for\n * representing integers) is `digit`, which needs to be in the range\n * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n * used; else, the lowercase form is used. The behavior is undefined\n * if `flag` is non-zero and `digit` has no uppercase form.\n */\nconst digitToBasic = function(digit, flag) {\n\t//  0..25 map to ASCII a..z or A..Z\n\t// 26..35 map to ASCII 0..9\n\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n};\n\n/**\n * Bias adaptation function as per section 3.4 of RFC 3492.\n * https://tools.ietf.org/html/rfc3492#section-3.4\n * @private\n */\nconst adapt = function(delta, numPoints, firstTime) {\n\tlet k = 0;\n\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\tdelta += floor(delta / numPoints);\n\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\tdelta = floor(delta / baseMinusTMin);\n\t}\n\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n};\n\n/**\n * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n * symbols.\n * @memberOf punycode\n * @param {String} input The Punycode string of ASCII-only symbols.\n * @returns {String} The resulting string of Unicode symbols.\n */\nconst decode = function(input) {\n\t// Don't use UCS-2.\n\tconst output = [];\n\tconst inputLength = input.length;\n\tlet i = 0;\n\tlet n = initialN;\n\tlet bias = initialBias;\n\n\t// Handle the basic code points: let `basic` be the number of input code\n\t// points before the last delimiter, or `0` if there is none, then copy\n\t// the first basic code points to the output.\n\n\tlet basic = input.lastIndexOf(delimiter);\n\tif (basic < 0) {\n\t\tbasic = 0;\n\t}\n\n\tfor (let j = 0; j < basic; ++j) {\n\t\t// if it's not a basic code point\n\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\terror('not-basic');\n\t\t}\n\t\toutput.push(input.charCodeAt(j));\n\t}\n\n\t// Main decoding loop: start just after the last delimiter if any basic code\n\t// points were copied; start at the beginning otherwise.\n\n\tfor (let index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t// `index` is the index of the next character to be consumed.\n\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t// which gets added to `i`. The overflow checking is easier\n\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t// value at the end to obtain `delta`.\n\t\tlet oldi = i;\n\t\tfor (let w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\tif (index >= inputLength) {\n\t\t\t\terror('invalid-input');\n\t\t\t}\n\n\t\t\tconst digit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\ti += digit * w;\n\t\t\tconst t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\tif (digit < t) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst baseMinusT = base - t;\n\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tw *= baseMinusT;\n\n\t\t}\n\n\t\tconst out = output.length + 1;\n\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t// incrementing `n` each time, so we'll fix that now:\n\t\tif (floor(i / out) > maxInt - n) {\n\t\t\terror('overflow');\n\t\t}\n\n\t\tn += floor(i / out);\n\t\ti %= out;\n\n\t\t// Insert `n` at position `i` of the output.\n\t\toutput.splice(i++, 0, n);\n\n\t}\n\n\treturn String.fromCodePoint(...output);\n};\n\n/**\n * Converts a string of Unicode symbols (e.g. a domain name label) to a\n * Punycode string of ASCII-only symbols.\n * @memberOf punycode\n * @param {String} input The string of Unicode symbols.\n * @returns {String} The resulting Punycode string of ASCII-only symbols.\n */\nconst encode = function(input) {\n\tconst output = [];\n\n\t// Convert the input in UCS-2 to an array of Unicode code points.\n\tinput = ucs2decode(input);\n\n\t// Cache the length.\n\tlet inputLength = input.length;\n\n\t// Initialize the state.\n\tlet n = initialN;\n\tlet delta = 0;\n\tlet bias = initialBias;\n\n\t// Handle the basic code points.\n\tfor (const currentValue of input) {\n\t\tif (currentValue < 0x80) {\n\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t}\n\t}\n\n\tlet basicLength = output.length;\n\tlet handledCPCount = basicLength;\n\n\t// `handledCPCount` is the number of code points that have been handled;\n\t// `basicLength` is the number of basic code points.\n\n\t// Finish the basic string with a delimiter unless it's empty.\n\tif (basicLength) {\n\t\toutput.push(delimiter);\n\t}\n\n\t// Main encoding loop:\n\twhile (handledCPCount < inputLength) {\n\n\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t// larger one:\n\t\tlet m = maxInt;\n\t\tfor (const currentValue of input) {\n\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\tm = currentValue;\n\t\t\t}\n\t\t}\n\n\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t// but guard against overflow.\n\t\tconst handledCPCountPlusOne = handledCPCount + 1;\n\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\terror('overflow');\n\t\t}\n\n\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\tn = m;\n\n\t\tfor (const currentValue of input) {\n\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\t\t\tif (currentValue == n) {\n\t\t\t\t// Represent delta as a generalized variable-length integer.\n\t\t\t\tlet q = delta;\n\t\t\t\tfor (let k = base; /* no condition */; k += base) {\n\t\t\t\t\tconst t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst qMinusT = q - t;\n\t\t\t\t\tconst baseMinusT = base - t;\n\t\t\t\t\toutput.push(\n\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t);\n\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t}\n\n\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\tdelta = 0;\n\t\t\t\t++handledCPCount;\n\t\t\t}\n\t\t}\n\n\t\t++delta;\n\t\t++n;\n\n\t}\n\treturn output.join('');\n};\n\n/**\n * Converts a Punycode string representing a domain name or an email address\n * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n * it doesn't matter if you call it on a string that has already been\n * converted to Unicode.\n * @memberOf punycode\n * @param {String} input The Punycoded domain name or email address to\n * convert to Unicode.\n * @returns {String} The Unicode representation of the given Punycode\n * string.\n */\nconst toUnicode = function(input) {\n\treturn mapDomain(input, function(string) {\n\t\treturn regexPunycode.test(string)\n\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t: string;\n\t});\n};\n\n/**\n * Converts a Unicode string representing a domain name or an email address to\n * Punycode. Only the non-ASCII parts of the domain name will be converted,\n * i.e. it doesn't matter if you call it with a domain that's already in\n * ASCII.\n * @memberOf punycode\n * @param {String} input The domain name or email address to convert, as a\n * Unicode string.\n * @returns {String} The Punycode representation of the given domain name or\n * email address.\n */\nconst toASCII = function(input) {\n\treturn mapDomain(input, function(string) {\n\t\treturn regexNonASCII.test(string)\n\t\t\t? 'xn--' + encode(string)\n\t\t\t: string;\n\t});\n};\n\n/*--------------------------------------------------------------------------*/\n\n/** Define the public API */\nconst punycode = {\n\t/**\n\t * A string representing the current Punycode.js version number.\n\t * @memberOf punycode\n\t * @type String\n\t */\n\t'version': '2.1.0',\n\t/**\n\t * An object of methods to convert from JavaScript's internal character\n\t * representation (UCS-2) to Unicode code points, and back.\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode\n\t * @type Object\n\t */\n\t'ucs2': {\n\t\t'decode': ucs2decode,\n\t\t'encode': ucs2encode\n\t},\n\t'decode': decode,\n\t'encode': encode,\n\t'toASCII': toASCII,\n\t'toUnicode': toUnicode\n};\n\nexport { ucs2decode, ucs2encode, decode, encode, toASCII, toUnicode };\nexport default punycode;\n","// Main parser class\n\n'use strict';\n\n\nvar utils        = require('./common/utils');\nvar helpers      = require('./helpers');\nvar Renderer     = require('./renderer');\nvar ParserCore   = require('./parser_core');\nvar ParserBlock  = require('./parser_block');\nvar ParserInline = require('./parser_inline');\nvar LinkifyIt    = require('linkify-it');\nvar mdurl        = require('mdurl');\nvar punycode     = require('punycode');\n\n\nvar config = {\n  default: require('./presets/default'),\n  zero: require('./presets/zero'),\n  commonmark: require('./presets/commonmark')\n};\n\n////////////////////////////////////////////////////////////////////////////////\n//\n// This validator can prohibit more than really needed to prevent XSS. It's a\n// tradeoff to keep code simple and to be secure by default.\n//\n// If you need different setup - override validator method as you wish. Or\n// replace it with dummy function and use external sanitizer.\n//\n\nvar BAD_PROTO_RE = /^(vbscript|javascript|file|data):/;\nvar GOOD_DATA_RE = /^data:image\\/(gif|png|jpeg|webp);/;\n\nfunction validateLink(url) {\n  // url should be normalized at this point, and existing entities are decoded\n  var str = url.trim().toLowerCase();\n\n  return BAD_PROTO_RE.test(str) ? (GOOD_DATA_RE.test(str) ? true : false) : true;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n\nvar RECODE_HOSTNAME_FOR = [ 'http:', 'https:', 'mailto:' ];\n\nfunction normalizeLink(url) {\n  var parsed = mdurl.parse(url, true);\n\n  if (parsed.hostname) {\n    // Encode hostnames in urls like:\n    // `http://host/`, `https://host/`, `mailto:user@host`, `//host/`\n    //\n    // We don't encode unknown schemas, because it's likely that we encode\n    // something we shouldn't (e.g. `skype:name` treated as `skype:host`)\n    //\n    if (!parsed.protocol || RECODE_HOSTNAME_FOR.indexOf(parsed.protocol) >= 0) {\n      try {\n        parsed.hostname = punycode.toASCII(parsed.hostname);\n      } catch (er) { /**/ }\n    }\n  }\n\n  return mdurl.encode(mdurl.format(parsed));\n}\n\nfunction normalizeLinkText(url) {\n  var parsed = mdurl.parse(url, true);\n\n  if (parsed.hostname) {\n    // Encode hostnames in urls like:\n    // `http://host/`, `https://host/`, `mailto:user@host`, `//host/`\n    //\n    // We don't encode unknown schemas, because it's likely that we encode\n    // something we shouldn't (e.g. `skype:name` treated as `skype:host`)\n    //\n    if (!parsed.protocol || RECODE_HOSTNAME_FOR.indexOf(parsed.protocol) >= 0) {\n      try {\n        parsed.hostname = punycode.toUnicode(parsed.hostname);\n      } catch (er) { /**/ }\n    }\n  }\n\n  // add '%' to exclude list because of https://github.com/markdown-it/markdown-it/issues/720\n  return mdurl.decode(mdurl.format(parsed), mdurl.decode.defaultChars + '%');\n}\n\n\n/**\n * class MarkdownIt\n *\n * Main parser/renderer class.\n *\n * ##### Usage\n *\n * ```javascript\n * // node.js, \"classic\" way:\n * var MarkdownIt = require('markdown-it'),\n *     md = new MarkdownIt();\n * var result = md.render('# markdown-it rulezz!');\n *\n * // node.js, the same, but with sugar:\n * var md = require('markdown-it')();\n * var result = md.render('# markdown-it rulezz!');\n *\n * // browser without AMD, added to \"window\" on script load\n * // Note, there are no dash.\n * var md = window.markdownit();\n * var result = md.render('# markdown-it rulezz!');\n * ```\n *\n * Single line rendering, without paragraph wrap:\n *\n * ```javascript\n * var md = require('markdown-it')();\n * var result = md.renderInline('__markdown-it__ rulezz!');\n * ```\n **/\n\n/**\n * new MarkdownIt([presetName, options])\n * - presetName (String): optional, `commonmark` / `zero`\n * - options (Object)\n *\n * Creates parser instanse with given config. Can be called without `new`.\n *\n * ##### presetName\n *\n * MarkdownIt provides named presets as a convenience to quickly\n * enable/disable active syntax rules and options for common use cases.\n *\n * - [\"commonmark\"](https://github.com/markdown-it/markdown-it/blob/master/lib/presets/commonmark.js) -\n *   configures parser to strict [CommonMark](http://commonmark.org/) mode.\n * - [default](https://github.com/markdown-it/markdown-it/blob/master/lib/presets/default.js) -\n *   similar to GFM, used when no preset name given. Enables all available rules,\n *   but still without html, typographer & autolinker.\n * - [\"zero\"](https://github.com/markdown-it/markdown-it/blob/master/lib/presets/zero.js) -\n *   all rules disabled. Useful to quickly setup your config via `.enable()`.\n *   For example, when you need only `bold` and `italic` markup and nothing else.\n *\n * ##### options:\n *\n * - __html__ - `false`. Set `true` to enable HTML tags in source. Be careful!\n *   That's not safe! You may need external sanitizer to protect output from XSS.\n *   It's better to extend features via plugins, instead of enabling HTML.\n * - __xhtmlOut__ - `false`. Set `true` to add '/' when closing single tags\n *   (`<br />`). This is needed only for full CommonMark compatibility. In real\n *   world you will need HTML output.\n * - __breaks__ - `false`. Set `true` to convert `\\n` in paragraphs into `<br>`.\n * - __langPrefix__ - `language-`. CSS language class prefix for fenced blocks.\n *   Can be useful for external highlighters.\n * - __linkify__ - `false`. Set `true` to autoconvert URL-like text to links.\n * - __typographer__  - `false`. Set `true` to enable [some language-neutral\n *   replacement](https://github.com/markdown-it/markdown-it/blob/master/lib/rules_core/replacements.js) +\n *   quotes beautification (smartquotes).\n * - __quotes__ - `“”‘’`, String or Array. Double + single quotes replacement\n *   pairs, when typographer enabled and smartquotes on. For example, you can\n *   use `'«»„“'` for Russian, `'„“‚‘'` for German, and\n *   `['«\\xA0', '\\xA0»', '‹\\xA0', '\\xA0›']` for French (including nbsp).\n * - __highlight__ - `null`. Highlighter function for fenced code blocks.\n *   Highlighter `function (str, lang)` should return escaped HTML. It can also\n *   return empty string if the source was not changed and should be escaped\n *   externaly. If result starts with <pre... internal wrapper is skipped.\n *\n * ##### Example\n *\n * ```javascript\n * // commonmark mode\n * var md = require('markdown-it')('commonmark');\n *\n * // default mode\n * var md = require('markdown-it')();\n *\n * // enable everything\n * var md = require('markdown-it')({\n *   html: true,\n *   linkify: true,\n *   typographer: true\n * });\n * ```\n *\n * ##### Syntax highlighting\n *\n * ```js\n * var hljs = require('highlight.js') // https://highlightjs.org/\n *\n * var md = require('markdown-it')({\n *   highlight: function (str, lang) {\n *     if (lang && hljs.getLanguage(lang)) {\n *       try {\n *         return hljs.highlight(str, { language: lang, ignoreIllegals: true }).value;\n *       } catch (__) {}\n *     }\n *\n *     return ''; // use external default escaping\n *   }\n * });\n * ```\n *\n * Or with full wrapper override (if you need assign class to `<pre>`):\n *\n * ```javascript\n * var hljs = require('highlight.js') // https://highlightjs.org/\n *\n * // Actual default values\n * var md = require('markdown-it')({\n *   highlight: function (str, lang) {\n *     if (lang && hljs.getLanguage(lang)) {\n *       try {\n *         return '<pre class=\"hljs\"><code>' +\n *                hljs.highlight(str, { language: lang, ignoreIllegals: true }).value +\n *                '</code></pre>';\n *       } catch (__) {}\n *     }\n *\n *     return '<pre class=\"hljs\"><code>' + md.utils.escapeHtml(str) + '</code></pre>';\n *   }\n * });\n * ```\n *\n **/\nfunction MarkdownIt(presetName, options) {\n  if (!(this instanceof MarkdownIt)) {\n    return new MarkdownIt(presetName, options);\n  }\n\n  if (!options) {\n    if (!utils.isString(presetName)) {\n      options = presetName || {};\n      presetName = 'default';\n    }\n  }\n\n  /**\n   * MarkdownIt#inline -> ParserInline\n   *\n   * Instance of [[ParserInline]]. You may need it to add new rules when\n   * writing plugins. For simple rules control use [[MarkdownIt.disable]] and\n   * [[MarkdownIt.enable]].\n   **/\n  this.inline = new ParserInline();\n\n  /**\n   * MarkdownIt#block -> ParserBlock\n   *\n   * Instance of [[ParserBlock]]. You may need it to add new rules when\n   * writing plugins. For simple rules control use [[MarkdownIt.disable]] and\n   * [[MarkdownIt.enable]].\n   **/\n  this.block = new ParserBlock();\n\n  /**\n   * MarkdownIt#core -> Core\n   *\n   * Instance of [[Core]] chain executor. You may need it to add new rules when\n   * writing plugins. For simple rules control use [[MarkdownIt.disable]] and\n   * [[MarkdownIt.enable]].\n   **/\n  this.core = new ParserCore();\n\n  /**\n   * MarkdownIt#renderer -> Renderer\n   *\n   * Instance of [[Renderer]]. Use it to modify output look. Or to add rendering\n   * rules for new token types, generated by plugins.\n   *\n   * ##### Example\n   *\n   * ```javascript\n   * var md = require('markdown-it')();\n   *\n   * function myToken(tokens, idx, options, env, self) {\n   *   //...\n   *   return result;\n   * };\n   *\n   * md.renderer.rules['my_token'] = myToken\n   * ```\n   *\n   * See [[Renderer]] docs and [source code](https://github.com/markdown-it/markdown-it/blob/master/lib/renderer.js).\n   **/\n  this.renderer = new Renderer();\n\n  /**\n   * MarkdownIt#linkify -> LinkifyIt\n   *\n   * [linkify-it](https://github.com/markdown-it/linkify-it) instance.\n   * Used by [linkify](https://github.com/markdown-it/markdown-it/blob/master/lib/rules_core/linkify.js)\n   * rule.\n   **/\n  this.linkify = new LinkifyIt();\n\n  /**\n   * MarkdownIt#validateLink(url) -> Boolean\n   *\n   * Link validation function. CommonMark allows too much in links. By default\n   * we disable `javascript:`, `vbscript:`, `file:` schemas, and almost all `data:...` schemas\n   * except some embedded image types.\n   *\n   * You can change this behaviour:\n   *\n   * ```javascript\n   * var md = require('markdown-it')();\n   * // enable everything\n   * md.validateLink = function () { return true; }\n   * ```\n   **/\n  this.validateLink = validateLink;\n\n  /**\n   * MarkdownIt#normalizeLink(url) -> String\n   *\n   * Function used to encode link url to a machine-readable format,\n   * which includes url-encoding, punycode, etc.\n   **/\n  this.normalizeLink = normalizeLink;\n\n  /**\n   * MarkdownIt#normalizeLinkText(url) -> String\n   *\n   * Function used to decode link url to a human-readable format`\n   **/\n  this.normalizeLinkText = normalizeLinkText;\n\n\n  // Expose utils & helpers for easy acces from plugins\n\n  /**\n   * MarkdownIt#utils -> utils\n   *\n   * Assorted utility functions, useful to write plugins. See details\n   * [here](https://github.com/markdown-it/markdown-it/blob/master/lib/common/utils.js).\n   **/\n  this.utils = utils;\n\n  /**\n   * MarkdownIt#helpers -> helpers\n   *\n   * Link components parser functions, useful to write plugins. See details\n   * [here](https://github.com/markdown-it/markdown-it/blob/master/lib/helpers).\n   **/\n  this.helpers = utils.assign({}, helpers);\n\n\n  this.options = {};\n  this.configure(presetName);\n\n  if (options) { this.set(options); }\n}\n\n\n/** chainable\n * MarkdownIt.set(options)\n *\n * Set parser options (in the same format as in constructor). Probably, you\n * will never need it, but you can change options after constructor call.\n *\n * ##### Example\n *\n * ```javascript\n * var md = require('markdown-it')()\n *             .set({ html: true, breaks: true })\n *             .set({ typographer, true });\n * ```\n *\n * __Note:__ To achieve the best possible performance, don't modify a\n * `markdown-it` instance options on the fly. If you need multiple configurations\n * it's best to create multiple instances and initialize each with separate\n * config.\n **/\nMarkdownIt.prototype.set = function (options) {\n  utils.assign(this.options, options);\n  return this;\n};\n\n\n/** chainable, internal\n * MarkdownIt.configure(presets)\n *\n * Batch load of all options and compenent settings. This is internal method,\n * and you probably will not need it. But if you will - see available presets\n * and data structure [here](https://github.com/markdown-it/markdown-it/tree/master/lib/presets)\n *\n * We strongly recommend to use presets instead of direct config loads. That\n * will give better compatibility with next versions.\n **/\nMarkdownIt.prototype.configure = function (presets) {\n  var self = this, presetName;\n\n  if (utils.isString(presets)) {\n    presetName = presets;\n    presets = config[presetName];\n    if (!presets) { throw new Error('Wrong `markdown-it` preset \"' + presetName + '\", check name'); }\n  }\n\n  if (!presets) { throw new Error('Wrong `markdown-it` preset, can\\'t be empty'); }\n\n  if (presets.options) { self.set(presets.options); }\n\n  if (presets.components) {\n    Object.keys(presets.components).forEach(function (name) {\n      if (presets.components[name].rules) {\n        self[name].ruler.enableOnly(presets.components[name].rules);\n      }\n      if (presets.components[name].rules2) {\n        self[name].ruler2.enableOnly(presets.components[name].rules2);\n      }\n    });\n  }\n  return this;\n};\n\n\n/** chainable\n * MarkdownIt.enable(list, ignoreInvalid)\n * - list (String|Array): rule name or list of rule names to enable\n * - ignoreInvalid (Boolean): set `true` to ignore errors when rule not found.\n *\n * Enable list or rules. It will automatically find appropriate components,\n * containing rules with given names. If rule not found, and `ignoreInvalid`\n * not set - throws exception.\n *\n * ##### Example\n *\n * ```javascript\n * var md = require('markdown-it')()\n *             .enable(['sub', 'sup'])\n *             .disable('smartquotes');\n * ```\n **/\nMarkdownIt.prototype.enable = function (list, ignoreInvalid) {\n  var result = [];\n\n  if (!Array.isArray(list)) { list = [ list ]; }\n\n  [ 'core', 'block', 'inline' ].forEach(function (chain) {\n    result = result.concat(this[chain].ruler.enable(list, true));\n  }, this);\n\n  result = result.concat(this.inline.ruler2.enable(list, true));\n\n  var missed = list.filter(function (name) { return result.indexOf(name) < 0; });\n\n  if (missed.length && !ignoreInvalid) {\n    throw new Error('MarkdownIt. Failed to enable unknown rule(s): ' + missed);\n  }\n\n  return this;\n};\n\n\n/** chainable\n * MarkdownIt.disable(list, ignoreInvalid)\n * - list (String|Array): rule name or list of rule names to disable.\n * - ignoreInvalid (Boolean): set `true` to ignore errors when rule not found.\n *\n * The same as [[MarkdownIt.enable]], but turn specified rules off.\n **/\nMarkdownIt.prototype.disable = function (list, ignoreInvalid) {\n  var result = [];\n\n  if (!Array.isArray(list)) { list = [ list ]; }\n\n  [ 'core', 'block', 'inline' ].forEach(function (chain) {\n    result = result.concat(this[chain].ruler.disable(list, true));\n  }, this);\n\n  result = result.concat(this.inline.ruler2.disable(list, true));\n\n  var missed = list.filter(function (name) { return result.indexOf(name) < 0; });\n\n  if (missed.length && !ignoreInvalid) {\n    throw new Error('MarkdownIt. Failed to disable unknown rule(s): ' + missed);\n  }\n  return this;\n};\n\n\n/** chainable\n * MarkdownIt.use(plugin, params)\n *\n * Load specified plugin with given params into current parser instance.\n * It's just a sugar to call `plugin(md, params)` with curring.\n *\n * ##### Example\n *\n * ```javascript\n * var iterator = require('markdown-it-for-inline');\n * var md = require('markdown-it')()\n *             .use(iterator, 'foo_replace', 'text', function (tokens, idx) {\n *               tokens[idx].content = tokens[idx].content.replace(/foo/g, 'bar');\n *             });\n * ```\n **/\nMarkdownIt.prototype.use = function (plugin /*, params, ... */) {\n  var args = [ this ].concat(Array.prototype.slice.call(arguments, 1));\n  plugin.apply(plugin, args);\n  return this;\n};\n\n\n/** internal\n * MarkdownIt.parse(src, env) -> Array\n * - src (String): source string\n * - env (Object): environment sandbox\n *\n * Parse input string and return list of block tokens (special token type\n * \"inline\" will contain list of inline tokens). You should not call this\n * method directly, until you write custom renderer (for example, to produce\n * AST).\n *\n * `env` is used to pass data between \"distributed\" rules and return additional\n * metadata like reference info, needed for the renderer. It also can be used to\n * inject data in specific cases. Usually, you will be ok to pass `{}`,\n * and then pass updated object to renderer.\n **/\nMarkdownIt.prototype.parse = function (src, env) {\n  if (typeof src !== 'string') {\n    throw new Error('Input data should be a String');\n  }\n\n  var state = new this.core.State(src, this, env);\n\n  this.core.process(state);\n\n  return state.tokens;\n};\n\n\n/**\n * MarkdownIt.render(src [, env]) -> String\n * - src (String): source string\n * - env (Object): environment sandbox\n *\n * Render markdown string into html. It does all magic for you :).\n *\n * `env` can be used to inject additional metadata (`{}` by default).\n * But you will not need it with high probability. See also comment\n * in [[MarkdownIt.parse]].\n **/\nMarkdownIt.prototype.render = function (src, env) {\n  env = env || {};\n\n  return this.renderer.render(this.parse(src, env), this.options, env);\n};\n\n\n/** internal\n * MarkdownIt.parseInline(src, env) -> Array\n * - src (String): source string\n * - env (Object): environment sandbox\n *\n * The same as [[MarkdownIt.parse]] but skip all block rules. It returns the\n * block tokens list with the single `inline` element, containing parsed inline\n * tokens in `children` property. Also updates `env` object.\n **/\nMarkdownIt.prototype.parseInline = function (src, env) {\n  var state = new this.core.State(src, this, env);\n\n  state.inlineMode = true;\n  this.core.process(state);\n\n  return state.tokens;\n};\n\n\n/**\n * MarkdownIt.renderInline(src [, env]) -> String\n * - src (String): source string\n * - env (Object): environment sandbox\n *\n * Similar to [[MarkdownIt.render]] but for single paragraph content. Result\n * will NOT be wrapped into `<p>` tags.\n **/\nMarkdownIt.prototype.renderInline = function (src, env) {\n  env = env || {};\n\n  return this.renderer.render(this.parseInline(src, env), this.options, env);\n};\n\n\nmodule.exports = MarkdownIt;\n","// markdown-it default options\n\n'use strict';\n\n\nmodule.exports = {\n  options: {\n    html:         false,        // Enable HTML tags in source\n    xhtmlOut:     false,        // Use '/' to close single tags (<br />)\n    breaks:       false,        // Convert '\\n' in paragraphs into <br>\n    langPrefix:   'language-',  // CSS language prefix for fenced blocks\n    linkify:      false,        // autoconvert URL-like texts to links\n\n    // Enable some language-neutral replacements + quotes beautification\n    typographer:  false,\n\n    // Double + single quotes replacement pairs, when typographer enabled,\n    // and smartquotes on. Could be either a String or an Array.\n    //\n    // For example, you can use '«»„“' for Russian, '„“‚‘' for German,\n    // and ['«\\xA0', '\\xA0»', '‹\\xA0', '\\xA0›'] for French (including nbsp).\n    quotes: '\\u201c\\u201d\\u2018\\u2019', /* “”‘’ */\n\n    // Highlighter function. Should return escaped HTML,\n    // or '' if the source string is not changed and should be escaped externaly.\n    // If result starts with <pre... internal wrapper is skipped.\n    //\n    // function (/*str, lang*/) { return ''; }\n    //\n    highlight: null,\n\n    maxNesting:   100            // Internal protection, recursion limit\n  },\n\n  components: {\n\n    core: {},\n    block: {},\n    inline: {}\n  }\n};\n","// \"Zero\" preset, with nothing enabled. Useful for manual configuring of simple\n// modes. For example, to parse bold/italic only.\n\n'use strict';\n\n\nmodule.exports = {\n  options: {\n    html:         false,        // Enable HTML tags in source\n    xhtmlOut:     false,        // Use '/' to close single tags (<br />)\n    breaks:       false,        // Convert '\\n' in paragraphs into <br>\n    langPrefix:   'language-',  // CSS language prefix for fenced blocks\n    linkify:      false,        // autoconvert URL-like texts to links\n\n    // Enable some language-neutral replacements + quotes beautification\n    typographer:  false,\n\n    // Double + single quotes replacement pairs, when typographer enabled,\n    // and smartquotes on. Could be either a String or an Array.\n    //\n    // For example, you can use '«»„“' for Russian, '„“‚‘' for German,\n    // and ['«\\xA0', '\\xA0»', '‹\\xA0', '\\xA0›'] for French (including nbsp).\n    quotes: '\\u201c\\u201d\\u2018\\u2019', /* “”‘’ */\n\n    // Highlighter function. Should return escaped HTML,\n    // or '' if the source string is not changed and should be escaped externaly.\n    // If result starts with <pre... internal wrapper is skipped.\n    //\n    // function (/*str, lang*/) { return ''; }\n    //\n    highlight: null,\n\n    maxNesting:   20            // Internal protection, recursion limit\n  },\n\n  components: {\n\n    core: {\n      rules: [\n        'normalize',\n        'block',\n        'inline',\n        'text_join'\n      ]\n    },\n\n    block: {\n      rules: [\n        'paragraph'\n      ]\n    },\n\n    inline: {\n      rules: [\n        'text'\n      ],\n      rules2: [\n        'balance_pairs',\n        'fragments_join'\n      ]\n    }\n  }\n};\n","// Commonmark default options\n\n'use strict';\n\n\nmodule.exports = {\n  options: {\n    html:         true,         // Enable HTML tags in source\n    xhtmlOut:     true,         // Use '/' to close single tags (<br />)\n    breaks:       false,        // Convert '\\n' in paragraphs into <br>\n    langPrefix:   'language-',  // CSS language prefix for fenced blocks\n    linkify:      false,        // autoconvert URL-like texts to links\n\n    // Enable some language-neutral replacements + quotes beautification\n    typographer:  false,\n\n    // Double + single quotes replacement pairs, when typographer enabled,\n    // and smartquotes on. Could be either a String or an Array.\n    //\n    // For example, you can use '«»„“' for Russian, '„“‚‘' for German,\n    // and ['«\\xA0', '\\xA0»', '‹\\xA0', '\\xA0›'] for French (including nbsp).\n    quotes: '\\u201c\\u201d\\u2018\\u2019', /* “”‘’ */\n\n    // Highlighter function. Should return escaped HTML,\n    // or '' if the source string is not changed and should be escaped externaly.\n    // If result starts with <pre... internal wrapper is skipped.\n    //\n    // function (/*str, lang*/) { return ''; }\n    //\n    highlight: null,\n\n    maxNesting:   20            // Internal protection, recursion limit\n  },\n\n  components: {\n\n    core: {\n      rules: [\n        'normalize',\n        'block',\n        'inline',\n        'text_join'\n      ]\n    },\n\n    block: {\n      rules: [\n        'blockquote',\n        'code',\n        'fence',\n        'heading',\n        'hr',\n        'html_block',\n        'lheading',\n        'list',\n        'reference',\n        'paragraph'\n      ]\n    },\n\n    inline: {\n      rules: [\n        'autolink',\n        'backticks',\n        'emphasis',\n        'entity',\n        'escape',\n        'html_inline',\n        'image',\n        'link',\n        'newline',\n        'text'\n      ],\n      rules2: [\n        'balance_pairs',\n        'emphasis',\n        'fragments_join'\n      ]\n    }\n  }\n};\n","'use strict';\n\n\nmodule.exports = require('./lib/');\n","import MarkdownIt from \"markdown-it\";\nimport { SemanticVersion } from \"../utils/semver.mjs\";\n\nexport class ChangeLogWindow extends FormApplication {\n  constructor(lastVersion) {\n    super({}, {});\n\n    this.lastVersion = lastVersion;\n  }\n\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    return mergeObject(options, {\n      id: \"changelog\",\n      classes: [\"ffd20\", \"changelog\"],\n      template: \"systems/ffd20/templates/apps/changelog.hbs\",\n      width: 500,\n      submitOnChange: true,\n      closeOnSubmit: false,\n    });\n  }\n\n  get title() {\n    return `${game.i18n.localize(\"FFD20.title\")} ~ ${game.i18n.localize(\"FFD20.Changelog\")}`;\n  }\n\n  async getData() {\n    const data = await super.getData();\n\n    data.dontShowAgain = game.settings.get(\"ffd20\", \"dontShowChangelog\");\n\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"GET\", \"systems/ffd20/CHANGELOG.md\");\n\n    const promise = new Promise((resolve) => {\n      xhr.onload = () => {\n        if (xhr.status === 200) {\n          data.changelog = this._processChangelog(xhr.response);\n          resolve(data);\n        }\n      };\n    });\n    xhr.send(null);\n\n    return promise;\n  }\n\n  _processChangelog(md) {\n    const MD = new MarkdownIt();\n\n    // Cut off irrelevant changelog entries\n    let lines = md.split(/[\\n\\r]/);\n    if (this.lastVersion) {\n      for (let a = 0; a < lines.length; a++) {\n        const line = lines[a];\n        if (line.match(/##\\s+([0-9]+\\.[0-9]+\\.[0-9]+)/)) {\n          const version = SemanticVersion.fromString(RegExp.$1);\n          if (!version.isHigherThan(this.lastVersion)) {\n            lines = lines.slice(0, a);\n            break;\n          }\n        }\n      }\n    }\n\n    return MD.render(lines.join(\"\\n\"));\n  }\n\n  async _updateObject(event, formData) {\n    if (formData.dontShowAgain != null) {\n      await game.settings.set(\"ffd20\", \"dontShowChangelog\", formData.dontShowAgain);\n    }\n  }\n}\n","var e=!1,n={false:\"push\",true:\"unshift\",after:\"push\",before:\"unshift\"},t={isPermalinkSymbol:!0};function r(r,a,i,l){var o;if(!e){var c=\"Using deprecated markdown-it-anchor permalink option, see https://github.com/valeriangalliat/markdown-it-anchor#todo-anchor-or-file\";\"object\"==typeof process&&process&&process.emitWarning?process.emitWarning(c):console.warn(c),e=!0}var s=[Object.assign(new i.Token(\"link_open\",\"a\",1),{attrs:[].concat(a.permalinkClass?[[\"class\",a.permalinkClass]]:[],[[\"href\",a.permalinkHref(r,i)]],Object.entries(a.permalinkAttrs(r,i)))}),Object.assign(new i.Token(\"html_block\",\"\",0),{content:a.permalinkSymbol,meta:t}),new i.Token(\"link_close\",\"a\",-1)];a.permalinkSpace&&i.tokens[l+1].children[n[a.permalinkBefore]](Object.assign(new i.Token(\"text\",\"\",0),{content:\" \"})),(o=i.tokens[l+1].children)[n[a.permalinkBefore]].apply(o,s)}function a(e){return\"#\"+e}function i(e){return{}}var l={class:\"header-anchor\",symbol:\"#\",renderHref:a,renderAttrs:i};function o(e){function n(t){return t=Object.assign({},n.defaults,t),function(n,r,a,i){return e(n,t,r,a,i)}}return n.defaults=Object.assign({},l),n.renderPermalinkImpl=e,n}var c=o(function(e,r,a,i,l){var o,c=[Object.assign(new i.Token(\"link_open\",\"a\",1),{attrs:[].concat(r.class?[[\"class\",r.class]]:[],[[\"href\",r.renderHref(e,i)]],r.ariaHidden?[[\"aria-hidden\",\"true\"]]:[],Object.entries(r.renderAttrs(e,i)))}),Object.assign(new i.Token(\"html_inline\",\"\",0),{content:r.symbol,meta:t}),new i.Token(\"link_close\",\"a\",-1)];if(r.space){var s=\"string\"==typeof r.space?r.space:\" \";i.tokens[l+1].children[n[r.placement]](Object.assign(new i.Token(\"string\"==typeof r.space?\"html_inline\":\"text\",\"\",0),{content:s}))}(o=i.tokens[l+1].children)[n[r.placement]].apply(o,c)});Object.assign(c.defaults,{space:!0,placement:\"after\",ariaHidden:!1});var s=o(c.renderPermalinkImpl);s.defaults=Object.assign({},c.defaults,{ariaHidden:!0});var u=o(function(e,n,t,r,a){var i=[Object.assign(new r.Token(\"link_open\",\"a\",1),{attrs:[].concat(n.class?[[\"class\",n.class]]:[],[[\"href\",n.renderHref(e,r)]],Object.entries(n.renderAttrs(e,r)))})].concat(n.safariReaderFix?[new r.Token(\"span_open\",\"span\",1)]:[],r.tokens[a+1].children,n.safariReaderFix?[new r.Token(\"span_close\",\"span\",-1)]:[],[new r.Token(\"link_close\",\"a\",-1)]);r.tokens[a+1]=Object.assign(new r.Token(\"inline\",\"\",0),{children:i})});Object.assign(u.defaults,{safariReaderFix:!1});var d=o(function(e,r,a,i,l){var o;if(![\"visually-hidden\",\"aria-label\",\"aria-describedby\",\"aria-labelledby\"].includes(r.style))throw new Error(\"`permalink.linkAfterHeader` called with unknown style option `\"+r.style+\"`\");if(![\"aria-describedby\",\"aria-labelledby\"].includes(r.style)&&!r.assistiveText)throw new Error(\"`permalink.linkAfterHeader` called without the `assistiveText` option in `\"+r.style+\"` style\");if(\"visually-hidden\"===r.style&&!r.visuallyHiddenClass)throw new Error(\"`permalink.linkAfterHeader` called without the `visuallyHiddenClass` option in `visually-hidden` style\");var c=i.tokens[l+1].children.filter(function(e){return\"text\"===e.type||\"code_inline\"===e.type}).reduce(function(e,n){return e+n.content},\"\"),s=[],u=[];if(r.class&&u.push([\"class\",r.class]),u.push([\"href\",r.renderHref(e,i)]),u.push.apply(u,Object.entries(r.renderAttrs(e,i))),\"visually-hidden\"===r.style){if(s.push(Object.assign(new i.Token(\"span_open\",\"span\",1),{attrs:[[\"class\",r.visuallyHiddenClass]]}),Object.assign(new i.Token(\"text\",\"\",0),{content:r.assistiveText(c)}),new i.Token(\"span_close\",\"span\",-1)),r.space){var d=\"string\"==typeof r.space?r.space:\" \";s[n[r.placement]](Object.assign(new i.Token(\"string\"==typeof r.space?\"html_inline\":\"text\",\"\",0),{content:d}))}s[n[r.placement]](Object.assign(new i.Token(\"span_open\",\"span\",1),{attrs:[[\"aria-hidden\",\"true\"]]}),Object.assign(new i.Token(\"html_inline\",\"\",0),{content:r.symbol,meta:t}),new i.Token(\"span_close\",\"span\",-1))}else s.push(Object.assign(new i.Token(\"html_inline\",\"\",0),{content:r.symbol,meta:t}));\"aria-label\"===r.style?u.push([\"aria-label\",r.assistiveText(c)]):[\"aria-describedby\",\"aria-labelledby\"].includes(r.style)&&u.push([r.style,e]);var f=[Object.assign(new i.Token(\"link_open\",\"a\",1),{attrs:u})].concat(s,[new i.Token(\"link_close\",\"a\",-1)]);(o=i.tokens).splice.apply(o,[l+3,0].concat(f)),r.wrapper&&(i.tokens.splice(l,0,Object.assign(new i.Token(\"html_block\",\"\",0),{content:r.wrapper[0]+\"\\n\"})),i.tokens.splice(l+3+f.length+1,0,Object.assign(new i.Token(\"html_block\",\"\",0),{content:r.wrapper[1]+\"\\n\"})))});function f(e,n,t,r){var a=e,i=r;if(t&&Object.prototype.hasOwnProperty.call(n,a))throw new Error(\"User defined `id` attribute `\"+e+\"` is not unique. Please fix it in your Markdown to continue.\");for(;Object.prototype.hasOwnProperty.call(n,a);)a=e+\"-\"+i,i+=1;return n[a]=!0,a}function b(e,n){n=Object.assign({},b.defaults,n),e.core.ruler.push(\"anchor\",function(e){for(var t,a={},i=e.tokens,l=Array.isArray(n.level)?(t=n.level,function(e){return t.includes(e)}):function(e){return function(n){return n>=e}}(n.level),o=0;o<i.length;o++){var c=i[o];if(\"heading_open\"===c.type&&l(Number(c.tag.substr(1)))){var s=n.getTokensText(i[o+1].children),u=c.attrGet(\"id\");u=null==u?f(n.slugify(s),a,!1,n.uniqueSlugStartIndex):f(u,a,!0,n.uniqueSlugStartIndex),c.attrSet(\"id\",u),!1!==n.tabIndex&&c.attrSet(\"tabindex\",\"\"+n.tabIndex),\"function\"==typeof n.permalink?n.permalink(u,n,e,o):(n.permalink||n.renderPermalink&&n.renderPermalink!==r)&&n.renderPermalink(u,n,e,o),o=i.indexOf(c),n.callback&&n.callback(c,{slug:u,title:s})}}})}Object.assign(d.defaults,{style:\"visually-hidden\",space:!0,placement:\"after\",wrapper:null}),b.permalink={__proto__:null,legacy:r,renderHref:a,renderAttrs:i,makePermalink:o,linkInsideHeader:c,ariaHidden:s,headerLink:u,linkAfterHeader:d},b.defaults={level:1,slugify:function(e){return encodeURIComponent(String(e).trim().toLowerCase().replace(/\\s+/g,\"-\"))},uniqueSlugStartIndex:1,tabIndex:\"-1\",getTokensText:function(e){return e.filter(function(e){return[\"text\",\"code_inline\"].includes(e.type)}).map(function(e){return e.content}).join(\"\")},permalink:!1,renderPermalink:r,permalinkClass:s.defaults.class,permalinkSpace:s.defaults.space,permalinkSymbol:\"¶\",permalinkBefore:\"before\"===s.defaults.placement,permalinkHref:s.defaults.renderHref,permalinkAttrs:s.defaults.renderAttrs},b.default=b;export default b;\n//# sourceMappingURL=markdownItAnchor.mjs.map\n","import MarkdownIt from \"markdown-it\";\nimport MarkDownItAnchor from \"markdown-it-anchor\";\n\n/**\n * An {@link Application} displaying documentation for the Pathfinder 1e system within Foundry.\n *\n * @augments Application\n */\nexport class HelpBrowserFFD20 extends Application {\n  /**\n   * @type {HistoryEntry[]}\n   * @private\n   */\n  _backwardHistory = [];\n  /**\n   * @type {HistoryEntry[]}\n   * @private\n   */\n  _forwardHistory = [];\n  /**\n   * The currently shown entry.\n   *\n   * @type {HistoryEntry}\n   * @private\n   */\n  _currentPage = { url: \"\" };\n\n  /**\n   * The Markdown parser instance for this application.\n   *\n   * @type {MarkdownIt}\n   * @private\n   */\n  _md;\n\n  /** @inheritdoc */\n  constructor(...args) {\n    super(...args);\n    this._initMarkdown();\n    return this;\n  }\n\n  /** @inheritdoc */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"ffd20\", \"help-browser\"],\n      template: \"systems/ffd20/templates/apps/help-browser.hbs\",\n      minWidth: 800,\n      minHeight: 450,\n      width: 960,\n      height: 600,\n      resizable: true,\n      id: \"ffd20-help-browser\",\n    });\n  }\n\n  /** @inheritdoc */\n  get title() {\n    return game.i18n.localize(\"FFD20.Help.Label\");\n  }\n\n  /**\n   * The URL of the page currently displayed\n   *\n   * @type {string}\n   */\n  get currentUrl() {\n    return this._currentPage.url;\n  }\n\n  /**\n   * Initializes this help browser's {@link MarkdownIt} instance, adjusting rules as necessary.\n   *\n   * @private\n   */\n  _initMarkdown() {\n    const md = new MarkdownIt().use(MarkDownItAnchor, {\n      tabIndex: false,\n      slugify: (url) => `ffd20-help-browser.${url.slugify()}`,\n    });\n    const defaultImageRenderRule = md.renderer.rules.image;\n    md.renderer.rules.image = ffd20HelpImageRenderer(defaultImageRenderRule);\n    this._md = md;\n  }\n\n  /** @override */\n  async getData() {\n    const data = await super.getData();\n\n    // Nav element only needs to get rendered once\n    this.nav ??= this._md.render(game.i18n.localize(\"FFD20.Help/Home\"));\n\n    data.hasHistoryBack = this._backwardHistory.length > 0;\n    data.hasHistoryForward = this._forwardHistory.length > 0;\n    data.nav = this.nav;\n\n    // Get markdown string from localisation, and parse it\n    data.pageContent = this._md.render(game.i18n.localize(`FFD20.${this.currentUrl}`));\n\n    return data;\n  }\n\n  /**\n   * Opens a specific page in the help browser.\n   *\n   * @param {string} url - The help URL to open\n   */\n  openUrl(url) {\n    // Remove leading `/`, which are okay in the wiki, but not present in localisation files\n    if (url.startsWith(\"/\")) url = url.slice(1);\n    let header;\n    // Extract header from URL\n    [url, header] = url.split(\"#\");\n    if (this.currentUrl && url !== this.currentUrl) {\n      // Add new page to history\n      this._backwardHistory.push(this.getCurrentHistoryObject());\n      this._forwardHistory.splice(0, this._forwardHistory.length);\n    }\n    this._currentPage = { url };\n    this.render(true, { header: header });\n  }\n\n  /** @inheritdoc */\n  async _render(force, options) {\n    await super._render(options);\n    const contentElement = this.element.find(\".content\")[0];\n\n    if (this._currentPage.scrollTop) {\n      // Dirty timeout to wait for loading of images with unknown height\n      setTimeout(() => {\n        contentElement.scrollTop = this._currentPage.scrollTop;\n      }, 0);\n    } else if (options.header) {\n      const headerElement = document.getElementById(`ffd20-help-browser.${options.header}`);\n      if (headerElement) {\n        setTimeout(() => {\n          const emHeight = Number.parseFloat(getComputedStyle(headerElement).fontSize);\n          contentElement.scrollTop = headerElement.offsetTop - (45 + 1.5 * emHeight);\n        }, 0);\n      }\n    }\n  }\n\n  /**\n   * Returns a {@link HistoryEntry} containing a snapshot of the currently rendered state.\n   *\n   * @returns {HistoryEntry} The current state\n   */\n  getCurrentHistoryObject() {\n    const elem = this.element.find(\".content\")[0];\n    const scrollTop = elem?.scrollTop ?? 0;\n    return {\n      url: this.currentUrl,\n      scrollTop: scrollTop,\n    };\n  }\n\n  /** Go back one page in history. */\n  backInHistory() {\n    if (!this._backwardHistory.length) return;\n    this._forwardHistory.push(this.getCurrentHistoryObject());\n    this._currentPage = this._backwardHistory.pop();\n    this.render();\n  }\n\n  /** Go forward one page in history. */\n  forwardInHistory() {\n    if (!this._forwardHistory.length) return;\n    this._backwardHistory.push(this.getCurrentHistoryObject());\n    this._currentPage = this._forwardHistory.pop();\n    this.render();\n  }\n\n  /** @param {JQuery<HTMLElement>} html - This application's HTML element */\n  activateListeners(html) {\n    // Remove href attributes to avoid actual browser page changes\n    const links = html.find(\"a[href]\");\n    for (const l of links) {\n      const href = l.getAttribute(\"href\");\n      l.removeAttribute(\"href\");\n      // Store target in dataset\n      l.dataset.url = href;\n    }\n    html.on(\"click\", \"a\", (event) => {\n      event.preventDefault();\n      const url = event.currentTarget.dataset.url;\n      if (url) this.openUrl(url);\n    });\n\n    // History buttons\n    html.find(\".history-back\").on(\"click\", this.backInHistory.bind(this));\n    html.find(\".history-forward\").on(\"click\", this.forwardInHistory.bind(this));\n  }\n}\n\n/** @type {(defaultRenderer: Renderer.RenderRule) => Renderer.RenderRule} */\nconst ffd20HelpImageRenderer = (defaultRenderer) => (tokens, idx, options, env, self) => {\n  const token = tokens[idx];\n  let src = token.attrGet(\"src\");\n  if (src.startsWith(\"/\")) src = src.slice(1);\n  const foundrySrc = game.i18n.localize(`FFD20.${src}`);\n  token.attrSet(\"src\", foundry.utils.getRoute(`systems/ffd20/${foundrySrc}`));\n  return defaultRenderer(tokens, idx, options, env, self);\n};\n\nexport const helpBrowser = new HelpBrowserFFD20();\n\n/**\n * @typedef {object} HistoryEntry\n * @property {string} url - URL of this history entry\n * @property {number} [scrollTop] - Scroll position of this history entry\n */\n","import { ItemFFD20 } from \"./documents/item/item-ffd20.mjs\";\nimport { ExperienceConfig } from \"./applications/settings/experience.mjs\";\nimport { createTag } from \"./utils/lib.mjs\";\nimport { ItemChange } from \"./components/change.mjs\";\nimport { SemanticVersion } from \"./utils/semver.mjs\";\nimport { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\n/**\n * An indicator for whether the system is currently migrating the world.\n *\n * @type {boolean}\n */\n// As the `ffd20` global does not use this ES module but a cloned copy, this value\n// only exists for the documentation. Always use `ffd20.migrations.isMigrating` instead!\nexport let isMigrating = false; // eslint-disable-line prefer-const -- ffd20.migrations.isMigrating is changed at runtime\n\n/**\n * Perform a system migration for the entire World, applying migrations for Actors, Items, and Compendium packs\n *\n * @returns {Promise}      A Promise which resolves once the migration is completed\n */\nexport const migrateWorld = async function () {\n  if (!game.user.isGM) {\n    const msg = game.i18n.localize(\"FFD20.ErrorUnauthorizedAction\");\n    console.error(msg);\n    return ui.notifications.error(msg);\n  }\n\n  if (ffd20.migrations.isMigrating) {\n    const msg = game.i18n.localize(\"FFD20.Migration.AlreadyInProgress\");\n    return ui.notifications.error(msg);\n  } else {\n    ffd20.migrations.isMigrating = true;\n    Hooks.callAll(\"ffd20MigrationStarted\");\n  }\n\n  const startMessage = game.i18n.format(\"FFD20.Migration.Start\", { version: game.system.version });\n  ui.notifications.info(startMessage, {\n    permanent: true,\n  });\n  console.log(\"System Migration starting.\");\n  // Overloaded. Can be jQuery notification or queue object\n  const removeNotification = function (li) {\n    if (li.fadeOut) {\n      li.fadeOut(66, () => li.remove());\n      ui.notifications.active = ui.notifications.active.filter((o) => o != li);\n      ui.notifications.fetch();\n    } else ui.notifications.queue = ui.notifications.queue.filter((o) => o != li);\n  };\n\n  await _migrateWorldSettings();\n\n  // Migrate World Actors\n  console.log(\"Migrating Actor documents\");\n  for (const a of game.actors.contents) {\n    try {\n      const updateData = migrateActorData(a.toObject());\n      if (!foundry.utils.isEmpty(updateData)) {\n        console.log(`Migrating Actor document ${a.name}`);\n        await a.update(updateData, { enforceTypes: false });\n      }\n    } catch (err) {\n      console.error(`Error migrating actor document ${a.name}`, err);\n    }\n  }\n\n  // Migrate World Items\n  console.log(\"Migrating Item documents.\");\n  for (const i of game.items.contents) {\n    try {\n      const updateData = migrateItemData(i.toObject());\n      if (!foundry.utils.isEmpty(updateData)) {\n        console.log(`Migrating Item document ${i.name}`);\n        await i.update(updateData, { enforceTypes: false });\n      }\n    } catch (err) {\n      console.error(`Error migrating item document ${i.name}`, err);\n    }\n  }\n\n  // Migrate Actor Override Tokens\n  console.log(\"Migrating Scene documents.\");\n  for (const s of game.scenes.contents) {\n    try {\n      const updateData = await migrateSceneData(s.toObject());\n      if (!foundry.utils.isEmpty(updateData)) {\n        console.log(`Migrating Scene document ${s.name}`);\n        await s.update(updateData, { enforceTypes: false });\n        // If we do not do this, then synthetic token actors remain in cache\n        // with the un-updated actorData.\n        s.tokens.contents.forEach((t) => {\n          t._actor = null;\n        });\n      }\n    } catch (err) {\n      console.error(`Error migrating scene document ${s.name}`, err);\n    }\n  }\n\n  // Migrate World Compendium Packs\n  const packs = game.packs.filter((p) => {\n    return (\n      ([\"world\", \"ffd20\"].includes(p.metadata.package) || p.metadata.system === \"ffd20\") &&\n      [\"Actor\", \"Item\", \"Scene\"].includes(p.metadata.type) &&\n      !p.locked\n    );\n  });\n  for (const p of packs) {\n    await migrateCompendium(p);\n  }\n\n  // Set the migration as complete\n  await game.settings.set(\"ffd20\", \"systemMigrationVersion\", game.system.version);\n  const infoElem =\n    ui.notifications.queue.find((o) => o.permanent && o.message == startMessage) ||\n    ui.notifications.active.find((o) => o.hasClass(\"permanent\") && o[0].innerText === startMessage);\n  if (infoElem) removeNotification(infoElem);\n  // Remove migration notification\n  ui.notifications.info(game.i18n.format(\"FFD20.Migration.End\", { version: game.system.version }));\n  console.log(\"System Migration completed.\");\n  ffd20.migrations.isMigrating = false;\n  callOldNamespaceHookAll(\"ffd20.migrationFinished\", \"ffd20MigrationFinished\");\n  Hooks.callAll(\"ffd20MigrationFinished\");\n};\n\n/* -------------------------------------------- */\n\n/**\n * Apply migration rules to all Documents within a single Compendium pack\n *\n * @param pack\n * @returns {Promise}\n */\nexport const migrateCompendium = async function (pack) {\n  const doc = pack.metadata.type;\n  if (![\"Actor\", \"Item\", \"Scene\"].includes(doc)) return;\n\n  // Begin by requesting server-side data model migration and get the migrated content\n  await pack.migrate();\n  const content = await pack.getDocuments();\n\n  // Iterate over compendium entries - applying fine-tuned migration functions\n  console.log(`Migrating ${doc} documents in Compendium ${pack.collection}`);\n  const updates = [];\n  for (const ent of content) {\n    try {\n      let updateData = null;\n      if (doc === \"Item\") updateData = migrateItemData(ent.toObject());\n      else if (doc === \"Actor\") updateData = migrateActorData(ent.toObject());\n      else if (doc === \"Scene\") updateData = await migrateSceneData(ent.toObject());\n      expandObject(updateData);\n      updateData[\"_id\"] = ent.id;\n      updates.push(updateData);\n    } catch (err) {\n      console.error(`Error migrating ${doc} document ${ent.name} in Compendium ${pack.collection}`, err);\n    }\n  }\n  try {\n    if (doc === \"Item\") await Item.updateDocuments(updates, { pack: pack.collection });\n    else if (doc === \"Actor\") await Actor.updateDocuments(updates, { pack: pack.collection });\n    else if (doc === \"Scene\") await Scene.updateDocuments(updates, { pack: pack.collection });\n  } catch (err) {\n    console.error(`Error migrating Compendium ${pack.collection}`, err);\n  }\n  console.log(`Migrated all ${doc} documents from Compendium ${pack.collection}`);\n};\n\n/**\n * Migrates world settings.\n */\nconst _migrateWorldSettings = async function () {\n  const oldXPTrack = game.settings.get(\"ffd20\", \"experienceRate\");\n  if (oldXPTrack !== \"\" && oldXPTrack != null) {\n    // Set new config style\n    const config = game.settings.get(\"ffd20\", \"experienceConfig\") || ExperienceConfig.defaultSettings;\n    config.track = oldXPTrack;\n    await game.settings.set(\"ffd20\", \"experienceConfig\", config);\n    // HACK: Remove old config style for real\n    if (game.settings.settings.get(\"ffd20\", \"experienceRate\") !== undefined)\n      game.settings.settings.delete(\"ffd20.experienceRate\");\n  }\n};\n\n/* -------------------------------------------- */\n/*  Document Type Migration Helpers               */\n/* -------------------------------------------- */\n\n/**\n * Migrate a single Actor document to incorporate latest data model changes\n * Return an Object of updateData to be applied\n *\n * @param {ActorData} actor   The actor data to derive an update from\n * @param {Token} token\n * @returns {object}          The updateData to apply\n */\nexport const migrateActorData = function (actor, token) {\n  // Ignore basic actor type\n  if (actor.type === \"basic\") return {};\n\n  const updateData = {};\n  const linked = token?.isLinked ?? true;\n  _migrateCharacterLevel(actor, updateData, linked);\n  _migrateActorEncumbrance(actor, updateData, linked);\n  _migrateActorNoteArrays(actor, updateData);\n  _migrateActorSpeed(actor, updateData, linked);\n  _migrateSpellDivineFocus(actor, updateData);\n  _migrateActorConcentration(actor, updateData);\n  _migrateActorSpellbookCL(actor, updateData);\n  _migrateActorSpellbookSlots(actor, updateData, linked);\n  _migrateActorConcentration(actor, updateData);\n  _migrateActorBaseStats(actor, updateData);\n  _migrateUnusedActorCreatureType(actor, updateData);\n  _migrateActorSpellbookDCFormula(actor, updateData, linked);\n  _migrateActorHPAbility(actor, updateData);\n  _migrateActorCR(actor, updateData, linked);\n  _migrateAttackAbility(actor, updateData, linked);\n  _migrateActorDefenseAbility(actor, updateData);\n  _migrateActorTokenVision(actor, updateData);\n  _migrateActorSpellbookUsage(actor, updateData, linked);\n  _migrateActorNullValues(actor, updateData);\n  _migrateActorSpellbookDomainSlots(actor, updateData);\n  _migrateActorStatures(actor, updateData, linked);\n  _migrateActorInitAbility(actor, updateData, linked);\n  _migrateActorChangeRevamp(actor, updateData, linked);\n  _migrateActorCMBRevamp(actor, updateData, linked);\n  _migrateActorConditions(actor, updateData, linked);\n  _migrateActorSkillRanks(actor, updateData, linked);\n  _migrateCarryBonus(actor, updateData, linked);\n  _migrateBuggedValues(actor, updateData, linked);\n  _migrateSpellbookUsage(actor, updateData, linked);\n  _migrateActorHP(actor, updateData, linked);\n  _migrateActorSenses(actor, updateData, linked, token);\n  _migrateActorSkillJournals(actor, updateData, linked);\n\n  // Migrate Owned Items\n  if (!actor.items) return updateData;\n  const items = actor.items.reduce((arr, i) => {\n    // Migrate the Owned Item\n    const itemData = i instanceof CONFIG.Item.documentClass ? i.toObject() : i;\n    const itemUpdate = migrateItemData(itemData, actor);\n\n    // Update the Owned Item\n    if (!foundry.utils.isEmpty(itemUpdate)) {\n      itemUpdate._id = itemData._id;\n      arr.push(expandObject(itemUpdate));\n    }\n\n    return arr;\n  }, []);\n  if (items.length > 0) updateData.items = items;\n  return updateData;\n};\n\n/* -------------------------------------------- */\n\n/**\n * Migrate a single Item document to incorporate latest data model changes\n *\n * @param {object} item    The item data to derive an update from\n * @param actor\n * @param _d\n * @returns {object}       The updateData to apply\n */\nexport const migrateItemData = function (item, actor = null, _d = 0) {\n  const updateData = {};\n\n  // Migrate data to system\n  if (item.system == null && item.data != null) {\n    item = deepClone(item);\n    item.system = item.data;\n    delete item.data;\n  }\n\n  _migrateItemArrayTypes(item, updateData);\n  _migrateItemSpellUses(item, updateData);\n  _migrateFlagsArrayToObject(item, updateData);\n  _migrateWeaponImprovised(item, updateData);\n  _migrateSpellDescription(item, updateData);\n  _migrateClassDynamics(item, updateData);\n  _migrateClassType(item, updateData);\n  _migrateWeaponCategories(item, updateData);\n  _migrateEquipmentCategories(item, updateData);\n  _migrateItemSize(item, updateData);\n  _migrateAbilityTypes(item, updateData);\n  _migrateClassLevels(item, updateData);\n  _migrateSavingThrowTypes(item, updateData);\n  _migrateCR(item, updateData);\n  _migrateItemChanges(item, updateData);\n  _migrateTemplateSize(item, updateData);\n  _migrateEquipmentSize(item, updateData);\n  _migrateTags(item, updateData);\n  _migrateSpellCosts(item, updateData);\n  _migrateLootEquip(item, updateData);\n  _migrateUnchainedActionEconomy(item, updateData);\n  _migrateItemRange(item, updateData);\n  _migrateWeaponData(item, updateData);\n  _migrateItemLinks(item, updateData);\n  _migrateClassAssociations(item, updateData);\n  _migrateProficiencies(item, updateData);\n  _migrateItemNotes(item, updateData);\n  _migrateSpellData(item, updateData);\n  _migrateItemActions(item, updateData, actor);\n  _migrateItemWeight(item, updateData);\n\n  // Migrate action data\n  const alreadyHasActions = item.system.actions instanceof Array && item.system.actions.length > 0;\n  const itemActionData = alreadyHasActions ? item.system.actions : updateData[\"system.actions\"];\n  // The following check is necessary to filter out items with no possible actions\n  if (itemActionData instanceof Array) {\n    const actionDataList = [];\n    for (const action of itemActionData) {\n      actionDataList.push(migrateItemActionData(action, item));\n    }\n\n    updateData[\"system.actions\"] = actionDataList.filter(filterItemActions);\n  }\n\n  // Migrate container items\n  if (item.system?.inventoryItems instanceof Array) {\n    updateData[\"system.inventoryItems\"] = item.system.inventoryItems.map((o) => {\n      const data = mergeObject(o, expandObject(migrateItemData(o, actor, _d + 1)), { inplace: false });\n\n      // Migrate data to system\n      if (data.data != null) {\n        data.system = mergeObject(data.data, data.system);\n        delete data.data;\n      }\n\n      return data;\n    });\n  }\n\n  // Return the migrated update data\n  return updateData;\n};\n\n/**\n * Migrates a single action within an item.\n *\n * @param {object} action - The action's data, which also serves as the update data to pass on.\n * @param {object} item - The item data this action is in.\n * @returns {object} The resulting action data.\n */\nexport const migrateItemActionData = function (action, item) {\n  action = foundry.utils.mergeObject(ffd20.components.ItemAction.defaultData, action);\n\n  _migrateActionDamageType(action, item);\n  _migrateActionConditionals(action, item);\n  _migrateActionEnhOverride(action, item);\n  _migrateActionPrimaryAttack(action, item);\n\n  // Return the migrated update data\n  return action;\n};\n\n/* -------------------------------------------- */\n\n/**\n * Migrate a single Scene document to incorporate changes to the data model of it's actor data overrides\n * Return an Object of updateData to be applied\n *\n * @param {object} scene - The Scene to Update\n * @returns {object} The updateData to apply\n */\nexport const migrateSceneData = async function (scene) {\n  const tokens = [];\n  for (const token of scene.tokens) {\n    const t = deepClone(token);\n    if (!t.actorId || t.actorLink) {\n      t.actorData = {};\n    } else if (!game.actors.has(t.actorId)) {\n      t.actorId = null;\n      t.actorData = {};\n    } else if (!t.actorLink) {\n      const mergedData = foundry.utils.mergeObject(game.actors.get(t.actorId).toObject(), t.actorData, {\n        inplace: false,\n      });\n      const update = migrateActorData(mergedData, token);\n      [\"items\", \"effects\"].forEach((embeddedName) => {\n        if (!update[embeddedName]?.length) return;\n        const updates = new Map(update[embeddedName].map((u) => [u._id, u]));\n        mergedData[embeddedName].forEach((original) => {\n          const update = updates.get(original._id);\n          if (update) foundry.utils.mergeObject(original, update);\n        });\n        delete update[embeddedName];\n      });\n\n      foundry.utils.mergeObject(t.actorData, update);\n    }\n    tokens.push(t);\n  }\n  return { tokens };\n};\n\n/* -------------------------------------------- */\n\nconst _migrateCharacterLevel = function (ent, updateData, linked) {\n  const arr = [\"details.level.value\", \"details.level.min\", \"details.level.max\", \"details.mythicTier\"];\n  if (!linked) return; // skip unlinked tokens\n  for (const k of arr) {\n    const value = getProperty(ent.system, k);\n    if (value == null) {\n      updateData[\"system.\" + k] = 0;\n    }\n  }\n};\n\nconst _migrateActorEncumbrance = function (ent, updateData, linked) {\n  const arr = {\n    \"system.attributes.encumbrance.level\": \"attributes.encumbrance.-=level\",\n    \"system.attributes.encumbrance.levels.light\": \"attributes.encumbrance.levels.-=light\",\n    \"system.attributes.encumbrance.levels.medium\": \"attributes.encumbrance.levels.-=medium\",\n    \"system.attributes.encumbrance.levels.heavy\": \"attributes.encumbrance.levels.-=heavy\",\n    \"system.attributes.encumbrance.levels.carry\": \"attributes.encumbrance.levels.-=carry\",\n    \"system.attributes.encumbrance.levels.drag\": \"attributes.encumbrance.levels.-=drag\",\n    \"system.attributes.encumbrance.carriedWeight\": \"attributes.encumbrance.-=carriedWeight\",\n  };\n  for (const [key, updateKey] of Object.entries(arr)) {\n    const value = getProperty(ent, key);\n    if (value !== undefined) {\n      updateData[\"system.\" + updateKey] = null;\n    }\n  }\n};\n\n/**\n * Convert array based flags into object.\n *\n * @param ent\n * @param updateData\n * @param linked\n */\nconst _migrateFlagsArrayToObject = function (ent, updateData) {\n  const flags = ent.flags;\n  if (!flags) return;\n  const bflags = flags.boolean,\n    dflags = flags.dictionary;\n\n  if (Array.isArray(bflags)) {\n    // Compatibility with old data: Convert old array into actual dictionary.\n    updateData[\"system.flags.boolean\"] = bflags.reduce((flags, flag) => {\n      flags[flag] = true;\n      return flags;\n    }, {});\n  }\n\n  if (Array.isArray(dflags)) {\n    updateData[\"system.flags.dictionary\"] = dflags.reduce((flags, [key, value]) => {\n      flags[key] = value;\n      return flags;\n    }, {});\n  }\n};\n\nconst _migrateActorNoteArrays = function (ent, updateData) {\n  const list = [\"system.attributes.acNotes\", \"system.attributes.cmdNotes\", \"system.attributes.srNotes\"];\n  for (const k of list) {\n    const value = getProperty(ent, k);\n    const hasValue = hasProperty(ent, k);\n    if (hasValue && value instanceof Array) {\n      updateData[k] = value.join(\"\\n\");\n    }\n  }\n};\n\nconst _migrateActorSpeed = function (ent, updateData, linked) {\n  const arr = [\n    \"attributes.speed.land\",\n    \"attributes.speed.climb\",\n    \"attributes.speed.swim\",\n    \"attributes.speed.fly\",\n    \"attributes.speed.burrow\",\n  ];\n  for (const k of arr) {\n    let value = getProperty(ent.system, k);\n    if (!linked && value === undefined) continue; // skip with unlinked tokens\n    if (typeof value === \"string\") value = parseInt(value);\n    if (typeof value === \"number\") {\n      updateData[`system.${k}.base`] = value;\n    } else if (value === null) {\n      updateData[`system.${k}.base`] = 0;\n    } else if (value?.total !== undefined) {\n      // Delete derived data\n      updateData[`system.${k}.-=total`] = null;\n    }\n\n    // Add maneuverability\n    if (k === \"attributes.speed.fly\" && getProperty(ent.system, `${k}.maneuverability`) === undefined) {\n      updateData[`system.${k}.maneuverability`] = \"average\";\n    }\n  }\n};\n\nconst _migrateActorSpellbookSlots = function (ent, updateData, linked) {\n  for (const spellbookSlot of Object.keys(getProperty(ent, \"system.attributes.spells.spellbooks\") || {})) {\n    if (getProperty(ent, `system.attributes.spells.spellbooks.${spellbookSlot}.autoSpellLevels`) == null) {\n      updateData[`system.attributes.spells.spellbooks.${spellbookSlot}.autoSpellLevels`] = true;\n    }\n\n    for (let a = 0; a < 10; a++) {\n      const baseKey = `system.attributes.spells.spellbooks.${spellbookSlot}.spells.spell${a}.base`;\n      const maxKey = `system.attributes.spells.spellbooks.${spellbookSlot}.spells.spell${a}.max`;\n      const base = getProperty(ent, baseKey);\n      const max = getProperty(ent, maxKey);\n\n      if (base === undefined) {\n        if (!linked) continue; // skip with unlinked tokens\n        if (typeof max === \"number\" && max > 0) {\n          updateData[baseKey] = max.toString();\n        }\n      } else {\n        const newBase = parseInt(base);\n        if (newBase > 0) {\n          if (newBase !== base) updateData[baseKey] = newBase;\n        } else {\n          // Remove pointless default value not present in new actors either\n          updateData[`system.attributes.spells.spellbooks.${spellbookSlot}.spells.spell${a}.-=base`] = null;\n        }\n      }\n    }\n  }\n};\n\nconst _migrateActorBaseStats = function (ent, updateData) {\n  const keys = [\n    \"system.attributes.hp.base\",\n    \"system.attributes.hd.base\",\n    \"system.attributes.mp.base\",\n    \"system.attributes.savingThrows.fort.value\",\n    \"system.attributes.savingThrows.ref.value\",\n    \"system.attributes.savingThrows.will.value\",\n  ];\n  for (const k of keys) {\n    if (\n      k === \"system.attributes.hp.base\" &&\n      !(getProperty(ent, \"items\") || []).filter((o) => o.type === \"class\").length\n    )\n      continue;\n    if (\n      k === \"system.attributes.mp.base\" &&\n      !(getProperty(ent, \"items\") || []).filter((o) => o.type === \"class\").length\n    )\n      continue;\n    if (getProperty(ent, k) !== undefined) {\n      const kList = k.split(\".\");\n      kList[kList.length - 1] = `-=${kList[kList.length - 1]}`;\n      updateData[kList.join(\".\")] = null;\n    }\n  }\n};\n\nconst _migrateUnusedActorCreatureType = function (ent, updateData) {\n  const type = getProperty(ent, \"system.attributes.creatureType\");\n  if (type != undefined) updateData[\"system.attributes.-=creatureType\"] = null;\n};\n\nconst _migrateActorSpellbookDCFormula = function (ent, updateData, linked) {\n  const spellbooks = Object.keys(getProperty(ent, \"system.attributes.spells.spellbooks\") || {});\n\n  for (const k of spellbooks) {\n    const key = `system.attributes.spells.spellbooks.${k}.baseDCFormula`;\n    const curFormula = getProperty(ent, key);\n    if (!linked && curFormula === undefined) continue; // skip with unlinked tokens\n    if (curFormula == null) updateData[key] = \"10 + @sl + @ablMod\";\n  }\n};\n\nconst _migrateActorSpellbookName = function (ent, updateData) {\n  const spellbooks = Object.entries(getProperty(ent, \"system.attributes.spells.spellbooks\") || {});\n  for (const [bookId, book] of spellbooks) {\n    if (book.altName !== undefined) {\n      const key = `system.attributes.spells.spellbooks.${bookId}`;\n      updateData[`${key}.-=altName`] = null;\n      if (book.altName.length) updateData[`${key}.name`] = book.altName;\n    }\n  }\n};\n\nconst _migrateActorSpellbookCL = function (ent, updateData) {\n  const spellbooks = Object.keys(getProperty(ent, \"system.attributes.spells.spellbooks\") || {});\n\n  for (const k of spellbooks) {\n    const key = `system.attributes.spells.spellbooks.${k}.cl`;\n    const curBase = parseInt(getProperty(ent, key + \".base\"));\n    const curFormula = getProperty(ent, key + \".formula\");\n    if (curBase > 0) {\n      if (curFormula.length > 0) updateData[`${key}.formula`] = curFormula + \" + \" + curBase;\n      else updateData[`${key}.formula`] = curFormula + curBase;\n      updateData[`${key}.base`] = 0;\n    }\n  }\n};\n\nconst _migrateActorConcentration = function (ent, updateData) {\n  const spellbooks = Object.keys(getProperty(ent, \"system.attributes.spells.spellbooks\") || {});\n  for (const k of spellbooks) {\n    // Delete unused .concentration from old actors\n    const key = `system.attributes.spells.spellbooks.${k}`;\n    const oldValue = getProperty(ent, `${key}.concentration`);\n    const isString = typeof oldValue === \"string\";\n    if (Number.isFinite(oldValue) || isString) updateData[`${key}.-=concentration`] = null;\n    if (isString) {\n      // Assume erroneous bonus formula location and combine it with existing bonus formula.\n      const formulaKey = `${key}.concentrationFormula`;\n      const formula = [oldValue];\n      formula.push(getProperty(ent, formulaKey) || \"\");\n      updateData[formulaKey] = formula.filter((f) => f !== 0 && f?.toString().trim().length).join(\" + \");\n    }\n  }\n};\n\nconst _migrateActorHPAbility = function (ent, updateData) {\n  // Set HP ability\n  if (getProperty(ent, \"system.attributes.hpAbility\") === undefined) {\n    updateData[\"system.attributes.hpAbility\"] = \"con\";\n  }\n\n  // Set Fortitude save ability\n  if (getProperty(ent, \"system.attributes.savingThrows.fort.ability\") === undefined) {\n    updateData[\"system.attributes.savingThrows.fort.ability\"] = \"con\";\n  }\n\n  // Set Reflex save ability\n  if (getProperty(ent, \"system.attributes.savingThrows.ref.ability\") === undefined) {\n    updateData[\"system.attributes.savingThrows.ref.ability\"] = \"dex\";\n  }\n\n  // Set Will save ability\n  if (getProperty(ent, \"system.attributes.savingThrows.will.ability\") === undefined) {\n    updateData[\"system.attributes.savingThrows.will.ability\"] = \"wis\";\n  }\n};\n\nconst _migrateItemArrayTypes = function (ent, updateData) {\n  const conditionals = getProperty(ent, \"system.conditionals\");\n  if (conditionals != null && !(conditionals instanceof Array)) {\n    updateData[\"system.conditionals\"] = [];\n  }\n\n  const contextNotes = getProperty(ent, \"system.contextNotes\");\n  if (contextNotes != null && !(contextNotes instanceof Array)) {\n    if (contextNotes instanceof Object) updateData[\"system.contextNotes\"] = Object.values(contextNotes);\n    else updateData[\"system.contextNotes\"] = [];\n  }\n};\n\nconst _migrateItemSpellUses = function (ent, updateData) {\n  if (getProperty(ent.system, \"preparation\") === undefined) return;\n\n  const value = getProperty(ent.system, \"preparation.maxAmount\");\n  if (typeof value !== \"number\") updateData[\"system.preparation.maxAmount\"] = 0;\n};\n\nconst _migrateWeaponImprovised = function (ent, updateData) {\n  if (ent.type !== \"weapon\") return;\n\n  const value = getProperty(ent.system, \"weaponType\");\n  if (value === \"improv\") {\n    updateData[\"system.weaponType\"] = \"misc\";\n    updateData[\"system.properties.imp\"] = true;\n  }\n};\n\nconst _migrateWeaponData = function (ent, updateData) {\n  if (ent.type !== \"weapon\") return;\n\n  if (getProperty(ent.system, \"weaponData\") !== undefined) {\n    const subtype = ent.system.weaponSubtype;\n    const isMelee = subtype !== \"ranged\";\n\n    // Generate missing data\n\n    // TODO: Respect character configuration if present\n    //getProperty(this, \"system.attributes.attack.meleeAbility\") || \"str\";\n    //getProperty(this, \"system.attributes.attack.rangedAbility\") || \"dex\";\n    const atkAbl = getProperty(ent, \"system.ability.attack\");\n    if (atkAbl == null || atkAbl === \"\") {\n      updateData[\"system.ability.attack\"] = isMelee ? \"str\" : \"dex\";\n    }\n    const dmgAbl = getProperty(ent, \"system.ability.damage\");\n    if (dmgAbl == null || dmgAbl === \"\") {\n      updateData[\"system.ability.damage\"] = \"str\";\n    }\n    if (getProperty(ent, \"system.ability.damageMult\") == null) {\n      updateData[\"system.ability.damageMult\"] = subtype === \"2h\" ? 1.5 : 1;\n    }\n    if (getProperty(ent, \"system.attackType\") == null) {\n      updateData[\"system.attackType\"] = \"weapon\";\n    }\n\n    // Activation\n    updateData[\"system.actionType\"] = isMelee ? \"mwak\" : \"rwak\";\n    updateData[\"system.activation.type\"] = \"attack\";\n    updateData[\"system.duration.units\"] = \"inst\";\n\n    // BAB iteratives\n    updateData[\"system.formulaicAttacks.count.formula\"] = \"ceil(@attributes.bab.total / 5) - 1\";\n    updateData[\"system.formulaicAttacks.bonus.formula\"] = \"@formulaicAttack * -5\";\n\n    // Preserve weapon data if present\n\n    // Criticals\n    updateData[\"system.ability.critRange\"] = getProperty(ent, \"system.weaponData.critRange\") ?? 20;\n    updateData[\"system.ability.critMult\"] = getProperty(ent, \"system.weaponData.critMult\") ?? 2;\n\n    // Range\n    if (isMelee) {\n      const isReach = getProperty(ent, \"system.properties.rch\") ?? false;\n      updateData[\"system.range.units\"] = isReach ? \"reach\" : \"melee\";\n    } else {\n      updateData[\"system.range.units\"] = \"ft\";\n    }\n    const range = getProperty(ent, \"system.weaponData.range\") ?? null;\n    if (range !== undefined) {\n      updateData[\"system.range.value\"] = range;\n    }\n\n    const maxRange = getProperty(ent, \"system.weaponData.maxRangeIncrements\");\n    if (maxRange !== undefined) updateData[\"system.range.maxIncrements\"] = maxRange;\n\n    // Damage\n    const damageRoll = getProperty(ent, \"system.weaponData.damageRoll\")?.trim();\n    const damageType = getProperty(ent, \"system.weaponData.damageType\")?.trim();\n    const damageBonusFormula = getProperty(ent, \"system.weaponData.damageFormula\")?.trim();\n\n    if (damageRoll !== undefined) {\n      let roll = damageRoll || \"1d4\";\n      let dieCount = 1,\n        dieSides = 4;\n      if (roll.match(/^([0-9]+)d([0-9]+)$/)) {\n        dieCount = parseInt(RegExp.$1);\n        dieSides = parseInt(RegExp.$2);\n        roll = `sizeRoll(${dieCount}, ${dieSides}, @size)`;\n      }\n      if (damageBonusFormula != null && damageBonusFormula.length) roll = `${roll} + ${damageBonusFormula}`;\n      updateData[\"system.damage.parts\"] = [[roll, damageType || \"\"]];\n    }\n\n    // Attack bonus\n    updateData[\"system.attackBonus\"] = getProperty(ent, \"system.weaponData.attackFormula\")?.trim() ?? \"\";\n\n    // Flag show in quickbar\n    updateData[\"system.showInQuickbar\"] = false;\n\n    // Remove legacy data\n    updateData[\"system.-=weaponData\"] = null;\n  }\n};\n\nconst _migrateSpellDescription = function (ent, updateData) {\n  if (ent.type !== \"spell\") return;\n\n  const curValue = getProperty(ent, \"system.shortDescription\");\n  if (curValue != null) return;\n\n  const obj = getProperty(ent, \"system.description.value\");\n  if (typeof obj !== \"string\") return;\n  const html = $(`<div>${obj}</div>`);\n  const elem = html.find(\"h2\").next();\n  if (elem.length === 1) updateData[\"system.shortDescription\"] = elem.prop(\"outerHTML\");\n  else updateData[\"system.shortDescription\"] = html.prop(\"innerHTML\");\n};\n\nconst _migrateSpellDivineFocus = function (ent, updateData) {\n  if (ent.type !== \"spell\") return;\n\n  const value = getProperty(ent, \"system.components.divineFocus\");\n  if (typeof value === \"boolean\") updateData[\"system.components.divineFocus\"] = value === true ? 1 : 0;\n};\n\nconst _migrateClassDynamics = function (ent, updateData) {\n  if (ent.type !== \"class\") return;\n\n  const bab = getProperty(ent, \"system.bab\");\n  if (typeof bab === \"number\") updateData[\"system.bab\"] = \"low\";\n\n  const stKeys = [\"system.savingThrows.fort.value\", \"system.savingThrows.ref.value\", \"system.savingThrows.will.value\"];\n  for (const key of stKeys) {\n    const value = getProperty(ent, key);\n    if (typeof value === \"number\") updateData[key] = \"low\";\n  }\n};\n\nconst _migrateClassType = function (ent, updateData) {\n  if (ent.type !== \"class\") return;\n\n  if (getProperty(ent, \"system.classType\") == null) updateData[\"system.classType\"] = \"base\";\n};\n\nconst _migrateWeaponCategories = function (ent, updateData) {\n  if (ent.type !== \"weapon\") return;\n\n  // Change category\n  const type = getProperty(ent, \"system.weaponType\");\n  if (type === \"misc\") {\n    updateData[\"system.weaponType\"] = \"misc\";\n    updateData[\"system.weaponSubtype\"] = \"other\";\n  } else if (type === \"splash\") {\n    updateData[\"system.weaponType\"] = \"misc\";\n    updateData[\"system.weaponSubtype\"] = \"splash\";\n  }\n\n  const changeProp = [\"simple\", \"martial\", \"exotic\", \"chef\", \"power\"].includes(type);\n  if (changeProp && getProperty(ent, \"system.weaponSubtype\") == null) {\n    updateData[\"system.weaponSubtype\"] = \"1h\";\n  }\n\n  // Change light property\n  const lgt = getProperty(ent, \"system.properties.lgt\");\n  if (lgt != null) {\n    updateData[\"system.properties.-=lgt\"] = null;\n    if (lgt === true && changeProp) {\n      updateData[\"system.weaponSubtype\"] = \"light\";\n    }\n  }\n\n  // Change two-handed property\n  const two = getProperty(ent, \"system.properties.two\");\n  if (two != null) {\n    updateData[\"system.properties.-=two\"] = null;\n    if (two === true && changeProp) {\n      updateData[\"system.weaponSubtype\"] = \"2h\";\n    }\n  }\n\n  // Change melee property\n  const melee = getProperty(ent, \"system.weaponData.isMelee\");\n  if (melee != null) {\n    updateData[\"system.weaponData.-=isMelee\"] = null;\n    if (melee === false && changeProp) {\n      updateData[\"system.weaponSubtype\"] = \"ranged\";\n    }\n  }\n};\n\nconst _migrateEquipmentCategories = function (ent, updateData) {\n  if (ent.type !== \"equipment\") return;\n\n  const oldType = getProperty(ent, \"system.armor.type\");\n  if (oldType == null) return;\n\n  if (oldType === \"clothing\") {\n    updateData[\"system.equipmentType\"] = \"misc\";\n    updateData[\"system.equipmentSubtype\"] = \"clothing\";\n  } else if (oldType === \"shield\") {\n    updateData[\"system.equipmentType\"] = \"shield\";\n    updateData[\"system.equipmentSubtype\"] = \"lightShield\";\n    updateData[\"system.slot\"] = \"shield\";\n  } else if (oldType === \"misc\") {\n    updateData[\"system.equipmentType\"] = \"misc\";\n    updateData[\"system.equipmentSubtype\"] = \"wondrous\";\n  } else if ([\"light\", \"medium\", \"heavy\"].includes(oldType)) {\n    updateData[\"system.equipmentType\"] = \"armor\";\n    updateData[\"system.equipmentSubtype\"] = `${oldType}Armor`;\n  }\n\n  updateData[\"system.armor.-=type\"] = null;\n};\n\nconst _migrateItemSize = function (ent, updateData, linked) {\n  // Convert custom sizing in weapons\n  if (ent.type === \"weapon\") {\n    const wdSize = getProperty(ent, \"system.weaponData.size\");\n    if (wdSize) {\n      // Move old\n      updateData[\"system.size\"] = wdSize;\n      updateData[\"system.weaponData.-=size\"] = null;\n      return;\n    }\n  }\n  // Convert any other instances\n  if (!getProperty(ent, \"system.size\")) {\n    // Fill in missing\n    updateData[\"system.size\"] = \"med\";\n  }\n};\n\nconst _migrateAbilityTypes = function (ent, updateData) {\n  if (ent.type !== \"feat\") return;\n\n  if (getProperty(ent, \"system.abilityType\") == null) {\n    updateData[\"system.abilityType\"] = \"none\";\n  }\n  // Fix buggy value\n  if (getProperty(ent, \"system.abilityType\") === \"n/a\") {\n    updateData[\"system.abilityType\"] = \"none\";\n  }\n};\n\nconst _migrateClassLevels = function (ent, updateData) {\n  const level = getProperty(ent, \"system.levels\");\n  if (typeof level === \"number\" && getProperty(ent, \"system.level\") == null) {\n    updateData[\"system.level\"] = level;\n    updateData[\"system.-=levels\"] = null;\n  }\n};\n\nconst _migrateSavingThrowTypes = function (ent, updateData) {\n  if (getProperty(ent, \"system.save.type\") == null && typeof getProperty(ent, \"system.save.description\") === \"string\") {\n    const desc = getProperty(ent, \"system.save.description\");\n    if (desc.match(/REF/i)) updateData[\"system.save.type\"] = \"ref\";\n    else if (desc.match(/FORT/i)) updateData[\"system.save.type\"] = \"fort\";\n    else if (desc.match(/WILL/i)) updateData[\"system.save.type\"] = \"will\";\n  }\n};\n\nconst _migrateCR = function (ent, updateData) {\n  // Migrate CR offset\n  const crOffset = getProperty(ent, \"system.crOffset\");\n  if (typeof crOffset === \"number\") {\n    updateData[\"system.crOffset\"] = crOffset.toString();\n  }\n};\n\nconst _migrateItemChanges = function (ent, updateData) {\n  // Migrate changes\n  const changes = getProperty(ent, \"system.changes\");\n  if (changes != null && changes instanceof Array) {\n    const newChanges = [];\n    for (const c of changes) {\n      if (c instanceof Array) {\n        const newChange = new ItemChange(\n          {\n            formula: c[0],\n            target: c[1],\n            subTarget: c[2],\n            modifier: c[3],\n            value: c[4],\n          },\n          null\n        );\n        newChanges.push(newChange.data);\n      } else {\n        const newChange = new ItemChange(c, null);\n        newChanges.push(newChange.data);\n      }\n    }\n\n    // Alter the changes list, but only if at least one of them is nonzero length\n    if (newChanges.length !== 0 && changes.length !== 0) {\n      updateData[\"system.changes\"] = newChanges;\n    }\n  }\n\n  // Migrate context notes\n  const notes = getProperty(ent, \"system.contextNotes\");\n  if (notes != null && notes instanceof Array) {\n    const newNotes = [];\n    for (const n of notes) {\n      if (n instanceof Array) {\n        newNotes.push(\n          foundry.utils.mergeObject(ItemFFD20.defaultContextNote, { text: n[0], subTarget: n[2] }, { inplace: false })\n        );\n      } else {\n        newNotes.push(n);\n      }\n\n      // Migrate old note targets\n      if (n.target === \"spell\" && n.subTarget === \"effect\") {\n        n.subTarget = \"spellEffect\";\n      }\n    }\n\n    // Alter the context note list, but only if at least one of them is nonzero length\n    if (newNotes.length !== 0 && notes.length !== 0) {\n      updateData[\"system.contextNotes\"] = newNotes;\n    }\n  }\n};\n\nconst _migrateTemplateSize = function (ent, updateData) {\n  const measureSize = getProperty(ent, \"system.measureTemplate.size\");\n  if (typeof measureSize === \"number\") {\n    updateData[\"system.measureTemplate.size\"] = measureSize.toString();\n  }\n};\n\nconst _migrateEquipmentSize = function (ent, updateData) {\n  if (ent.type !== \"equipment\") return;\n\n  const size = getProperty(ent, \"system.size\");\n  if (!size) {\n    updateData[\"system.size\"] = \"med\";\n  }\n};\n\n// Migrate .weight number to .weight.value\n// Migrate .baseWeight that was briefly introduced in 0.81\nconst _migrateItemWeight = function (ent, updateData) {\n  const baseWeight = getProperty(ent, \"system.baseWeight\"),\n    weight = getProperty(ent, \"system.weight\");\n\n  // Skip items of inappropriate type\n  if (!game.system.template.Item[ent.type].templates.includes(\"physicalItem\")) {\n    if (weight !== undefined) {\n      // Ensure inappropriate items don't have spurious weight, which breaks data prep\n      updateData[\"system.-=weight\"] = null;\n    }\n    return;\n  }\n\n  if (Number.isFinite(weight)) {\n    updateData[\"system.weight.value\"] = weight;\n  } else if (weight == null || typeof weight !== \"object\") {\n    // Convert any other values to just 0 weight, e.g. null\n    updateData[\"system.weight.value\"] = 0;\n  }\n\n  // If baseWeight exists and looks reasonable, use it for base weight instead\n  if (baseWeight !== undefined) {\n    if (Number.isFinite(baseWeight) && baseWeight > 0) {\n      updateData[\"system.weight.value\"] = baseWeight;\n    }\n    updateData[\"system.-=baseWeight\"] = null;\n  }\n};\n\nconst _migrateTags = function (ent, updateData) {\n  if (![\"class\"].includes(ent.type)) return;\n\n  const tag = getProperty(ent, \"system.tag\");\n  if (!tag && ent.name) {\n    updateData[\"system.tag\"] = createTag(ent.name);\n  }\n};\n\nconst _migrateSpellCosts = function (ent, updateData) {\n  if (ent.type !== \"spell\") return;\n\n  const spellPointCost = getProperty(ent, \"system.spellPoints.cost\");\n  if (spellPointCost == null) {\n    updateData[\"system.spellPoints.cost\"] = \"1 + @sl\";\n  }\n\n  const slotCost = getProperty(ent, \"system.slotCost\");\n  if (slotCost == null) {\n    updateData[\"system.slotCost\"] = 1;\n  }\n\n  // Migrate level 0 spell charge deduction in a specific version\n  if (\n    !SemanticVersion.fromString(game.system.version).isHigherThan(SemanticVersion.fromString(\"0.77.11\")) &&\n    getProperty(ent, \"system.level\") === 0\n  ) {\n    updateData[\"system.preparation.autoDeductCharges\"] = false;\n  }\n};\n\nconst _migrateLootEquip = function (ent, updateData) {\n  if (ent.type === \"loot\" && !hasProperty(ent, \"system.equipped\")) {\n    updateData[\"system.equipped\"] = false;\n  }\n};\n\nconst _migrateUnchainedActionEconomy = function (ent, updateData) {\n  // Determine existing data\n  const curAction = getProperty(ent, \"system.activation\");\n  const unchainedAction = getProperty(ent, \"system.unchainedAction.activation\");\n  if (!curAction || (curAction && !curAction.type)) return;\n  if (unchainedAction && unchainedAction.type) return;\n\n  // Create unchained action economy data\n  if (CONFIG.FFD20.abilityActivationTypes_unchained[curAction.type] != null) {\n    updateData[\"system.unchainedAction.activation.cost\"] = curAction.cost;\n    updateData[\"system.unchainedAction.activation.type\"] = curAction.type;\n  }\n  if ([\"swift\", \"attack\"].includes(curAction.type)) {\n    updateData[\"system.unchainedAction.activation.cost\"] = 1;\n    updateData[\"system.unchainedAction.activation.type\"] = curAction.type === \"attack\" ? \"attack\" : \"action\";\n  }\n  if (curAction.type === \"standard\") {\n    updateData[\"system.unchainedAction.activation.cost\"] = 2;\n    updateData[\"system.unchainedAction.activation.type\"] = \"action\";\n  }\n  if (curAction.type === \"full\" || curAction.type === \"round\") {\n    updateData[\"system.unchainedAction.activation.cost\"] = 3 * (curAction.cost || 1);\n    updateData[\"system.unchainedAction.activation.type\"] = \"action\";\n  }\n  if (curAction.type === \"immediate\") {\n    updateData[\"system.unchainedAction.activation.type\"] = \"reaction\";\n    updateData[\"system.unchainedAction.activation.cost\"] = 1;\n  }\n};\n\nconst _migrateItemRange = function (ent, updateData) {\n  // Set max range increment\n  if (getProperty(ent, \"system.range.maxIncrements\") === undefined) {\n    updateData[\"system.range.maxIncrements\"] = 1;\n  }\n};\n\nconst _migrateItemLinks = function (ent, updateData) {\n  if ([\"attack\", \"consumable\", \"equipment\"].includes(ent.type) && !hasProperty(ent, \"system.links.charges\")) {\n    updateData[\"system.links.charges\"] = [];\n  }\n};\n\nconst _migrateClassAssociations = function (ent, updateData) {\n  if (ent.type !== \"class\") return;\n  const _assoc = ent.system?.links?.classAssociations;\n  if (_assoc === undefined) return;\n\n  let modified = false;\n  const newAssociations = deepClone(_assoc);\n  for (const assoc of newAssociations) {\n    if (assoc.hiddenLinks !== undefined) {\n      delete assoc.hiddenLinks;\n      modified = true;\n    }\n  }\n\n  if (modified) {\n    updateData[\"system.links.classAssociations\"] = newAssociations;\n  }\n};\n\nconst _migrateProficiencies = function (ent, updateData) {\n  // Add proficiency objects to items able to grant proficiencies\n  if ([\"feat\", \"class\", \"race\"].includes(ent.type)) {\n    for (const prof of [\"armorProf\", \"weaponProf\"]) {\n      if (!hasProperty(ent, `system.${prof}`))\n        updateData[`system.${prof}`] = {\n          value: [],\n          custom: \"\",\n        };\n    }\n  }\n};\n\nconst _migrateItemNotes = function (ent, updateData) {\n  const list = [\"system.attackNotes\", \"system.effectNotes\"];\n  for (const k of list) {\n    const value = getProperty(ent, k);\n    const hasValue = hasProperty(ent, k);\n    if (hasValue && !(value instanceof Array)) {\n      updateData[k] = [];\n      if (typeof value === \"string\" && value.length > 0) {\n        updateData[k] = value.trim().split(/[\\n\\r]/);\n      }\n    }\n  }\n};\n\n/**\n * @param item\n * @param updateData\n */\nconst _migrateSpellData = function (item, updateData) {\n  if (item.type === \"spell\") {\n    if (item.system.description?.value !== undefined) {\n      updateData[\"system.description.-=value\"] = null;\n    }\n  }\n};\n\nconst _migrateItemActions = function (item, updateData, actor = null) {\n  const hasOldAction =\n    !!item.system.actionType || !!item.system.activation?.type || !!item.system.measureTemplate?.type;\n  const alreadyHasActions = item.system.actions instanceof Array && item.system.actions.length > 0;\n  if ((!hasOldAction && item.type !== \"spell\") || alreadyHasActions) return;\n\n  // Transfer data to an action\n  const actionData = ffd20.components.ItemAction.defaultData;\n  const removeKeys = [\"_id\", \"name\", \"img\"];\n  for (const k of Object.keys(actionData)) {\n    if (!removeKeys.includes(k)) {\n      if (item.system[k] != null) actionData[k] = deepClone(item.system[k]);\n    }\n  }\n\n  // Transfer name and image\n  if ([\"weapon\", \"attack\"].includes(item.type)) {\n    actionData.name = game.i18n.localize(\"FFD20.Attack\");\n  } else {\n    actionData.name = game.i18n.localize(\"FFD20.Use\");\n  }\n  actionData.img = item.img;\n  // Clear description\n  actionData.description = \"\";\n  // Add spell data\n  if (item.type === \"spell\") {\n    // Make sure it has an activation type\n    actionData.activation.type ||= \"standard\";\n\n    // Transfer spell duration\n    actionData.duration.value = item.system.spellDuration;\n\n    // Transfer spell point cost\n    if (actor != null) {\n      const spellbookKey = item.system.spellbook;\n      const spellbook = actor.system.attributes?.spells?.spellbooks?.[spellbookKey];\n      if (spellbook.spellPoints?.useSystem) {\n        const oldSpellPointCostFormula = item.system.spellPoints?.cost;\n        if (oldSpellPointCostFormula) actionData.uses.autoDeductChargesCost = oldSpellPointCostFormula;\n      }\n    }\n  }\n  // Clean out old attack and effect notes\n  updateData[\"system.attackNotes\"] = [];\n  updateData[\"system.effectNotes\"] = [];\n\n  updateData[\"system.actions\"] = [actionData];\n};\n\nconst _migrateActionDamageType = function (action, item) {\n  // Determine data paths using damage types\n  const damageGroupPaths = [\"damage.parts\", \"damage.critParts\", \"damage.nonCritParts\"];\n  for (const damageGroupPath of damageGroupPaths) {\n    const damageGroup = getProperty(action, damageGroupPath);\n    for (const damagePart of damageGroup) {\n      // Convert damage types\n      const damageType = damagePart[1];\n      if (typeof damageType === \"string\") {\n        const damageTypeData = ffd20.components.ItemAction.defaultDamageType;\n        damageTypeData.values = _Action_ConvertDamageType(damageType);\n        if (damageTypeData.values.length === 0) damageTypeData.custom = damageType;\n        damagePart[1] = damageTypeData;\n      }\n      // Convert array to object\n      else if (damageType instanceof Array) {\n        const damageTypeData = ffd20.components.ItemAction.defaultDamageType;\n        damageTypeData.values = damageType;\n        damagePart[1] = damageTypeData;\n      }\n    }\n  }\n};\n\nconst _migrateActionConditionals = function (action, item) {\n  for (const conditional of action.conditionals ?? []) {\n    // Create conditional ID\n    if (!conditional._id) conditional._id = randomID(16);\n\n    for (const modifier of conditional.modifiers) {\n      // Create modifier ID\n      if (!modifier._id) modifier._id = randomID(16);\n\n      let reResult;\n      // Convert modifier subtarget\n      if ((reResult = modifier.subTarget.match(/^attack\\.([0-9]+)/))) {\n        modifier.subTarget = `attack_${reResult[1]}`;\n      }\n\n      // Convert modifier damage type\n      if (modifier.target === \"damage\" && !modifier.damageType) {\n        const damageTypeData = ffd20.components.ItemAction.defaultDamageType;\n        damageTypeData.values = _Action_ConvertDamageType(modifier.type);\n        if (damageTypeData.values.length === 0) damageTypeData.custom = modifier.type;\n        modifier.damageType = damageTypeData;\n        modifier.type = \"\";\n      }\n    }\n  }\n};\n\nconst _migrateActionEnhOverride = function (action, item) {\n  if (typeof action.enh !== \"object\") {\n    action.enh = { value: action.enh ?? null };\n  }\n\n  // Set to null if disabled.\n  if (action.enh.override == false) {\n    action.enh.value = null;\n  }\n  // Reset odd values to null, too.\n  else if (action.enh.value !== null && typeof action.enh.value !== \"number\") {\n    action.enh.value = null;\n  }\n  // Delete now unused .override toggle\n  delete action.enh.override;\n};\n\nconst _migrateActionPrimaryAttack = function (action, item) {\n  if (action.naturalAttack?.primaryAttack === undefined) {\n    setProperty(action, \"naturalAttack.primaryAttack\", item.system.primaryAttack);\n  }\n};\n\nconst _migrateActorCR = function (ent, updateData, linked) {\n  // Migrate base CR\n  const cr = getProperty(ent, \"system.details.cr\");\n  if (!linked && cr === undefined) return; // skip with unlinked tokens\n  if (typeof cr === \"number\") {\n    updateData[\"system.details.cr.base\"] = cr;\n  } else if (cr == null) {\n    updateData[\"system.details.cr.base\"] = 1;\n  }\n\n  // Remove derived data if present\n  if (getProperty(ent, \"system.details.cr.total\") !== undefined) {\n    updateData[\"system.details.cr.-=total\"] = null;\n  }\n};\n\nconst _migrateAttackAbility = function (ent, updateData, linked) {\n  const cmbAbl = getProperty(ent, \"system.attributes.cmbAbility\");\n  if (cmbAbl === undefined && linked) updateData[\"system.attributes.cmbAbility\"] = \"str\";\n\n  const meleeAbl = getProperty(ent, \"system.attributes.attack.meleeAbility\");\n  if (meleeAbl === undefined && linked) updateData[\"system.attributes.attack.meleeAbility\"] = \"str\";\n\n  const rangedAbl = getProperty(ent, \"system.attributes.attack.rangedAbility\");\n  if (rangedAbl === undefined && linked) updateData[\"system.attributes.attack.rangedAbility\"] = \"dex\";\n};\n\nconst _migrateActorTokenVision = function (ent, updateData) {\n  const vision = getProperty(ent, \"system.attributes.vision\");\n  if (!vision) return;\n\n  updateData[\"system.attributes.-=vision\"] = null;\n  updateData[\"token.flags.ffd20.lowLightVision\"] = vision.lowLight;\n  if (!getProperty(ent, \"token.brightSight\")) updateData[\"token.brightSight\"] = vision.darkvision ?? 0;\n};\n\nconst _migrateActorSpellbookUsage = function (ent, updateData, linked) {\n  const spellbookUsage = getProperty(ent, \"system.attributes.spells.usedSpellbooks\");\n  if (spellbookUsage !== undefined) {\n    updateData[\"system.attributes.spells.-=usedSpellbooks\"] = null;\n  }\n};\n\nconst _migrateActorNullValues = function (ent, updateData) {\n  // Prepare test data\n  const entries = { \"system.attributes.energyDrain\": getProperty(ent, \"system.attributes.energyDrain\") };\n  for (const [k, a] of Object.entries(getProperty(ent, \"system.abilities\") || {})) {\n    entries[`system.abilities.${k}.damage`] = a.damage;\n    entries[`system.abilities.${k}.drain`] = a.drain;\n    entries[`system.abilities.${k}.penalty`] = a.penalty;\n  }\n\n  // Set null values to 0\n  for (const [k, v] of Object.entries(entries)) {\n    if (v === null) {\n      updateData[k] = 0;\n    }\n  }\n};\n\nconst _migrateActorSpellbookDomainSlots = function (ent, updateData) {\n  const spellbooks = getProperty(ent, \"system.attributes.spells.spellbooks\") || {};\n\n  for (const [k, b] of Object.entries(spellbooks)) {\n    if (b.domainSlotValue !== undefined) continue;\n    const key = `system.attributes.spells.spellbooks.${k}.domainSlotValue`;\n    updateData[key] = 1;\n  }\n};\n\nconst _migrateActorStatures = function (ent, updateData) {\n  const stature = getProperty(ent, \"system.traits.stature\");\n\n  if (stature === undefined) {\n    updateData[\"system.traits.stature\"] = \"tall\";\n  }\n};\n\nconst _migrateActorDefenseAbility = function (ent, updateData) {\n  const normalACAbl = getProperty(ent, \"system.attributes.ac.normal.ability\");\n  if (normalACAbl === undefined) updateData[\"system.attributes.ac.normal.ability\"] = \"dex\";\n  const touchACAbl = getProperty(ent, \"system.attributes.ac.touch.ability\");\n  if (touchACAbl === undefined) updateData[\"system.attributes.ac.touch.ability\"] = \"dex\";\n\n  // CMD\n  const cmdDexAbl = getProperty(ent, \"system.attributes.cmd.dexAbility\");\n  if (cmdDexAbl === undefined) updateData[\"system.attributes.cmd.dexAbility\"] = \"dex\";\n  const cmdStrAbl = getProperty(ent, \"system.attributes.cmd.strAbility\");\n  if (cmdStrAbl === undefined) updateData[\"system.attributes.cmd.strAbility\"] = \"str\";\n};\n\nconst _migrateActorInitAbility = function (ent, updateData) {\n  const abl = getProperty(ent, \"system.attributes.init.ability\");\n\n  if (abl === undefined) {\n    updateData[\"system.attributes.init.ability\"] = \"dex\";\n  }\n};\n\nconst _migrateActorCMBRevamp = function (ent, updateData, linked) {\n  if (getProperty(ent, \"system.attributes.cmb.total\") !== undefined) {\n    updateData[\"system.attributes.cmb.-=total\"] = null;\n  }\n};\n\nconst _migrateActorChangeRevamp = function (ent, updateData) {\n  // Skills\n  Object.keys(getProperty(ent, \"system.skills\") ?? {}).forEach((s) => {\n    const path = `system.skills.${s}.`;\n    if (getProperty(ent, path + \"changeBonus\") !== undefined) {\n      updateData[path + \"-=changeBonus\"] = null;\n    }\n\n    // Check for subskill\n    Object.keys(getProperty(ent, `system.skills.${s}.subSkills`) ?? {}).forEach((s2) => {\n      const subPath = `system.skills.${s}.subSkills.${s2}.`;\n      if (getProperty(ent, subPath + \"changeBonus\") !== undefined) {\n        updateData[subPath + \"-=changeBonus\"] = null;\n      }\n    });\n  });\n\n  // Remove derived data\n  const derivedKeys = {\n    \"system.attributes.hp.max\": \"attributes.hp.-=max\",\n    \"system.attributes.mp.max\": \"attributes.mp.-=max\",\n    \"system.attributes.ac.normal.total\": \"attributes.ac.normal.-=total\",\n    \"system.attributes.ac.touch.total\": \"attributes.ac.touch.-=total\",\n    \"system.attributes.ac.flatFooted.total\": \"attributes.ac.flatFooted.-=total\",\n    \"system.attributes.cmd.total\": \"attributes.cmd.-=total\",\n    \"system.attributes.cmd.flatFootedTotal\": \"attributes.cmd.-=flatFootedTotal\",\n    \"system.attributes.sr.total\": \"attributes.sr.-=total\",\n    \"system.attributes.init.total\": \"attributes.init.-=total\",\n  };\n\n  Object.entries(derivedKeys).forEach(([key, updateKey]) => {\n    if (getProperty(ent, key) !== undefined) {\n      updateData[\"system.\" + updateKey] = null;\n    }\n  });\n};\n\nconst _migrateActorConditions = function (ent, updateData) {\n  // Migrate fear to shaken\n  {\n    const cond = getProperty(ent, \"system.conditions.fear\");\n    if (cond !== undefined) {\n      if (cond === true) updateData[\"system.attributes.conditions.shaken\"] = true;\n      updateData[\"system.conditions.-=fear\"] = null;\n    }\n    const condAlt = getProperty(ent, \"system.attributes.conditions.fear\");\n    if (condAlt !== undefined) {\n      if (condAlt === true) updateData[\"system.attributes.conditions.shaken\"] = true;\n      updateData[\"system.attributes.conditions.-=fear\"] = null;\n    }\n  }\n};\n\n/**\n * Migrate abnormal skill rank values to 0.\n * Primarily changing nulls to 0 to match new actors.\n *\n * @param ent\n * @param updateData\n * @param linked\n */\nconst _migrateActorSkillRanks = function (ent, updateData, linked) {\n  const skills = getProperty(ent, \"system.skills\");\n  if (!skills) return; // Unlinked with no skill overrides of any kind\n  for (const [key, data] of Object.entries(skills)) {\n    if (!linked && data.rank === undefined) continue; // Unlinked with no override\n    if (!Number.isFinite(data.rank)) updateData[`system.skills.${key}.rank`] = 0;\n    for (const [subKey, subData] of Object.entries(data.subSkills ?? {})) {\n      if (!linked && subData.rank === undefined) continue; // Unlinked with no override\n      if (!Number.isFinite(subData.rank)) updateData[`system.skills.${key}.subSkills.${subKey}.rank`] = 0;\n    }\n  }\n};\n\nconst _migrateCarryBonus = function (ent, updateData, linked) {\n  if (getProperty(ent, \"system.details.carryCapacity.bonus.user\") === undefined) {\n    let bonus = getProperty(ent, \"system.abilities.str.carryBonus\");\n    if (bonus !== undefined || linked) {\n      bonus = bonus || 0;\n      updateData[\"system.details.carryCapacity.bonus.user\"] = bonus;\n    }\n    updateData[\"system.abilities.str.-=carryBonus\"] = null;\n  }\n  if (getProperty(ent, \"system.details.carryCapacity.multiplier.user\") === undefined) {\n    let mult = getProperty(ent, \"system.abilities.str.carryMultiplier\");\n    if (mult !== undefined || linked) {\n      mult = mult || 1;\n      updateData[\"system.details.carryCapacity.multiplier.user\"] = mult - 1;\n    }\n    updateData[\"system.abilities.str.-=carryMultiplier\"] = null;\n  }\n};\n\nconst _migrateBuggedValues = function (ent, updateData, linked) {\n  // Convert to integers\n  const convertToInt = [\n    \"system.details.xp.value\",\n    \"system.currency.pgil\",\n    \"system.currency.gil\",\n    \"system.currency.sgil\",\n    \"system.currency.cgil\",\n    \"system.altCurrency.pgil\",\n    \"system.altCurrency.gil\",\n    \"system.altCurrency.sgil\",\n    \"system.altCurrency.cgil\",\n  ];\n  for (const key of convertToInt) {\n    const oldValue = getProperty(ent, key),\n      value = parseInt(oldValue ?? 0);\n    if (oldValue !== value) {\n      updateData[key] = value;\n    }\n  }\n};\n\nconst _migrateSpellbookUsage = function (ent, updateData, linked) {\n  const usedSpellbooks = ent.items\n    .filter((i) => i.type === \"spell\")\n    .reduce((cur, i) => {\n      if (!i.system.spellbook) return cur;\n      if (cur.includes(i.system.spellbook)) return cur;\n      cur.push(i.system.spellbook);\n      return cur;\n    }, []);\n\n  for (const bookKey of usedSpellbooks) {\n    const path = `system.attributes.spells.spellbooks.${bookKey}.inUse`;\n    if (getProperty(ent, path) !== true) {\n      updateData[path] = true;\n    }\n  }\n};\n\nconst _migrateActorHP = function (ent, updateData, linked) {\n  // Migrate HP, Wounds and Vigor values from absolutes to relatives, which is a change in 0.80.16\n  for (const k of [\n    \"system.attributes.hp\",\n    \"system.attributes.wounds\",\n    \"system.attributes.vigor\",\n    \"system.attributes.mp\",\n  ]) {\n    if (getProperty(ent, `${k}.offset`) == null) {\n      const max = getProperty(ent, `${k}.max`) ?? 0;\n      const value = getProperty(ent, `${k}.value`) ?? 0;\n      updateData[`${k}.offset`] = value - max;\n    }\n  }\n};\n\nconst _migrateActorSenses = function (ent, updateData, linked, token) {\n  const oldSenses = getProperty(ent, \"system.traits.senses\");\n  if (typeof oldSenses === \"string\") {\n    const tokenData = token ?? ent.prototypeToken;\n\n    updateData[\"system.traits.senses\"] = {\n      dv: tokenData.brightSight,\n      ts: 0,\n      bs: 0,\n      bse: 0,\n      ll: {\n        enabled: tokenData.flags?.ffd20?.lowLightVision,\n        multiplier: {\n          dim: tokenData.flags?.ffd20?.lowLightVisionMultiplier ?? 2,\n          bright: tokenData.flags?.ffd20?.lowLightVisionMultiplierBright ?? 2,\n        },\n      },\n      sid: false,\n      tr: false,\n      si: false,\n      sc: false,\n      custom: oldSenses,\n    };\n  }\n};\n\nconst _migrateActorSkillJournals = function (ent, updateData, linked) {\n  const reOldJournalFormat = /^[a-zA-Z0-9]+$/;\n  for (const [skillKey, skill] of Object.entries(ent.system.skills ?? {})) {\n    for (const [subSkillKey, subSkill] of Object.entries(skill.subSkills ?? {})) {\n      if (subSkill.journal?.match(reOldJournalFormat)) {\n        updateData[`system.skills.${skillKey}.subSkills.${subSkillKey}.journal`] = `JournalEntry.${subSkill.journal}`;\n      }\n    }\n\n    if (skill.journal?.match(reOldJournalFormat)) {\n      updateData[`system.skills.${skillKey}.journal`] = `JournalEntry.${skill.journal}`;\n    }\n  }\n};\n\n// add other damage types\nconst _Action_ConvertDamageType = function (damageTypeString) {\n  const separator = /(?:\\s*\\/\\s*|\\s+and\\s+|\\s+or\\s+)/i;\n  const damageTypeList = [\n    {\n      tests: [\"b\", \"blunt\", \"bludgeoning\"],\n      result: \"bludgeoning\",\n    },\n    {\n      tests: [\"p\", \"pierce\", \"piercing\"],\n      result: \"piercing\",\n    },\n    {\n      tests: [\"s\", \"slash\", \"slashing\"],\n      result: \"slashing\",\n    },\n    {\n      tests: [\"f\", \"fire\"],\n      result: \"fire\",\n    },\n    {\n      tests: [\"cold\", \"c\"],\n      result: \"cold\",\n    },\n    {\n      tests: [\"e\", \"electric\", \"electricity\", \"electrical\"],\n      result: \"electric\",\n    },\n    {\n      tests: [\"a\", \"acid\"],\n      result: \"acid\",\n    },\n    {\n      tests: [\"sonic\"],\n      result: \"sonic\",\n    },\n    {\n      tests: [\"force\"],\n      result: \"force\",\n    },\n    {\n      tests: [\"neg\", \"negative\"],\n      result: \"negative\",\n    },\n    {\n      tests: [\"pos\", \"positive\"],\n      result: \"positive\",\n    },\n    {\n      tests: [\"u\", \"untyped\", \"untype\"],\n      result: \"untyped\",\n    },\n  ];\n\n  const damageTypes = damageTypeString.split(separator).map((o) => o.toLowerCase());\n  const result = [];\n  for (const damageTest of damageTypeList) {\n    for (const testString of damageTest.tests) {\n      if (damageTypes.includes(testString)) {\n        result.push(damageTest.result);\n      }\n    }\n  }\n\n  if (result.length > 0) return result;\n  return [];\n};\n\n/**\n * Filters out actions during migration.\n *\n * @param {object} action - The data of the action in question.\n * @returns {boolean} `true` to keep action, `false` to discard action.\n */\nexport const filterItemActions = function (action) {\n  if (action.activation?.type) return true;\n  if (action.actionType) return true;\n\n  return false;\n};\n","import { ActorFFD20 } from \"./actor/actor-ffd20.mjs\";\nimport { getActorFromId, getItemOwner } from \"../utils/lib.mjs\";\nimport { getSkipActionPrompt } from \"./settings.mjs\";\n\n/**\n * Various functions dealing with the creation and usage of macros.\n *\n * @module macros\n */\n\n/**\n * Create a Macro from an Item drop, or get an existing one.\n *\n * @param {object} item     The item data\n * @param {string} actor    The actor ID\n * @param data\n * @param {number} slot     The hotbar slot to use\n * @returns {Promise<User>} The updated User\n */\nexport const createItemMacro = async function (data, slot) {\n  const item = await fromUuid(data.uuid);\n  const command = `const item = await fromUuid(\"${item.uuid}\");\\nreturn item.use();`;\n  let macro = game.macros.contents.find((m) => m.name === item.name && m.data.command === command);\n  if (!macro) {\n    macro = await Macro.create(\n      {\n        name: item.name,\n        type: \"script\",\n        img: item.img,\n        command: command,\n        flags: { \"ffd20.itemMacro\": true },\n      },\n      { displaySheet: false }\n    );\n  }\n  return game.user.assignHotbarMacro(macro, slot);\n};\n\n/**\n * Create a Macro from skill data to roll an actor's skill, or get an existing one.\n *\n * @async\n * @param {string} skillId - The skill's identifier\n * @param {string} actorId - The actor's identifier\n * @param {number} slot - The hotbar slot to use\n * @returns {Promise<User>} The updated User\n */\nexport const createSkillMacro = async function (skillId, actorId, slot) {\n  const actor = getActorFromId(actorId);\n  if (!actor) return;\n\n  const skillInfo = actor.getSkillInfo(skillId);\n  const command = `const actor = await fromUuid(\"${actor.uuid}\");\\nreturn actor.rollSkill(\"${skillId}\");`;\n  const name = game.i18n.format(\"FFD20.RollSkillMacroName\", { 0: actor.name, 1: skillInfo.name });\n  let macro = game.macros.contents.find((m) => m.name === name && m.data.command === command);\n  if (!macro) {\n    macro = await Macro.create(\n      {\n        name: name,\n        type: \"script\",\n        img: \"systems/ffd20/icons/items/inventory/dice.jpg\",\n        command: command,\n        flags: { \"ffd20.skillMacro\": true },\n      },\n      { displaySheet: false }\n    );\n  }\n\n  return game.user.assignHotbarMacro(macro, slot);\n};\n\n/**\n * Create a Macro from save data to roll an actor's save, or get an existing one.\n *\n * @async\n * @param {string} saveId - The save's identifier\n * @param {string} actorId - The actor's identifier\n * @param {number} slot - The hotbar slot to use\n * @returns {Promise<User>} The updated User\n */\nexport const createSaveMacro = async function (saveId, actorId, slot) {\n  const actor = getActorFromId(actorId);\n  const saveName = game.i18n.localize(\"FFD20.SavingThrow\" + saveId.substr(0, 1).toUpperCase() + saveId.substr(1));\n  if (!actor) return;\n\n  const command = `const actor = await fromUuid(\"${actor.uuid}\");\\nreturn actor.rollSavingThrow(\"${saveId}\");`;\n  const name = game.i18n.format(\"FFD20.RollSaveMacroName\", { 0: actor.name, 1: saveName });\n  let macro = game.macros.contents.find((m) => m.name === name && m.data.command === command);\n  if (!macro) {\n    macro = await Macro.create(\n      {\n        name: name,\n        type: \"script\",\n        img: \"systems/ffd20/icons/items/inventory/dice.jpg\",\n        command: command,\n        flags: { \"ffd20.saveMacro\": true },\n      },\n      { displaySheet: false }\n    );\n  }\n\n  return game.user.assignHotbarMacro(macro, slot);\n};\n\n/**\n * Create a Macro to roll one of various checks for an actor\n *\n * @async\n * @param {string} type - The type of macro to create\n * @param {string} actorId - The actor's identifier\n * @param {number} slot - The hotbar slot to use\n * @param {string} [altType] - An alternative type, used to denote a spellbook\n * @returns {Promise<User|void>} The updated User, if an update is triggered\n */\nexport const createMiscActorMacro = async function (type, actorId, slot, altType = null) {\n  const actor = getActorFromId(actorId);\n  if (!actor) return;\n\n  let altTypeLabel = \"\";\n  switch (altType) {\n    case \"primary\":\n      altTypeLabel = \"Primary\";\n      break;\n    case \"secondary\":\n      altTypeLabel = \"Secondary\";\n      break;\n    case \"tertiary\":\n      altTypeLabel = \"Tertiary\";\n      break;\n    case \"spelllike\":\n      altTypeLabel = \"Spell-like\";\n      break;\n  }\n\n  let name,\n    img,\n    command = `const actor = await fromUuid(\"${actor.uuid}\");\\n`;\n  switch (type) {\n    case \"defenses\":\n      command += `return actor.rollDefenses();`;\n      name = game.i18n.format(\"FFD20.RollDefensesMacroName\", { 0: actor.name });\n      img = \"systems/ffd20/icons/items/armor/shield-light-metal.png\";\n      break;\n    case \"cmb\":\n      command += `return actor.rollCMB();`;\n      name = game.i18n.format(\"FFD20.RollCMBMacroName\", { 0: actor.name });\n      img = \"systems/ffd20/icons/feats/improved-grapple.jpg\";\n      break;\n    case \"cl\":\n      command += `return actor.rollCL(\"${altType}\");`;\n      name = game.i18n.format(\"FFD20.RollCLMacroName\", { 0: actor.name, 1: altTypeLabel });\n      img = \"systems/ffd20/icons/spells/wind-grasp-eerie-3.jpg\";\n      break;\n    case \"concentration\":\n      command += `return actor.rollConcentration(\"${altType}\");`;\n      name = game.i18n.format(\"FFD20.RollConcentrationMacroName\", { 0: actor.name, 1: altTypeLabel });\n      img = \"systems/ffd20/icons/skills/light_01.jpg\";\n      break;\n    case \"bab\":\n      command += `return actor.rollBAB();`;\n      name = game.i18n.format(\"FFD20.RollBABMacroName\", { 0: actor.name });\n      img = \"systems/ffd20/icons/skills/yellow_08.jpg\";\n      break;\n  }\n\n  if (!name) return;\n\n  let macro = game.macros.contents.find((o) => o.name === name && o.data.command === command);\n  if (!macro) {\n    macro = await Macro.create(\n      {\n        name: name,\n        type: \"script\",\n        img: img,\n        command: command,\n        flags: { \"ffd20.miscMacro\": true },\n      },\n      { displaySheet: false }\n    );\n  }\n\n  return game.user.assignHotbarMacro(macro, slot);\n};\n\n/**\n * Roll an actor's item\n *\n * @param {string} itemName - The item's name\n * @param {object} [options] - Additional options\n * @param {string} [options.itemId] - The item's identifier\n * @param {string} [options.itemType] - The item's type\n * @param {string} [options.actorId] - The actorś identifier\n * @returns {Promise|void} The item's roll or void if any requirements are not met\n */\nexport const rollItemMacro = function (itemName, { itemId, itemType, actorId } = {}) {\n  const actor = getActorFromId(actorId);\n  if (actor && !actor.testUserPermission(game.user, \"OWNER\")) {\n    const msg = game.i18n.localize(\"FFD20.ErrorNoActorPermission\");\n    console.warn(msg);\n    return ui.notifications.warn(msg);\n  }\n  const item = actor\n    ? actor.items.find((i) => {\n        if (itemId != null && i.id !== itemId) return false;\n        if (itemType != null && i.type !== itemType) return false;\n        return i.name === itemName;\n      })\n    : null;\n  if (!item) {\n    const msg = game.i18n.format(\"FFD20.WarningNoItemOnActor\", { 0: actor?.name, 1: itemName });\n    console.warn(msg);\n    return ui.notifications.warn(msg);\n  }\n\n  // Trigger the item roll\n  if (!ffd20.forceShowItem && item.hasAction) {\n    return item.use({ skipDialog: getSkipActionPrompt() });\n  }\n  return item.roll();\n};\n\n/**\n * Roll an actor's skill\n *\n * @param {string} actorId - The actor's identifier\n * @param {string} skillId - The skill's identifier\n * @returns {Promise|void} The skill roll, or void if no skill is found\n */\nexport const rollSkillMacro = function (actorId, skillId) {\n  const actor = getActorFromId(actorId);\n  if (!actor) {\n    const msg = game.i18n.format(\"FFD20.ErrorActorNotFound\", { 0: actorId });\n    console.warn(msg);\n    return ui.notifications.error(msg);\n  }\n\n  return actor.rollSkill(skillId, { skipDialog: getSkipActionPrompt() });\n};\n\n/**\n * Roll an actor's save\n *\n * @param {string} actorId - The actor's identifier\n * @param {string} saveId - The save's identifier\n * @returns {Promise|void} The save roll, or void if no save is found\n */\nexport const rollSaveMacro = function (actorId, saveId) {\n  const actor = getActorFromId(actorId);\n  if (!actor) {\n    const msg = game.i18n.format(\"FFD20.ErrorActorNotFound\", { 0: actorId });\n    console.warn(msg);\n    return ui.notifications.error(msg);\n  }\n\n  return actor.rollSavingThrow(saveId, { skipDialog: getSkipActionPrompt() });\n};\n\n/**\n * Show an actor's defenses\n *\n * @param {object} [options] - Additional parameters\n * @param {string} [options.actorName] - The actor's name\n * @param {string} [options.actorId] - The actor's identifier\n * @param options.rollMode\n * @returns {Promise|void} The defense roll, or void if no actor is found\n */\nexport const rollDefenses = function ({ actorName = null, actorId = null, rollMode = null } = {}) {\n  const actor = ActorFFD20.getActiveActor({ actorName: actorName, actorId: actorId });\n  if (!actor) {\n    const msg = game.i18n.format(\"FFD20.ErrorNoApplicableActorFoundForAction\", {\n      0: game.i18n.localize(\"FFD20.Action_RollDefenses\"),\n    });\n    console.warn(msg);\n    return ui.notifications.warn(msg);\n  }\n\n  return actor.rollDefenses({ rollMode });\n};\n\n/**\n * Roll one of an actor's various attributes\n *\n * @param {string} actorId - The actor's identifier\n * @param {string} type - The attribute to roll\n * @param {string} [altType] - An additional qualifier, used e.g. to determine a roll's spellbook\n * @returns {Promise|void} The roll, or void if no actor is found\n */\nexport const rollActorAttributeMacro = function (actorId, type, altType = null) {\n  const actor = getActorFromId(actorId);\n  if (!actor) {\n    const msg = game.i18n.format(\"FFD20.ErrorActorNotFound\", { 0: actorId });\n    console.error(msg);\n    return ui.notifications.error(msg);\n  }\n\n  switch (type) {\n    case \"defenses\":\n      return actor.rollDefenses();\n    case \"cmb\":\n      return actor.rollCMB();\n    case \"cl\":\n      return actor.rollCL(altType);\n    case \"concentration\":\n      return actor.rollConcentration(altType);\n    case \"bab\":\n      return actor.rollBAB();\n  }\n};\n","/**\n * Transforms a key input into an array of objects for the keybinding API\n *\n * @param {string} key - A key string\n * @returns {{\"key\": string}[]} Keybinding objects\n */\nconst getLeftRight = (key) => [`${key}Left`, `${key}Right`].map((k) => ({ key: k }));\n\nconst SHIFT_KEYS = getLeftRight(\"Shift\");\nconst CTRL_KEYS = getLeftRight(\"Control\");\n\n/**\n * Registers the system's keybindings\n */\nexport const registerSystemControls = () => {\n  game.keybindings.register(\"ffd20\", \"skipConfirmPrompt\", {\n    name: \"FFD20.KEYBINDINGS.SkipConfirmPrompt.Name\",\n    uneditable: SHIFT_KEYS,\n    onDown: () => {\n      ffd20.skipConfirmPrompt = true;\n    },\n    onUp: () => {\n      ffd20.skipConfirmPrompt = false;\n    },\n  });\n\n  game.keybindings.register(\"ffd20\", \"forceShowItem\", {\n    name: \"FFD20.KEYBINDINGS.ForceShowItem.Name\",\n    hint: game.i18n.localize(\"FFD20.KEYBINDINGS.ForceShowItem.Hint\"),\n    uneditable: CTRL_KEYS,\n    onDown: () => {\n      ffd20.forceShowItem = true;\n    },\n    onUp: () => {\n      ffd20.forceShowItem = false;\n    },\n  });\n\n  game.keybindings.register(\"ffd20\", \"hideTokenTooltip\", {\n    name: \"FFD20.KEYBINDINGS.HideTokenTooltip.Name\",\n    hint: game.i18n.localize(\"FFD20.KEYBINDINGS.HideTokenTooltip.Hint\"),\n    uneditable: CTRL_KEYS,\n    onDown: () => ffd20.documents.controls._hideTokenTooltip(true),\n    onUp: () => ffd20.documents.controls._hideTokenTooltip(false),\n  });\n\n  game.keybindings.register(\"ffd20\", \"hideTokenTooltipGMInfo\", {\n    name: \"FFD20.KEYBINDINGS.HideTokenTooltipGMInfo.Name\",\n    uneditable: SHIFT_KEYS,\n    restricted: true,\n    onDown: () => ffd20.documents.controls._hideTokenTooltipGMInfo(true),\n    onUp: () => ffd20.documents.controls._hideTokenTooltipGMInfo(false),\n  });\n};\n\n/**\n * Toggle the display of GM/Player info in the token tooltip\n *\n * @param {boolean} keyDown - Whether the key is pressed down\n * @returns {Promise<void>|void} A Promise that is resolved when the tooltip render handling is done\n */\nexport const _hideTokenTooltipGMInfo = (keyDown) => {\n  if (!ffd20.tooltip) return;\n  ffd20.tooltip.forceHideGMInfo = keyDown;\n  return ffd20.tooltip?.refresh();\n};\n\n/**\n * Toggle the display of the token tooltip\n *\n * @param {boolean} keyDown - Whether the key is pressed down\n * @returns {Promise<void>|void} A Promise that is resolved when the tooltip render handling is done\n */\nexport const _hideTokenTooltip = (keyDown) => {\n  if (!ffd20.tooltip) return;\n  if (game.settings.get(\"ffd20\", \"tooltipConfig\")?.hideWithoutKey === true) ffd20.tooltip.forceHide = !keyDown;\n  else ffd20.tooltip.forceHide = keyDown;\n  return ffd20.tooltip?.refresh();\n};\n","import { ScriptEditor } from \"../applications/script-editor.mjs\";\n\nexport class ItemScriptCall {\n  static AsyncFunction = Object.getPrototypeOf(async function () {}).constructor;\n\n  constructor(data, parent) {\n    this.data = mergeObject(this.constructor.defaultData, data);\n    this.parent = parent;\n  }\n\n  /**\n   * Creates a script call.\n   *\n   * @param {object[]} data - Data to initialize the script call(s) with.\n   * @param {object} context - An object containing context information.\n   * @param {ItemFFD20} [context.parent] - The parent entity to create the script call within.\n   * @returns The resulting script calls, or an empty array if nothing was created.\n   */\n  static async create(data, context) {\n    const { parent } = context;\n\n    if (parent instanceof ffd20.documents.item.ItemFFD20) {\n      // Prepare data\n      data = data.map((dataObj) => mergeObject(this.defaultData, dataObj));\n      const newScriptCallData = deepClone(parent.system.scriptCalls || []);\n      newScriptCallData.push(...data);\n\n      // Update parent\n      await parent.update({ \"system.scriptCalls\": newScriptCallData });\n\n      // Return results\n      return data.map((o) => parent.scriptCalls.get(o._id));\n    }\n\n    return [];\n  }\n\n  static get defaultData() {\n    return {\n      _id: randomID(16),\n      name: game.i18n.localize(\"FFD20.ScriptCalls.NewName\"),\n      img: \"icons/svg/dice-target.svg\",\n      type: \"script\",\n      value: \"\",\n      category: \"\",\n      hidden: false,\n    };\n  }\n\n  get id() {\n    return this.data._id;\n  }\n  get type() {\n    return this.data.type;\n  }\n  get value() {\n    return this.data.value;\n  }\n  get category() {\n    return this.data.category;\n  }\n  get name() {\n    return this.data.name;\n  }\n  get hidden() {\n    return this.data.hidden;\n  }\n\n  async getScriptBody() {\n    return this.type === \"script\" ? this.value : (await fromUuid(this.value))?.data.command ?? \"\";\n  }\n\n  async update(data, options = {}) {\n    if (this.parent != null) {\n      const rawChange = this.parent.system.scriptCalls.find((o) => o._id === this.id);\n      const idx = this.parent.system.scriptCalls.indexOf(rawChange);\n      if (idx >= 0) {\n        data = Object.entries(data).reduce((cur, o) => {\n          cur[`system.scriptCalls.${idx}.${o[0]}`] = o[1];\n          return cur;\n        }, {});\n        return this.parent.update(data, options);\n      }\n    }\n  }\n\n  // Opens up the editor for this script call\n  async edit() {\n    // For Macros\n    if (this.type === \"macro\") {\n      const macro = await fromUuid(this.value);\n      let err;\n      if (macro) {\n        if (macro.testUserPermission(game.user, \"OBSERVER\")) {\n          macro.sheet.render(true, { focus: true });\n        } else {\n          err = game.i18n.format(\"DOCUMENT.SheetPermissionWarn\", { document: macro.documentName });\n        }\n      } else {\n        err = game.i18n.format(\"FFD20.ErrorNoMacroID\", { id: this.value });\n      }\n\n      if (err) {\n        console.error(err);\n        ui.notifications.error(err);\n      }\n    }\n    // For regular script calls\n    else {\n      const scriptEditor = new ScriptEditor({\n        command: this.value,\n        name: this.name,\n        parent: this.parent,\n        scriptCall: true,\n      }).render(true);\n      const result = await scriptEditor.awaitResult();\n      if (result) {\n        return this.update({ value: result.command, name: result.name });\n      }\n    }\n  }\n\n  /**\n   * Executes the script.\n   *\n   * @param {object} shared - An object passed between script calls, and which is passed back as a result of ItemFFD20.executeScriptCalls.\n   * @param {Object<string, object>} extraParams - A dictionary containing extra parameters to pass on to the call.\n   */\n  async execute(shared, extraParams = {}) {\n    // Add variables to the evaluation scope\n    const item = this.parent;\n    const actor = item.parentActor;\n    const token =\n      actor?.token?.object ?? (actor ? canvas.tokens.placeables.find((t) => t.actor?.id === actor.id) : null);\n\n    // Attempt script execution\n    const body = `await (async () => {\n      ${await this.getScriptBody()}\n    })()`;\n    const fn = this.constructor.AsyncFunction(\"item\", \"actor\", \"token\", \"shared\", ...Object.keys(extraParams), body);\n    try {\n      return await fn.call(this, item, actor, token, shared, ...Object.values(extraParams));\n    } catch (err) {\n      ui.notifications.error(`There was an error in your script/macro syntax. See the console (F12) for details`);\n      console.error(err);\n    }\n  }\n}\n","import { createTag } from \"../../utils/lib.mjs\";\n\nexport class ItemActionSheet extends FormApplication {\n  constructor(...args) {\n    super(...args);\n\n    this.item.apps[this.appId] = this;\n    this.action.apps[this.appId] = this;\n    this.action.sheet = this;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      template: \"systems/ffd20/templates/apps/item-action.hbs\",\n      classes: [\"ffd20\", \"item\", \"sheet\", \"item-action\"],\n      width: 580,\n      height: 720,\n      closeOnSubmit: false,\n      submitOnClose: true,\n      submitOnChange: true,\n      resizable: true,\n      scrollY: [\".tab\"],\n      tabs: [\n        {\n          navSelector: \"nav.tabs[data-group='primary']\",\n          contentSelector: \"section.primary-body\",\n          initial: \"description\",\n        },\n      ],\n      dragDrop: [\n        {\n          dragSelector: \"li.conditional\",\n          dropSelector: 'div[data-tab=\"conditionals\"]',\n        },\n      ],\n    });\n  }\n  get title() {\n    return `${this.item.name}: ${this.action.name}`;\n  }\n  get id() {\n    if (this.actor) return `actor-${this.actor.id}-item-${this.item.id}-action-${this.action.id}`;\n    return `item-${this.item.id}-action-${this.action.id}`;\n  }\n\n  get action() {\n    return this.object;\n  }\n  get item() {\n    return this.action.item;\n  }\n  get actor() {\n    return this.item.parentActor;\n  }\n\n  async getData() {\n    const data = await super.getData();\n    data.action = this.action;\n    data.item = this.item;\n    data.actor = this.actor;\n    data.data = foundry.utils.mergeObject(this.action.constructor.defaultData, this.action.data, { inplace: false });\n    data.damageTypes = ffd20.registry.damageTypes.toRecord();\n    data.rollData = this.object.getRollData();\n\n    // Set tag\n    data.tag = createTag(data.action.name);\n\n    // Include CONFIG values\n    data.config = CONFIG.FFD20;\n\n    // Action Details\n    data.hasAttackRoll = this.action.hasAttack;\n    data.isHealing = data.data.actionType === \"heal\";\n    data.isCombatManeuver = [\"mcman\", \"rcman\"].includes(data.data.actionType);\n\n    data.isCharged = this.action.isCharged;\n    data.isSelfCharged = this.action.isSelfCharged;\n    data.showMaxChargeFormula = [\"day\", \"week\", \"charges\"].includes(data.data.uses.self.per);\n    if (this.action.hasRange) {\n      data.canInputRange = [\"ft\", \"mi\", \"spec\"].includes(data.data.range.units);\n      data.canInputMinRange = [\"ft\", \"mi\", \"spec\"].includes(data.data.range.minUnits);\n    }\n    if (data.data.duration != null) {\n      data.canInputDuration = ![\"\", \"inst\", \"perm\", \"seeText\"].includes(data.data.duration.units);\n    }\n\n    // Action Details\n    data.itemName = data.item.name;\n    data.itemEnh = data.item.system.enh || 0;\n    data.isSpell = this.item.type === \"spell\";\n    data.usesSpellPoints = this.item.spellbook?.spellPoints.useSystem;\n    data.canUseAmmo = this.action.data.usesAmmo !== undefined;\n    data.owned = this.item.actor != null;\n    data.parentOwned = this.actor != null;\n    data.owner = this.item.isOwner;\n    data.isGM = game.user.isGM;\n    data.unchainedActionEconomy = game.settings.get(\"ffd20\", \"unchainedActionEconomy\");\n    data.hasActivationType =\n      (game.settings.get(\"ffd20\", \"unchainedActionEconomy\") && data.data.unchainedAction.activation.type) ||\n      (!game.settings.get(\"ffd20\", \"unchainedActionEconomy\") && data.data.activation.type);\n\n    // Add description\n    data.descriptionHTML = await TextEditor.enrichHTML(data.data.description, {\n      secrets: data.owner,\n      rollData: data.rollData,\n      async: true,\n    });\n\n    // Show additional ranged properties\n    data.showMaxRangeIncrements = data.data.range.units === \"ft\";\n\n    // Prepare attack specific stuff\n    if (data.item.type === \"attack\") {\n      data.isWeaponAttack = data.item.system.attackType === \"weapon\";\n      data.isNaturalAttack = data.item.system.attackType === \"natural\";\n    }\n\n    // Add distance units\n    data.distanceUnits = deepClone(CONFIG.FFD20.distanceUnits);\n    if (this.item.type !== \"spell\") {\n      for (const d of [\"close\", \"medium\", \"long\"]) {\n        delete data.distanceUnits[d];\n      }\n    }\n\n    // Prepare stuff for actions with conditionals\n    if (data.data.conditionals) {\n      for (const conditional of data.data.conditionals) {\n        for (const modifier of conditional.modifiers) {\n          modifier.targets = this.object.getConditionalTargets();\n          modifier.subTargets = this.object.getConditionalSubTargets(modifier.target);\n          modifier.conditionalModifierTypes = this.object.getConditionalModifierTypes(modifier.target);\n          modifier.conditionalCritical = this.object.getConditionalCritical(modifier.target);\n        }\n      }\n    }\n\n    return data;\n  }\n\n  /**\n   * Copy from core DocumentSheet#isEditable\n   */\n  get isEditable() {\n    let editable = this.options.editable && this.object.parent.isOwner;\n    if (this.object.parent.pack) {\n      const pack = game.packs.get(this.object.parent.pack);\n      if (pack.locked) editable = false;\n    }\n    return editable;\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    if (!this.isEditable) return;\n\n    // Modify action image\n    html.find(`img[data-edit=\"img\"]`).on(\"click\", this._onEditImage.bind(this));\n\n    // Add drop handler to textareas\n    html.find(\"textarea, .notes input[type='text']\").on(\"drop\", this._onTextAreaDrop.bind(this));\n\n    // Modify attack formula\n    html.find(\".attack-control\").click(this._onAttackControl.bind(this));\n\n    // Modify damage formula\n    html.find(\".damage-control\").click(this._onDamageControl.bind(this));\n    html.find(\".damage-type-visual\").on(\"click\", this._onClickDamageType.bind(this));\n\n    // Listen to field entries\n    html.find(\".entry-selector\").click(this._onEntrySelector.bind(this));\n    html.find(\".entry-control a\").click(this._onEntryControl.bind(this));\n\n    // Modify conditionals\n    html.find(\".conditional-control\").click(this._onConditionalControl.bind(this));\n\n    // Handle alternative file picker\n    html.find(\".file-picker-alt\").click(this._onFilePickerAlt.bind(this));\n  }\n\n  _onDragStart(event) {\n    const elem = event.currentTarget;\n\n    // Drag conditional\n    if (elem.dataset?.conditional) {\n      const conditional = this.object.conditionals.get(elem.dataset?.conditional);\n      event.dataTransfer.setData(\"text/plain\", JSON.stringify(conditional.data));\n    }\n  }\n\n  async _onDrop(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    let data, type;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n      // Surface-level check for conditional\n      if (data.default != null && typeof data.name === \"string\" && Array.isArray(data.modifiers)) type = \"conditional\";\n    } catch (e) {\n      return false;\n    }\n\n    const action = this.object;\n    // Handle conditionals\n    if (type === \"conditional\") {\n      // Check targets and other fields for valid values, reset if necessary\n      for (const modifier of data.modifiers) {\n        if (!Object.keys(action.getConditionalTargets()).includes(modifier.target)) modifier.target = \"\";\n        let keys;\n        for (let [k, v] of Object.entries(modifier)) {\n          switch (k) {\n            case \"subTarget\":\n              keys = Object.keys(action.getConditionalSubTargets(modifier.target));\n              break;\n            case \"type\":\n              keys = Object.keys(action.getConditionalModifierTypes(modifier.target));\n              break;\n            case \"critical\":\n              keys = Object.keys(action.getConditionalCritical(modifier.target));\n              break;\n          }\n          if (!keys?.includes(v)) v = keys?.[0] ?? \"\";\n        }\n      }\n\n      // Renew conditional ID\n      data._id = randomID(16);\n\n      // Append conditional\n      const conditionals = deepClone(action.data.conditionals || []).concat(data);\n      await this.object.update({ conditionals: conditionals });\n    }\n  }\n\n  _onEntrySelector(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const options = {\n      name: a.getAttribute(\"for\"),\n      title: a.innerText,\n      flag: a.dataset.flag === \"true\",\n      flat: a.dataset.flat === \"true\",\n      fields: a.dataset.fields,\n      dtypes: a.dataset.dtypes,\n    };\n    new ffd20.applications.EntrySelector(this.object, options).render(true);\n  }\n\n  _onEntryControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const key = a.closest(\".notes\").dataset.name;\n\n    if (a.classList.contains(\"add-entry\")) {\n      const notes = deepClone(getProperty(this.object.data, key) ?? []);\n      const updateData = { [key]: notes.concat(\"\") };\n      return this._onSubmit(event, { updateData });\n    } else if (a.classList.contains(\"delete-entry\")) {\n      const index = a.closest(\".entry\").dataset.index;\n      const notes = deepClone(getProperty(this.object.data, key));\n      notes.splice(index, 1);\n\n      const updateData = {};\n      updateData[key] = notes;\n      return this._onSubmit(event, { updateData });\n    }\n  }\n\n  async _onConditionalControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Add new conditional\n    if (a.classList.contains(\"add-conditional\")) {\n      await this._onSubmit(event); // Submit any unsaved changes\n      return ffd20.components.ItemConditional.create([{}], { parent: this.object });\n    }\n\n    // Remove a conditional\n    if (a.classList.contains(\"delete-conditional\")) {\n      await this._onSubmit(event); // Submit any unsaved changes\n      const li = a.closest(\".conditional\");\n      const conditional = this.object.conditionals.get(li.dataset.conditional);\n      return conditional.delete();\n    }\n\n    // Add a new conditional modifier\n    if (a.classList.contains(\"add-conditional-modifier\")) {\n      await this._onSubmit(event);\n      const li = a.closest(\".conditional\");\n      const conditional = this.object.conditionals.get(li.dataset.conditional);\n      return ffd20.components.ItemConditionalModifier.create([{}], { parent: conditional });\n    }\n\n    // Remove a conditional modifier\n    if (a.classList.contains(\"delete-conditional-modifier\")) {\n      await this._onSubmit(event);\n      const li = a.closest(\".conditional-modifier\");\n      const conditional = this.object.conditionals.get(li.dataset.conditional);\n      const modifier = conditional.modifiers.get(li.dataset.modifier);\n      return modifier.delete();\n    }\n  }\n\n  /**\n   * Add or remove a damage part from the damage formula\n   *\n   * @param {Event} event     The original click event\n   * @returns {Promise}\n   * @private\n   */\n  async _onDamageControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n    const list = a.closest(\".damage\");\n    const k = list.dataset.key || \"damage.parts\";\n    const k2 = k.split(\".\").slice(0, -1).join(\".\");\n    const k3 = k.split(\".\").slice(-1).join(\".\");\n\n    // Add new damage component\n    if (a.classList.contains(\"add-damage\")) {\n      // Get initial data\n      const damageTypeBase = ffd20.components.ItemAction.defaultDamageType;\n      const initialData = [\"\", damageTypeBase];\n\n      // Add data\n      const damage = getProperty(this.action.data, k2);\n      const updateData = {};\n      updateData[k] = getProperty(damage, k3).concat([initialData]);\n      return this._onSubmit(event, { updateData });\n    }\n\n    // Remove a damage component\n    if (a.classList.contains(\"delete-damage\")) {\n      const li = a.closest(\".damage-part\");\n      const damage = deepClone(getProperty(this.action.data, k2));\n      getProperty(damage, k3).splice(Number(li.dataset.damagePart), 1);\n      const updateData = {};\n      updateData[k] = getProperty(damage, k3);\n      return this._onSubmit(event, { updateData });\n    }\n  }\n\n  async _onClickDamageType(event) {\n    event.preventDefault();\n    const clickedElement = event.currentTarget;\n\n    // Check for normal damage part\n    const damageIndex = clickedElement.closest(\".damage-part\")?.dataset.damagePart;\n    const damagePart = clickedElement.closest(\".damage\")?.dataset.key;\n    if (damageIndex != null && damagePart != null) {\n      const app = new ffd20.applications.DamageTypeSelector(\n        this.object,\n        `${damagePart}.${damageIndex}.1`,\n        getProperty(this.object.data, damagePart)[0][1]\n      );\n      return app.render(true);\n    }\n\n    // Check for conditional\n    const conditionalElement = clickedElement.closest(\".conditional\");\n    const modifierElement = clickedElement.closest(\".conditional-modifier\");\n    if (conditionalElement && modifierElement) {\n      const conditional = this.object.conditionals.get(conditionalElement.dataset.conditional);\n      const modifier = conditional.modifiers.get(modifierElement.dataset.modifier);\n      const app = new ffd20.applications.DamageTypeSelector(modifier, \"damageType\", modifier.data.damageType);\n      return app.render(true);\n    }\n  }\n\n  async _onAttackControl(event) {\n    event.preventDefault();\n    const a = event.currentTarget;\n\n    // Add new attack component\n    if (a.classList.contains(\"add-attack\")) {\n      const attackParts = this.action.data.attackParts;\n      return this._onSubmit(event, { updateData: { attackParts: attackParts.concat([[\"\", \"\"]]) } });\n    }\n\n    // Remove an attack component\n    if (a.classList.contains(\"delete-attack\")) {\n      const li = a.closest(\".attack-part\");\n      const attackParts = deepClone(this.action.data.attackParts);\n      attackParts.splice(Number(li.dataset.attackPart), 1);\n      return this._onSubmit(event, { updateData: { attackParts: attackParts } });\n    }\n  }\n\n  async _onFilePickerAlt(event) {\n    const button = event.currentTarget;\n    const attr = button.dataset.for;\n    const current = getProperty(this.item.data, attr);\n    const form = button.form;\n    const targetField = form[attr];\n    if (!targetField) return;\n\n    const fp = new FilePicker({\n      type: button.dataset.type,\n      current: current,\n      callback: (path) => {\n        targetField.value = path;\n        if (this.options.submitOnChange) {\n          this._onSubmit(event);\n        }\n      },\n      top: this.position.top + 40,\n      left: this.position.left + 10,\n    });\n    fp.browse(current);\n  }\n\n  async _onEditImage(event) {\n    event.preventDefault();\n    const filePicker = new FilePicker({\n      type: \"image\",\n      current: this.action.data.img,\n      callback: async (path) => {\n        await this.action.update({ img: path });\n        return this.render();\n      },\n    });\n    filePicker.render();\n  }\n\n  async _onTextAreaDrop(event) {\n    event.preventDefault();\n    const data = JSON.parse(event.originalEvent.dataTransfer.getData(\"text/plain\"));\n    if (!data) return;\n\n    const elem = event.currentTarget;\n    let link;\n\n    // Case 1 - Document from Compendium Pack\n    if (data.pack) {\n      const pack = game.packs.get(data.pack);\n      if (!pack) return;\n      const doc = await pack.getDocument(data.id);\n      link = `@Compendium[${data.pack}.${data.id}]{${doc.name}}`;\n    }\n\n    // Case 2 - Document from World\n    else {\n      const config = CONFIG[data.type];\n      if (!config) return false;\n      const doc = config.collection.instance.get(data.id);\n      if (!doc) return false;\n      link = `@${data.type}[${doc._id}]{${doc.name}}`;\n    }\n\n    // Insert link\n    if (link) {\n      elem.value = !elem.value ? link : elem.value + \"\\n\" + link;\n    }\n    return this._onSubmit(event);\n  }\n\n  async _updateObject(event, formData) {\n    // Handle conditionals array\n    const conditionalData = deepClone(this.object.data.conditionals);\n    Object.entries(formData)\n      .filter((o) => o[0].startsWith(\"conditionals\"))\n      .forEach((o) => {\n        let reResult;\n        // Handle conditional modifier\n        if ((reResult = o[0].match(/^conditionals.([0-9]+).modifiers.([0-9]+).(.+)$/))) {\n          const conditionalIdx = parseInt(reResult[1]);\n          const modifierIdx = parseInt(reResult[2]);\n          const conditional =\n            conditionalData[conditionalIdx] ?? deepClone(this.object.data.conditionals[conditionalIdx]);\n          const path = reResult[3];\n          setProperty(conditional.modifiers[modifierIdx], path, o[1]);\n        }\n        // Handle conditional\n        else if ((reResult = o[0].match(/^conditionals.([0-9]+).(.+)$/))) {\n          const conditionalIdx = parseInt(reResult[1]);\n          const conditional =\n            conditionalData[conditionalIdx] ?? deepClone(this.object.data.conditionals[conditionalIdx]);\n          const path = reResult[2];\n          setProperty(conditional, path, o[1]);\n        }\n      });\n    formData[\"conditionals\"] = conditionalData;\n\n    formData = expandObject(formData);\n    return this.action.update(formData);\n  }\n\n  async close(options) {\n    delete this.item.apps[this.appId];\n    delete this.action.apps[this.appId];\n    this.action.sheet = null;\n    return super.close(options);\n  }\n}\n","import { keepUpdateArray } from \"../utils/lib.mjs\";\n\nexport class ItemConditional {\n  constructor(data, parent) {\n    this.data = data;\n    this.parent = parent;\n\n    this.prepareData();\n  }\n\n  static async create(data, context = {}) {\n    const { parent } = context;\n\n    if (parent instanceof ffd20.components.ItemAction) {\n      // Prepare data\n      data = data.map((dataObj) => mergeObject(this.defaultData, dataObj));\n      const newConditionalData = deepClone(parent.data.conditionals || []);\n      newConditionalData.push(...data);\n\n      // Update parent\n      await parent.update({ conditionals: newConditionalData });\n\n      // Return results\n      return data.map((o) => parent.conditionals.get(o._id));\n    }\n\n    return [];\n  }\n\n  static get defaultData() {\n    return {\n      _id: randomID(16),\n      default: false,\n      name: \"\",\n      modifiers: [],\n    };\n  }\n\n  get id() {\n    return this.data._id;\n  }\n\n  prepareData() {\n    // Update modifiers\n    if (this.data.modifiers instanceof Array) {\n      this.modifiers = this._prepareModifiers(this.data.modifiers);\n    }\n  }\n\n  _prepareModifiers(modifiers) {\n    const prior = this.modifiers;\n    const collection = new Collection();\n    for (const o of modifiers) {\n      let modifier = null;\n      if (prior && prior.has(o._id)) {\n        modifier = prior.get(o._id);\n        modifier.data = o;\n        modifier.prepareData();\n      } else modifier = new ffd20.components.ItemConditionalModifier(o, this);\n      collection.set(o._id || modifier.data._id, modifier);\n    }\n    return collection;\n  }\n\n  async update(updateData, options = {}) {\n    const idx = this.parent.data.conditionals.indexOf(this.data);\n    const prevData = deepClone(this.data);\n    const newUpdateData = flattenObject(mergeObject(prevData, updateData));\n\n    // Make sure modifiers remain in an array\n    keepUpdateArray(this.data, newUpdateData, \"modifiers\");\n\n    if (options.dryRun) return newUpdateData;\n    await this.parent.update({ [`conditionals.${idx}`]: expandObject(newUpdateData) });\n  }\n\n  async delete() {\n    const conditionals = foundry.utils.deepClone(this.parent.data.conditionals);\n    conditionals.findSplice((c) => c._id === this.id);\n    return this.parent.update({ conditionals });\n  }\n}\n\nexport class ItemConditionalModifier {\n  constructor(data, parent) {\n    this.data = data;\n    this.parent = parent;\n\n    this.prepareData();\n  }\n\n  static async create(data, context = {}) {\n    const { parent } = context;\n\n    if (parent instanceof ffd20.components.ItemConditional) {\n      // Prepare data\n      data = data.map((dataObj) => mergeObject(this.defaultData, dataObj));\n      const newConditionalModifierData = deepClone(parent.data.modifiers || []);\n      newConditionalModifierData.push(...data);\n\n      // Update parent\n      await parent.update({ modifiers: newConditionalModifierData });\n\n      // Return results\n      return data.map((o) => parent.modifiers.get(o._id));\n    }\n\n    return [];\n  }\n\n  static get defaultData() {\n    return {\n      _id: randomID(16),\n      formula: \"\",\n      target: \"\",\n      subTarget: \"\",\n      type: \"\",\n      damageType: ffd20.components.ItemAction.defaultDamageType,\n      critical: \"\",\n    };\n  }\n\n  get id() {\n    return this.data._id;\n  }\n\n  prepareData() {}\n\n  async update(updateData, options = {}) {\n    const idx = this.parent.data.modifiers.indexOf(this.data);\n    const prevData = deepClone(this.data);\n    const newUpdateData = flattenObject(mergeObject(prevData, updateData));\n\n    if (options.dryRun) return newUpdateData;\n    await this.parent.update({ [`modifiers.${idx}`]: expandObject(newUpdateData) });\n  }\n\n  async delete() {\n    const idx = this.parent.data.modifiers.indexOf(this.data);\n    if (idx < 0) throw new Error(`Modifier not found in parent ${this.parent.name}`);\n\n    const modifiers = duplicate(this.parent.data.modifiers);\n    modifiers.splice(idx, 1);\n    return this.parent.update({ modifiers });\n  }\n}\n","import { getSkipActionPrompt } from \"../documents/settings.mjs\";\n\nexport class ActionChooser extends Application {\n  /**\n   * @param {ItemFFD20} item - The item for which to choose an attack\n   * @param {any} [options]\n   */\n  constructor(item, options = {}) {\n    super(options);\n\n    this.item = item;\n  }\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      template: \"systems/ffd20/templates/apps/action-chooser.hbs\",\n      classes: [\"ffd20\", \"action-chooser\"],\n      width: 400,\n    });\n  }\n  get title() {\n    return game.i18n.format(\"FFD20.Application.ActionChooser.Title\", {\n      actor: this.item.parentActor.name ?? \"\",\n      item: this.item.name,\n    });\n  }\n\n  async getData(options) {\n    const result = await super.getData(options);\n\n    result.item = this.item.toObject();\n    result.actions = this.item.system.actions;\n\n    return result;\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.find(\".action\").on(\"click\", this._onClickAction.bind(this));\n  }\n\n  _onClickAction(event) {\n    event.preventDefault();\n\n    const id = event.currentTarget.dataset?.action;\n    this.item.use({ actionID: id, skipDialog: getSkipActionPrompt() });\n    this.close();\n  }\n}\n","/**\n * The Base Registry class, providing shared functionality for all registries in the system.\n *\n * @abstract\n * @template {BaseRegistryObject} ContentClass\n * @template {BaseRegistryObjectData} ContentData\n * @augments {foundry.utils.Collection<ContentClass>}\n */\nexport class BaseRegistry extends foundry.utils.Collection {\n  /**\n   * The class each of this registry's content is expected to be an instance of.\n   *\n   * @type {typeof ContentClass}\n   */\n  static contentClass = null;\n\n  /**\n   * An array of data used to initialise this registry.\n   *\n   * @type {ContentData[]} An array of data used to initialise this registry.\n   * @private\n   */\n  static _defaultData = [];\n\n  /**\n   * @param {ContentData[]} data - An array of data from which {@link ContentClass} instances will be created\n   */\n  constructor(data = []) {\n    super();\n    this._initialize(data);\n  }\n\n  /**\n   * The name of the registry\n   *\n   * @type {string}\n   */\n  get name() {\n    return this.constructor.name;\n  }\n\n  /**\n   * The class each of this registry's content is expected to be an instance of.\n   *\n   * @type {ContentClass}\n   */\n  get contentClass() {\n    return this.constructor.contentClass;\n  }\n\n  /**\n   * The name of the class this registry is for.\n   *\n   * @type {string}\n   */\n  get contentName() {\n    return this.contentClass.typeName;\n  }\n\n  /**\n   * Initializes the registry with the data provided in the constructor.\n   *\n   * @private\n   */\n  _initialize() {\n    this.clear();\n    for (const element of this.constructor._defaultData) {\n      let content;\n      try {\n        content = new this.contentClass(element);\n        super.set(content.id, content);\n      } catch (error) {\n        console.error(error);\n      }\n    }\n\n    // Allow modules to register their own content\n    Hooks.callAll(`ffd20.register${this.name}`, this, this.contentClass);\n  }\n\n  /**\n   * Sets the value of a key in the registry.\n   *\n   * @param {string} id - ID of the value to set.\n   * @param {ContentClass} content - The value to set.\n   * @returns {BaseRegistry} The registry itself, after the value has been set.\n   */\n  set(id, content) {\n    const cls = this.contentClass;\n    if (!(content instanceof cls)) {\n      throw new Error(`Registry '${this.contentName}' can only register ${cls.typeName}`);\n    }\n    return super.set(id, content);\n  }\n\n  /**\n   * Registers a new instance of {@link ContentClass} with the registry, using a partial of its data as the base.\n   *\n   * @param {string} module - The module for which this value is registered.\n   * @param {string} id - The unique key of the value.\n   * @param {ContentData} value - A {@link Partial} of the data to use as the base for the new value.\n   * @returns {BaseRegistry} The registry itself, after the value has been registered.\n   */\n  register(module, id, value) {\n    if (!module) throw new Error(\"Registering requires a module name\");\n    if (this.has(id)) {\n      throw new Error(`Registry '${this.contentName}' already has a key '${id}'`);\n    }\n    return this.set(id, new this.contentClass({ module, _id: id, ...value }));\n  }\n\n  /**\n   * Unregisters a value from the registry, or if no id is provided, all values belonging to the module.\n   *\n   * @param {string} module - The module for which this value is unregistered.\n   * @param {string} [id] - The unique key of the value, or `undefined` to unregister all values belonging to the module.\n   */\n  unregister(module, id) {\n    if (!module) throw new Error(\"Unregistering requires a module name\");\n    if (id) {\n      if (this.find((e) => e.data.module === module && e.id === id)) {\n        this.delete(id);\n      }\n    } else {\n      const ids = this.filter((e) => e.data.module === module).map((e) => e.id);\n      for (const id of ids) {\n        this.delete(id);\n      }\n    }\n  }\n\n  /**\n   * Returns the contents of this registry as object, using ids as keys.\n   *\n   * @param {string} [key] - Property of {@link ContentClass} (which should resolve to a string)\n   * to be used as key. Defaults to `id`.\n   * @param {boolean} [dataOnly] - If `true`, only the data of the content will be returned.\n   * Defaults to `true`.\n   * @returns {Record<string, ContentData>} The data of each value in the registry, by id\n   */\n  toRecord(key = \"id\", dataOnly = true) {\n    return this.reduce((acc, registryObject) => {\n      const keyValue = getProperty(registryObject, key);\n      acc[keyValue] = dataOnly ? registryObject.data : registryObject;\n      return acc;\n    }, {});\n  }\n}\n\n/**\n * The basic interface other registry objects are based on.\n *\n * @typedef {object} BaseRegistryObjectData\n * @property {string} _id - The unique key of the value.\n * @property {string} name - The name of the value.\n * @property {object} flags - Additional flags for the value.\n * @property {string} [module] - The module for which this value is registered. Automatically assigned when using {@link BaseRegistry#register}.\n */\n\n/**\n * The Base Registry Object class, providing shared functionality for all registry objects in the system.\n *\n * @abstract\n */\nexport class BaseRegistryObject {\n  /**\n   * @param {Partial<BaseRegistryObjectData>} src - The data to use to create the registry object\n   */\n  constructor(src) {\n    this.data = foundry.utils.mergeObject(this.constructor._baseData, src);\n  }\n\n  static get _baseData() {\n    return {\n      _id: randomID(16),\n      name: `New ${this.constructor.name}`,\n      flags: {},\n    };\n  }\n\n  /**\n   * A name describing the type of this kind of registry objects.\n   *\n   * @type {string}\n   */\n  static get typeName() {\n    throw new Error(\"A class extending BaseRegistryObject must implement typeName\");\n  }\n\n  /**\n   * The unique key of the registry object.\n   *\n   * @type {string}\n   */\n  get id() {\n    return this.data._id;\n  }\n\n  /**\n   * The name of the registry object.\n   *\n   * @type {string}\n   */\n  get name() {\n    return this.data.name;\n  }\n\n  /**\n   * Returns a copy of the raw data of the registry object.\n   *\n   * @returns {object} The raw data of the registry object.\n   */\n  toJSON() {\n    const data = deepClone(this.data);\n    if (\"module\" in data) delete data.module;\n    return data;\n  }\n}\n","import { BaseRegistry, BaseRegistryObject } from \"./base-registry.mjs\";\n\nexport class DamageType extends BaseRegistryObject {\n  /** @inheritdoc */\n  static typeName = \"Damage Type\";\n\n  /** @inheritdoc */\n  static get _baseData() {\n    return foundry.utils.mergeObject(super._baseData, {\n      img: \"\",\n      icon: \"\",\n      color: \"black\",\n      category: \"misc\",\n    });\n  }\n\n  get isModifier() {\n    return this.data.flags?.modifier === true;\n  }\n}\n\nexport class DamageTypes extends BaseRegistry {\n  /** @inheritdoc */\n  static contentClass = DamageType;\n  //** add missing damage types here for ffd20 TODO  */\n  /** @inheritdoc */\n  static _defaultData = [\n    {\n      _id: \"untyped\",\n      name: \"FFD20.DamageTypeUntyped\",\n      icon: \"ra ra-uncertainty\",\n      category: \"misc\",\n    },\n    {\n      _id: \"slashing\",\n      name: \"FFD20.DamageTypeSlashing\",\n      icon: \"ra ra-sword\",\n      color: \"yellow\",\n      category: \"physical\",\n    },\n    {\n      _id: \"piercing\",\n      name: \"FFD20.DamageTypePiercing\",\n      icon: \"ra ra-spear-head\",\n      color: \"blue\",\n      category: \"physical\",\n    },\n    {\n      _id: \"bludgeoning\",\n      name: \"FFD20.DamageTypeBludgeoning\",\n      icon: \"ra ra-large-hammer\",\n      color: \"red\",\n      category: \"physical\",\n    },\n    {\n      _id: \"fire\",\n      name: \"FFD20.DamageTypeFire\",\n      icon: \"ra ra-fire\",\n      color: \"orange\",\n      category: \"energy\",\n    },\n    {\n      _id: \"ice\",\n      name: \"FFD20.DamageTypeIce\",\n      icon: \"ra ra-frost-emblem\",\n      color: \"aqua\",\n      category: \"energy\",\n    },\n    {\n      _id: \"wind\",\n      name: \"FFD20.DamageTypeWind\",\n      icon: \"ra ra-slash-ring\",\n      color: \"#04e0ce\",\n      category: \"energy\",\n    },\n    {\n      _id: \"earth\",\n      name: \"FFD20.DamageTypeEarth\",\n      icon: \"ra ra-groundbreaker\",\n      color: \"#664a02\",\n      category: \"energy\",\n    },\n    {\n      _id: \"lightning\",\n      name: \"FFD20.DamageTypeLightning\",\n      icon: \"ra ra-lightning-bolt\",\n      color: \"yellow\",\n      category: \"energy\",\n    },\n    {\n      _id: \"water\",\n      name: \"FFD20.DamageTypeWater\",\n      icon: \"ra ra-droplet\",\n      color: \"blue\",\n      category: \"energy\",\n    },\n    {\n      _id: \"light\",\n      name: \"FFD20.DamageTypeLight\",\n      icon: \"ra ra-sunbeams\",\n      color: \"#defffc\",\n      category: \"energy\",\n    },\n    {\n      _id: \"dark\",\n      name: \"FFD20.DamageTypeDark\",\n      icon: \"ra ra-skull\",\n      color: \"#765898\",\n      category: \"energy\",\n    },\n    {\n      _id: \"nonelemental\",\n      name: \"FFD20.DamageTypeNonElemental\",\n      icon: \"ra ra-doubled\",\n      color: \"#a200ff\",\n      category: \"energy\",\n    },\n    {\n      _id: \"precision\",\n      name: \"FFD20.Precision\",\n      icon: \"ra ra-archery-target\",\n      flags: {\n        modifier: true,\n      },\n    },\n    {\n      _id: \"nonlethal\",\n      name: \"FFD20.Nonlethal\",\n      icon: \"ra ra-hand\",\n      flags: {\n        modifier: true,\n      },\n    },\n  ].map((d) => ({ ...d, module: \"ffd20\" }));\n}\n\nexport const damageTypes = new DamageTypes();\n","import { BaseRegistry, BaseRegistryObject } from \"./base-registry.mjs\";\n\nexport class ScriptCall extends BaseRegistryObject {\n  /** @inheritdoc */\n  static typeName = \"Script Call\";\n\n  /** @inheritdoc */\n  static get _baseData() {\n    return mergeObject(super._baseData, {\n      itemTypes: [],\n      name: null,\n      info: null,\n    });\n  }\n}\n\nexport class ScriptCalls extends BaseRegistry {\n  /** @inheritdoc */\n  static contentClass = ScriptCall;\n\n  /** @inheritdoc */\n  static _defaultData = [\n    // Use\n    {\n      _id: \"use\",\n      itemTypes: [\"attack\", \"feat\", \"equipment\", \"consumable\", \"spell\", \"weapon\"],\n      name: \"FFD20.ScriptCalls.Use.Name\",\n      info: \"FFD20.ScriptCalls.Use.Info\",\n    },\n    // Equip\n    {\n      _id: \"equip\",\n      itemTypes: [\"weapon\", \"equipment\", \"loot\"],\n      name: \"FFD20.ScriptCalls.Equip.Name\",\n      info: \"FFD20.ScriptCalls.Equip.Info\",\n    },\n    // Toggle\n    {\n      _id: \"toggle\",\n      itemTypes: [\"buff\", \"feat\"],\n      name: \"FFD20.ScriptCalls.Toggle.Name\",\n      info: \"FFD20.ScriptCalls.Toggle.Info\",\n    },\n    // Change Quantity\n    {\n      _id: \"changeQuantity\",\n      itemTypes: [\"loot\", \"equipment\", \"weapon\", \"consumable\", \"container\"],\n      name: \"FFD20.ScriptCalls.ChangeQuantity.Name\",\n      info: \"FFD20.ScriptCalls.ChangeQuantity.Info\",\n    },\n    // Change Level\n    {\n      _id: \"changeLevel\",\n      itemTypes: [\"buff\", \"class\"],\n      name: \"FFD20.ScriptCalls.ChangeLevel.Name\",\n      info: \"FFD20.ScriptCalls.ChangeLevel.Info\",\n    },\n  ].map((d) => ({ ...d, module: \"ffd20\" }));\n}\n\nexport const scriptCalls = new ScriptCalls();\n","import { LinkFunctions as LinksApp } from \"../utils/links.mjs\";\n\nexport class LinkOptions extends FormApplication {\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      id: \"link-options\",\n      classes: [\"ffd20\"],\n      title: game.i18n.localize(\"FFD20.LinkOptionsTitle\"),\n      template: \"systems/ffd20/templates/apps/link-options.hbs\",\n      width: 320,\n      height: \"auto\",\n      submitOnClose: true,\n      closeOnSubmit: true,\n    });\n  }\n\n  getData() {\n    const e = this.object;\n\n    const linkTypes = LinksApp.getLinkTypes(e.source(), e.target());\n    const linkTypesObj = linkTypes.reduce((cur, o) => {\n      cur[o] = `Link_${o}`;\n      return cur;\n    }, {});\n\n    const options = this._getLinkTypeCommandOptions(e, linkTypes[0]);\n    const result = {\n      linkTypes: linkTypesObj,\n      options: options,\n      isNumber: options != null && options.type === \"number\",\n      isString: options != null && options.type === \"string\",\n    };\n\n    return result;\n  }\n\n  /**\n   * @typedef CommandOptions\n   * @type {object}\n   * @property {string} type             - Either \"number\" or \"string\".\n   * @property {number} [min]            - A minimum value for numbers.\n   * @property {number} [max]            - A maximum value for numbers.\n   * @property {string} title            - The title for the dialog.\n   * @property {string|number} [initial] - The initial value.\n   * @param {object} e           - The edge connecting two nodes.\n   * @param {string} defaultType - The default type if `e` has no type yet.\n   * @returns {CommandOptions} The resulting options.\n   */\n  _getLinkTypeCommandOptions(e, defaultType) {\n    const type = e.data(\"type\") || defaultType;\n\n    if (type === \"minLevel\") {\n      return {\n        type: \"number\",\n        min: 1,\n        max: 20,\n        initial: e.data(\"value\") || 1,\n      };\n    }\n\n    return null;\n  }\n}\n","export class DetectionModeInvisibilityFFD20 extends DetectionModeInvisibility {\n  static ID = \"seeInvisibility\";\n  static LABEL = \"DETECTION.SeeInvisibility\";\n  static PRIORITY = 100000;\n\n  /** @override */\n  _testPoint(visionSource, mode, target, test) {\n    if (!this._testLOS(visionSource, mode, target, test)) return false;\n    if (this._testRange(visionSource, mode, target, test)) return true;\n    for (const lightSource of canvas.effects.lightSources.values()) {\n      if (!lightSource.active || lightSource.disabled) continue;\n      if (lightSource.los.contains(test.point.x, test.point.y)) return true;\n    }\n    return false;\n  }\n}\n\nexport class DetectionModeBlindSenseFFD20 extends DetectionMode {\n  static ID = \"blindSense\";\n  static LABEL = \"FFD20.SenseBSense\";\n  static DETECTION_TYPE = DetectionMode.DETECTION_TYPES.OTHER;\n  static PRIORITY = 200100;\n\n  constructor(data = {}, ...args) {\n    data.walls = false;\n    super(data, ...args);\n  }\n\n  /** @override */\n  static getDetectionFilter() {\n    return (this._detectionFilter ??= OutlineOverlayFilter.create({\n      outlineColor: [0, 0.33, 0.6, 1],\n      knockout: false,\n      wave: this.ID === \"blindSense\",\n    }));\n  }\n\n  /** @override */\n  _canDetect(visionSource, target) {\n    return true;\n  }\n}\n\nexport class DetectionModeBlindSightFFD20 extends DetectionModeBlindSenseFFD20 {\n  static ID = \"blindSight\";\n  static LABEL = \"FFD20.SenseBS\";\n  static DETECTION_TYPE = DetectionMode.DETECTION_TYPES.OTHER;\n  static PRIORITY = 200000;\n\n  /** @override */\n  static getDetectionFilter() {\n    return (this._detectionFilter ??= OutlineOverlayFilter.create({\n      outlineColor: [0, 0.33, 0.6, 1],\n      knockout: false,\n      wave: false,\n    }));\n  }\n}\n\nexport class DetectionModeTremorFFD20 extends DetectionModeTremor {\n  static ID = \"feelTremor\";\n  static LABEL = \"DETECTION.FeelTremor\";\n  static DETECTION_TYPE = DetectionMode.DETECTION_TYPES.MOVE;\n  static PRIORITY = 201000;\n\n  constructor(data = {}, ...args) {\n    data.walls = false;\n    super(data, ...args);\n  }\n}\n","/**\n * Returns the result of a roll of die, which changes based on different sizes.\n *\n * @param {number} origCount - The original number of die to roll.\n * @param {number} origSides - The original number of sides per die to roll.\n * @param {string|number} [targetSize=\"M\"] - The target size to change the die to.\n *   Can be a string of values \"F\", \"D\", \"T\", \"S\", \"M\", \"L\", \"H\", \"G\" or \"C\" for the different sizes.\n *   Can also be a number in the range of -4 to 4, where 0 is Medium.\n * @param {string|number} [initialSize=\"M\"] - The initial size of the creature. See targetSize above.\n * @returns {number} The result of the new roll.\n */\nexport const sizeRoll = function (origCount, origSides, targetSize = \"M\", initialSize = \"M\") {\n  const _getSizeIndex = function (size) {\n    if (typeof size === \"string\") return Object.values(CONFIG.FFD20.sizeChart).indexOf(size.toUpperCase());\n    return size;\n  };\n  targetSize = _getSizeIndex(targetSize);\n  initialSize = _getSizeIndex(initialSize);\n  let skipWarning = false;\n\n  // D10 special rule: https://paizo.com/paizo/faq/v5748nruor1fm#v5748eaic9t3f\n  if (origCount > 1 && origSides === 10 && (origCount % 2 === 0 || origCount === 3)) {\n    skipWarning = true;\n    const d10Arr = [\n      { orig: [2, 10], larger: [4, 8], smaller: [2, 8] },\n      { orig: [3, 10], larger: [6, 8], smaller: [3, 8] },\n      { orig: [4, 10], larger: [8, 8], smaller: [4, 8] },\n      { orig: [6, 10], larger: [12, 8], smaller: [6, 8] },\n      { orig: [8, 10], larger: [16, 8], smaller: [8, 8] },\n    ];\n    for (const v of d10Arr) {\n      if (v.orig[0] === origCount && v.orig[1] === origSides) {\n        if (targetSize < initialSize) {\n          initialSize--;\n          origCount = v.smaller[0];\n          origSides = v.smaller[1];\n        } else if (targetSize > initialSize) {\n          initialSize++;\n          origCount = v.larger[0];\n          origSides = v.larger[1];\n        }\n      }\n    }\n  }\n\n  // Get initial die type\n  const mediumDie = `${origCount}d${origSides}`;\n  const mediumDieMax = origCount * origSides;\n  let c = duplicate(CONFIG.FFD20.sizeDie);\n  {\n    if (c.indexOf(mediumDie) === -1) {\n      c = c.map((d) => {\n        if (d.match(/^([0-9]+)d([0-9]+)$/)) {\n          const dieCount = parseInt(RegExp.$1);\n          const dieSides = parseInt(RegExp.$2);\n          const dieMaxValue = dieCount * dieSides;\n\n          if (dieMaxValue === mediumDieMax) return mediumDie;\n        }\n\n        return d;\n      });\n    }\n  }\n\n  // Pick an index from the chart\n  let index = c.indexOf(mediumDie),\n    formula = mediumDie;\n  if (index >= 0) {\n    const d6Index = c.indexOf(\"1d6\");\n    let d8Index = c.indexOf(\"1d8\");\n    if (d8Index === -1) d8Index = c.indexOf(\"2d4\");\n    let sizeOffset = initialSize - targetSize;\n    let curSize = initialSize;\n\n    // When decreasing in size (e.g. from medium to small)\n    while (sizeOffset > 0) {\n      if (curSize <= 4 || index <= d8Index) {\n        index--;\n        sizeOffset--;\n        curSize--;\n      } else {\n        index -= 2;\n        sizeOffset--;\n        curSize--;\n      }\n    }\n    // When increasing in size (e.g. from medium to large)\n    while (sizeOffset < 0) {\n      if (curSize <= 3 || index <= d6Index) {\n        index++;\n        sizeOffset++;\n        curSize++;\n      } else {\n        index += 2;\n        sizeOffset++;\n        curSize++;\n      }\n    }\n\n    index = Math.max(0, Math.min(c.length - 1, index));\n    formula = c[index];\n  }\n\n  if (index === -1 && !skipWarning) {\n    const msg = game.i18n.localize(\"FFD20.WarningNoSizeDie\").format(mediumDie, formula);\n    console.warn(msg);\n    ui.notifications.warn(msg);\n  }\n\n  const result = formula.split(\"d\");\n  if (result.length === 1) {\n    return [new NumericTerm({ number: parseInt(result[0]) })];\n  }\n  return [new Die({ number: parseInt(result[0]), faces: parseInt(result[1]) })];\n};\n\nexport const sizeReach = function (size = \"M\", reach = false, stature = \"tall\") {\n  if (typeof size === \"number\") size = Object.values(CONFIG.FFD20.sizeChart)[size];\n  size = Object.entries(CONFIG.FFD20.sizeChart).find((o) => o[1] === size)[0];\n\n  return [\n    new NumericTerm({\n      number: CONFIG.Actor.documentClasses.default.getReach(size, stature)[reach ? \"reach\" : \"melee\"],\n    }),\n  ];\n};\n","/* eslint-disable no-case-declarations */\n/**\n * The Final Fantasy d20 based in Pathfinder 1st edition game system for Foundry Virtual Tabletop\n * Main Author: Furyspark\n * Adapted by: Ritsu Voices\n * Software License: GNU GPLv3\n */\n\n// Import Modules\nimport { FFD20 } from \"./module/config.mjs\";\nimport {\n  registerSystemSettings,\n  registerClientSettings,\n  migrateSystemSettings,\n  getSkipActionPrompt,\n} from \"./module/documents/settings.mjs\";\nimport { preloadHandlebarsTemplates } from \"./module/utils/handlebars/templates.mjs\";\nimport { registerHandlebarsHelpers } from \"./module/utils/handlebars/helpers.mjs\";\nimport { tinyMCEInit } from \"./module/mce/mce.mjs\";\nimport { measureDistances, getConditions } from \"./module/utils/canvas.mjs\";\nimport { TemplateLayerFFD20 } from \"./module/canvas/measure.mjs\";\nimport { MeasuredTemplateFFD20 } from \"./module/canvas/measure.mjs\";\nimport { ActorBaseFFD20 } from \"./module/documents/actor/actor-base.mjs\";\nimport { ActorFFD20 } from \"./module/documents/actor/actor-ffd20.mjs\";\nimport { ActorCharacterFFD20 } from \"./module/documents/actor/actor-character.mjs\";\nimport { ActorNPCFFD20 } from \"./module/documents/actor/actor-npc.mjs\";\nimport { BasicActorFFD20 } from \"./module/documents/actor/actor-basic.mjs\";\nimport { ActorSheetFFD20 } from \"./module/applications/actor/actor-sheet.mjs\";\nimport { ActorSheetFFD20Character } from \"./module/applications/actor/character-sheet.mjs\";\nimport { ActorSheetFFD20NPC } from \"./module/applications/actor/npc-sheet.mjs\";\nimport { ActorSheetFFD20NPCLite } from \"./module/applications/actor/npc-lite-sheet.mjs\";\nimport { ActorSheetFFD20NPCLoot } from \"./module/applications/actor/npc-loot-sheet.mjs\";\nimport { ActorSheetFFD20Basic } from \"./module/applications/actor/basic-sheet.mjs\";\nimport { ActorSheetFlags } from \"./module/applications/actor/actor-flags.mjs\";\nimport { ActorRestDialog } from \"./module/applications/actor/actor-rest.mjs\";\nimport { SensesSelector } from \"./module/applications/senses-selector.mjs\";\nimport { SkillEditor } from \"./module/applications/skill-editor.mjs\";\nimport { CombatFFD20 } from \"./module/documents/combat.mjs\";\nimport { TokenFFD20 } from \"./module/canvas/token.mjs\";\nimport { TokenDocumentFFD20 } from \"./module/documents/token.mjs\";\nimport { EntrySelector } from \"./module/applications/entry-selector.mjs\";\nimport { LevelUpForm } from \"./module/applications/level-up.mjs\";\nimport { PointBuyCalculator } from \"./module/applications/point-buy-calculator.mjs\";\nimport { ScriptEditor } from \"./module/applications/script-editor.mjs\";\nimport { SidebarFFD20 } from \"./module/applications/sidebar.mjs\";\nimport { ActorTraitSelector } from \"./module/applications/trait-selector.mjs\";\nimport { ExperienceDistributor } from \"./module/applications/xp-distributor.mjs\";\nimport { DamageTypeSelector } from \"./module/applications/damage-type-selector.mjs\";\nimport { ActiveEffectFFD20 } from \"./module/documents/active-effect.mjs\";\nimport { ItemFFD20 } from \"./module/documents/item/item-ffd20.mjs\";\nimport { ItemAttackFFD20 } from \"./module/documents/item/item-attack.mjs\";\nimport { ItemBuffFFD20 } from \"./module/documents/item/item-buff.mjs\";\nimport { ItemClassFFD20 } from \"./module/documents/item/item-class.mjs\";\nimport { ItemConsumableFFD20 } from \"./module/documents/item/item-consumable.mjs\";\nimport { ItemContainerFFD20 } from \"./module/documents/item/item-container.mjs\";\nimport { ItemEquipmentFFD20 } from \"./module/documents/item/item-equipment.mjs\";\nimport { ItemFeatFFD20 } from \"./module/documents/item/item-feat.mjs\";\nimport { ItemLootFFD20 } from \"./module/documents/item/item-loot.mjs\";\nimport { ItemRaceFFD20 } from \"./module/documents/item/item-race.mjs\";\nimport { ItemSpellFFD20 } from \"./module/documents/item/item-spell.mjs\";\nimport { ItemWeaponFFD20 } from \"./module/documents/item/item-weapon.mjs\";\nimport { ItemBaseFFD20 } from \"./module/documents/item/item-base.mjs\";\nimport { ItemSheetFFD20 } from \"./module/applications/item/item-sheet.mjs\";\nimport { ItemSheetFFD20_Container } from \"./module/applications/item/container-sheet.mjs\";\nimport { getChangeFlat, getSourceInfo } from \"./module/documents/actor/utils/apply-changes.mjs\";\nimport { CompendiumDirectoryFFD20 } from \"./module/compendium-directory.mjs\";\nimport { CompendiumBrowser, initializeCompendiumBrowsers } from \"./module/applications/compendium-browser.mjs\";\nimport \"./module/patch-core.mjs\";\nimport { DiceFFD20 } from \"./module/dice/dice.mjs\";\nimport { RollFFD20 } from \"./module/dice/roll.mjs\";\nimport { AbilityTemplate } from \"./module/canvas/ability-template.mjs\";\nimport { AttackDialog } from \"./module/applications/attack-dialog.mjs\";\nimport {\n  getItemOwner,\n  getActorFromId,\n  createTag,\n  measureDistance,\n  convertWeight,\n  convertWeightBack,\n  convertDistance,\n  convertDistanceBack,\n  getBuffTargets,\n  getBuffTargetDictionary,\n  binarySearch,\n  sortArrayByName,\n  findInCompendia,\n  getFirstActiveGM,\n  isMinimumCoreVersion,\n  refreshActors,\n  diffObjectAndArray,\n  moduleToObject,\n} from \"./module/utils/lib.mjs\";\nimport { getAbilityModifier } from \"@utils\";\nimport { ChatMessageFFD20, customRolls } from \"./module/documents/chat-message.mjs\";\nimport { ChatAttack } from \"./module/action-use/chat-attack.mjs\";\nimport { TokenQuickActions } from \"./module/canvas/token-quick-actions.mjs\";\nimport { initializeSocket } from \"./module/socket.mjs\";\nimport { SemanticVersion } from \"./module/utils/semver.mjs\";\nimport { ChangeLogWindow } from \"./module/applications/change-log.mjs\";\nimport { HelpBrowserFFD20 } from \"./module/applications/help-browser.mjs\";\nimport { addReachListeners } from \"./module/canvas/attack-reach.mjs\";\nimport { TooltipFFD20 } from \"./module/applications/tooltip.mjs\";\nimport { dialogGetNumber, dialogGetActor } from \"./module/utils/dialog.mjs\";\nimport * as chat from \"./module/utils/chat.mjs\";\nimport * as migrations from \"./module/migration.mjs\";\nimport * as macros from \"./module/documents/macros.mjs\";\nimport * as controls from \"./module/documents/controls.mjs\";\nimport * as ItemAttack from \"./module/action-use/action-use.mjs\";\nimport { addLowLightVisionToLightConfig, addLowLightVisionToTokenConfig } from \"./module/canvas/low-light-vision.mjs\";\nimport { initializeModules } from \"./module/modules.mjs\";\nimport { ItemChange } from \"./module/components/change.mjs\";\nimport { ItemScriptCall } from \"./module/components/script-call.mjs\";\nimport { ItemAction } from \"./module/components/action.mjs\";\nimport { ItemActionSheet } from \"./module/applications/component/action-sheet.mjs\";\nimport { ItemConditional, ItemConditionalModifier } from \"./module/components/conditionals.mjs\";\nimport { ActionChooser } from \"./module/applications/action-chooser.mjs\";\nimport { Widget_CategorizedItemPicker } from \"./module/applications/categorized-item-picker.mjs\";\nimport { CurrencyTransfer } from \"./module/applications/currency-transfer.mjs\";\nimport { BaseRegistry } from \"./module/registry/base-registry.mjs\";\nimport { DamageTypes } from \"./module/registry/damage-types.mjs\";\nimport { ScriptCalls } from \"./module/registry/script-call.mjs\";\nimport { callOldNamespaceHookAll } from \"@utils/hooks.mjs\";\n\nimport \"./less/ffd20.less\";\nimport \"./module/hmr.mjs\";\n\n// New API\nimport * as applications from \"./module/applications/_module.mjs\";\nimport * as documents from \"./module/documents/_module.mjs\";\nimport * as actionUse from \"./module/action-use/_module.mjs\"; // TODO: Change dir name?\nimport * as _canvas from \"./module/canvas/_module.mjs\";\nimport * as dice from \"./module/dice/_module.mjs\";\nimport * as components from \"./module/components/_module.mjs\";\nimport * as utils from \"./module/utils/_module.mjs\";\nimport * as registry from \"./module/registry/_module.mjs\";\nimport * as rollPreProcess from \"./module/utils/roll-preprocess.mjs\";\n\n// ESM exports, to be kept in sync with globalThis.ffd20\nexport {\n  actionUse,\n  applications,\n  _canvas as canvas,\n  components,\n  FFD20 as config,\n  dice,\n  documents,\n  migrations,\n  registry,\n  utils,\n};\n\nglobalThis.ffd20 = moduleToObject({\n  actionUse,\n  applications,\n  canvas: _canvas,\n  components,\n  config: FFD20,\n  dice,\n  documents,\n  migrations,\n  registry,\n  tooltip: null,\n  utils,\n});\n\n// OBSOLETE: Add String.format\nif (!String.prototype.format) {\n  /**\n   * Replaces `{<number>}` elements in this string with the provided arguments.\n   *\n   * @deprecated\n   * @param {string[]} args - The arguments to replace the `{<number>}` elements with.\n   * @returns {string} String with `{<number>}` elements replaced.\n   */\n  String.prototype.format = function (...args) {\n    return this.replace(/{(\\d+)}/g, function (match, number) {\n      return args[number] != null ? args[number] : match;\n    });\n  };\n}\n\n/* -------------------------------------------- */\n/*  Foundry VTT Initialization                  */\n/* -------------------------------------------- */\nHooks.once(\"init\", function () {\n  console.log(`FFD20 | Initializing Final Fantasy D20 System`);\n\n  // Redirect notifications to console before Notifications is ready\n  ui.notifications = { info: console.log, warn: console.warn, error: console.error };\n\n  // Register client settings\n  registerClientSettings();\n\n  // Create a FFD20 namespace within the game global\n  const oldFFD20 = {\n    polymorphism: { ActorBaseFFD20, ItemBaseFFD20 },\n    documents: { ActorFFD20, ItemFFD20, TokenDocumentFFD20 },\n    get entities() {\n      // OBSOLETION WARNING\n      console.error(\"game.ffd20.entities is obsolete; please use game.ffd20.documents instead.\");\n      return this.documents;\n    },\n    applications: {\n      // Actors\n      ActorSheetFFD20,\n      ActorSheetFFD20Character,\n      ActorSheetFFD20NPC,\n      ActorSheetFFD20NPCLite,\n      ActorSheetFFD20NPCLoot,\n      // Items\n      ItemSheetFFD20,\n      ItemSheetFFD20_Container,\n      // Document Components\n      ItemActionSheet,\n      // Misc\n      AttackDialog,\n      ActorSheetFlags,\n      ActorRestDialog,\n      ActorTraitSelector,\n      SensesSelector,\n      CompendiumDirectoryFFD20,\n      CompendiumBrowser,\n      EntrySelector,\n      LevelUpForm,\n      PointBuyCalculator,\n      ScriptEditor,\n      SidebarFFD20,\n      TooltipFFD20,\n      HelpBrowserFFD20,\n      ExperienceDistributor,\n      SkillEditor,\n      DamageTypeSelector,\n      ActionChooser,\n      // Widgets\n      Widget_CategorizedItemPicker,\n      CurrencyTransfer,\n    },\n    compendiums: applications.compendiums,\n    // Rolling\n    DiceFFD20,\n    rollPreProcess: {\n      ...rollPreProcess,\n    },\n    //Chat\n    chat: {\n      ChatAttack,\n      ChatMessageFFD20,\n      events: { targetACClick: chat.targetACClick, targetSavingThrowClick: chat.targetSavingThrowClick },\n    },\n    // Utility\n    utils: {\n      createTag,\n      getItemOwner,\n      getActorFromId,\n      getAbilityModifier,\n      getChangeFlat,\n      getSourceInfo,\n      convertDistance,\n      convertDistanceBack,\n      convertWeight,\n      convertWeightBack,\n      measureDistance,\n      measureDistances,\n      measureReachDistance(p0, p1, alt = false) {\n        // OBSOLETE: Wrapper for compatibility with old. Remove later.\n        console.warn(\n          'measureReachDistance is obsolete, please use measureDistance with diagonalRule set to \"555\" instead'\n        );\n        return measureDistance(p0, p1, { diagonalRule: alt ? \"555\" : \"5105\" });\n      },\n      dialogGetActor,\n      dialogGetNumber,\n      SemanticVersion,\n      isMinimumCoreVersion,\n      binarySearch,\n      sortArrayByName,\n      findInCompendia,\n      getFirstActiveGM,\n      refreshActors,\n      diffObjectAndArray,\n    },\n    // Components\n    documentComponents: {\n      ItemChange,\n      ItemAction,\n      ItemConditional,\n      ItemConditionalModifier,\n      ItemScriptCall,\n    },\n    // API\n    baseRegistry: BaseRegistry,\n    damageTypes: new DamageTypes(),\n    scriptCalls: new ScriptCalls(),\n    // Macros\n    macros,\n    rollItemMacro: macros.rollItemMacro,\n    rollSkillMacro: macros.rollSkillMacro,\n    rollSaveMacro: macros.rollSaveMacro,\n    rollDefenses: macros.rollDefenses,\n    rollActorAttributeMacro: macros.rollActorAttributeMacro,\n    // Migrations\n    migrations,\n    migrateWorld: migrations.migrateWorld,\n    get isMigrating() {\n      return ffd20.migrations.isMigrating;\n    },\n    // Misc\n    config: FFD20,\n    tooltip: null,\n    AbilityTemplate,\n    ItemAttack: { ...ItemAttack },\n    controls,\n    // Variables controlled by control configuration\n    skipConfirmPrompt: false,\n    tokenTooltip: {\n      get hide() {\n        console.warn(\"game.ffd20.tokenTooltip.hide is obsolete. Use ffd20.tooltip.forceHide instead.\");\n        return ffd20.tooltip.forceHide;\n      },\n      set hide(value) {\n        console.warn(\"game.ffd20.tokenTooltip.hide is obsolete. Use ffd20.tooltip.forceHide instead.\");\n        ffd20.tooltip.forceHide = value;\n      },\n      get hideGMInfo() {\n        console.warn(\"game.ffd20.tokenTooltip.hideGMInfo is obsolete. Use ffd20.tooltip.forceHideGMInfo instead.\");\n        return ffd20.tooltip.forceHideGMInfo;\n      },\n      set hideGMInfo(value) {\n        console.warn(\"game.ffd20.tokenTooltip.hideGMInfo is obsolete. Use ffd20.tooltip.forceHideGMInfo instead.\");\n        ffd20.tooltip.forceHideGMInfo = value;\n      },\n    },\n    forceShowItem: false,\n    // Function library\n    functions: {\n      getBuffTargets,\n      getBuffTargetDictionary,\n    },\n    // Singleton instance of the help browser\n    helpBrowser: new HelpBrowserFFD20(),\n  };\n  game.ffd20 = new Proxy(oldFFD20, {\n    get(obj, property) {\n      foundry.utils.logCompatibilityWarning(\n        [\n          \"You are accessing game.ffd20, which will be restructured to match globalThis.ffd20 in the future.\",\n          `Please check whether ${property} and its contents are still available, or use globalThis.ffd20 instead.`,\n        ].join(\"\\n\"),\n        { since: \"FFD20 0.82.0\", until: \"FFD20 0.83.0\" }\n      );\n      return Reflect.get(obj, property);\n    },\n    set(obj, property, value) {\n      foundry.utils.logCompatibilityWarning(\n        [\n          \"You are accessing game.ffd20, which will be restructured to match globalThis.ffd20 in the future.\",\n          `Please check whether ${property} and its contents are still available, or use globalThis.ffd20 instead.`,\n        ].join(\"\\n\"),\n        { since: \"FFD20 0.82.0\", until: \"FFD20 0.83.0\" }\n      );\n      return Reflect.set(obj, property, value);\n    },\n  });\n\n  // Global exports\n  globalThis.RollFFD20 = RollFFD20;\n\n  // Record Configuration Values\n  CONFIG.FFD20 = FFD20;\n  CONFIG.Canvas.layers.templates.layerClass = TemplateLayerFFD20;\n  CONFIG.MeasuredTemplate.objectClass = MeasuredTemplateFFD20;\n  CONFIG.MeasuredTemplate.defaults.angle = 90; // FFD20 uses 90 degree angles\n  CONFIG.Actor.documentClass = ActorBaseFFD20;\n  CONFIG.Actor.documentClasses = {\n    default: ActorFFD20, // fallback\n    // Specific types\n    character: ActorCharacterFFD20,\n    npc: ActorNPCFFD20,\n    basic: BasicActorFFD20,\n  };\n  CONFIG.Token.documentClass = TokenDocumentFFD20;\n  CONFIG.Token.objectClass = TokenFFD20;\n  CONFIG.ActiveEffect.documentClass = ActiveEffectFFD20;\n  CONFIG.Item.documentClass = ItemBaseFFD20;\n  CONFIG.Item.documentClasses = {\n    default: ItemFFD20, // Fallback\n    // Specific types\n    attack: ItemAttackFFD20,\n    buff: ItemBuffFFD20,\n    class: ItemClassFFD20,\n    consumable: ItemConsumableFFD20,\n    container: ItemContainerFFD20,\n    equipment: ItemEquipmentFFD20,\n    feat: ItemFeatFFD20,\n    loot: ItemLootFFD20,\n    race: ItemRaceFFD20,\n    spell: ItemSpellFFD20,\n    weapon: ItemWeaponFFD20,\n    // etc.\n  };\n  CONFIG.Combat.documentClass = CombatFFD20;\n  CONFIG.ui.compendium = CompendiumDirectoryFFD20;\n  CONFIG.ChatMessage.documentClass = ChatMessageFFD20;\n  CONFIG.Dice.rolls.splice(0, 0, dice.RollFFD20);\n  CONFIG.Dice.RollFFD20 = dice.RollFFD20;\n  CONFIG.Dice.rolls.push(dice.D20RollFFD20);\n  CONFIG.Dice.rolls.D20RollFFD20 = dice.D20RollFFD20;\n\n  CONFIG.time.roundTime = 6;\n\n  // Register System Settings\n  registerSystemSettings();\n\n  //Calculate conditions for world\n  CONFIG.statusEffects = getConditions();\n\n  // Preload Handlebars Templates\n  preloadHandlebarsTemplates();\n  registerHandlebarsHelpers();\n\n  // Register sheet application classes\n  Actors.unregisterSheet(\"core\", ActorSheet);\n  Actors.registerSheet(\"ffd20\", ActorSheetFFD20Character, {\n    label: \"FFD20.Sheet.PC\",\n    types: [\"character\"],\n    makeDefault: true,\n  });\n  Actors.registerSheet(\"ffd20\", ActorSheetFFD20NPC, { label: \"FFD20.Sheet.NPC\", types: [\"npc\"], makeDefault: true });\n  Actors.registerSheet(\"ffd20\", ActorSheetFFD20NPCLite, { label: \"FFD20.Sheet.NPCLite\", types: [\"npc\"], makeDefault: false });\n  Actors.registerSheet(\"ffd20\", ActorSheetFFD20NPCLoot, { label: \"FFD20.Sheet.NPCLoot\", types: [\"npc\"], makeDefault: false });\n  Actors.registerSheet(\"ffd20\", ActorSheetFFD20Basic, { label: \"FFD20.Sheet.Basic\", types: [\"basic\"], makeDefault: true });\n  Items.unregisterSheet(\"core\", ItemSheet);\n  Items.registerSheet(\"ffd20\", ItemSheetFFD20, {\n    label: \"FFD20.Sheet.Item\",\n    types: [\"class\", \"feat\", \"spell\", \"consumable\", \"equipment\", \"loot\", \"weapon\", \"buff\", \"attack\", \"race\"],\n    makeDefault: true,\n  });\n  Items.registerSheet(\"ffd20\", ItemSheetFFD20_Container, {\n    label: \"FFD20.Sheet.Container\",\n    types: [\"container\"],\n    makeDefault: true,\n  });\n\n  // Alter configuration\n  CONFIG.specialStatusEffects.BLIND = \"ffd20_blind\";\n\n  // Register detection modes\n  for (const mode of Object.values(ffd20.canvas.detectionModes)) {\n    CONFIG.Canvas.detectionModes[mode.ID] = new mode({\n      id: mode.ID,\n      label: mode.LABEL,\n      type: mode.DETECTION_TYPE || DetectionMode.DETECTION_TYPES.SIGHT,\n    });\n  }\n\n  // Initialize socket listener\n  initializeSocket();\n\n  // Initialize module integrations\n  initializeModules();\n\n  // Call post-init hook\n  callOldNamespaceHookAll(\"ffd20.postInit\", \"ffd20PostInit\");\n  Hooks.callAll(\"ffd20PostInit\");\n});\n\n// Load Quench test in development environment\nif (import.meta.env.DEV) {\n  await import(\"./module/test/index.mjs\");\n}\n\n/* -------------------------------------------- */\n/*  Foundry VTT Setup                           */\n/* -------------------------------------------- */\n\n/**\n * This function runs after game data has been requested and loaded from the servers, so documents exist\n */\nHooks.once(\"setup\", function () {\n  // Localize CONFIG objects once up-front\n  const toLocalize = [\n    \"abilities\",\n    \"abilitiesShort\",\n    \"alignments\",\n    \"currencies\",\n    \"distanceUnits\",\n    \"itemActionTypes\",\n    \"senses\",\n    \"skills\",\n    \"targetTypes\",\n    \"timePeriods\",\n    \"timePeriodsShort\",\n    \"savingThrows\",\n    \"ac\",\n    \"acValueLabels\",\n    \"featTypes\",\n    \"featTypesPlurals\",\n    \"conditions\",\n    \"lootTypes\",\n    \"flyManeuverabilities\",\n    \"abilityTypes\",\n    \"spellPreparationModes\",\n    \"weaponGroups\",\n    \"weaponTypes\",\n    \"weaponProperties\",\n    \"spellComponents\",\n    \"spellSchools\",\n    \"multiSchools\",\n    \"spellLevels\",\n    \"conditionTypes\",\n    \"favouredClassBonuses\",\n    \"armorProficiencies\",\n    \"weaponProficiencies\",\n    \"actorSizes\",\n    \"abilityActivationTypes\",\n    \"abilityActivationTypesPlurals\",\n    \"limitedUsePeriods\",\n    \"equipmentTypes\",\n    \"equipmentSlots\",\n    \"consumableTypes\",\n    \"attackTypes\",\n    \"buffTypes\",\n    // \"buffTargets\",\n    // \"contextNoteTargets\",\n    \"healingTypes\",\n    \"divineFocus\",\n    \"classSavingThrows\",\n    \"classBAB\",\n    \"classTypes\",\n    \"measureTemplateTypes\",\n    \"creatureTypes\",\n    \"measureUnits\",\n    \"measureUnitsShort\",\n    \"languages\",\n    \"weaponHoldTypes\",\n    \"auraStrengths\",\n    \"conditionalTargets\",\n    \"bonusModifiers\",\n    \"abilityActivationTypes_unchained\",\n    \"abilityActivationTypesPlurals_unchained\",\n    \"actorStatures\",\n    \"ammoTypes\",\n    \"classBaseMPTypes\",\n    \"classSubTypes\",\n    \"classBaseMPauto\",\n    \"classCastingStats\",\n    \"countforexp\",\n    \"materiaAdvancement\",\n    \"materiaRarity\",\n  ];\n\n  // Config (sub-)objects to be sorted\n  const toSort = [\n    // \"buffTargets\",\n    // \"buffTargets.misc\",\n    // \"contextNoteTargets\",\n    // \"contextNoteTargets.misc\",\n    \"skills\",\n    \"conditions\",\n    \"conditionTypes\",\n    \"consumableTypes\",\n    \"creatureTypes\",\n    \"featTypes\",\n    \"weaponProperties\",\n    \"spellSchools\",\n    \"languages\",\n    \"multiSchools\",\n  ];\n\n  /**\n   * Helper function to recursively localize object entries\n   *\n   * @param {object} obj - The object to be localized\n   * @param {string} cat - The object's name\n   * @returns {object} The localized object\n   */\n  const doLocalize = (obj, cat) => {\n    // Create tuples of (key, localized object/string)\n    const localized = Object.entries(obj).reduce((arr, e) => {\n      if (typeof e[1] === \"string\") arr.push([e[0], game.i18n.localize(e[1])]);\n      else if (typeof e[1] === \"object\") arr.push([e[0], doLocalize(e[1], `${cat}.${e[0]}`)]);\n      return arr;\n    }, []);\n    if (toSort.includes(cat)) {\n      // Sort simple strings, fall back to sorting by label for objects/categories\n      localized.sort((a, b) => {\n        const localA = typeof a?.[1] === \"string\" ? a[1] : a[1]?._label;\n        const localB = typeof b?.[1] === \"string\" ? b[1] : b[1]?._label;\n        // Move misc to bottom of every list\n        if (a[0] === \"misc\") return 1;\n        else if (b[0] === \"misc\") return -1;\n        // Regular sorting of localized strings\n        return localA.localeCompare(localB);\n      });\n    }\n    // Get the localized and sorted object out of tuple\n    return localized.reduce((obj, e) => {\n      obj[e[0]] = e[1];\n      return obj;\n    }, {});\n  };\n\n  // Localize and sort CONFIG objects\n  for (const o of toLocalize) {\n    CONFIG.FFD20[o] = doLocalize(CONFIG.FFD20[o], o);\n  }\n\n  // Localize buff targets\n  const localizeLabels = [\"buffTargets\", \"buffTargetCategories\", \"contextNoteTargets\", \"contextNoteCategories\"];\n  for (const l of localizeLabels) {\n    for (const [k, v] of Object.entries(CONFIG.FFD20[l])) {\n      CONFIG.FFD20[l][k].label = game.i18n.localize(v.label);\n    }\n  }\n\n  // TinyMCE variables and commands\n  tinyMCEInit();\n\n  // Register controls\n  controls.registerSystemControls();\n\n  callOldNamespaceHookAll(\"ffd20.postSetup\", \"ffd20PostSetup\");\n  Hooks.callAll(\"ffd20PostSetup\");\n});\n\n/* -------------------------------------------- */\n\n/**\n * Once the entire VTT framework is initialized, check to see if we should perform a data migration\n */\nHooks.once(\"ready\", async function () {\n  // Create tooltip\n  const ttconf = game.settings.get(\"ffd20\", \"tooltipConfig\");\n  const ttwconf = game.settings.get(\"ffd20\", \"tooltipWorldConfig\");\n  if (!ttconf.disable && !ttwconf.disable) TooltipFFD20.toggle(true);\n\n  window.addEventListener(\"resize\", () => {\n    ffd20.tooltip?.setPosition();\n  });\n\n  // Migrate data\n  const NEEDS_MIGRATION_VERSION = \"9.2.1\";\n  let PREVIOUS_MIGRATION_VERSION = game.settings.get(\"ffd20\", \"systemMigrationVersion\");\n  if (typeof PREVIOUS_MIGRATION_VERSION === \"number\") {\n    PREVIOUS_MIGRATION_VERSION = PREVIOUS_MIGRATION_VERSION.toString() + \".0\";\n  } else if (\n    typeof PREVIOUS_MIGRATION_VERSION === \"string\" &&\n    PREVIOUS_MIGRATION_VERSION.match(/^([0-9]+)\\.([0-9]+)$/)\n  ) {\n    PREVIOUS_MIGRATION_VERSION = `${PREVIOUS_MIGRATION_VERSION}.0`;\n  }\n  const needMigration = SemanticVersion.fromString(NEEDS_MIGRATION_VERSION).isHigherThan(\n    SemanticVersion.fromString(PREVIOUS_MIGRATION_VERSION)\n  );\n  if (needMigration && game.user.isGM) {\n    await migrations.migrateWorld();\n  }\n\n  // Migrate system settings\n  await migrateSystemSettings();\n\n  // Populate `ffd20.applications.compendiums`\n  initializeCompendiumBrowsers();\n\n  // Show changelog\n  if (!game.settings.get(\"ffd20\", \"dontShowChangelog\")) {\n    const v = game.settings.get(\"ffd20\", \"changelogVersion\") || \"0.0.1\";\n    const changelogVersion = SemanticVersion.fromString(v);\n    const curVersion = SemanticVersion.fromString(game.system.version);\n\n    if (curVersion.isHigherThan(changelogVersion)) {\n      const app = new ChangeLogWindow(changelogVersion);\n      app.render(true, { focus: true });\n      game.settings.set(\"ffd20\", \"changelogVersion\", curVersion.toString());\n    }\n  }\n\n  callOldNamespaceHookAll(\"ffd20.postReady\", \"ffd20PostReady\");\n  Hooks.callAll(\"ffd20PostReady\");\n});\n\n/* -------------------------------------------- */\n/*  Canvas Initialization                       */\n/* -------------------------------------------- */\n\nHooks.on(\"canvasInit\", function () {\n  // Extend Diagonal Measurement\n  canvas.grid.diagonalRule = game.settings.get(\"ffd20\", \"diagonalMovement\");\n  SquareGrid.prototype.measureDistances = measureDistances;\n});\n\n/* -------------------------------------------- */\n/*  Other Hooks                                 */\n/* -------------------------------------------- */\n\nHooks.on(\"renderChatMessage\", (app, html, data) => {\n  // Hide roll info\n  chat.hideRollInfo(app, html, data);\n\n  // Hide GM sensitive info\n  chat.hideGMSensitiveInfo(app, html, data);\n\n  // Hide non-visible targets for players\n  if (!game.user.isGM) chat.hideInvisibleTargets(app, html);\n\n  // Create target callbacks\n  chat.addTargetCallbacks(app, html);\n\n  // Alter target defense options\n  chat.alterTargetDefense(app, html);\n\n  // Optionally collapse the content\n  if (game.settings.get(\"ffd20\", \"autoCollapseItemCards\")) html.find(\".card-content\").hide();\n\n  // Optionally hide chat buttons\n  if (game.settings.get(\"ffd20\", \"hideChatButtons\")) html.find(\".card-buttons\").hide();\n\n  // Apply accessibility settings to chat message\n  chat.applyAccessibilitySettings(app, html, data, game.settings.get(\"ffd20\", \"accessibilityConfig\"));\n\n  // Alter chat card title color\n  chat.addChatCardTitleGradient(app, html, data);\n\n  // Alter ammo recovery options\n  chat.alterAmmoRecovery(app, html);\n\n  // Handle chat tooltips\n  html.find(\".tooltip\").on(\"mousemove\", (ev) => handleChatTooltips(ev));\n});\n\nHooks.on(\"renderChatPopout\", (app, html, data) => {\n  // Optionally collapse the content\n  if (game.settings.get(\"ffd20\", \"autoCollapseItemCards\")) html.find(\".card-content\").hide();\n\n  // Optionally hide chat buttons\n  if (game.settings.get(\"ffd20\", \"hideChatButtons\")) html.find(\".card-buttons\").hide();\n});\n\nHooks.on(\"renderChatLog\", (_, html) => ItemFFD20.chatListeners(html));\nHooks.on(\"renderChatLog\", (_, html) => ActorFFD20.chatListeners(html));\nHooks.on(\"renderChatLog\", (_, html) => addReachListeners(html));\n\nHooks.on(\"renderChatPopout\", (_, html) => ItemFFD20.chatListeners(html));\nHooks.on(\"renderChatPopout\", (_, html) => ActorFFD20.chatListeners(html));\n\nHooks.on(\"renderAmbientLightConfig\", (app, html) => {\n  addLowLightVisionToLightConfig(app, html);\n});\n\nHooks.on(\"renderTokenHUD\", (app, html, data) => {\n  TokenQuickActions.addTop3Attacks(app, html, data);\n});\n\nHooks.on(\"updateActor\", (actor, data, options, userId) => {\n  // Call hook for toggling conditions\n  {\n    const conditions = data.system?.attributes?.conditions || {};\n    for (const [k, v] of Object.entries(conditions)) {\n      callOldNamespaceHookAll(\"ffd20.toggleActorCondition\", \"ffd20ToggleActorCondition\", actor, k, v);\n      Hooks.callAll(\"ffd20ToggleActorCondition\", actor, k, v);\n    }\n  }\n});\n\nHooks.on(\"preCreateToken\", async (scene, token, options, userId) => {\n  const actor = game.actors.get(token.actorId);\n  if (!actor?._calcBuffActiveEffects) return; // Don't do anything for actors without this function (e.g. basic actors)\n  const buffTextures = Object.values(actor?._calcBuffActiveEffects() ?? []).map((b) => b.icon);\n  for (const icon of buffTextures) if (icon) await loadTexture(icon);\n});\n\nHooks.on(\"createToken\", (token, options, userId) => {\n  if (game.user.id !== userId) return;\n  // Re-associate imported Active Effects which are sourced to Items owned by this same Actor\n  if (token.actor.effects?.size) {\n    const updates = [];\n    for (const effect of token.actor.effects) {\n      if (!effect.origin) continue;\n      const effectItemId = effect.origin.match(/Item\\.(\\w+)/)?.pop();\n      const foundItem = token.actor.items.get(effectItemId);\n      if (foundItem) {\n        updates.push({ _id: effect.id, origin: foundItem.uuid });\n      }\n    }\n    token.actor.updateEmbeddedDocuments(\"ActiveEffect\", updates, { render: false });\n  }\n});\n\nHooks.on(\"preDeleteToken\", (token, options, userId) => {\n  // Hide token tooltip on token deletion\n  ffd20.tooltip?.unbind(token.object);\n});\n\nHooks.on(\"updateToken\", function (token, updateData, options, userId) {\n  // Hide token tooltip on token update\n  ffd20.tooltip?.unbind(token);\n\n  // Update token's actor sheet (if any)\n  token.actor?.sheet?.render();\n});\n\nHooks.on(\"createItem\", (item, options, userId) => {\n  const actor = item.parent instanceof ActorFFD20 ? item.parent : null;\n  if (userId !== game.user.id) return;\n\n  // Show buff if active\n  if (item.type === \"buff\" && getProperty(item, \"system.active\") === true) {\n    // Call hook\n    if (actor) {\n      callOldNamespaceHookAll(\"ffd20.toggleActorBuff\", \"ffd20ToggleActorBuff\", actor, item, true);\n      Hooks.callAll(\"ffd20ToggleActorBuff\", actor, item, true);\n    }\n\n    // Execute script calls\n    item.executeScriptCalls(\"toggle\", { state: true });\n  }\n  // Simulate toggling a feature on\n  if (item.type === \"feat\") {\n    const disabled = getProperty(item, \"system.disabled\");\n    if (disabled === false) {\n      item.executeScriptCalls(\"toggle\", { state: true });\n    }\n  }\n  // Simulate equipping items\n  {\n    const equipped = getProperty(item, \"system.equipped\");\n    if (equipped === true) {\n      item.executeScriptCalls(\"equip\", { equipped: true });\n    }\n  }\n  // Quantity change\n  {\n    const quantity = getProperty(item, \"system.quantity\");\n    if (typeof quantity === \"number\" && quantity > 0) {\n      item.executeScriptCalls(\"changeQuantity\", { quantity: { previous: 0, new: quantity } });\n    }\n  }\n});\n\nHooks.on(\"preDeleteItem\", (item, options, userId) => {\n  if (item.actor) {\n    // Remove linked children with item\n    const _getChildren = function (item) {\n      const result = [];\n      const itemLinks = getProperty(item, \"system.links\");\n      if (itemLinks) {\n        for (const [linkType, links] of Object.entries(itemLinks)) {\n          for (const link of links) {\n            if (linkType === \"children\") {\n              const child = item.actor.items.get(link.id);\n              result.push(link.id);\n              if (child) {\n                const childChildren = _getChildren(child);\n                result.push(...childChildren);\n              }\n            }\n          }\n        }\n      }\n      return result;\n    };\n\n    const children = _getChildren(item);\n    const toRemove = [item.id, ...children]\n      .reduce((cur, o) => {\n        if (!cur.includes(o)) cur.push(o);\n        return cur;\n      }, [])\n      .filter((o) => item.actor.items.has(o));\n\n    if (children.length > 0 && !options.handledChildren) {\n      CONFIG.Item.documentClass.deleteDocuments(toRemove, {\n        parent: item.actor,\n        handledChildren: true,\n      });\n      return false;\n    }\n  }\n});\n\nHooks.on(\"deleteItem\", async (item, options, userId) => {\n  if (userId !== game.user.id) return;\n  const actor = item.parent instanceof ActorFFD20 ? item.parent : null;\n\n  if (actor) {\n    // Remove links\n    const itemLinks = getProperty(item, \"system.links\");\n    if (itemLinks) {\n      for (const [linkType, links] of Object.entries(itemLinks)) {\n        for (const link of links) {\n          const item = actor.items.get(link.id);\n          const otherItemLinks = item?.links || {};\n          if (otherItemLinks[linkType]) {\n            delete otherItemLinks[linkType];\n          }\n        }\n      }\n    }\n\n    // Call buff removal hook\n    if (item.type === \"buff\" && getProperty(item, \"system.active\") === true) {\n      callOldNamespaceHookAll(\"ffd20.toggleActorBuff\", \"ffd20ToggleActorBuff\", actor, item, false);\n      Hooks.callAll(\"ffd20ToggleActorBuff\", actor, item, false);\n    }\n  }\n});\n\nHooks.on(\"updateItem\", async (item, changedData, options, userId) => {\n  if (userId !== game.user.id) return;\n  const actor = item.parent instanceof ActorFFD20 ? item.parent : null;\n\n  if (actor) {\n    // Toggle buff\n    if (item.type === \"buff\" && getProperty(changedData, \"system.active\") !== undefined) {\n      // Call hook\n      callOldNamespaceHookAll(\n        \"ffd20.toggleActorBuff\",\n        \"ffd20ToggleActorBuff\",\n        actor,\n        item,\n        getProperty(changedData, \"system.active\")\n      );\n      Hooks.callAll(\"ffd20ToggleActorBuff\", actor, item, getProperty(changedData, \"system.active\"));\n    }\n  }\n});\n\nHooks.on(\"chatMessage\", (log, message, chatData) => {\n  const result = customRolls(message, chatData.speaker);\n  return !result;\n});\n\nHooks.on(\"renderActorDirectory\", (app, html, data) => {\n  html.find(\"li.actor\").each((i, li) => {\n    li.addEventListener(\"drop\", CurrencyTransfer._directoryDrop.bind(undefined, li.getAttribute(\"data-document-id\")));\n  });\n});\n\nHooks.on(\"renderItemDirectory\", (app, html, data) => {\n  html.find(\"li.item\").each((i, li) => {\n    li.addEventListener(\"drop\", CurrencyTransfer._directoryDrop.bind(undefined, li.getAttribute(\"data-document-id\")));\n  });\n});\n\nHooks.on(\"dropActorSheetData\", (act, sheet, data) => {\n  if (data.type === \"Currency\") sheet._onDropCurrency(event, data);\n});\n\n/* -------------------------------------------- */\n/*  Hotbar Macros                               */\n/* -------------------------------------------- */\n\nHooks.on(\"hotbarDrop\", (bar, data, slot) => {\n  let macro;\n  if (data.type === \"Item\") macro = macros.createItemMacro(data, slot);\n  else if (data.type === \"skill\") macro = macros.createSkillMacro(data.skill, data.actor, slot);\n  else if (data.type === \"save\") macro = macros.createSaveMacro(data.altType, data.actor, slot);\n  else if ([\"defenses\", \"cmb\", \"concentration\", \"cl\", \"bab\"].includes(data.type))\n    macro = macros.createMiscActorMacro(data.type, data.actor, slot, data.altType);\n  else return true;\n\n  if (macro == null || macro instanceof Promise) return false;\n});\n\n// Render TokenConfig\nHooks.on(\"renderTokenConfig\", async (app, html) => {\n  const TokenData = foundry.data.TokenData;\n  // Add vision inputs\n  let object = app.object;\n  // Prototype token\n  if (object instanceof Actor) object = object.prototypeToken;\n\n  // Add static size checkbox\n  let newHTML = `<div class=\"form-group\"><label>${game.i18n.localize(\n    \"FFD20.StaticSize\"\n  )}</label><input type=\"checkbox\" name=\"flags.ffd20.staticSize\" data-dtype=\"Boolean\"`;\n  if (getProperty(object, \"flags.ffd20.staticSize\")) newHTML += \" checked\";\n  newHTML += \"/></div>\";\n  html.find('.tab[data-tab=\"appearance\"] > *:nth-child(3)').after(newHTML);\n\n  // Disable vision elements if custom vision is disabled\n  const enableCustomVision = getProperty(object, \"flags.ffd20.customVisionRules\") === true;\n  if (!enableCustomVision) {\n    const tabElem = html.find(`.tab[data-tab=\"vision\"]`);\n    tabElem.find(`input, select`).prop(\"disabled\", true);\n    tabElem.find(\"a\").unbind();\n  }\n  // Add custom vision checkbox\n  newHTML = `<div class=\"form-group\" title=\"${game.i18n.localize(\n    \"FFD20.CustomVisionRules.Description\"\n  )}\"><label>${game.i18n.localize(\n    \"FFD20.CustomVisionRules.Label\"\n  )}</label><input type=\"checkbox\" name=\"flags.ffd20.customVisionRules\" data-dtype=\"Boolean\"`;\n  if (enableCustomVision) newHTML += \" checked\";\n  newHTML += \"/></div>\";\n  html.find(`.tab[data-tab=\"vision\"]`).append(newHTML);\n  // Add listener for custom vision rules checkbox\n  html.find(`.tab[data-tab=\"vision\"] input[name=\"flags.ffd20.customVisionRules\"]`).on(\"change\", async (event) => {\n    await app._onSubmit(event, { preventClose: true });\n    return app.render();\n  });\n\n  // Add disable low-light vision checkbox\n  addLowLightVisionToTokenConfig(app, html);\n\n  // Resize windows\n  app.setPosition();\n});\n\n// Render Sidebar\nHooks.on(\"renderSidebarTab\", (app, html) => {\n  if (app instanceof Settings) {\n    // Add buttons\n    const chlogButton = $(`<button>${game.i18n.localize(\"FFD20.Changelog\")}</button>`);\n    const helpButton = $(`<button>${game.i18n.localize(\"FFD20.Help.Label\")}</button>`);\n    html\n      .find(\"#game-details\")\n      .after(\n        $(`<h2>${game.i18n.localize(\"FFD20.title\")}</h2>`),\n        $(\"<div id='ffd20-details'>\").append(chlogButton, helpButton)\n      );\n\n    chlogButton.click(() => {\n      const chlog = Object.values(ui.windows).find((o) => o.id == \"changelog\") ?? new ChangeLogWindow();\n      chlog.render(true, { focus: true });\n    });\n    helpButton.click(() => ffd20.applications.helpBrowser.openUrl(\"Help/Home\"));\n  }\n});\n\n// Add compendium sidebar context options\nHooks.on(\"getCompendiumDirectoryFFD20EntryContext\", (html, entryOptions) => {\n  // Add option to disable pack\n  entryOptions.push({\n    name: game.i18n.localize(\"FFD20.Disable\"),\n    icon: '<i class=\"fas fa-low-vision\"></i>',\n    callback: (li) => {\n      const pack = game.packs.get(li.data(\"pack\"));\n      const config = game.settings.get(\"core\", \"compendiumConfiguration\")[pack.collection];\n      const disabled = getProperty(config, \"ffd20.disabled\") === true;\n      pack.configure({ \"ffd20.disabled\": !disabled });\n    },\n  });\n});\n\n// Show experience distributor after combat\nHooks.on(\"deleteCombat\", (combat, options, userId) => {\n  const isGM = game.user.isGM;\n  const skipPrompt = getSkipActionPrompt();\n  const { disableExperienceTracking, openXpDistributor } = game.settings.get(\"ffd20\", \"experienceConfig\");\n  if (\n    isGM &&\n    !disableExperienceTracking &&\n    combat.started &&\n    ((openXpDistributor && !skipPrompt) || (!openXpDistributor && skipPrompt))\n  ) {\n    const combatants = combat.combatants.map((o) => o.actor);\n    const app = new ExperienceDistributor(combatants);\n\n    if (app.getCharacters().length > 0) {\n      app.render(true);\n    } else {\n      app.close();\n    }\n  }\n});\n\nHooks.on(\"controlToken\", () => {\n  // Refresh lighting to (un)apply low-light vision parameters to them\n  canvas.perception.update(\n    {\n      initializeLighting: true,\n    },\n    true\n  );\n});\n\n/* ------------------------------- */\n/* Expire active effects\n/* ------------------------------- */\n{\n  const expireFromTokens = function () {\n    if (getFirstActiveGM() === game.user) {\n      for (const t of canvas.tokens.placeables) {\n        // Skip tokens in combat to avoid too early expiration\n        if (t.combatant?.combat?.started) continue;\n        // Don't do anything for actors without this function (e.g. basic actors)\n        if (!t.actor?.expireActiveEffects) continue;\n        t.actor.expireActiveEffects();\n      }\n    }\n  };\n\n  // On game time change\n  Hooks.on(\"updateWorldTime\", () => {\n    expireFromTokens();\n  });\n\n  // On canvas render\n  Hooks.on(\"canvasReady\", () => {\n    expireFromTokens();\n  });\n}\n\n// Handle chat tooltips\nconst handleChatTooltips = function (event) {\n  const elem = $(event.currentTarget);\n  const rect = event.currentTarget.getBoundingClientRect();\n  // const x = event.pageX;\n  // const y = event.pageY;\n  const x = rect.x;\n  const y = rect.y;\n  const w = rect.width;\n  elem.find(\".tooltipcontent\").css(\"left\", `${x}px`).css(\"top\", `${y}px`).css(\"width\", `${w}px`);\n};\n\n/* ------------------------------- */\n/* Class exports                   */\n/* ------------------------------- */\n// Actor classes\nexport { ActorBaseFFD20, ActorFFD20, ActorCharacterFFD20, ActorNPCFFD20, BasicActorFFD20 };\n\n// Item classes\nexport {\n  ItemBaseFFD20,\n  ItemFFD20,\n  ItemAttackFFD20,\n  ItemBuffFFD20,\n  ItemClassFFD20,\n  ItemConsumableFFD20,\n  ItemContainerFFD20,\n  ItemEquipmentFFD20,\n  ItemFeatFFD20,\n  ItemLootFFD20,\n  ItemRaceFFD20,\n  ItemSpellFFD20,\n  ItemWeaponFFD20,\n};\n\n// Item component classes\nexport { ItemChange, ItemAction };\n\n// Actor sheets\nexport {\n  ActorSheetFFD20Basic,\n  ActorSheetFFD20,\n  ActorSheetFFD20Character,\n  ActorSheetFFD20NPCLite,\n  ActorSheetFFD20NPCLoot,\n  ActorSheetFFD20NPC,\n};\n\n// Item sheets\nexport { ItemSheetFFD20, ItemSheetFFD20_Container };\n\n// Item component sheets\nexport { ItemActionSheet };\n\n// Token\nexport { TokenFFD20, TokenDocumentFFD20 };\n\n// Chat Message\nexport { ChatMessageFFD20 };\n\n// Measured Template\nexport { MeasuredTemplateFFD20 };\n","import { convertDistance } from \"./utils/lib.mjs\";\n\n/**\n * Initialize module compatibility/integration code.\n *\n * Currently integrated modules:\n * - Drag Ruler\n */\nexport function initializeModules() {\n  // Drag Ruler\n  {\n    Hooks.once(\"dragRuler.ready\", (SpeedProvider) => {\n      const enhancedTerrain = game.modules.get(\"enhanced-terrain-layer\")?.active;\n\n      class ffd20SpeedProvider extends SpeedProvider {\n        get colors() {\n          return [\n            { id: \"walk\", default: 0x00ff00, name: \"SETTINGS.ffd20DragRulerWalk\" },\n            { id: \"dash\", default: 0xffff00, name: \"SETTINGS.ffd20DragRulerDash\" },\n            { id: \"run\", default: 0xff8000, name: \"SETTINGS.ffd20DragRulerRun\" },\n          ];\n        }\n\n        getRanges(token) {\n          const baseSpeed = convertDistance(this.getBaseSpeed(token))[0];\n          // Search through items for pieces of heavy armor that is equipped\n          const heavyArmor = token.actor.items.find(\n            (item) =>\n              item.data.type === \"equipment\" &&\n              item.data.equipmentType === \"armor\" &&\n              item.data.equipped &&\n              item.data.equipmentSubtype === \"heavyArmor\"\n          );\n          // Check for heavy load encumbrance\n          const heavyLoad = token.actor.data.attributes.encumbrance.level >= 2;\n\n          let runMultiplier = 4;\n          if (heavyArmor || heavyLoad) runMultiplier = 3;\n          return [\n            { range: baseSpeed, color: \"walk\" },\n            { range: baseSpeed * 2, color: \"dash\" },\n            { range: baseSpeed * runMultiplier, color: \"run\" },\n          ];\n        }\n\n        getBaseSpeed(token) {\n          const [y, x] = canvas.grid.grid.getGridPositionFromPixels(token.x, token.y);\n          const useElevation = this.getSetting(\"useElevation\");\n\n          if (useElevation && token.data.elevation > 0) {\n            const flySpeed = token.actor.data.attributes.speed.fly.total;\n            if (flySpeed > 0) {\n              return flySpeed;\n            }\n          }\n\n          if (\n            enhancedTerrain &&\n            canvas.terrain.terrainFromGrid(x, y).some((terrain) => terrain.data.environment === \"water\")\n          ) {\n            const swimSpeed = token.actor.data.attributes.speed.swim.total;\n            if (swimSpeed > 0) {\n              return swimSpeed;\n            }\n          }\n\n          if (useElevation && token.data.elevation < 0) {\n            const burrowSpeed = token.actor.data.attributes.speed.burrow.total;\n            if (burrowSpeed > 0) {\n              return burrowSpeed;\n            }\n          }\n\n          return token.actor.data.attributes.speed.land.total;\n        }\n\n        get settings() {\n          return [\n            {\n              id: \"useElevation\",\n              name: \"SETTINGS.ffd20DragRulerUseElevationName\",\n              hint: \"SETTINGS.ffd20DragRulerUseElevationHint\",\n              scope: \"world\",\n              type: Boolean,\n              default: true,\n            },\n          ];\n        }\n      }\n      dragRuler.registerSystem(\"ffd20\", ffd20SpeedProvider);\n    });\n  }\n}\n"],"names":["FFD20","re","traitSeparator","abilities","str","dex","con","int","wis","cha","abilitiesShort","abilityCost","levelAbilityScores","levelAbilityScoreFeature","img","name","data","description","value","featType","type","savingThrows","fort","ref","will","classTypes","base","prestige","npc","racial","mythic","classBAB","low","med","high","custom","classSavingThrows","classBABFormulas","classFractionalBABFormulas","classSavingThrowFormulas","classFractionalSavingThrowFormulas","goodSaveBonus","goodSave","favouredClassBonuses","hp","skill","alt","favouredClassBonusIcons","ac","normal","touch","flatFooted","acValueLabels","alignments","lg","ng","cg","ln","tn","cn","le","ne","ce","alignmentsShort","armorProficiencies","lgt","hvy","shl","twr","weaponProficiencies","sim","mar","exo","che","pow","abilityActivationTypes","passive","free","nonaction","swift","immediate","move","standard","full","attack","aoo","round","minute","hour","special","abilityActivationTypesPlurals","abilityActivationTypes_unchained","reaction","action","abilityActivationTypesPlurals_unchained","woundThresholdConditions","woundThresholdChangeTargets","divineFocus","measureTemplateTypes","cone","circle","ray","rect","actorSizes","fine","dim","tiny","sm","huge","grg","col","sizeChart","tokenSizes","w","h","scale","sizeMods","sizeSpecialMods","sizeFlyMods","sizeStealthMods","flyManeuverabilities","clumsy","poor","average","good","perfect","flyManeuverabilityValues","speedReduction","encumbranceLoads","encumbranceMultipliers","quadruped","itemTypes","equipment","weapon","loot","consumable","class","buff","spell","feat","itemActionTypes","mwak","rwak","msak","rsak","mcman","rcman","spellsave","save","heal","other","itemCapacityTypes","items","weight","limitedUsePeriods","single","unlimited","day","week","charges","equipmentTypes","armor","_label","lightArmor","mediumArmor","heavyArmor","shield","lightShield","heavyShield","towerShield","misc","wondrous","clothing","materia","ability","independent","summon","support","equipmentSlots","slotless","head","headband","eyes","shoulders","neck","chest","body","belt","wrists","hands","ring","feet","any","weaponarmor","armorShield","lootTypes","gear","ammo","tradeGoods","ammoTypes","arrow","bolt","repeatingBolt","slingBullet","gunBullet","dragoonBullet","dart","consumableTypes","potion","oil","poison","drug","alchContact","alchIngested","alchInhaled","scroll","wand","staff","attackTypes","natural","racialAbility","item","featTypes","classFeat","trait","template","featTypesPlurals","abilityTypes","ex","short","long","su","sp","currencies","pgil","gil","sgil","cgil","acTypes","bonusModifiers","untyped","untypedPerm","enh","dodge","inherent","deflection","morale","luck","sacred","insight","resist","profane","size","competence","circumstance","alchemical","penalty","stackingBonusModifiers","damageTypes","ffd20","registry","reduce","cur","o","id","game","i18n","localize","distanceUnits","none","personal","melee","reach","close","medium","ft","mi","spec","seeText","measureUnits","m","km","measureUnitsShort","actorStatures","tall","targetTypes","self","creature","ally","enemy","object","space","radius","sphere","cylinder","square","cube","line","wall","timePeriods","inst","turn","month","year","perm","timePeriodsShort","casterProgression","castsPerDay","prepared","Number","POSITIVE_INFINITY","spontaneous","hybrid","spellsPreparedPerDay","healingTypes","healing","temphp","senses","bs","bse","dv","ts","tr","ll","si","sid","sc","skills","acr","apr","blf","clm","crf","dip","dev","dis","dri","esc","fly","han","hea","kar","kdu","ken","kge","khi","klo","kna","kno","kpl","kre","kte","lin","nav","per","prf","pil","pro","rep","rid","sen","slt","spl","ste","sur","swm","umd","skillCompendiumEntries","arbitrarySkills","backgroundSkills","spellPreparationModes","atwill","classCasterType","astrologian","blackmage","bluemage","geomancer","illusionist","necromancer","summoner","timemage","whitemage","bard","cleric","redmage","scholar","darkpaladin","holyknight","magicAuraByLevel","power","level","auraStrengths","weaponTypes","simple","light","ranged","martial","exotic","chef","splash","weaponHoldTypes","oh","weaponGroups","axes","bladesHeavy","bladesLight","bows","crossbows","double","firearms","flails","hammers","monk","polearms","siegeEngines","spears","thrown","tribal","weaponProperties","blc","brc","dea","dst","dbl","fin","frg","grp","imp","mnk","nnl","rch","snd","thr","trp","spellComponents","V","S","T","E","M","F","DF","spellSchools","crn","drk","div","ele","enc","enf","ill","lit","multi","nec","nel","sum","uni","multiSchools","blank","sumhealenc","sumheal","sumenfdrk","sumenflit","sumenfele","sumenf","sumenc","sumdrk","sumlit","sumele","sumnel","crnheal","crnnec","crnenf","crnenc","healenf","healenc","illenf","illenc","necenc","necenf","necele","necnel","enfenc","enfdrkele","enfdrknel","enfdrk","enflit","enfele","enfnel","encdrk","enclit","encele","encnel","drkele","drknel","litele","litnel","spellLevels","proficiencyLevels","conditionTypes","antagonized","berserk","bleed","blinded","burning","charmed","confused","cowering","cursed","dazed","dazzled","deafened","deprotect","deshell","dimmed","disabled","diseased","doom","drenched","energyDrained","entangled","exhausted","fascinated","fatigued","frightened","frog","frozen","immobilized","imperil","invisible","mini","nauseated","panicked","paralyzed","petrified","poisoned","prone","sapped","shaken","sickened","silenced","sleep","slow","squalled","staggered","static","stop","stunned","weighted","unlucky","zombie","conditions","ffd20_blind","ffd20_deaf","grappled","helpless","incorporeal","pinned","ffd20_prone","ffd20_sleep","conditionMechanics","changes","formula","subTarget","modifier","flags","operator","priority","continuous","squeezing","conditionTextures","buffTypes","temp","conditionalTargets","allAttack","hasteAttack","rapidShotAttack","damage","allDamage","hasteDamage","rapidShotDamage","effect","buffTargets","acpA","label","category","sort","acpS","mDexA","mDexS","strMod","dexMod","conMod","intMod","wisMod","chaMod","carryStr","carryMult","strSkills","dexSkills","conSkills","intSkills","wisSkills","chaSkills","allChecks","strChecks","dexChecks","conChecks","intChecks","wisChecks","chaChecks","landSpeed","climbSpeed","swimSpeed","burrowSpeed","flySpeed","allSpeeds","aac","sac","nac","tac","ffac","bab","mattack","rattack","wdamage","sdamage","critConfirm","allSavingThrows","cmb","cmd","ffcmd","init","mhp","wounds","vigor","mmp","spellResist","bonusFeats","bonusSkillRanks","concentration","cl","buffTargetCategories","defense","abilityChecks","health","speed","contextNoteTargets","meleeWeapon","meleeSpell","rangedWeapon","rangedSpell","spellEffect","sr","contextNoteCategories","attacks","languages","common","dwarven","elvaan","galkan","lalafellan","mithran","moogle","aegyllan","albhedian","banganese","burmecian","draconic","garif","guado","hypello","lupin","mandragoran","numish","qiqirn","queran","roegadyn","ronsaur","seeq","tonberry","vieran","celestial","infernal","abyssal","aquan","auran","auroran","enochian","ignan","terran","thorian","umbran","amaljaa","antican","goblin","kojin","orcish","quadav","sahagin","sylvan","undercommon","vanu","yagudo","creatureTypes","aberration","animal","construct","dragon","fey","humanoid","magicalBeast","monstrousHumanoid","ooze","outsider","plant","undead","vermin","spellRangeFormulas","sizeDie","CHARACTER_EXP_LEVELS","fast","CR_EXP_LEVELS","temporaryRollDataFields","actor","keepItemLinksOnCopy","classSubTypes","core","coreArc","baseArc","hybridArc","countforexp","exp","noExp","classCastingStats","noncaster","intAndWis","classBaseMPTypes","halfCaster","dimPacman","pacman","dimFullCaster","fullCaster","advFullCaster","ClassSpellLvlProgression","classMPlevels","classMPStatsBonus","classBaseMPauto","no","yes","half","materiaRarity","uncommon","rare","legendary","materiaRarityMath","materiaSlot","unslotted","materiaAdvancement","HealthConfig","FormApplication","constructor","options","super","defaultSettings","async","settings","get","mergeObject","defaultOptions","title","width","height","tabs","navSelector","contentSelector","initial","hitdice","PC","auto","rate","maximized","NPC","Racial","hitdieOptions","rounding","continuity","variants","pc","useWoundsAndVigor","useWoundThresholds","allowWoundThresholdOverride","activateListeners","html","find","click","this","_onReset","bind","_onSubmit","event","preventDefault","set","ui","notifications","info","render","formData","expandObject","hd","Object","values","Math","max","min","floor","ExperienceConfig","_init","_settings","hasCustomFormula","track","disableExperienceTracking","openXpDistributor","_onButtonSubmit","_onChangeInput","_updateApplicationSettings","_getSubmitData","inplace","AccessibilityConfig","TooltipWorldConfig","_cachedData","getData","result","disable","portrait","hide","hideHeld","hideArmor","hideBuffs","hideConditions","hideClothing","hideActorName","hideActorNameReplacement","TooltipConfig","canvasRect","canvas","app","view","getBoundingClientRect","screen","halfWidth","halfHeight","isGM","user","p","tooltip","r1","r2","ceil","preview","hideKey","anchor","x","y","offset","onMouse","maxSize","hideWithoutKey","change","_handleImmediateChange","_openWorldSettings","el","currentTarget","key","tagName","toUpperCase","checked","innerHTML","dataset","dtype","Boolean","parseFloat","setProperty","can","error","TooltipFFD20","Application","mousePos","document","addEventListener","clientX","clientY","hidden","_setPosition","objects","forceHideGMInfo","forceHide","lock","new","old","popOut","config","worldConfig","element","style","visibility","indexOf","push","unbind","idx","splice","length","clearBinds","stringContent","Token","actorData","getTokenData","Actor","getActorData","token","testUserPermission","tooltipName","getProperty","system","isOwner","getPortrait","ck","cv","entries","CONFIG","icon","buffs","filter","i","isActive","hideFromToken","b","held","includes","equipped","equipmentType","getName","equipmentSubtype","url","maxWidth","maxHeight","v","elSize","position","left","top","sb","sidebar","mw","mh","minPos","maxPos","pos","css","show","force","_render","loadableContent","loadableContentCount","loadedContentCount","one","tokenHover","hovering","elementFromPoint","enable","Hooks","on","setPosition","off","debouncedReload","foundry","utils","debounce","window","location","reload","registerSystemSettings","register","scope","String","default","registerMenu","hint","restricted","onChange","refreshActors","renderForEveryone","toggle","choices","rule","grid","diagonalRule","imperial","metric","renderOnly","chat","perception","schedule","lighting","initialize","refresh","sight","socket","emit","eventType","Dialog","confirm","content","defaultYes","then","promises","actors","Array","from","contents","tokens","a","toggleConditionStatusIcons","Promise","all","registerClientSettings","spells","bestiary","feats","classes","races","diff","migrateSystemSettings","getSkipActionPrompt","skipConfirmPrompt","preloadHandlebarsTemplates","loadTemplates","SemanticVersion","major","minor","patch","preRelease","buildMetaData","match","parseInt","RegExp","$1","$2","$3","$4","$5","toString","isHigherThan","otherVersion","isLowerThan","RollFFD20","Roll","totalHalved","total","context","suppressError","roll","create","evaluate","err","warning","Error","console","debug","isNaN","safeRoll","terms","simplified","term","prior","OperatorTerm","StringTerm","priorNumeric","NumericTerm","flavor","priorOperator","map","t","_classifyStringTerm","intermediate","shift","pop","_formula","_splitGroup","openRegexp","ParentheticalTerm","OPEN_REGEXP","closeRegexp","CLOSE_REGEXP","openSymbol","closeSymbol","onClose","group","fn","open","slice","expression","join","undefined","rollPreProcess","fnParams","s","split","startsWith","endsWith","parseRollStringVariable","args","_splitMathArgs","MathTerm","replace","parts","dice","d","getTooltipData","numericParts","arr","renderTemplate","createTag","toLowerCase","substring","isMinimumCoreVersion","version","coreVersion","fromString","compareVersion","degtorad","degrees","PI","linkData","expanded","flattened","getItemOwner","fractionalToString","f","roundDecimals","rv","CR","fromNumber","isNumeric","getActorFromId","speaker","ChatMessage","getSpeaker","convertDistance","convertDistanceBack","measureDistance","p0","p1","state","diagonals","cells","Ray","gs","dimensions","nx","abs","dx","ny","dy","nDiagonal","nStraight","nd10","distance","convertWeight","convertWeightBack","naturalSort","propertyKey","propA","propB","Intl","Collator","numeric","compare","createConsumableSpellDialog","itemData","allowSpell","slcl","Item","documentClasses","getMinimumCasterLevelBySpellData","sl","val","resolve","dialogData","format","buttons","callback","createConsumableSpell","toConsumable","_id","adjustNumberByStringCommand","initialValue","cmdStr","maxValue","clearValue","isAbsolute","isNegative","rawValue","colorToInt","color","rgb","getBuffTargets","duplicate","contextNotes","_skillTargets","sId","getSkillInfo","k","getBuffTargetDictionary","targetCategories","categories","sortArrayByName","inputArr","n","toLocaleLowerCase","current","currentLower","j","localeCompare","ignorePunctuation","binarySearch","searchArr","compare_fn","cmp","Set","warn","rest","uniquePermutations","concat","add","findInCompendia","searchTerm","packs","found","foundDoc","foundPack","flatMap","metadata","pack","fuzzyIndex","index","it","searchMutations","reverse","mut","splitCurrency","getFirstActiveGM","users","u","active","rollData","forEach","reset","sheet","_state","sourceObj","targetObj","keepPath","subData","e","deepClone","keySeparatorCount","entry","subKey","subKey2","obj","flattenObject","deleteKeys","keys","prototype","hasOwnProperty","call","diffObjectAndArray","original","inner","keepLength","isDifferent","difference","v0","v1","t0","getType","d2","isEmpty","registerHandlebarsHelpers","hasDamage","parent","actionData","handleFormula","rd","getRollData","newformula","parse","DiceTerm","isDeterministic","evl","safeTotal","temp2","prev","next","elseOp","falseVal","simpler","safeEval","simplifyTerms","tt","handleParts","_","dmgAbl","dmgAblMod","mod","damageMult","nonCritParts","getAllDamageSources","Handlebars","registerHelper","isFinite","firstAction","hasRange","range","rangeType","units","calculateRange","actionDamage","typeInfo","dtId","attackArray","highest","conditionals","c","abl","multiplier","getContextNotes","notes","root","noteObjs","formatContextNotes","owner","hash","SafeString","TextEditor","enrichHTML","secrets","escape","JSON","stringify","array","tinyMCEInit","TinyMCE","content_css","style_formats","inline","attributes","remove","formats","assign","removeFormat","selector","tinyMCE","ev","editor","isInfoElement","node","nodeName","parentNode","classList","contains","getInfoElement","selection","getNode","closest","addContextForm","launch","predicate","initValue","elm","commands","onSetup","buttonApi","setActive","nodeChangeHandler","readonly","onAction","formApi","getValue","setDirty","dom","setAttribs","measureDistances","segments","gridSpaces","BaseGrid","unifiedMeasureDistance","getConditions","statusEffects","sys","_TokenHUD_getStatusEffectChoices","TokenHUD","_getStatusEffectChoices","_calcBuffActiveEffects","ind","src","isOverlay","cssClass","_onToggleEffect","overlay","statusId","getAttribute","toggleEffect","TemplateLayerFFD20","TemplateLayer","_onDragLeftStart","origin","PlaceablesLayer","tool","activeTool","originalEvent","shiftKey","getSnappedPosition","gridPrecision","direction","fillColor","defaults","MeasuredTemplate","angle","doc","documentClass","scene","objectClass","addChild","draw","_onDragLeftMove","destination","createState","snapToGrid","dist","ratio","cellSize","baseDirection","normalizeDegrees","toDegrees","halfAngle","baseDistance","MeasuredTemplateFFD20","getHighlightedSquares","shape","x0","y0","x1","y1","sx","sy","e2","fromAngle","A","B","nr","nc","cx","cy","getCenter","col0","row0","getGridPositionFromPixels","minAngle","maxAngle","originOffset","dir","xOffset","sign","cos","yOffset","sin","gx","gy","getPixelsFromGridPosition","cellCenterX","cellCenterY","rayAngle","getTokensWithin","highlightSquares","inRect","point","placeables","tokenData","highlightGrid","CONST","GRID_TYPES","SQUARE","bc","borderColor","fc","hl","getHighlightLayer","clear","highlightGridPosition","border","highlightId","menuItems","condition","li","visionPermissionSheet","rendered","_minimized","maximize","VisionPermissionSheet","apps","appId","closeOnSubmit","submitOnClose","submitOnChange","actorLink","isLinkedToken","setFlag","getFlag","defaultLevels","levels","ActorBaseFFD20","subtyped","cls","_visionPermissionSheet","score","ChatMessageFFD20","isRoll","CHAT_MESSAGE_TYPES","ROLL","itemSource","itemId","getSpeakerActor","hasItemSource","measureTemplate","templateId","templates","targets","targetIds","customRolls","message","cMsg","tokenDocument","scenes","tokenUuid","uuid","isHealing","tokenId","chatOptions","rollMode","subject","callOldNamespaceHook","oldHook","newHook","allowed","events","logCompatibilityWarning","since","until","callOldNamespaceHookAll","callAll","D20RollFFD20","Die","staticRoll","number","faces","getFormula","critical","fumble","bonus","TEN","TWENTY","isCrit","_evaluated","isFumble","isNat20","bonusTerms","DIALOG_TEMPLATE","d20","renderData","rollModes","Dice","_onDialogSubmit","takeTen","STATIC_ROLL","takeTwenty","dialogOptions","jQuery","form","querySelector","baseDice","messageData","chatTemplate","CHAT_TEMPLATE","chatTemplateData","getTooltip","compendiumEntry","compendium","compendiumEntryType","sound","noSound","sounds","toJSON","messageClass","messageObject","toObject","applyRollMode","_applyBonus","_evaluate","_applyStaticRoll","_evaluateSync","unshift","newTotal","_total","activeDie","results","r","formulaHasDice","DiceFFD20","situational","fastForward","extraRolls","chatMessage","originalOptions","arguments","rolled","_roll","setRoll","originalFlavor","curParts","extraRoll","chatData","msgData","toMessage","crit","critMult","mult","alter","useCustomContent","ctrlKey","msgStr","ItemBaseFFD20","subType","isArrayish","isArray","Function","getOwnPropertyDescriptor","swizzle","simpleSwizzleModule","exports","len","arg","wrap","colorNames","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","require$$1","reverseNames","cs","colorStringModule","to","num","string","model","hsl","hwb","hexAlpha","i2","clamp","alpha","hex","rgba","hexDouble","percent","g","hsla","hwba","keyword","cssKeywords","reverseKeywords","convert","channels","labels","hsv","cmyk","xyz","lab","lch","ansi16","ansi256","hcg","apple","conversions","defineProperty","delta","l","rdif","gdif","bdif","diffc","reversed","currentClosestKeyword","currentClosestDistance","Infinity","z","t2","t3","t1","smin","lmin","hi","q","vmin","wh","bl","y2","x2","z2","atan2","sqrt","hr","saturation","ansi","rem","colorString","char","integer","chroma","grayscale","hue","pure","mg","require$$0","fromModel","graph","models","queue","adjacents","adjacent","toModel","path","link","conversion","route","deriveBFS","wrapConversion","routes","wrappedFn","arg0","raw","colorConvert","skippedModels","hashedModelKeys","limiters","Color","valpha","newArray","zeroArray","hashedKeys","limit","freeze","places","percentString","unitArray","unitObject","roundToPlace","getset","maxfn","saturationl","lightness","saturationv","wblack","hexa","rgbArray","alphaHex","rgbNumber","luminosity","lum","chan","contrast","color2","lum1","lum2","contrastRatio","isDark","isLight","negate","lighten","darken","saturate","desaturate","whiten","blacken","fade","opaquer","rotate","mix","mixinColor","color1","w1","w2","toFixed","channel","createCustomChatMessage","rolls","CHAT","implementation","dice3d","isEnabled","showForRoll","whisper","blind","hideRollInfo","isBlind","isAuthor","text","removeClass","hideGMSensitiveInfo","identifiedInfo","identified","append","hasCombinedName","actionName","actionDescription","_templateCache","allowProtoMethodsByDefault","allowProtoPropertiesByDefault","each","elem","$","fromUuid","TokenDocument","removeData","fromJSON","unescape","insertBefore","removeChild","addChatCardTitleGradient","card","_getChatCardActor","typeColor","typeColor2","titleText","alterAmmoRecovery","recoveryData","attackIndex","ammoId","ia","recovered","failed","alterTargetDefense","defenseData","actorUUID","savingThrow","applyAccessibilitySettings","conf","createInlineRollString","hide3d","hideInvisibleTargets","toArray","visible","addTargetCallbacks","targetElems","_getTokenByElem","_getRootTargetElement","_mouseEnterCallback","_onHoverIn","hoverOutOthers","_mouseLeaveCallback","_onHoverOut","_imageClickCallback","_controlled","release","control","releaseOthers","imgElem","targetACClick","targetSavingThrowClick","rollDefenses","rollSavingThrow","skipDialog","changeOverrides","getSortChangePriority","_sortChanges","typeA","types","typeB","modA","modifiers","modB","prioA","prioB","changeItems","changeFlags","k2","getSourceInfo","sourceInfo","negative","refreshDerivedData","continuousChanges","flats","getChangeFlat","createOverride","applyChange","applySourceInfo","cc","resetSkills","target","aSort","bSort","changeTarget","changeType","curData","skl","subSkills","subSkl","speedKey","sklKey","subSklKey","fixedKey","getBabTotal","getNegativeEnergyDrain","energyDrain","getAbilityMod","addDefaultChanges","tempChanges","components","ItemChange","classType","racialHD","healthConfig","cls_options","race_options","up","nearest","down","discrete","push_health","source","auto_health","health_source","die_health","maxed_health","level_health","favor_health","compute_health","health_sources","race","push_mana","manual_mana","mana_source","mana","mp","positive","className","compute_mana","mana_sources","mpsource","manaChart","level_mana","allClasses","useFractional","hasGoodSave","goodSaveFormula","hpAbility","drain","mp_source","mpAbility","classCastingStat","spellMath","currentSpellLvl","mpProg","arrayStr","acp","attackPenalty","strAbl","strAbility","cStr","details","carryCapacity","cMultBase","cMult","naturalAC","armorTarget","broken","flyKey","maneuverability","flyValue","climb","swim","sizeKey","traits","mechanic","changeData","changeObj","flag","acpPenalty","ablMod","specificSkillBonus","changeBonus","sklValue","rank","subSkill","setSourceInfoByName","getHighestChanges","ignoreTarget","highestTemplate","ids","highestID","filterFunc","defaultData","updateTime","Date","documents","ItemFFD20","dataObj","newChangeData","update","randomID","isDeferred","getSourceInfoTargets","prepareData","preUpdate","changeSubTargets","getChangeSubTargets","rawChange","overrides","override","modifierChanger","isModifierChanger","abilityTarget","createFunction","replaceFormulaData","missing","prevMod","getAbilityModifier","newAbility","sourceInfoTargets","sourceInfoGroup","sInfo","doAdd","hasSameParent","isEnh","hasSameTarget","alterBase","funcDef","funcArgs","preDef","postDef","fullDef","ItemAction","newActionData","actions","defaultDamageType","parentActor","tag","hasAction","actionType","hasAttack","hasMultiAttack","attackParts","formulaicAttacks","count","autoDeductCharges","useSpellPoints","isCharged","uses","isSelfCharged","chargeCost","getChargeCost","autoDeductChargesCost","cost","isSingleUse","getRange","minRange","maxRange","minValue","minUnits","singleIncrementRange","maxIncrements","hasTemplate","hasEffect","effectNotes","hasSave","getDC","dcBonus","dcFormula","dc","spellbook","baseDCFormula","hasSound","soundEffect","enhancementBonus","damageSources","isSpell","isWeapon","getContextChanges","activation","unchainedAction","duration","maxFormula","overrideColor","customColor","overrideTexture","customTexture","attackName","attackBonus","critConfirmBonus","critParts","critRange","attackNotes","powerAttack","damageBonus","critMultiplier","naturalAttack","primaryAttack","secondary","nonlethal","usesAmmo","spellArea","parseFormulaicAttacks","_prepareConditionals","maxUses","collection","Collection","conditional","has","ItemConditional","updateData","prevData","newUpdateData","keepPaths","keepUpdateArray","getChatData","htmlOptions","chatDataOptions","actionId","getLabels","activationTypes","activationTypesPlural","filterJoin","exAtkCountFormula","xaroll","extraAttacks","msg","exAtkBonusFormula","extraParts","isRanged","isCMB","sizeBonus","proficiencyPenalty","sourceDetails","masterwork","cleanFlavor","proficient","attackType","rollEffect","ablMult","cur2","effectContent","fx","chatFlavor","conditionalParts","extra","damageType","isExtra","test","ablDamage","ablLabel","part","rollParts","isPriorNegativeOperator","getConditionalTargets","getConditionalSubTargets","hasProperty","getConditionalModifierTypes","getConditionalCritical","nonCrit","actionID","use","ChatAttack","_rollData","setAction","hasCritConfirm","critDamage","minimumDamage","damageRows","notesOnly","cards","hasCards","attackNotesHTML","effectNotesHTML","setAmmo","ammoItem","setRollData","critCount","setAttackNotesHTML","setEffectNotesHTML","noAttack","ccKey","rollAttack","critType","isCmb","addAttack","addAttackNotes","typeMap","getContextNotesParsed","repeatCount","repeat","rollDamage","DamagePart","tooltips","totalDamage","amount","properties","addEffectNotes","finalize","ERR_REQUIREMENT","NO_ACTOR_PERM","DISABLED","INSUFFICIENT_QUANTITY","INSUFFICIENT_CHARGES","MISSING_AMMO","INSUFFICIENT_AMMO","ActionUse","shared","defineProperties","checkRequirements","itemQuantity","createAttackDialog","applications","AttackDialog","alterRollData","FormDataExtended","atkBonus","dmgBonus","pointBlankShot","fullAttack","manyShot","useMeasureTemplate","basePowerAttackBonus","powerAttackBonus","powerAttackMultiplier","powerAttackPenalty","casterLevelCheck","concentrationCheck","generateAttacks","forceFullAttack","unnamedAttackIndex","allAttacks","exAtkCount","quantity","abundant","atk","ammoUsage","currentValue","updateEmbeddedDocuments","handleConditionals","conditionalData","conditionalRoll","partString","flavoredFormula","conditionalPartsCommon","chargeCostBonus","checkAttackRequirements","preparation","preparedAmount","getSpellUses","addAttacks","addDamage","chatAttack","saveDC","_getConditionalParts","conditionalTemplates","addPart","templateKey","templateStr","parsedStr","attackCount","powerAttackCritBonus","chatAttacks","templateOptions","texture","AbilityTemplate","fromData","sheetRendered","_element","minimize","drawPreview","place","mergeRolls","skipRolls","showRoll","pools","pool","attackPool","PoolTerm","dmgRoll","critPool","getMessageData","templateData","OTHER","props","extraText","itemChatData","addGenericPropertyLabels","header","combat","combatProps","addCombatPropertyLabels","clNotes","identifiedName","unidentified","fullDescription","unidentifiedDescription","hasExtraText","hasProperties","gmSensitiveLabel","usystem","rangeLabel","rangeUnits","spellFailure","somatic","arcaneSpellFailure","spellFailureRoll","spellFailureSuccess","generateChatMetadata","identifiedDescription","atWill","woundThresholds","attackRolls","scriptData","executeScriptCalls","attackData","hookData","toRecord","hideChat","descriptionOnly","links","_preCreate","updated","updates","preCreateData","memoryVariables","isPhysical","isInventoryItem","some","isOwned","parentItem","maxCharges","totalDurationSeconds","totalSeconds","auraStrength","limited","forcePlayerPerspective","permission","exact","effects","colorType","getTypeColor","actionTypes","defaultContextNote","addCharges","prevValue","showUnidentifiedData","prepareLinks","_prepareChanges","_prepareActions","scriptCalls","_prepareScriptCalls","inventoryItems","_prepareInventory","prepareWeight","prepareLabels","prepareDerivedItemData","sourceData","_source","sourceWeight","baseWeight","weightReduction","currency","converted","priceUnits","prepareDerivedData","unidentifiedName","prepareBaseData","itemTemplate","taggedTypes","useCustomTag","_updateMaxUses","checkYes","checkNo","carried","slot","equipmentSlot","scriptCall","ItemScriptCall","inventory","updateSource","extraParams","scripts","execute","recursive","baseData","srcData","memorizeVariables","diffObject","origData","skipUpdate","parentInventory","tokenUpdateData","barKey","bar","getBarAttribute","attribute","_memoryVariables","memKeys","_onUpdate","changed","userId","previous","itemUpdateData","memoryItemData","diffData","getRawEffectData","getScriptCalls","altChatData","displayCard","isVersatile","hasExtraProperties","extraProperties","ffd20Flags","canPopout","enrichOptions","shortDescription","dynamicLabels","distanceValues","saveDesc","getTypeChatData","useAttack","useScriptCalls","reject","ActionChooser","writable","enumerable","actionUse","measureResult","reqErr","code","generateChatAttacks","promptMeasureTemplate","delete","handleDiceSoNice","subtractAmmo","postMessage","setTarget","subTargetList","dFlags","_onChatCardButton","_onChatCardToggleContent","button","messageId","messages","_onChatCardAction","asNonlethal","querySelectorAll","innerText","tags","applyDamage","ammoRecovery","chance","random","rollConcentration","rollCL","display","popout","actorId","character","controlled","canCreateItemLink","linkType","dataType","targetItem","itemLink","sameActor","targetLinks","generateInitialLinkData","recoverChance","_links","setTimeout","newItemData","createEmbeddedDocuments","newItem","createItemLink","extraData","getLinkItem","linkItems","getDocument","linkGroups","DEFAULT_TOKEN","_cleanLink","oldLink","otherItem","actorSkills","s2","skl2","getTotalCurrency","inLowestDenomination","sellValue","forceUnidentified","price","pricePerUse","convertCurrency","totalValue","_calculateCoinWeight","coinWeightDivisor","flagName","hasItemBooleanFlag","getItemBooleanFlags","getItemDictionaryFlag","getItemDictionaryFlags","getAttackArray","appendAttack","trim","fmAtk","fmAtkBonus","formulaicAttack","condBonuses","fill","bonusRoll","totalBonus","getAttackSources","sources","isMelee","weaponSubtype","isManeuver","describePart","srcDetails","changeSources","effectiveChanges","ic","virtualEnh","secondaryModifier","attackSources","conds","mods","fakeCondChanges","isModifier","allChanges","allDamageSources","LinkFunctions","Spellbook","bookKey","spellbooks","addSpell","clamped","SpellbookLevel","book","SpellbookSlots","domain","domainMax","domainUnused","used","SpellRanges","SpellbookMode","isHybrid","isPrestige","isSpontaneous","isPrepared","isSemiSpontaneous","mode","spellPreparationMode","ActorFFD20","relativeAttributes","itemFlags","boolean","dictionary","_queuedUpdates","_runningFunctions","containerItems","_states","_race","_onChatCardButtonAction","saveId","skipPrompt","getSelectedActors","JournalEntryPage","pageId","actorName","subtype","buffType","_prepareContainerItems","getContainerContents","_prepareItemFlags","bFlags","applyActiveEffects","allItems","_initialized","_setSourceDetails","temporaryEffects","ae","remaining","disableActiveEffects","disableBuffs","groups","disableAEContext","resources","_resetInherentTotals","mythicTier","hitDice","ab","baseMod","userPenalty","refreshAbilityModifiers","babBase","skillSet","actorItems","relevantActorItems","classSkillName","isClassSkill","classSkills","hasArmorProficiency","proficiencyName","customProficiencies","armorProf","customTotal","prof","_updateSpellBook","cache","capitalize","bookClass","_generateSpellbookCache","bookInfo","books","spellbookAbility","spellSlotAbilityScoreBonus","spellSlotAbilityBonusFormula","spellSlotAbilityMod","clTotal","autoSpellLevelCalculation","autoFormula","autoSpellLevelCalculationFormula","autoBonus","autoTotal","autoSpellLevelTotal","clBonus","concFormula","concentrationFormula","formulaRoll","classAbilityMod","prevTotal","getAbilityBonus","getSpellSlotIncrease","spellPoints","useSystem","casterType","castsForLevels","classLevel","isSafeInteger","allLevelModFormula","allLevelMod","levelData","spellsForLevel","offsetFormula","hasCantrips","spellLevel","autoSpellLevels","oldval","slots","domainSlotValue","levelSpells","lvlSlots","slotCost","subtract","maxLevelByAblScore","preparedAllOffsetFormula","spellLevelData","lowAbilityScore","known","unused","available","preparedOffsetFormula","dSlots","acc","spontaneousPrepared","spellMessage","spellRemainingMsg","unusedKnown","spellClass","bookKeys","allSpells","updateSpellbookInfo","usedSpellbooks","inUse","maxDexBonus","maxBonus","encPen","_computeEncumbrance","gearPen","_applyArmorPenalties","encumbrance","prepareProficiencies","updateItemResources","applyChanges","prepareSpecificDerivedData","prepareCMB","prepareItemLinks","isToken","getActiveTokens","drawBars","proficiencies","weaponProf","translations","profs","hasInfo","proficiency","customProfs","shrAtk","genAtk","general","cmbAbl","cmbAbility","cmbAblMod","totalAtk","updateWoundThreshold","skillId","subSkillId","background","alignment","acAbl","acTouchAbl","cmdDexAbl","dexAbility","acAblMod","acTouchAblMod","cmdDexAblMod","maxDex","acAblKey","flatFootedTotal","armorItems","reducedSpeed","getReducedMovementSpeed","proficiencyMaps","attackACPPenalty","mdex","eqType","isShieldOrArmor","itemACP","brokenACP","mDex","isInteger","itemMDex","ignoreNull","brokenId","totalACP","bt","hpconf","wtData","getWoundThresholdData","changeFlatKeys","fk","changeGrp","srcInfo","_translateSourceInfo","srcValue","_getInherentTotalsKeys","armorBonus","shieldBonus","skillKeys","log","getLevelExp","_preUpdate","isPathKey","oldData","newSize","absoluteKeys","absKey","conditionStages","conditionGroup","conditionKey","_updateExp","initializeLighting","initializeVision","_onCreateEmbeddedDocuments","embeddedName","_onUpdateEmbeddedDocuments","itemTag","res","skillName","parentSkill","mainSkillId","subSkillDelim","isSubSkill","mainSkill","noteObjects","rt","cf","rollOptions","journal","d20Roll","attackTargets","attackChanges","atkAbl","spellbookKey","wT","valid","formulaBonus","getDefenseHeaders","headers","reSplit","dr","eres","cres","di","ci","getInitiativeContextNotes","notesHTML","notesHTMLParts","note","createCombatants","rerollInitiative","initiativeOptions","combatData","combats","createData","inCombat","combatantIds","combatants","initiative","rollInitiative","savingThrowId","abilityId","checkMod","acNoteObjects","acNotes","cmdNoteObjects","cmdNotes","srNoteObjects","srNotes","drNotes","energyResistance","wTlabel","regen","fastHealing","newStatus","deleteKey","enabled","hasCondition","forceDialog","reductionDefault","asWounds","healingInvert","numReg","sliceReg","sliceReg2","_submit","dR","tok","actorType","tmp","currentHealth","woundAdjust","dt","newHP","nld","damageReduction","inp","chk","increase","deltaY","getWoundThresholdMultiplier","woundMult","woundLevel","usage","wt","penaltyBase","curHP","tempHP","maxHP","wtMult","wtMod","curValue","allSkills","allNotes","noteItems","skillKey","saveKey","saveNotes","ablKey","miscKey","spellbookNotes","noteObj","_onLevelChange","carry","getCarryCapacity","heavy","drag","carriedWeight","getCarriedWeight","encLevel","carryMultiplier","table","multiplierCount","physicalItems","mergeCurrency","skipRefresh","clearFields","k3","viewed","loseDexToAC","armorId","eqArmor","NEGATIVE_INFINITY","armorData","enhAC","baseAC","fullAC","shieldId","eqShield","shieldData","abilityMod","getReach","stature","_addChildren","children","getLinkedItems","child","removeItemLink","deleteEmbeddedDocuments","getQuickActions","showInQuickbar","haveAnyCharges","maxCharge","togglingStatusIcons","buffTextures","toCreate","toDelete","toUpdate","existing","existingData","mergedData","condKey","findIndex","hasEffectIcon","removeEffects","deleteContext","createContext","drawEffects","newMod","migrations","isMigrating","_prevAbilityScores","diffMod","json","getFeatCount","totalLevels","featCountRoll","bonusFeatFormula","restoreHealth","longTermCare","aidedCare","restoreDailyUses","hours","recover","dmg","itemUpdates","sbKey","limitbreak","itemUpdate","maxAmount","sbUses","_changed","restorePoints","restoreFormula","restoreRoll","isDelta","isBar","getItemByTag","ActorCharacterFFD20","prototypeToken","maxExp","xp","pct","xpData","newExp","resetExp","curExp","minExp","expConfig","expTrack","totalXP","ActorNPCFFD20","cr","getCR","crTotal","getCRExp","crOffset","BasicActorFFD20","ActorTraitSelector","DocumentSheet","attr","chosen","updateButton","_updateObject","ActorRestDialog","performRest","aidedcare","PointBuyCalculator","actorAbl","ablValues","points","getSpentPoints","_onAbilityControl","Widget_ItemPicker","columns","_items","parentElem","rootElem","parseHTML","rowElem","itemElem","widthRate","offsetLeft","offsetBottom","_onClickItem","_cancelCallback","_onCancel","cancel","removeEventListener","dialogGetNumber","cancelled","ok","input","htm","select","dialogGetActor","gmActive","dialog","LevelUpForm","_submitted","_section","_sections","_addSections","_addSummarySection","section","currentSection","setSection","rawData","_app","_onClose","sections","summary","getSummaryData","_parseSection","hpSettings","choice","manualValue","isFavouredClass","newHD","newAbilityScores","added","isEnhanced","newItems","callbacks","prevItem","levelingClass","lvlwaiter","hid","curLevel","newLevel","cb","classAssociations","newAssociations","newFeatures","co","featCount","newValue","newAbilityScore","createChatMessage","_parseSection_health","hpValue","_parseSection_fc","fcKey","desc","_parseSection_ability","levelUp","_onClickListItem","_onChangeSectionChoice","_onClickAbilityScoreOperator","_onPreviousSection","_onNextSection","currentItem","_updateNavButtons","sectionName","formDiv","submit","prop","hasMadeChoice","CurrencyTransfer","container","dest","altCurrency","notification","order","_curRange","_calcTotal","trigger","transfer","_options","formField","textContent","amounts","fromEntries","i18nKey","docDestId","dataTransfer","destDoc","sourceActor","containerId","sourceDoc","sourceAlt","destAlt","allowConversion","_failed","sourceCurrency","destCurrency","originalSource","totalAmount","totalSource","newSource","destActor","sourceContainer","destContainer","minRequired","inCopper","ActorSheetFFD20","ActorSheet","_filters","features","search","searchCompositioning","searchRefresh","searchDelay","searchDelayEvent","effectiveSearch","_itemUpdates","_hiddenElems","_submitQueued","_renderedInner","_pendingUpdates","_skillsLocked","_expandedItems","scrollY","dragDrop","dragSelector","featTypeData","hasActions","currentPrimaryTab","primaryElem","currentSpellbookKey","elems","editable","isEditable","isCharacter","hasRace","useBGSkills","usesAnySpellbook","skillsLocked","hasProficiencies","hasCurrency","hasAltCurrency","biographyHTML","biography","filters","classInfo","coreAttack","meleeAtkAbl","meleeAbility","rangedAtkAbl","rangedAbility","szMod","szCMBMod","meleeAttackMod","rangedAttackMod","meleeAttack","rangedAttack","cmbAttack","cgilValue","calculateTotalItemValue","totalLabel","valueLabel","arbitrary","untrained","_prepareTraits","_prepareSenses","_prepareItems","skillsets","_prepareSkillsets","skillRanks","bgAllowed","bgUsed","sentToBG","clsLevel","clsSkillsPerLevel","skillsPerLevel","fcSkills","bonusSkillRankFormula","byLevel","byFormula","_prepareHiddenElements","hiddenElems","magicItems","school","identifyDC","table_magicItems","firstClass","selected","_prepareSpellbook","usesSlots","canCreate","canPrepare","baseSlots","lvl","skillset","adventure","_typeFilterCount","_filterItems","hasTypeFilter","load","carryLabel","encumbered","aboveHead","offGround","dragPush","mousemove","_moveTooltips","filterLists","_initializeFilterItemList","_onToggleFilter","_searchFilterChange","_searchFilterCompositioning","_clearSearch","_onItemSummary","_onItemEdit","contextmenu","_onRaceControl","_onSpanTextInput","_adjustActorPropertyBySpan","_onInputText","_onConfigControl","_selectOnClick","preventRender","keypress","_onSubmitElement","_onRollAbilityTest","_onRollBAB","_onRollCMB","_onRollMelee","_onRollRanged","_onRollInitiative","_onRollSavingThrow","_onArbitrarySkillCreate","_onArbitrarySkillDelete","_onSkillCreate","_onSkillEdit","_onSkillDelete","mouseup","_quickItemActionControl","_onRollSkillCheck","_onRollSubSkillCheck","_onOpenCompendiumEntry","_onTraitSelector","_onRest","_onPointBuyCalculator","_onControlAlignment","_onSensesSelector","_onItemCreate","_onItemDelete","_onItemGive","_onItemSplit","_onItemRoll","_quickChangeItemQuantity","_quickEquipItem","_quickCarryItem","_quickIdentifyItem","_itemToggleData","_duplicateItem","_quickAction","_convertCurrency","_setFeatUses","_onLevelUp","_setSpellUses","_setMaxSpellUses","_onRollConcentration","_onRollCL","_setItemActive","_setBuffLevel","_hideShowElement","_onToggleCondition","_onToggleSkillLock","_onOpenCompendium","addClass","parentElement","newEl","createElement","noCap","setAttribute","maxName","forbiddenClasses","allowRelative","replaceChild","focus","_onDragSkillStart","skillElem","sceneId","setData","_onDragMiscStart","altType","tab","_onDragSaveStart","ul","_mouseWheelAdd","isInput","WheelEvent","wheelStep","MouseEvent","setItemUpdate","_updateItems","for","hasClass","slideDown","slideUp","actionTarget","compendiums","parents","openItemSummary","instant","toggleClass","attrName","wheelEvent","handler","keyHandler","mainSkillData","skillData","_editSkill","isBackground","SkillEditor","addCallback","deleteSkill","rejectClose","SensesSelector","curQuantity","newQuantity","property","currencyType","baseName","typeName","getSubtype","oldItems","oldItem","ItemSheet","hasPlayerOwner","targetData","targetActor","createContainerContent","splitValue","createDocuments","rollAbilityTest","rollBAB","rollCMB","savingthrow","canEquip","hasSlots","isStack","hasUses","itemCharges","empty","spellbookData","spellbookSpells","orig","totalWeight","featureDefaults","featData","featKey","featValue","abilityType","abilityTypeShort","canLevelUp","buffSections","attackSections","showTypes","typeFilterCount","_hidden","quickActions","rollSkill","_searchFilterCommit","jq","stopPropagation","clearTimeout","blur","_createPlaceholders","_renderInner","findSplice","preventClose","fromDropData","_onSortItem","deleteContainerContent","_alterDropItemData","_onDropItemCreate","_getSortSiblings","resultData","addClassWizard","actorRef","createdItem","_onDragStart","dragData","nextElementSibling","changedData","selectedIndex","calculateSellItemValue","sellMultiplier","placeholder","ActorSheetFFD20Character","xpSettings","disableExperience","minimumExperience","hasClasses","iteratives","iters","_onConvertCurrency","_onPrepareItem","curr","into","ActorSheetFFD20NPC","_adjustCR","ActorSheetFFD20NPCLite","ItemData","DEFAULT_ICON","ActorSheetFFD20NPCLoot","isLootSheet","cgilSellValue","inv","showValue","ActorSheetFFD20Basic","ActorSheetFlags","_getFlags","characterFlags","isCheckbox","isSelect","convertKeys","gridUnits","_callbacks","dropSelector","isStaticSkill","skillTag","documentType","tagOrId","getDragEventData","_openCompendiumEntry","_onCompendiumControls","duplicateCombatantInitiativeDialog","combatantId","combatant","prevInitiative","duplicateCombatantInitiative","CombatFFD20","Combat","_getInitiativeFormula","defaultParts","updateTurn","messageOptions","currentId","chatRollMode","showInitiativeDialog","alias","turns","dlg","expireActiveEffects","nextRound","_processCurrentCombatant","nextTurn","TokenFFD20","midUpdate","buffItem","hasActiveHUD","hud","refreshStatusIcons","actorVision","lowLight","lowLightMultiplier","lowLightMultiplierBright","disableLowLight","observer","visionFlag","updateVisionSource","refreshDetectionModes","_getBarBoost","_getBarUnderline","_drawBar","boost","underline","PIXI","rgb2hex","beginFill","lineStyle","drawRoundedRect","posY","TokenDocumentFFD20","getTrackedAttributes","barName","alternative","attenuation","brightness","visionMode","darkvisionRange","basicId","DetectionMode","BASIC_MODE_ID","basicMode","detectionModes","seeInvId","seeInvMode","blindSenseId","blindSenseMode","blindSightId","blindSightMode","tremorSenseId","tremorSenseMode","_sortDetectionModes","Canvas","PRIORITY","EntrySelector","isFlag","isFlat","flat","originalEntries","fields","dtypes","dataCount","o2","_onEntryControl","_onEntryChange","_submitAndClose","newKeys","index2","ScriptEditor","command","isScriptCall","_promises","canEdit","awaitResult","promise","resolved","_openHelpBrowser","helpBrowser","openUrl","resolvePromises","NEED_NEW_VERSION","COMPENDIUM_TYPES","CompendiumBrowser","activeFilters","_data","loaded","progress","lazyLoadTreshold","lazyStart","lazyIndex","lazyAdd","filterQuery","searchString","_savedItems","cacheVersions","thisVersion","innerHeight","shouldForceRefresh","_currentCompendiums","updateForceRefreshData","forceRefreshData","diffCompendiums","shouldSkip","package","_passesFilters","_addEntryElement","activateEntryListeners","_clearEntryElements","_onEntry","_createInitialElements","lazyLoad","createdItems","fadeIn","scrollTop","scrollHeight","_gatherData","saveEntries","clearEntries","_fetchMetadata","itemCount","getBasicFilters","private","_onProgress","SceneNavigation","displayProgressBar","getDocuments","translated","translate","_mapEntry","documentName","loadCompendium","_fetchGeneralFilters","_fetchSpellFilters","_fetchItemFilters","_fetchBestiaryFilters","_fetchFeatFilters","_fetchClassFilters","_fetchRaceFilters","_fetchBuffFilters","filterSettings","_mapFeats","extraFilters","associations","assocations","_mapBestiary","subTypes","creatureType","_mapItems","weaponProps","_mapSpells","spellTypes","allSpellLevels","learnedAt","subDomain","elementalSchool","bloodline","subschool","st","_mapClasses","parentClass","_mapRaces","_mapBuffs","loadData","_determineFilteredItemCount","keyup","_onFilterResults","_onActivateBooleanFilter","_toggleFilterVisibility","_initLazyLoad","collectionKey","entryId","packName","siblings","query","_filterResults","_filterTimeout","hasActiveFilter","checks","fi","every","getSaveEntries","propKeys","resultObj","SidebarFFD20","Sidebar","activateExtraListeners","_onBrowseCompendium","ExperienceDistributor","bonusXP","resizable","characters","getCharacters","npcs","getNPCs","getTotalExperience","toLocaleString","getSplitExperience","addListener","_onClickActor","_onDrop","toggled","actorID","updateDocuments","shouldActorBeToggled","xpString","isPC","isDefeated","DamageTypeSelector","dataPath","_dataPath","damageCategorySortOrder","damageCategories","categoryObj","sortOrder","idxA","idxB","damageModifiers","_toggleDamageType","_onChangeData","ActiveEffectFFD20","ActiveEffect","created","secondaryContext","returnVal","isTemporary","seconds","rounds","ItemAttackFFD20","ItemBuffFFD20","start","time","worldTime","_preDelete","C","dur","unit","noCreate","hideIcon","durationValue","ItemClassFFD20","_prevLevel","prevLevel","__index","fromCompendium","classUpdateData","itemIds","deleteDocuments","saveFormulas","saveData","saveType","babFormulas","babType","babFormula","classData","isBaseClass","customHD","ItemConsumableFFD20","consumableType","ItemContainerFFD20","itemOptions","temporary","renderSheet","noHook","vtt","getContainerContent","pending","Map","ItemEquipmentFFD20","eType","typeKeys","eSubtype","subtypeKeys","shieldType","armorType","ItemFeatFFD20","ItemLootFFD20","extraType","ItemRaceFFD20","oldRace","actorSize","oldSize","_ffd20SizeChanged","_onDelete","ItemSpellFFD20","getSpellComponents","getEffectiveSpellLevel","slOffset","getEffectiveCasterLevel","clOffset","casterLevel","_updateSpellDescription","psychic","verbal","spellAbility","curUses","tempMP","curMP","leftMP","newCharges","actorUpdateData","addUses","bookId","compKeys","df","componentsOrder","tc","materialPrice","materials","gilValue","_replaceConsumableConversionString","arrKey","isWand","isPotion","isScroll","spellDescriptionData","canCast","multischool","act","activationCost","activationType","activationTypesPlurals","castingTime","rangeUnit","rangeValue","area","savingThrowDescription","useDCandSR","ItemWeaponFFD20","newWeaponType","weaponType","wType","wSubtype","_prepareWeaponGroups","Widget_CategorizedItemPicker","cat","_onClickCategory","first","scrollIntoView","block","ItemSheetFFD20","_openApplications","_actionUpdates","itemType","_getItemType","itemStatus","_getItemStatus","itemProperties","_getItemProperties","itemName","isNaturalAttack","owned","parentOwned","showIdentifyDescription","isMateria","unchainedActionEconomy","auraStrength_name","identify","descriptionHTML","descriptionAttributes","isNumber","decimals","fakeName","inputValue","isRange","hardness","isBoolean","isClassFeature","isTemplate","classSkill","weaponCategories","equipmentCategories","showArmorData","hasMultipleSlots","isPreparedSpell","usesSpellpoints","isAtWill","topDescription","isMythicPath","isRacialHD","isObjectEmpty","changeGlobals","subTargetLabel","isScript","noteTargets","_prepareLinks","list","help","_index","updateLinkItems","hiddenIcon","titleCase","subPath","relativeKeys","originalValue","maxKey","_onActionEdit","_onTextAreaDrop","_onBuffControl","_onChangeTargetControl","_onNoteControl","_onNoteTargetControl","_createAttack","_onEntrySelector","_onLinksDrop","_onLinkControl","_onFilePickerAlt","_onEditChangeScriptContents","_openLinkedItem","_onActionControl","_setActionUses","_onScriptCallControl","_onScriptCallEdit","_onScriptCallDrop","setActionUpdate","mouseout","_updateActions","edit","instance","macros","_canDragStart","targetActionID","prevActions","targetIdx","srcIdx","changeID","scriptEditor","isAction","packId","deleteItem","actionParts","component","ItemActionSheet","part1","noteIndex","itemUUID","targetField","FilePicker","browse","removeAttr","focusout","createAttackFromWeapon","ItemSheetFFD20_Container","_tabs","_prepareContents","_onItemTake","_setItemUses","_onDropItem","_onDropCurrency","containerItem","dropTarget","targetId","SortingHelpers","performIntegerSort","updateContainerContents","CompendiumDirectoryFFD20","CompendiumDirectory","addLowLightVisionToLightConfig","checkboxStr","checkbox","addLowLightVisionToTokenConfig","patchCore","LightSource","_initializeData","_initializeFlags","seed","animation","animationConfig","lightAnimations","bright","getRadius","colorRGB","isDarkness","los","_createPolygon","_flags","renderSoftEdges","performance","lightSoftEdges","rays","_initializeMeshes","_initializeShaders","_appearanceKeys","_resetUniforms","_initializeBlending","relevantTokens","lowLightTokens","tokenVision","hasControlledTokens","hasControlledLowLightTokens","hasLowLightTokens","origParse","ChatLog","origClick","_onClickInlineRoll","windows","appid","KeyboardManager","_onAlt","evalFn","MATH_PROXY","RollTerm","FLAVOR_REGEXP_STRING","REGEXP","OPERATORS","origFunc","CompendiumCollection","getIndex","_createContentLink","firstChild","lastChild","KeybindingsConfig","_detectConflictingActions","binding","uneditable","Combatant","updateResource","resource","patchLowLightVision","initialLayer","activeLayer","layer","activate","activatePreviewListeners","handlers","moveTime","ffd20Style","_clear","destroyed","destroy","mm","now","center","getLocalPosition","rc","canResolve","removeChildren","stage","lc","oncontextmenu","onwheel","snap","controlIcon","removeAllListeners","hitArea","Polygon","initAmmoUsage","initAttacks","clCheck","cData","sheetConfig","defaultAttack","attackBonusTotal","hasDamageAbility","isWeaponAttack","isMeleeWeaponAttackAction","isRangedWeaponAttackAction","isAttack","isFeat","getAmmo","_filterAmmo","isDefault","weaponAmmoType","ammoType","_onToggleFlag","_onChangeAttribute","_onSelectChange","_onToggleConditional","_onAmmoSelectClick","_onAmmoControlClick","_onAmmoClick","_unfocusElements","_hideExtraAttacks","_showExtraAttacks","_onAttackSingle","_onAttackFull","translationString","manyshot","setAttackAmmo","listElem","unsetFlag","getFormAttacks","curAmmo","doAttack","rangeColor","reachColor","SquareHighlight","_squares","addHighlightLayer","addSquare","permanent","destroyHighlightLayer","gridSize","currentHighlight","showAttackReach","clearHighlight","highlight","tw","th","rangeKey","isReach","minRangeKey","squares","useReachRule","getReachSquares","maxSquareRange","rangeIncrements","squaresExtra","renderHighlight","onMouseEnterReach","onMouseLeaveReach","addSquareFunction","shouldAddReachSquare","gridDist","tokenSquares","tokenRect","getClosestTokenSquare","lowest","squareRange","wMax","hMax","tl","closestSquare","closestTokenSquare","dist2","reachRuleRange","TokenQuickActions","after","runSocketFunction","senderId","isFirstGM","sender","parentItemData","alterChatTargetAttribute","contentHTML","valueElem","targetUuid","isFailure","isSuccess","entities","regex","encodeCache","exclude","keepEscaped","nextCode","encode","defaultChars","ch","fromCharCode","charCodeAt","encodeURIComponent","componentChars","encode_1","decodeCache","decode","seq","b1","b2","b3","b4","chr","decode_1","protocol","slashes","auth","port","hostname","pathname","protocolPattern","portPattern","simplePathPattern","unwise","autoEscape","nonHostChars","hostEndingChars","hostnamePartPattern","hostnamePartStart","hostlessProtocol","javascript","slashedProtocol","http","https","ftp","gopher","file","Url","slashesDenoteHost","lowerProto","hec","simplePath","exec","proto","substr","atSign","hostEnd","lastIndexOf","host","parseHost","ipv6Hostname","hostparts","newpart","validParts","notHost","bit","qm","mdurl","require$$3","uc_micro","Any","Cc","Cf","P","Z","require$$4","_hasOwnProperty","surrogate1","surrogate2","UNESCAPE_MD_RE","UNESCAPE_ALL_RE","DIGITAL_ENTITY_TEST_RE","HTML_ESCAPE_TEST_RE","HTML_ESCAPE_REPLACE_RE","HTML_REPLACEMENTS","REGEXP_ESCAPE_RE","UNICODE_PUNCT_RE","lib","require$$2","ucmicro","TypeError","isString","unescapeMd","unescapeAll","escaped","entity","isValidEntityCode","fromCodePoint","escapeHtml","replaceUnsafeChar","arrayReplaceAt","newElements","isSpace","isWhiteSpace","isMdAsciiPunct","isPunctChar","escapeRE","normalizeReference","helpers","parseLinkLabel","disableNested","marker","prevPos","labelEnd","posMax","oldPos","md","skipToken","parseLinkDestination","lines","parseLinkTitle","default_rules","rules","code_inline","env","slf","renderAttrs","code_block","fence","highlighted","tmpAttrs","tmpToken","langName","langAttrs","attrIndex","attrs","langPrefix","image","renderInlineAsText","renderToken","hardbreak","xhtmlOut","softbreak","breaks","html_block","html_inline","Renderer","nextToken","needLf","nesting","renderInline","renderer","Ruler","__rules__","__cache__","__find__","__compile__","chains","altName","chain","at","opt","before","beforeName","ruleName","afterName","ignoreInvalid","enableOnly","getRules","chainName","ruler","NEWLINES_RE","NULL_RE","RARE_RE","SCOPED_ABBR_TEST_RE","SCOPED_ABBR_RE","SCOPED_ABBR","tm","inlineTokens","inside_autolink","replaceFn","QUOTE_TEST_RE","QUOTE_RE","thisLevel","lastChar","nextChar","isLastPunctChar","isNextPunctChar","isLastWhiteSpace","isNextWhiteSpace","canOpen","canClose","isSingle","stack","openQuote","closeQuote","OUTER","lastIndex","quotes","replaceAt","markup","meta","attrPush","attrData","attrSet","attrGet","attrJoin","inlineMode","StateCore","state_core","_rules","currentToken","nodes","lastPos","htmlLinkLevel","fullUrl","urlText","blockTokens","linkify","pretest","isLinkClose","normalizeLink","validateLink","schema","normalizeLinkText","blkIdx","typographer","replace_scoped","replace_rare","process_inlines","last","Core","process","State","require$$8","parser_core","bMarks","tShift","eMarks","isEscaped","startLine","open_tag","close_tag","HTML_TAG_RE","HTML_OPEN_CLOSE_TAG_RE","html_re","block_names","HTML_SEQUENCES","indent","indent_found","sCount","bsCount","blkIndent","lineMax","tight","ddIndent","listIndent","parentType","StateBlock","skipEmptyLines","skipSpaces","skipSpacesBack","skipChars","skipCharsBack","getLines","begin","end","keepLastLF","lineIndent","lineStart","state_block","endLine","silent","lineText","nextLine","columnCount","aligns","tableLines","tbodyLines","oldParentType","terminate","terminatorRules","firstCh","secondCh","getLine","escapedSplit","params","mem","haveEndMarker","adjustTab","lastLineEmpty","oldBMarks","oldBSCount","oldIndent","oldSCount","oldTShift","spaceAfterMarker","isOutdented","oldLineMax","tokenize","cnt","contentStart","indentAfterMarker","isOrdered","itemLines","listLines","listTokIdx","markerCharCode","markerValue","oldListIndent","oldTight","posAfterMarker","prevEmptyEnd","isTerminatingParagraph","skipOrderedListMarker","skipBulletListMarker","_endLine","destEndPos","destEndLineNo","href","references","ParserBlock","hasEmptyLines","maxNesting","outTokens","require$$12","parser_block","SCHEME_RE","ESCAPED","delimiters","startDelim","endDelim","loneMarkers","strikethrough","scanned","scanDelims","can_open","can_close","postProcess","tokens_meta","isStrong","emphasis","EMAIL_RE","AUTOLINK_RE","DIGITAL_RE","NAMED_RE","closerIdx","openerIdx","closer","opener","minOpenerIdx","newMinOpenerIdx","isOddMatch","lastJump","openersBottom","headerIdx","lastTokenIdx","jumps","pendingLevel","_prev_delimiters","backticks","backticksScanned","linkLevel","StateInline","pushPending","token_meta","canSplitWord","left_flanking","right_flanking","state_inline","isTerminatorChar","matchAtStart","pmax","ws","ch1","ch2","origStr","escapedStr","matchStart","matchEnd","openerLength","closerLength","require$$6","require$$7","labelStart","parseReference","_rules2","processDelimiters","ruler2","ParserInline","require$$15","parser_inline","_class","fuzzyLink","fuzzyEmail","fuzzyIP","defaultSchemas","validate","tail","src_auth","src_host_port_strict","src_path","no_http","src_domain","src_domain_root","src_port","src_host_terminator","mailto","src_email_name","src_host_strict","tlds_default","opts","src_Any","src_Cc","src_Z","src_P","src_ZPCc","src_ZCc","src_pseudo_letter","src_ip4","src_xn","src_host","tpl_host_fuzzy","tpl_host_no_ip_fuzzy","tpl_host_fuzzy_strict","tpl_host_port_fuzzy_strict","tpl_host_port_no_ip_fuzzy_strict","tpl_host_fuzzy_test","tpl_email_fuzzy","tpl_link_fuzzy","tpl_link_no_ip_fuzzy","__opts__","tlds","__tlds__","tpl","src_tlds","onCompile","__tlds_replaced__","email_fuzzy","untpl","link_fuzzy","link_no_ip_fuzzy","host_fuzzy_test","aliases","__compiled__","__schemas__","compiled","isFunction","schemaError","normalize","slist","schema_test","schema_search","schema_at_start","__index__","__text_cache__","__last_index__","__schema__","Match","schemas","LinkifyIt","compile","definition","ml","me","tld_pos","testSchemaAt","createMatch","keepOld","linkifyIt","maxInt","regexPunycode","regexNonASCII","regexSeparators","errors","overflow","stringFromCharCode","RangeError","encoded","output","counter","ucs2encode","digitToBasic","digit","adapt","numPoints","firstTime","baseMinusTMin","inputLength","bias","basic","oldi","codePoint","baseMinusT","out","ucs2decode","basicLength","handledCPCount","handledCPCountPlusOne","qMinusT","toUnicode","mapDomain","toASCII","punycode","ucs2","ParserCore","require$$5","zero","rules2","commonmark","BAD_PROTO_RE","GOOD_DATA_RE","RECODE_HOSTNAME_FOR","parsed","presetName","MarkdownIt","configure","presets","missed","plugin","apply","parseInline","markdownIt","ChangeLogWindow","lastVersion","dontShowAgain","xhr","XMLHttpRequest","onload","status","changelog","_processChangelog","response","send","MD","false","true","isPermalinkSymbol","emitWarning","permalinkClass","permalinkHref","permalinkAttrs","permalinkSymbol","permalinkSpace","permalinkBefore","symbol","renderHref","renderPermalinkImpl","ariaHidden","placement","safariReaderFix","assistiveText","visuallyHiddenClass","wrapper","getTokensText","slugify","uniqueSlugStartIndex","tabIndex","permalink","renderPermalink","slug","__proto__","legacy","makePermalink","linkInsideHeader","headerLink","linkAfterHeader","HelpBrowserFFD20","_backwardHistory","_forwardHistory","_currentPage","_md","_initMarkdown","minWidth","minHeight","currentUrl","MarkDownItAnchor","defaultImageRenderRule","ffd20HelpImageRenderer","hasHistoryBack","hasHistoryForward","pageContent","getCurrentHistoryObject","contentElement","headerElement","getElementById","emHeight","getComputedStyle","fontSize","offsetTop","backInHistory","forwardInHistory","removeAttribute","defaultRenderer","foundrySrc","getRoute","migrateWorld","startMessage","_migrateWorldSettings","migrateActorData","enforceTypes","migrateItemData","migrateSceneData","_actor","locked","migrateCompendium","infoElem","fadeOut","fetch","migrate","ent","Scene","oldXPTrack","linked","isLinked","_migrateCharacterLevel","_migrateActorEncumbrance","_migrateActorNoteArrays","_migrateActorSpeed","_migrateSpellDivineFocus","_migrateActorConcentration","_migrateActorSpellbookCL","_migrateActorSpellbookSlots","_migrateActorBaseStats","_migrateUnusedActorCreatureType","_migrateActorSpellbookDCFormula","_migrateActorHPAbility","_migrateActorCR","_migrateAttackAbility","_migrateActorDefenseAbility","_migrateActorTokenVision","_migrateActorSpellbookUsage","_migrateActorNullValues","_migrateActorSpellbookDomainSlots","_migrateActorStatures","_migrateActorInitAbility","_migrateActorChangeRevamp","_migrateActorCMBRevamp","_migrateActorConditions","_migrateActorSkillRanks","_migrateCarryBonus","_migrateBuggedValues","_migrateSpellbookUsage","_migrateActorHP","_migrateActorSenses","_migrateActorSkillJournals","_d","_migrateItemArrayTypes","_migrateItemSpellUses","_migrateFlagsArrayToObject","_migrateWeaponImprovised","_migrateSpellDescription","_migrateClassDynamics","_migrateClassType","_migrateWeaponCategories","_migrateEquipmentCategories","_migrateItemSize","_migrateAbilityTypes","_migrateClassLevels","_migrateSavingThrowTypes","_migrateCR","_migrateItemChanges","_migrateTemplateSize","_migrateEquipmentSize","_migrateTags","_migrateSpellCosts","_migrateLootEquip","_migrateUnchainedActionEconomy","_migrateItemRange","_migrateWeaponData","_migrateItemLinks","_migrateClassAssociations","_migrateProficiencies","_migrateItemNotes","_migrateSpellData","_migrateItemActions","_migrateItemWeight","itemActionData","actionDataList","migrateItemActionData","filterItemActions","_migrateActionDamageType","_migrateActionConditionals","_migrateActionEnhOverride","_migrateActionPrimaryAttack","updateKey","bflags","dflags","spellbookSlot","baseKey","newBase","kList","curFormula","curBase","oldValue","formulaKey","damageRoll","damageBonusFormula","dieCount","dieSides","stKeys","changeProp","two","oldType","wdSize","newChanges","newChange","newNotes","measureSize","curAction","_assoc","modified","assoc","hiddenLinks","hasOldAction","alreadyHasActions","removeKeys","spellDuration","oldSpellPointCostFormula","damageGroupPaths","damageGroupPath","damageGroup","damagePart","damageTypeData","_Action_ConvertDamageType","reResult","vision","darkvision","cond","condAlt","convertToInt","oldSenses","brightSight","lowLightVision","lowLightVisionMultiplier","lowLightVisionMultiplierBright","reOldJournalFormat","subSkillKey","damageTypeString","damageTypeList","tests","damageTest","testString","createItemMacro","macro","Macro","displaySheet","assignHotbarMacro","createSkillMacro","skillInfo","createSaveMacro","saveName","createMiscActorMacro","altTypeLabel","rollItemMacro","forceShowItem","rollSkillMacro","rollSaveMacro","getActiveActor","rollActorAttributeMacro","getLeftRight","SHIFT_KEYS","CTRL_KEYS","registerSystemControls","keybindings","onDown","onUp","controls","_hideTokenTooltip","_hideTokenTooltipGMInfo","keyDown","getPrototypeOf","newScriptCallData","getScriptBody","AsyncFunction","hasAttackRoll","isCombatManeuver","showMaxChargeFormula","canInputRange","canInputMinRange","canInputDuration","itemEnh","usesSpellPoints","canUseAmmo","hasActivationType","showMaxRangeIncrements","subTargets","conditionalModifierTypes","conditionalCritical","_onEditImage","_onAttackControl","_onDamageControl","_onClickDamageType","_onConditionalControl","ItemConditionalModifier","initialData","clickedElement","damageIndex","conditionalElement","modifierElement","attackPart","conditionalIdx","modifierIdx","newConditionalData","_prepareModifiers","dryRun","newConditionalModifierData","_onClickAction","BaseRegistry","_initialize","contentClass","contentName","_defaultData","module","unregister","dataOnly","registryObject","BaseRegistryObject","_baseData","DamageType","DamageTypes","ScriptCall","ScriptCalls","LinkOptions","linkTypes","LinksApp","getLinkTypes","linkTypesObj","_getLinkTypeCommandOptions","defaultType","canApply","canApplyCritical","DetectionModeInvisibilityFFD20","DetectionModeInvisibility","_testPoint","visionSource","_testLOS","_testRange","lightSource","lightSources","DetectionModeBlindSenseFFD20","DETECTION_TYPES","walls","_detectionFilter","OutlineOverlayFilter","outlineColor","knockout","wave","ID","_canDetect","DetectionModeBlindSightFFD20","DetectionModeTremorFFD20","DetectionModeTremor","MOVE","promptDialog","origCount","origSides","targetSize","initialSize","_getSizeIndex","skipWarning","d10Arr","larger","smaller","mediumDie","mediumDieMax","d6Index","d8Index","sizeOffset","curSize","globalThis","moduleToObject","_canvas","once","oldFFD20","polymorphism","applications.compendiums","measureReachDistance","documentComponents","baseRegistry","ItemAttack","tokenTooltip","hideGMInfo","functions","Proxy","Reflect","layers","layerClass","dice.RollFFD20","dice.D20RollFFD20","roundTime","Actors","unregisterSheet","registerSheet","makeDefault","Items","specialStatusEffects","BLIND","LABEL","DETECTION_TYPE","SIGHT","SpeedProvider","enhancedTerrain","modules","dragRuler","registerSystem","colors","getRanges","baseSpeed","getBaseSpeed","heavyLoad","runMultiplier","useElevation","getSetting","elevation","terrain","terrainFromGrid","environment","burrow","land","toLocalize","toSort","doLocalize","localized","localA","localB","localizeLabels","controls.registerSystemControls","ttconf","ttwconf","PREVIOUS_MIGRATION_VERSION","migrations.migrateWorld","changelogVersion","curVersion","SquareGrid","chat.hideRollInfo","chat.hideGMSensitiveInfo","chat.hideInvisibleTargets","chat.addTargetCallbacks","chat.alterTargetDefense","chat.addChatCardTitleGradient","chat.alterAmmoRecovery","handleChatTooltips","chatListeners","addReachListeners","addTop3Attacks","loadTexture","effectItemId","foundItem","_getChildren","itemLinks","childChildren","toRemove","handledChildren","otherItemLinks","_directoryDrop","macros.createItemMacro","macros.createSkillMacro","macros.createSaveMacro","macros.createMiscActorMacro","TokenData","newHTML","enableCustomVision","tabElem","Settings","chlogButton","helpButton","chlog","entryOptions","started","expireFromTokens"],"mappings":"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"}