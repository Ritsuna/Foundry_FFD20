<div class="flexrow summary-header">
  <img class="profile" src="{{actor.img}}" title="{{actor.name}}" data-edit="img"/>

  <div class="flexcol">
    <div class="flexrow name-xp">
      <div>
        <h1 class="charname">
          <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize "ffd20lnrw.CharacterName"}}" title="{{localize "ffd20lnrw.CharacterName"}}"/>
        </h1>
      </div>

      {{#if isCharacter}}
      <div class="hd-level character tooltip">
        <span class="tooltipcontent">
          @attributes.hd.total : {{data.attributes.hd.total}}
        </span>

        <table>
          <thead>
            <tr>
              <th>{{localize "ffd20lnrw.Level"}}</th>
              {{#unless disableExperience}}
              <th>{{localize "ffd20lnrw.Experience"}}</th>
              {{/unless}}
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                {{data.details.level.value}}
              </td>
              {{#unless disableExperience}}
              <td>
                <div class="flexrow experience">
                  <span class="text-box direct allow-relative" name="data.details.xp.value" data-dtype="Number">{{data.details.xp.value}}</span>
                  <span class="separator"> / </span>
                  <span class="text-box max readonly">{{data.details.xp.max}}</span>
                </div>
              </td>
              {{/unless}}
            </tr>
          </tbody>
        </table>

        {{#unless disableExperience}}
        <div class="xpbar">
          {{#if data.details.xp.pct}}
          <span class="bar" style="width: {{data.details.xp.pct}}%"></span>
          {{/if}}
        </div>
        {{/unless}}
      </div>
      {{else}}
      <div class="hd-level npc tooltip flexrow">
        <table>
          <thead>
            <tr>
              <th>{{localize "ffd20lnrw.HitDieShort"}}</th>
              <th>{{localize "ffd20lnrw.ChallengeRatingShort"}}</th>
              <th>{{localize "ffd20lnrw.Experience"}}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                {{data.attributes.hd.total}}
              </td>
              <td>
                <span class="text-box cr-input" name="data.details.cr.base">{{labels.cr}}</span>
              </td>
              <td>
                {{data.details.xp.value}}
              </td>
            </tr>
          </tbody>
        </table>

        <span class="tooltipcontent">
          @attributes.hd.total : {{data.attributes.hd.total}}<br/>
          @details.cr.base : {{data.details.cr.base}}<br/>
          @details.cr.total : {{data.details.cr.total}}
        </span>
      </div>
      {{/if}}
    </div>

    {{!-- Character Summary --}}
    <div class="character-summary flexrow">
      <div>
        <input type="text" name="data.details.gender" value="{{data.details.gender}}" placeholder="{{localize "ffd20lnrw.Gender"}}" title="{{localize "ffd20lnrw.Gender"}}"/>
      </div>
      <div>
        <input type="text" name="data.details.deity" value="{{data.details.deity}}" placeholder="{{localize "ffd20lnrw.Deity"}}" title="{{localize "ffd20lnrw.Deity"}}"/>
      </div>
      <div>
        <input type="text" name="data.details.age" value="{{data.details.age}}" placeholder="{{localize "ffd20lnrw.Age"}}" title="{{localize "ffd20lnrw.Age"}}"/>
      </div>
      <div>
        <input type="text" name="data.details.height" value="{{data.details.height}}" placeholder="{{localize "ffd20lnrw.Height"}}" title="{{localize "ffd20lnrw.Height"}}"/>
      </div>
      <div>
        <input type="text" name="data.details.weight" value="{{data.details.weight}}" placeholder="{{localize "ffd20lnrw.Weight"}}" title="{{localize "ffd20lnrw.Weight"}}"/>
      </div>

      {{!-- Alignment --}}
      <div class="controls alignment flexrow" title="{{localize "ffd20lnrw.Alignment"}}">
        {{#if labels.alignment}}<span>{{labels.alignment}}</span>{{else}}<span class="placeholder">{{localize "ffd20lnrw.Alignment"}}</span>{{/if}}
        <a class="control alignment"><i class="fas fa-cog"></i></a>
      </div>
    </div>

    <div class="flexrow">
      <div class="race-container item flexrow" {{#if race}}data-item-id="{{race._id}}"{{/if}} title="{{localize "ffd20lnrw.Race"}}">
        <div class="race item-image rollable" style="background-image: url({{race.img}})" title="{{labels.race}}">
          {{#unless race}}{{localize "ffd20lnrw.Race"}}{{/unless}}
        </div>

        <div class="item-controls flexcol">
          {{#if owner}}
          {{#unless race}}
          <a class="item-control add" title="{{localize "ffd20lnrw.CreateItem"}}"><i class="fas fa-plus"></i></a>
          <a data-action="compendium" data-action-target="races" title="{{localize "ffd20lnrw.OpenCompendium"}}"><i class="fas fa-folder-plus"></i></a>
          {{/unless}}
          {{#if race}}
          <a class="item-control edit" title="{{localize "ffd20lnrw.EditItem"}}"><i class="fas fa-edit"></i></a>
          <a class="item-control delete" title="{{localize "ffd20lnrw.DeleteItem"}}"><i class="fas fa-trash"></i></a>
          {{/if}}
          {{/if}}
        </div>

        {{#if race}}
        <div class="race-info">
          <span class="tag type3">{{lookup config.creatureTypes race.data.creatureType}}</span>
          {{#each race.data.subTypes as |v|}}
          <span class="tag">{{v}}</span>
          {{/each}}
        </div>
        {{/if}}
      </div>

      {{!-- Hit Point Ability --}}
      <div class="form-group select hp-ability">
        <label>{{localize "ffd20lnrw.HPAbility"}}</label>
        <select name="data.attributes.hpAbility">
          {{#select data.attributes.hpAbility}}
          <option value=""></option>
          {{#each config.abilities as |ability a|}}
          <option value="{{a}}">{{ability}}</option>
          {{/each}}
          {{/select}}
        </select>
      </div>
    </div>
  </div>
</div>

<div class="flexrow item-list misc-header-items">

  {{!-- Rest --}}
  <div class="actor-quick-actions">
    <button type="button" class="rest"><i class="fas fa-bed"></i> {{localize "ffd20lnrw.Rest"}}</button>
  </div>
</div>

{{!-- Header Attributes --}}
<ul class="attributes flexrow">
  <li>
    <table class="health-table">
      <thead class="tooltip">
        <tr>
          <th colspan="4">
            <div class="tooltipcontent">
              @attributes.hp.value : {{data.attributes.hp.value}}<br/>
              @attributes.hp.max : {{data.attributes.hp.max}}<br/>
              @attributes.hp.temp : {{data.attributes.hp.temp}}<br/>
              @attributes.hp.nonlethal : {{data.attributes.hp.nonlethal}}

              {{#if sourceDetails.data.attributes.hp.max.length}}
              <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
              {{#each sourceDetails.data.attributes.hp.max as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
              {{/if}}
            </div>

            {{localize "ffd20lnrw.HitPoints"}}
          </th>
        </tr>

        <tr>
          <th>{{localize "ffd20lnrw.Current"}}</th>
          <th>{{localize "ffd20lnrw.Maximum"}}</th>
          <th>{{localize "ffd20lnrw.TempShort"}}</th>
          <th>{{localize "ffd20lnrw.Nonlethal"}}</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            <span class="text-box direct allow-relative hp-current-input" name="data.attributes.hp.value" data-dtype="Number">{{data.attributes.hp.value}}</span>
          </td>
          <td>
            <span class="text-box readonly">{{data.attributes.hp.max}}</span>
          </td>
          <td>
            <span class="text-box direct allow-relative hp-temp-input" name="data.attributes.hp.temp" data-dtype="Number">{{#if data.attributes.hp.temp}}{{data.attributes.hp.temp}}{{/if}}</span>
          </td>
          <td>
            <span class="text-box direct allow-relative hp-nonlethal-input" name="data.attributes.hp.nonlethal" data-dtype="Number">{{#if data.attributes.hp.nonlethal}}{{data.attributes.hp.nonlethal}}{{/if}}</span>
          </td>
        </tr>
      </tbody>
    </table>
  </li>

  <li>
    <table class="speed-table">
      <thead>
        <tr>
          <th colspan="5">{{localize "ffd20lnrw.Speed"}}</th>
          <th rowspan="2">{{localize "ffd20lnrw.FlyManeuverabilityShort"}}</th>
        </tr>
        <tr>
          <th>{{localize "ffd20lnrw.SpeedLand_Short"}}</th>
          <th>{{localize "ffd20lnrw.SpeedClimb_Short"}}</th>
          <th>{{localize "ffd20lnrw.SpeedSwim_Short"}}</th>
          <th>{{localize "ffd20lnrw.SpeedBurrow_Short"}}</th>
          <th>{{localize "ffd20lnrw.SpeedFly_Short"}}</th>
        </tr>
      </thead>

      <tbody>
        <td class="tooltip">
          <span class="text-box direct speed" name="data.attributes.speed.land.base" data-dtype="Number">
            {{#if data.attributes.speed.land.total}}{{data.attributes.speed.land.total}}{{/if}}
          </span>

          <div class="tooltipcontent">
            @attributes.speed.land.total : {{data.attributes.speed.land.total}}
            {{#if sourceDetails.data.attributes.speed.land.total.length}}
              <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
              {{#each sourceDetails.data.attributes.speed.land.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
            {{/if}}
          </div>
        </td>
        <td class="tooltip">
          <span class="text-box direct speed" name="data.attributes.speed.climb.base" data-dtype="Number">
            {{#if data.attributes.speed.climb.total}}{{data.attributes.speed.climb.total}}{{/if}}
          </span>

          <div class="tooltipcontent">
            @attributes.speed.climb.total : {{data.attributes.speed.climb.total}}
            {{#if sourceDetails.data.attributes.speed.climb.total.length}}
              <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
              {{#each sourceDetails.data.attributes.speed.climb.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
            {{/if}}
          </div>
        </td>
        <td class="tooltip">
          <span class="text-box direct speed" name="data.attributes.speed.swim.base" data-dtype="Number">
            {{#if data.attributes.speed.swim.total}}{{data.attributes.speed.swim.total}}{{/if}}
          </span>

          <div class="tooltipcontent">
            @attributes.speed.swim.total : {{data.attributes.speed.swim.total}}
            {{#if sourceDetails.data.attributes.speed.swim.total.length}}
              <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
              {{#each sourceDetails.data.attributes.speed.swim.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
            {{/if}}
          </div>
        </td>
        <td class="tooltip">
          <span class="text-box direct speed" name="data.attributes.speed.burrow.base" data-dtype="Number">
            {{#if data.attributes.speed.burrow.total}}{{data.attributes.speed.burrow.total}}{{/if}}
          </span>

          <div class="tooltipcontent">
            @attributes.speed.burrow.total : {{data.attributes.speed.burrow.total}}
            {{#if sourceDetails.data.attributes.speed.burrow.total.length}}
              <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
              {{#each sourceDetails.data.attributes.speed.burrow.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
            {{/if}}
          </div>
        </td>
        <td class="tooltip">
          <span class="text-box direct speed" name="data.attributes.speed.fly.base" data-dtype="Number">
            {{#if data.attributes.speed.fly.total}}{{data.attributes.speed.fly.total}}{{/if}}
          </span>

          <div class="tooltipcontent">
            @attributes.speed.fly.total : {{data.attributes.speed.fly.total}}<br/>
            @attributes.speed.fly.maneuverability : "{{data.attributes.speed.fly.maneuverability}}"
            {{#if sourceDetails.data.attributes.speed.fly.total.length}}
              <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
              {{#each sourceDetails.data.attributes.speed.fly.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
            {{/if}}
          </div>
        </td>
        <td>
          <select name="data.attributes.speed.fly.maneuverability">
            {{#select data.attributes.speed.fly.maneuverability}}
            {{#each config.flyManeuverabilities as |name type|}}
            <option value="{{type}}">{{name}}</option>
            {{/each}}
            {{/select}}
          </select>
        </td>
      </tbody>
    </table>
  </li>
</ul>

{{!-- Footer Navigation --}}
<nav class="sheet-navigation tabs subtabs subdetails" data-group="subdetails">
  <a class="item active" data-tab="quick-info">{{localize "ffd20lnrw.QuickInfo"}}</a>
  <a class="item" data-tab="classes">{{localize "ffd20lnrw.ClassPlural"}}</a>
</nav>

<section class="subdetails-body">
  <div class="tab quick-info" data-group="subdetails" data-tab="quick-info">
    <div class="flexcol">
      {{!-- Roll Defenses --}}
      <li class="generic-defenses flexrow">
        <div class="rollable image-d20"></div>
        <label><h3>{{localize "ffd20lnrw.Defenses"}}</h3></label>
      </li>

      {{> "systems/ffd20lnrw/templates/actors/parts/actor-defenses_tables.hbs"}}

      <table>
        <thead>
          <tr>
            <th class="attribute bab" data-attribute="bab" rowspan="2">
              <a class="rollable"><i class="fas fa-dice"></i><span>{{localize "ffd20lnrw.BABAbbr"}}</span></a>
            </th>
            <th class="attribute cmb" data-attribute="cmb" rowspan="2">
              <a class="rollable"><i class="fas fa-dice"></i><span>{{localize "ffd20lnrw.CMBAbbr"}}</span></a>
            </th>
            <th class="attribute initiative" data-attribute="initiative" colspan="2">
              <a class="rollable"><i class="fas fa-dice"></i><span>{{localize "ffd20lnrw.Initiative"}}</span></a>
            </th>
          </tr>
          <tr>
            <th>{{localize "ffd20lnrw.Value"}}</th>
            <th>{{localize "ffd20lnrw.Ability"}}</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td class="tooltip">
              <span class="tooltipcontent">
                @attributes.bab.total : {{data.attributes.bab.total}}
                {{#if sourceDetails.data.attributes.bab.total.length}}
                <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
                {{#each sourceDetails.data.attributes.bab.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
                {{/if}}
              </span>

              {{data.attributes.bab.total}}
            </td>

            <td class="tooltip">
              <span class="tooltipcontent">
                @attributes.cmb.total : {{data.attributes.cmb.total}}
                {{#if sourceDetails.data.attributes.cmb.total.length}}
                <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
                {{#each sourceDetails.data.attributes.cmb.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
                {{/if}}
              </span>

              {{data.attributes.cmb.total}}
            </td>

            <td class="tooltip">
              <span class="tooltipcontent">
                @attributes.init.total : {{data.attributes.init.total}}
                {{#if sourceDetails.data.attributes.init.total.length}}
                  <br/><br/>{{localize "ffd20lnrw.FromSources"}}:<br/>
                  {{#each sourceDetails.data.attributes.init.total as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
                {{/if}}
              </span>
              {{data.attributes.init.total}}
            </td>
            <td>
              <select data-name="data.attributes.init.ability">
                {{#select data.attributes.init.ability}}
                  <option value=""></option>
                  {{selectOptions config.abilities}}
                {{/select}}
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    {{!-- Quick Actions --}}
    <h2>{{localize "ffd20lnrw.QuickActions"}}</h2>

    <ol class="quick-actions">
      {{#each quickActions as |i|}}
      <li class="item" data-item-id="{{i.item._id}}" data-type="{{i.item.type}}" style="border-color: {{i.color1}};" title="{{i.item.name}}">
        <img src="{{i.item.img}}">
        <span class="icon-label">{{i.item.name}}</span>
      </li>
      {{/each}}
    </ol>
  </div>

  {{!-- Classes --}}
  <div class="tab classes-body" data-group="subdetails" data-tab="classes">
    <div class="inventory-list flexcol">
      <div class="inventory-header flexrow">
        <h3 class="item-name flexrow"></h3>

        <div class="item-detail item-feat-level"><span>{{localize "ffd20lnrw.Level"}}</span></div>

        {{#if owner}}
        <div class="item-controls">
          <a class="item-control item-create" title="Create Item" data-type="class">
            <i class="fas fa-plus"></i>
          </a>
          <a data-action="compendium" data-action-target="classes" title="{{localize "ffd20lnrw.OpenCompendium"}}"><i class="fas fa-folder-plus"></i></a>
        </div>
        {{/if}}
      </div>

      {{#if classes.length}}
      <ol class="item-list">
        {{#each classes as |item iid|}}
        <div class="item flexrow {{#unless isCharged}}uncharged{{/unless}}" data-item-id="{{item._id}}">
          <div class="item-name flexrow rollable">
            <div class="item-image" style="background-image: url({{item.img}})"></div>
            <h4>{{item.name}}</h4>
          </div>

          <div class="item-detail item-feat-level tooltip">
            <span>Level {{item.data.level}}</span>
            <span class="tooltipcontent">@classes.{{item.data.tag}}.level : {{item.data.level}}</span>
          </div>

          {{#if ../owner}}
          <div class="item-controls">
            <a class="item-control item-edit" title="{{localize "ffd20lnrw.EditItem"}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-duplicate" title="{{localize "ffd20lnrw.DuplicateItem"}}"><i class="fas fa-copy"></i></a>
            <a class="item-control item-delete" title="{{localize "ffd20lnrw.DeleteItem"}}"><i class="fas fa-trash"></i></a>
          </div>
          {{/if}}
        </div>
        {{/each}}
      </ol>
      {{else}}
      <div class="flexcol info">
        <span>
          {{{labels.firstClass}}}
        </span>
      </div>
      {{/if}}
    </div>
  </div>
</section>
